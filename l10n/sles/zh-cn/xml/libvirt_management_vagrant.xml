<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="libvirt_management_vagrant.xml" version="5.0" xml:id="cha-libvirt-manage-vagrant">
 <title>使用 Vagrant 管理虚拟机</title>
 <info>
      <abstract>
        <para>
    Vagrant 工具为创建、部署和管理虚拟开发环境提供统一的工作流程。下列章节介绍如何使用 Vagrant 管理虚拟机。
   </para>
      </abstract>
      <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
        <dm:bugtracker/>
        <dm:translation>是</dm:translation>
      </dm:docmanager>
    </info>
    <sect1 xml:id="sec-libvirt-vagrant-intro">
  <title>Vagrant 简介</title>
  <para>Vagrant 通过一个简单的配置文件为各种虚拟化提供程序提供了一个抽象层，可让开发人员和操作人员快速启动运行 Linux 或任何其他操作系统的虚拟机 (VM)。
  </para>

  <sect2 xml:id="sec-libvirt-vagrant-concept">
   <title>Vagrant 概念</title>
   <para>
    Vagrant 使用<literal>提供器</literal>、<literal>配置器</literal>、<literal>盒子</literal> (box) 及 <literal>Vagrantfile</literal> 作为虚拟机的组建模块。
   </para>
   <variablelist>
    <title>Vagrant 术语</title>
    <varlistentry>
     <term>提供器</term>
     <listitem>
      <para>
       用于设置和创建虚拟环境的服务。Vagrant 原生支持 VirtualBox 和 Microsoft Hyper-V 虚拟化以及 Docker 容器。通过插件来支持 <systemitem class="library">libvirt</systemitem>、VMware 或 AWS 等其他服务。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>配置器</term>
     <listitem>
      <para>
       用于自定义虚拟环境配置的工具。Vagrant 不仅构建了内置的提供器用于上载文件、同步目录或执行外壳命令，同时还支持 Ansible、CFEngine、Chef、Puppet 和 Salt 等配置管理系统。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>Vagrantfile</term>
     <listitem>
      <para>
       虚拟环境的配置文件和文件名 (<filename>Vagrantfile</filename>)。其中包含计算机和软件要求，以及创建可直接用于开发的盒子所需执行的所有步骤。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>盒子</term>
     <listitem>
      <para>
       虚拟环境的格式和扩展名 (<filename>*.box</filename>)。可以从 <link xlink:href="https://vagrantcloud.com/">Vagrant Cloud</link> 下载盒子，也可将盒子从一台计算机复制到另一台计算机，以复制环境。
      </para>
      <para>
       SUSE 使用 VirtualBox 和 <systemitem class="library">libvirt</systemitem> 提供器提供适用于 SUSE Linux Enterprise 的官方 Vagrant 盒子。SUSE Linux Enterprise Server 盒子适用于 AMD64/Intel 64 和 AArch64 体系结构，而 SUSE Linux Enterprise Desktop 仅适用于 AMD64/Intel 64。
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
  </sect2>
  <sect2 xml:id="sec-libvirt-vagrant-example">
   <title>Vagrant 示例</title>
   <para>
    可以使用 Vagrant 通过下面一组命令启动新 VM。此示例使用适用于 openSUSE Tumbleweed 的官方 Vagrant 盒子（可从 <link xlink:href="https://vagrantcloud.com/">Vagrant Cloud</link> 获取）。
   </para>
   <procedure>
    <title>使用 openSUSE Tumbleweed 创建 Vagrant 环境</title>
    <step>
     <para>
      下载适用于 openSUSE Tumbleweed 的 Vagrant 盒子：
     </para>
     <screen><command>vagrant</command> <option>init opensuse/Tumbleweed.x86_64</option></screen>
     <para>
      这还会在 Vagrant 中注册该盒子并创建 <filename>Vagrantfile</filename>。
     </para>
    </step>
    <step performance="optional">
     <para>
      编辑 <filename>Vagrantfile</filename> 以自定义环境。
     </para>
    </step>
    <step>
     <para>
     启动盒子：
     </para>
     <screen><command>vagrant</command> <option>up</option></screen>
    </step>
    <step>
     <para>
      通过 <command>ssh</command> 访问盒子：
     </para>
     <screen><command>vagrant</command> <option>ssh</option></screen>
    </step>
   </procedure>
  </sect2>
 </sect1>

 <sect1 xml:id="sec-libvirt-vagrant-sle">
  <title>适用于 SUSE Linux Enterprise 的 Vagrant 盒子</title>
  <para>
   从 SUSE Linux Enterprise 15 SP2 开始，SUSE 使用 VirtualBox 和 <systemitem class="library">libvirt</systemitem> 提供器提供适用于 SUSE Linux Enterprise 的官方 Vagrant 盒子。SUSE Linux Enterprise Server 盒子适用于 AMD64/Intel 64 和 AArch64 体系结构，而 SUSE Linux Enterprise Desktop 仅适用于 AMD64/Intel 64。
  </para>
  <para>
   为缩减大小，这些盒子打包在极其精简的软件包中，它们并未注册，因此用户在进一步配置之前需要注册盒子。
  </para>
  <para>
   只能从 <link xlink:href="https://download.suse.com"/> 直接下载盒子。因此，必须按如下所示将下载的盒子手动注册到 Vagrant 中：
  </para>

  <screen><command>vagrant</command> <option>box add --name <replaceable>SLES-15-SP2</replaceable> \
   <replaceable>/path/to/</replaceable>SLES15-SP2-Vagrant.x86_64-15.2-libvirt-*.vagrant.libvirt.box</option></screen>
  <para>
   然后，该盒子的名称将会显示为 <literal>SLES-15-SP2</literal>，您可以像使用其他 Vagrant 盒子一样使用它：
  </para>
  <screen><command>vagrant</command> <option>init <replaceable>SLES-15-SP2</replaceable></option>
<command>vagrant</command> <option>up</option>
<command>vagrant</command> <option>ssh</option></screen>
 </sect1>

 <sect1>
  <title>更多资料</title>
  <para>
   有关 Vagrant 及其配置的详细信息，请参见 <link xlink:href="https://docs.vagrantup.com/"/> 上的官方文档。
  </para>
 </sect1>

</chapter>
