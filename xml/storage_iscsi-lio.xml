<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE chapter PUBLIC "-//Novell//DTD NovDoc XML V1.0//EN" "novdocx.dtd" [
  <!ENTITY % NOVDOC.DEACTIVATE.IDREF "INCLUDE">
  <!ENTITY % entities SYSTEM "entity-decl.ent">
  %entities;
]>
<chapter id="cha_iscsi_lio" lang="en">
  <title>Mass Storage over IP Networks: iSCSI LIO Target Server</title>
  <para>
   <remark>Fate 312231</remark>
   LIO (linux-iscsi.org) is the standard open-source multiprotocol SCSI
   target for Linux. LIO replaced the STGT (SCSI Target) framework as the
   standard unified storage target in Linux with Linux kernel version 2.6.38
   and later. &yast; supports the iSCSI LIO Target Server software in SUSE
   Linux Enterprise Server 11 SP3 and later.
  </para>
  <para>
   This section describes how to use &yast; to configure an iSCSI LIO Target
   Server and set up iSCSI LIO target devices. You can use any iSCSI
   initiator software to access the target devices.
  </para>
  <itemizedlist role="subtoc">
   <listitem>
    <para>
     <xref linkend="sect_iscsi_lio_install" xrefstyle="SectTitleOnPage"/>
    </para>
   </listitem>
   <listitem>
    <para>
     <xref linkend="sect_iscsi_lio_service" xrefstyle="SectTitleOnPage"/>
    </para>
   </listitem>
   <listitem>
    <para>
     <xref linkend="sect_iscsi_lio_discovery" xrefstyle="SectTitleOnPage"/>
    </para>
   </listitem>
   <listitem>
    <para>
     <xref linkend="sect_iscsi_lio_storage" xrefstyle="SectTitleOnPage"/>
    </para>
   </listitem>
   <listitem>
    <para>
     <xref linkend="sect_iscsi_lio_targetgp" xrefstyle="SectTitleOnPage"/>
    </para>
   </listitem>
   <listitem>
    <para>
     <xref linkend="sect_iscsi_lio_edit" xrefstyle="SectTitleOnPage"/>
    </para>
   </listitem>
   <listitem>
    <para>
     <xref linkend="sect_iscsi_lio_delete" xrefstyle="SectTitleOnPage"/>
    </para>
   </listitem>
   <listitem>
    <para>
     <xref linkend="b13g8i2g" xrefstyle="SectTitleOnPage"/>
    </para>
   </listitem>
   <listitem>
    <para>
     <xref linkend="b12iqi8o" xrefstyle="SectTitleOnPage"/>
    </para>
   </listitem>
  </itemizedlist>
  <sect1 id="sect_iscsi_lio_install">
   <title>Installing the iSCSI LIO Target Server Software</title>

   <para>
    Use the &yast; Software Management tool to install the iSCSI LIO Target
    Server software on the &productname; server where you want to create
    iSCSI LIO target devices.
   </para>

   <procedure id="b12jepdi">
    <step id="b12jepdj">
     <para>
      Launch &yast; as the &rootuser; user.
     </para>
    </step>
    <step id="b12jepdk">
     <para>
      Select <guimenu>Software</guimenu><guimenu>Software
      Management.</guimenu>
     </para>
    </step>
    <step id="b12jepdl">
     <para>
      Select the <guimenu>Search</guimenu> tab, type <literal>lio</literal>,
      then click <guimenu>Search</guimenu>.
     </para>
    </step>
    <step id="b12jepdm">
     <para>
      Select the iSCSI LIO Target Server packages:
     </para>
     <informaltable  frame="topbot" rowsep="1" pgwide="0">
      <tgroup cols="2">
       <colspec colnum="1" colname="1" colwidth="4091*"/>
       <colspec colnum="2" colname="2" colwidth="5912*"/>
       <thead>
        <row id="b12gs3f1">
         <entry>
          <para>
           iSCSI LIO Target Server Packages
          </para>
         </entry>
         <entry>
          <para>
           Description
          </para>
         </entry>
        </row>
       </thead>
       <tbody>
        <row id="b12gs3f2">
         <entry>
          <para>
           <filename>yast2-iscsi-lio-server</filename>
          </para>
         </entry>
         <entry>
          <para>
           Provides a GUI interface in &yast; for the configuration of iSCSI
           LIO target devices.
          </para>
         </entry>
        </row>
        <row id="b12gs3f3">
         <entry>
          <para>
           <filename>lio-utils</filename>
          </para>
         </entry>
         <entry>
          <para>
           Provides APIs for configuring and controlling iSCSI LIO target
           devices that are used by
           <filename>yast2-iscsi-lio-server</filename>.
          </para>
         </entry>
        </row>
        <row id="b12gs3f4">
         <entry>
          <para>
           <filename>lio-mibs</filename>
          </para>
         </entry>
         <entry>
          <para>
           Provides SNMP (Simple Network Management Protocol) monitoring of
           iSCSI LIO target devices by using the dynamic load module
           (<filename>dlmod</filename>) functionality of the Net-SNMP agent.
           It supports SNMP v1, v2c, and v3. The configuration file is
           <filename>/etc/snmp/snmpd.conf</filename>.
          </para>
          <para>
           The <filename>lio-mibs</filename> software uses the
           <filename>perl-SNMP</filename> and <filename>net-snmp</filename>
           packages.
          </para>
          <para>
           For information about Net-SNMP, see the open source
           <ulink url="http://www.net-snmp.org/">Net-SNMP Project</ulink>.
          </para>
         </entry>
        </row>
        <row id="b12gs3f5">
         <entry>
          <para>
           <filename>lio</filename>-utils-debuginfo
          </para>
         </entry>
         <entry>
          <para>
           Provides debug information for the <filename>lio-utils</filename>
           package. You can use this package when developing or debugging
           applications for <filename>lio-utils</filename>.
          </para>
         </entry>
        </row>
       </tbody>
      </tgroup>
     </informaltable>
    </step>
    <step id="b12r0abb">
     <para>
      In the lower right corner of the dialog box, click
      <guimenu>Accept</guimenu> to install the selected packages.
     </para>
     <informalfigure pgwide="0">
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="lio_install_a.png" width="250pt" format="PNG"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="lio_install_a.png" width="250pt" format="PNG"/>
       </imageobject>
      </mediaobject>
     </informalfigure>
    </step>
    <step id="b12jepdn">
     <para role="intro">
      When you are prompted to approve the automatic changes, click
      <guimenu>Continue</guimenu> to accept the iSCSI LIO Target Server
      dependencies for the <filename>lio-utils</filename>,
      <filename>perl-SNMP</filename>, and <filename>net-snmp</filename>
      packages.
     </para>
     <informalfigure pgwide="0">
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="lio_install_changes_a.png" width="250pt" format="PNG"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="lio_install_changes_a.png" width="250pt" format="PNG"/>
       </imageobject>
      </mediaobject>
     </informalfigure>
    </step>
    <step id="b12jepdo">
     <para role="intro">
      Close and re-launch &yast;, then click <guimenu>Network
      Services</guimenu> and verify that the<guimenu> iSCSI LIO
      Target</guimenu> option is available in the menu.
     </para>
     <informalfigure pgwide="0">
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="lio_yast_option_a.png" width="250pt" format="PNG"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="lio_yast_option_a.png" width="250pt" format="PNG"/>
       </imageobject>
      </mediaobject>
     </informalfigure>
    </step>
    <step id="b12jepdp">
     <para>
      Continue with
      <xref linkend="sect_iscsi_lio_service" xrefstyle="SectTitleOnPage"/>.
     </para>
    </step>
   </procedure>
  </sect1>
  <sect1 id="sect_iscsi_lio_service">
   <title>Starting the iSCSI LIO Target Service</title>

   <para>
    The iSCSI LIO Target service is by default configured to be started
    manually. You can configure the service to start automatically on system
    restart. If you use a firewall on the server and you want the iSCSI LIO
    targets to be available to other computers, you must open a port in the
    firewall for each adapter that you want to use for target access. TCP
    port 3260 is the port number for the iSCSI protocol, as defined by IANA
    (Internet Assigned Numbers Authority).
   </para>

   <itemizedlist role="subtoc">
    <listitem>
     <para>
      <xref linkend="b12jbbfh" xrefstyle="SectTitleOnPage"/>
     </para>
    </listitem>
    <listitem>
     <para>
      <xref linkend="b12jbaln" xrefstyle="SectTitleOnPage"/>
     </para>
    </listitem>
    <listitem>
     <para>
      <xref linkend="b12jbalo" xrefstyle="SectTitleOnPage"/>
     </para>
    </listitem>
   </itemizedlist>

   <sect2 id="b12jbbfh">
    <title>Configuring iSCSI LIO Startup Preferences</title>
    <para>
     To configure the iSCSI LIO Target Server service settings:
    </para>
    <procedure id="b12jauce">
     <step id="b13n0ujo">
      <para>
       Log in to the iSCSI LIO target server as the
       &rootuser; user, then launch a terminal console.
      </para>
     </step>
     <step id="b13n0ujp">
      <para>
       Ensure that the <filename>/etc/init.d/target</filename> daemon is
       running. At the command prompt, enter
      </para>
<screen>
 systemctl start target.service
</screen>
      <para>
       The command returns a message to confirm that the daemon is started,
       or that the daemon is already running.
      </para>
     </step>
     <step id="b12jaucf">
      <para>
       Launch &yast; as the &rootuser; user.
      </para>
     </step>
     <step id="b12jaucg">
      <para>
       In the &yast; Control Center, select <guimenu>Network
       Services</guimenu>, then select <guimenu>iSCSI LIO Target</guimenu>.
      </para>
      <para>
       You can also search for <quote>lio</quote>, then select
       <guimenu>iSCSI LIO Target</guimenu>.
      </para>
      <informalfigure pgwide="0">
       <mediaobject>
        <imageobject role="fo">
         <imagedata fileref="lio_yast2_a.png" width="250pt" format="PNG"/>
        </imageobject>
        <imageobject role="html">
         <imagedata fileref="lio_yast2_a.png" width="250pt" format="PNG"/>
        </imageobject>
       </mediaobject>
      </informalfigure>
     </step>
     <step id="b12jauch">
      <para role="intro">
       In the iSCSI LIO Target Overview dialog box, select the
       <guimenu>Service</guimenu> tab.
      </para>
      <informalfigure pgwide="0">
       <mediaobject>
        <imageobject role="fo">
         <imagedata fileref="lio_service_a.png" width="250pt" format="PNG"/>
        </imageobject>
        <imageobject role="html">
         <imagedata fileref="lio_service_a.png" width="250pt" format="PNG"/>
        </imageobject>
       </mediaobject>
      </informalfigure>
     </step>
     <step id="b12jauci">
      <para role="intro">
       Under <guimenu>Service Start</guimenu>, specify how you want the
       iSCSI LIO target service to be started:
      </para>
      <itemizedlist>
       <listitem>
        <formalpara id="b12jaucj">
         <title>When Booting:</title>
         <para>
          The service starts automatically on server restart.
         </para>
        </formalpara>
       </listitem>
       <listitem>
        <formalpara id="b12jauck">
         <title>Manually:</title>
         <para>
          (Default) You must start the service manually after a server
          restart. The target devices are not available until you start the
          service.
         </para>
        </formalpara>
       </listitem>
      </itemizedlist>
     </step>
     <step id="b12jaucl">
      <para>
       If you use a firewall on the server and you want the iSCSI LIO
       targets to be available to other computers, open a port in the
       firewall for each adapter interface that you want to use for target
       access.
      </para>
      <para>
       Firewall settings are disabled by default. They are not needed unless
       you deploy a firewall on the server. The default port number is 3260.
       If the port is closed for all of the network interfaces, the iSCSI
       LIO targets are not available to other computers.
      </para>
      <substeps>
       <step id="b12jaucm">
        <para>
         On the <guimenu>Services</guimenu> tab, select the <guimenu>Open
         Port in Firewall</guimenu> check box to enable the firewall
         settings.
        </para>
       </step>
       <step id="b12jaucn">
        <para>
         Click <guimenu>Firewall Details</guimenu> to view or configure the
         network interfaces to use.
        </para>
        <para>
         All available network interfaces are listed, and all are selected
         by default.
        </para>
        <informalfigure pgwide="0">
         <mediaobject>
          <imageobject role="fo">
           <imagedata fileref="lio_firewall_ports_a.png" width="250pt" format="PNG"/>
          </imageobject>
          <imageobject role="html">
           <imagedata fileref="lio_firewall_ports_a.png" width="250pt" format="PNG"/>
          </imageobject>
         </mediaobject>
        </informalfigure>
       </step>
       <step id="b12jauco">
        <para>
         For each interface, specify whether to open or close a port for it:
        </para>
        <itemizedlist>
         <listitem>
          <formalpara id="b12jaucp">
           <title>Open:</title>
           <para>
            Select the interface’s check box to open the port. You can
            also click <guimenu>Select All</guimenu> to open a port on all
            of the interfaces.
           </para>
          </formalpara>
         </listitem>
         <listitem>
          <formalpara id="b12jaucq">
           <title>Close:</title>
           <para>
            Deselect the interface’s check box to close the port. You can
            also click <guimenu>Select None</guimenu> to close the port on
            all of the interfaces.
           </para>
          </formalpara>
         </listitem>
        </itemizedlist>
       </step>
       <step id="b12jaucr">
        <para>
         Click <guimenu>OK</guimenu> to save and apply your changes.
        </para>
       </step>
       <step id="b12r0it6">
        <para>
         If you are prompted to confirm the settings, click
         <guimenu>Yes</guimenu> to continue, or click <guimenu>No</guimenu>
         to return to the dialog box and make the desired changes.
        </para>
       </step>
      </substeps>
     </step>
     <step id="b12jb97x">
      <para>
       Click <guimenu>Finish</guimenu> to save and apply the iSCSI LIO
       Target service settings.
      </para>
     </step>
    </procedure>
   </sect2>

   <sect2 id="b12jbaln">
    <title>Manually Starting iSCSI LIO Target at the Command Line</title>
    <procedure id="b12gboje">
     <step id="b13n0ujq">
      <para>
       Log in as the &rootuser; user, then launch a
       terminal console.
      </para>
     </step>
     <step id="b13n0ujr">
      <para>
       At the command prompt, enter
      </para>
<screen>
 systemctl start target.service
</screen>
      <para>
       The command returns a message to confirm that the daemon is started,
       or that the daemon is already running.
      </para>
     </step>
    </procedure>
   </sect2>

   <sect2 id="b12jbalo">
    <title>Manually Starting iSCSI LIO Target in &yast;</title>
    <procedure id="b12gblm7">
     <step id="b12gblm8">
      <para>
       Launch &yast; as the &rootuser; user.
      </para>
     </step>
     <step id="b12gblm9">
      <para>
       In the &yast; Control Center, select <guimenu>System</guimenu>, then
       select <guimenu>&ycc_runlevel;</guimenu>.
      </para>
     </step>
     <step id="b12gblma">
      <para>
       In the &yast; &ycc_runlevel; dialog box, select
       <guimenu>target</guimenu> (<guimenu>TCM/ConfigFS and
       LIO-Target</guimenu>) in the list of services.
       <remark>taroth 2014-02-27: FIXME systemd - screenshot
        (commented for now) needs update!</remark>
      </para>
<!--  <informalfigure pgwide="0">
       <mediaobject>
        <imageobject role="fo">
         <imagedata fileref="lio_runlevel_a.png" width="300pt" format="PNG"/>
        </imageobject>
        <imageobject role="html">
         <imagedata fileref="lio_runlevel_a.png" width="300pt" format="PNG"/>
        </imageobject>
       </mediaobject>
      </informalfigure>-->
     </step>
     <step id="b12gbmn5">
      <para>
       If the service is listed as <literal>inactive</literal>, click
       <guimenu>Start/Stop</guimenu> to change this.
      </para>
     </step>
     <step id="b12jbalp">
      <para>
       Click <guimenu>OK</guimenu>.
      </para>
     </step>
    </procedure>
   </sect2>
  </sect1>
  <sect1 id="sect_iscsi_lio_discovery">
   <title>Configuring Authentication for Discovery of iSCSI LIO Targets and Clients</title>

   <para>
    The iSCSI LIO Target Server software supports the PPP-CHAP
    (Point-to-Point Protocol Challenge Handshake Authentication Protocol), a
    three-way authentication method defined in the
    <ulink url="http://www.ietf.org/rfc/rfc1994.txt"><citetitle>Internet
    Engineering Task Force (IETF) RFC 1994</citetitle></ulink>. iSCSI LIO
    Target Server uses this authentication method for the discovery of iSCSI
    LIO targets and clients, not for accessing files on the targets. If you
    do not want to restrict the access to the discovery, use <guimenu>No
    Authentication</guimenu>. The <guimenu>No Authentication</guimenu>
    option is enabled by default. If authentication for discovery is
    enabled, its settings apply to all iSCSI LIO target groups.
   </para>

   <important>
    <para>
     We recommend that you use authentication for target and client
     discovery in production environments.
    </para>
   </important>

   <para>
    If authentication is needed for a more secure configuration, you can use
    incoming authentication, outgoing authentication, or both.
    <guimenu>Incoming Authentication</guimenu> requires an iSCSI initiator
    to prove that it has the permissions to run a discovery on the iSCSI LIO
    target. The initiator must provide the incoming user name and password.
    <guimenu>Outgoing Authentication</guimenu> requires the iSCSI LIO target
    to prove to the initiator that it is the expected target. The iSCSI LIO
    target must provide the outgoing user name and password to the iSCSI
    initiator. The user name and password pair can be different for incoming
    and outgoing discovery.
   </para>

   <para>
    To configure authentication preferences for iSCSI LIO targets:
   </para>

   <procedure id="b12g8sjw">
    <step id="b13n0ujs">
     <para>
      Log in to the iSCSI LIO target server as the
      &rootuser; user, then launch a terminal console.
     </para>
    </step>
    <step id="b13n0ujt">
     <para>
      Ensure that the <filename>/etc/init.d/target</filename> daemon is
      running. At the command prompt, enter
     </para>
<screen>
 systemctl start target.service
</screen>
     <para>
      The command returns a message to confirm that the daemon is started,
      or that the daemon is already running.
     </para>
    </step>
    <step id="b12g8sjx">
     <para>
      Launch &yast; as the &rootuser; user.
     </para>
    </step>
    <step id="b12g8sjy">
     <para>
      In the &yast; Control Center, select <guimenu>Network
      Services</guimenu>, then select <guimenu>iSCSI LIO Target</guimenu>.
     </para>
     <para>
      You can also search for <quote>lio</quote>, then select <guimenu>iSCSI
      LIO Target</guimenu>.
     </para>
     <informalfigure pgwide="0">
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="lio_yast2_a.png" width="250pt" format="PNG"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="lio_yast2_a.png" width="250pt" format="PNG"/>
       </imageobject>
      </mediaobject>
     </informalfigure>
    </step>
    <step id="b12g9s76">
     <para>
      In the iSCSI LIO Target Overview dialog box, select the
      <guimenu>Global</guimenu> tab to configure the authentication
      settings. Authentication settings are disabled by default.
     </para>
     <informalfigure pgwide="0">
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="lio_global_noauth_a.png" width="250pt" format="PNG"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="lio_global_noauth_a.png" width="250pt" format="PNG"/>
       </imageobject>
      </mediaobject>
     </informalfigure>
    </step>
    <step id="b12jco93">
     <para>
      Specify whether to require authentication for iSCSI LIO targets:
     </para>
     <itemizedlist>
      <listitem>
       <formalpara id="b12jcrm7">
        <title>Disable authentication:</title>
        <para>
         (Default) Select the <guimenu>No Authentication</guimenu> check box
         to disable incoming and outgoing authentication for discovery on
         this server. All iSCSI LIO targets on this server can be discovered
         by any iSCSI initiator client on the same network. This server can
         discover any iSCSI initiator client on the same network that does
         not require authentication for discovery. Skip
         <xref linkend="b12r1015" xrefstyle="StepXRef"/> and continue with
         <xref linkend="b12gb2ux" xrefstyle="StepXRef"/>.
        </para>
       </formalpara>
      </listitem>
      <listitem>
       <formalpara id="b12jcrm8">
        <title>Enable authentication:</title>
        <para>
         Deselect the <guimenu>No Authentication</guimenu> check box. The
         check boxes for both <guimenu>Incoming Authentication</guimenu> and
         <guimenu>Outgoing Authentication</guimenu> are automatically
         selected. Continue with
         <xref linkend="b12r1015" xrefstyle="StepXRef"/>.
        </para>
       </formalpara>
       <informalfigure pgwide="0">
        <mediaobject>
         <imageobject role="fo">
          <imagedata fileref="lio_global_in_out_auth_a.png" width="250pt" format="PNG"/>
         </imageobject>
         <imageobject role="html">
          <imagedata fileref="lio_global_in_out_auth_a.png" width="250pt" format="PNG"/>
         </imageobject>
        </mediaobject>
       </informalfigure>
      </listitem>
     </itemizedlist>
    </step>
    <step id="b12r1015">
     <para role="intro">
      Configure the authentication credentials needed for incoming
      discovery, outgoing discovery, or both. The user name and password
      pair can be different for incoming and outgoing discovery.
     </para>
     <substeps>
      <step id="b12jcw2u">
       <para>
        Configure incoming authentication by doing one of the following:
       </para>
       <itemizedlist>
        <listitem>
         <formalpara id="b12r0xyn">
          <title>Disable incoming authentication:</title>
          <para>
           Deselect the <guimenu>Incoming Authentication</guimenu> check
           box. All iSCSI LIO targets on this server can be discovered by
           any iSCSI initiator client on the same network.
          </para>
         </formalpara>
        </listitem>
        <listitem>
         <formalpara id="b12r0xyo">
          <title>Enable incoming authentication:</title>
          <para>
           Select the <guimenu>Incoming Authentication</guimenu> check box,
           then specify an existing user name and password pair to use for
           incoming discovery of iSCSI LIO targets.
          </para>
         </formalpara>
        </listitem>
       </itemizedlist>
      </step>
      <step id="b12jcw2x">
       <para>
        Configure outgoing authentication by doing one of the following:
       </para>
       <itemizedlist>
        <listitem>
         <formalpara id="b12r0xyp">
          <title>Disable outgoing authentication:</title>
          <para>
           Deselect the <guimenu>Outgoing Authentication</guimenu> check
           box. This server can discover any iSCSI initiator client on the
           same network that does not require authentication for discovery.
          </para>
         </formalpara>
        </listitem>
        <listitem>
         <formalpara id="b12r0xyq">
          <title>Enable outgoing authentication:</title>
          <para>
           Select the <guimenu>Outgoing Authentication</guimenu> check box,
           then specify an existing user name and password pair to use for
           outgoing discovery of iSCSI initiator clients.
          </para>
         </formalpara>
        </listitem>
       </itemizedlist>
      </step>
     </substeps>
    </step>
    <step id="b12gb2ux">
     <para>
      Click <guimenu>Finish</guimenu> to save and apply the settings.
     </para>
    </step>
   </procedure>
  </sect1>
  <sect1 id="sect_iscsi_lio_storage">
   <title>Preparing the Storage Space</title>

   <para>
    The iSCSI LIO target configuration exports existing block devices to
    iSCSI initiators. You must prepare the storage space you want to use in
    the target devices by setting up unformatted partitions or devices on
    the server. iSCSI LIO targets can use unformatted partitions with Linux,
    Linux LVM, or Linux RAID file system IDs.
   </para>

   <important>
    <para>
     After you set up a device or partition for use as an iSCSI target, you
     never access it directly via its local path. Do not specify a mount
     point for it when you create it.
    </para>
   </important>

   <itemizedlist role="subtoc">
    <listitem>
     <para>
      <xref linkend="b12jcw6s" xrefstyle="SectTitleOnPage"/>
     </para>
    </listitem>
    <listitem>
     <para>
      <xref linkend="b12jcw75" xrefstyle="SectTitleOnPage"/>
     </para>
    </listitem>
   </itemizedlist>

   <sect2 id="b12jcw6s">
    <title>Partitioning Devices</title>
    <procedure id="b12jcw6t">
     <step id="b12jcw6u">
      <para>
       Launch &yast; as the &rootuser; user.
      </para>
     </step>
     <step id="b12jcw6v">
      <para>
       In &yast;, select
       <guimenu>System</guimenu><guimenu>Partitioner</guimenu>.
      </para>
     </step>
     <step id="b12jcw6w">
      <para>
       Click <guimenu>Yes</guimenu> to continue through the warning about
       using the Partitioner.
      </para>
     </step>
     <step id="b12jcw6x">
      <para>
       At the bottom of the Partitions page, click <guimenu>Add</guimenu> to
       create a partition, but do not format it, and do not mount it.
      </para>
      <substeps>
       <step id="b12o0qiv">
        <para>
         On the Expert Partitioner page, select <guimenu>Hard
         Disks</guimenu>, then select the leaf node name (such as
         <filename>sdc</filename>) of the disk you want to configure.
        </para>
       </step>
       <step id="b12jcw6y">
        <para>
         Select <guimenu>Primary Partition</guimenu>, then click
         <guimenu>Next</guimenu>.
        </para>
       </step>
       <step id="b12jcw6z">
        <para>
         Specify the amount of space to use, then click
         <guimenu>Next</guimenu>.
        </para>
       </step>
       <step id="b12jcw70">
        <para>
         Under <guimenu>Formatting Options</guimenu>, select <guimenu>Do not
         format</guimenu>, then select the file system ID type from the
         drop-down list.
        </para>
        <para>
         iSCSI LIO targets can use unformatted partitions with Linux (0x83),
         Linux LVM (0x8E), or Linux RAID (0xFD) file system IDs.
        </para>
        <informalfigure pgwide="0">
         <mediaobject>
          <imageobject role="fo">
           <imagedata fileref="lio_disk_format_a.png" width="250pt" format="PNG"/>
          </imageobject>
          <imageobject role="html">
           <imagedata fileref="lio_disk_format_a.png" width="250pt" format="PNG"/>
          </imageobject>
         </mediaobject>
        </informalfigure>
       </step>
       <step id="b12jcw71">
        <para>
         Under <guimenu>Mounting Options</guimenu>, select <guimenu>Do not
         mount</guimenu>.
        </para>
       </step>
       <step id="b12jcw72">
        <para>
         Click <guimenu>Finish</guimenu>.
        </para>
       </step>
      </substeps>
     </step>
     <step id="b12jcw73">
      <para>
       Repeat <xref linkend="bj5f9hl" xrefstyle="StepXRef"/> to create an
       unformatted partition for each area that you want to use later as an
       iSCSI LIO target.
      </para>
      <informalfigure pgwide="0">
       <mediaobject>
        <imageobject role="fo">
         <imagedata fileref="lio_disk_format_multi_a.png" width="250pt" format="PNG"/>
        </imageobject>
        <imageobject role="html">
         <imagedata fileref="lio_disk_format_multi_a.png" width="250pt" format="PNG"/>
        </imageobject>
       </mediaobject>
      </informalfigure>
     </step>
     <step id="b12jcw74">
      <para>
       Click <guimenu>Next</guimenu><guimenu>Finish</guimenu> to keep your
       changes, then close &yast;.
      </para>
     </step>
    </procedure>
   </sect2>

   <sect2 id="b12jcw75">
    <title>Partitioning Devices in a Virtual Environment</title>
    <para>
     You can use a virtual machine guest server as a iSCSI LIO Target
     Server. This section describes how to assign partitions to a &xen;
     virtual machine. You can also use other virtual environments that are
     supported by &productname; 11 SP2 or later.
    </para>
    <para>
     In a &xen; virtual environment, you must assign the storage space you
     want to use for the iSCSI LIO target devices to the guest virtual
     machine, then access the space as virtual disks within the guest
     environment. Each virtual disk can be a physical block device, such as
     an entire disk, partition, or volume, or it can be a file-backed disk
     image where the virtual disk is a single image file on a larger
     physical disk on the &xen; host server. For the best performance, create
     each virtual disk from a physical disk or a partition. After you set up
     the virtual disks for the guest virtual machine, start the guest
     server, then configure the new blank virtual disks as iSCSI target
     devices by following the same process as for a physical server.
    </para>
    <para>
     File-backed disk images are created on the &xen; host server, then
     assigned to the &xen; guest server. By default, &xen; stores file-backed
     disk images in the
     <filename>/var/lib/xen/images/<replaceable>vm_name</replaceable></filename>
     directory, where
     <filename><replaceable>vm_name</replaceable></filename> is the name of
     the virtual machine.
    </para>
    <para>
     For example, if you want to create the disk image
     <filename>/var/lib/xen/images/vm_one/xen-0</filename> with a size of 4
     GB, first ensure that the directory is there, then create the image
     itself.
    </para>
    <procedure id="b12jcw76">
     <step id="b12jcw77">
      <para>
       Log in to the host server as the &rootuser; user.
      </para>
     </step>
     <step id="b12jcw78">
      <para>
       At a terminal console prompt, enter the following commands:
      </para>
<screen>
mkdir -p /var/lib/xen/images/vm_one
dd if=/dev/zero of=/var/lib/xen/images/vm_one/xen-0 seek=1M bs=4096 count=1
</screen>
     </step>
     <step id="b12jcw79">
      <para>
       Assign the file system image to the guest virtual machine in the &xen;
       configuration file.
      </para>
     </step>
     <step id="b12jcw7a">
      <para>
       Log in as the &rootuser; user on the guest server,
       then use &yast; to set up the virtual block device by using the process
       in <xref linkend="b12jcw6s" xrefstyle="HeadingOnPage"/>.
      </para>
     </step>
    </procedure>
   </sect2>
  </sect1>
  <sect1 id="sect_iscsi_lio_targetgp">
   <title>Setting Up an iSCSI LIO Target Group</title>

   <para>
    You can use &yast; to configure iSCSI LIO target devices. &yast; uses APIs
    provided by the <command>lio-utils</command> software. iSCSI LIO targets
    can use unformatted partitions with Linux, Linux LVM, or Linux RAID file
    system IDs.
   </para>

   <important>
    <para>
     Before you begin, create the unformatted partitions that you want to
     use as iSCSI LIO targets as described in
     <xref linkend="sect_iscsi_lio_storage" xrefstyle="SectTitleOnPage"/>.
    </para>
   </important>

   <procedure id="b12jbfdv">
    <step id="b13n0uju">
     <para>
      Log in to the iSCSI LIO target server as the
      &rootuser; user, then launch a terminal console.
     </para>
    </step>
    <step id="b13n0ujv">
     <para>
      Ensure that the <filename>/etc/init.d/target</filename> daemon is
      running. At the command prompt, enter
     </para>
<screen>
systemctl start target.service
</screen>
     <para>
      The command returns a message to confirm that the daemon is started,
      or that the daemon is already running.
     </para>
    </step>
    <step id="b12jbfdw">
     <para>
      Launch &yast; as the &rootuser; user.
     </para>
    </step>
    <step id="b12jbfdx">
     <para>
      In the &yast; Control Center, select <guimenu>Network
      Services</guimenu>, then select <guimenu>iSCSI LIO Target</guimenu>.
     </para>
     <para>
      You can also search for <quote>lio</quote>, then select <guimenu>iSCSI
      LIO Target</guimenu>.
     </para>
     <informalfigure pgwide="0">
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="lio_yast2_a.png" width="250pt" format="PNG"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="lio_yast2_a.png" width="250pt" format="PNG"/>
       </imageobject>
      </mediaobject>
     </informalfigure>
    </step>
    <step id="b12jbfdy">
     <para>
      In the iSCSI LIO Target Overview dialog box, select the
      <guimenu>Targets</guimenu> tab to configure the targets.
     </para>
     <informalfigure pgwide="0">
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="lio_targets_a.png" width="250pt" format="PNG"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="lio_targets_a.png" width="250pt" format="PNG"/>
       </imageobject>
      </mediaobject>
     </informalfigure>
    </step>
    <step id="b12jdln1">
     <para role="intro">
      Click <guimenu>Add</guimenu>, then define a new iSCSI LIO target group
      and devices:
     </para>
     <para role="intro">
      The iSCSI LIO Target software automatically completes the
      <guimenu>Target</guimenu>, <guimenu>Identifier</guimenu>,
      <guimenu>Portal Group</guimenu>, <guimenu>IP Address</guimenu>, and
      <guimenu>Port Number</guimenu> fields. <guimenu>Use
      Authentication</guimenu> is selected by default.
     </para>
     <informalfigure pgwide="0">
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="lio_target_add_a.png" width="250pt" format="PNG"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="lio_target_add_a.png" width="250pt" format="PNG"/>
       </imageobject>
      </mediaobject>
     </informalfigure>
     <substeps>
      <step id="b12jdzge">
       <para>
        If you have multiple network interfaces, use the IP address
        drop-down list to select the IP address of the network interface to
        use for this target group.
       </para>
      </step>
      <step id="b12jdzgf">
       <para>
        Select <guimenu>Use Authentication</guimenu> if you want to require
        client authentication for this target group.
       </para>
       <important>
        <para>
         Requiring authentication is recommended in a production
         environment.
        </para>
       </important>
      </step>
      <step id="b12je5o1">
       <para>
        Click <guimenu>Add</guimenu>, browse to select the device or
        partition, specify a name, then click <guimenu>OK</guimenu>.
       </para>
       <para>
        The LUN number is automatically generated, beginning with 0. A name
        is automatically generated if you leave the field empty.
       </para>
       <informalfigure pgwide="0">
        <mediaobject>
         <imageobject role="fo">
          <imagedata fileref="lio_target_addnew_a.png" width="91pt" format="PNG"/>
         </imageobject>
         <imageobject role="html">
          <imagedata fileref="lio_target_addnew_a.png" width="91pt" format="PNG"/>
         </imageobject>
        </mediaobject>
       </informalfigure>
      </step>
      <step id="b12jebk1">
       <para>
        (Optional) Repeat <xref linkend="b12jdzge" xrefstyle="StepXRef"/>
        through <xref linkend="b12je5o1" xrefstyle="StepXRef"/> to add more
        targets to this target group.
       </para>
       <informalfigure pgwide="0">
        <mediaobject>
         <imageobject role="fo">
          <imagedata fileref="lio_target_list_a.png" width="250pt" format="PNG"/>
         </imageobject>
         <imageobject role="html">
          <imagedata fileref="lio_target_list_a.png" width="250pt" format="PNG"/>
         </imageobject>
        </mediaobject>
       </informalfigure>
      </step>
      <step id="b12jeipi">
       <para>
        After all desired targets have been added to the group, click
        <guimenu>Next</guimenu>.
       </para>
      </step>
     </substeps>
    </step>
    <step id="b12jeipj">
     <para>
      On the Modify iSCSI Target Client Setup page, configure information
      for the clients that are permitted to access LUNs in the target group:
     </para>
     <informalfigure pgwide="0">
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="lio_target_client_a.png" width="250pt" format="PNG"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="lio_target_client_a.png" width="250pt" format="PNG"/>
       </imageobject>
      </mediaobject>
     </informalfigure>
     <para>
      After you specify at least one client for the target group, the
      <guimenu>Edit LUN</guimenu>, <guimenu>Edit Auth</guimenu>,
      <guimenu>Delete</guimenu>, and <guimenu>Copy</guimenu> buttons are
      enabled. You can use <guimenu>Add</guimenu> or <guimenu>Copy</guimenu>
      to add more clients for the target group.
     </para>
     <informalfigure pgwide="0">
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="lio_client_options_a.png" width="200pt" format="PNG"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="lio_client_options_a.png" width="200pt" format="PNG"/>
       </imageobject>
      </mediaobject>
     </informalfigure>
     <itemizedlist>
      <listitem>
       <formalpara id="b12mh6xo">
        <title>Add:</title>
        <para>
         Add a new client entry for the selected iSCSI LIO target group.
        </para>
       </formalpara>
      </listitem>
      <listitem>
       <formalpara id="b12mgggu">
        <title>Edit LUN:</title>
        <para>
         Configure which LUNs in the iSCSI LIO target group to map to a
         selected client. You can map each of the allocated targets to a
         preferred client LUN.
        </para>
       </formalpara>
      </listitem>
      <listitem>
       <formalpara id="b12mgggv">
        <title>Edit Auth:</title>
        <para>
         Configure the preferred authentication method for a selected
         client. You can specify no authentication, or you can configure
         incoming authentication, outgoing authentication, or both.
        </para>
       </formalpara>
      </listitem>
      <listitem>
       <formalpara id="b12mgggw">
        <title>Delete:</title>
        <para>
         Remove a selected client entry from the list of clients allocated
         to the target group.
        </para>
       </formalpara>
      </listitem>
      <listitem>
       <formalpara id="b12mgggx">
        <title>Copy:</title>
        <para>
         Add a new client entry with the same LUN mappings and
         authentication settings as a selected client entry. This allows you
         to easily allocate the same shared LUNs, in turn, to each node in a
         cluster.
        </para>
       </formalpara>
      </listitem>
     </itemizedlist>
     <substeps>
      <step id="b12mdr9g">
       <para>
        Click <guimenu>Add</guimenu>, specify the client name, select or
        deselect the <guimenu>Import LUNs from TPG</guimenu> check box, then
        click <guimenu>OK</guimenu> to save the settings.
       </para>
       <informalfigure pgwide="0">
        <mediaobject>
         <imageobject role="fo">
          <imagedata fileref="lio_client1_new_a.png" width="200pt" format="PNG"/>
         </imageobject>
         <imageobject role="html">
          <imagedata fileref="lio_client1_new_a.png" width="200pt" format="PNG"/>
         </imageobject>
        </mediaobject>
       </informalfigure>
      </step>
      <step id="b12mdr9h">
       <para>
        Select a client entry, click <guimenu>Edit LUN</guimenu>, modify the
        LUN mappings to specify which LUNs in the iSCSI LIO target group to
        allocate to the selected client, then click <guimenu>OK</guimenu> to
        save the changes.
       </para>
       <para>
        If the iSCSI LIO target group consists of multiple LUNs, you can
        allocate one or multiple LUNs to the selected client. By default,
        each of the available LUNs in the group are assigned to a Client
        LUN.
       </para>
       <informalfigure pgwide="0">
        <mediaobject>
         <imageobject role="fo">
          <imagedata fileref="lio_client3_edit_lun_a.png" width="107pt" format="PNG"/>
         </imageobject>
         <imageobject role="html">
          <imagedata fileref="lio_client3_edit_lun_a.png" width="107pt" format="PNG"/>
         </imageobject>
        </mediaobject>
       </informalfigure>
       <para>
        To modify the LUN allocation, perform one or more of the following
        actions:
       </para>
       <itemizedlist>
        <listitem>
         <formalpara id="b12mhta3">
          <title>Add:</title>
          <para>
           Click <guimenu>Add</guimenu> to create an new <guimenu>Client
           LUN</guimenu> entry, then use the <guimenu>Change</guimenu>
           drop-down list to map a Target LUN to it.
          </para>
         </formalpara>
         <informalfigure pgwide="0">
          <mediaobject>
           <imageobject role="fo">
            <imagedata fileref="lio_client3_edit_lun4_add_a.png" width="107pt" format="PNG"/>
           </imageobject>
           <imageobject role="html">
            <imagedata fileref="lio_client3_edit_lun4_add_a.png" width="107pt" format="PNG"/>
           </imageobject>
          </mediaobject>
         </informalfigure>
        </listitem>
        <listitem>
         <formalpara id="b12mhta4" role="intro">
          <title>Delete:</title>
          <para>
           Select the <guimenu>Client LUN</guimenu> entry, then click
           <guimenu>Delete</guimenu> to remove a Target LUN mapping.
          </para>
         </formalpara>
         <informalfigure pgwide="0">
          <mediaobject>
           <imageobject role="fo">
            <imagedata fileref="lio_client3_edit_lun3_delete_a.png" width="106pt" format="PNG"/>
           </imageobject>
           <imageobject role="html">
            <imagedata fileref="lio_client3_edit_lun3_delete_a.png" width="106pt" format="PNG"/>
           </imageobject>
          </mediaobject>
         </informalfigure>
        </listitem>
        <listitem>
         <formalpara id="b12mhta5">
          <title>Change:</title>
          <para>
           Select the <guimenu>Client LUN</guimenu> entry, then use the
           <guimenu>Change</guimenu> drop-down list to select which Target
           LUN to map to it.
          </para>
         </formalpara>
         <informalfigure pgwide="0">
          <mediaobject>
           <imageobject role="fo">
            <imagedata fileref="lio_client3_edit_lun2_change_a.png" width="108pt" format="PNG"/>
           </imageobject>
           <imageobject role="html">
            <imagedata fileref="lio_client3_edit_lun2_change_a.png" width="108pt" format="PNG"/>
           </imageobject>
          </mediaobject>
         </informalfigure>
        </listitem>
       </itemizedlist>
       <para>
        Typical allocation plans include the following:
       </para>
       <itemizedlist>
        <listitem>
         <para>
          A single server is listed as a client. All of the LUNs in the
          target group are allocated to it.
         </para>
         <para>
          You can use this grouping strategy to logically group the iSCSI
          SAN storage for a given server.
         </para>
         <informalfigure pgwide="0">
          <mediaobject>
           <imageobject role="fo">
            <imagedata fileref="lio_client5_list_a.png" width="250pt" format="PNG"/>
           </imageobject>
           <imageobject role="html">
            <imagedata fileref="lio_client5_list_a.png" width="250pt" format="PNG"/>
           </imageobject>
          </mediaobject>
         </informalfigure>
        </listitem>
        <listitem>
         <para role="intro">
          Multiple independent servers are listed as clients. One or
          multiple target LUNs are allocated to each server. Each LUN is
          allocated to only one server.
         </para>
         <para>
          You can use this grouping strategy to logically group the iSCSI
          SAN storage for a given department or service category in the data
          center.
         </para>
         <informalfigure pgwide="0">
          <mediaobject>
           <imageobject role="fo">
            <imagedata fileref="lio_client5_list3_a.png" width="250pt" format="PNG"/>
           </imageobject>
           <imageobject role="html">
            <imagedata fileref="lio_client5_list3_a.png" width="250pt" format="PNG"/>
           </imageobject>
          </mediaobject>
         </informalfigure>
        </listitem>
        <listitem>
         <para>
          Each node of a cluster is listed as a client. All of the shared
          target LUNs are allocated to each node. All nodes are attached to
          the devices, but for most file systems, the cluster software locks
          a device for access and mounts it on only one node at a time.
          Shared file systems (such as OCFS2) make it possible for multiple
          nodes to concurrently mount the same file structure and to open
          the same files with read and write access.
         </para>
         <para>
          You can use this grouping strategy to logically group the iSCSI
          SAN storage for a given server cluster.
         </para>
         <informalfigure pgwide="0">
          <mediaobject>
           <imageobject role="fo">
            <imagedata fileref="lio_client5_list2_a.png" width="250pt" format="PNG"/>
           </imageobject>
           <imageobject role="html">
            <imagedata fileref="lio_client5_list2_a.png" width="250pt" format="PNG"/>
           </imageobject>
          </mediaobject>
         </informalfigure>
        </listitem>
       </itemizedlist>
      </step>
      <step id="b12mdr9i">
       <para>
        Select a client entry, click <guimenu>Edit Auth</guimenu>, specify
        the authentication settings for the client, then click
        <guimenu>OK</guimenu> to save the settings.
       </para>
       <para>
        You can require <guimenu>No Authentication</guimenu>, or you can
        configure <guimenu>Incoming Authentication</guimenu>,
        <guimenu>Outgoing Authentication</guimenu>, or both. You can specify
        only one user name and password pair for each client. The
        credentials can be different for incoming and outgoing
        authentication for a client. The credentials can be different for
        each client.
       </para>
       <informalfigure pgwide="0">
        <mediaobject>
         <imageobject role="fo">
          <imagedata fileref="lio_client4_edit_auth2_inout_a.png" width="200pt" format="PNG"/>
         </imageobject>
         <imageobject role="html">
          <imagedata fileref="lio_client4_edit_auth2_inout_a.png" width="200pt" format="PNG"/>
         </imageobject>
        </mediaobject>
       </informalfigure>
      </step>
      <step id="b12mdr9j">
       <para>
        Repeat <xref linkend="b12mdr9g" xrefstyle="StepXRef"/> through
        <xref linkend="b12mdr9i" xrefstyle="StepXRef"/> for each iSCSI
        client that can access this target group.
       </para>
      </step>
      <step id="b12mdr9k">
       <para>
        After the client assignments are configured, click
        <guimenu>Next</guimenu>.
       </para>
      </step>
     </substeps>
    </step>
    <step id="b12jbfdz">
     <para>
      Click <guimenu>Finish</guimenu> to save and apply the settings.
     </para>
     <informalfigure pgwide="0">
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="lio_targets_group_a.png" width="250pt" format="PNG"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="lio_targets_group_a.png" width="250pt" format="PNG"/>
       </imageobject>
      </mediaobject>
     </informalfigure>
    </step>
   </procedure>
  </sect1>
  <sect1 id="sect_iscsi_lio_edit">
   <title>Modifying an iSCSI LIO Target Group</title>

   <para>
    You can modify an existing iSCSI LIO target group as follows:
   </para>

   <itemizedlist>
    <listitem>
     <para>
      Add or remove target LUN devices from a target group
     </para>
    </listitem>
    <listitem>
     <para>
      Add or remove clients for a target group
     </para>
    </listitem>
    <listitem>
     <para>
      Modify the client LUN-to-target LUN mappings for a client of a target
      group
     </para>
    </listitem>
    <listitem>
     <para>
      Modify the user name and password credentials for a client
      authentication (incoming, outgoing, or both)
     </para>
    </listitem>
   </itemizedlist>

   <para>
    To view or modify the settings for an iSCSI LIO target group:
   </para>

   <procedure id="b12o1qa2">
    <step id="b13n0ujw">
     <para>
      Log in to the iSCSI LIO target server as the
      &rootuser; user, then launch a terminal console.
     </para>
    </step>
    <step id="b13n0ujx">
     <para>
      Ensure that the <filename>/etc/init.d/target</filename> daemon is
      running. At the command prompt, enter
     </para>
<screen>
 systemctl start target.service
</screen>
     <para>
      The command returns a message to confirm that the daemon is started,
      or that the daemon is already running.
     </para>
    </step>
    <step id="b12o1qa3">
     <para>
      Launch &yast; as the &rootuser; user.
     </para>
    </step>
    <step id="b12o1qa4">
     <para role="intro">
      In the &yast; Control Center, select <guimenu>Network
      Services</guimenu>, then select <guimenu>iSCSI LIO Target</guimenu>.
     </para>
     <para role="intro">
      You can also search for <quote>lio</quote>, then select <guimenu>iSCSI
      LIO Target</guimenu>.
     </para>
     <informalfigure pgwide="0">
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="lio_yast2_a.png" width="250pt" format="PNG"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="lio_yast2_a.png" width="250pt" format="PNG"/>
       </imageobject>
      </mediaobject>
     </informalfigure>
    </step>
    <step id="b12o1qa5">
     <para role="intro">
      In the iSCSI LIO Target Overview dialog box, select the
      <guimenu>Targets</guimenu> tab to view a list of target groups.
     </para>
     <informalfigure pgwide="0">
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="lio_target_gp_delete_a.png" width="250pt" format="PNG"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="lio_target_gp_delete_a.png" width="250pt" format="PNG"/>
       </imageobject>
      </mediaobject>
     </informalfigure>
    </step>
    <step id="b12o1qa6">
     <para role="intro">
      Select the iSCSI LIO target group to be modified, then click
      <guimenu>Edit</guimenu>.
     </para>
     <informalfigure pgwide="0">
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="lio_target_gp_edit_a.png" width="250pt" format="PNG"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="lio_target_gp_edit_a.png" width="250pt" format="PNG"/>
       </imageobject>
      </mediaobject>
     </informalfigure>
    </step>
    <step id="b12o1qa7">
     <para>
      On the Modify iSCSI Target LUN Setup page, add LUNs to the target
      group, edit the LUN assignments, or remove target LUNs from the group.
      After all desired changes have been made to the group, click
      <guimenu>Next</guimenu>.
     </para>
     <para>
      For option information, see
      <xref linkend="b12jdln1" xrefstyle="StepXRef"/> in
      <xref linkend="sect_iscsi_lio_targetgp" xrefstyle="SectTitleOnPage"/>.
     </para>
    </step>
    <step id="b12o1qad">
     <para>
      On the Modify iSCSI Target Client Setup page, configure information
      for the clients that are permitted to access LUNs in the target group.
      After all desired changes have been made to the group, click
      <guimenu>Next</guimenu>.
     </para>
     <para>
      For option information, see
      <xref linkend="b12jeipj" xrefstyle="StepXRef"/> in
      <xref linkend="sect_iscsi_lio_targetgp" xrefstyle="SectTitleOnPage"/>.
     </para>
    </step>
    <step id="b12o1qar">
     <para>
      Click <guimenu>Finish</guimenu> to save and apply the settings.
     </para>
    </step>
   </procedure>
  </sect1>
  <sect1 id="sect_iscsi_lio_delete">
   <title>Deleting an iSCSI LIO Target Group</title>

   <para>
    Deleting an iSCSI LIO target group removes the definition of the group,
    and the related setup for clients, including LUN mappings and
    authentication credentials. It does not destroy the data on the
    partitions. To give clients access again, you can allocate the target
    LUNs to a different or new target group, and configure the client access
    for them.
   </para>

   <procedure id="b12o1fhc">
    <step id="b13n0ury">
     <para>
      Log in to the iSCSI LIO target server as the
      &rootuser; user, then launch a terminal console.
     </para>
    </step>
    <step id="b13n0urz">
     <para>
      Ensure that the <filename>/etc/init.d/target</filename> daemon is
      running. At the command prompt, enter
     </para>
<screen>
 systemctl start target.service
</screen>
     <para>
      The command returns a message to confirm that the daemon is started,
      or that the daemon is already running.
     </para>
    </step>
    <step id="b12o1fhd">
     <para>
      Launch &yast; as the &rootuser; user.
     </para>
    </step>
    <step id="b12o1fhe">
     <para>
      In the &yast; Control Center, select <guimenu>Network
      Services</guimenu>, then select <guimenu>iSCSI LIO Target</guimenu>.
     </para>
     <para>
      You can also search for <quote>lio</quote>, then select <guimenu>iSCSI
      LIO Target</guimenu>.
     </para>
     <informalfigure pgwide="0">
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="lio_yast2_a.png" width="250pt" format="PNG"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="lio_yast2_a.png" width="250pt" format="PNG"/>
       </imageobject>
      </mediaobject>
     </informalfigure>
    </step>
    <step id="b12o1fhf">
     <para>
      In the iSCSI LIO Target Overview dialog box, select the
      <guimenu>Targets</guimenu> tab to view a list of configured target
      groups.
     </para>
     <informalfigure pgwide="0">
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="lio_target_gp_delete_a.png" width="250pt" format="PNG"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="lio_target_gp_delete_a.png" width="250pt" format="PNG"/>
       </imageobject>
      </mediaobject>
     </informalfigure>
    </step>
    <step id="b12o1fhg">
     <para role="intro">
      Select the iSCSI LIO target group to be deleted, then click
      <guimenu>Delete</guimenu>.
     </para>
     <informalfigure pgwide="0">
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="lio_target_gp_delete_a.png" width="250pt" format="PNG"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="lio_target_gp_delete_a.png" width="250pt" format="PNG"/>
       </imageobject>
      </mediaobject>
     </informalfigure>
    </step>
    <step id="b12o1iuu">
     <para>
      When you are prompted, click <guimenu>Continue</guimenu> to confirm
      the deletion, or click <guimenu>Cancel</guimenu> to cancel it.
     </para>
    </step>
    <step id="b12o1fi0">
     <para>
      Click <guimenu>Finish</guimenu> to save and apply the settings.
     </para>
    </step>
   </procedure>
  </sect1>
  <sect1 id="b13g8i2g">
   <title>Troubleshooting iSCSI LIO Target Server</title>

   <para>
    This section describes some known issues and possible solutions for
    iSCSI LIO Target Server.
   </para>

   <itemizedlist role="subtoc">
    <listitem>
     <para>
      <xref linkend="b13g8i2h" xrefstyle="SectTitleOnPage"/>
     </para>
    </listitem>
    <listitem>
     <para>
      <xref linkend="b13g8r6r" xrefstyle="SectTitleOnPage"/>
     </para>
    </listitem>
   </itemizedlist>

   <sect2 id="b13g8i2h">
    <title>Portal Error When Setting Up Target LUNs</title>
    <para>
     When adding or editing an iSCSI LIO target group, you get an error:
    </para>
<screen>
Problem setting network portal &lt;ip_address&gt;:3260
</screen>
    <para>
     The <filename>/var/log/YasT2/y2log</filename> log file contains the
     following error:
    </para>
<screen>
find: `/sys/kernel/config/target/iscsi': No such file or directory
</screen>
    <para>
     This problem occurs if the iSCSI LIO Target Server software is not
     currently running. To resolve this issue, exit &yast;, manually start
     iSCSI LIO at the command line, then try again.
    </para>
    <procedure id="b13g8i2i">
     <step id="b13g8i2j">
      <para>
       Open a terminal console as the &rootuser; user.
      </para>
     </step>
     <step id="b13g8i2k">
      <para>
       At the command prompt, enter
      </para>
<screen>
systemctl start target.service
</screen>
     </step>
    </procedure>
    <para role="intro">
     You can also enter the following to check if
     <command>configfs</command>, <command>iscsi_target_mod</command>, and
     <command>target_core_mod</command> are loaded. A sample response is
     shown.
    </para>
<screen>
<command>lsmod | grep iscsi</command>

  iscsi_target_mod      295015  0
  target_core_mod       346745  4
  iscsi_target_mod,target_core_pscsi,target_core_iblock,target_core_file
  configfs               35817  3 iscsi_target_mod,target_core_mod
  scsi_mod              231620  16
  iscsi_target_mod,target_core_pscsi,target_core_mod,sg,sr_mod,mptctl,sd_mod,
  scsi_dh_rdac,scsi_dh_emc,scsi_dh_alua,scsi_dh_hp_sw,scsi_dh,libata,mptspi,
  mptscsih,scsi_transport_spi
</screen>
   </sect2>

   <sect2 id="b13g8r6r">
    <title>iSCSI LIO Targets Are Not Visible from Other Computers</title>
    <para>
     If you use a firewall on the target server, you must open the iSCSI
     port that you are using to allow other computers to see the iSCSI LIO
     targets. For information, see
     <xref linkend="b12jaucl" xrefstyle="StepXRef"/> in
     <xref linkend="b12jbbfh" xrefstyle="SectTitleOnPage"/>.
    </para>
   </sect2>
  </sect1>
  <sect1 id="b12iqi8o">
   <title>iSCSI LIO Target Terminology</title>

   <variablelist>
    <varlistentry id="b12iqi8p">
     <term>backstore</term>
     <listitem>
      <para>
       A physical storage object that provides the actual storage underlying
       an iSCSI endpoint.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry id="b12ir33x">
     <term>CDB (command descriptor block</term>
     <listitem>
      <para>
       The standard format for SCSI commands. CDBs are commonly 6, 10, or 12
       bytes long, though they can be 16 bytes or of variable length.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry id="b12iqi8q">
     <term>CHAP (Challenge Handshake Authentication Protocol)</term>
     <listitem>
      <para>
       A point-to-point protocol (PPP) authentication method used to confirm
       the identity of one computer to another. After the Link Control
       Protocol (LCP) connects the two computers, and the CHAP method is
       negotiated, the authenticator sends a random Challenge to the peer.
       The peer issues a cryptographically hashed Response that depends upon
       the Challenge and a secret key. The authenticator verifies the hashed
       Response against its own calculation of the expected hash value, and
       either acknowledges the authentication or terminates the connection.
       CHAP is defined in the <ulink url="http://www.ietf.org">Internet
       Engineering Task Force (IETF)</ulink> RFC 1994.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry id="b12iqi8r">
     <term>CID (connection identifier)</term>
     <listitem>
      <para>
       A 16‐bit number, generated by the initiator, that uniquely
       identifies a connection between two iSCSI devices. This number is
       presented during the login phase.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry id="b12iqi8s">
     <term>endpoint</term>
     <listitem>
      <para>
       The combination of an iSCSI Target Name with an iSCSI TPG (IQN +
       Tag).
      </para>
     </listitem>
    </varlistentry>
    <varlistentry id="b12iqi8t">
     <term>EUI (extended unique identifier)</term>
     <listitem>
      <para>
       A 64‐bit number that uniquely identifies every device in the world.
       The format consists of 24 bits that are unique to a given company,
       and 40 bits assigned by the company to each device it builds.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry id="b12iqi8u">
     <term>initiator</term>
     <listitem>
      <para>
       The originating end of a SCSI session. Typically a controlling device
       such as a computer.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry id="b12iqi8v">
     <term>IPS (Internet Protocol storage)</term>
     <listitem>
      <para>
       The class of protocols or devices that use the IP protocol to move
       data in a storage network. FCIP (Fibre Channel over Internet
       Protocol), iFCP (Internet Fibre Channel Protocol), and iSCSI
       (Internet SCSI) are all examples of IPS protocols.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry id="b12iqi8w">
     <term>IQN (iSCSI qualified name)</term>
     <listitem>
      <para>
       A name format for iSCSI that uniquely identifies every device in the
       world (for example:
       <filename>iqn.5886.com.acme.tapedrive.sn‐a12345678</filename>).
      </para>
     </listitem>
    </varlistentry>
    <varlistentry id="b12iqi8x">
     <term>ISID (initiator session identifier)</term>
     <listitem>
      <para>
       A 48‐bit number, generated by the initiator, that uniquely
       identifies a session between the initiator and the Target. This value
       is created during the login process, and is sent to the target with a
       Login PDU.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry id="b12iqi8y">
     <term>MCS (multiple connections per session)</term>
     <listitem>
      <para>
       A part of the iSCSI specification that allows multiple TCP/IP
       connections between an initiator and a target.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry id="b12iqi8z">
     <term>MPIO (multipath I/O)</term>
     <listitem>
      <para>
       A method by which data can take multiple redundant paths between a
       server and storage.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry id="b12iqu8e">
     <term>network portal</term>
     <listitem>
      <para>
       The combination of an iSCSI Endpoint with an IP address plus a TCP
       (Transmission Control Protocol) port. TCP port 3260 is the port
       number for the iSCSI protocol, as defined by IANA (Internet Assigned
       Numbers Authority).
      </para>
     </listitem>
    </varlistentry>
    <varlistentry id="b12iqu8f">
     <term>SAM (SCSI architectural model)</term>
     <listitem>
      <para>
       A document that describes the behavior of SCSI in general terms,
       allowing for different types of devices communicating over various
       media.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry id="b12iqu8g">
     <term>target</term>
     <listitem>
      <para>
       The receiving end of a SCSI session, typically a device such as a
       disk drive, tape drive, or scanner.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry id="b12iqu8h">
     <term>target group (TG)</term>
     <listitem>
      <para>
       A list of SCSI target ports that are all treated the same when
       creating views. Creating a view can help facilitate LUN (logical unit
       number) mapping. Each view entry specifies a target group, host
       group, and a LUN.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry id="b12ir33y">
     <term>target port</term>
     <listitem>
      <para>
       The combination of an iSCSI endpoint with one or more LUNs.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry id="b12ir33z">
     <term>target port group (TPG)</term>
     <listitem>
      <para>
       A list of IP addresses and TCP port numbers that determines which
       interfaces a specific iSCSI target will listen to.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry id="b12ir340">
     <term>target session identifier (TSID)</term>
     <listitem>
      <para>
       A 16‐bit number, generated by the target, that uniquely identifies
       a session between the initiator and the target. This value is created
       during the login process, and is sent to the initiator with a Login
       Response PDU (protocol data units).
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
  </sect1>
 </chapter>
