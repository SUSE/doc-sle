<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="yast2_sw.xml" version="5.0" xml:id="cha-yast-software">
 <title>安装或去除软件</title>
 <info>
  <abstract>
   <para>
    使用 YaST 的软件管理模块可以搜索要添加或去除的软件组件。YaST 将解析所有依赖项。要安装未随安装媒体提供的软件包，请将软件源添加到您的设置中，让 YaST 管理它们。通过使用更新小程序管理软件更新，以使系统处于最新状态。
   </para>
  </abstract>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:bugtracker/>
   <dm:translation>yes</dm:translation>
  </dm:docmanager>
 </info>
 <para>
  使用 YaST 软件管理器更改系统的软件集合。此 YaST 模块有两种形式：一种是 X Window 的图形变体，另一种是命令行上使用的基于文本的变体。本章介绍图形变体 — 有关基于文本的 YaST 的细节，请参见<xref linkend="cha-yast-text"/>。
 </para>
 <note>
  <title>确认和检查更改</title>
  <para>
   安装、更新或去除软件包时，只有在单击<guimenu>接受</guimenu>或<guimenu>应用</guimenu>之后，才会应用软件管理器中的所有更改。YaST 有一个包含所有操作的列表，允许您在将更改应用于系统前对更改进行检查和修改。
  </para>
 </note>
 <sect1 xml:id="sec-onlineupdate-terms">
  <title>术语定义</title>
  <para>
   要了解如何在 <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> 中安装和去除软件，必须理解以下术语。
  </para>
  <variablelist>
   <varlistentry>
    <term>软件源</term>
    <listitem>
     <para>
      包含软件包和有关这些软件包的更多信息（软件包元数据）的本地或远程目录。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>（软件源）别名/软件源名称</term>
    <listitem>
     <para>
      软件源的简短名称（在 Zypper 中称为<literal>别名</literal>，在 YaST 中称为<guimenu>软件源名称</guimenu>）。该别名可以由用户在添加软件源时选择且必须唯一。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>软件源描述文件</term>
    <listitem>
     <para>
      每个软件源都提供描述软件源内容（软件包名称、版本等）的文件。这些软件源描述文件将下载到 YaST 使用的本地缓存中。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>产品</term>
    <listitem>
     <para>
      表示整个产品，例如 <phrase role="productname"><phrase os="sles">SUSE® Linux Enterprise Server</phrase></phrase>。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>软件集</term>
    <listitem>
     <para>
      软件集是一组专用于某种用途的可安装软件包。例如，<systemitem>Laptop</systemitem> 软件集包含移动计算环境中所需的所有软件包。软件集定义软件包依赖项（比如必需的软件包或推荐的软件包），并预选择了标记为安装的软件包。这可确保在安装此软件集后某种用途所需的最重要的软件包在系统上可用。如有必要，您可以手动选择或取消选择某个软件集中的软件包。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>软件包</term>
    <listitem>
     <para>
      软件包是 <literal>rpm</literal> 格式的压缩文件，包含特定程序的文件。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry xml:id="vle-patch">
    <term>补丁</term>
    <listitem>
     <para>
      补丁由一个或多个软件包组成，可通过增量 RPM 方式应用。它也可能带来尚未安装的软件包的依赖项。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>可解决</term>
    <listitem>
     <para>
      一个用于产品、软件集、软件包或补丁的一般术语。最常见的可解决类型为软件包或补丁。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>增量 RPM</term>
    <listitem>
     <para>
      增量 RPM 仅包含某个软件包的两个已定义版本之间的有区别二进制文件，因此其下载大小最小。安装前，需要在本地计算机上重构建完整 rpm 软件包。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>软件包依赖项</term>
    <listitem>
     <para>
      一些软件包依赖于其他软件包，例如共享库。换句话说，一个软件包可能会<literal>需要</literal>其他的软件包，如果必需的软件包不可用，则无法安装软件包。除了依赖项（软件包要求）必须满足外，某些软件包还<literal>推荐</literal>其他软件包。这些推荐的软件包仅在实际可用时才安装，否则将忽略它们，但是会安装推荐它们的软件包。
     </para>
    </listitem>
   </varlistentry>
  </variablelist>
 </sect1>

 <sect1 xml:id="sec-yast-software-register" os="sles;sled">
  <title>注册已安装的系统</title>
  <para>
   如果您在安装期间跳过了注册，或者想重新注册系统，随时都可以注册系统。使用 YaST 模块<emphasis>产品注册</emphasis>或命令行工具 <command>SUSEConnect</command>。
  </para>
  <sect2 xml:id="sec-yast-software-register-yast">
   <title>使用 YaST 注册</title>
   <para>
    要注册系统，请启动 YaST，并依次切换到<guimenu>软件</guimenu>和<guimenu>产品注册</guimenu>。
   </para>
   <para>
    系统默认会在 SUSE Customer Center 中注册。如果您的组织提供了本地注册服务器，您可以从自动检测到的服务器列表中选择一个服务器，或手动提供 URL。
   </para>
  </sect2>
  <sect2 xml:id="sec-yast-software-register-suseconnect">
   <title>使用 SUSEConnect 注册</title>
   <para>
    要从命令行注册，请使用命令
   </para>
   <screen><prompt>&gt; </prompt><command>sudo</command> <command>SUSEConnect -r <replaceable>REGISTRATION_CODE</replaceable> -e <replaceable>EMAIL_ADDRESS</replaceable></command></screen>
   <para>
    将 <replaceable>REGISTRATION_CODE</replaceable> 替换为与 <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> 副本一同收到的注册码。将 <replaceable>EMAIL_ADDRESS</replaceable> 替换为与您或您的组织管理订阅时所用的 SUSE 帐户关联的电子邮件地址。
   </para>
   <para>
    要使用本地注册服务器注册，还需提供该服务器的 URL：
   </para>
   <screen><prompt>&gt; </prompt><command>sudo</command> <command>SUSEConnect -r <replaceable>REGISTRATION_CODE</replaceable> -e <replaceable>EMAIL_ADDRESS</replaceable> --url "<replaceable>URL</replaceable>"</command></screen>
  </sect2>
 </sect1>
 <sect1 xml:id="sec-yast-software-qt">
  <title>使用 YaST 软件管理器</title>

  <para>
   从<guimenu>YaST 控制中心</guimenu>选择<menuchoice> <guimenu>软件</guimenu> <guimenu>软件管理</guimenu> </menuchoice>可以启动软件管理器。
  </para>

  <informalfigure>
   <mediaobject>
    <textobject role="description">
     <phrase><guimenu>YaST</guimenu> software manager screen</phrase>
    </textobject>
    <imageobject role="fo">
     <imagedata fileref="yast2_sw_manager.png" width="70%"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="yast2_sw_manager.png" width="65%"/>
    </imageobject>
   </mediaobject>
  </informalfigure>

  <sect2 xml:id="sec-yast-software-search">
   <title>搜索软件</title>
   <para>
    YaST 软件管理器可以从所有当前启用的软件源中安装软件包或软件集。它提供了不同的视图和过滤器，帮助更方便地查找要搜索的软件。<guimenu>搜索</guimenu>视图是窗口的默认视图。要更改视图，请单击<guimenu>视图</guimenu>并从下拉框中选择以下项之一。选定视图会在新的选项卡中打开。
   </para>
   <variablelist>
    <title>搜索软件包或软件集的视图</title>
    <varlistentry>
     <term><guimenu>软件集</guimenu></term>
     <listitem>
      <para>
       列出系统上所有可用于安装的软件集。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><guimenu>软件包组</guimenu></term>
     <listitem>
      <para>
       列出所有软件包，按组排序，例如<guimenu>图形</guimenu>、<guimenu>编程</guimenu>或<guimenu>安全性</guimenu>。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><guimenu>语言</guimenu></term>
     <listitem>
      <para>
       一个过滤器，用于列出添加某个新系统语言所需的所有软件包。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><guimenu>安装源</guimenu></term>
     <listitem>
      <para>
       一个过滤器，用于按软件源列出软件包。要选择多个软件源，请按住 <keycap function="control"/> 键的同时单击软件源名称。<quote>伪软件源</quote>
       <guimenu> @System</guimenu> 会列出当前安装的所有软件包。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><guimenu>服务</guimenu></term>
     <listitem>
      <para>
       显示哪些软件包属于特定的模块或扩展。选项一个项（例如 <literal>Basesystem</literal> 或 <literal>High Availability</literal>）可以显示属于此模块或扩展的软件包列表。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><guimenu>搜索</guimenu></term>
     <listitem>
      <para>
       可让您按照特定准则搜索软件包。输入搜索条件并按下 <keycap function="enter"/>。通过指定<guimenu>搜索范围</guimenu>和更改<guimenu>搜索模式</guimenu>来优化搜索。例如，如果您不知道软件包名称，只知道要搜索的应用程序名称，请尝试在搜索过程中包括软件包<guimenu>描述</guimenu>。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><guimenu>安装摘要</guimenu></term>
     <listitem>
      <para>
       如果已选择要安装、更新或去除的软件包，此视图会显示单击<guimenu>接受</guimenu>后将应用于系统的更改。要过滤此视图中具有特定状态的软件包，请激活或停用相应的复选框。要了解状态标志的细节，请按 <keycombo> <keycap function="shift"/> <keycap>F1</keycap>
       </keycombo>。
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
   <tip>
    <title>查找不属于活动软件源的软件包</title>
    <para>
     要列出所有不属于活动安装源的软件包，可以选择<menuchoice> <guimenu>视图</guimenu> <guimenu>安装源</guimenu>
     <guimenu>@System</guimenu> </menuchoice>，然后选择<menuchoice>
     <guimenu>次过滤器</guimenu> <guimenu>未维护的软件包</guimenu></menuchoice>。例如，如果您删除了某个软件源，并想要确保系统上不再安装该软件源中的任何软件包，则此操作就非常有用。
    </para>
   </tip>
   <tip os="sles;sled" xml:id="tip-yast-software-search-online">
    <title>联机搜索软件</title>
    <para>
     联机搜索功能可以搜索所有已注册和未注册模块和扩展的软件包。
    </para>
    <procedure>
     <title>联机搜索软件</title>
     <para>
      要联机搜索软件包，请执行以下步骤：
     </para>
     <step>
      <para>
       单击<menuchoice><guimenu>额外</guimenu>
        <guimenu>联机搜索</guimenu></menuchoice>打开联机搜索窗口。
      </para>
     </step>
     <step>
      <para>
       输入<guimenu>软件包名称</guimenu>，然后按 <keycap function="enter"/> 键或单击<guimenu>搜索</guimenu>。YaST 会连接 SUSE Customer Center 并在表格中显示结果，其中包括每个软件包的模块或扩展。选择某个软件包可查看更多细节。
      </para>
     </step>
     <step>
      <para>
       单击表格中相应的行和<guimenu>切换选择</guimenu>，选择一个或多个要安装的软件包。或者，您也可以双击某一行。如果软件包属于未注册的模块或扩展，YaST 会向您确认是否注册该模块或扩展。
      </para>
     </step>
     <step>
      <para>
       单击<guimenu>下一步</guimenu>，检查更改，然后安装软件包。
      </para>
     </step>
    </procedure>
   </tip>
  </sect2>

  <sect2 xml:id="sec-yast-software-install">
   <title>安装和去除软件包或软件集</title>
   <para>
    一些软件包依赖于其他软件包，例如共享库。另一方面，一些软件包不能与其他软件包在系统上共存。如果可行，YaST 会自动解决这些依赖项或冲突。如果您的选择导致无法自动解决的依赖项冲突，则需要按照<xref linkend="sec-yast-software-dependencies"/>中所述手动解决冲突。
   </para>
   <note>
    <title>软件包的去除</title>
    <para>
     去除软件包时，默认情况下 YaST 仅去除所选的软件包。如果希望 YaST 还去除在去除指定软件包后变为不需要的所有其他软件包，请从主菜单中选择<menuchoice>
     <guimenu>选项</guimenu> <guimenu>删除软件包时清理</guimenu> </menuchoice>。
    </para>
   </note>
   <procedure>
    <step>
     <para>
      按照<xref linkend="sec-yast-software-search"/>中所述搜索软件包。
     </para>
    </step>
    <step>
     <para>
      右窗格中会列出找到的软件包。要安装或删除某个软件包，可以右键单击它并选择<guimenu>安装</guimenu>或<guimenu>删除</guimenu>。如果相关选项不可用，可以检查软件包名称前的符号指示的软件包状态 — 按 <keycombo> <keycap function="shift"/>
      <keycap>F1</keycap> </keycombo> 可获取帮助。
     </para>
     <tip>
      <title>对列出的所有软件包应用操作</title>
      <para>
       要对右窗格中列出的所有软件包应用某项操作，请转到主菜单，并从<menuchoice>
       <guimenu>软件包</guimenu> <guimenu>此列表中的全部内容</guimenu>
       </menuchoice>中选择操作。
      </para>
     </tip>
    </step>
    <step>
     <para>
      要安装某个软件集，可以右键单击软件集名称并选择<guimenu>安装</guimenu>。
     </para>
    </step>
    <step>
     <para>
      无法去除软件集。但可以选择软件集中要去除的软件包，并将它们标记为待去除。
     </para>
    </step>
    <step>
     <para>
      要选择更多的软件包，请重复上述步骤。
     </para>
    </step>
    <step>
     <para>
      在应用您的更改前，可以通过单击<menuchoice> <guimenu>视图</guimenu> <guimenu>安装摘要</guimenu> </menuchoice>对它们进行检查或修改。默认会列出所有将更改状态的软件包。
     </para>
    </step>
    <step>
     <para>
      要还原某个软件包的状态，可以右键单击该软件包并选择以下任一项：<guimenu>保留</guimenu>（如果已安排要删除或更新软件包），或<guimenu>不安装</guimenu>（如果已安排要安装软件包）。要放弃所有更改并退出软件管理器，请单击<guimenu>取消</guimenu>和<guimenu>放弃</guimenu>。
     </para>
    </step>
    <step>
     <para>
      完成后，单击<guimenu>接受</guimenu>应用您的更改。
     </para>
    </step>
    <step>
     <para>
      如果 YaST 发现对其他软件包的依赖项，则会显示已额外选择要安装、更新或去除的软件包的列表。单击<guimenu>继续</guimenu>接受它们。
     </para>
     <para>
      安装、更新或去除所有选定软件包后，YaST 软件管理器会自动关闭。
     </para>
    </step>
   </procedure>
   <note>
    <title>安装源软件包</title>
    <para>
     目前无法通过 YaST 软件管理器安装源软件包。为了实现该目的，可以使用命令行工具 <command>zypper</command>。有关详细信息，请参见<xref linkend="sec-zypper-softman-sources"/>。
    </para>
   </note>
  </sect2>

  <sect2 xml:id="sec-yast-software-update">
   <title>更新软件包</title>
   <para>
    除了更新单个软件包外，还可以从某个软件源更改所有安装的软件包或所有软件包。大批量更新软件包时，通常需要注意以下几个方面：
   </para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>
      提供软件包的软件源的优先级，
     </para>
    </listitem>
    <listitem>
     <para>
      软件包的体系结构（例如 AMD64/Intel 64），
     </para>
    </listitem>
    <listitem>
     <para>
      软件包的版本号，
     </para>
    </listitem>
    <listitem>
     <para>
      软件包的供应商。
     </para>
    </listitem>
   </itemizedlist>
   <para>
    哪个方面对选择更新候选软件包最重要，取决于您选择的相应更新选项。
   </para>
   <procedure>
    <step>
     <para>
      要将所有安装的软件包更新到最新版本，请从主菜单中选择<menuchoice> <guimenu>软件包</guimenu> <guimenu>所有软件包</guimenu>
      <guimenu>如有较新版本可用则更新</guimenu> </menuchoice>。
     </para>
     <para>
      系统会根据以下策略在所有软件源中检查有无可用的更新候选软件包：YaST 会先尝试将搜索范围限制在与已安装软件包的体系结构和供应商相同的软件包。如果找到结果，将根据以下过程选择<quote>最佳</quote>更新候选软件包。但是，如果找不到具有相同供应商的可比较软件包，则将搜索范围扩大到具有相同体系结构的所有软件包。如果还是找不到可比较软件包，将考虑所有软件包，并根据以下准则选择<quote>最佳</quote>更新候选软件包：
     </para>
     <orderedlist spacing="normal">
      <listitem>
       <para>
        软件源优先级：首选优先级最高的软件源中的软件包。
       </para>
      </listitem>
      <listitem>
       <para>
        如果这种选择的结果得出多个软件包，请选择体系结构<quote>最佳</quote>的软件包（最佳选择：与已安装软件包的体系结构匹配）。
       </para>
      </listitem>
     </orderedlist>
     <para>
      如果得到的软件包的版本号比已安装软件包高，将用所选的更新候选软件包更新并替换已安装软件包。
     </para>
     <para>
      此选项会试图避免更改已安装软件包的体系结构和供应商，但在某些情况下，会容许此类更改。
     </para>
     <note>
      <title>无条件更新</title>
      <para>
       如果选择的是<menuchoice> <guimenu>软件包</guimenu> <guimenu>所有软件包</guimenu> <guimenu>无条件更新</guimenu>
       </menuchoice>，则会应用相同的准则，但会无条件安装找到的任何候选软件包。因此，选择此选项实际上会使某些软件包降级。
      </para>
     </note>
    </step>
    <step>
     <para>
      确保用于大批量更新的软件包来自特定安装源：
     </para>
     <substeps performance="required">
      <step>
       <para>
        请按照<xref linkend="sec-yast-software-search"/>中所述选择要从中更新的安装源。
       </para>
      </step>
      <step>
       <para>
        在窗口的右侧，单击<guimenu>将系统软件包切换为此软件源中的版本</guimenu>。此操作明确允许 YaST 在替换软件包时更改软件包供应商。
       </para>
       <para>
        单击<guimenu>接受</guimenu>后，所有已安装的软件包都将替换为来自此软件源的软件包（如果可用）。这样会导致更改供应商和体系结构，甚至会使某些软件包降级。
       </para>
      </step>
      <step>
       <para>
        要避免这种情况，请单击<guimenu>取消将系统软件包切换为此软件源中的版本</guimenu>。请注意，只有在单击<guimenu>接受</guimenu>按钮后才能取消。
       </para>
      </step>
     </substeps>
    </step>
    <step>
     <para>
      在应用您的更改前，可以通过单击<menuchoice> <guimenu>视图</guimenu> <guimenu>安装摘要</guimenu> </menuchoice>对它们进行检查或修改。默认情况下，会列出所有将更改状态的软件包。
     </para>
    </step>
    <step>
     <para>
      如果所有选项都按照您的喜好设置完毕，请单击<guimenu>接受</guimenu>确认您的更改以启动大批量更新。
     </para>
    </step>
   </procedure>
  </sect2>

  <sect2 xml:id="sec-yast-software-dependencies">
   <title>软件包依赖项</title>
   <para>
    大多数软件包都依赖于其他软件包。例如，如果软件包使用了某个共享库，则它依赖于提供该库的软件包。另一方面，一些软件包若共存则会导致冲突（例如，邮件传送代理 sendmail 与 postfix 之中，您只能安装一个）。安装或删除软件时，软件管理器会确保不留下任何未解决的依赖项或冲突，以保证系统完整性。
   </para>
   <para>
    当依赖项或冲突只有一种解决方法时，将会自动解决依赖项或冲突。存在多种解决方法总是会导致需要手动解决的冲突。如果解决冲突涉及到更改供应商或体系结构，则它也需要手动解决。在软件管理器中单击<guimenu>接受</guimenu>应用更改时，会显示由自动解析程序触发的所有操作的概述，需要您确认。
   </para>
   <para>
    默认情况下，会自动检查依赖项。每次更改软件包的状态时（例如，将某个软件包标记为供安装或删除），都会执行检查。通常它很有用，但在手动解决依赖项冲突时会令人厌烦。要禁用此功能，请转到主菜单，然后停用<menuchoice>
    <guimenu>依赖项</guimenu> <guimenu>自动检查</guimenu> </menuchoice>。通过<menuchoice>
    <guimenu>依赖项</guimenu> <guimenu>立即检查</guimenu></menuchoice>手动执行依赖项检查。在单击<guimenu>接受</guimenu>来确认您的选择时，总是会执行一致性检查。
   </para>
   <para>
    要查看软件包的依赖项，可以单击右键并选择<guimenu>显示解析程序信息</guimenu>。此时会打开显示依赖项的图。已安装的软件包显示在绿框中。
   </para>
   <note>
    <title>手动解决软件包冲突</title>
    <para>
     除非很有经验，否则在处理软件包冲突时请遵循 YaST 所做的建议，不然可能无法解决它们。请注意，您所做的每个更改都可能会触发其他冲突，因此最终很容易导致冲突数量不断上升。发生这种情况时，请<guimenu>取消</guimenu>软件管理器，<guimenu>放弃</guimenu>所有更改并重新开始。
    </para>
   </note>
   <figure xml:id="fig-y2-sw-packconfl">
    <title>软件管理器的冲突管理</title>
    <mediaobject>
     <imageobject role="fo">
      <imagedata fileref="yast2_package_conflict.png" width="70%"/>
     </imageobject>
     <imageobject role="html">
      <imagedata fileref="yast2_package_conflict.png" width="65%"/>
     </imageobject>
    </mediaobject>
   </figure>
  </sect2>
  <sect2 xml:id="sec-yast-software-recommendations">
   <title>处理软件包建议</title>
   <para>
    除了具有运行程序所需的硬依赖项（例如特定的库）以外，软件包还可能具有弱依赖项（例如，增加额外的功能或翻译）。这些弱依赖项称为软件包推荐。
   </para>
   <para>
    安装新软件包时，默认情况下仍会安装推荐的软件包。更新现有软件包时，将不会自动安装缺少的推荐软件包。要更改此设置，请在 <filename>/etc/sysconfig/yast2</filename> 中设置 <envar>PKGMGR_RECOMMENDED=&quot;yes&quot;</envar>。要安装已安装软件包的所有缺失推荐组件，请启动 <menuchoice>
    <guimenu>YaST</guimenu> <guimenu>软件管理器</guimenu>
    </menuchoice>，然后选择<menuchoice> <guimenu>额外</guimenu>
    <guimenu>安装所有匹配的推荐软件包</guimenu>
    </menuchoice>。
   </para>
   <para>
    要在安装新软件包时不安装推荐的软件包，请在 YaST 软件管理器中停用<menuchoice> <guimenu>依赖项</guimenu>
    <guimenu>安装推荐的软件包</guimenu> </menuchoice>。如果使用命令行工具 Zypper 来安装软件包，请使用选项 <option>--no-recommends</option>。
   </para>
  </sect2>
 </sect1>
 <xi:include href="yast2_sw_repo.xml"/>
 <xi:include href="updater_gnome.xml"/>
 <xi:include href="updater_gnome_sw.xml"/>
</chapter>
