<?xml version="1.0" encoding="UTF-8"?>
<sect1 xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="zypper.xml" version="5.0" xml:id="sec.zypper">
 <title>使用 Zypper</title>

 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:bugtracker/>
   <dm:translation>yes</dm:translation>
  </dm:docmanager>
 </info>

 <para>
  Zypper 是一个命令行包管理器，用于安装、更新和去除包及管理储存库。这一点对于完成远程软件管理任务或从外壳脚本管理软件尤其有用。
 </para>

 <sect2 xml:id="sec.zypper.usage">
  <title>一般使用</title>
  <para>
   Zypper 的常用语法为：
  </para>
<screen>zypper <option>[--global-options]</option> <replaceable>COMMAND</replaceable> <option> [--command-options]</option> <option>[arguments]</option></screen>

  <para>
   不需要括在括号中的组件。有关常规选项和所有命令的列表，请参见 <command>zypper help</command>。要获取有关特定命令的帮助，请键入 <command>zypper help </command>
   <replaceable>命令</replaceable>。
  </para>
  <variablelist>
   <varlistentry>
    <term>Zypper 命令</term>
    <listitem>
     <para>
      执行 Zypper 最简单的方式是，键入其名称后跟一个命令。例如，要将所有需要的增补程序应用于系统，请使用：
     </para>
<screen>sudo zypper patch</screen>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>全局选项</term>
    <listitem>
     <para>
      此外，您还可以选择使用一个或多个全局选项，只需在命令前面键入它们即可：
     </para>
<screen>sudo zypper --non-interactive patch</screen>
     <para>
      在上面的示例中，选项 <option>--non-interactive</option> 表示在不询问任何问题的情况下运行命令（自动应用默认回答）。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>命令特定的选项</term>
    <listitem>
     <para>
      要使用特定于某个命令的选项，请紧接在该命令后面键入这些选项：
     </para>
<screen>sudo zypper patch --auto-agree-with-licenses</screen>
     <para>
      在上面的示例中，<option>--auto-agree-with-licenses</option> 用于将所有需要的增补程序应用于系统，不要求您确认任何许可条款，而是自动接受许可条款。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>自变量</term>
    <listitem>
     <para>
      某些命令需要一个或多个自变量。例如，使用 <command>install</command> 命令时，需要指定您要<emphasis>安装</emphasis>的一个或多个包：
     </para>
<screen>sudo zypper install mplayer</screen>
     <para>
      某些选项还需要单个自变量。用以下命令可列出所有已知模式：
     </para>
<screen>zypper search -t pattern</screen>
    </listitem>
   </varlistentry>
  </variablelist>
  <para>
   您可以组合上述所有模式。例如，下面的命令在冗长模式下运行时将安装
   <package>aspell-de</package>
   和
   <package>aspell-fr</package>
   包（来自 <literal>factory</literal> 储存库）：
  </para>
<screen>sudo zypper -v install --from factory aspell-de aspell-fr</screen>
  <para>
   <option>--from</option> 选项确保了在从指定储存库请求包时保留所有储存库的启用状态（用于解析任何依赖项）。
  </para>
  <para>
   多数 Zypper 命令都有 <literal>dry-run</literal> 选项，它模拟给定的命令。它可用于测试。
  </para>
<screen>sudo zypper remove --dry-run MozillaFirefox</screen>
  <para>
   Zypper 支持 <option>--userdata <replaceable>字符串</replaceable></option>全局选项。您可以使用此选项指定一个将会写入 Zypper 的日志文件和插件（例如 Btrfs 插件）的字符串。它可以用于标记和标识日志文件中的事务。
  </para>
<screen>sudo zypper --userdata <replaceable>STRING</replaceable> patch</screen>
 </sect2>

 <sect2 xml:id="sec.zypper.softman">
  <title>使用 Zypper 安装和删除软件</title>
  <para>
   要安装或去除包，请使用以下命令：
  </para>
<screen>sudo zypper install <replaceable>PACKAGE_NAME</replaceable>
sudo zypper remove <replaceable>PACKAGE_NAME</replaceable></screen>

  <warning>
   <title>不要去除必需的系统包</title>
   <para>
    不要去除必需的系统包，例如
    <package>glibc</package>
    、
    <package>zypper</package>
    、
    <package>kernel</package>
    。如果去除这些包，系统可能会变得不稳定，或完全停止工作。
   </para>
  </warning>
  <sect3 xml:id="sec.zypper.selectpackage">
   <title>选择要安装或去除的包</title>
   <para>
    可以使用 <command>zypper install</command> 和 <command>zypper remove</command> 命令通过多种方法来找到包。
   </para>
   <variablelist>
    <varlistentry>
     <term>按确切的包名称</term>
     <listitem>
<screen>sudo zypper install MozillaFirefox</screen>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>按确切的包名称和版本号</term>
     <listitem>
<screen>sudo zypper install MozillaFirefox-3.5.3</screen>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>按储存库别名和包名称</term>
     <listitem>
<screen>sudo zypper install mozilla:MozillaFirefox</screen>
      <para>
       其中 <literal>mozilla</literal> 是用于安装的储存库别名。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>使用通配符按包名称</term>
     <listitem>
      <para>
       您可以选择名称以特定字符串开头或结尾的所有包。使用通配符要小心，特别是去除包的时候。以下命令将安装名称以<quote>Moz</quote>开头的所有包：
      </para>
<screen>sudo zypper install 'Moz*'</screen>
      <tip>
       <title>去除所有 <filename>-debuginfo</filename> 包</title>
       <para>
        在调试问题时，您有时需要临时安装大量的 <filename>-debuginfo</filename> 包，以获取有关正在运行的进程的详细信息。在调试会话完成后，如果您需要清理环境，请运行以下命令：
       </para>
<screen>sudo zypper remove '*-debuginfo'</screen>
      </tip>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>按功能</term>
     <listitem>
      <para>
       例如，如果您要安装 Perl 模块但不知道包名称，功能就可以派上用场：
      </para>
<screen>sudo zypper install firefox</screen>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>按功能、硬件体系结构或版本</term>
     <listitem>
      <para>
       可以结合功能指定硬件体系结构和版本：
      </para>
      <itemizedlist>
       <listitem>
        <para>
         所需硬件体系结构的名称需要追加在功能的后面，两者以句点分隔。例如，要指定 AMD64/Intel 64 体系结构（在 Zypper 中命名为 <literal>x86_64</literal>），请使用：
        </para>
<screen>sudo zypper install 'firefox.x86_64'</screen>
       </listitem>
       <listitem>
        <para>
         版本必须追加到字符串的末尾，并且前面必须带有一个运算符：<literal>&lt;</literal>（小于）、<literal>&lt;=</literal>（小于等于）、<literal>=</literal>（等于）、<literal>&gt;=</literal>（大于等于）或 <literal>&gt;</literal>（大于）。
        </para>
<screen>sudo zypper install 'firefox&gt;=3.5.3'</screen>
       </listitem>
       <listitem>
        <para>
         还可以指定硬件体系结构与版本组合要求：
        </para>
<screen>sudo zypper install 'firefox.x86_64&gt;=3.5.3'</screen>
       </listitem>
      </itemizedlist>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>按 RPM 文件的路径</term>
     <listitem>
      <para>
       您还可以指定包的本地或远程路径：
      </para>
<screen>sudo zypper install /tmp/install/MozillaFirefox.rpm
sudo zypper install http://download.opensuse.org/repositories/mozilla/SLE_12/x86_64/MozillaFirefox-45.0.2-1.1.x86_64.rpm</screen>
     </listitem>
    </varlistentry>
   </variablelist>
  </sect3>
  <sect3 xml:id="sec.zypper.combineinstall">
   <title>同时安装和去除包</title>
   <para>
    要同时安装和去除包，请使用 <literal>+/-</literal> 修饰符。要安装
    <package>emacs</package>
    并同时去除
    <package>vim</package>
    ，请使用：
   </para>
<screen>sudo zypper install emacs -vim</screen>
   <para>
    要去除
    <package>emacs</package>
    并同时安装
    <package>vim</package>
    ，请使用：
   </para>
<screen>sudo zypper remove emacs +vim</screen>
   <para>
    为避免 <literal>-</literal> 开头的包名称被解释为命令行选项，要始终把它用作第二个自变量。如果做不到这点，在它之前加上 <literal>--</literal>：
   </para>
<screen>sudo zypper install -emacs +vim       # Wrong
sudo zypper install vim -emacs        # Correct
sudo zypper install -- -emacs +vim    # same as above
sudo zypper remove emacs +vim         # same as above</screen>
  </sect3>
  <sect3 xml:id="sec.zypper.clean">
   <title>清理已去除包的依赖项</title>
   <para>
    如果您想将在指定的包去除后不再需要的所有包（随指定的包）自动去除，请使用 <option>--clean-deps</option> 选项：
   </para>
<screen>sudo zypper rm <replaceable>PACKAGE_NAME</replaceable> --clean-deps</screen>
  </sect3>
  <sect3 xml:id="sec.zypper.script">
   <title>在脚本中使用 Zypper</title>
   <para>
    默认情况下，在安装或删除选定包之前或发生问题时，Zypper 会要求确认。您可以使用 <option>--non-interactive</option> 选项覆盖此行为。必须在实际命令（<command>install</command>、<command>remove</command> 和 <command>patch</command>）的前面指定此选项，如下所示：
   </para>
<screen>sudo zypper <option>--non-interactive</option> install <replaceable>PACKAGE_NAME</replaceable></screen>
   <para>
    该选项允许在脚本和 cron 任务中使用 Zypper。
   </para>
  </sect3>
  <sect3 xml:id="sec.zypper.softman.sources">
   <title>安装或下载源包</title>
   <para>
    如果要安装某包的对应源代码包，请使用:
   </para>
<screen>zypper source-install <replaceable>PACKAGE_NAME</replaceable></screen>
   <para>
    以 <systemitem class="username">root</systemitem> 身份执行时，源包的默认安装位置为 <filename>/usr/src/packages/</filename>；以用户身份运行时，则为 <filename>~/rpmbuild</filename>。可以在本地 <command>rpm</command> 配置中更改这些值。
   </para>
   <para>
    使用此命令还会安装指定包的版本依赖项。如果不想执行此操作，请如下所示添加开关 <literal>-D</literal>。要只安装版本依赖性，请使用 <literal>-d</literal>。
   </para>
<screen>sudo zypper source-install -D <replaceable>PACKAGE_NAME</replaceable> # source package only
sudo zypper source-install -d <replaceable>PACKAGE_NAME</replaceable> # build dependencies only</screen>
   <para>
    当然，只有当储存库列表中启用了含有源包的储存库时，才能这样做（默认添加但不启用它）。请参见<xref linkend="sec.zypper.instrepo"/> 了解有关储存库管理的细节。
   </para>
   <para>
    可使用以下方法来获取储存库中所有源包的列表：
   </para>
<screen>zypper search -t srcpackage</screen>
   <para>
    您也可以将所有已安装软件包的源包下载到本地目录。要下载源包，请使用：
   </para>
<screen>zypper source-download</screen>
   <para>
    默认的下载目录是 <filename>/var/cache/zypper/source-download</filename>。您可以使用 <option>--directory</option> 选项更改下载目录。若只想显示缺失或多余的包而不进行下载或删除任何内容，请使用 <option>--status</option> 选项。要删除多余的源包，请使用 <option>--delete</option> 选项。要禁用删除，请使用 <option>--no-delete</option> 选项。
   </para>
  </sect3>
  <sect3 xml:id="sec.zypper.softman.pluscontent">
   <title>从禁用的储存库安装包</title>
   <para>
    通常，您只能安装或刷新来自启用的储存库的包。<option>--plus-content <replaceable>标记</replaceable></option>选项可帮助您指定要刷新的、要在当前 Zypper 会话期间暂时启用的，以及要在会话完成后禁用的储存库。
   </para>
   <para>
    例如，要启用可以提供其他 <filename>-debuginfo</filename> 或 <filename>-debugsource</filename> 包的储存库，请使用 <option>--plus-content debug</option>。可以多次指定此选项。
   </para>
   <para>
    要暂时启用此类“调试”储存库以安装特定的 <filename>-debuginfo</filename> 包，请按如下所示使用该选项：
   </para>
<screen>sudo zypper --plus-content debug install "debuginfo(build-id)=eb844a5c20c70a59fc693cd1061f851fb7d046f4"</screen>
   <para>
    对于缺少的 debuginfo 包，<command>gdb</command> 将会报告 <literal>build-id</literal> 字符串。
   </para>
  </sect3>
  <sect3 xml:id="sec.zypper.softman.util">
   <title>实用程序</title>
   <para>
    要校验所有依赖性是否仍然满足，并修复缺少的依赖性，请使用：
   </para>
<screen>zypper verify</screen>
   <para>
    除了依赖性必须满足外，某些包还<quote>推荐</quote>其他包。只有在实际可用并可安装时才会安装这些推荐包。如果推荐的包在推荐它们的包已安装（通过添加其他包或硬件）之后才可用，请使用以下命令：
   </para>
<screen>sudo zypper install-new-recommends</screen>
   <para>
    此命令在插入网络摄像头或 Wi-Fi 设备后非常有用。如果可用，它将安装设备驱动程序和相关软件。只有在满足特定硬件依赖性后，才可安装驱动程序和相关软件。
   </para>
  </sect3>
 </sect2>

 <sect2 xml:id="sec.zypper.softup">
  <title>使用 Zypper 更新软件</title>
  <para>
   用 Zypper 更新软件有三种方式：安装包、安装包的新版本或更新整个分发包。最后一种方式可通过 <command>zypper dist-upgrade</command> 来实现。<phrase role="productname"><phrase os="sled">中介绍了如何升级 </phrase></phrase>SUSE Linux Enterprise Desktop<phrase os="sles;sled"><xref linkend="cha.update.sle"/></phrase>。
  </para>
  <sect3 xml:id="sec.zypper.softup.patch">
   <title>安装全部所需的增补程序</title>
   <para>
    要安装所有适用于您系统的正式发布的增补程序，请运行：
   </para>
<screen>sudo zypper patch</screen>
   <para>
    系统将会检查您计算机上配置的储存库中提供的所有增补程序是否与您的安装相关。如果相关（未分为<literal>可选</literal>或<literal>功能</literal>类别），则会立即安装这些增补程序。<phrase os="sles;sled">请注意，正式的更新储存库仅在注册 <phrase role="productname"><phrase os="sled">SUSE Linux Enterprise Desktop</phrase></phrase> 安装后才可用。</phrase>
   </para>
   <para>
    如果即将安装的增补程序所包含的更改要求重引导系统，您会在重引导前收到警告。
   </para>
   <para>
    单纯使用 <command>zypper patch</command> 命令不会应用来自第三方储存库的包。要同时更新第三方储存库，请使用 <literal>with-update</literal> 命令选项，如下所示：
   </para>
<screen>sudo zypper patch --with update</screen>

   <para>
    要额外安装可选增补程序，请使用：
   </para>
<screen>sudo zypper patch --with-optional</screen>
   <remark>
    The structure here is a bit unfortunate: We explain how to use the
    --cve/--bugzilla options in more detail below ("Listing Patches").
    However, the first bit people get is the very brief intro immediately below.
    Not sure whether to replicate all the information from "Listing Patches"
    here.
    - sknorr, 2016-04-25
   </remark>
   <para>
    要安装与特定 Bugzilla 问题相关的所有增补程序，请使用：
   </para>
<screen>sudo zypper patch --bugzilla=<replaceable>NUMBER</replaceable></screen>
   <para>
    要安装与特定 CVE 数据库项相关的所有增补程序，请使用：
   </para>
<screen>sudo zypper patch --cve=<replaceable>NUMBER</replaceable></screen>
   <para>
    例如，要安装 CVE 编号为 <literal>CVE-2010-2713</literal> 的安全增补程序，请执行：
   </para>
<screen>sudo zypper patch --cve=CVE-2010-2713</screen>
   <para>
    如果只想安装影响 Zypper 和包管理本身的增补程序，请使用：
   </para>
<screen>sudo zypper patch --updatestack-only</screen>
   <para>
    请记住，如果您使用了 <literal>updatestack-only</literal> 命令选项，则会丢弃原本也会更新其他储存库的其他命令选项。
   </para>
  </sect3>
  <sect3 xml:id="sec.zypper.softup.listpatch">
   <title>列出增补程序</title>
   <para>
    为了让您确定增补程序是否可用，Zypper 允许您查看以下信息：
   </para>
   <variablelist>
    <varlistentry>
     <term>所需增补程序的数目</term>
     <listitem>
      <para>
       要列出所需增补程序（适用于您的系统但尚未安装的增补程序）的数目，请使用 <command>patch-check</command>：
      </para>
<screen>zypper patch-check
Loading repository data...
Reading installed packages...
5 patches needed (1 security patch)</screen>
      <para>
       可以结合 <option>--updatestack-only</option> 选项使用此命令，以便仅列出影响 Zypper 和包管理本身的增补程序。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>所需增补程序的列表</term>
     <listitem>
      <para>
       要列出全部所需的增补程序（适用于您的系统但尚未安装的增补程序），请使用 <command>list-patches</command>：
      </para>
<screen><?dbsuse-fo font-size="0.70em"?>

<prompt>tux &gt; </prompt>zypper list-patches
Loading repository data...
Reading installed packages...

Repository     | Name        | Version | Category | Status  | Summary
---------------+-------------+---------+----------+---------+---------
SLES12-Updates | SUSE-2014-8 | 1       | security | needed  | openssl: Update for OpenSSL
</screen>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>所有增补程序的列表</term>
     <listitem>
      <para>
       要列出 <phrase role="productname"><phrase os="sled">SUSE Linux Enterprise Desktop</phrase></phrase> 可用的所有增补程序，而不管它们是否已安装或适用于您的安装，请使用 <command>zypper patches</command>。
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
   <para>
    还可以列出并安装与特定问题相关的增补程序。要列出特定的增补程序，请使用带以下选项的 <command>zypper list-patches</command> 命令：
   </para>
   <variablelist>
    <varlistentry>
     <term>按 Bugzilla 问题</term>
     <listitem>
      <para>
       要列出与 Bugzilla 问题相关的全部所需增补程序，请使用 <option>--bugzilla</option> 选项。
      </para>
      <para>
       要列出针对特定 Bug 的增补程序，您也可以指定 Bug 编号：<option>--bugzilla=<replaceable>编号</replaceable></option>。要搜索与多个 Bugzilla 问题相关的增补程序，请在 bug 编号之间添加逗号，例如：
      </para>
<screen>zypper list-patches --bugzilla=972197,956917</screen>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>按 CVE 编号</term>
     <listitem>
      <para>
       要列出与 CVE（公共漏洞和披露）数据库中某个项相关的全部所需增补程序，请使用 <option>--cve</option> 选项。
      </para>
      <para>
       要列出针对特定 CVE 数据库项的增补程序，您也可以指定 CVE 编号：<option>--cve=<replaceable>编号</replaceable></option>。要搜索与多个 CVE 数据库项相关的增补程序，请在 CVE 编号之间添加逗号，例如：
      </para>
<screen>zypper list-patches --bugzilla=CVE-2016-2315,CVE-2016-2324</screen>
     </listitem>
    </varlistentry>
   </variablelist>
   <para>
    要列出所有增补程序而不管是否需要安装它们，请另外使用 <option>--all</option> 选项。例如，要列出指派有 CVE 编号的所有增补程序，请使用：
   </para>
<screen><?dbsuse-fo font-size="0.70em"?>

<prompt>tux &gt; </prompt>zypper list-patches --all --cve
Issue | No.           | Patch             | Category    | Severity  | Status
------+---------------+-------------------+-------------+-----------+----------
cve   | CVE-2015-0287 | SUSE-SLE-Module.. | recommended | moderate  | needed
cve   | CVE-2014-3566 | SUSE-SLE-SERVER.. | recommended | moderate  | not needed
[...]</screen>
  </sect3>
  <sect3 xml:id="sec.zypper.softup.update">
   <title>安装新的包版本</title>
   <para>
    如果某个安装源只包含新包，但未提供增补程序，则 <command>zypper patch</command> 不会产生任何作用。要使用可用的较新版本更新所有已安装的包（同时还要保持系统完整性），请使用︰
   </para>
<screen>sudo zypper update</screen>
   <para>
    要更新个别包，请用更新或安装命令指定包：
   </para>
<screen>sudo zypper update <replaceable>PACKAGE_NAME</replaceable>
sudo zypper install <replaceable>PACKAGE_NAME</replaceable></screen>
   <para>
    可使用此命令来获取所有新的可安装包的列表：
   </para>
<screen>zypper list-updates</screen>
   <para>
    请注意，此命令只会列出符合以下准则的包︰
   </para>
   <itemizedlist>
    <listitem>
     <para>
      与已安装的包拥有相同的供应商，
     </para>
    </listitem>
    <listitem>
     <para>
      由至少与已安装包拥有相同优先级的储存库提供，
     </para>
    </listitem>
    <listitem>
     <para>
      可安装（满足所有依赖性）。
     </para>
    </listitem>
   </itemizedlist>
   <para>
    <emphasis>所有</emphasis>新的可用包（无论是否可安装）的列表可通过以下方式获取：
   </para>
<screen>sudo zypper list-updates --all</screen>
   <para>
    要找出新包无法安装的原因，请使用上面所述的 <command>zypper install</command> 或 <command>zypper update</command> 命令。
   </para>
  </sect3>
  <sect3 xml:id="sec.zypper.softup.orphaned">
   <title>识别孤立的包</title>
   <para>
    每当您从 Zypper 中去除某个储存库或者升级系统时，某些包可能会进入<quote>孤立</quote>状态。这些<emphasis>孤立的</emphasis>包不再属于任何活动储存库。以下命令可以列出这些包：
   </para>
<screen>sudo zypper packages --orphaned</screen>
   <para>
    借助此列表，您可以确定是否仍然需要某个包，或者是否可以安全去除某个包。
   </para>
  </sect3>

 </sect2>

 <sect2 xml:id="sec.zypper.ps">
  <title>识别使用已删除文件的进程和服务</title>
  <para>
   在增补、更新或去除包时，系统上可能有一些正在运行的进程会继续使用更新或去除后已被删除的文件。运行 <command>zypper ps</command> 可以列出使用已删除文件的进程。如果此类进程属于某个已知的服务，则会列出服务名称，方便您重启动该服务。默认情况下，<command>zypper ps</command> 会显示一个表：
  </para>
<screen><?dbsuse-fo font-size="0.70em"
?>

<prompt>tux &gt; </prompt>zypper ps
PID   | PPID | UID | User  | Command      | Service      | Files
------+------+-----+-------+--------------+--------------+-------------------
814   | 1    | 481 | avahi | avahi-daemon | avahi-daemon | /lib64/ld-2.19.s-&gt;
      |      |     |       |              |              | /lib64/libdl-2.1-&gt;
      |      |     |       |              |              | /lib64/libpthrea-&gt;
      |      |     |       |              |              | /lib64/libc-2.19-&gt;
[...]</screen>
  <simplelist>
   <member><emphasis role="bold">PID</emphasis>：进程的 ID</member>
   <member><emphasis role="bold"> PPID</emphasis>：父进程的 ID</member>
   <member><emphasis role="bold"> UID</emphasis>：运行进程的用户的 ID</member>
   <member><emphasis role="bold"> User</emphasis>：运行进程的用户的登录名</member>
   <member><emphasis role="bold"> Command</emphasis>：用于执行进程的命令</member>
   <member><emphasis role="bold"> Service</emphasis>：服务名称（仅当命令与系统服务关联时才显示）</member>
   <member><emphasis role="bold"> Files</emphasis>：已删除文件的列表</member>
  </simplelist>
  <para>
   通过如下方式可控制 <command>zypper ps</command> 的输出格式：
  </para>
  <variablelist>
   <varlistentry>
    <term><command>zypper ps</command><option>-s</option>
    </term>
    <listitem>
     <para>
      创建一份简短表格，其中不会显示已删除的文件。
     </para>
<screen><?dbsuse-fo font-size="0.70em"
?>

<prompt>tux &gt; </prompt>zypper ps -s
PID   | PPID | UID  | User    | Command      | Service
------+------+------+---------+--------------+--------------
814   | 1    | 481  | avahi   | avahi-daemon | avahi-daemon
817   | 1    | 0    | root    | irqbalance   | irqbalance
1567  | 1    | 0    | root    | sshd         | sshd
1761  | 1    | 0    | root    | master       | postfix
1764  | 1761 | 51   | postfix | pickup       | postfix
1765  | 1761 | 51   | postfix | qmgr         | postfix
2031  | 2027 | 1000 | tux     | bash         |</screen>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><command>zypper ps</command><option>-ss</option>
    </term>
    <listitem>
     <para>
      仅显示与系统服务关联的进程。
     </para>
<screen>PID   | PPID | UID  | User    | Command      | Service
------+------+------+---------+--------------+--------------
814   | 1    | 481  | avahi   | avahi-daemon | avahi-daemon
817   | 1    | 0    | root    | irqbalance   | irqbalance
1567  | 1    | 0    | root    | sshd         | sshd
1761  | 1    | 0    | root    | master       | postfix
1764  | 1761 | 51   | postfix | pickup       | postfix
1765  | 1761 | 51   | postfix | qmgr         | postfix</screen>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><command>zypper ps</command><option>-sss</option>
    </term>
    <listitem>
     <para>
      仅显示使用已删除文件的系统服务。
     </para>
<screen>avahi-daemon
irqbalance
postfix
sshd</screen>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><command>zypper ps</command><option>--print "systemctl status %s"</option>
    </term>
    <listitem>
     <para>
      显示用于检索可能需要重启动的服务状态信息的命令。
     </para>
<screen>systemctl status avahi-daemon
systemctl status irqbalance
systemctl status postfix
systemctl status sshd</screen>
    </listitem>
   </varlistentry>
  </variablelist>
  <para>
   有关服务处理的详细信息，请参见<xref linkend="cha.systemd"/>。
  </para>
 </sect2>





 <sect2 xml:id="sec.zypper.instrepo">
  <title>用 Zypper 管理安装源</title>
  <para>
   Zypper 的所有安装或增补程序命令均基于已知安装源列表。要列出系统已知的所有储存库，请使用命令：
  </para>
<screen>zypper repos</screen>
  <para>
   结果将类似于与以下输出：
  </para>
  <example xml:id="ex.zypper.repos">
   <title>Zypper — 已知储存库的列表</title>
<screen><?dbsuse-fo font-size="0.60em"
?>

<prompt>tux &gt; </prompt>zypper repos
# | Alias        | Name          | Enabled | Refresh
--+--------------+---------------+---------+--------
1 | SLEHA-12-GEO | SLEHA-12-GEO  | Yes     | No
2 | SLEHA-12     | SLEHA-12      | Yes     | No
3 | SLES12       | SLES12        | Yes     | No
  </screen>
  </example>
  <para>
   当在各个命令中指定储存库时，可以使用别名、URI 或 <command>zypper repos</command> 命令输出中的储存库编号。储存库别名是用于储存库处理命令中的储存库名称的简短版本。请注意，在修改储存库列表后，储存库编号可能会更改。别名本身不会更改。
  </para>
  <para>
   默认情况下不显示储存库的 URI 或优先级之类的细节。用以下命令可以列出所有细节：
  </para>
<screen>zypper repos -d</screen>
  <sect3 xml:id="sec.zypper.instrepo.add">
   <title>添加安装源</title>
   <para>
    要添加安装源，请运行
   </para>
<screen>sudo zypper addrepo <replaceable>URI</replaceable> <replaceable>ALIAS</replaceable></screen>
   <para>
    <replaceable>URI</replaceable> 可以是因特网储存库、网络资源、目录、CD 或 DVD（有关细节请参见 <link xlink:href="http://en.opensuse.org/openSUSE:Libzypp_URIs"/>）。<replaceable>ALIAS</replaceable> 是储存库的唯一简写标识符。您可以随意选择别名，前提是它必须唯一。如果指定的别名已在使用，Zypper 将发出警告。
   </para>
  </sect3>
  <sect3 xml:id="sec.zypper.instrepo.refresh">
   <title>刷新储存库</title>
   <para>
    <command>zypper</command> 可让您从配置的储存库中提取包的更改。要提取更改，请运行：
   </para>
<screen>sudo zypper refresh</screen>
   <note>
    <title><command>zypper</command> 的默认行为</title>
    <para>
     默认情况下，一些命令会自动执行 <command>refresh</command>，因此您不需要显式运行该命令。
    </para>
   </note>
   <para>
    搭配 <literal>--plus-content</literal> 选项使用 <command>refresh</command>，您还可查看禁用储存库中的更改：
   </para>
<screen>sudo zypper --plus-content refresh</screen>
   <para>
    该选项会提取储存库中的更改，但会使禁用储存库的状态保持不变，即仍为禁用。
   </para>
  </sect3>
  <sect3 xml:id="sec.zypper.instrepo.rm">
   <title>删除储存库</title>
   <para>
    如果要从此列表中删除某个储存库，请将命令 <command>zypper removerepo</command> 和要删除的储存库的别名或编号结合使用。例如，要从<xref linkend="ex.zypper.repos"/>中去除储存库 <literal>SLEHA-12-GEO</literal>，请使用下列命令之一：
   </para>
<screen>sudo zypper removerepo 1
sudo zypper removerepo "SLEHA-12-GEO"</screen>
  </sect3>
  <sect3 xml:id="sec.zypper.instrepo.mofify">
   <title>修改储存库</title>
   <para>
    用 <command>zypper modifyrepo</command> 启用或禁用储存库。您还可以用该命令更改储存库的属性（例如刷新行为、名称或优先级）。以下命令将会启用名为 <literal>updates</literal> 的储存库、打开自动刷新并将其优先级设置为 20：
   </para>
<screen>sudo zypper modifyrepo -er -p 20 'updates'</screen>
   <para>
    修改储存库并不局限于单个储存库 — 您也可以对组执行该操作︰
   </para>
   <simplelist>
    <member><option>-a</option>：所有储存库</member>
    <member><option> -l</option>：本地储存库</member>
    <member><option> -t</option>：远程储存库</member>
    <member><option> -m <replaceable>类型</replaceable></option>：特定类型的储存库（其中<replaceable>类型</replaceable>可以是以下之一：<literal>http</literal>、<literal>https</literal>、<literal>ftp</literal>、<literal>cd</literal>、<literal>dvd</literal>、<literal>dir</literal>、<literal>file</literal>、<literal>cifs</literal>、<literal>smb</literal>、<literal>nfs</literal>、<literal>hd</literal> 和 <literal>iso</literal>）</member>
   </simplelist>
   <para>
    要重命名安装源别名，请使用 <literal>renamerepo</literal> 命令。以下示例将别名从 <literal>Mozilla Firefox</literal> 更改为 <literal>firefox</literal>：
   </para>
<screen>sudo zypper renamerepo 'Mozilla Firefox' firefox</screen>
  </sect3>
 </sect2>

 <sect2 xml:id="sec.zypper.query">
  <title>用 Zypper 查询储存库和包</title>
  <para>
   Zypper 提供各种查询储存库或包的方式。要获取所有可用的产品、模式、包或增补程序的列表，请使用以下命令：
  </para>
<screen>zypper products
zypper patterns
zypper packages
zypper patches</screen>
  <para>
   要查询特定包的所有储存库，请使用 <literal>search</literal>。要获得有关特定包的信息，请使用 <literal>info</literal> 命令。
  </para>
  <sect3 xml:id="zypper.search.usage">
   <title><command>zypper search</command> 用法</title>
   <para>
    <command>zypper search</command> 命令可对包名或（视情况）对包摘要和说明执行搜索。括在 <literal>/</literal> 中的字符串会解译为正则表达式。默认情况下搜索不区分大小写。
   </para>
   <variablelist>
    <varlistentry>
     <term>执行简单搜索来查找包含 <literal>fire</literal> 的包名称
     </term>
     <listitem>
<screen>zypper search "fire"</screen>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>执行简单搜索来查找确切的包 <literal>MozillaFirefox</literal>
     </term>
     <listitem>
<screen>zypper search --match-exact "MozillaFirefox"</screen>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>同时在包描述和摘要中搜索</term>
     <listitem>
<screen>zypper search -d fire</screen>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>仅显示尚未安装的包</term>
     <listitem>
<screen>zypper search -u fire</screen>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>显示包含字符串 <literal>fir</literal> 且该字符串后面不是 <literal>e</literal> 的包
     </term>
     <listitem>
<screen>zypper se "/fir[^e]/"</screen>
     </listitem>
    </varlistentry>
   </variablelist>
  </sect3>
  <sect3 xml:id="zypper.what-provides.usage">
   <title><command>zypper what-provides</command> 用法</title>
   <para>
    要搜索提供特殊功能的包，请使用命令 <literal>what-provides</literal>。例如，如果您想知道哪个包提供 Perl 模块 <literal>SVN::Core</literal>，请使用以下命令：
   </para>
<screen>zypper what-provides 'perl(SVN::Core)'</screen>
   <para>
    <literal>what-provides <replaceable>包名</replaceable></literal>与 <command>rpm -q --whatprovides</command>
    <replaceable> 包名</replaceable>类似，不过 RPM 只能查询 RPM 数据库（即所有已安装的包的数据库）。另一方面，Zypper 将告诉您任意储存库的功能的提供商，而非仅已安装的储存库功能的提供商。
   </para>
  </sect3>
  <sect3 xml:id="zypper.info.usage">
   <title><command>zypper info</command> 用法</title>
   <para>
    要查询个别包，请使用 <command>info</command> 命令，并用完整包名称作为自变量。它会显示包的详细信息。如果包名与储存库中的所有包名都不匹配，该命令会输出非包匹配项的详细信息。如果您请求特定类型（通过使用 <literal>-t</literal> 选项），但该类型不存在，该命令会输出其他可用的匹配项，但不提供详细信息。
   </para>
   <para>
    如果您指定源包，该命令会显示基于该源包构建的二进制包。如果您指定二进制包，该命令会输出用来构建该二进制包的源包。
   </para>
   <para>
    如果还要显示该包必需/推荐的包，则使用选项 <option>--requires</option> 和 <option>--recommends</option>：
   </para>
<screen>zypper info --requires MozillaFirefox</screen>
  </sect3>
 </sect2>

 <sect2 xml:id="sec.zypper.configure">
  <title>配置 Zypper</title>
  <para>
   Zypper 现在随附配置文件，允许您永久更改 Zypper 的行为（系统范围或用户特定）。要进行系统范围更改，请编辑 <filename>/etc/zypp/zypper.conf</filename>。要进行用户特定的更改，请编辑 <filename>~/.zypper.conf</filename>。如果 <filename>~/.zypper.conf</filename> 尚不存在，您可以使用 <filename>/etc/zypp/zypper.conf</filename> 作为模板：将其复制到 <filename>~/.zypper.conf</filename> 并根据您的喜好进行调整。请参见文件中的注释，获取有关可用选项的帮助。
  </para>
 </sect2>

 <sect2 xml:id="sec.zypper.trouble">
  <title>查错</title>
  <para>
   如果您在访问配置的储存库中的包时遇到问题（例如，尽管您知道某个包在某个储存库中，但 Zypper 找不到该包），可使用以下命令刷新储存库：
  </para>
<screen>sudo zypper refresh</screen>
  <para>
   如果不起作用，则尝试
  </para>
<screen>sudo zypper refresh -fdb</screen>
  <para>
   这会强制完全刷新和重构建数据库，包括强制下载原始元数据。
  </para>
 </sect2>

 <sect2 xml:id="sec.zypper.rollback">
  <title>Btrfs 文件系统上的 Zypper 回滚功能</title>
  <para>
   如果根分区上使用的是 Btrfs 文件系统且系统中安装了 <command>snapper</command>，当 Zypper 提交对文件系统所做的更改以创建相应的文件系统快照时，会自动调用 <command>snapper</command>（通过 <command>snapper</command> 安装的脚本）。这些快照可用于还原 Zypper 执行的任何更改。有关详细信息，请参见<xref linkend="cha.snapper"/>。
  </para>
 </sect2>

 <sect2 xml:id="sec.zypper.more">
  <title>更多信息</title>
  <para>
   有关从命令行管理软件的详细信息，请输入 <command>zypper help</command>、<command>zypper help </command>
   <replaceable>命令</replaceable>，或参见 <command>zypper(8)</command> 手册页。有关完整详细的命令参考（包括最重要命令的<literal>备忘单</literal>）以及如何在脚本和应用程序中使用 Zypper 的信息，请参见 <link xlink:href="http://en.opensuse.org/SDB:Zypper_usage"/>。<phrase role="productname"><phrase os="sled">SUSE Linux Enterprise Desktop</phrase></phrase> 最新版本的软件更改列表可在 <link xlink:href="http://en.opensuse.org/openSUSE:Zypper versions"/> 中找到。
  </para>
 </sect2>
</sect1>
