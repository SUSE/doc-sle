<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="net_dns.xml" version="5.0" xml:id="cha-dns">
 <title>網域名稱系統</title>
 <info>
  <abstract>
   <para>
    必須使用 DNS (網域名稱系統) 將網域和主機名稱解析為 IP 位址。例如，藉由這種方式，會給主機名稱 <literal>jupiter</literal> 指定 IP 位址 192.168.2.100。在設定您自己的名稱伺服器前，請參閱<xref linkend="sec-network-nameres"/> 中有關 DNS 的一般資訊。以下組態範例使用預設 DNS 伺服器 - BIND。
   </para>
  </abstract>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:bugtracker/>
   <dm:translation>yes</dm:translation>
  </dm:docmanager>
 </info>

 <sect1 xml:id="sec-dns-basic">
  <title> DNS 詞彙 </title>

  <variablelist>
   <varlistentry>
    <term>區域</term>
    <listitem>
     <para>
      網域名稱空間細分成一個個區域。例如，如果您擁有 <literal>example.com</literal>，您就擁有 <literal>com</literal> 網域的 <literal>example</literal> 區段 (或區域)。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>DNS 伺服器</term>
    <listitem>
     <para>
      DNS 伺服器是為網域維護名稱和 IP 資訊的伺服器。您可以為主要區域設定一部主要 DNS 伺服器，為次要區域設定一部次要伺服器，或者設定一部不含任何區域的次要伺服器以用於快取。
     </para>
     <variablelist>
      <varlistentry>
       <term>主要區域 DNS 伺服器</term>
       <listitem>
        <para>
         主要區域包含網路中的所有主機，DNS 伺服器主要區域會儲存您網域中所有主機的最新記錄。
        </para>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term>次要區域 DNS 伺服器</term>
       <listitem>
        <para>
         次要區域是主要區域的副本。次要區域 DNS 伺服器將透過區域傳輸操作從其主要伺服器獲取區域資料。如果次要區域 DNS 伺服器具有有效 (未過期) 的區域資料，便會可靠地為區域做出回應。如果次要伺服器無法獲取區域資料的新副本，它將停止為區域做出回應。
        </para>
       </listitem>
      </varlistentry>
     </variablelist>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>轉遞者</term>
    <listitem>
     <para>
      轉遞者是當您的 DNS 伺服器無法答覆查詢時，它應該將其傳送至的目標 DNS 伺服器。為了在同一個組態中啟用不同的組態來源，系統使用了 <literal>netconfig</literal> (並請參閱 <command>man 8 netconfig</command>)。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>記錄</term>
    <listitem>
     <para>
      記錄是有關名稱和 IP 位址的資訊。有關支援的記錄及其語法，請參閱 BIND 文件中的說明。一些特殊的記錄如下：
     </para>
     <variablelist>
      <varlistentry>
       <term>NS 記錄</term>
       <listitem>
        <para>
         NS 記錄會告訴名稱伺服器哪些機器負責管理特定網域區域。
        </para>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term>MX 記錄</term>
       <listitem>
        <para>
         MX (郵件交換) 記錄會說明在網際網路上傳送郵件時要聯絡的機器。
        </para>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term>SOA 記錄</term>
       <listitem>
        <para>
         SOA (起始授權) 記錄是區域檔案中的第一筆記錄。SOA 記錄是在使用 DNS 同步化多部電腦之間的資料時使用。
        </para>
       </listitem>
      </varlistentry>
     </variablelist>
    </listitem>
   </varlistentry>
  </variablelist>
 </sect1>

 <sect1 xml:id="sec-dns-install">
  <title>安裝</title>

  <para>
   若要安裝 DNS 伺服器，請啟動 YaST 並選取<menuchoice><guimenu>軟體</guimenu> <guimenu> 軟體管理</guimenu></menuchoice>。選擇<menuchoice><guimenu>檢視</guimenu> <guimenu>模式</guimenu></menuchoice>，然後選取<guimenu>DHCP 和 DNS 伺服器</guimenu>。請確認安裝個別套件，以完成此安裝程序。
  </para>
  <para>
   或者，在指令行中使用以下指令：
  </para>
  <screen><prompt>&gt; </prompt><command>sudo</command> zypper in -t pattern dhcp_dns_server</screen>
 </sect1>

 <sect1 xml:id="sec-dns-yast">
  <title>利用 YaST 進行組態</title>

  <para>
   使用 YaST DNS 模組可以設定區域網路的 DNS 伺服器。當您第一次啟動模組時，一個精靈會啟動，提示您指定有關伺服器管理的一些設定。完成此初步設定，即會產生基本的伺服器組態。使用進階模式可以處理更進階的組態任務，如設定 ACL、記錄、TSIG 金鑰和其他選項。
  </para>

  <sect2 xml:id="sec-dns-yast-wizard">
   <title>精靈組態</title>


   <para>
    精靈包含三個步驟或對話方塊。在對話方塊的適當位置，您可以進入進階組態模式。
   </para>
   <procedure>
    <step>
     <para>



      第一次啟動模組時，會開啟<xref linkend="fig-yast2-dnsinst-forwarders"/>中所示的<guimenu>轉遞者設定</guimenu>對話方塊。<guimenu>本地 DNS 解析規則</guimenu>允許設定以下選項：
     </para>
     <itemizedlist mark="bullet" spacing="normal">
      <listitem>
       <para>
        <guimenu>已停用合併轉遞者</guimenu>

       </para>
      </listitem>
      <listitem>
       <para>
        <guimenu>自動合併</guimenu>

       </para>
      </listitem>
      <listitem>


       <para>
        <guimenu>已啟用合併轉遞者</guimenu>

       </para>
      </listitem>
      <listitem>
       <para>

        <guimenu>自訂組態</guimenu> — 如果已選取<guimenu>自訂組態</guimenu>，則可以指定<guimenu>自訂規則</guimenu>；依預設，在已選取<guimenu>自動合併</guimenu>的情況下，<guimenu>自訂規則</guimenu>將設定為「<literal>自動</literal>」，但是，您可以在此處設定介面名稱，或者從 <literal>STATIC</literal> 與 <literal>STATIC_FALLBACK</literal> 這兩個特殊規則名稱中做出選擇。
       </para>
      </listitem>
     </itemizedlist>

     <para>
      在<guimenu>本地 DNS 解析轉遞者</guimenu>中，指定要使用的服務：<guimenu>使用系統名稱伺服器</guimenu>、<guimenu>此名稱伺服器 (bind)</guimenu>或<guimenu>本地 dnsmasq 伺服器</guimenu>。
     </para>
     <para>
      如需有關所有這些設定的詳細資訊，請參閱 <command>man 8 netconfig</command>。
     </para>
     <figure xml:id="fig-yast2-dnsinst-forwarders">
      <title>DNS 伺服器安裝：轉遞者設定</title>
      <mediaobject>
       <imageobject role="fo">
        <imagedata width="75%" fileref="yast2_dns_wiz_forw.png"/>
       </imageobject>
       <imageobject role="html">
        <imagedata width="75%" fileref="yast2_dns_wiz_forw.png"/>
       </imageobject>
      </mediaobject>
     </figure>
     <para>
      轉遞者是指當您的 DNS 伺服器無法答覆查詢時，將查詢傳送至的目標 DNS 伺服器。請輸入它們的 IP 位址，然後按一下<guimenu>新增</guimenu>。
     </para>
    </step>
    <step>
     <para>
      <guimenu>DNS 區域</guimenu>對話方塊包含數個部分，負責管理區域檔案，如<xref linkend="sec-dns-zonefile"/>所述。對於新區域，請在<guimenu>名稱</guimenu>中提供其名稱。若要新增反向區域，名稱的結尾必須是 <literal>.in-addr.arpa</literal>。最後，選取<guimenu>類型</guimenu> (主要、次要或正向)。請參閱<xref linkend="fig-yast2-dnsinst-zones"/>。按一下<guimenu>編輯</guimenu>可設定現有區域的其他設定值。若要移除區域，按一下<guimenu>刪除</guimenu>。
     </para>
     <figure xml:id="fig-yast2-dnsinst-zones">
      <title>DNS 伺服器安裝：DNS 區域</title>
      <mediaobject>
       <imageobject role="fo">
        <imagedata width="72%" fileref="yast2_dns_wiz_zone.png"/>
       </imageobject>
       <imageobject role="html">
        <imagedata width="75%" fileref="yast2_dns_wiz_zone.png"/>
       </imageobject>
      </mediaobject>
     </figure>
    </step>
    <step>
     <para>
      在最後的對話方塊中，可按一下<guimenu>在防火牆中開啟埠</guimenu>，在防火牆中開啟 DNS 連接埠。然後決定是否在開機時啟動 DNS 伺服器 (<guimenu>開啟</guimenu>或<guimenu>關閉</guimenu>)。您亦可啟用 LDAP 支援。請參閱<xref linkend="fig-yast2-dnsinst-finish"/>。
     </para>
     <figure xml:id="fig-yast2-dnsinst-finish">
      <title>DNS 伺服器安裝：完成精靈</title>
      <mediaobject>
       <imageobject role="fo">
        <imagedata width="72%" fileref="yast2_dns_wiz_finish.png"/>
       </imageobject>
       <imageobject role="html">
        <imagedata width="75%" fileref="yast2_dns_wiz_finish.png"/>
       </imageobject>
      </mediaobject>
     </figure>
    </step>
   </procedure>
  </sect2>

  <sect2 xml:id="sec-dns-yast-expert">
   <title>進階組態</title>
   <para>
    啟動模組後，YaST 會開啟顯示數個組態選項的視窗。完成該視窗可讓 DNS 伺服器組態的基本功能就位運作：
   </para>
   <sect3 xml:id="sec-dns-yast-expert-startup">
    <title>啟動</title>
    <para>
     在<guimenu>啟動</guimenu>下，定義是應在系統開機時啟動 DNS 伺服器還是手動啟動。若要立即啟動 DNS 伺服器，請按一下<guimenu>立即啟動 DNS 伺服器</guimenu>。若要停止 DNS 伺服器，請按一下<guimenu>立即停止 DNS 伺服器</guimenu>。若要儲存目前的設定，請選取<guimenu>立即儲存設定並重新載入 DNS 伺服器</guimenu>。您可以使用<guimenu>在防火牆中開啟埠</guimenu>開啟防火牆中的 DNS 埠，並使用<guimenu>防火牆詳細資訊</guimenu>修改防火牆設定。
    </para>
    <para>
     若選取<guimenu>LDAP 主動支援</guimenu>，區域檔案將由 LDAP 資料庫來管理。DNS 伺服器重新啟動或由系統提示重新載入其組態時，會選用寫入到 LDAP 資料庫的任何區域資料變更。
    </para>
   </sect3>
   <sect3 xml:id="sec-dns-yast-expert-forwarders">
    <title>轉遞者</title>
    <para>
     如果您的本地 DNS 伺服器無法答覆要求，它會嘗試將要求轉遞至<guimenu>轉遞者</guimenu>(若做此設定)。可手動將此轉遞者新增至<guimenu>轉遞者清單</guimenu>。如果轉遞者與撥號連接同樣不是靜態的，則 <guimenu>netconfig</guimenu> 會處理組態。如需 netconfig 的詳細資訊，請參閱 <command>man 8 netconfig</command>。
    </para>
   </sect3>
   <sect3 xml:id="sec-dns-yast-expert-basics">
    <title>基本選項</title>
    <para>
     在此區段中，可設定基本伺服器選項。從<guimenu>選項</guimenu>功能表中，選取所需項目，然後在相應的文字方塊中指定值。選取 <guimenu>新增</guimenu> 以包含新項目。
    </para>

   </sect3>
   <sect3 xml:id="sec-dns-yast-expert-logging">
    <title>記錄</title>
    <para>
     若要設定 DNS 伺服器應記錄的內容和記錄方式，請選取<guimenu>記錄</guimenu>。在<guimenu>記錄類型</guimenu>下，指定 DNS 伺服器應該寫入記錄資料的位置。選取<guimenu>系統記錄</guimenu>來使用泛系統記錄，或選取<guimenu>檔案</guimenu>指定不同的檔案。如果使用後一種方式，還需另行指定名稱、最大檔案大小 (以 MB 為單位) 以及要儲存的記錄檔案版本數。
    </para>
    <para>
     進一步選項可從<guimenu>其他記錄</guimenu>下存取。啟用<guimenu>記錄所有 DNS 查詢</guimenu>會記錄<emphasis>每個</emphasis>查詢，此選項會讓記錄檔變得非常大。所以，除了偵錯用途外，啟用此選項並不是理想的作法。若要記錄 DHCP 與 DNS 伺服器之間在區域更新期間的資料流量，請啟用<guimenu>記錄區域更新</guimenu>。若要記錄從主要伺服器到次要伺服器的區域傳輸期間的資料流量，請啟用<guimenu>記錄區域轉送</guimenu>。請參閱<xref linkend="fig-yast2-dns-logging"/>。
    </para>
    <figure xml:id="fig-yast2-dns-logging">
     <title>DNS 伺服器：記錄</title>
     <mediaobject>
      <imageobject role="fo">
       <imagedata width="75%" fileref="yast2_dns_def_logging.png"/>
      </imageobject>
      <imageobject role="html">
       <imagedata width="75%" fileref="yast2_dns_def_logging.png"/>
      </imageobject>
     </mediaobject>
    </figure>
   </sect3>
   <sect3 xml:id="sec-dns-yast-expert-acls">
    <title>ACL</title>
    <para>
     使用此對話方塊可定義 ACL (存取控制清單) 以強制執行存取限制。在<guimenu>名稱</guimenu>下提供獨特名稱後，在<guimenu>值</guimenu>下指定 IP 位址 (有或沒有網路遮罩)，格式如下：
    </para>
<screen>{ 192.168.1/24; }</screen>
    <para>
     組態檔的語法要求位址以分號結尾，而且放置在大括號之間。
    </para>

   </sect3>
   <sect3 xml:id="sec-dns-yast-expert-tsig">
    <title>TSIG 金鑰</title>
    <para>
     TSIG (交易簽章) 的主要目的是保護 DHCP 與 DNS 伺服器之間的通訊。在<xref linkend="sec-dns-tsig"/>中有所描述。
    </para>
    <para>
     若要產生 TSIG 金鑰，請在標籤為<guimenu>金鑰 ID</guimenu>的欄位中輸入特別的名稱，並指定用來儲存金鑰的檔案 (<guimenu>檔案名稱</guimenu>)。按一下<guimenu>產生</guimenu>確認您的選擇。
    </para>
    <para>
     若要使用之前建立的金鑰，請將<guimenu>金鑰 ID</guimenu>欄位保留空白，並在<guimenu>檔案名稱</guimenu>下選取儲存金鑰的檔案。接著，以 <guimenu>新增</guimenu> 確認您的選項。
    </para>

   </sect3>
   <sect3 xml:id="sec-dns-yast-expert-add-secondary">
    <title>DNS 區域 (新增次要區域)</title>
    <para>
     若要新增次要區域，請選取 <guimenu>DNS 區域</guimenu>，選擇<guimenu>次要</guimenu>區域類型，輸入新區域的名稱，然後按一下<guimenu>新增</guimenu>。
    </para>
    <para>
     在<guimenu>主要 DNS 伺服器 IP</guimenu> 下的<guimenu>區域編輯器</guimenu>子對話方塊中，指定次要伺服器應從中提取資料的主要伺服器。若要限制對伺服器的存取，可以從清單選取其中一個 ACL。

    </para>

   </sect3>
   <sect3 xml:id="sec-dns-yast-expert-add-primary">
    <title>DNS 區域 (新增主要區域)</title>
    <para>
     若要新增主要區域，請選取 <guimenu>DNS 區域</guimenu>，選擇<guimenu>主要</guimenu>區域類型，輸入新區域的名稱，然後按一下<guimenu>新增</guimenu>。新增主要區域時，還需要一個反向區域。例如，如果新增指向子網路 <literal>192.168.1.0/24</literal> 中主機的 <systemitem>example.com</systemitem> 區域，則也應該新增涵蓋該 IP 位址範圍的反向區域。根據定義，該區域應該命名為 <literal>1.168.192.in-addr.arpa</literal>。
    </para>
   </sect3>
   <sect3 xml:id="sec-dns-yast-expert-edit-primary">
    <title>DNS 區域 (編輯主要區域)</title>
    <para>
     若要編輯主要區域，請選取 <guimenu>DNS 區域</guimenu>，從表格中選取主要區域，然後按一下<guimenu>編輯</guimenu>。對話方塊由幾個頁面組成：<guimenu>基本</guimenu> (第一個開啟的頁面)、<guimenu>NS 記錄</guimenu>、<guimenu>MX 記錄</guimenu>、<guimenu>SOA</guimenu> 以及<guimenu>記錄</guimenu>。
    </para>
    <para os="sles;osuse">
     <xref linkend="fig-yast2-dns-ddns"/>中顯示的基本對話方塊用於定義動態 DNS 的設定，以及向用戶端和次要名稱伺服器進行區域傳輸的存取選項。若要允許動態更新區域，請選取<guimenu>允許動態更新</guimenu>及相應的 TSIG 金鑰。更新動作開始前，必須先定義金鑰。若要啟用區域傳輸，請選取對應的 ACL。必須先行定義 ACL。
    </para>
    <para>
     在<guimenu>基本</guimenu>對話方塊中，選擇是否要啟用區域傳輸。使用列出的 ACL 來定義可以下載區域的人員。
    </para>
    <figure xml:id="fig-yast2-dns-ddns" os="sles;osuse">
     <title>DNS 伺服器：區域編輯器 (基本)</title>
     <mediaobject>
      <imageobject role="fo">
       <imagedata width="65%" fileref="yast2_dns_def_ddns.png"/>
      </imageobject>
      <imageobject role="html">
       <imagedata width="65%" fileref="yast2_dns_def_ddns.png"/>
      </imageobject>
     </mediaobject>
    </figure>
    <variablelist>
     <varlistentry>
      <term>區域編輯器 (NS 記錄)</term>
      <listitem>
       <para>
        <guimenu>NS 記錄</guimenu>對話方塊可讓您為指定的區域定義替代名稱伺服器。請確定您自己的名稱伺服器包含於清單中。若要新增記錄，請在<guimenu>要新增的名稱伺服器</guimenu>下輸入其名稱，然後使用<guimenu>新增</guimenu>確認動作。請參閱<xref linkend="fig-yast2-dns-nsrec"/>。
       </para>
       <figure xml:id="fig-yast2-dns-nsrec">
        <title>DNS 伺服器：區域編輯器 (NS 記錄)</title>
        <mediaobject>
         <imageobject role="fo">
          <imagedata width="65%" fileref="yast2_dns_def_nsrec.png"/>
         </imageobject>
         <imageobject role="html">
          <imagedata width="65%" fileref="yast2_dns_def_nsrec.png"/>
         </imageobject>
        </mediaobject>
       </figure>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>區域編輯器 (MX 記錄)</term>
      <listitem>
       <para>
        若要新增目前區域的郵件伺服器到現有清單，請輸入對應的位址及優先順序值。完成後，選取<guimenu>新增</guimenu>確認該動作。請參閱<xref linkend="fig-yast2-dns-mxrec"/>。
       </para>
       <figure xml:id="fig-yast2-dns-mxrec">
        <title>DNS 伺服器：區域編輯器 (MX 記錄)</title>
        <mediaobject>
         <imageobject role="fo">
          <imagedata width="72%" fileref="yast2_dns_def_mxrec.png"/>
         </imageobject>
         <imageobject role="html">
          <imagedata width="75%" fileref="yast2_dns_def_mxrec.png"/>
         </imageobject>
        </mediaobject>
       </figure>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>區域編輯器 (SOA)</term>
      <listitem>
       <para>
        此頁允許您建立 SOA (起始授權) 記錄。如需個別選項的說明，請參閱<xref linkend="ex-welt-zone"/>。<phrase os="sles;osuse">透過 LDAP 管理的動態區域，並不支援變更 SOA 記錄。</phrase>
       </para>
       <figure xml:id="fig-yast2-dns-soa">
        <title>DNS 伺服器：區域編輯器 (SOA)</title>
        <mediaobject>
         <imageobject role="fo">
          <imagedata width="75%" fileref="yast2_dns_def_soa.png"/>
         </imageobject>
         <imageobject role="html">
          <imagedata width="75%" fileref="yast2_dns_def_soa.png"/>
         </imageobject>
        </mediaobject>
       </figure>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>區域編輯器 (記錄)</term>
      <listitem>
       <para>
        此對話方塊可管理名稱解析。在<guimenu>記錄金鑰</guimenu>中，輸入主機名稱，然後選取其類型。<guimenu>A</guimenu>類型表示主項目。此項目的值應為 IP 位址 (IPv4)。請為 IPv6 位址使用<guimenu>AAAA</guimenu>。<guimenu>CNAME</guimenu> 是別名。使用 <guimenu>NS</guimenu> 與 <guimenu>MX</guimenu> 類型，可取得<guimenu>NS 記錄</guimenu>與<guimenu>MX 記錄</guimenu>標籤提供之資訊的詳細或部分擴充記錄。這三個類型都可以解析成現有的 <literal>A</literal> 記錄。<guimenu>PTR</guimenu> 是供反向區域所使用。它的內容與 <literal>A</literal> 記錄相反，例如：
       </para>
<screen>hostname.example.com. IN A 192.168.0.1
1.0.168.192.in-addr.arpa IN PTR hostname.example.com.</screen>
      </listitem>
     </varlistentry>
    </variablelist>
    <sect4 xml:id="sec-dns-yast-expert-edit-primary-rev">
     <title>新增反向區域</title>
     <para>
      若要新增反向區域，請遵循以下程序：
     </para>
     <procedure>
      <step>
       <para>
        啟動 <menuchoice><guimenu>YaST</guimenu><guimenu>DNS 伺服器</guimenu><guimenu>DNS 區域</guimenu></menuchoice>。
       </para>
      </step>
      <step>
       <para>
        如果您尚未新增主要正向區域，請新增並進行<guimenu>編輯</guimenu>。
       </para>
      </step>
      <step>
       <para>
        在<guimenu>記錄</guimenu>索引標籤中，填入相應的<guimenu>記錄金鑰</guimenu>和<guimenu>值</guimenu>，然後使用<guimenu>新增</guimenu>來新增記錄，並使用<guimenu>確定</guimenu>來確認。如果 YaST 告知某個名稱伺服器的記錄不存在，請在 <guimenu>NS 記錄</guimenu>索引標籤中新增該記錄。
       </para>
       <figure>
        <title>新增主要區域記錄</title>
        <mediaobject>
         <imageobject role="fo">
          <imagedata fileref="yast2_dns_revzone1.png" width="70%"/>
         </imageobject>
         <imageobject role="html">
          <imagedata fileref="yast2_dns_revzone1.png" width="70%"/>
         </imageobject>
        </mediaobject>
       </figure>
      </step>
      <step>
       <para>
        回到 <guimenu>DNS 區域</guimenu>視窗，新增一個反向主要區域。
       </para>
       <figure>
        <title>新增反向區域</title>
        <mediaobject>
         <imageobject role="fo">
          <imagedata fileref="yast2_dns_revzone2.png" width="70%"/>
         </imageobject>
         <imageobject role="html">
          <imagedata fileref="yast2_dns_revzone2.png" width="70%"/>
         </imageobject>
        </mediaobject>
       </figure>
      </step>
      <step>
       <para>
        <guimenu>編輯</guimenu>該反向區域，然後在<guimenu>記錄</guimenu>索引標籤中，您可以看到 <guimenu>PTR：反向轉換</guimenu>記錄類型。新增相應的<guimenu>記錄金鑰</guimenu>和<guimenu>值</guimenu>，然後按一下<guimenu>新增</guimenu>並使用<guimenu>確定</guimenu>來確認。
       </para>
       <figure>
        <title>新增反向記錄</title>
        <mediaobject>
         <imageobject role="fo">
          <imagedata fileref="yast2_dns_revzone3.png" width="70%"/>
         </imageobject>
         <imageobject role="html">
          <imagedata fileref="yast2_dns_revzone3.png" width="70%"/>
         </imageobject>
        </mediaobject>
       </figure>
       <para>
        視需要新增名稱伺服器記錄。
       </para>
      </step>
     </procedure>
     <tip>
      <title>編輯反向區域</title>
      <para>
       新增正向區域後，返回到主功能表，然後選取要編輯的反向區域。在<guimenu>基本</guimenu>索引標籤中，啟用<guimenu>自動產生以下區域的記錄</guimenu>核取方塊，然後選取正向區域。這樣，反向區域中會自動更新正向區域的所有變更。
      </para>
     </tip>
    </sect4>
   </sect3>
  </sect2>
 </sect1>
 <sect1 xml:id="sec-dns-bind">
  <title>啟動 BIND 名稱伺服器</title>

  <para>
   在 <phrase role="productname"><phrase os="sles">SUSE® Linux Enterprise Server</phrase></phrase> 系統上，已預先設定名稱伺服器 BIND (<emphasis>Berkeley Internet Name Domain，柏克萊網際網路名稱網域</emphasis>)，因此在安裝後可以立即啟動此名稱伺服器，不會出現任何問題。一般而言，如果您能連接網際網路，並在 <filename>/var/run/netconfig/resolv.conf</filename> 中輸入了 <systemitem class="ipaddress">127.0.0.1</systemitem> 做為 <systemitem class="domainname">localhost</systemitem> 的名稱伺服器位址，則表示您已經有可以運作的名稱解析功能，因而無需知道提供者的 DNS。BIND 透過根名稱伺服器執行名稱解析，顯見處理程序較慢。一般而言，應該在 <systemitem>forwarders</systemitem> 下的組態檔 <filename>/etc/named.conf</filename> 中輸入提供者的 DNS 及其 IP 位址，以確保有效及安全的名稱解析。如果目前此辦法可行，名稱伺服器會當成純粹的「<emphasis>僅快取</emphasis>」名稱伺服器執行。只有在您設定了名稱伺服器自己的區域後，它才會成為真正的 DNS。<filename>/usr/share/doc/packages/bind/config</filename> 中提供了一個簡單範例。
  </para>

  <tip>
   <title>名稱伺服器資訊的自動調整</title>
   <para>
    在某些類型的網際網路連接或網路連接下，名稱伺服器資訊可自動根據目前的情況進行調整。若要實現此目的，請將 <filename>/etc/sysconfig/network/config</filename> 檔案中的 <systemitem>NETCONFIG_DNS_POLICY</systemitem> 變數設定為 <literal>auto</literal>。
   </para>
  </tip>

  <para>
   不過，在相關機構為您指派正式的網域之前，切勿設定網域。即使您有自己的網域而且是由提供者管理，最好也不要使用，否則 BIND 不會轉遞此網域的要求。例如，此網域將無法存取提供者的網頁伺服器。
  </para>

  <para>
   若要啟動名稱伺服器，請以 <systemitem class="username">root</systemitem> 身分輸入指令 <command>systemctl start named</command>。使用 <command>systemctl status named</command> 來檢查 named (在呼叫名稱伺服器程序時) 是否已成功啟動。使用 <command>host</command> 或 <command>dig</command> 程式立即測試本地系統上的名稱伺服器，應該會傳回 <systemitem class="domainname">localhost</systemitem> 做為預設伺服器，位址為 <systemitem class="ipaddress">127.0.0.1</systemitem>。如果沒有傳回所需的結果，<filename>/var/run/netconfig/resolv.conf</filename> 可能包含不正確的名稱伺服器項目，或是檔案不存在。如果是第一次測試，請輸入 <command>host</command> <option>127.0.0.1</option>，這通常都能成功。如果看到錯誤訊息，請使用 <command>systemctl status named</command> 檢查伺服器是否真的在執行。如果該名稱伺服器未啟動或者出現非預期的行為，請檢查 <command>journalctl -e</command> 的輸出。
  </para>



  <para>
   若要使用提供者的名稱伺服器或網路上正在執行的名稱伺服器做為轉遞者，請在 <systemitem>forwarders</systemitem> 下的 <systemitem>options</systemitem> 區段中輸入對應的 IP 位址。<xref linkend="ex-forward"/>中包含的位址只是範例。請根據您自己的設定調整這些項目。
  </para>

  <example xml:id="ex-forward">
   <title>named.conf 中的轉遞選項</title>


<screen>options {
        directory "/var/lib/named";
        forwarders { 10.11.12.13; 10.11.12.14; };
        listen-on { 127.0.0.1; 192.168.1.116; };
        allow-query { 127/8; 192.168/16 };
        notify no;
};</screen>
  </example>

  <para>
   <systemitem>options</systemitem> 項目後面跟著區域的項目：<systemitem class="domainname">localhost</systemitem> 和 <systemitem>0.0.127.in-addr.arpa</systemitem>。<quote>&#x002E;</quote> 下的 <literal>type hint</literal> 項目應該永遠存在。對應的檔案無需修改，而且應該依其原狀運作。另外也請確定每個項目的末尾都有<quote>;</quote>，且大括號在正確的位置。變更組態檔 <filename>/etc/named.conf</filename> 或區域檔後，可使用 <command>systemctl reload named</command> 告知 BIND 重新讀取這些檔案。使用 <command>systemctl restart named</command> 停止並重新啟動名稱伺服器可達成相同的效果。任何時候都可透過輸入 <command>systemctl stop named</command> 來停止伺服器。
  </para>
 </sect1>
 <sect1 xml:id="sec-dns-named">
  <title>/etc/named.conf 組態檔案</title>

  <para>
   BIND 名稱伺服器本身的所有設定都儲存於檔案 <filename>/etc/named.conf</filename> 中。不過，要處理之網域的區域資料 (包括主機名稱、IP 位址等) 儲存於 <filename>/var/lib/named</filename> 目錄中各自的檔案中。詳細資訊會在稍後說明 。
  </para>

  <para>
   <filename>/etc/named.conf</filename> 粗略分為兩個部分。其中一個是一般設定的 <systemitem>options</systemitem> 區段，另一個則是由個別網域的 <systemitem>zone</systemitem> 項目組成。<systemitem>logging</systemitem> 區段和 <systemitem>acl</systemitem> (存取控制清單) 項目是選擇性的。註解行的開頭是 <literal>#</literal> 符號或 <literal>//</literal>。在<xref linkend="ex-named-mini"/> 中顯示了最基本的 <filename>/etc/named.conf</filename>。
  </para>

  <example xml:id="ex-named-mini">
   <title>基本的 /etc/named.conf</title>
<screen>options {
        directory "/var/lib/named";
        forwarders { 10.0.0.1; };
        notify no;
};

zone "localhost" in {
       type master;
       file "localhost.zone";
};

zone "0.0.127.in-addr.arpa" in {
        type master;
        file "127.0.0.zone";
};

zone "." in {
        type hint;
        file "root.hint";
};</screen>
  </example>

  <sect2 xml:id="sec-dns-named-options">
   <title>重要的組態選項</title>
   <variablelist>
    <varlistentry>
     <term>directory &quot;<replaceable>FILENAME</replaceable>&quot;;</term>
     <listitem>
      <para>
       指定 BIND 可以在其中找尋包含區域資料之檔案的目錄。通常是 <filename>/var/lib/named</filename>。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>forwarders { <replaceable>IP-ADDRESS</replaceable>; };</term>
     <listitem>
      <para>
       指定無法直接解析 DNS 要求時應該將其轉遞至哪個名稱伺服器 (一般屬於提供者)。以 IP 位址 (例如 <literal>192.168.1.116</literal>) 取代 <replaceable>IP-ADDRESS</replaceable>。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>forward first;</term>
     <listitem>
      <para>
       將會在嘗試透過根名稱伺服器解析 DNS 要求之前先加以轉遞。可以寫入 <systemitem>forward only</systemitem> 來取代 <systemitem>forward
       first</systemitem>，以確保轉遞所有要求，並且不會有任何要求傳送到根名稱伺服器。這對於防火牆組態是可以理解的。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>listen-on port 53 { 127.0.0.1; <replaceable>IP-ADDRESS</replaceable>; };</term>
     <listitem>
      <para>
       告知 BIND 在哪個網路介面和連接埠上接受用戶端查詢。不需要明確指定<literal>連接埠 53</literal>，因為 <literal>53</literal> 為預設連接埠。輸入 <literal>127.0.0.1</literal> 將允許來自本地主機的要求。如果完全省略此項目，預設會使用所有介面。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>listen-on-v6 port 53 {any; };</term>
     <listitem>
      <para>
       告訴 BIND 哪個連接埠應該監聽 IPv6 用戶端要求。除了 <literal>any</literal> 外只能使用 <literal>none</literal>。就 IPv6 而言，伺服器僅接受萬用字元位址。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>query-source address * port 53;</term>
     <listitem>
      <para>
       如果防火牆封鎖 DNS 要求外送，則需要這個項目。這樣會告訴 BIND 從外部的連接埠 53 張貼要求，而不是從任何高於 1024 的連接埠張貼。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>query-source-v6 address * port 53;</term>
     <listitem>
      <para>
       告訴 BIND 哪個連接埠用於 IPv6 查詢。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>allow-query { 127.0.0.1; <replaceable>NET</replaceable>; };</term>
     <listitem>
      <para>
       定義用戶端可以張貼 DNS 要求的網路。以位址資訊 (例如 <literal>192.168.2.0/24</literal>) 取代 <replaceable>NET</replaceable>。末尾的 <systemitem>/24</systemitem> 是網路遮罩的縮寫表示 (在本例中為 <systemitem class="netmask">255.255.255.0</systemitem>)。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>allow-transfer ! *;;</term>
     <listitem>
      <para>
       控制哪些主機可以要求區域傳輸。在該範例中，使用 <systemitem>! *</systemitem> 完全拒絕這類要求。如果沒有這個項目，就可以從任一處要求區域傳輸，沒有限制。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>statistics-interval 0;</term>
     <listitem>
      <para>
       如果沒有這個項目，BIND 每小時都會在系統的日誌中產生數行統計資訊。指定 0 則完全不會顯示這些統計數字，或設定以分鐘為單位的間隔時間。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>cleaning-interval 720;</term>
     <listitem>
      <para>
       此選項定義 BIND 清除其快取記憶體的時間間隔。每次清除時觸發系統日誌中一個項目。時間規格單位為分鐘。預設值是 60 分鐘。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>interface-interval 0;</term>
     <listitem>
      <para>
       BIND 會定期搜尋網路介面，尋找新的或不存在的介面。如果此值設定為 <systemitem>0</systemitem>，就不會執行這個動作，且 BIND 僅會監聽啟動時偵測到的介面。如果不想出現這種情況，請以分鐘為單位定義間隔時間。預設值是 60 分鐘。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>notify no;</term>
     <listitem>
      <para>
       當變更區域資料或重新啟動名稱伺服器時，<option>no</option> 會防止通知其他名稱伺服器。
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
   <para>
    如需可用選項的清單，請參閱 <command>man 5 named.conf</command> 的手冊頁。
   </para>
  </sect2>

  <sect2 xml:id="sec-dns-named-log">
   <title>記錄</title>
   <para>
    記錄的內容、方式及位置皆可在 BIND 中詳細設定。通常預設值已經足夠了。<xref linkend="ex-no-log"/>顯示了此類項目最簡單的形式，會徹底隱藏所有記錄。
   </para>
   <example xml:id="ex-no-log">
    <title>停用記錄的項目</title>
<screen>logging {
        category default { null; };
};</screen>
   </example>
  </sect2>

  <sect2 xml:id="sec-dns-named-zones">
   <title>區域項目</title>
   <example xml:id="ex-meine-domain">
    <title>example.com 的區域項目</title>
<screen>zone "example.com" in {
      type master;
      file "example.com.zone";
      notify no;
};</screen>
   </example>
   <para>
    在 <systemitem>zone</systemitem> 之後，指定要管理的網域名稱 (<systemitem class="domainname">example.com</systemitem>)，後面跟上 <systemitem>in</systemitem> 以及大括號括住的相關選項區塊，如<xref linkend="ex-meine-domain"/> 中所示。若要定義<emphasis>次要區域</emphasis>，請將 <systemitem>type</systemitem> 切換為 <literal>secondary</literal>，並將管理此區域的名稱伺服器指定為 <literal>primary</literal> (它可能是另一個主要伺服器的次要伺服器)，如<xref linkend="ex-andere-domain"/>所示。
   </para>
   <example xml:id="ex-andere-domain">
    <title>example.net 的區域項目</title>
<screen>zone "example.net" in {
      type secondary;
      file "secondary/example.net.zone";
      
      masters { 10.0.0.1; }; 
};</screen>
   </example>
   <para>
    區域選項：
   </para>
   <variablelist>
    <varlistentry>
     <term>type primary;</term>
     <listitem>
      <para>
       透過指定 <literal>primary</literal>，指示 BIND 由本地名稱伺服器處理區域。這假設區域檔案已經以正確格式建立。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>type secondary;</term>
     <listitem>
      <para>
       此區域傳輸自另一部名稱伺服器。必須與 <systemitem>primary_servers</systemitem> 一起使用。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>type hint;</term>
     <listitem>
      <para>
       <literal>hint</literal> 類型的區域 <literal>&#x002E;</literal> 用於設定根名稱伺服器。此區域定義可以維持原狀。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>file <filename>example.com.zone</filename> 或 file <quote>secondary/example.net.zone</quote>;</term>
     <listitem>
      <para>
       此項目可指定網域之區域資料所在的檔案。次要伺服器不需要此檔案，因為會從另一部名稱伺服器提取這些資料。為了區分主要伺服器和次要伺服器的檔案，請使用目錄 <filename>secondary</filename> 存放次要檔案。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>primary_servers { <replaceable>SERVER_IP_ADDRESS</replaceable>; };</term>
     <listitem>
      <para>
       只有次要區域需要此項目。它指定應該傳輸區域檔案的名稱伺服器。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>allow-update {! *; };</term>
     <listitem>
      <para>
       此選項控制外部寫入存取，將允許用戶端產生 DNS 項目，通常由於安全性的緣故不需要此項目。如果沒有此項目，將禁止區域更新。以下項目會產生相同的結果，因為 <literal>! *</literal> 可有效地禁止任何這類活動。
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
  </sect2>
 </sect1>
 <sect1 xml:id="sec-dns-zonefile">
  <title>區域檔案</title>

  <para>
   需要兩種類型的區域檔案。一個會給主機名稱指定 IP 位址，另一個的作用恰恰相反：為 IP 位址提供主機名稱。
  </para>

  <tip>
   <title>在區域檔案中使用點 (英文句點)</title>
   <para>
    「<literal>&#x002E;</literal>」在區域檔案中具有重要意義。如果指定的主機名稱末尾不含點 (<literal>&#x002E;</literal>)，系統會附加區域。指定的完整主機名稱 (包含完整網域名稱) 必須以點 (<literal>&#x002E;</literal>) 結尾，以免再次新增網域至主機名稱。「.」遺失或放錯位置可能是導致名稱伺服器組態錯誤的最常見的原因。
   </para>
  </tip>



  <para>
   第一個要考慮的情況是負責網域 <filename>example.com</filename> 的區域檔案 <filename>example.com.zone</filename>，如<xref linkend="ex-welt-zone"/>中所示。
  </para>

  <example xml:id="ex-welt-zone">
   <title>/var/lib/named/example.com.zone 檔案</title>
   <screen>$TTL 2D <co xml:id="welt-zone-ttl"/>
example.com. IN SOA      dns  root.example.com. ( <co xml:id="welt-zone-soa-start"/>
             2003072441  ; serial <co xml:id="welt-zone-serial-no"/>
             1D          ; refresh <co xml:id="welt-zone-refresh"/>
             2H          ; retry <co xml:id="welt-zone-retry"/>
             1W          ; expiry <co xml:id="welt-zone-expire"/>
             2D )        ; minimum <co xml:id="welt-zone-caching-time"/>

             IN NS       dns <co xml:id="welt-zone-inns"/>
             IN MX       10 mail dns <co xml:id="welt-zone-mx"/>
gate         IN A        192.168.5.1 <co xml:id="welt-zone-ips"/>
             IN A        10.0.0.1
dns          IN A        192.168.1.116
mail         IN A        192.168.3.108
jupiter      IN A        192.168.2.100
venus        IN A        192.168.2.101
saturn       IN A        192.168.2.102
mercury      IN A        192.168.2.103
ntp          IN CNAME    dns <co xml:id="welt-zone-ntp"/>
dns6         IN A6  0    2002:c0a8:174::</screen>

  </example>

  <calloutlist>
   <callout arearefs="welt-zone-ttl">
    <para>
     <systemitem>$TTL</systemitem> 定義應該套用到此檔案中所有項目的預設有效時間。在此範例中，項目的有效時間是兩天 (<literal>2 D</literal>)。
    </para>
   </callout>
   <callout arearefs="welt-zone-soa-start">
    <para>
     這是 SOA (起始授權) 控制記錄開始的地方：
    </para>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <para>
       最前面的 <literal>example.com</literal> 為要管理的網域名稱。此網域名稱以「<literal>&#x002E;</literal>」結尾，因為如果不含點，可能會再次附加區域。或者，可以在此輸入 <literal>@</literal>，這樣會從 <filename>/etc/named.conf</filename> 中的對應項目擷取區域。
      </para>
     </listitem>
     <listitem>
      <para>
       <systemitem>IN SOA</systemitem> 之後是做為此區域主要伺服器的名稱伺服器的名稱。該名稱會從 <literal>dns</literal> 擴充為 <literal>dns.example.com</literal>，因為它沒有以「<literal>&#x002E;</literal>」結尾。
      </para>
     </listitem>
     <listitem>
      <para>
       後面跟著此名稱伺服器之負責人的電子郵件地址。因為 <literal>@</literal> 符號自身具有特殊意義，所以在這裡改為輸入「<literal>&#x002E;</literal>」。對於 <systemitem>root@example.com</systemitem>，該項目必須視為 <systemitem>root.example.com.</systemitem>。必須在末尾包含「<literal>&#x002E;</literal>」，以防止新增區域。
      </para>
     </listitem>
     <listitem>
      <para>
       <literal>(</literal> 會將 <literal>)</literal> 前面的所有行都包含在 SOA 記錄中。
      </para>
     </listitem>
    </itemizedlist>
   </callout>
   <callout arearefs="welt-zone-serial-no">
    <para>
     <systemitem>serial number</systemitem> 是一個 10 位數。每次變更此檔案，都必須變更此號碼。需要將這些變更通知給次要名稱伺服器 (次要伺服器)。為此，日期和執行編號常採用 10 位數，格式為 YYYYMMDDNN，這已成為慣用格式 (YYYY 表示年份，MM 表示月份，DD 表示日期。NN 是序號，可在給定的日期多次更新)。
    </para>
   </callout>
   <callout arearefs="welt-zone-refresh">
    <para>
     <systemitem>refresh rate</systemitem> 指定次要名稱伺服器驗證區域 <systemitem>serial
     number</systemitem> 的時間間隔。在此例中，是一天。
    </para>
   </callout>
   <callout arearefs="welt-zone-retry">
    <para>
     <systemitem>retry rate</systemitem> 指定在發生錯誤時次要名稱伺服器嘗試再次聯絡主要伺服器的時間間隔。在此例中，是兩小時。
    </para>
   </callout>
   <callout arearefs="welt-zone-expire">
    <para>
     <systemitem>expiration time</systemitem> 指定次要名稱伺服器無法重新取得與主要伺服器的聯絡時，在此時間範圍後丟棄快取資料。此例中為一週。
    </para>
   </callout>
   <callout arearefs="welt-zone-caching-time">
    <para>
     SOA 記錄中的最後一個項目指定 <systemitem>negative
     caching TTL</systemitem>，亦即其他伺服器未解析 DNS 查詢之結果可以快取的時間。
    </para>
   </callout>
   <callout arearefs="welt-zone-inns">
    <para>
     <systemitem>IN NS</systemitem> 指定負責此網域的名稱伺服器。<systemitem>dns</systemitem> 會擴充為 <systemitem>dns.example.com</systemitem>，因為它沒有以「<literal>&#x002E;</literal>」結尾。可能有數行會像這樣，其中一行是主要名稱伺服器，而每個次要名稱伺服器各一行。如果 <filename>/etc/named.conf</filename> 中的 <systemitem>notify</systemitem> 不是設定為 <option>no</option>，此處列出的所有名稱伺服器會收到區域資料變更的通知。
    </para>
   </callout>
   <callout arearefs="welt-zone-mx">
    <para>
     MX 記錄指定接受、處理和轉寄網域 <systemitem class="domainname">example.com</systemitem> 之電子郵件的郵件伺服器。在此範例中，其為主機 <systemitem class="domainname">mail.example.com</systemitem>。主機名稱前的號碼是優先設定值。如果有多個 MX 項目，則優先選用值最小的郵件伺服器。如果將郵件傳送到此伺服器失敗，則會使用值第二小的項目。
    </para>
   </callout>
   <callout arearefs="welt-zone-ips">
    <para>
     此行及其後面的行是實際位址記錄，其中的一或多個 IP 位址已指定到主機名稱。這裡列出的名稱不帶「<literal>&#x002E;</literal>」，因為這些名稱沒有包含網域，所以系統會新增 <systemitem class="domainname">example.com</systemitem> 至所有這些名稱。系統會將兩個 IP 位址指定給主機 <systemitem>gate</systemitem>，因為它有兩張網路卡。若主機位址是傳統位址 (IPv4)，記錄會使用 <literal>A</literal> 標示。如果位址是 IPv6 位址，則會使用 <literal>AAAA</literal> 標示該項。

     </para>


     <note>
      <title>IPv6 語法</title>
      <para>
       IPv6 記錄與 IPv4 的語法稍有不同。因為可以分段，所以必須在位址前提供有關遺漏位元的資訊。若要使用所需的數字<quote>}0</quote>填寫 IPv6 位址，則在位址的正確位置新增兩個冒號。

      </para>
<screen>pluto     AAAA 2345:00C1:CA11::1234:5678:9ABC:DEF0
pluto     AAAA 2345:00D2:DA11::1234:5678:9ABC:DEF0</screen>

     </note>
   </callout>
   <callout arearefs="welt-zone-ntp">
    <para>
     別名 <literal>ntp</literal> 可以用來定址 <literal>dns</literal> (<systemitem>CNAME</systemitem> 表示 <emphasis>canonical name</emphasis> (標準名稱))。
    </para>
   </callout>
  </calloutlist>



  <para>
   虛擬網域 <literal>in-addr.arpa</literal> 用來反向查詢 IP 位址到主機名稱。它會以反向標記法附加到位址的網路部分。因此，<systemitem class="ipaddress">192.168</systemitem> 會解析為 <systemitem>168.192.in-addr.arpa</systemitem>。請參閱<xref linkend="dat-arpa"/>。
  </para>



  <example xml:id="dat-arpa">
   <title>反向尋找</title>
   <screen>$TTL 2D <co xml:id="data-arpa-ttl"/>
168.192.in-addr.arpa.   IN SOA dns.example.com. root.example.com. ( <co xml:id="data-arpa-soa"/>
                        2003072441      ; serial
                        1D              ; refresh
                        2H              ; retry
                        1W              ; expiry
                        2D )            ; minimum

                        IN NS           dns.example.com. <co xml:id="data-arpa-inns"/>

1.5                     IN PTR          gate.example.com. <co xml:id="data-arpa-ips"/>
100.3                   IN PTR          www.example.com.
253.2                   IN PTR          cups.example.com.</screen>
  </example>

  <calloutlist>
   <callout arearefs="data-arpa-ttl">
    <para>
     $TTL 定義套用到此處所有項目的標準 TTL。
    </para>
   </callout>
   <callout arearefs="data-arpa-soa">
    <para>
     組態檔應該為網路 <systemitem class="ipaddress">192.168</systemitem> 啟用反向查詢。假設區域稱為 <systemitem>168.192.in-addr.arpa</systemitem>，則不應新增到主機名稱。因此，採用完整格式輸入所有主機名稱 — 包含網域並且末尾有「<literal>&#x002E;</literal>」。其餘的項目與之前 <systemitem>example.com</systemitem> 範例中所述的項目對應。
    </para>
    <para>
     如需此記錄中項目的詳細資料，請參閱<xref linkend="ex-welt-zone"/>。
    </para>
   </callout>
   <callout arearefs="data-arpa-inns">
    <para>
     此行指定負責此區域的名稱伺服器。不過，這次採用完整格式輸入名稱，包含網域並且末尾有「<literal>&#x002E;</literal>」。
    </para>
   </callout>
   <callout arearefs="data-arpa-ips">
    <para>
     此行及其後面的行是相關主機上 IP 位址的指標記錄提示。該行的開頭僅輸入了 IP 位址的最後一部分，末尾不含「<literal>&#x002E;</literal>」。將區域附加到此位址 (不含 <systemitem>.in-addr.arpa</systemitem>) 會使整個 IP 位址變成相反順序。
    </para>
   </callout>
  </calloutlist>
  <para>
   一般情況下，不同 BIND 版本之間的區域傳輸應該可以順利進行。
  </para>
 </sect1>

 <sect1 xml:id="sec-dns-dynupdate">
  <title>區域資料的動態更新</title>

  <para>
   <emphasis>動態更新</emphasis>一詞指新增、變更或刪除主要伺服器區域檔案中的項目的操作。RFC 2136 中詳述了此機制。透過新增選擇性 <systemitem>allow-update</systemitem> 或 <systemitem>update-policy</systemitem> 規則，可為每個區域項目個別設定動態更新。動態更新的區域不應該手動修改。
  </para>

  <para>
   使用指令 <command>nsupdate</command> 將要更新的項目傳送到伺服器。如需此指令的完整語法，請查閱 nsupdate 的手冊頁 (<command>man</command> <option>8 nsupdate</option>)。為了安全性的緣故，這類更新應該使用 TSIG 金鑰加以執行，如 <xref linkend="sec-dns-tsig"/> 所述。
  </para>
 </sect1>
 <sect1 xml:id="sec-dns-tsig">
  <title>安全交易</title>

  <para>
   透過採用共用秘密金鑰 (也稱為 TSIG 金鑰) 的交易簽章 (TSIG)，可以實現安全交易。本節說明如何產生及使用這類金鑰。
  </para>

  <para>
   不同伺服器之間的通訊，以及區域資料的動態更新，都需要安全交易。讓存取控制依靠金鑰比單純依靠 IP 位址要來得安全許多。
  </para>

  <para>
   使用下面的指令產生 TSIG 金鑰 (如需詳細資料，請參閱 <command>man</command> <option>tsig-keygen</option>)：
  </para>

<screen><prompt>&gt; </prompt><command>sudo</command> tsig-keygen -a hmac-md5 host1-host2 &gt; host1-host2.key</screen>

  <para>
   這會建立名為 <filename>host1-host2.key</filename> 的檔案，其中的內容可能如下所示：
  </para>

<screen>key "host1-host2" {                       |
    algorithm hmac-md5;
    secret "oHpBLgtcZso6wxnRTWdJMA==";
};</screen>

  <para>
   必須將此檔案傳輸至遠端主機，最好以安全方式傳輸 (例如，使用 scp)。若要在 <literal>host1</literal> 與 <literal>host2</literal> 之間啟用安全通訊，本地和遠端伺服器上的 <filename>/etc/named.conf</filename> 檔案中均須包含該金鑰。
  </para>

<screen>key host1-host2 {
 algorithm hmac-md5;
 secret "ejIkuCyyGJwwuN3xAteKgg==";
};</screen>

  <warning>
   <title><filename>etc/named.conf</filename> 的檔案權限</title>
   <para>
    請確定 <filename>/etc/named.conf</filename> 的權限受到適當的限制。此檔案的預設值是 <literal>0640</literal>，擁有者為 <systemitem class="username">root</systemitem> 及群組 <systemitem class="username">named</systemitem>。另一種方法是，將金鑰移到具有特別限定權限的其他檔案，然後將檔案從 <filename>/etc/named.conf</filename> 包含進來。若要包含外部檔案，請使用：
   </para>
<screen>include  "filename"</screen>
   <para>
    將<option>檔案名稱</option>取代為金鑰所在檔案的絕對路徑。
   </para>
  </warning>

  <para>





   若要讓伺服器 <literal>host1</literal> 能夠使用 <literal>host2</literal> (在此範例中位址為 <literal>10.1.2.3</literal>) 的金鑰，伺服器的 <filename>/etc/named.conf</filename> 必須包含以下規則：
  </para>

<screen>server 10.1.2.3 {
  keys { host1-host2. ;};
};</screen>

  <para>
   類比項目必須包含於 <literal>host2</literal> 的組態檔中。
  </para>

  <para>
   針對為 IP 位址和位址範圍定義的任何 ACL (存取控制清單，切勿與檔案系統 ACL 混淆) 新增 TSIG 金鑰，以確保交易安全性。對應項目應該看起來如下：
  </para>

<screen>allow-update { key host1-host2. ;};</screen>

  <para>
   此主題在 <literal>update-policy</literal> 下的 <emphasis>BIND Administrator Reference Manual</emphasis> 中有詳細討論。
  </para>
 </sect1>
 <sect1 xml:id="sec-dns-dnssec">
  <title>DNS 安全性</title>

  <para>
   RFC 2535 中對 DNSSEC (或 DNS 安全性) 進行了描述。BIND 手冊中介紹了可用於 DNSSEC 的工具。
  </para>

  <para>
   與一或多個區域金鑰關聯的區域才是安全區域。這些金鑰是使用 <command>dnssec-keygen</command> 產生，如同主機金鑰一樣。目前是使用 DSA 加密演算法產生這些金鑰。應透過 <systemitem>$INCLUDE</systemitem> 規則將所產生的公用金鑰包含到對應的區域檔案中。
  </para>

  <para>
   使用 <command>dnssec-signzone</command> 指令，可以建立產生的金鑰集 (<literal>keyset-</literal> 檔案)，將金鑰集安全地傳送至父區域，並對其簽名。這樣便會在 <filename>/etc/named.conf</filename> 中產生每個區域要包含的檔案。
  </para>


 </sect1>
 <sect1 xml:id="sec-dns-info">
  <title>更多資訊</title>

  <para>
   如需詳細資訊，請參閱安裝於 <filename>/usr/share/doc/packages/bind/arm</filename> 下的 <systemitem class="resource">bind-doc</systemitem> 套件中的 <emphasis>BIND Administrator Reference Manual</emphasis> (BIND 管理員參考手冊)。另外也請參閱手冊參考的 RFC 以及 BIND 隨附的手冊頁。<filename>/usr/share/doc/packages/bind/README.SUSE</filename> 中包含有關 <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> 中 BIND 的最新資訊。
  </para>
 </sect1>
</chapter>
