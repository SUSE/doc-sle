<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sect1 PUBLIC "-//Novell//DTD NovDoc XML V1.0//EN" "novdocx.dtd">
<!--
*********************************
Please see LICENSE.txt for this document's license.
*********************************
-->
<sect1 xml:base="update_split_brain.xml" id="sec.update.split-brain">
 <title>Atomicアップデート</title>

 <para>
  Atomicアップデートは、システムの2つのコピーを管理し、更新失敗後の容易な復元を可能にするツールに基づいています。提供されたツールを使用するには、特別なディスクパーティション設定が必要です。システムの各コピーは、それ独自のプライマリパーティションに常駐します。更新が失敗した場合、常に、システムの前の状態(もう一方のパーティションで利用できる)に戻ることができます。
 </para>



 <sect2 id="cha.update.split-brain.setup">
  <title>設定</title>
  <warning>
   <title>厳格なパーティション分割要件</title>
   <para>
    実装では、ディスクパーティションに関する厳格な要件があります。つまり、最初のルートパーティションは、<filename>/dev/sda1</filename>とし、全デスクサイズの半分を超えてはなりません。次に、ツールによって、システムの2つ目のルートパーティションとして<filename>/dev/sda2</filename>が作成されます。追加パーティション(可能な場合)は、両方のブートパーティションで共有されます。したがって、追加パーティションのサイズを考慮に入れて、最初のパーティションのサイズを適宜減らしてください。大まかな計算は、次のようになります。
   </para>
   <para>
    ディスク全体のサイズ－<systemitem>sda1</systemitem>のサイズ－<systemitem>sda2</systemitem>のサイズ = 追加パーティションの空き領域
   </para>
  </warning>
  <procedure>
   <step performance="required">
    <para>
     <filename>/dev/sda1</filename>が単一のルートパーティションとして全ディスクサイズの半分未満を占めるシステムをインストールします。
    </para>
   </step>
   <step performance="required">
    <para>
     インストールしたシステムを、必要に応じてカスタマイズします。<systemitem>multi-update-tools</systemitem>パッケージを必ずインストールしてください。
    </para>
   </step>
   <step performance="required">
    <para>
     <command>multi-update-setup --partition</command>を実行します。このコマンドは、同様のサイズでシステムの2つ目のルートパーティション(<filename>/dev/sda2</filename>)を作成します。
    </para>
   </step>
   <step performance="required">
    <para>
     必要に応じてディスクの残りをパーティション分割し、カスタマイズ(*)を続行します。
    </para>
   </step>
   <step performance="required">
    <para>
     <command>multi-update-setup --clone</command>を実行して、システムをもう一方のパーティションにコピーします。このコマンドで、ターゲットシステムの<filename>/etc/fstab</filename>にある<filename>/</filename> (ルート)エントリも変更します。
    </para>
   </step>
   <step performance="required">
    <para>
     必要に応じて、さらにカスタマイズ(*)します。
    </para>
   </step>
   <step performance="required">
    <para>
     <command>multi-update-setup --bootloader</command>を実行して、ブートローダの設定を初期化します。ブートローダのメニューに、もう一方のシステムをブートするためのエントリが組み込まれます。
    </para>
    <warning>
     <title>GRUB 2ブートローダは必須</title>
     <para>
      GRUB 2ブートローダのインストールは必須です。それらのツールは、他のブートローダと互換性がありません。
     </para>
    </warning>
   </step>
   <step performance="required">
    <para>
     (*)でマークされたカスタマイズがない場合は、<command>multi-update-setup --complete</command>を使用して3つのステップをすべて実行します。
    </para>
   </step>
  </procedure>
 </sect2>



 <sect2 id="cha.update.split-brain.updating">
  <title>もう一方のシステムの更新</title>
  <para>
   <command>multi-update</command>を実行します。このコマンドは、<command>chroot</command>環境で<systemitem>zypper</systemitem>を実行し、もう一方のシステムを更新します。どちらのシステムがアクティブかは重要でありません。そのブートメニューは、ブート時にデフォルトとして表示されます。
  </para>
 </sect2>



 <sect2 id="cha.update.split-brain.touble">
  <title>トラブルシューティング</title>
  <para>
   更新したシステムのブートローダが更新後に破損している場合は、<quote>アクティブ</quote>フラグを変更して、もう一方のシステムのルートパーティション用に設定し、そのシステムをブートできるようにする必要があります。
  </para>
  <para>
   更新したシステムがまったくブートしない場合は、ブートローダメニューにアクセスしてもう一方のシステムを選択する必要があります。
  </para>
  <para>
   GRUB 2の詳細については、<xref linkend="cha.grub2"/>を参照してください。
  </para>
 </sect2>

 <sect2 id="cha.update.split-brain.limitation">
  <title>制限</title>
  <para>
   ルートパティションは、パーティション名またはIDによってマウントするか、その他の方法でマウントする必要があります。パーティションUUIDやラベルによるマウントはサポートされていません。
  </para>
 </sect2>



 <sect2 id="cha.update.split-brain.info">
  <title>詳細情報</title>
  <para>
   詳細については、<systemitem>multi-update-tools</systemitem>パッケージに同梱されている<filename>/usr/share/doc/packages/multi-update-tools/README</filename>を参照してください。
  </para>
 </sect2>
</sect1>
