<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="net_proxy.xml" version="5.0" xml:id="cha-squid">
 <title>Caching-Proxyserver Squid</title>
 <info>
  <abstract>
   <para>
    Squid ist ein häufig verwendeter Caching-Proxyserver für Linux- und UNIX-Plattformen. Das bedeutet, dass er angeforderte Internetobjekte, wie beispielsweise Daten auf einem Web- oder FTP-Server, auf einem Computer speichert, der sich näher an der Arbeitsstation befindet, die die Anforderung ausgegeben hat, als der Server. Er kann in mehreren Hierarchien eingerichtet werden. So werden optimale Reaktionszeiten und die Nutzung einer niedrigen Bandbreite garantiert – auch bei Modi, die für den Endbenutzer transparent sind.
   </para>
  </abstract>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:bugtracker/>
   <dm:translation>yes</dm:translation>
  </dm:docmanager>
 </info>
 <para>
  Squid fungiert als Caching-Proxyserver. Er leitet Objektanforderungen von Clients (in diesem Fall: von Webbrowsern) an den Server weiter. Wenn die angeforderten Objekte vom Server eintreffen, stellt er die Objekte dem Client zu und behält eine Kopie davon im Festplatten-Cache. Ein Vorteil des Cachings besteht darin, dass mehrere Clients, die dasselbe Objekt anfordern, aus dem Festplatten-Cache versorgt werden können. Dadurch können die Clients die Daten wesentlich schneller erhalten als aus dem Internet. Durch dieses Verfahren wird außerdem der Datenverkehr im Netzwerk reduziert.
 </para>
 <para>
  Neben dem eigentlichen Caching bietet Squid eine breite Palette von Funktionen:
 </para>
 <itemizedlist>
  <listitem>
   <para>
    Verteilung der Last auf mehrere miteinander kommunizierende Hierarchien von Proxyservern
   </para>
  </listitem>
  <listitem>
   <para>
    Definition strenger Zugriffssteuerungslisten für alle Clients, die auf den Proxyserver zugreifen
   </para>
  </listitem>
  <listitem>
   <para>
    Zulassen oder Verweigern des Zugriffs auf bestimmte Webseiten mithilfe anderer Anwendungen
   </para>
  </listitem>
  <listitem>
   <para>
    Erstellen von Statistiken zu häufig besuchten Webseiten zur Bewertung der Internetgewohnheiten des Benutzers
   </para>
  </listitem>
 </itemizedlist>
 <para>
  Squid ist kein generischer Proxyserver. Er fungiert normalerweise nur bei HTTP-Verbindungen als Proxy. Außerdem unterstützt er die Protokolle FTP, Gopher, SSL und WAIS, nicht jedoch andere Internetprotokolle, wie das News-Protokoll oder Video-Konferenzen-Protokolle. Da Squid nur das UDP-Protokoll für die Bereitstellung von Kommunikation zwischen verschiedenen Caches unterstützt, werden zahlreiche Multimedia-Programme nicht unterstützt.
 </para>
 <sect1 xml:id="sec-squid-cacheinfos">
  <title>Einige Tatsachen zu Proxyservern</title>

  <para>
   Als Proxyserver für Caching-Aufgaben kann Squid auf verschiedene Weise verwendet werden. In Kombination mit einer Firewall kann er die Sicherheit unterstützen. Mehrere Proxies können gemeinsam verwendet werden. Außerdem kann er ermitteln, welche Objekttypen für wie lange im Cache gespeichert werden sollen.
  </para>

  <sect2 xml:id="sec-squid-security">
   <title>Squid und Sicherheit</title>
   <para>
    Squid kann zusammen mit einer Firewall verwendet werden, um interne Netzwerke gegen Zugriffe von außen zu schützen. Die Firewall verweigert allen Clients Zugriff auf externe Dienste mit Ausnahme von Squid. Alle Webverbindungen müssen vom Proxyserver erstellt werden. Bei dieser Konfiguration steuert Squid den gesamten Webzugriff.
   </para>
   <para>
    Wenn die Firewall-Konfiguration eine entmilitarisierte Zone (demilitarized zone, DMZ) enthält, sollte der Proxyserver in dieser Zone betrieben werden. Unter <xref linkend="sec-squid-proxyconfigtrans"/> wird beschrieben, wie Sie einen <emphasis>transparenten</emphasis> Proxy implementieren. Dadurch wird die Konfiguration der Clients erleichtert, da sie in diesem Fall keine Informationen zum Proxyserver benötigen.
   </para>
  </sect2>

  <sect2 xml:id="sec-squid-morecaches">
   <title>Mehrere Caches</title>
   <para>
    Mehrere Instanzen von Squid können für den Austausch von Objekten konfiguriert werden. Dadurch verringert sich die Gesamtlast im System und die Wahrscheinlichkeit erhöht sich, ein Objekt aus dem lokalen Netzwerk abrufen zu können. Außerdem können Cache-Hierarchien konfiguriert werden, sodass ein Cache Objektanforderungen an gleichgeordnete Caches oder einen übergeordneten Cache weiterleiten kann, sodass er Objekte aus einem anderen Cache im lokalen Netzwerk oder direkt von der Quelle anfordern kann.
   </para>
   <para>
    Die Auswahl einer geeigneten Topologie für die Cache-Hierarchie ist von entscheidender Bedeutung, da es nicht erstrebenswert ist, das Gesamtaufkommen an Datenverkehr im Netzwerk zu erhöhen. Bei sehr großen Netzwerken ist es sinnvoll, einen Proxyserver für jedes Subnetz zu konfigurieren und mit einem übergeordneten Proxyserver zu verbinden, der wiederum mit dem Caching-Proxyserver des ISP verbunden ist.
   </para>
   <para>
    Diese gesamte Kommunikation wird über das ICP (Internet Cache Protocol) abgewickelt, das über dem UDP-Protokoll ausgeführt wird. Die Übertragungen zwischen den Caches erfolgen über HTTP (Hypertext Transmission Protocol) auf der Grundlage von TCP.
   </para>
   <para>
    Um den geeignetsten Server zum Anfordern der Objekte zu finden, sendet ein Cache eine ICP-Anforderung an alle gleichgeordneten Proxys. Die gleichgeordneten Proxys beantworten diese Anforderungen über ICP-Antworten. Wenn das Objekt erkannt wurde, verwenden sie einen <literal>HIT</literal>-Code, wenn nicht, einen <literal>MISS</literal>-Code.
   </para>
   <para>
    Wenn mehrere <literal>HIT</literal>-Antworten gefunden wurden, legt der Proxyserver fest, von welchem Server heruntergeladen werden soll. Diese Entscheidung ist unter anderem davon abhängig, welcher Cache die schnellste Antwort gesendet hat bzw. welcher näher ist. Wenn keine zufrieden stellenden Antworten eingehen, wird die Anforderung an den übergeordneten Cache gesendet.
    <remark>Is timestamp a factor? - sknorr, 2016-06-24</remark>
   </para>
   <note>
    <title>Wie vermeidet Squid die Verdoppelung von Objekten?</title>
    <para>
     Um eine Verdopplung der Objekte in verschiedenen Caches im Netzwerk zu vermeiden, werden andere ICP-Protokolle verwendet, wie beispielsweise CARP (Cache Array Routing Protocol) oder HTCP (Hypertext Cache Protocol). Je mehr Objekte sich im Netzwerk befinden, desto größer ist die Wahrscheinlichkeit, das gewünschte Objekt zu finden.
    </para>
   </note>
  </sect2>

  <sect2 xml:id="sec-squid-latching">
   <title>Caching von Internetobjekten</title>
   <para>
    Viele im Netzwerk verfügbaren Objekte sind nicht statisch, wie beispielsweise dynamisch generierte Seiten und TLS/SSL-verschlüsselte Inhalte. Derartige Objekte werden nicht im Cache gespeichert, da sie sich bei jedem Zugriff ändern.
    <remark>Squid can now decrypt TLS traffic with plugins. Not sure whether
     that is then stored or not. Also, not sure how/whether to get this
     information in here. - sknorr, 2016-06-24
    </remark>
   </para>
   <para>
    Um zu bestimmen, wie lange Objekte im Cache gespeichert werden sollen, wird Objekten einer von mehreren Status zugewiesen. Web- und Proxyserver ermitteln den Status eines Objekts, indem sie Header zu diesen Objekten hinzufügen, beispielsweise <quote>Zuletzt geändert</quote> oder <quote>Läuft ab</quote>, und das entsprechende Datum. Andere Header, die angeben, dass Objekte nicht im Cache gespeichert werden dürfen, können ebenfalls verwendet werden.
   </para>
   <para>
    Objekte im Cache werden in der Regel aufgrund mangelnden Speicherplatzes ersetzt. Dazu werden Algorithmen wie LRU (last recently used) verwendet. Dies bedeutet, dass der Proxy die Objekte löscht, die am längsten nicht mehr angefordert wurden.
   </para>
  </sect2>
 </sect1>
 <sect1 xml:id="sec-squid-sysneeds">
  <title>Systemanforderungen</title>

  <para>
   Die Systemanforderungen hängen weitgehend von der maximalen Netzwerkauslastung ab, die das System tragen muss. Prüfen Sie daher die Belastungsspitzen, da diese mehr als das Vierfache des Tagesdurchschnitts betragen können. Im Zweifelsfall ist es vorzuziehen, die Systemanforderungen zu hoch einzuschätzen. Wenn Squid an der Grenze seiner Leistungsfähigkeit arbeitet, kann es zu erheblichen Einbußen in der Qualität des Diensts führen. Die folgenden Abschnitte widmen sich den einzelnen Systemfaktoren in der Reihenfolge ihrer Wichtigkeit:
  </para>



  <orderedlist>
   <listitem>
    <para>
     RAM-Größe
    </para>
   </listitem>
   <listitem>
    <para>
     CPU-Geschwindigkeit/physische CPU-Cores
    </para>
   </listitem>
   <listitem>
    <para>
     Größe des Festplatten-Cache
    </para>
   </listitem>
   <listitem>
    <para>
     Festplatten/SSDs und ihre Architektur
    </para>
   </listitem>
  </orderedlist>

  <sect2 xml:id="sec-squid-ram">
   <title>RAM</title>
   <para>
    Der von Squid benötigte Arbeitsspeicher (RAM) steht in direktem Verhältnis zur Anzahl der Objekte im Cache. RAM ist wesentlich schneller als eine Festplatte/SSD. Daher ist es sehr wichtig, dass genügend Arbeitsspeicher für den Squid-Vorgang zur Verfügung steht, da die Systemleistung erheblich eingeschränkt ist, wenn die Swap-Festplatte verwendet wird.
   </para>
   <para>
    Außerdem speichert Squid Cache-Objekt-Bezüge und häufig angeforderte Objekte im Hauptspeicher, um das Abrufen dieser Daten zu beschleunigen. Außerdem gibt es andere Daten, die Squid im Arbeitsspeicher benötigt, beispielsweise eine Tabelle mit allen IP-Adressen, einen exakten Domänennamen-Cache, die am häufigsten angeforderten Objekte, Zugriffssteuerungslisten, Puffer usw.
   </para>
  </sect2>

  <sect2 xml:id="sec-squid-cpu">
   <title>Prozessor</title>
   <para>
    Squid ist so eingestellt, dass es am besten mit niedrigeren Prozessor-Core-Zahlen arbeitet (4–8 physische Cores), wobei jeder höchste Leistung bietet. Technologien, die virtuelle Cores bereitstellen, wie Hyperthreading, können sich negativ auf die Leistung auswirken.
   </para>
   <para>
    Um mehrere CPU-Cores am besten zu nutzen, ist es notwendig, mehrere Worker-Threads einzurichten, die in verschiedene Caching-Geräte schreiben. Standardmäßig ist die Unterstützung mehrerer Cores deaktiviert.
   </para>
  </sect2>

  <sect2 xml:id="sec-squid-sysneeds-cache-size">
   <title>Größe des Festplatten-Cache</title>
   <para>
    Bei einem kleinen Cache ist die Wahrscheinlichkeit eines <literal>HIT</literal> (Auffinden des angeforderten Objekts, das sich bereits dort befindet) gering, da der Cache schnell voll ist und die weniger häufig angeforderten Objekte durch neuere ersetzt werden. Wenn beispielsweise 1 GB für den Cache zur Verfügung steht und die Benutzer nur Datenverkehr im Umfang von 10 MB pro Tag in Anspruch nehmen, dauert es mehr als hundert Tage, um den Cache zu füllen.
   </para>
   <para>
    Die einfachste Methode zur Ermittlung der benötigten Cache-Größe geht von der maximalen Übertragungsrate der Verbindung aus. Bei einer Verbindung mit 1 Mbit/s beträgt die maximale Übertragungsrate 128 KB/s. Wenn dieser Datenverkehr vollständig im Cache gespeichert wird, ergeben sich in einer Stunde 460 MB. Bei der Annahme, dass dieser Datenverkehr in nur 8 Arbeitsstunden generiert wird, würden 3,6 GB an einem einzigen Tag erreicht werden. Da in der Regel nicht das gesamte Volumen der Verbindung ausgeschöpft wird, kann angenommen werden, dass das Gesamtdatenvolumen, das auf den Cache zukommt, bei etwa 2 GB liegt. Daher sind bei diesem Beispiel 2 GB Festplattenspeicher erforderlich, damit Squid die durchsuchten Daten eines Tags im Cache speichern kann.
   </para>
  </sect2>

  <sect2 xml:id="sec-squid-sysneeds-disk">
   <title>Festplatten-/SSD-Architektur</title>

   <para>
    Da Geschwindigkeit beim Caching eine wichtige Rolle spielt, muss diesem Faktor besondere Aufmerksamkeit gewidmet werden. Bei Festplatten wird dieser Parameter als <emphasis>random seek time</emphasis> (Zufallszugriffszeit) oder <emphasis>random read performance</emphasis> (Zufallsleseleistung) beschrieben – gemessen in Millisekunden. Da die Datenblöcke, die Squid von der Festplatte/SSD liest oder auf die Festplatte/SSD schreibt, tendenziell eher klein sind, ist die Zugriffszeit/Leseleistung der Festplatte/SSD entscheidender als ihr Datendurchsatz.
   </para>
   <para>
    Für die Verwendung als Proxyserver sind Festplatten mit hoher Rotationsgeschwindigkeit oder SSDs die beste Wahl. Bei der Verwendung von Festplatten kann es besser sein, mehrere kleinere Festplatten zu verwenden. Dabei sollte jede ein einzelnes Cache-Verzeichnis aufweisen, um übermäßige Lesezeiten zu vermeiden.
   </para>
   <para>
    Die Verwendung von RAID-Systemen bietet eine erhöhte Zuverlässigkeit, bedeutet jedoch Einschränkungen bei der Geschwindigkeit. Vermeiden Sie jedoch aus Leistungsgründen (Software-)RAID5 und ähnliche Einstellungen.
   </para>
   <para>
    In den meisten Fällen ist die Auswahl des Betriebssystems unerheblich. Jedoch kann mit der Einhängeoption <literal>noatime</literal> die Leistung verbessert werden. Squid stellt eigene Zeitstempel bereit und erfordert daher nicht, dass das Dateisystem die Zugriffszeiten überwacht.
   </para>
  </sect2>
 </sect1>
 <sect1 xml:id="sec-squid-start">
  <title>Grundlegende Verwendung von Squid</title>

  <para>
   <systemitem>squid</systemitem> wird nicht standardmäßig auf <phrase role="productname"><phrase os="sles">SUSE® Linux Enterprise Server</phrase></phrase> installiert. Vergewissern Sie sich daher, dass das Paket auf Ihrem System installiert ist.
  </para>

  <para>
   Da Squid in <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> vorkonfiguriert ist, können Sie das Programm unmittelbar nach der Installation starten. Damit keine Probleme beim Starten auftreten, muss das Netzwerk mit dem Internet verbunden sein und mindestens einen Nameserver umfassen. Eine Einwahlverbindung mit dynamischer DNS-Konfiguration kann möglicherweise Probleme verursachen. In diesem Fall geben Sie zumindest den Nameserver an, da Squid nicht startet, wenn kein DNS-Server in <filename>/var/run/netconfig/resolv.conf</filename> gefunden wird.
  </para>

  <sect2 xml:id="sec-squid-start-commands">
   <title>Starten von Squid</title>
   <para>
    Starten Sie Squid mit dem folgenden Kommando:
   </para>
<screen><prompt>&gt; </prompt><command>sudo</command> <command>systemctl start squid</command></screen>
   <para>
    Soll Squid beim Booten des Systems gestartet werden, aktivieren Sie den Dienst mit <command>systemctl enable squid</command>.
   </para>
  </sect2>

  <sect2 xml:id="sec-squid-check">
   <title>Überprüfen, ob Squid ausgeführt wird</title>
   <para>
   Es stehen mehrere Möglichkeiten zur Auswahl, wie Sie überprüfen, ob Squid ausgeführt wird:
   </para>
   <itemizedlist>
    <listitem>
     <para>
      Mithilfe von <command>systemctl</command>:
     </para>
<screen><prompt>&gt; </prompt><command>systemctl status squid</command></screen>
     <para>
      Die Ausgabe sollte Folgendes für Squid anzeigen: <literal>loaded</literal> (geladen) und <literal>active (running)</literal> (aktiv (wird ausgeführt)).
     </para>
    </listitem>
    <listitem>
     <para>
      Mithilfe von Squid:
     </para>
<screen><prompt>&gt; </prompt><command>sudo</command> <command>squid -k check | echo $?</command></screen>
     <para>
      Die Ausgabe sollte <literal>0</literal> sein, kann jedoch auch zusätzliche Meldungen umfassen, z. B. Warnungen.
     </para>
    </listitem>
   </itemizedlist>
   <para>
    Um die Funktionsfähigkeit von Squid im lokalen System zu testen, wählen Sie eine der folgenden Optionen:
   </para>
   <itemizedlist>
    <listitem>
     <para>
      Verwenden Sie <command>squidclient</command>, ein Kommandozeilenwerkzeug, das die Antwort auf eine Webanforderung ausgibt, ähnlich wie <command>wget</command> oder <command>curl</command>.
     </para>
     <para>
      Im Gegensatz zu <command>wget</command> oder <command>curl</command> baut <command>squidclient</command> automatisch eine Verbindung zum standardmäßig eingerichteten Proxy für Squid auf (<literal>localhost:3128</literal>). Wenn Sie jedoch die Konfiguration von Squid Bericht haben, müssen Sie <command>squidclient</command> entsprechend konfigurieren. Weitere Informationen erhalten Sie mit <command>squidclient --help</command>.
     </para>
     <example xml:id="ex-squidclient-request">
      <title>Eine Anforderung mit <command>squidclient</command></title>
<screen><prompt>&gt; </prompt><command>squidclient http://www.example.org</command>
HTTP/1.1 200 OK
Cache-Control: max-age=604800
Content-Type: text/html
Date: Fri, 22 Jun 2016 12:00:00 GMT
Expires: Fri, 29 Jun 2016 12:00:00 GMT
Last-Modified: Fri, 09 Aug 2013 23:54:35 GMT
Server: ECS (iad/182A)
Vary: Accept-Encoding
X-Cache: HIT
x-ec-custom-error: 1
Content-Length: 1270
X-Cache: MISS from moon<co xml:id="co-squid-miss"/>
X-Cache-Lookup: MISS from moon:3128
Via: 1.1 moon (squid/3.5.16)<co xml:id="co-squid-via"/>
Connection: close

&lt;!doctype html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;Example domain&lt;/title&gt;
[...]
&lt;/body&gt;
&lt;/html&gt;</screen>
      <para>
       Die in <xref linkend="ex-squidclient-request"/> abgebildete Ausgabe besteht aus zwei Teilen:
      </para>
      <orderedlist>
       <listitem>
        <para>
         den Protokoll-Headern der Antwort( die Zeilen vor der leeren Zeile)
        </para>
       </listitem>
       <listitem>
        <para>
         dem eigentlichen Inhalt der Antwort( die Zeilen nach der leeren Zeile)
        </para>
       </listitem>
      </orderedlist>
      <para>
       Um zu überprüfen, ob Squid verwendet wird, sehen Sie sich im Header die ausgewählten Zeilen an:
      </para>
      <calloutlist>
       <callout arearefs="co-squid-miss">
        <para>
         Der Wert <literal>X-Cache</literal> im Header gibt an, dass das angeforderte Dokument nicht im Squid-Cache (<literal>MISS</literal>) des Computers <systemitem>moon</systemitem> gespeichert war.
        </para>
        <para>
         Das Beispiel oben enthält zwei <literal>X-Cache</literal>-Zeilen. Der erste <literal>X-Cache</literal>-Header kann bedenkenlos ignoriert werden, da er von der internen Caching-Software des ursprünglichen Webservers stammt.
        </para>
       </callout>
       <callout arearefs="co-squid-via">
        <para>
         Der Wert <literal>Via</literal> im Header gibt die HTTP-Version, den Namen des Computers und die verwendete Squid-Version an.
        </para>
       </callout>
      </calloutlist>
     </example>
    </listitem>
    <listitem>
     <para>
      Mithilfe eines Browsers: Richten Sie <option>localhost</option> als Proxy und <option>3128</option> als Port ein. Laden Sie dann eine Seite und überprüfen Sie die Antwort-Header in der Kontrollleiste <guimenu>Netzwerk</guimenu> des <emphasis>Inspektors</emphasis> oder der <emphasis>Entwicklertools</emphasis> des Browsers. Die Header sollten ähnlich wie in <xref linkend="ex-squidclient-request"/> reproduziert werden.
     </para>
    </listitem>
   </itemizedlist>
   <para>
    Um Benutzern aus dem lokalen System und anderen Systemen den Zugriff auf Squid und das Internet zu ermöglichen, müssen Sie den Eintrag in den Konfigurationsdateien <filename>/etc/squid/squid.conf</filename> von <option>http_access deny all</option> in <option>http_access allow all</option> ändern. Denken Sie jedoch daran, dass damit alle Benutzer den uneingeschränkten Zugriff auf Squid erhalten. Legen Sie daher ACLs (Access Control Lists = Zugriffssteuerungslisten) fest, die den Zugriff auf den Proxyserver steuern. Nach Bearbeiten der Konfigurationsdatei muss Squid neu geladen oder neu gestartet werden. Weitere Informationen zu ACLs finden Sie in <xref linkend="sec-squid-acl"/>.
   </para>
   <para>
    Wenn Squid nach kurzer Zeit nicht mehr funktioniert, prüfen Sie, ob ein falscher Nameserver-Eintrag vorliegt oder ob die Datei <filename>/var/run/netconfig/resolv.conf</filename> fehlt. Squid protokolliert die Ursache eines Startfehlers in der Datei <filename>/var/log/squid/cache.log</filename>.
   </para>
  </sect2>

  <sect2 xml:id="sec-squid-stop">
   <title>Stoppen, Neuladen und Neustarten von Squid</title>
   <para>
    Squid kann auf zweierlei Weise neu geladen werden:
   </para>
   <itemizedlist>
    <listitem>
     <para>
      Mithilfe von <command>systemctl</command>:
     </para>
<screen><prompt>&gt; </prompt><command>sudo</command> <command>systemctl</command> reload squid</screen>
     <para>
      oder
     </para>
<screen><prompt>&gt; </prompt><command>sudo</command> <command>systemctl</command> restart squid</screen>
    </listitem>
    <listitem>
     <para>
      Verwenden von YaST:
     </para>
     <para>
      Klicken Sie im Squid-Modul auf die Schaltfläche <guimenu>Einstellungen jetzt speichern und Squid neu starten</guimenu>
     </para>
    </listitem>
   </itemizedlist>
   <para>
    Um Squid zu stoppen, verwenden Sie eine der folgenden Optionen:
   </para>
   <itemizedlist>
    <listitem>
     <para>
      Mithilfe von <command>systemctl</command>:
     </para>
<screen><prompt>&gt; </prompt><command>sudo</command> <command>systemctl</command> stop squid</screen>
    </listitem>
    <listitem>
     <para>
      Verwenden von YaST
     </para>
     <para>
      Klicken Sie im Squid-Modul auf die Schaltfläche <guimenu>Squid jetzt stoppen</guimenu> Schaltfläche.
     </para>
    </listitem>
   </itemizedlist>
   <para>
    Das Herunterfahren von Squid kann einige Zeit dauern, da Squid bis zu eine halbe Minute wartet, bis die Verbindungen zu den Clients unterbrochen und die Daten auf die Festplatte geschrieben werden (siehe Option <option>shutdown_lifetime</option> in <filename>/etc/squid/squid.conf</filename>),
   </para>
   <warning>
    <title>Beenden von Squid</title>
    <para>
     Das Beenden von Squid mit <command>kill</command> oder <command>killall</command> kann den Cache beschädigen. Damit Squid neu gestartet werden kann, müssen beschädigte Caches gelöscht werden.
    </para>
   </warning>
  </sect2>

  <sect2 xml:id="sec-squid-remove">
   <title>Entfernen von Squid</title>
   <para>
    Durch das Entfernen von Squid aus dem System werden die Cache-Hierarchie und die Protokolldateien nicht entfernt. Um diese zu entfernen, müssen Sie das Verzeichnis <filename>/var/cache/squid</filename> manuell löschen.
   </para>
  </sect2>

  <sect2 xml:id="sec-squid-start-local-dns">
   <title>Lokaler DNS-Server</title>
   <para>
    Die Einrichtung eines lokalen DNS-Servers ist sinnvoll, selbst wenn er nicht seine eigene Domäne verwaltet. In diesem Fall fungiert er als Nur-Cache-Nameserver und kann DNS-Anforderungen über die Root-Nameserver auflösen, ohne dass eine spezielle Konfiguration erforderlich wäre (siehe <xref linkend="sec-dns-bind"/>). Wie dies durchgeführt werden kann, hängt davon ab, ob Sie bei der Konfiguration der Internetverbindung dynamisches DNS auswählen.
   </para>
   <variablelist>
    <varlistentry xml:id="vle-squid-dynamicdns">
     <term>Dynamisches DNS</term>
     <listitem>
      <para>
       Normalerweise wird bei dynamischem DNS der DNS-Server während des Aufbaus der Internetverbindung vom Anbieter festgelegt und die lokale Datei <filename>/var/run/netconfig/resolv.conf</filename> wird automatisch angepasst. Dieses Verhalten wird in der Datei <filename>/etc/sysconfig/network/config</filename> mit der sysconfig-Variablen <constant>NETCONFIG_DNS_POLICY</constant> festgelegt. Legen Sie <constant>NETCONFIG_DNS_POLICY</constant> mit dem YaST-sysconfig-Editor auf <constant>&quot;&quot;</constant> fest.
      </para>
      <para>
       Fügen Sie anschließend den lokalen DNS-Server in der Datei <filename>/var/run/netconfig/resolv.conf</filename> hinzu. Verwenden Sie die IP-Adresse <systemitem class="ipaddress">127.0.0.1</systemitem> für <systemitem class="domainname">localhost</systemitem>. Auf diese Weise kann Squid immer den lokalen Nameserver finden, wenn er gestartet wird.
      </para>
      <remark>FIXME ke: check it. Do you have to set more variables?</remark>
      <para>
       Um den Zugriff auf den Nameserver des Anbieters zu ermöglichen, geben Sie ihn zusammen mit seiner IP-Adresse in der Konfigurationsdatei <filename>/etc/named.conf </filename> unter <systemitem>forwarders</systemitem>   an. Mit dynamischem DNS kann dies automatisch während des Verbindungsaufbaus durchgeführt werden, indem die sysconfig-Variable <constant>NETCONFIG_DNS_POLICY</constant> auf <constant>auto</constant> festgelegt wird.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>Statisches DNS</term>
     <listitem>
      <para>
       Beim statischen DNS finden beim Verbindunsgsaufbau keine automatischen DNS-Anpassungen statt, sodass auch keine sysconfig-Variablen geändert werden müssen. Sie müssen jedoch den lokalen DNS-Server in der Datei <filename>/var/run/netconfig/resolv.conf</filename>, wie unter <xref linkend="vle-squid-dynamicdns"/> beschrieben, angeben. Außerdem muss der statische Nameserver des Anbieters zusammen mit seiner IP-Adresse manuell in der Datei <filename>/etc/named.conf</filename> unter <systemitem>forwarders</systemitem> angegeben werden.
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
   <tip>
    <title>DNS und Firewall</title>
    <para>
     Wenn eine Firewall ausgeführt wird, müssen Sie sicherstellen, dass DNS-Anforderungen durchgelassen werden.
    </para>
   </tip>
  </sect2>
 </sect1>
 <sect1 xml:id="sec-squid-yast">
  <title>Das YaST-Squid-Modul</title>

  <para>
   Das YaST-Squid-Modul enthält die folgenden Registerkarten:
  </para>

  <variablelist>
   <varlistentry>
    <term><guimenu>Start</guimenu></term>
    <listitem>
     <para>
      Gibt an, wie Squid gestartet wird und welcher Firewall-Port in welchen Schnittstellen geöffnet ist.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><guimenu>HTTP-Ports</guimenu></term>
    <listitem>
     <para>
      Definiert alle Ports, die Squid auf HTTP-Anforderungen von Clients überwacht.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><guimenu>Aktualisierungsschemata</guimenu></term>
    <listitem>
     <para>
      Gibt an, wie Squid die Objekte im Cache behandelt.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><guimenu>Cache-Einstellungen</guimenu></term>
    <listitem>
     <para>
      Definiert Einstellungen für den Cache-Speicher, die maximale und minimale Objektgröße und vieles mehr.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><guimenu>Cache-Verzeichnis</guimenu></term>
    <listitem>
     <para>
      Definiert das Verzeichnis auf oberster Ebene, in dem Squid die Cache-Auslagerungsdateien speichert.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><guimenu>Zugriffssteuerung</guimenu></term>
    <listitem>
     <para>
      Steuert den Zugriff auf den Squid-Server mithilfe von ACL-Gruppen.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><guimenu>Protokollierung und Zeitüberschreitung</guimenu></term>
    <listitem>
     <para>
      Definiert die Pfade zu den Protokolldateien für Zugriff, Cache und Cache-Speicher sowie die Zeitüberschreitung für die Verbindungen und die Client-Lebensdauer.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><guimenu>Sonstige</guimenu></term>
    <listitem>
     <para>
      Gibt die Sprache und die Email-Adresse des Administrators an.
     </para>
    </listitem>
   </varlistentry>
  </variablelist>
 </sect1>
 <sect1 xml:id="sec-squid-configfile">
  <title>Die Squid-Konfigurationsdatei</title>

  <para>
   Einstellungen für den Squid-Proxyserver werden in der Datei <filename>/etc/squid/squid.conf</filename> gespeichert. Obwohl die Datei für den ersten Start von Squid nicht geändert werden muss, wird externen Clients zunächst der Zugriff verweigert. Der Proxy ist für <systemitem class="domainname">localhost</systemitem> verfügbar. Der Standardport ist <option>3128</option>. Die vorinstallierte Konfigurationsdatei <filename>/etc/squid/squid.conf</filename> bietet detaillierte Informationen zu den Optionen sowie zahlreiche Beispiele.
  </para>

  <para>
   Zahlreiche Einträge sind mit dem Kommentarzeichen <literal>#</literal> deaktiviert. Die relevanten Spezifikationen finden Sie am Ende der Zeile. Die angegebenen Werte entsprechen in der Regel den Standardwerten, daher hat das Entfernen der Kommentarzeichen ohne Ändern der Parameter in der Regel keine Auswirkungen. Lassen Sie die kommentierten Zeilen nach Möglichkeit unverändert und geben Sie die Optionen zusammen mit den geänderten Werten in der Zeile darunter ein. Auf diese Weise können die Standardwerte problemlos wiederhergestellt und mit den Änderungen verglichen werden.
  </para>

  <tip>
   <title>Anpassen der Konfigurationsdatei nach einer Aktualisierung</title>
   <para>
    Wenn Sie eine Aktualisierung einer früheren Squid-Version durchgeführt haben, sollten Sie die neue Datei <filename>/etc/squid/squid.conf</filename> bearbeiten und nur die in der vorherigen Datei vorgenommenen Änderungen übernehmen.
   </para>
   <para>
    Manchmal werden Squid-Optionen hinzugefügt, entfernt oder geändert. Daher kann Squid möglicherweise aufhören, ordnungsgemäß zu funktionieren, wenn Sie die alte <filename>squid.conf</filename>-Datei verwenden.
   </para>
  </tip>

  <sect2 xml:id="sec-squid-configfile-general">
   <title>Allgemeine Konfigurationsoptionen</title>
   <para>
    Nachfolgend finden Sie eine Liste mit einer Auswahl an Konfigurationsoptionen für Squid. Die Liste ist nicht vollständig. Das Squid-Paket enthält eine vollständige Liste mit einfacher Veranschaulichung in der Datei <filename>/etc/squid/squid.conf.documented</filename>.
   </para>
   <variablelist>
    <varlistentry>
     <term><literal>http_port <replaceable>PORT</replaceable></literal></term>
     <listitem>
      <para>
       Dies ist der Port, den Squid auf Client-Anforderungen überwacht. Der Standardport ist <option>3128</option>, <option>8080</option> wird jedoch ebenfalls häufig verwendet.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>cache_peer <replaceable>HOSTNAME</replaceable> <replaceable> TYP</replaceable> <replaceable> PROXY-PORT</replaceable> <replaceable> ICP-PORT</replaceable></literal></term>
     <listitem>
      <para>
       Mit dieser Option kann ein Netzwerk mit Caches erstellt werden, die zusammen arbeiten. Der Cache-Peer ist ein Computer, der auch ein Netzwerk-Cache hostet und in einer Beziehung zu Ihrem eigenen steht. Der Typ der Beziehung wird als <replaceable>TYP</replaceable> angegeben. Der Typ kann entweder <literal>parent</literal> oder <literal>sibling</literal> sein.
      </para>
      <para>
       Geben Sie als <replaceable>HOSTNAME</replaceable> den Namen oder die IP-Adresse des verwendeten Proxyservers an. Geben Sie für <replaceable>PROXY-PORT</replaceable> die Portnummer zur Verwendung in einem Browser an (in der Regel <option>8080</option>). Legen Sie für <replaceable>ICP-PORT</replaceable> den Wert <option>7</option> oder, wenn der ICP-Port des übergeordneten Proxy nicht bekannt ist und seine Verwendung für den Anbieter nicht wichtig ist, den Wert <option>0</option> fest.
      </para>
      <para>
       Wenn Squid sich eher wie ein Webbrowser als wie ein Proxyserver verhalten soll, deaktivieren Sie die Verwendung des ICP-Protokolls. Hängen Sie hierzu die Optionen <option>default</option> und <option>no-query</option> an.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>cache_mem <replaceable>GRÖSSE</replaceable></literal></term>
     <listitem>
      <para>
       Diese Option legt fest, wie viel Arbeitsspeicher Squid für die häufigsten Antworten verwenden kann. Der Standardwert ist <option>8 MB</option>. Dieser Wert gibt nicht die Arbeitsspeichernutzung von Squid an und kann überschritten werden.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>cache_dir <replaceable>SPEICHERTYP</replaceable> <replaceable> CACHE-VERZEICHNIS</replaceable> <replaceable> CACHE-GRÖSSE</replaceable> <replaceable> EBENE-1-VERZEICHNISSE</replaceable> <replaceable> EBENE-2-VERZEICHNISSE</replaceable></literal></term>
     <listitem>
      <para>
       Die Option <literal>cache_dir</literal> legt das Verzeichnis für den Festplatten-Cache fest. In der Standardkonfiguration auf <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> erstellt Squid keinen Festplatten-Cache.
      </para>
      <para>
       Der Platzhalter <replaceable>SPEICHERTYP</replaceable> kann einen der folgenden Werte haben:
      </para>
      <itemizedlist>
       <listitem>
        <para>
         Verzeichnisbasierte Speichertypen: <literal>ufs</literal>, <literal>aufs</literal> (Standard), <literal>diskd</literal>. Alle drei Typen sind Variationen des Speicherformats <literal>ufs</literal>. Dabei wird <literal>ufs</literal> als Teil des Squid-Core-Threads ausgeführt, <literal>aufs</literal> wird in einem separaten Thread ausgeführt und <literal>diskd</literal> verwendet einen separaten Prozess. Dies bedeutet, dass die letzten beiden Typen das Blockieren von Squid aufgrund von Datenträger-E/A vermeiden.
        </para>
       </listitem>
       <listitem>
        <para>
         Datenbankbasierte Speichersysteme: <literal>rock</literal>. Dieses Speicherformat basiert auf einer einzelnen Datenbankdatei, in der jedes Objekt eine oder mehrere Arbeitsspeichereinheiten einer festen Größe (<quote>Slots</quote>) einnimmt.
        </para>
       </listitem>
      </itemizedlist>
      <para>
       Im Folgenden werden nur die Parameter für Speichertypen beschrieben, die auf <literal>ufs</literal> basieren. <literal>rock</literal> weist etwas andere Parameter auf.
      </para>
      <para>
       Der Parameter <replaceable>CACHE-VERZEICHNIS</replaceable> steht für das Verzeichnis des Festplatten-Cache. Standardmäßig lautet dieses <filename>/var/cache/squid</filename>. <replaceable>CACHE-GRÖSSE</replaceable> ist die maximale Größe dieses Verzeichnisses in Megabyte. Der festgelegte Standardwert ist 100 MB. Legen Sie eine Größe zwischen 50 % und maximal 80 % des verfügbaren Speicherplatzes fest.
      </para>
      <para>
       Die Werte <replaceable>EBENE-1-VERZEICHNISSE</replaceable> und <replaceable>EBENE-2-VERZEICHNISSE</replaceable> geben an, wie viele Unterverzeichnisse im <replaceable>CACHE-VERZEICHNIS</replaceable> erstellt werden. Standardmäßig werden 16 Unterverzeichnisse auf der ersten Ebene unter <replaceable>CACHE-VERZEICHNIS</replaceable> und 256 jeweils innerhalb dieser Ebenen erstellt. Diese Werte sollten nur nach reiflicher Überlegung erhöht werden, da zu viele Verzeichnisse zu Leistungsproblemen führen können.
      </para>
      <para>
       Wenn ein Cache von mehreren Datenträgern gemeinsam verwendet wird, müssen Sie mehrere <option>cache_dir</option>-Zeilen angeben.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><option>cache_access_log <replaceable>PROTOKOLLDATEI</replaceable></option></term>
     <term><option>cache_log <replaceable>PROTOKOLLDATEI</replaceable></option></term>
     <term><option>cache_store_log <replaceable>PROTOKOLLDATEI</replaceable></option></term>
     <listitem>
      <para>
       Diese drei Optionen geben die Pfade an, in denen Squid alle Aktionen protokolliert. In der Regel muss hier nichts geändert werden. Bei hoher Auslastung von Squid kann es sinnvoll sein, Cache und Protokolldateien auf mehrere Datenträger zu verteilen.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><option>client_netmask <replaceable>NETZMASKE</replaceable></option></term>
     <listitem>
      <para>
       Diese Option ermöglicht die Maskierung von IP-Adressen des Client in der Protokolldatei, indem eine Teilnetzmaske angewendet wird. Um beispielsweise für die letzte Zahl der IP-Adresse <literal>0</literal> festzulegen, geben Sie <systemitem class="netmask">255.255.255.0</systemitem> an.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><option>ftp_user <replaceable>E-MAIL</replaceable></option></term>
     <listitem>
      <para>
       Diese Option ermöglicht die Einstellung des Passworts, das Squid für die anonyme FTP-Anmeldung verwenden soll. Geben Sie hier eine gültige Email-Adresse ein, da manche FTP-Server diese auf Gültigkeit überprüfen.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><option>cache_mgr <replaceable>E-MAIL</replaceable></option></term>
     <listitem>
      <para>
       Wenn Squid abstürzt, wird eine Meldung an die angegebene Email-Adresse gesendet. Der Standardwert ist <emphasis>webmaster</emphasis>.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><option>logfile_rotate <replaceable>WERT</replaceable></option></term>
     <listitem>
      <para>
       Bei Verwendung mit <command>squid</command> <option>-k rotate</option> werden Protokolldateien in <command>squid</command> rotiert. Die Dateien werden nummeriert und nach dem Erreichen des angegebenen Werts wird die älteste Datei überschrieben. Der Standardwert ist <option>10</option>. Hierdurch werden Protokolldateien mit den Nummern 0 bis 9 rotiert.
      </para>
      <para>
       Auf <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> erfolgt die Rotation der Protokolldateien jedoch mithilfe von <systemitem class="daemon">logrotate</systemitem> und der Konfigurationsdatei <filename>/etc/logrotate.d/squid</filename> automatisch.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><option>append_domain <replaceable>DOMÄNE</replaceable></option></term>
     <listitem>
      <para>
       Verwenden Sie <emphasis>append_domain</emphasis>, um anzugeben, welche Domäne automatisch angefügt wird, wenn keine angegeben wurde. In der Regel wird hier Ihre eigene Domäne angegeben. Die Eingabe von <emphasis>www</emphasis> in den Browser navigiert also zu Ihrem eigenen Webserver.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><option>forwarded_for <replaceable>STATUS</replaceable></option></term>
     <listitem>
      <para>
       Ist für diese Option <literal>on</literal> festgelegt, wird eine Zeile wie die folgende zum Header hinzugefügt:
      </para>
<screen>X-Forwarded-For: 192.168.0.1</screen>
      <para>
       Wenn Sie für diese Option <literal>off </literal> festlegen, entfernt Squid die IP-Adresse und den Systemnamen des Client aus den HTTP-Anforderungen.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><option>negative_ttl <replaceable>ZEIT</replaceable></option></term>
     <term><option>negative_dns_ttl <replaceable>ZEIT</replaceable></option></term>
     <listitem>
      <para>
       Wenn diese Optionen konfiguriert sind, speichert Squid bestimmte Fehlerarten im Cache, z. B. <literal>404</literal>-Antworten. Die Ausgabe neuer Anforderungen wird danach abgelehnt, selbst wenn die Ressource verfügbar ist.
      </para>
      <para>
       Standardmäßig sind für <option>negative_ttl</option> der Wert <literal>0</literal> und für <option>negative_dns_ttl</option> der Wert <literal>1 minutes</literal> festgelegt. Dies bedeutet, dass negative Antworten auf Webanforderungen standardmäßig nicht im Cache gespeichert werden und negative Antworten auf DNS-Anforderungen für eine Minute im Cache gespeichert werden.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><option>never_direct allow <replaceable>ACL-NAME</replaceable></option></term>
     <listitem>
      <para>
       Um zu verhindern, dass Squid Anforderungen direkt aus dem Internet annimmt, müssen Sie mit der Option <literal>never_direct</literal> die Verbindung mit einem anderen Proxyserver erzwingen. Dieser muss zuvor unter <option>cache_peer </option> angegeben worden sein. Wenn <literal>all</literal> als <replaceable>ACL-NAME</replaceable> angegeben ist, werden alle Anforderungen direkt an den übergeordneten Proxy (<literal>parent</literal>) weitergeleitet. Dies kann beispielsweise dann erforderlich sein, wenn Sie einen Anbieter verwenden, der die Verwendung der eigenen Proxys vorschreibt oder der durch seine Firewall direkten Internetzugriff verweigert.
      </para>
      <remark>
       Last sentence sounds as if from another era... Does it still make sense?
       - sknorr, 2016-07-07
      </remark>
     </listitem>
    </varlistentry>
   </variablelist>
  </sect2>

  <sect2 xml:id="sec-squid-acl">
   <title>Optionen für die Zugriffssteuerung</title>
   <para>
    Squid kann den Zugriff auf den Proxyserver über Zugriffssteuerungslisten (Access Control Lists, ACL) steuern, wobei die Regeln in diesen Listen sequenziell verarbeitet werden. Die ACLs müssen zuerst definiert werden, bevor sie verwendet werden können. Squid umfasst Standard-ACLs wie <literal>all</literal> und <literal>localhost</literal>. Eine ACL wird jedoch erst dann wirksam, wenn sie eine entsprechende Regel <option>http_access</option> enthält.
   </para>
   <para>
    Die Syntax für die Option <option>acl</option> lautet:
   </para>
<screen>acl <replaceable>ACL_NAME</replaceable> <replaceable>TYPE</replaceable> <replaceable>DATA</replaceable></screen>
   <para>
    Die Platzhalter innerhalb dieser Syntax stehen für Folgendes:
   </para>
   <itemizedlist>
    <listitem>
     <para>
      Für <replaceable>ACL-NAME</replaceable> können Sie einen beliebigen Namen wählen.
     </para>
    </listitem>
    <listitem>
     <para>
      Für <replaceable>TYP</replaceable> wählen Sie aus den verfügbaren Optionen im Abschnitt <literal>ACCESS CONTROLS</literal> der Datei <filename>/etc/squid/squid.conf</filename>.
     </para>
    </listitem>
    <listitem>
     <para>
      Die Angabe für <replaceable>DATEN</replaceable> sind vom jeweiligen ACL-Typ abhängig, z. B. Hostnamen, IP-Adressen oder URLs.
     </para>
    </listitem>
   </itemizedlist>
   <para>
    Sollen Regeln in das YaST-Squid-Modul eingefügt werden, öffnen Sie das Modul und klicken Sie auf die Registerkarte <guimenu>Zugriffssteuerung</guimenu>. Klicken Sie unter der Liste der ACL-Gruppen auf <guimenu>Hinzufügen</guimenu> und geben Sie den Namen Ihrer Regel, den Typ und die zugehörigen Parameter ein.
   </para>
   <para>
    Weitere Informationen zu den Typen von ACL-Regeln finden Sie in der Squid-Dokumentation unter <link xlink:href="http://www.squid-cache.org/Versions/v3/3.5/cfgman/acl.html"/>.
   </para>
   <example xml:id="ex-squid-school">
    <title>Definieren von ACL-Regeln</title>
<screen>
acl mysurfers srcdomain .example.com <co xml:id="co-squid-school-surfer"/>
acl teachers src 192.168.1.0/255.255.255.0 <co xml:id="co-squid-school-teacher"/>
acl students src 192.168.7.0-192.168.9.0/255.255.255.0 <co xml:id="co-squid-school-student"/>
acl lunch time MTWHF 12:00-15:00 <co xml:id="co-squid-school-time"/>
</screen>
    <calloutlist>
     <callout arearefs="co-squid-school-surfer">
      <para>
       Diese ACL definiert <literal>mysurfers</literal> als alle Benutzer, die von <literal>.example.com</literal> kommen (wie durch Reverse-Lookup für die IP bestimmt wurde).
      </para>
     </callout>
     <callout arearefs="co-squid-school-teacher">
      <para>
       Diese ACL definiert <literal>teachers</literal> als die Benutzer von Computern, deren IP-Adressen mit <literal>192.168.1.</literal> beginnen.
      </para>
     </callout>
     <callout arearefs="co-squid-school-student">
      <para>
       Diese ACL definiert <literal>students</literal> als die Benutzer von Computern, deren IP-Adressen mit <literal>192.168.7.</literal>, <literal>192.168.8.</literal> oder <literal>192.168.9.</literal> beginnen.
      </para>
     </callout>
     <callout arearefs="co-squid-school-time">
      <para>
       Diese ACL definiert <literal>lunch</literal> als eine Uhrzeit an den Tagen Montag bis Freitag zwischen 12 und 15 Uhr.
      </para>
     </callout>
    </calloutlist>
   </example>
   <variablelist>
    <varlistentry>
     <term>http_access allow <replaceable>ACL-NAME</replaceable></term>
     <listitem>
      <para>
       <option>http_access</option> definiert, wer den Proxyserver verwenden darf und wer auf welche Seiten im Internet zugreifen kann. Hierzu müssen Sie ACLs definieren. Die ACLs <literal>localhost</literal> und <literal>all</literal> wurden bereits oben festgelegt. Sie können den Zugriff darauf mit <literal>deny</literal> bzw. <literal>allow</literal> verweigern oder erlauben. Eine Liste mit einer beliebigen Anzahl von <option>http_access</option>-Einträgen kann erstellt werden, die dann von oben nach unten verarbeitet wird. Je nachdem, welcher Eintrag zuerst auftritt, wird der Zugriff auf die entsprechende URL erlaubt oder verweigert. Der letzte Eintrag muss immer <option>http_access deny all</option> sein. Im folgenden Beispiel hat <literal>localhost</literal> freien Zugriff auf alle Elemente, während allen anderen Hosts der Zugriff vollständig verweigert wird:
      </para>
<screen>
http_access allow localhost
http_access deny all
</screen>
      <para>
       In einem anderen Beispiel, bei dem diese Regeln verwendet werden, hat die Gruppe <systemitem class="groupname">teachers</systemitem> immer Zugriff auf das Internet. Die Gruppe <systemitem class="groupname">students</systemitem> erhält nur montags bis freitags während der Mittagspause Zugriff:
      </para>
<screen>
http_access deny localhost
http_access allow teachers
http_access allow students lunch time
http_access deny all
</screen>
      <para>
       Zur besseren Lesbarkeit geben Sie alle Optionen für <option>http_access</option> als Block in der Konfigurationsdatei <filename>/etc/squid/squid.conf</filename> an.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><option>url_rewrite_program <replaceable>PFAD</replaceable></option></term>
     <listitem>
      <para>
       Mit dieser Option geben Sie einen URL-Rewriter an.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><option>auth_param basic program <replaceable>PFAD</replaceable></option></term>
     <listitem>
      <para>
       Wenn Benutzer auf dem Proxyserver authentifiziert werden müssen, geben Sie ein geeignetes Programm an, beispielsweise <filename>/usr/sbin/pam_auth</filename>. Beim ersten Zugriff auf <command>pam_auth</command> wird der Benutzer aufgefordert, einen Benutzernamen und ein Passwort anzugeben. Außerdem ist eine ACL erforderlich, sodass nur Clients mit einer gültigen Anmeldung das Internet benutzen können:
      </para>
<screen>
acl password proxy_auth REQUIRED

http_access allow password
http_access deny all
</screen>
      <para>
       Wird in der Option <option>acl proxy_auth</option> der Wert <literal>REQUIRED</literal> verwendet, bedeutet dies, dass alle gültigen Benutzernamen akzeptiert werden. <literal>REQUIRED</literal> kann auch durch eine Liste mit erlaubten Benutzernamen ersetzt werden.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><option>ident_lookup_access allow <replaceable>ACL-NAME</replaceable></option></term>
     <listitem>
      <para>
       Damit wird eine ident-Anforderung für alle Clients aktiviert, die mit einer ACL des Typs <literal>src</literal> festgelegt sind, um die Identität der einzelnen Benutzer zu ermitteln. Um dies für alle Clients zu aktivieren, können Sie die vordefinierte ACL <literal>all</literal> als <replaceable>ACL-NAME</replaceable> anwenden.
      </para>
      <para>
       Auf allen Clients, die durch <option>ident_lookup_access</option> angegeben sind, muss ein ident-Daemon ausgeführt werden. Unter Linux können Sie <systemitem class="daemon">pidentd</systemitem> (package <package>pidentd</package>) als ident-Daemon verwenden. Um sicherzustellen, dass nur Clients mit einem erfolgreichen ident-Lookup zulässig sind, definieren Sie eine entsprechende ACL:
      </para>
<screen>
acl identhosts ident REQUIRED

http_access allow identhosts
http_access deny all
</screen>
      <para>
       Wird die Option <option>acl identhosts ident</option> auf den Wert <literal>REQUIRED</literal> festgelegt, werden alle gültigen Benutzernamen akzeptiert. <literal>REQUIRED</literal> kann auch durch eine Liste mit erlaubten Benutzernamen ersetzt werden.
      </para>
      <para>
       Durch die Verwendung von <literal>ident</literal> kann die Zugriffszeit erheblich reduziert werden, da die ident-Lookups für jede Anforderung wiederholt werden.
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
  </sect2>
 </sect1>
 <sect1 xml:id="sec-squid-proxyconfigtrans">
  <title>Konfigurieren eines transparenten Proxys</title>

  <para>
   Ein transparenter Proxy fängt die Anforderungen des Webbrowsers ab und beantwortet sie, sodass der Webbrowser die angeforderten Seiten erhält, ohne dass bekannt ist, woher sie kommen. Wie der Name bereits andeutet, verläuft der gesamte Prozess für den Benutzer transparent.
  </para>

  <para>
   In der Regel arbeiten Sie folgendermaßen mit Proxyservern: Der Webbrowser sendet Anforderungen an einen bestimmten Port des Proxyservers und der Proxy liefert immer diese erforderlichen Objekte, unabhängig davon, ob sie sich im Cache befinden oder nicht. In manchen Fällen ist die Verwendung des transparenten Proxy-Modus von Squid empfehlenswert:
  </para>

  <itemizedlist>
   <listitem>
    <para>
     Wenn alle Clients aus Sicherheitsgründen über einen Proxyserver auf das Internet zugreifen sollen.
    </para>
   </listitem>
   <listitem>
    <para>
     Wenn alle Clients einen Proxyserver verwenden müssen, unabhängig davon, ob sie sich dessen bewusst sind.
    </para>
   </listitem>
   <listitem>
    <para>
     Wenn der Proxyserver in einem Netzwerk verschoben wird, die vorhandenen Clients jedoch ihre alte Konfiguration beibehalten müssen.
    </para>
   </listitem>
  </itemizedlist>

  <procedure xml:id="pro-squid-transparent-cli">
   <title>Squid als transparenter Proxyserver (Kommandozeile)</title>
   <step>
    <para>
     Fügen Sie in der Datei <filename>/etc/squid/squid.conf</filename> den Parameter <literal>transparent</literal> zur Zeile <option>http_port</option> hinzu. Damit sollten Sie zwei Zeilen erhalten:
    </para>
<screen>http_port 3128⎄
http_port 3128 transparent</screen>
   </step>
   <step>
    <para>
     Starten Sie Squid neu:
    </para>
<screen><prompt>&gt; </prompt><command>sudo</command> <command>systemctl restart squid</command></screen>
   </step>
   <step xml:id="st-squid-transparent-cli-fwrules">
    <para>
     Richten Sie die Firewall so ein, dass HTTP-Datenverkehr an den in <option>http_proxy</option> angegebenen Port umgeleitet wird (im Beispiel oben ist dies Port 3128). Laden Sie dann die Firewall-Konfiguration neu. Hierbei wird vorausgesetzt, dass die Zone <literal>internal</literal> der LAN-Schnittstelle zugewiesen ist.
    </para>
<screen><prompt>&gt; </prompt><command>sudo</command> <command>firewall-cmd</command> --permanent --zone=internal \
    --add-forward-port=port=80:proto=tcp:toport=3128:toaddr=<replaceable>LAN_IP</replaceable>
<prompt>&gt; </prompt><command>sudo</command> <command>firewall-cmd</command> --permanent --zone=internal --add-port=3128/tcp
<prompt>&gt; </prompt><command>sudo</command> <command>firewall-cmd</command> --reload</screen>
    <para>
     Ersetzen Sie <replaceable>LAN_IP</replaceable> durch die IP-Adresse Ihrer LAN-Schnittstelle oder der Schnittstelle, die durch Squid überwacht wird.
    </para>
   </step>
   <step>
    <para>
     Sehen Sie sich die Squid-Protokolle unter <filename>/var/log/squid/access.log</filename> an, um zu überprüfen, ob alles ordnungsgemäß funktioniert.
    </para>
   </step>
  </procedure>
 </sect1>
 <sect1 xml:id="sec-squid-cachemgr">
  <title>Verwenden der Cache-Manager-CGI von Squid (<systemitem class="resource">cachemgr.cgi</systemitem>)</title>

  <para>
   Die Cache-Manager-CGI (Common Gateway Interface; <filename>cachemgr.cgi</filename>) ist ein CGI-Dienstprogramm für die Anzeige der Statistiken zur Arbeitsspeichernutzung eines laufenden Squid-Prozesses. Außerdem bietet er eine bequeme Methode zur Verwaltung des Caches und zur Anzeige der Statistiken ohne Anmeldung beim Server.
  </para>

  <procedure xml:id="pro-squid-setup-cachemgr">
   <title>Einrichten <systemitem class="resource">cachemgr.cgi</systemitem></title>
   <step>
    <para>
     Stellen Sie sicher, dass der Apache-Webserver auf Ihrem System ausgeführt wird. Konfigurieren Sie Apache, wie in <xref linkend="cha-apache2"/> beschrieben. Lesen Sie insbesondere <xref linkend="sec-apache2-cgi"/>. Um zu überprüfen, ob Apache bereits ausgeführt wird, verwenden Sie:
    </para>
<screen><prompt>&gt; </prompt><command>sudo</command> <command>systemctl status apache2</command></screen>
    <para>
     Wenn der Status <literal>inactive</literal> vorliegt, starten Sie Apache mit den Standardeinstellungen für <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase>:
    </para>
<screen><prompt>&gt; </prompt><command>sudo</command> <command>systemctl start apache2</command></screen>
   </step>
   <step>
    <para>
     Aktivieren Sie nun <systemitem class="resource">cachemgr.cgi</systemitem> in Apache. Erstellen Sie hierzu eine Konfigurationsdatei für ein <literal>ScriptAlias</literal>.
    </para>
    <para>
     Erstellen Sie die Datei im Verzeichnis <filename>/etc/apache2/conf.d</filename> und nennen Sie sie <filename>cachemgr.conf</filename>. Fügen Sie der Datei Folgendes hinzu:
    </para>
<screen>ScriptAlias /squid/cgi-bin/ /usr/lib64/squid/

&lt;Directory "/usr/lib64/squid/"&gt;
Options +ExecCGI
AddHandler cgi-script .cgi
Require host <replaceable>HOST_NAME</replaceable>
&lt;/Directory&gt;
</screen>
    <para>
     Ersetzen Sie <replaceable>HOSTNAME</replaceable> durch den Hostnamen des Computers, über den Sie auf <systemitem class="resource">cachemgr.cgi</systemitem> zugreifen möchten. Dies erlaubt es nur Ihrem Computer, auf <systemitem class="resource">cachemgr.cgi</systemitem> zuzugreifen. Um den Zugriff von allen Computern zu erlauben, verwenden Sie stattdessen <literal>Require all granted</literal>.
    </para>
   </step>
   <step>
    <itemizedlist>
     <listitem>
      <para>
       Wenn Squid und der Apache-Webserver auf demselben Computer ausgeführt werden, sind keine Änderungen der Konfigurationsdatei <filename>/etc/squid/squid.conf</filename> erforderlich. Überprüfen Sie jedoch, ob die Datei die folgenden Zeilen enthält:
      </para>
<screen>
http_access allow manager localhost
http_access deny manager
  </screen>
      <para>
       Hiermit können Sie ausschließlich über Ihren Computer (<literal>localhost</literal>) auf die Manager-Schnittstelle zugreifen.
      </para>
     </listitem>
     <listitem>
      <para>
       Wenn Squid und der Apache-Webserver auf verschiedenen Computern ausgeführt werden, müssen Sie zusätzliche Regeln hinzufügen, um den Zugriff über das CGI-Skript auf Squid zu erlauben. Geben Sie eine ACL für den Server an (ersetzen Sie <replaceable>WEBSERVER-IP</replaceable> durch die IP-Adresse des Webservers):
      </para>
<screen>
acl webserver src <replaceable>WEB_SERVER_IP</replaceable>/255.255.255.255
</screen>
      <para>
       Stellen Sie sicher, dass die folgenden Regeln in der Konfigurationsdatei enthalten sind. Denken Sie daran, dass die Reihenfolge wichtig ist.
      </para>
<screen>
http_access allow manager localhost
http_access allow manager webserver
http_access deny manager
</screen>
     </listitem>
    </itemizedlist>
   </step>
   <step performance="optional">
    <para>
     Optional können Sie ein oder mehrere Passwörter für <systemitem class="resource">cachemgr.cgi</systemitem> konfigurieren. Dies eröffnet Ihnen auch den Zugriff auf weitere Aktionen, wie das Schließen des Caches per Fernzugriff oder das Anzeigen weiterer Informationen zum Cache. Um den Zugriff zu aktivieren, konfigurieren Sie die Optionen <option>cache_mgr</option> und <option>cachemgr_passwd</option> mit einem oder mehreren Passwörtern für den Manager und einer Liste der erlaubten Aktionen.
    </para>
    <para>
    Mit der folgenden Beispielkonfiguration können die Indexseite, das Menü und der 60-Minuten-Durchschnitt der Zähler ohne Authentifizierung angezeigt werden. Außerdem ist es möglich, den Offline-Modus über das Passwort <literal>secretpassword</literal> umzuschalten und alle anderen Punkte zu deaktivieren.
    </para>
<screen>
cache_mgr user
cachemgr_passwd none index menu 60min
cachemgr_passwd secretpassword offline_toggle
cachemgr_passwd disable all
</screen>
    <para>
     <option>cache_mgr</option> legt einen Benutzernamen fest. <option>cache_mgr</option> legt fest, welche Aktionen mit welchen Passwort erlaubt sind.
    </para>
    <para>
     Die Schlüsselwörter <literal>none</literal> und <literal>disable</literal> haben besondere Eigenschaften: <literal>none</literal> entfernt die Notwendigkeit eines Passworts, <literal>disable</literal> inaktiviert die Funktion vollständig.
    </para>
    <para>
     Die vollständige Liste der Aktionen finden Sie nach der Anmeldung bei <systemitem class="resource">cachemgr.cgi</systemitem>. Wie die Operation in der Konfigurationsdatei zu referenzieren ist, sehen Sie in der Zeichenkette nach <literal>&amp;operation=</literal> in der URL der Aktionsseite. <literal>all</literal> ist ein besonderes Schlüsselwort und steht für alle Aktionen.
    </para>
   </step>
   <step>
    <para>
     Laden Sie Squid und Apache neu, damit die Änderungen wirksam werden:
    </para>
<screen><prompt>&gt; </prompt><command>sudo</command> <command>systemctl reload squid</command></screen>
   </step>
   <step>
    <para>
     Um die Statistiken anzuzeigen, rufen Sie die Seite <systemitem class="resource">cachemgr.cgi</systemitem> auf, die Sie zuvor eingerichtet haben. Diese könnte beispielsweise <literal>http://webserver.example.org/squid/cgi-bin/cachemgr.cgi</literal> lauten.
    </para>
    <para>
     Wählen Sie den richtigen Server aus. Wenn ein Benutzername und ein Passwort konfiguriert sind, geben Sie diese Daten an. Klicken Sie auf <guimenu>Fortsetzen</guimenu> und blättern Sie durch die verfügbaren Statistiken.
    </para>
   </step>
  </procedure>
 </sect1>
 <sect1 xml:id="sec-squid-calamaris">
  <title>Erstellung von Cache-Berichten mit Calamaris</title>

  <para>
   Calamaris ist ein Perl-Skript, mit dem Berichte über die Cache-Aktivität im ASCII- oder HTML-Format erstellt werden. Es arbeitet mit nativen Squid-Zugriffsprotokolldateien. Dieses Werkzeug gehört nicht zum standardmäßigen Installationsumfang von <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase>. Zum Verwenden installieren Sie das Paket <systemitem>calamaris</systemitem>. Weitere Informationen zu Calamaris finden Sie unter <link xlink:href="http://cord.de/calamaris-english"/>.
  </para>

  <para>
   Melden Sie sich als <systemitem class="username">root</systemitem> an und geben Sie Folgendes ein:
  </para>

<screen><prompt role="root"># </prompt>cat access1.log [access2.log access3.log] | calamaris <replaceable>OPTIONS</replaceable> &gt; reportfile</screen>

  <para>
   Wenn Sie mehr als eine Protokolldatei verwenden, stellen Sie sicher, dass sie chronologisch geordnet sind, wobei ältere Dateien zuerst aufgelistet werden. Hierzu können Sie die Dateien eine nach der anderen wie im Beispiel oben auflisten oder alternativ <filename>access{1..3}.log</filename> verwenden.
  </para>

  <para>
   <command>calamaris</command> akzeptiert die folgenden Optionen:
  </para>

  <variablelist>
   <varlistentry>
    <term><option>-a</option></term>
    <listitem>
     <para>
      Ausgabe aller verfügbaren Berichte
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><option>-w</option></term>
    <listitem>
     <para>
      Ausgabe als HTML-Bericht
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><option>-l</option></term>
    <listitem>
     <para>
      Einschließen einer Meldung oder eines Logos in den Berichtsheader
     </para>
    </listitem>
   </varlistentry>
  </variablelist>

  <para>
   Weitere Informationen zu den verschiedenen Optionen finden Sie auf der man-Seite des Programms (<command>man</command><option>calamaris</option>).
  </para>

  <para>
   Typisches Beispiel:
  </para>

<screen>
<prompt role="root"># </prompt>cat access.log.{10..1} access.log | calamaris -a -w \
&gt; /usr/local/httpd/htdocs/Squid/squidreport.html
</screen>

  <para>
   Dadurch wird der Bericht im Verzeichnis des Webservers gespeichert. Zur Anzeige des Berichts ist Apache erforderlich.
  </para>
 </sect1>
 <sect1 xml:id="sec-squid-moreinfo">
  <title>Weitere Informationen</title>

  <para>
   Besuchen Sie die Squid-Homepage unter <link xlink:href="http://www.squid-cache.org/"/>. Hier finden Sie das <quote>Squid-Benutzerhandbuch</quote> und eine umfassende Sammlung mit FAQ zu Squid.
  </para>

  <para>
   Außerdem sind Mailinglisten für Squid unter <link xlink:href="http://www.squid-cache.org/Support/mailing-lists.html"/> verfügbar.
  </para>
 </sect1>
</chapter>
