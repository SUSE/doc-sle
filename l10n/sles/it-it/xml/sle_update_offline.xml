<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="sle_update_offline.xml" version="5.0" xml:id="cha-upgrade-offline">
 <title>Upgrade offline</title>
 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:bugtracker/>
   <dm:translation>sì</dm:translation>
  </dm:docmanager>
  <abstract>
   <para>
    In questo capito viene illustrato come eseguire l'upgrade di un'installazione SUSE Linux Enterprise esistente con YaST avviato da un supporto di installazione. Ad esempio, il programma di installazione di YaST può essere avviato da un DVD, in rete o dal disco rigido sul quale risiede il sistema.
   </para>
  </abstract>
 </info>
 <sect1 xml:id="sec-upgrade-offline-conceptual-overview">
  <title>Panoramica concettuale</title>
  <para>
   Prima di eseguire l'upgrade del sistema, leggere la <xref linkend="cha-update-preparation"/>.
  </para>
  <para>
   Per eseguire l'upgrade del sistema, effettuare l'avvio da un'origine di installazione, con la stessa procedura che si utilizzerebbe per una nuova installazione. Tuttavia quando viene visualizzata la schermata di avvio, è necessario selezionare <guimenu>Esegui l'upgrade</guimenu> (anziché <guimenu>Installazione</guimenu>). È possibile avviare l'upgrade da:
  </para>

  <itemizedlist>
   <listitem>
    <formalpara>
     <title>Supporti estraibili</title>
     <para>
      Tra questi supporti sono inclusi CD, DVD o dispositivi di memorizzazione di massa USB. Per ulteriori informazioni, vedere <xref linkend="sec-upgrade-offline-dvd"/>.
     </para>
    </formalpara>
   </listitem>
   <listitem>
    <formalpara>
     <title>Risorsa di rete</title>
     <para>
      È possibile eseguire l'avvio dal supporto locale, quindi selezionare il rispettivo tipo di installazione di rete, oppure è possibile eseguire l'avvio via PXE. Per ulteriori informazioni, vedere <xref linkend="sec-upgrade-offline-network"/>.
     </para>
    </formalpara>
   </listitem>
  </itemizedlist>
 </sect1>


 <sect1 xml:id="sec-upgrade-offline-dvd">
  <title>Avvio dell'upgrade da un supporto di installazione</title>
  
  <para>
   Di seguito è descritta la procedura di avvio da un DVD, ma è possibile utilizzare anche un altro supporto di installazione locale come un'immagine ISO in un dispositivo di memorizzazione di massa USB. Il supporto e il metodo di avvio da selezionare dipendono dall'architettura del sistema e dalla presenza del BIOS tradizionale o dello UEFI nel computer.
  </para>
  <procedure xml:id="pro-update-sle12-offline-dvd">
   <title>Upgrade manuale a <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> <phrase role="productnumber"><phrase os="sles;sled">15 SP3</phrase></phrase></title>
   <step>
    <para>
     Selezionare e preparare un supporto di avvio, vedere <xref linkend="part-prep"/>.
    </para>
   </step>
   <step>
    <para>
     Inserire il DVD del programma di installazione unificato di <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> <phrase role="productnumber"><phrase os="sles;sled">15 SP3</phrase></phrase> e avviare il computer. Viene visualizzata la schermata <guimenu>Benvenuti</guimenu>, seguita dalla schermata di avvio.
    </para>
   </step>
   <step>
    <para>
     Facoltativo: per forzare l'installazione dei pacchetti solo da DVD non da altre origini della rete da parte del programma di installazione, aggiungere l'opzione di avvio<option>media_upgrade=1</option>.
    </para>
   </step>
   <step>
    <para>
     Avviare il sistema selezionando <emphasis>Upgrade</emphasis> nel menu di avvio.
    </para>
   </step>
   <step>
    <para>
     Continuare con il processo di upgrade come descritto nella <xref linkend="sec-upgrade-offline-yast"/>.
    </para>
   </step>
  </procedure>
 </sect1>

 <sect1 xml:id="sec-upgrade-offline-network">
  <title>Avvio dell'upgrade da un'origine di rete</title>
  <para>
   Per avviare un upgrade da un'origine di installazione di rete, verificare che siano soddisfatti i seguenti requisiti:
  </para>
  <variablelist>
   <title>Requisiti per l'upgrade da un'origine di installazione di rete</title>
   <varlistentry>
    <term>Origine di installazione di rete</term>
    <listitem>
     <para>
      L'impostazione dell'origine dell'installazione di rete è configurata in base al <xref linkend="cha-deployment-instserver"/>.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Connessione e servizi di rete</term>
    <listitem>
     <para>
      Sia il server di installazione sia il computer di destinazione devono essere dotati di una connessione di rete funzionante. I servizi di rete obbligatori sono:
     </para>
     <itemizedlist>
      <listitem><para>DNS (Domain Name Service)</para></listitem>
      <listitem><para>DHCP (necessario solo per l'avvio tramite PXE, l'IP può essere impostato manualmente durante la configurazione)</para></listitem>
      <listitem><para>OpenSLP (facoltativo)</para></listitem>
     </itemizedlist>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Supporto di avvio</term>
    <listitem>
     <para>
      Un DVD di SUSE Linux Enterprise avviabile, un'immagine ISO o un'installazione PXE funzionante. Per i dettagli sull'avvio tramite PXE, vedere <xref linkend="sec-deployment-prep-boot-pxeprep"/>. Per informazioni più approfondite sull'avvio dell'upgrade da un server remoto, fare riferimento al <xref linkend="cha-remote-installation"/>.
     </para>
    </listitem>
   </varlistentry>
  </variablelist>
  <sect2 xml:id="sec-update-sle-manual-network-boot-from-dvd">
   <title>Upgrade manuale tramite l'origine di installazione di rete - Avvio da DVD</title>
  
   <para>
    Questa procedura descrive l'esempio di avvio da un DVD, ma è possibile utilizzare anche un altro supporto di installazione locale come un'immagine ISO in un dispositivo di memorizzazione di massa USB. Il modo in cui si seleziona il metodo di avvio e si avvia il sistema dal supporto dipende dall'architettura di sistema e dalla presenza nel computer di un BIOS tradizionale o di uno UEFI. Per informazioni dettagliate, vedere i collegamenti di seguito.
   </para>

   <procedure xml:id="pro-update-sle-manual-network-boot-from-dvd">

    <step>
     <para>
      Inserire il DVD del programma di installazione unificato di <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> <phrase role="productnumber"><phrase os="sles;sled">15 SP3</phrase></phrase> e avviare il computer. Viene visualizzata la schermata <guimenu>Benvenuti</guimenu>, seguita dalla schermata di avvio.
     </para>
    </step>
    <step>
     <para>
      Selezionare il tipo di origine di installazione di rete che si desidera utilizzare (FTP, HTTP, NFS, SMB o SLP). Generalmente è possibile effettuare questa scelta premendo <keycap>F4</keycap> ma, se il computer è dotato di UEFI anziché di un BIOS tradizionale, potrebbe essere necessario modificare i parametri di avvio manualmente. Per ulteriori dettagli, consultare <xref linkend="cha-boot-parameters"/> e <xref linkend="cha-install"/>.
     </para>
    </step>
    <step>
     <para>
      Continuare con il processo di upgrade come descritto nella <xref linkend="sec-upgrade-offline-yast"/>.
     </para>
    </step>
   </procedure>
  </sect2>
  <sect2 xml:id="sec-update-sle-manual-network-pxe-boot">
   <title>Upgrade manuale tramite l'origine di installazione di rete - Avvio tramite PXE</title>
   <para>
    Per effettuare un upgrade da un'origine di installazione di rete utilizzando Avvio PXE, procedere come descritto di seguito:
   </para>
   <procedure xml:id="pro-update-sle-manual-network-pxe-boot">
    <step>
     <para>
      Modificare la configurazione del server DHCP per fornire le informazioni sull'indirizzo necessarie per l'avvio via PXE. Per informazioni, vedere <xref linkend="pro-deployment-dhcp-server"/>.
     </para>
    </step>
    <step>
     <para>
      Impostare il server TFTP in modo che conservi l'immagine di avvio necessaria per l'avvio via PXE. A tal fine, utilizzare il DVD del programma di installazione per <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> <phrase role="productnumber"><phrase os="sles;sled">15 SP3</phrase></phrase> o seguire le istruzioni riportate in <xref linkend="sec-deployment-tftp-server"/>.
     </para>
    </step>
    <step>
     <para>
      Preparare l'avvio PXE e Wake-on-LAN nel computer di destinazione.
     </para>
    </step>
    <step>
     <para>
      Iniziare l'avvio del sistema di destinazione e utilizzare VNC per la connessione remota alla routine di installazione in esecuzione sul computer. Per ulteriori informazioni, vedere <xref linkend="sec-remote-installation-monitor-vnc"/>.
     </para>
    </step>
    <step>
     <para>
      Continuare con il processo di upgrade come descritto nella <xref linkend="sec-upgrade-offline-yast"/>.
     </para>
    </step>
   </procedure>
  </sect2>
 </sect1>

 <sect1 xml:id="sec-upgrade-offline-yast">
  <title>Upgrade di SUSE Linux Enterprise</title>
  <para>
   <remark>taroth 2014-11-13: argh, the following is terminology hell regarding
     the software strings: "upgrade"/"update" are used intermittently and
     without clear differentiation...</remark>
  </para>
  <para>
   Prima di eseguire l'upgrade del sistema, leggere la <xref linkend="cha-update-preparation"/>. Per eseguire una migrazione automatica, procedere come indicato di seguito:
  </para>
  <procedure>
   <note>
    <title>SUSE Customer Center e connessione a Internet</title>
    <para>
     Se il sistema di cui si desidera eseguire l'upgrade è registrato in SUSE Customer Center, assicurarsi di disporre di una connessione a Internet durante la procedura seguente.
    </para>
   </note>
   <step>
    <para>
     Dopo avere avviato (da un supporto di installazione o dalla rete), selezionare la voce <guimenu>Upgrade</guimenu> nella schermata di avvio.
    </para>
    <warning>
     <title>una scelta sbagliata può comportare una perdita di dati</title>
     <para>
      Assicurarsi di selezionare <guimenu>Upgrade</guimenu> in questa fase. Se si seleziona erroneamente <guimenu>Installazione</guimenu>, la partizione dati verrà sovrascritta con una nuova installazione.
     </para>
    </warning>
    <para>
     YaST avvia il sistema di installazione.
    </para>
   </step>
   <step>
    <para>
     Nella schermata <guimenu>Benvenuti</guimenu>, scegliere <guimenu>Lingua</guimenu> e <guimenu>Tastiera</guimenu>. Fare clic su <guimenu>Avanti</guimenu> per continuare.
    </para>
    <para>
     YaST controlla le partizioni per i sistemi SUSE Linux Enterprise già installati.
    </para>
   </step>
   <step>
    <para>
     Nella schermata <guimenu>Seleziona per l'aggiornamento</guimenu> selezionare la partizione di cui eseguire l'upgrade e fare clic su <guimenu>Avanti</guimenu>.
    </para>
   </step>
   <step>
    <para>
     YaST monta la partizione selezionata e viene visualizzato il contratto di licenza del prodotto di cui è stato eseguito l'upgrade. Accettare la licenza per continuare.
    </para>
   </step>
   <step>
    <para>
     Nella schermata <guimenu>Repository usati in precedenza</guimenu>, modificare lo stato dei repository. Tutti i repository vengono rimossi per impostazione predefinita. Se non sono stati aggiunti repository personalizzati, non modificare le impostazioni. I pacchetti per l'upgrade verranno installati dal DVD ed è possibile scegliere di abilitare i repository online predefiniti nel passaggio successivo.
 </para>
 <para>
Se sono presenti repository personalizzati, è possibile scegliere tra due opzioni:
</para>
<itemizedlist>
    <listitem>
        <para>
    Lasciare il repository nello stato Rimosso. Il programma installato da questo repository verrà rimosso durante l'upgrade. Utilizzare questo metodo se non è disponibile nessuna versione del repository corrispondente alla nuova release.
</para>
</listitem>
<listitem>
    <para>
    Aggiornare e abilitare il repository se corrisponde alla nuova release. Modificarne l'URL facendo clic sul repository nell'elenco, quindi su <guimenu>Modifica</guimenu>. Abilitare il repository selezionando <guimenu>Cambia stato</guimenu> finché non viene impostato su <guimenu>Abilita</guimenu>.
</para>
</listitem>
</itemizedlist>
<para>
Non conservare i repository delle release precedenti, poiché il sistema potrebbe essere instabile o non funzionare. Continuare facendo clic su <guimenu>Avanti</guimenu>.
    </para>
   </step>
   <step>
    <para>
     Il passaggio successivo dipende dall'avvenuta registrazione o meno del sistema sottoposto ad upgrade in SUSE Customer Center.
    </para>
    <substeps>
     <step>
      <para>
       Se il sistema non è registrato in SUSE Customer Center, in YaST viene visualizzato un messaggio popup che suggerisce di utilizzare un secondo supporto di installazione, ovvero l'immagine SLE-15-SP3-Full-<replaceable>ARCH</replaceable>-GM-media1.iso.
      </para>
      <para>
       Se non si dispone di tale supporto, è impossibile effettuare l'upgrade del sistema senza registrazione.
      </para>
     </step>
     <step>
      <para>
       Se il sistema è registrato in SUSE Customer Center, in YaST vengono visualizzati le destinazioni di migrazione possibili e un riepilogo.
      </para>
      <para>
       Selezionare una destinazione di migrazione dall'elenco e fare clic su <guimenu>Avanti</guimenu> per continuare.
      </para>
     </step>
    </substeps>
   </step>
   <step>
    <para>
     Nella finestra di dialogo successiva è facoltativamente possibile aggiungere un ulteriore supporto di installazione. Se si dispone di supporti di installazione aggiuntivi, attivare l'opzione <guimenu>Desidero installare un ulteriore prodotto aggiuntivo</guimenu> e specificare il tipo di supporto.
    </para>
   </step>
   <step>
    <para>
     Per l'upgrade, rivedere le <guimenu>Impostazioni di installazione</guimenu>.
    </para>
   </step>
   <step>
    <para>
     Se le impostazioni sono quelle desiderate, avviare la procedura di installazione e rimozione facendo clic su <guimenu>Aggiorna</guimenu>.
    </para>
    <tip>
     <title>errore di upgrade sui client SMT</title>
     <para>
      Se il computer di cui effettuare l'upgrade è un client SMT e l'upgrade risulta impossibile, vedere <xref linkend="pro-sec-update-prep-smt-de-register"/> e ripetere la procedura di upgrade.
     </para>
    </tip>
   </step>
   <step>
    <para>
     Al termine del processo di upgrade, eseguire i controlli post-upgrade come descritto in <xref linkend="sec-upgrade-postupgrade-checks"/>.
    </para>
   </step>
  </procedure>
  <remark>2021-03-11 jufa: considering removing sub-section as only 1 section</remark>
  <sect2 xml:id="sec-upgrade-postupgrade-checks">
   <title>Controlli post-upgrade</title>
   <itemizedlist>
    <listitem>
     <para>
      Verificare la presenza di <quote>pacchetti orfani</quote>. Durante una procedura di upgrade, i pacchetti possono essere rinominati, rimossi, uniti o divisi. Di conseguenza, alcuni di essi possono diventare orfani e non essere più supportati. I pacchetti orfani non vengono rimossi automaticamente. Per visualizzarli, è possibile utilizzare il comando seguente:
     </para>
<screen><prompt>tux &gt; </prompt>zypper packages --orphaned --unneeded</screen>
     <para>
      Utilizzare l'elenco per determinare i pacchetti ancora necessari e quelli che è possibile rimuovere in modo sicuro.
     </para>
    </listitem>
    <listitem>
     <para>
      Verificare la presenza di file <filename>*.rpmnew</filename> e <filename>*.rpmsave</filename>, esaminarne il contenuto ed eventualmente unire le modifiche opportune. Se un upgrade include modifiche a un file di configurazione predefinito, il pacchetto scriverà uno di questi tipi di file invece di sovrascrivere il file di configurazione. Mentre il file <filename>*.rpmnew</filename> contiene la nuova configurazione predefinita e non modifica il file originale, il file <filename>*.rpmsave</filename> è una copia della configurazione originale sostituita dal nuovo file predefinito.
     </para>
     <para>
      Non è necessario cercare i file <filename>*.rpmnew</filename> e <filename>*.rpmsave</filename> all'interno di tutto il file system, poiché i file più importanti sono memorizzati nella directory <filename>/etc</filename>. Utilizzare il comando seguente per visualizzare un elenco di tali file:
     </para>
<screen><prompt>tux &gt; </prompt>find /etc -print | egrep "rpmnew$|rpmsave$"</screen>
    </listitem>
   </itemizedlist>
  </sect2>

 </sect1>

 <sect1 xml:id="sec-upgrade-offline-automated" os="sles">
  <title>Upgrade con AutoYaST</title>
  <para>
   È possibile eseguire automaticamente il processo di upgrade. Per informazioni, vedere <xref linkend="CreateProfile-upgrade"/>.
  </para>
 </sect1>

 <sect1 xml:id="sec-upgrade-offline-manager">
  <title>Upgrade con SUSE Manager</title>
  <para>
   SUSE Manager è una soluzione server che fornisce aggiornamenti, patch e correzioni per la sicurezza dei client SUSE Linux Enterprise. Viene fornito in dotazione con un set di strumenti e un'interfaccia utente basata su Web per i task di gestione. Per ulteriori informazioni su SUSE Manager, vedere <link xlink:href="https://www.suse.com/products/suse-manager/"/>.
  </para>
  <para>
   Con SUSE Manager è possibile eseguire un upgrade del sistema. Con la tecnologia AutoYaST integrata, è possibile effettuare upgrade da una versione principale a quella successiva.
  </para>

  <para>
  Se il computer è gestito da SUSE Manager, aggiornarlo come descritto nella documentazione di SUSE Manager. La procedura per la <citetitle>migrazione del client</citetitle> è descritta in <citetitle>SUSE Manager Upgrade Guide</citetitle> (Guida all'upgrade di SUSE Manager), disponibile all'indirizzo <link xlink:href="https://documentation.suse.com/suma/"/>.
 </para>
 </sect1>
 <sect1 xml:id="sec-update-reg-status-after-rollback">
  <title>Aggiornamento dello stato della registrazione dopo il rollback</title>

  <para>
   Quando si esegue l'upgrade di un Service Pack, è necessario modificare la configurazione nel server di registrazione per consentire l'accesso ai nuovi archivi. Se il processo di upgrade viene interrotto o annullato (tramite il ripristino da un backup o da uno snapshot), le informazioni sul server di registrazione sono incoerenti con lo stato del sistema. Questo potrebbe impedire l'accesso agli archivi di aggiornamenti o comportare l'uso di archivi scorretti nel client.
  </para>

  <para>
   Quando si esegue un rollback tramite Snapper, il sistema invia una notifica al server di registrazione per garantire che durante il processo di avvio venga configurato l'accesso agli archivi corretti. Se il sistema è stato ripristinato con un altro metodo o la comunicazione con il server di registrazione è risultata impossibile, attivare il rollback sul client manualmente. L'attivazione di un rollback manuale può essere eseguita, ad esempio, quando il server non è accessibile a causa di problemi di rete. Per il rollback, eseguire:
  </para>

<screen><prompt>tux &gt; </prompt><command>sudo</command> <command>snapper</command> rollback</screen>

  <para>
   È consigliabile verificare sempre che nel sistema siano configurati gli archivi corretti, soprattutto dopo un aggiornamento del servizio tramite:
  </para>

<screen><prompt>tux &gt; </prompt><command>sudo</command> <command>zypper</command> ref -s</screen>

  <para>
   Questa funzionalità è disponibile nel pacchetto
   <package>rollback-helper</package>.
  </para>
 </sect1>
 <sect1 xml:id="sec-update-registersystem">


  <title>Registrazione del sistema</title>

  <para>
   Se il sistema non è stato registrato prima dell'upgrade, è possibile farlo in qualsiasi momento utilizzando il modulo <guimenu>Registrazione del prodotto</guimenu> in YaST.
  </para>

  <para>
   La registrazione dei sistemi comporta i seguenti vantaggi:
  </para>

  <itemizedlist>
   <listitem>
    <para>
     Idoneità per ottenere supporto
    </para>
   </listitem>
   <listitem>
    <para>
     Disponibilità degli aggiornamenti di sicurezza e delle correzioni dei bug
    </para>
   </listitem>
   <listitem>
    <para>
     Accesso al SUSE Customer Center
    </para>
   </listitem>
  </itemizedlist>

  <procedure>
   <step>
    <para>
     Avviare YaST e selezionare <menuchoice> <guimenu>Software</guimenu>
     <guimenu>Registrazione prodotto</guimenu> </menuchoice>  per aprire la finestra di dialogo <guimenu>Registrazione</guimenu>.
    </para>
   </step>
   <step>
    <para>
     Specificare l'indirizzo <guimenu>E-mail</guimenu> associato all'account SUSE in uso o utilizzato dalla propria organizzazione per gestire le sottoscrizioni. Se non si dispone ancora di un account SUSE, andare alla home page del SUSE Customer Center (<link xlink:show="new" xlink:href="https://scc.suse.com/"/>) per crearne uno.
    </para>
   </step>
   <step>
    <para>
     Immettere il <guimenu>Codice di registrazione</guimenu> ricevuto con la copia di <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase>.
    </para>
   </step>
   <step>
     <para>
      Se nella rete sono disponibili uno o più server di registrazione locali, è possibile sceglierne uno da un elenco.
     </para>
   </step>
   <step xml:id="st-y2-register-final">
    <para>
     Per avviare la registrazione, procedere con <guimenu>Avanti</guimenu>.
    </para>
    <para>
     Al termine della registrazione, YaST mostra un elenco di estensioni, componenti aggiuntivi e moduli disponibili per il sistema. Per selezionarli e installarli, passare alla <xref linkend="sec-add-ons-extensions"/>.
    </para>
   </step>
  </procedure>
 </sect1>

</chapter>
