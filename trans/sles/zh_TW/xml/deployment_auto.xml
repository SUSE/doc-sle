<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE chapter PUBLIC "-//Novell//DTD NovDoc XML V1.0//EN" "novdocx.dtd">
<!--
*********************************
Please see LICENSE.txt for this document's license.
*********************************
-->
<chapter xml:base="deployment_auto.xml" id="cha.deployment.autoinst">
 <title>自動安裝</title>
 <para>
  AutoYaST 可讓您同時在大量機器上安裝 SUSE® Linux Enterprise。AutoYaST 技術提供充足的彈性，可以針對異質硬體調整部署方式。本章說明如何準備簡易的自動安裝，並展示一個涉及不同硬體類型和安裝用途的複雜案例。
 </para>
 <sect1 id="sec.deployment.autoinst.simple">
  <title>簡易大量安裝</title>

  <important>
   <title>完全一樣的硬體</title>
   <para>
    本案例假設您要將 SUSE Linux Enterprise 部署到硬體組態完全一樣的一組機器上。
   </para>
  </important>

  <para>
   若要為 AutoYaST 大量安裝做準備，請執行下列步驟：
  </para>

  <procedure>
   <step performance="required">
    <para>
     建立 AutoYaST 設定檔，以包含部署所需的安裝詳細資料，詳細步驟說明請參閱<xref linkend="sec.deployment.autoinst.simple.profile"/>。
    </para>
   </step>
   <step performance="required">
    <para>
     決定 AutoYaST 設定檔的來源，以及要傳給安裝常式的參數，詳細步驟說明請參閱<xref linkend="sec.deployment.autoinst.simple.dist"/>。
    </para>
   </step>
   <step performance="required">
    <para>
     決定 SUSE Linux Enterprise 安裝資料的來源，詳細步驟說明請參閱<xref linkend="sec.deployment.autoinst.simple.source"/>。
    </para>
   </step>
   <step performance="required">
    <para>
     決定和設定自動安裝的開機方式，詳細步驟說明請參閱<xref linkend="sec.deployment.autoinst.simple.boot"/>。
    </para>
   </step>
   <step performance="required">
    <para>
     手動新增參數或建立 <filename>info</filename> 檔案，以傳送指令行給安裝常式，詳細步驟說明請參閱<xref linkend="sec.deployment.autoinst.simple.info"/>。
    </para>
   </step>
   <step performance="required">
    <para>
     開始自動安裝程序，詳細步驟說明請參閱<xref linkend="sec.deployment.autoinst.simple.install"/>。
    </para>
   </step>
  </procedure>

  <sect2 id="sec.deployment.autoinst.simple.profile">
   <title>建立 AutoYaST 設定檔</title>
   <para>
    AutoYaST 設定檔會告訴 AutoYaST 要安裝什麼，及如何設定安裝系統，以便在最後獲得完全可用的系統。有多種不同方法可建立 AutoYaST 設定檔：
   </para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>
      從參考機器將全新安裝複製到一組完全相同的機器
     </para>
    </listitem>
    <listitem>
     <para>
      使用 AutoYaST GUI 建立和修改設定檔，以符合您的需要
     </para>
    </listitem>
    <listitem>
     <para>
      使用 XML 編輯器從頭開始建立設定檔
     </para>
    </listitem>
   </itemizedlist>
   <para>
    若要複製全新參考安裝，請執行下列步驟：
   </para>
   <procedure>
    <step performance="required">
     <para>
      依照<xref linkend="cha.inst"/>中所述啟動常規安裝，然後根據您的需求設定系統。在<guimenu>安裝設定</guimenu>螢幕 (<xref linkend="sec.i.yast2.proposal"/>) 中，選擇<guimenu>複製系統組態</guimenu>並啟用<guimenu>將 AutoYaST 設定檔寫入 /root/autoinst.xml</guimenu>。
     </para>
    </step>
    <step performance="required">
     <para>
      <filename>/root/autoinst.xml</filename> 中將會建立一個即時可用的設定檔。該設定檔可用於建立此特定安裝的複製品。
     </para>
    </step>
   </procedure>
   <para>
    若要使用 AutoYaST GUI 根據現有系統組態建立設定檔，再依您的需要修改，請執行下列步驟：
   </para>
   <procedure>
    <step performance="required">
     <para>
      以 <systemitem class="username">root</systemitem> 身分啟動 YaST。
     </para>
    </step>
    <step performance="required">
     <para>
      選取<menuchoice><guimenu>其他</guimenu><guimenu>自動安裝</guimenu></menuchoice>，以啟動 AutoYaST 的圖形前端工具。
     </para>
    </step>
    <step performance="required">
     <para>
      選取<menuchoice><guimenu>工具</guimenu> <guimenu>建立參考設定檔</guimenu></menuchoice>，讓 AutoYaST 準備將目前的系統組態鏡像複製到一個 AutoYaST 設定檔中。
     </para>
    </step>
    <step performance="required">
     <para>
      除了預設資源 (如開機載入程式、磁碟分割和軟體選擇) 以外，您也可以核取<guimenu>建立參考控制檔案</guimenu>中的清單項目，以在設定檔中新增系統的其他各種影響因素。
     </para>
    </step>
    <step performance="required">
     <para>
      按一下<guimenu>建立</guimenu>，讓 YaST 收集所有系統資訊，並寫入新的設定檔。
     </para>
    </step>
    <step performance="required">
     <para>
      若要繼續進行，請選擇下列其中之一：
     </para>
     <itemizedlist mark="bullet" spacing="normal">
      <listitem>
       <para>
        如果設定檔已完成且符合您的需要，請選取<menuchoice><guimenu>檔案</guimenu> <guimenu>另存新檔</guimenu></menuchoice>，並輸入設定檔的檔案名稱，如 <filename>autoinst.xml</filename>。
       </para>
      </listitem>
      <listitem>
       <para>
        在左側的樹狀檢視中選取適當的組態面向 (如<quote>硬體/印表機</quote>)，並按一下<guimenu>設定</guimenu>，以修改參考設定檔，就會啟動個別的 YaST 模組，但您的設定會寫入 AutoYaST 設定檔，而不是套用到您的系統。完成後，選取<menuchoice><guimenu>檔案</guimenu><guimenu>另存新檔</guimenu></menuchoice>，並為設定檔輸入合適的名稱。
       </para>
      </listitem>
     </itemizedlist>
    </step>
    <step performance="required">
     <para>
      選取<menuchoice><guimenu>檔案</guimenu> <guimenu>結束</guimenu></menuchoice>，以離開 AutoYaST 模組。
     </para>
    </step>
   </procedure>
   <figure>
    <title>使用 AutoYaST 前端工具編輯 AutoYaST 設定檔</title>
    <mediaobject>
     <imageobject role="fo">
      <imagedata fileref="autoyast_gui.png" width="75%" format="PNG"/>
     </imageobject>
     <imageobject role="html">
      <imagedata fileref="autoyast_gui.png" width="75%" format="PNG"/>
     </imageobject>
    </mediaobject>
   </figure>
  </sect2>

  <sect2 id="sec.deployment.autoinst.simple.dist">
   <title>配送設定檔和決定 AutoYaST 參數</title>
   <para>
    有多種不同方法可以配送 AutoYaST 設定檔。依用來配送設定檔資料的通訊協定而定，我們會使用不同的 AutoYaST 參數，讓用戶端上的安裝常式知道設定檔的位置在哪裡。設定檔的位置是利用開機提示或開機時載入的 <filename>info</filename> 檔案傳給安裝常式。可用的選項如下：
   </para>
   <informaltable>
    <tgroup cols="3">
     <thead>
      <row>
       <entry>
        <para>
         設定檔位置
        </para>
       </entry>
       <entry>
        <para>
         參數
        </para>
       </entry>
       <entry>
        <para>
         描述
        </para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row>
       <entry>
        <para>
         檔案
        </para>
       </entry>
       <entry>
        <para>
         <filename>autoyast=file://<replaceable>path</replaceable></filename>
        </para>
       </entry>
       <entry>
        <para>
         可讓安裝常式在指定路徑 (相對於來源根目錄，如果是在 CD-ROM 的最上層目錄，則為 <filename>file:///autoinst.xml</filename>) 中尋找控制檔案。
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         裝置
        </para>
       </entry>
       <entry>
        <para>
         <filename>autoyast=device://<replaceable>path</replaceable></filename>
        </para>
       </entry>
       <entry>
        <para>
         使安裝常式在儲存裝置上尋找控制檔案。只需要裝置名稱─<filename>/dev/sda1</filename> 是錯的，應該用 <filename>sda1</filename>。
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         NFS
        </para>
       </entry>
       <entry>
        <para>

         <filename>autoyast=nfs://<replaceable>server</replaceable>/<replaceable>path</replaceable></filename>
        </para>
       </entry>
       <entry>
        <para>
         讓安裝常式從 NFS 伺服器取得控制檔案。
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         HTTP
        </para>
       </entry>
       <entry>
        <para>

         <filename>autoyast=http://<replaceable>server</replaceable>/<replaceable>path</replaceable></filename>
        </para>
       </entry>
       <entry>
        <para>
         讓安裝常式從 HTTP 伺服器取得控制檔案。
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         HTTPS
        </para>
       </entry>
       <entry>
        <para>

         <filename>autoyast=https://<replaceable>server</replaceable>/<replaceable>path</replaceable></filename>
        </para>
       </entry>
       <entry>
        <para>
         讓安裝常式從 HTTPS 伺服器取得控制檔案。
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         TFTP
        </para>
       </entry>
       <entry>
        <para>

         <filename>autoyast=tftp://<replaceable>server</replaceable>/<replaceable>path</replaceable></filename>
        </para>
       </entry>
       <entry>
        <para>
         讓安裝常式從 TFTP 伺服器取得控制檔案。
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         FTP
        </para>
       </entry>
       <entry>
        <para>

         <filename>autoyast=ftp://<replaceable>server</replaceable>/<replaceable>path</replaceable></filename>
        </para>
       </entry>
       <entry>
        <para>
         讓安裝常式從 FTP 伺服器取得控制檔案。
        </para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
   <para>
    以符合實際設定的值取代 <replaceable>server</replaceable> 和 <replaceable>path</replaceable> 預留位置。
   </para>
   <para>
    AutoYaST 包含可將若干設定檔繫結到用戶端 MAC 位址的功能。您不必改變 <option>autoyast=</option> 參數，就可以讓同一個設定使用不同設定檔安裝幾個不同例項。
   </para>
   <para>
    若要使用這項功能，請繼續執行下列步驟：
   </para>
   <procedure>
    <step performance="required">
     <para>
      以用戶端的 MAC 位址做為檔案名稱建立不同的設定檔，將它們放在存放您的 AutoYaST 設定檔的 HTTP 伺服器上。
     </para>
    </step>
    <step performance="required">
     <para>
      建立 <option>autoyast=</option> 參數時應省略包含檔案名稱的確切路徑，例如：
     </para>
<screen>autoyast=tftp://192.168.1.115/</screen>
    </step>
    <step performance="required">
     <para>
      啟動自動安裝。
     </para>
    </step>
   </procedure>
   <para>
    YaST 會嘗試以下列方式決定設定檔的位置：
   </para>
   <orderedlist spacing="normal">
    <listitem>
     <para>
      YaST 用它自己大寫的十六進位 IP 位址搜尋設定檔，例如 <literal>192.0.2.91</literal> 是 <literal>C000025B</literal>。
     </para>
    </listitem>
    <listitem>
     <para>
      如果找不到這個檔案，YaST 會移去一個十六進位數，然後再試一次。這個動作會重複八次，直到找到正確名稱的檔案為止。
     </para>
    </listitem>
    <listitem>
     <para>
      如果仍然找不到，它會嘗試以用戶端的 MAC 位址做為檔案名稱來尋找檔案。用戶端範例的 MAC 位址是 <literal>0080C8F6484C</literal>。
     </para>
    </listitem>
    <listitem>
     <para>
      如果找不到以 MAC 位址命名的檔案，YaST 會搜尋名稱為 <filename>default</filename> (小寫字母) 的檔案。YaST 搜尋 AutoYaST 設定檔的位址順序範例如下：
     </para>
<screen>
C000025B 
C000025 
C00002 
C0000 
C000 
C00 
C0 
C 
0080C8F6484C 
default
     </screen>
    </listitem>
   </orderedlist>
  </sect2>

  <sect2 id="sec.deployment.autoinst.simple.source">
   <title>提供安裝資料</title>
   <para>
    安裝資料可利用產品 CD 或 DVD 或使用網路安裝來源的方式提供。如果使用產品 CD 做為安裝來源，就必須能夠實際存取要安裝的用戶端，因為開機程序必須以手動方式啟始，而且需要更換 CD。
   </para>
   <para>
    若要透過網路提供安裝來源，請依<xref linkend="sec.deployment.remoteinst.instserver.sles9"/> 所述設定網路安裝伺服器 (HTTP、NFS、FTP)。使用 <filename>info</filename> 檔案可傳送伺服器的位置給安裝常式。
   </para>
  </sect2>

  <sect2 id="sec.deployment.autoinst.simple.boot">
   <title>設定開機方式</title>
   <para>
    用戶端有數種不同開機方法：
   </para>
   <variablelist>
    <varlistentry>
     <term>網路開機</term>
     <listitem>
      <para>
       對於標準遠端安裝，可以用網路喚醒功能和 PXE 啟動自動安裝，並且透過 TFTP 引進開機影像和控制檔案，而安裝來源可以來自任何網路安裝伺服器。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>可開機 CD-ROM</term>
     <listitem>
      <para>
       您可以使用原始的 SUSE Linux Enterprise 媒體將系統開機來進行自動安裝，再從網路位置或抽取式媒體引進控制檔案。或者，您可以建立自訂的 CD-ROM，來存放安裝來源和 AutoYaST 設定檔。
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
   <para>
    下列章節提供網路開機或從光碟機開機的基本程序大綱。
   </para>
   <sect3 id="sec.deployment.autoinst.simple.boot.pxe">
    <title>準備網路開機</title>
    <para>
     使用網路喚醒功能、PXE 和 TFTP 進行網路開機的方式於<xref linkend="sec.deployment.remoteinst.scenario.vncpxe"/>中說明。若要使該處介紹的安裝方式適用於自動安裝，請修改 PXE 功能的 Linux 組態檔案 (<filename>/srv/tftp/pxelinux.cfg/default</filename>)，以包含指到 AutoYaST 設定檔位置的 <literal>autoyast</literal> 參數。標準安裝的項目範例如下：
    </para>
<screen>
default linux 

# default label linux 
    kernel linux
    append initrd=initrd install=http://192.168.1.115/install/suse-enterprise/ 
	  
	</screen>
    <para>
     自動安裝的相同範例如下：
    </para>
<screen>
default linux 

# default label linux 
    kernel linux
    append initrd=initrd install=http://192.168.1.115/install/suse-enterprise/ \
           autoyast=nfs://192.168.1.110/profiles/autoinst.xml
	</screen>
    <para>
     以您的設定中所用的資料取代 IP 位址和路徑範例。
    </para>
   </sect3>
   <sect3 id="sec.deployment.autoinst.simple.boot.cd">
    <title>準備從光碟機開機</title>
    <para>
     在 AutoYaST 安裝中，有幾種不同方式可以從光碟機開機。請在下列方式之中做選擇：
    </para>
    <variablelist>
     <varlistentry>
      <term>從 SUSE Linux Enterprise 媒體開機，透過網路取得設定檔</term>
      <listitem>
       <para>
        如果完全以網路為基礎的方式不可行 (例如，硬體不支援 PXE)，而且您在大部分過程中可以實際存取要安裝的系統，請使用這種作法。
       </para>
       <para>
        您需要︰
       </para>
       <itemizedlist mark="bullet" spacing="normal">
        <listitem>
         <para>
          SUSE Linux Enterprise 媒體
         </para>
        </listitem>
        <listitem>
         <para>
          提供設定檔資料的網路伺服器 (詳細資料請參閱<xref linkend="sec.deployment.autoinst.simple.dist"/>)
         </para>
        </listitem>
        <listitem>
         <para>
          包含 <filename>info</filename> 檔案的抽取式媒體，以告訴安裝常式要到哪裡找到設定檔
         </para>
         <para>
          <emphasis>或</emphasis>
         </para>
         <para>
          存取要安裝系統的開機提示，讓您手動輸入 <literal>autoyast=</literal> 參數
         </para>
        </listitem>
       </itemizedlist>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term> 從 SUSE Linux Enterprise 媒體開機並進行安裝，從抽取式媒體取得設定檔</term>
      <listitem>
       <para>
        如果完全以網路為基礎的安裝方式不可行，請使用這種作法。這種作法需要實際存取要安裝的系統，以調整目標機器，而第二種做法則需要在出現開機提示時輸入設定檔的位置。不管是哪一種情況，您都必須根據安裝範圍更換媒體。
       </para>
       <para>
        您需要︰
       </para>
       <itemizedlist mark="bullet" spacing="normal">
        <listitem>
         <para>
          SUSE Linux Enterprise 媒體
         </para>
        </listitem>
        <listitem>
         <para>
          存放設定檔和 <filename>info</filename> 檔案的抽取式媒體
         </para>
         <para>
          <emphasis>或</emphasis>
         </para>
         <para>
          存取目標的開機提示以輸入 <option>autoyast=</option> 參數
         </para>
        </listitem>
       </itemizedlist>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>從自定媒體開機並進行安裝，從媒體取得設定檔</term>
      <listitem>
       <para>
        如果您只需安裝有限數量的軟體套件，而且目標數量相對較少，理想的作法是建立您自己的自定 CD，來存放安裝資料和設定檔，尤其是在您的設定中無法使用網路時。
       </para>
      </listitem>
     </varlistentry>
    </variablelist>
   </sect3>
  </sect2>

  <sect2 id="sec.deployment.autoinst.simple.info">
   <title>建立 <filename>info</filename> 檔案</title>
   <para>
    位於目標的安裝常式必須知道 AutoYaST 架構的所有不同元件在哪裡，所以我們必須建立指令行，內含找到 AutoYaST 元件、安裝來源和控制安裝程序所需參數的所有參數。
   </para>
   <para>
    若要這樣做，請在安裝的開機提示時手動傳送這些參數，或提供名稱為 <filename>info</filename> 的檔案 (安裝常式 (linuxrc) 會讀取這個檔案)。前者必須實際存取要安裝的任何用戶端，使這種作法不適合用於大型部署。後者可讓您在安裝前於預先準備的媒體上提供 <filename>info</filename> 檔案，並插入用戶端的磁碟機。或者，使用 PXE 開機，並依<xref linkend="sec.deployment.autoinst.simple.boot.pxe"/> 所述在 <filename>pxelinux.cfg/default</filename> 檔案中包含 linuxrc 參數。
   </para>
   <para>
    下列是常用的 linuxrc 參數。如需詳細資訊，請參閱 <filename>/usr/share/doc/packages/autoyast</filename> 中的 AutoYaST 套件文件。
   </para>
   <important>
    <title>分隔參數和值</title>
    <para>
     於開機提示中傳送參數給 linuxrc 時，請使用 <literal>=</literal> 分隔參數和值。使用 <filename>info</filename> 檔案時，則用 <literal>:</literal> 分隔參數和值。
    </para>
   </important>
   <informaltable>
    <tgroup cols="2">
     <thead>
      <row>
       <entry>
        <para>
         關鍵字
        </para>
       </entry>
       <entry>
        <para>
         數值
        </para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row>
       <entry>
        <para>
         <literal>netdevice</literal>
        </para>
       </entry>
       <entry>
        <para>
         網路設定所要用的網路裝置 (用於 BOOTP/DHCP 要求)。只有在有數個網路裝置可用時才需要。
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <literal>hostip</literal>
        </para>
       </entry>
       <entry>
        <para>
         如果空白，用戶端會傳送 BOOTP 要求；否則，使用指定的資料設定用戶端。
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <literal>netmask</literal>
        </para>
       </entry>
       <entry>
        <para>
         所選網路的網路遮罩。
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <literal>gateway</literal>
        </para>
       </entry>
       <entry>
        <para>
         預設閘道。
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <literal>nameserver</literal>
        </para>
       </entry>
       <entry>
        <para>
         名稱伺服器。
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <literal>autoyast</literal>
        </para>
       </entry>
       <entry>
        <para>
         自動安裝所用控制檔案的位置，例如 <literal>autoyast=nfs//192.168.1.110/profiles/</literal>。
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <literal>install</literal>
        </para>
       </entry>
       <entry>
        <para>
         安裝來源的位置，例如 <literal>install=nfs://192.168.1.110/CDs/</literal>。
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <literal>vnc</literal>
        </para>
       </entry>
       <entry>
        <para>
         如果設為 <literal>1</literal>，即允許 VNC 遠端控制的安裝。
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <literal>vncpassword</literal>
        </para>
       </entry>
       <entry>
        <para>
         VNC 的密碼。
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <literal>usessh</literal>
        </para>
       </entry>
       <entry>
        <para>
         如果設為 <literal>1</literal>，即允許 SSH 遠端控制的安裝。
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <literal>netsetup</literal>
        </para>
       </entry>
       <entry>
        <para>
         如果設為 <literal>1</literal>，請設定網路。此設定通常是自動完成的，但是如果安裝儲存庫在本地提供 (例如透過 DVD 或本地 iso 影像)，並且 <literal>info</literal> 檔案從網路載入，則需要設定 <filename>netsetup=1</filename>。
        </para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
   <para>
    如果您的自動安裝方式涉及透過 DHCP 來設定用戶端並且安裝來源為網路安裝來源，並且您希望使用 VNC 監控安裝程序，則您的 <filename>info</filename> 應該類似：
   </para>
<screen>autoyast:<replaceable>profile_source</replaceable> install:<replaceable>install_source</replaceable> vnc:1 vncpassword:<replaceable>some_password</replaceable></screen>
   <para>
    如果您習慣在安裝時使用靜態網路設定，您的 <filename>info</filename> 檔案應該類似：
   </para>
<screen>
autoyast:<replaceable>profile_source</replaceable> \
install:<replaceable>install_source</replaceable> \ 
hostip:<replaceable>some_ip</replaceable> \ 
netmask:<replaceable>some_netmask</replaceable> \ 
gateway:<replaceable>some_gateway</replaceable></screen>
   <para>
    <literal>\</literal> 是為了方便閱讀而新增的分行符號。所有選項必須以一個連續的字串輸入。
   </para>
   <para>
    <filename>info</filename> 資料可以用幾種不同方式提供給 linuxrc：
   </para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>
      做為一個檔案在抽取式媒體中提供，安裝時，可以在用戶端上使用該媒體。新增類似於 <systemitem>info=cd:/info</systemitem> 的 info 參數。
     </para>
    </listitem>
    <listitem>
     <para>
      做為系統開機所用初始 RAM 磁碟機的根目錄中的一個檔案，由自定安裝媒體或透過 PXE 開機提供。
     </para>
    </listitem>
    <listitem>
     <para>
      做為 AutoYaST 設定檔的一部分。在這種情況下，AutoYaST 檔案必須命名為 <filename>info</filename>，這樣 linuxrc 才能剖析它。這種作法的範例如下。
     </para>
    </listitem>
    <listitem>
     <para>
      透過指向 info 檔案位置的 URL。這種方式的語法類似於 <systemitem>info=http://www.example.com/info</systemitem>。
     </para>
    </listitem>
   </itemizedlist>
   <para>
    linuxrc 會在設定檔中尋找代表檔案開頭的字串 (<option>start_linuxrc_conf</option>)。如果找到，就從該字串開始剖析，並在找到 <option>end_linuxrc_conf</option> 字串時結束。儲存在設定檔中的選項如下：
   </para>
<screen>....
  &lt;install&gt;
....
    &lt;init&gt;
      &lt;info_file&gt;
&lt;![CDATA[
#
# Don't remove the following line:
# start_linuxrc_conf
#
install: nfs:<replaceable>server</replaceable>/<replaceable>path</replaceable>
vnc: 1
vncpassword: test
autoyast: file:///info

# end_linuxrc_conf
# Do not remove the above comment
#
]]&gt;

      &lt;/info_file&gt;
    &lt;/init&gt;
......
  &lt;/install&gt;
....
</screen>
   <para>
    linuxrc 會載入包含開機參數的設定檔，而不是傳統的 <filename>info</filename> 檔案。<option>install:</option> 參數會指示安裝來源的位置。<option>vnc</option> 與 <option>vncpassword</option> 指示使用 VNC 監控安裝。<option>autoyast</option> 參數則告訴 linuxrc 將 <filename>info</filename> 視為 AutoYaST 設定檔。
   </para>
  </sect2>

  <sect2 id="sec.deployment.autoinst.simple.install">
   <title>啟始和監控自動安裝</title>
   <para>
    提供上述所有基礎結構後 (設定檔、安裝來源和 <filename>info</filename> 檔案)，您可以繼續啟動自動安裝。依選擇的開機和監控程序方式而定，您可能必須與用戶端有實際的互動：
   </para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>
      如果用戶端系統從任何實體媒體 (產品媒體或自定光碟) 開機，您必須將這些媒體插入用戶端的磁碟機。
     </para>
    </listitem>
    <listitem>
     <para>
      如果用戶端不是透過網路喚醒功能開啟，您至少必須開啟用戶端機器。
     </para>
    </listitem>
    <listitem>
     <para>
      如果您未選擇遠端控制的自動安裝，就會傳送 AutoYaST 的圖形回應給連接用戶端的監視器，或 (如果您使用無人操作的用戶端) 序列主控台。
     </para>
    </listitem>
   </itemizedlist>
   <para>
    若要啟用遠端控制的自動安裝，請依<xref linkend="sec.deployment.autoinst.simple.info"/> 所述使用 VNC 或 SSH 參數，並依<xref linkend="sec.deployment.remoteinst.monitor"/> 所述從其他機器連接到用戶端。
   </para>
  </sect2>
 </sect1>
 <sect1 id="sec.deployment.autoinst.advanced">
  <title>以規則為基礎的自動安裝</title>

  <para>
   下列章節介紹使用 AutoYaST 以規則為基礎的安裝的基本概念，並提供案例範例讓您能夠建立您自己的自訂安裝設定。
  </para>

  <sect2 id="sec.deployment.autoinst.advanced.expl">
   <title>瞭解以規則為基礎的自動安裝</title>
   <para>
    以規則為基礎的 AutoYaST 安裝讓您能夠處理異質的硬體環境：
   </para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>
      您的網站包含不同廠商的硬體嗎？
     </para>
    </listitem>
    <listitem>
     <para>
      您的網站上的機器採用不同硬體組態嗎 (例如，使用不同裝置，或配備不同記憶體和磁碟大小)？
     </para>
    </listitem>
    <listitem>
     <para>
      您打算跨越網域進行安裝，而且必須加以區別嗎？
     </para>
    </listitem>
   </itemizedlist>
   <para>
    以規則為基礎的自動安裝一開始會將數個設定檔合併成一個，來產生符合異質案例的自定設定檔。每個規則會描述設定中的一個特色 (例如磁碟大小)，並告訴 AutoYaST 當規則符合時要使用哪個設定檔。描述設定中不同特色的數個規則合併在一個 AutoYaST <filename>rules.xml</filename> 檔案中。然後 AutoYaST 會處理規則堆疊，並將符合 AutoYaST 規則的不同設定檔合併成一個，來產生最後的設定檔。如需這個程序的示範，請參閱<xref linkend="sec.deployment.autoinst.advanced.example"/>。
   </para>
   <para>
    在規劃和執行 SUSE Linux Enterprise 部署時，以規則為基礎的 AutoYaST 會為您提供很大的靈活性。您可以：
   </para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>
      在 AutoYaST 中建立符合任何預先定義系統屬性的規則
     </para>
    </listitem>
    <listitem>
     <para>
      使用邏輯運算子將多個系統屬性 (如磁碟大小和核心結構) 合併成一個規則
     </para>
    </listitem>
    <listitem>
     <para>
      執行外圍程序檔並將輸出傳到 AutoYaST 架構以建立自訂規則。自定規則數不得超過 5 個。
     </para>
    </listitem>
   </itemizedlist>
   <note>
    <para>
     如需有關 AutoYaST 的規則建立和用法的更多資訊，請參閱 <filename>/usr/share/doc/packages/autoyast2/html/index.html</filename> 中套件文件的<guimenu>Rules and Classes</guimenu>一章。
    </para>
   </note>
   <para>
    若要準備進行以規則為基礎的 AutoYaST 大量安裝，請執行下列步驟：
   </para>
   <procedure>
    <step performance="required">
     <para>
      建立數個 AutoYaST 設定檔，以包含異質設定所需的安裝詳細資料，詳細步驟說明請參閱<xref linkend="sec.deployment.autoinst.simple.profile"/>。
     </para>
    </step>
    <step performance="required">
     <para>
      定義符合硬體設定的系統屬性的規則，詳細步驟說明請參閱<xref linkend="sec.deployment.autoinst.advanced.example"/>。
     </para>
    </step>
    <step performance="required">
     <para>
      決定 AutoYaST 設定檔的來源，以及要傳給安裝常式的參數，詳細步驟說明請參閱<xref linkend="sec.deployment.autoinst.simple.dist"/>。
     </para>
    </step>
    <step performance="required">
     <para>
      決定 SUSE Linux Enterprise 安裝資料的來源，詳細步驟說明請參閱<xref linkend="sec.deployment.autoinst.simple.source"/>。
     </para>
    </step>
    <step performance="required">
     <para>
      手動新增參數或建立 <filename>info</filename> 檔案，以傳送指令行給安裝常式，詳細步驟說明請參閱<xref linkend="sec.deployment.autoinst.simple.info"/>。
     </para>
    </step>
    <step performance="required">
     <para>
      決定和設定自動安裝的開機方式，詳細步驟說明請參閱<xref linkend="sec.deployment.autoinst.simple.boot"/>。
     </para>
    </step>
    <step performance="required">
     <para>
      開始自動安裝程序，詳細步驟說明請參閱<xref linkend="sec.deployment.autoinst.simple.install"/>。
     </para>
    </step>
   </procedure>
  </sect2>

  <sect2 id="sec.deployment.autoinst.advanced.example">
   <title>以規則為基礎的自動安裝案例範例</title>
   <para>
    若要對規則的建立方式有基本的瞭解，請參閱<xref linkend="fig.autoyast.rules"/>中描述的下列範例。執行 AutoYaST 會安裝下列設定：
   </para>
   <variablelist>
    <varlistentry>
     <term>列印伺服器</term>
     <listitem>
      <para>
       這台機器不需要桌面環境，只需要最基本的安裝，和有限的軟體套件。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>工程部門的工作站</term>
     <listitem>
      <para>
       這些機器需要桌面環境，和大量開發工具。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>銷售部門的筆記型電腦</term>
     <listitem>
      <para>
       這些機器需要桌面環境，和有限的專用應用程式，如辦公室和行事曆軟體。
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
   <figure id="fig.autoyast.rules">
    <title>AutoYaST 規則</title>
    <mediaobject>
     <imageobject role="fo">
      <imagedata fileref="autoyast_rules.svg" width="90%" format="SVG"/>
     </imageobject>
     <imageobject role="html">
      <imagedata fileref="autoyast_rules.png" width="80%" format="PNG"/>
     </imageobject>
    </mediaobject>
   </figure>
   <para>
    在第一個步驟中，使用<xref linkend="sec.deployment.autoinst.simple.profile"/>中說明的一種方法針對每一種案例建立設定檔。在此範例中，您會建立 <filename>print.xml</filename>、<filename>engineering.xml</filename> 和 <filename>sales.xml</filename>。
   </para>
   <para>
    在第二個步驟中，建立規則來區分三種硬體類型，並告訴 AutoYaST 要使用哪個設定檔。使用類似下列演算法來設定規則：
   </para>
   <orderedlist spacing="normal">
    <listitem>
     <para>
      機器有 <guimenu>192.168.2.253</guimenu> 這個 IP 嗎？有的話，將它設為列印伺服器。
     </para>
    </listitem>
    <listitem>
     <para>
      機器有 PCMCIA 硬體而且使用 Intel 晶片組嗎？有的話，將它視為 Intel 筆記型電腦，並安裝銷售部門軟體選擇。
     </para>
    </listitem>
    <listitem>
     <para>
      如果上述條件都不成立，則將該機器視為開發工作站，並據此進行安裝。
     </para>
    </listitem>
   </orderedlist>
   <para>
    這可以大致轉換成包含下列內容的 <filename>rules.xml</filename> 檔案：
   </para>
<screen>
&lt;?xml version="1.0"?&gt;
&lt;!DOCTYPE autoinstall SYSTEM "/usr/share/autoinstall/dtd/rules.dtd"&gt; 
&lt;autoinstall xmlns="http://www.suse.com/1.0/yast2ns" xmlns:config="http://www.suse.com/1.0/configns"&gt;
  &lt;rules config:type="list"&gt;
    &lt;rule&gt;
       &lt;hostaddress&gt;
	    &lt;match&gt;192.168.2.253&lt;/match&gt;
            &lt;match_type&gt;exact&lt;/match_type&gt;
       &lt;/hostaddress&gt;
       &lt;result&gt;
            &lt;profile&gt;print.xml&lt;/profile&gt;
            &lt;continue config:type="boolean"&gt;false&lt;/continue&gt;
        &lt;/result&gt;
    &lt;/rule&gt;
    &lt;rule&gt;
       &lt;haspcmcia&gt;
            &lt;match&gt;1&lt;/match&gt;
            &lt;match_type&gt;exact&lt;/match_type&gt;
       &lt;/haspcmcia&gt;
       &lt;custom1&gt;
           &lt;script&gt;
if grep -i intel /proc/cpuinfo &gt; /dev/null; then
echo -n "intel"
else
echo -n "non_intel"
fi;
           &lt;/script&gt;
           &lt;match&gt;*&lt;/match&gt;
           &lt;match_type&gt;exact&lt;/match_type&gt;
       &lt;/custom1&gt;
       &lt;result&gt;
            &lt;profile&gt;sales.xml&lt;/profile&gt;
            &lt;continue config:type="boolean"&gt;false&lt;/continue&gt;
        &lt;/result&gt;
        &lt;operator&gt;and&lt;/operator&gt;
    &lt;/rule&gt;
    &lt;rule&gt;
        &lt;haspcmcia&gt;
            &lt;match&gt;0&lt;/match&gt;
            &lt;match_type&gt;exact&lt;/match_type&gt;
        &lt;/haspcmcia&gt;
 	&lt;result&gt;
            &lt;profile&gt;engineering.xml&lt;/profile&gt;
            &lt;continue config:type="boolean"&gt;false&lt;/continue&gt;
        &lt;/result&gt;
    &lt;/rule&gt;
  &lt;/rules&gt;
&lt;/autoinstall&gt;
</screen>
   <para>
    配送規則檔案時，必須確定 <filename>rules</filename> 目錄位於 <filename>autoyast=<replaceable>通訊協定</replaceable>:<replaceable>伺服器 IP</replaceable>/profiles/</filename> URL 中指定的 <filename>profiles</filename> 目錄下。AutoYaST 會尋找包含 <filename>rules.xml</filename> 檔案的 <filename>rules</filename> 子目錄，然後載入並合併規則檔案中指定的設定檔。
   </para>
   <para>
    其餘自動安裝程序依正常方式執行。
   </para>
  </sect2>
 </sect1>
 <sect1 id="sec.deployment.autoinst.moreinfo">
  <title>如需更多資訊</title>

  <para>

   如需關於 AutoYaST 技術的深入資訊，請參閱 <phrase os="sles"><xref linkend="book.autoyast"/> 或</phrase>隨軟體一起安裝的文件 (<filename>/usr/share/doc/packages/autoyast2</filename>)。
  </para>
 </sect1>
</chapter>
