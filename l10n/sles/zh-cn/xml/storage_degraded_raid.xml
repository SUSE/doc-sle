<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="storage_degraded_raid.xml" version="5.0" xml:id="cha-raid-degraded" xml:lang="zh-cn"> <title>创建降级 RAID 阵列</title>
 <info>
      <abstract>
        <para>
    降级阵列是缺少某些设备的阵列。仅对 RAID 1、RAID 4、RAID 5 和 RAID 6 支持降级阵列。这些 RAID 类型被设计为作为容错功能的一部分，容忍缺少一些设备。通常，当一个设备失败时，会发生降级阵列。可以故意创建一个降级阵列。
   </para>
      </abstract>
      <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
        <dm:bugtracker/>
        <dm:translation>yes</dm:translation>
      </dm:docmanager>
    </info>
    <informaltable>
  <tgroup cols="2">
   <colspec colnum="1" colname="1" colwidth="30*"/>
   <colspec colnum="2" colname="2" colwidth="70*"/>
   <thead>
    <row>
     <entry>
      <para>
       RAID 类型
      </para>
     </entry>
     <entry>
      <para>
       允许缺少的槽数
      </para>
     </entry>
    </row>
   </thead>
   <tbody>
    <row>
     <entry>
      <para>
       RAID 1
      </para>
     </entry>
     <entry>
      <para>
       除一个设备外的所有设备
      </para>
     </entry>
    </row>
    <row>
     <entry>
      <para>
       RAID 4
      </para>
     </entry>
     <entry>
      <para>
       一个槽
      </para>
     </entry>
    </row>
    <row>
     <entry>
      <para>
       RAID 5
      </para>
     </entry>
     <entry>
      <para>
       一个槽
      </para>
     </entry>
    </row>
    <row>
     <entry>
      <para>
       RAID 6
      </para>
     </entry>
     <entry>
      <para>
       一个或两个槽
      </para>
     </entry>
    </row>
   </tbody>
  </tgroup>
 </informaltable>
 <para>
  要创建缺少某些设备的降级阵列，只需使用单词 <literal>missing</literal> 替换设备名即可。这会导致 <command>mdadm</command> 将阵列中的相应槽保留为空。
 </para>
 <para>
  当创建 RAID 5 阵列时，<command>mdadm</command> 会自动使用额外的备用驱动器创建降级阵列。这是因为将备用设备构建为降级阵列通常比在非降级但不清洁的阵列上重新同步奇偶校验要更快。您可以使用 <literal>--force</literal> 选项覆盖该功能。
 </para>
 <para>
  在要创建 RAID，但要使用的一个设备上已经有数据时，创建降级阵列非常有用。在这种情况下，使用其他设备创建一个降级阵列，将使用中的设备上的数据复制到以降级模式运行的 RAID 上，将该设备添加到 RAID 中，然后等待 RAID 重构建以便该数据分散在所有设备中。以下过程是如此处理的一个示例：
 </para>
 <procedure>
  <step>
   <para>
    若要使用单个驱动器 <filename>/dev/sd 1</filename> 创建降级的 RAID 1 设备 <filename>/dev/md0</filename>，请在命令提示符处输入以下命令：
   </para>
<screen><prompt>tux &gt; </prompt><command>sudo</command> mdadm --create /dev/md0 -l 1 -n 2 /dev/sda1 missing</screen>
   <para>
    该设备的大小应等于或大于计划添加到该设备的设备。
   </para>
  </step>
  <step>
   <para>
    如果要添加到镜像的设备包含要移到 RAID 阵列中的数据，现在将其复制到处于降级模式的 RAID 阵列中。
   </para>
  </step>
  <step>
   <para>
    将您从中复制数据的设备添加至镜像。例如，要向 RAID 中添加 <filename>/dev/sdb1</filename>，在命令提示符处输入以下命令：
   </para>
<screen><prompt>tux &gt; </prompt><command>sudo</command> mdadm /dev/md0 -a /dev/sdb1</screen>
   <para>
    您一次只能添加一个设备。必须等到内核构建镜像并将其完全联机，才能添加另一个镜像。
   </para>
  </step>
  <step>
   <para>
    在命令提示符处输入以下命令，监视构建过程：
   </para>
<screen><prompt>tux &gt; </prompt><command>sudo</command> cat /proc/mdstat</screen>
   <para>
    要在每秒刷新重建进度时查看此进度，请输入
   </para>
<screen><prompt>tux &gt; </prompt><command>sudo</command> watch -n 1 cat /proc/mdstat </screen>
  </step>
 </procedure>
</chapter>
