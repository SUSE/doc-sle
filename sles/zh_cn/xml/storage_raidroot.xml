<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="storage_raidroot.xml" version="5.0" xml:id="cha.raidroot" xml:lang="zh-cn">
 <title>为根分区配置软件 RAID</title>
 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:bugtracker/>
   <dm:translation>yes</dm:translation>
  </dm:docmanager>
 </info>
 <para>
  在 <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> 中，设备映射程序 RAID 工具已集成到 YaST 分区程序中。安装时可以使用此分区程序为包含根 (<filename>/</filename>) 分区的系统设备创建软件 RAID。不能将 <filename>/boot</filename> 分区储存在除 RAID 1 以外的 RAID 分区上。
 </para>
 <sect1 xml:id="sec.raidroot.require">
  <title>
   针对根分区使用软件 RAID 设备的先决条件
  </title>

  <para>
   请确保配置满足以下要求：
  </para>

  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>
     创建 RAID 1 镜像设备需要有两块硬盘。这两块硬盘的大小应相近。RAID 使用较小驱动器大小。块储存设备可以是本地设备（计算机中或直接挂接到计算机）、光纤通道储存子系统或 iSCSI 储存子系统的任意组合。
    </para>
   </listitem>
   <listitem>
    <para>
     如果在 MBR 中安装引导加载程序，则不需要为 <filename>/boot</filename> 创建独立分区。如果无法在 MBR 中安装引导加载程序，则 <filename>/boot</filename> 需要驻留在单独的分区上。
    </para>
   </listitem>
   <listitem>
    <para>
     对于 UEFI 计算机，需要设置专用的 <filename>/boot/efi</filename> 分区。该分区需要格式化为 VFAT，可以驻留在 RAID 1 设备上，以防包含 <filename>/boot/efi</filename> 的物理磁盘发生故障时出现引导问题。
    </para>
   </listitem>
   <listitem>
    <para>
     如果要使用硬件 RAID 设备，请不要在其上尝试运行软件 RAID。
    </para>
   </listitem>
   <listitem>
    <para>
     如果要使用 iSCSI 目标设备，需要在创建 RAID 设备之前启用对 iSCSI 发起端的支持。
    </para>
   </listitem>
   <listitem>
    <para>
     如果储存子系统在服务器和其直接挂接的本地设备、光纤通道设备或要在软件 RAID 中使用的 iSCSI 设备之间提供多个 I/O 路径，则在创建 RAID 设备之前需要启用多路径支持。
    </para>
   </listitem>
  </itemizedlist>
 </sect1>
 <sect1 xml:id="sec.raidroot.setup">
  <title>
   为根 (<filename>/</filename>) 分区设置具有软件 RAID 设备的系统
  </title>

  <procedure>
   <step>
    <para>
     使用 YaST 启动安装，并按照<xref linkend="cha.inst"/>中的说明继续操作，直到达到<guimenu>建议的分区</guimenu>步骤为止。
    </para>
   </step>
   <step>
    <para>
     单击<guimenu>专家分区程序</guimenu>以打开自定义分区程序。
    </para>
   </step>
   <step>
    <para>
     （可选）如果有要使用的 iSCSI 目标设备，则需要从屏幕右下方的部分中选择<menuchoice>
     <guimenu>设置</guimenu> <guimenu>配置 iSCSI</guimenu>
     </menuchoice>，启用 iSCSI 发起程序软件。有关更多细节，请参见<xref linkend="cha.iscsi"/>。
    </para>
   </step>
   <step>
    <para>
     （可选）如果要对设备使用多个 I/O 路径，则需要通过从屏幕右下方的部分中选择<menuchoice>
     <guimenu>设置</guimenu> <guimenu>配置多路径</guimenu>
     <guimenu>是</guimenu> </menuchoice> ，启用多路径支持。
    </para>
   </step>
   <step>
    <para>
     （可选）如果您既未配置 iSCSI 又未设置多路径，则会显示默认的建议设置。单击<guimenu>重扫描设备</guimenu>以删除它们。
    </para>
   </step>

   <step>
    <para>
     为要用于软件 RAID 的每个设备设置 <guimenu>0xFD Linux RAID</guimenu> 格式。应该为 <filename>/</filename>、<filename>/boot/efi</filename> 或交换分区使用 RAID。
    </para>
    <substeps performance="required">
     <step>
      <para>
       在左侧面板中，选择<guimenu>硬盘</guimenu> 并选择要使用的设备，然后单击<guimenu>添加分区</guimenu>。
      </para>
     </step>
     <step>
      <para>
       在<guimenu>新分区类型</guimenu>下，选择<guimenu>主分区</guimenu>，然后单击<guimenu>下一步</guimenu>。
      </para>
     </step>
     <step>
      <para>
       在<guimenu>新分区大小</guimenu>下，指定要使用的大小，然后单击<guimenu>下一步</guimenu>。
      </para>
     </step>
     <step>
      <para>
       在<guimenu>角色</guimenu>下，选择<guimenu>原始磁盘（未格式化）</guimenu>。
      </para>
     </step>
     <step>
      <para>
       选择<guimenu>不格式化</guimenu>，并将<guimenu>文件系统 ID</guimenu>设置为 <guimenu>0xFD Linux RAID</guimenu>。
      </para>
     </step>
     <step>
      <para>
       单击<guimenu>完成</guimenu>，并对第二个分区重复这些步骤。
      </para>
      <informalfigure>
       <mediaobject>
        <imageobject role="fo">
         <imagedata fileref="raid_yast_install2_a.png" width="80%" format="PNG"/>
        </imageobject>
        <imageobject role="html">
         <imagedata fileref="raid_yast_install2_a.png" width="100%" format="PNG"/>
        </imageobject>
       </mediaobject>
      </informalfigure>
     </step>
    </substeps>
   </step>
   <step>
    <para>
     为 <filename>/</filename> 分区创建 RAID 设备。
    </para>
    <substeps performance="required">
     <step>
      <para>
       在左侧面板中，选择<guimenu>RAID</guimenu>，然后选择<guimenu>添加 RAID</guimenu>。
      </para>
     </step>
     <step>
      <para>
       为 <filename>/</filename> 分区设置所需的 <guimenu>RAID 类型</guimenu>，并将 <guimenu>RAID 名称</guimenu>设置为 <literal>system</literal>。
      </para>
     </step>
     <step>
      <para>
       从<guimenu>可用的设备</guimenu>部分中选择您在上一步中准备好的两个 RAID 设备并<guimenu>添加</guimenu>它们。
      </para>
      <informalfigure>
       <mediaobject>
        <imageobject role="fo">
         <imagedata fileref="raid_yast_install3_a.png" width="80%" format="PNG"/>
        </imageobject>
        <imageobject role="html">
         <imagedata fileref="raid_yast_install3_a.png" width="100%" format="PNG"/>
        </imageobject>
       </mediaobject>
      </informalfigure>
      <para>
       单击<guimenu>下一步</guimenu>继续。
      </para>
     </step>
     <step>
      <para>
       在 <guimenu>RAID 选项</guimenu>下，从下拉框中选择大块大小。保留默认设置是安全的做法。
      </para>
     </step>
     <step>
      <para>
       在<guimenu>角色</guimenu>下选择<guimenu>操作系统</guimenu>，然后单击<guimenu>完成</guimenu>继续。
      </para>
     </step>
     <step>
      <para>
       选择<guimenu>文件系统</guimenu>并将安装点设置为 <filename>/</filename>。单击<filename>完成</filename>退出该对话框。
      </para>
     </step>

    </substeps>
   </step>
   <step>
    <para>
     软件 RAID 设备便会受设备映射程序的管理，并会在 <filename>/dev/md/system</filename> 路径下创建一个设备。
    </para>
   </step>
   <step>
    <para>
     （可选）对于 UEFI 计算机，使用类似的步骤来创建 <filename>/boot/efi</filename> 装入分区。请记住，<filename>/boot/efi</filename> 仅支持 RAID 1，需要使用 FAT 文件系统来格式化该分区。
    </para>
    <figure>
     <title>RAID 上的 <guimenu>/</guimenu>、<guimenu>/boot/efi</guimenu> 和交换分区</title>
     <mediaobject>
      <imageobject role="fo">
       <imagedata fileref="raid_yast_install3_b.png" width="70%" format="PNG"/>
      </imageobject>
      <imageobject role="html">
       <imagedata fileref="raid_yast_install3_b.png" width="70%" format="PNG"/>
      </imageobject>
     </mediaobject>
    </figure>
   </step>
   <step>
    <para>
     单击<guimenu>接受</guimenu>结束分区程序。
    </para>
    <para>
     <guimenu>建议的分区</guimenu>页面上会显示新的建议。
    </para>
   </step>
   <step>
    <para>
     继续安装。对于包含独立 <filename>/boot/efi</filename> 分区的 UEFI 计算机，请在<guimenu>安装设置</guimenu>屏幕上单击<guimenu>引导</guimenu>，然后将<guimenu>引导加载程序</guimenu>设置为 <guimenu>GRUB2 for EFI</guimenu>。检查<guimenu>启用安全引导支持</guimenu>选项是否已激活。
    </para>
    <para>
     只要重引导服务器，设备映射程序就会在引导时启动，以便自动识别软件 RAID，并可在根 (/) 分区上启动操作系统。
    </para>
   </step>
  </procedure>
 </sect1>
</chapter>
