<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sect1 PUBLIC "-//Novell//DTD NovDoc XML V1.0//EN" "novdocx.dtd">
<!--
*********************************
Please see LICENSE.txt for this document's license.
*********************************
-->
<sect1 xml:base="update_split_brain.xml" id="sec.update.split-brain">
 <title>Mise à jour de type « atomic »</title>

 <para>
  La mise à jour de type « atomic » est basée sur des outils permettant de gérer deux copies du système et de récupérer facilement les données en cas d'échec de la mise à jour. Les outils fournis requièrent une configuration de partition de disque spécifique. Chaque copie du système réside sur une partition principale propre. Si une mise à jour échoue, vous pouvez toujours revenir à l'état précédent du système, disponible sur l'autre partition.
 </para>



 <sect2 id="cha.update.split-brain.setup">
  <title>Installation</title>
  <warning>
   <title>configuration de partitionnement stricte</title>
   <para>
    La mise en œuvre du partitionnement de disque doit respecter des exigences strictes : la première partition root, <filename>/dev/sda1</filename>, ne doit pas occuper plus de la moitié de l'espace disque. Les outils créent ensuite <filename>/dev/sda2</filename> pour la seconde partition root du système. Les autres partitions, le cas échéant, sont partagées sur les deux partitions root. Vous devez ainsi prendre leur taille en compte et réduire la taille de la première partition de façon appropriée (il s'agit d'un calcul approximatif) :
   </para>
   <para>
    La taille du disque complet moins la taille de <systemitem>sda1</systemitem> moins <systemitem>sda2</systemitem> représente l'espace libre destiné aux partitions supplémentaires.
   </para>
  </warning>
  <procedure>
   <step performance="required">
    <para>
     Installez le système à l'aide de <filename>/dev/sda1</filename> en tant que partition root unique occupant moins de la moitié de la taille entière du disque.
    </para>
   </step>
   <step performance="required">
    <para>
     Personnalisez le système installé si nécessaire. Assurez-vous que le paquetage <systemitem>multi-update-tools</systemitem> est installé.
    </para>
   </step>
   <step performance="required">
    <para>
     Exécutez <command>multi-update-setup --partition</command>, qui crée la seconde partition root du système (<filename>/dev/sda2</filename>) de taille similaire.
    </para>
   </step>
   <step performance="required">
    <para>
     Partitionnez le reste du disque si nécessaire et poursuivez les personnalisations (*).
    </para>
   </step>
   <step performance="required">
    <para>
     Exécutez <command>multi-update-setup --clone</command> pour copier le système sur l'autre partition. Cette commande permet également de changer l'entrée <filename>/</filename> (root) dans le répertoire <filename>/etc/fstab</filename> du système cible.
    </para>
   </step>
   <step performance="required">
    <para>
     Si nécessaire, effectuez d'autres personnalisations(*).
    </para>
   </step>
   <step performance="required">
    <para>
     Exécutez <command>multi-update-setup --bootloader</command> pour initialiser la configuration du chargeur de démarrage. Le menu du chargeur de démarrage contiendra ensuite une entrée permettant de démarrer l'autre système.
    </para>
    <warning>
     <title>chargeur de démarrage GRUB 2 obligatoire</title>
     <para>
      L'installation du chargeur de démarrage GRUB 2 est obligatoire. Les outils ne sont pas compatibles avec d'autres chargeurs de démarrage.
     </para>
    </warning>
   </step>
   <step performance="required">
    <para>
     S'il n'y a aucune personnalisation à effectuer marquée d'une astérisque (*), exécutez <command>multi-update-setup --complete</command> pour effectuer les trois étapes.
    </para>
   </step>
  </procedure>
 </sect2>



 <sect2 id="cha.update.split-brain.updating">
  <title>Mise à jour de l'autre système</title>
  <para>
   Exécutez <command>multi-update</command>. Cette commande exécute <command>zypper</command> dans un environnement <systemitem>chroot</systemitem> et met à jour l'autre système, quel que soit celui qui est actif. Son menu de démarrage affiche l'heure de démarrage par défaut.
  </para>
 </sect2>



 <sect2 id="cha.update.split-brain.touble">
  <title>Dépannage</title>
  <para>
   Si le chargeur de démarrage du système mis à jour est endommagé après la mise à jour, vous devez modifier l'indicateur <quote>Actif</quote> et le définir pour la partition root de l'autre système afin de le démarrer.
  </para>
  <para>
   Si le système mis à jour ne démarre pas du tout, vous devez accéder au menu du chargeur de démarrage et sélectionner l'autre système.
  </para>
  <para>
   Pour plus d'informations sur GRUB 2, reportez-vous au <xref linkend="cha.grub2"/>.
  </para>
 </sect2>

 <sect2 id="cha.update.split-brain.limitation">
  <title>Limitation</title>
  <para>
   La partition root doit être montée par nom, par ID ou d'une autre manière. Le montage par UUID de partition ou par libellé n'est pas pris en charge.
  </para>
 </sect2>



 <sect2 id="cha.update.split-brain.info">
  <title>Pour plus d'informations</title>
  <para>
   Pour plus d'informations, reportez-vous au fichier situé sous <filename>/usr/share/doc/packages/multi-update-tools/README</filename> fourni avec le paquetage <systemitem>multi-update-tools</systemitem>.
  </para>
 </sect2>
</sect1>
