<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE chapter
[
  <!ENTITY % entities SYSTEM "entity-decl.ent">
    %entities;
]>

<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" version="5.0" xml:id="cha.trouble">
 <title>Common Problems and Their Solutions</title>
 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:bugtracker></dm:bugtracker>
   <dm:translation>yes</dm:translation>
  </dm:docmanager>
 </info>
 <para>
  This chapter describes a range of potential problems and their solutions.
  Even if your situation is not precisely listed here, there may be one similar
  enough to offer hints to the solution of your problem.
 </para>
 <sect1 xml:id="sec.trouble.info">
  <title>Finding and Gathering Information</title>

  <para>
   Linux reports things in a very detailed way. There are several places to
   look when you encounter problems with your system, most of which are
   standard to Linux systems in general, and some are relevant to &productname;
   systems. Most log files can be viewed with &yast; (<menuchoice>
   <guimenu>Miscellaneous</guimenu> <guimenu>Start-Up Log</guimenu>
   </menuchoice>).
  </para>

<!-- fs 2010-05-21:
    Weird location for this paragraph - completely out of context (support).
    Move to a better location

    Profiling, since the support query module is not available for openSUSE.
-->

  <para>
   &yast; offers the possibility to collect all system information
   needed by the support team. Use <menuchoice>
<!-- TODO check this vvvvvv -->
   <guimenu>Other</guimenu> <guimenu>Support</guimenu> </menuchoice> and select
   the problem category. When all information is gathered, attach it to your
   support request.
  </para>

  <para>
   A list of the most frequently checked log files follows with the description
   of their typical purpose. Paths containing <filename>~</filename> refer to
   the current user's home directory.
  </para>

  <table xml:id="tab.trouble.info">
   <title>Log Files</title>
   <tgroup cols="2">
    <thead>
     <row>
      <entry>
       <para>
        Log File
       </para>
      </entry>
      <entry>
       <para>
        Description
       </para>
      </entry>
     </row>
    </thead>
    <tbody>
     <row>
      <entry>
       <para>
        <filename>~/.xsession-errors</filename>
       </para>
      </entry>
      <entry>
       <para>
        Messages from the desktop applications currently running.
       </para>
      </entry>
     </row>
     <row>
      <entry>
       <para>
        <filename>/var/log/apparmor/</filename>
       </para>
      </entry>
      <entry>
       <para>
        Log files from AppArmor, see <xref linkend="part.apparmor"/> for
        detailed information.
       </para>
      </entry>
     </row>
     <row>
      <entry>
       <para>
        <filename>/var/log/audit/audit.log</filename>
       </para>
      </entry>
      <entry>
       <para>
        Log file from Audit to track any access to files, directories, or
        resources of your system, and trace system calls. See
        <xref linkend="part.audit"/> for detailed information.
       </para>
      </entry>
     </row>
<!-- 2014-06-04 tbazant: now part of journald
     <row>
      <entry>
       <para>
        <filename>/var/log/boot.msg</filename>
       </para>
      </entry>
      <entry>
       <para>
        Messages from the kernel reported during the boot process.
       </para>
      </entry>
     </row> -->
     <row>
      <entry>
       <para>
        <filename>/var/log/mail.*</filename>
       </para>
      </entry>
      <entry>
       <para>
        Messages from the mail system.
       </para>
      </entry>
     </row>
<!-- 2014-06-24 fs: now part of journald
     <row>
      <entry>
       <para>
        <filename>/var/log/messages</filename>
       </para>
      </entry>
      <entry>
       <para>
        Ongoing messages from the kernel and system log daemon (when
        running).
       </para>
      </entry>
     </row>
-->
     <row>
      <entry>
       <para>
        <filename>/var/log/NetworkManager</filename>
       </para>
      </entry>
      <entry>
       <para>
        Log file from &nm; to collect problems with network connectivity
       </para>
      </entry>
     </row>
     <row>
      <entry>
       <para>
        <filename>/var/log/samba/</filename>
       </para>
      </entry>
      <entry>
       <para>
        Directory containing Samba server and client log messages.
       </para>
      </entry>
     </row>
     <row>
      <entry>
       <para>
        <filename>/var/log/warn</filename>
       </para>
      </entry>
      <entry>
       <para>
        All messages from the kernel and system log daemon with the
        <quote>warning</quote> level or higher.
       </para>
      </entry>
     </row>
     <row>
      <entry>
       <para>
        <filename>/var/log/wtmp</filename>
       </para>
      </entry>
      <entry>
       <para>
        Binary file containing user login records for the current machine
        session. View it with <command>last</command>.
       </para>
      </entry>
     </row>
     <row>
      <entry>
       <para>
        <filename>/var/log/Xorg.*.log</filename>
       </para>
      </entry>
      <entry>
       <para>
        Various start-up and runtime log files from the X Window System. It is
        useful for debugging failed X start-ups.
       </para>
      </entry>
     </row>
     <row>
      <entry>
       <para>
        <filename>/var/log/YaST2/</filename>
       </para>
      </entry>
      <entry>
       <para>
        Directory containing &yast;'s actions and their results.
       </para>
      </entry>
     </row>
     <row>
      <entry>
       <para>
        <filename>/var/log/zypper.log</filename>
       </para>
      </entry>
      <entry>
       <para>
        Log file of Zypper.
       </para>
      </entry>
     </row>
    </tbody>
   </tgroup>
  </table>

  <para>
   Apart from log files, your machine also supplies you with information about
   the running system. See
   <xref linkend="tab.trouble.system" xrefstyle="select:label title nopage"/>
  </para>

  <table xml:id="tab.trouble.system">
   <title>System Information With the <filename>/proc</filename> File System</title>
   <tgroup cols="2">
    <thead>
     <row>
      <entry>
       <para>
        File
       </para>
      </entry>
      <entry>
       <para>
        Description
       </para>
      </entry>
     </row>
    </thead>
    <tbody>
     <row>
      <entry>
       <para>
        <filename>/proc/cpuinfo</filename>
       </para>
      </entry>
      <entry>
       <para>
        Contains processor information, including its type, make, model, and
        performance.
       </para>
      </entry>
     </row>
     <row>
      <entry>
       <para>
        <filename>/proc/dma</filename>
       </para>
      </entry>
      <entry>
       <para>
        Shows which DMA channels are currently being used.
       </para>
      </entry>
     </row>
     <row>
      <entry>
       <para>
        <filename>/proc/interrupts</filename>
       </para>
      </entry>
      <entry>
       <para>
        Shows which interrupts are in use, and how many of each have been in
        use.
       </para>
      </entry>
     </row>
     <row>
      <entry>
       <para>
        <filename>/proc/iomem</filename>
       </para>
      </entry>
      <entry>
       <para>
        Displays the status of I/O (input/output) memory.
       </para>
      </entry>
     </row>
     <row>
      <entry>
       <para>
        <filename>/proc/ioports</filename>
       </para>
      </entry>
      <entry>
       <para>
        Shows which I/O ports are in use at the moment.
       </para>
      </entry>
     </row>
     <row>
      <entry>
       <para>
        <filename>/proc/meminfo</filename>
       </para>
      </entry>
      <entry>
       <para>
        Displays memory status.
       </para>
      </entry>
     </row>
     <row>
      <entry>
       <para>
        <filename>/proc/modules</filename>
       </para>
      </entry>
      <entry>
       <para>
        Displays the individual modules.
       </para>
      </entry>
     </row>
     <row>
      <entry>
       <para>
        <filename>/proc/mounts</filename>
       </para>
      </entry>
      <entry>
       <para>
        Displays devices currently mounted.
       </para>
      </entry>
     </row>
     <row>
      <entry>
       <para>
        <filename>/proc/partitions</filename>
       </para>
      </entry>
      <entry>
       <para>
        Shows the partitioning of all hard disks.
       </para>
      </entry>
     </row>
     <row>
      <entry>
       <para>
        <filename>/proc/version</filename>
       </para>
      </entry>
      <entry>
       <para>
        Displays the current version of Linux.
       </para>
      </entry>
     </row>
    </tbody>
   </tgroup>
  </table>

  <para>
   Apart from the <filename>/proc</filename> file system, the Linux kernel
   exports information with the <literal>sysfs</literal> module, an in-memory
   file system. This module represents kernel objects, their attributes and
   relationships. For more information about <literal>sysfs</literal>, see the
   context of udev in <xref linkend="cha.udev"/>.
   <xref linkend="tab.trouble.sysfs" xrefstyle="select:label nopage"/> contains
   an overview of the most common directories under <filename>/sys</filename>.
  </para>

  <table xml:id="tab.trouble.sysfs">
   <title>System Information With the <filename>/sys</filename> File System</title>
   <tgroup cols="2">
    <thead>
     <row>
      <entry>
       <para>
        File
       </para>
      </entry>
      <entry>
       <para>
        Description
       </para>
      </entry>
     </row>
    </thead>
    <tbody>
     <row>
      <entry>
       <para>
        <filename>/sys/block</filename>
       </para>
      </entry>
      <entry>
       <para>
        Contains subdirectories for each block device discovered in the system.
        Generally, these are mostly disk type devices.
       </para>
      </entry>
     </row>
     <row>
      <entry>
       <para>
        <filename>/sys/bus</filename>
       </para>
      </entry>
      <entry>
       <para>
        Contains subdirectories for each physical bus type.
       </para>
      </entry>
     </row>
     <row>
      <entry>
       <para>
        <filename>/sys/class</filename>
       </para>
      </entry>
      <entry>
       <para>
        Contains subdirectories grouped together as a functional types of
        devices (like graphics, net, printer, etc.)
       </para>
      </entry>
     </row>
     <row>
      <entry>
       <para>
        <filename>/sys/device</filename>
       </para>
      </entry>
      <entry>
       <para>
        Contains the global device hierarchy.
       </para>
      </entry>
     </row>
    </tbody>
   </tgroup>
  </table>

  <para>
   Linux comes with several tools for system analysis and monitoring. See
   <xref linkend="cha.util"/> for a selection of the most important ones used
   in system diagnostics.
  </para>

  <para>
   Each of the following scenarios begins with a header describing the problem
   followed by a paragraph or two offering suggested solutions, available
   references for more detailed solutions, and cross-references to other
   scenarios that are related.
  </para>
 </sect1>

 <sect1 xml:id="sec.trouble.boot">
  <title>Boot Problems</title>

  <para>
   Boot problems are situations when your system does not boot properly (does
   not boot to the expected target and login screen).
  </para>

  <sect2 xml:id="sec.trouble.boot.nogrub">
   <title>The &grub; Boot Loader Fails to Load</title>
   <para>
    If the hardware is functioning properly, it is possible that the boot
    loader is corrupted and Linux cannot start on the machine. In this case, it
    is necessary to repair the boot loader. To do so, you need to start the
    Rescue System as described in
    <xref linkend="sec.trouble.data.recover.rescue"/> and follow the
    instructions in <xref linkend="sec.trouble.data.recover.rescue.grub"/>.
   </para>
   <para>
    Alternatively, you can use the Rescue System to fix the boot loader as
    follows. Boot your machine from the installation media. In the boot screen,
    choose <menuchoice><guimenu>More</guimenu> <guimenu>Boot Linux
    System</guimenu></menuchoice>. Select the disk containing the installed
    system and kernel with the default kernel options.
   </para>

   <figure xml:id="fig.rescue.selectdisk" os="osuse">
    <title>Select Disk</title>
    <mediaobject>
     <imageobject role="fo">
      <imagedata fileref="rescue_select_disk.png" width="50%" format="PNG"/>
     </imageobject>
     <imageobject role="html">
      <imagedata fileref="rescue_select_disk.png" width="50%" format="PNG"/>
     </imageobject>
    </mediaobject>
   </figure>

   <para>
    When the system is booted, start &yast; and switch to
    <menuchoice><guimenu>System</guimenu> <guimenu>Boot
    Loader</guimenu></menuchoice>. Make sure that the <guimenu>Write generic
    Boot Code to MRB</guimenu> option is enabled, and press
    <guimenu>OK</guimenu>. This fixes the corrupted boot loader by overwriting
    it, or installs the boot loader if it is missing.
   </para>

   <para>
    Other reasons for the machine not booting may be BIOS-related:
   </para>
   <variablelist>
    <varlistentry>
     <term>BIOS Settings</term>
     <listitem>
      <para>
       Check your BIOS for references to your hard disk. &grub; may simply not
       be started if the hard disk itself cannot be found with the current BIOS
       settings.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>BIOS Boot Order</term>
     <listitem>
      <para>
       Check whether your system's boot order includes the hard disk. If the
       hard disk option was not enabled, your system may install properly, but
       fails to boot when access to the hard disk is required.
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
  </sect2>

  <sect2 xml:id="sec.trouble.boot.hang" os="sled;osuse">
   <title>No Login or Prompt Appears</title>
   <para>
    This behavior typically occurs after a failed kernel upgrade and it is
    known as a <emphasis>kernel panic</emphasis> because of the type of error
    on the system console that sometimes can be seen at the final stage of the
    process. If, in fact, the machine has just been rebooted following a
    software update, the immediate goal is to reboot it using the old, proven
    version of the Linux kernel and associated files. This can be done in the
    &grub; boot loader screen during the boot process as follows:
   </para>
   <procedure>
    <step>
     <para>
      Reboot the computer using the reset button, or switch it off and on
      again.
     </para>
    </step>
    <step>
     <para>
      When the &grub; boot screen becomes visible, select the <guimenu>Advanced
      Options</guimenu> entry and choose the previous kernel from the menu. The
      machine will boot using the prior version of the kernel and its
      associated files.
     </para>
    </step>
    <step xml:id="st.trouble.boot.hang.modify_grub">
     <para>
      After the boot process has completed, remove the newly installed kernel
      and, if necessary, set the default boot entry to the old kernel using the
      &yast; <guimenu>Boot Loader</guimenu> module. For more information refer
      to <xref linkend="sec.grub2.yast2.config"/>. However, doing this is
      probably not necessary because automated update tools normally modify it
      for you during the rollback process.
     </para>
    </step>
    <step>
     <para>
      Reboot.
     </para>
    </step>
   </procedure>
   <para>
    If this does not fix the problem, boot the computer using the installation
    media. After the machine has booted, continue with
    <xref linkend="st.trouble.boot.hang.modify_grub" xrefstyle="StepOnPage"/>.
   </para>
  </sect2>

  <sect2 xml:id="sec.trouble.boot.prompt">
   <title>No Graphical Login</title>
   <para>
    If the machine starts, but does not boot into the graphical login
    manager, anticipate problems either with the choice of the default systemd
    target or the configuration of the X Window System. To check the current
    systemd default target run the command <command>sudo systemctl
    get-default</command>. If the value returned is <emphasis>not</emphasis>
    <literal>graphical.target</literal>, run the command <command>sudo
    systemctl isolate graphical.target</command>. If the graphical login screen
    starts, log in and start <menuchoice> <guimenu>&yast;</guimenu>
    <guimenu>System</guimenu> <guimenu>&ycc_runlevel;</guimenu></menuchoice>
    and set the <guimenu>Default System Target</guimenu> to <guimenu>Graphical
    Interface</guimenu>. From now on the system should boot into the graphical
    login screen.
   </para>
   <para>
    If the graphical login screen does not start even if having booted or
    switched to the graphical target, your desktop or X Window software is
    probably misconfigured or corrupted. Examine the log files at
    <filename>/var/log/Xorg.*.log</filename> for detailed messages from the X
    server as it attempted to start. If the desktop fails during start, it may
    log error messages to the system journal that can be queried with the
    command <command>journalctl</command> (see <xref linkend="cha.journalctl"/>
    for more information). If these error messages hint at a configuration
    problem in the X server, try to fix these issues. If the graphical system
    still does not come up, consider reinstalling the graphical desktop.
   </para>
<!--
   2014-08-20, tiwai
   startx doesn't work for normal user any longer.  Only root can do.
   <tip>
    <title>Starting X Window System Manually</title>
    <para>
     One quick test: the <command>startx</command> command should force the
     X Window System to start with the configured defaults if the user is
     currently logged in on the console. If that does not work, it should
     log errors to the console.
    </para>
   </tip>
   -->
  </sect2>

  <sect2 xml:id="sec.trouble.boot.btrfs">
   <title>Root Btrfs Partition Cannot Be Mounted</title>
   <para>
    If a <systemitem class="filesystem">btrfs</systemitem> root partition
    becomes corrupted, try the following options:
   </para>
   <itemizedlist>
    <listitem>
     <para>
      Mount the partition with the <option>-o recovery</option> option.
     </para>
    </listitem>
    <listitem>
     <remark>toms 2014-03-12: According to FATE#315126: "this one is open to debate, it might do more harm than good.."</remark>
     <para>
      If that fails, run <command>btrfs-zero-log</command> on your root
      partition.
     </para>
    </listitem>
   </itemizedlist>
  </sect2>

  <sect2 xml:id="sec.trouble.boot.forcecheck">
   <title>Force Checking Root Partitions</title>
   <remark>toms 2016-05-18: FATE#320126</remark>
   <para>
    If the root partition becomes corrupted, use the parameter
    <parameter>forcefsck</parameter> on the boot prompt. This passes the option
    <option>-f</option> (force) to the <command>fsck</command> command.
   </para>
  </sect2>
 </sect1>
 <sect1 xml:id="sec.trouble.login">
  <title>Login Problems</title>

  <para>
   Login problems occur when your machine does boot to the
   expected welcome screen or login prompt, but refuses to accept the user name
   and password, or accepts them but then does not behave properly (fails to
   start the graphic desktop, produces errors, drops to a command line, etc.).
  </para>

  <sect2 xml:id="sec.trouble.login.no">
   <title>Valid User Name and Password Combinations Fail</title>
   <para>
    This usually occurs when the system is configured to use network
    authentication or directory services and, for some reason, cannot retrieve
    results from its configured servers. The
    <systemitem class="username">root</systemitem> user, as the only local
    user, is the only user that can still log in to these machines. The
    following are some common reasons a machine appears functional but cannot
    process logins correctly:
   </para>
   <itemizedlist>
    <listitem>
     <para>
      The network is not working. For further directions on this, turn to
      <xref linkend="sec.trouble.netconfig"/>.
     </para>
    </listitem>
    <listitem>
     <para>
      DNS is not working at the moment (which prevents &gnome; from working and
      the system from making validated requests to secure servers). One
      indication that this is the case is that the machine takes an extremely
      long time to respond to any action. Find more information about this
      topic in <xref linkend="sec.trouble.netconfig"/>.
     </para>
    </listitem>
    <listitem>
     <para>
      If the system is configured to use Kerberos, the system's local time may
      have drifted past the accepted variance with the Kerberos server time
      (this is typically 300 seconds). If NTP (network time protocol) is not
      working properly or local NTP servers are not working, Kerberos
      authentication ceases to function because it depends on common clock
      synchronization across the network.
     </para>
    </listitem>
    <listitem>
     <para>
      The system's authentication configuration is misconfigured. Check the PAM
      configuration files involved for any typographical errors or misordering
      of directives. For additional background information about PAM and the
      syntax of the configuration files involved, refer to
      <xref linkend="cha.pam"/>.
     </para>
    </listitem>
    <listitem>
     <para>
      The home partition is encrypted. Find more information about this topic
      in <xref linkend="sec.trouble.login.encrypted"/>.
     </para>
    </listitem>
   </itemizedlist>
   <para>
    In all cases that do not involve external network problems, the solution is
    to reboot the system into single-user mode and repair the configuration
    before booting again into operating mode and attempting to log in again. To
    boot into single-user mode:
   </para>
   <procedure xml:id="proc.trouble.login.no">
    <step>
     <para>
      Reboot the system. The boot screen appears, offering a prompt.
     </para>
    </step>
<!--taroth 2014-03-10: added the following 4 steps to replace the following
     one (according to fs and grub2.xml  [id=grub2.menu.change],
     this should work, but I did not try it....):
     Enter <command>1</command> at the boot prompt to make the system
     boot into single-user mode. -
     -->
    <step>
     <para>
      Press <keycap function="escape"/> to exit the splash screen and get to
      the &grub; text-based menu.
     </para>
    </step>
    <step>
     <para>
      Press <keycap>B</keycap> to enter the &grub; editor.
     </para>
    </step>
    <step>
     <para>
      Add the following parameter to the line containing the kernel parameters:
     </para>
<screen>systemd.unit=rescue.target</screen>
    </step>
    <step>
     <para>
      Press <keycap>F10</keycap>.
     </para>
    </step>
    <step>
     <para>
      Enter the user name and password for
      <systemitem class="username">root</systemitem>.
     </para>
    </step>
    <step>
     <para>
      Make all the necessary changes.
     </para>
    </step>
    <step>
     <para>
      Boot into the full multiuser and network mode by entering
      <command>systemctl isolate graphical.target</command> at the command
      line.
     </para>
    </step>
   </procedure>
  </sect2>

  <sect2 xml:id="sec.trouble.login.pw">
   <title>Valid User Name and Password Not Accepted</title>
   <para>
    This is by far the most common problem users encounter, because there are
    many reasons this can occur. Depending on whether you use local user
    management and authentication or network authentication, login failures
    occur for different reasons.
   </para>
   <para>
    Local user management can fail for the following reasons:
   </para>
   <itemizedlist>
    <listitem>
     <para>
      The user may have entered the wrong password.
     </para>
    </listitem>
    <listitem>
     <para>
      The user's home directory containing the desktop configuration files is
      corrupted or write protected.
     </para>
    </listitem>
    <listitem>
     <para>
      There may be problems with the X Window System authenticating this
      particular user, especially if the user's home directory has been used
      with another Linux distribution prior to installing the current one.
     </para>
    </listitem>
   </itemizedlist>
   <para>
    To locate the reason for a local login failure, proceed as follows:
   </para>
   <procedure>
    <step>
     <para>
      Check whether the user remembered his password correctly before you start
      debugging the whole authentication mechanism. If the user may not
      remember his password correctly, use the &yast; User Management module to
      change the user's password. Pay attention to the <keycap>Caps
      Lock</keycap> key and unlock it, if necessary.
     </para>
    </step>
    <step>
     <para>
      Log in as <systemitem class="username">root</systemitem> and check the
      system journal with <command>journalctl -e</command> for error messages
      of the login process and of PAM.
     </para>
    </step>
    <step>
     <para>
      Try to log in from a console (using <keycombo>
      <keycap function="control"/> <keycap function="alt"/> <keycap>F1</keycap>
      </keycombo>). If this is successful, the blame cannot be put on PAM,
      because it is possible to authenticate this user on this machine. Try to
      locate any problems with the X Window System or the &gnome; desktop. For
      more information, refer to <xref linkend="sec.trouble.login.dk"/>.
     </para>
    </step>
    <step>
     <para>
      If the user's home directory has been used with another Linux
      distribution, remove the <filename>Xauthority</filename> file in the
      user's home. Use a console login via <keycombo>
      <keycap function="control"/> <keycap function="alt"/> <keycap>F1</keycap>
      </keycombo> and run <command>rm .Xauthority</command> as this user. This
      should eliminate X authentication problems for this user. Try graphical
      login again.
     </para>
    </step>
<!--
    <step>
     <para>
      If graphical login still fails, do a console login with <keycombo>
      <keycap function="control"/>
      <keycap function="alt"/> <keycap>F1</keycap> </keycombo>.
      Try to start an X session on another display&mdash;the first one
      (<literal>:0</literal>) is already in use:
     </para>
<screen>startx -\- :1</screen>
     <para>
      This should bring up a graphical screen and your desktop. If it does
      not, check the log files of the X Window System
      (<filename>/var/log/Xorg.<replaceable>DISPLAYNUMBER</replaceable>.log</filename>)
      or the log file for your desktop applications
      (<filename>.xsession-errors</filename> in the user's home directory)
      for any irregularities.
     </para>
    </step>
    -->
    <step>
     <para>
      If the desktop could not start because of corrupt configuration files,
      proceed with <xref linkend="sec.trouble.login.dk"/>.
     </para>
    </step>
   </procedure>
   <para>
    In the following, common reasons a network authentication for a particular
    user may fail on a specific machine are listed:
   </para>
   <itemizedlist>
    <listitem>
     <para>
      The user may have entered the wrong password.
     </para>
    </listitem>
    <listitem>
     <para>
      The user name exists in the machine's local authentication files and is
      also provided by a network authentication system, causing conflicts.
     </para>
    </listitem>
    <listitem>
     <para>
      The home directory exists but is corrupt or unavailable. Perhaps it is
      write protected or is on a server that is inaccessible at the moment.
     </para>
    </listitem>
    <listitem>
     <para>
      The user does not have permission to log in to that particular host in
      the authentication system.
     </para>
    </listitem>
    <listitem>
     <para>
      The machine has changed host names, for whatever reason, and the user
      does not have permission to log in to that host.
     </para>
    </listitem>
    <listitem>
     <para>
      The machine cannot reach the authentication server or directory server
      that contains that user's information.
     </para>
    </listitem>
    <listitem>
     <para>
      There may be problems with the X Window System authenticating this
      particular user, especially if the user's home has been used with another
      Linux distribution prior to installing the current one.
     </para>
    </listitem>
   </itemizedlist>
   <para>
    To locate the cause of the login failures with network authentication,
    proceed as follows:
   </para>
   <procedure xml:id="proc.trouble.login.pw">
    <step>
     <para>
      Check whether the user remembered their password correctly before you
      start debugging the whole authentication mechanism.
     </para>
    </step>
    <step>
     <para>
      Determine the directory server which the machine relies on for
      authentication and make sure that it is up and running and properly
      communicating with the other machines.
     </para>
    </step>
    <step>
     <para>
      Determine that the user's user name and password work on other machines
      to make sure that his authentication data exists and is properly
      distributed.
     </para>
    </step>
    <step>
     <para>
      See if another user can log in to the misbehaving machine. If another
      user can log in without difficulty or if
      <systemitem class="username">root</systemitem> can log in, log in and
      examine the system journal with <command>journalctl -e</command>&gt;
      file. Locate the time stamps that correspond to the login attempts and
      determine if PAM has produced any error messages.
     </para>
    </step>
    <step>
     <para>
      Try to log in from a console (using <keycombo>
      <keycap function="control"/> <keycap function="alt"/> <keycap>F1</keycap>
      </keycombo>). If this is successful, the problem is not with PAM or the
      directory server on which the user's home is hosted, because it is
      possible to authenticate this user on this machine. Try to locate any
      problems with the X Window System or the &gnome; desktop. For more
      information, refer to <xref linkend="sec.trouble.login.dk"/>.
     </para>
    </step>
    <step>
     <para>
      If the user's home directory has been used with another Linux
      distribution, remove the <filename>Xauthority</filename> file in the
      user's home. Use a console login via <keycombo>
      <keycap function="control"/> <keycap function="alt"/> <keycap>F1</keycap>
      </keycombo> and run <command>rm .Xauthority</command> as this user. This
      should eliminate X authentication problems for this user. Try graphical
      login again.
     </para>
    </step>
<!--
    <step>
     <para>
      If graphical login still fails, do a console login with <keycombo>
      <keycap function="control"/>
      <keycap function="alt"/> <keycap>F1</keycap> </keycombo>.
      Try to start an X session on another display&mdash;the first one
      (<literal>:0</literal>) is already in use:
     </para>
<screen>startx -\- :1</screen>
     <para>
      This should bring up a graphical screen and your desktop. If it does
      not, check the log files of the X Window System
      (<filename>/var/log/Xorg.<replaceable>DISPLAYNUMBER</replaceable>.log</filename>)
      or the log file for your desktop applications
      (<filename>.xsession-errors</filename> in the user's home directory)
      for any irregularities.
     </para>
    </step>
    -->
    <step>
     <para>
      If the desktop could not start because of corrupt configuration files,
      proceed with <xref linkend="sec.trouble.login.dk"/>.
     </para>
    </step>
   </procedure>
  </sect2>

  <sect2 xml:id="sec.trouble.login.encrypted">
   <title>Login to Encrypted Home Partition Fails</title>
   <para>
    It is recommended to use an encrypted home partition for laptops. If you
    cannot log in to your laptop, the reason is usually simple: your partition
    could not be unlocked.
   </para>
   <para>
    During the boot time, you need to enter the passphrase to unlock your
    encrypted partition. If you do not enter it, the boot process continues,
    leaving the partition locked.
   </para>
   <para>
    To unlock your encrypted partition, proceed as follows:
   </para>
   <procedure>
    <step>
     <para>
      Switch to the text console with <keycombo> <keycap function="control"/>
      <keycap function="alt"/> <keycap>F1</keycap> </keycombo>.
     </para>
    </step>
    <step>
     <para>
      Become <systemitem class="username">root</systemitem>.
     </para>
    </step>
    <step>
     <para>
      Restart the unlocking process again with:
     </para>
<screen>&prompt.root;systemctl restart home.mount</screen>
    </step>
    <step>
     <para>
      Enter your passphrase to unlock your encrypted partition.
     </para>
    </step>
    <step>
     <para>
      Exit the text console and switch back to the login screen with <keycombo>
      <keycap function="alt"/> <keycap>F7</keycap> </keycombo>.
     </para>
    </step>
    <step>
     <para>
      Log in as usual.
     </para>
    </step>
   </procedure>
  </sect2>

  <sect2 xml:id="sec.trouble.login.dk">
   <title>Login Successful but &gnome; Desktop Fails</title>
   <para>
    If this is the case, it is likely that your &gnome; configuration files
    have become corrupted. Some symptoms may include the keyboard failing to
    work, the screen geometry becoming distorted, or even the screen coming up
    as a bare gray field. The important distinction is that if another user
    logs in, the machine works normally. It is then likely that the problem can
    be fixed relatively quickly by simply moving the user's &gnome;
    configuration directory to a new location, which causes &gnome; to
    initialize a new one. Although the user is forced to reconfigure &gnome;,
    no data is lost.
   </para>
   <procedure xml:id="proc.trouble.login.dk">
    <step>
     <para>
      Switch to a text console by pressing <keycombo>
      <keycap function="control"/> <keycap function="alt"/> <keycap>F1</keycap>
      </keycombo>.
     </para>
    </step>
    <step>
     <para>
      Log in with your user name.
     </para>
    </step>
    <step>
     <para>
      Move the user's &gnome; configuration directories to a temporary
      location:
     </para>
<screen>&prompt.user;mv .gconf  .gconf-ORIG-RECOVER
&prompt.user;mv .gnome2 .gnome2-ORIG-RECOVER</screen>
    </step>
    <step>
     <para>
      Log out.
     </para>
    </step>
    <step>
     <para>
      Log in again, but do not run any applications.
     </para>
    </step>
    <step>
     <para>
      Recover your individual application configuration data (including the
      Evolution e-mail client data) by copying the
      <filename>~/.gconf-ORIG-RECOVER/apps/</filename> directory back into the
      new <filename>~/.gconf </filename> directory as follows:
     </para>
<screen>&prompt.user;cp -a .gconf-ORIG-RECOVER/apps .gconf/</screen>
     <para>
      If this causes the login problems, attempt to recover only the critical
      application data and reconfigure the remainder of the applications.
     </para>
    </step>
   </procedure>
  </sect2>
 </sect1>
 <sect1 xml:id="sec.trouble.netconfig">
  <title>Network Problems</title>

  <para>
   Many problems of your system may be network-related, even though they do not
   seem to be at first. For example, the reason for a system not allowing users
   to log in may be a network problem of some kind. This section introduces a
   simple checklist you can apply to identify the cause of any network problem
   encountered.
  </para>

  <procedure xml:id="proc.trouble.config.net">
   <title>How to Identify Network Problems</title>
   <para>
    When checking the network connection of your machine, proceed as follows:
   </para>
   <step>
    <para>
     If you use an Ethernet connection, check the hardware first. Make sure
     that your network cable is properly plugged into your computer and router
     (or hub, etc.). The control lights next to your Ethernet connector are
     normally both be active.
    </para>
    <para>
     If the connection fails, check whether your network cable works with
     another machine. If it does, your network card causes the failure. If hubs
     or switches are included in your network setup, they may be faulty, as
     well.
    </para>
   </step>
   <step>
    <para>
     If using a wireless connection, check whether the wireless link can be
     established by other machines. If not, contact the wireless network's
     administrator.
    </para>
   </step>
   <step>
    <para>
     Once you have checked your basic network connectivity, try to find out
     which service is not responding. Gather the address information of all
     network servers needed in your setup. Either look them up in the
     appropriate &yast; module or ask your system administrator. The following
     list gives some typical network servers involved in a setup together with
     the symptoms of an outage.
    </para>
    <variablelist>
     <varlistentry>
      <term>DNS (Name Service)</term>
      <listitem>
       <para>
        A broken or malfunctioning name service affects the network's
        functionality in many ways. If the local machine relies on any network
        servers for authentication and these servers cannot be found because of
        name resolution issues, users would not even be able to log in.
        Machines in the network managed by a broken name server would not be
        able to <quote>see</quote> each other and communicate.
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>NTP (Time Service)</term>
      <listitem>
       <para>
        A malfunctioning or completely broken NTP service could affect Kerberos
        authentication and X server functionality.
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>NFS (File Service)</term>
      <listitem>
       <para>
        If any application needs data stored in an NFS mounted directory, it
        cannot start or function properly if this service was down or
        misconfigured. In the worst case scenario, a user's personal desktop
        configuration would not come up if their home directory containing the
        <filename>.gconf</filename> subdirectory could not be found because of
        a faulty NFS server.
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>Samba (File Service)</term>
      <listitem>
       <para>
        If any application needs data stored in a directory on a faulty Samba
        server, it cannot start or function properly.
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>NIS (User Management)</term>
      <listitem>
       <para>
        If your &productname; system relies on a faulty NIS server to provide
        the user data, users cannot log in to this machine.
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>LDAP (User Management)</term>
      <listitem>
       <para>
        If your &productname; system relies on a faulty LDAP server to provide
        the user data, users cannot log in to this machine.
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>Kerberos (Authentication)</term>
      <listitem>
       <para>
        Authentication will not work and login to any machine fails.
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>CUPS (Network Printing)</term>
      <listitem>
       <para>
        Users cannot print.
       </para>
      </listitem>
     </varlistentry>
    </variablelist>
   </step>
   <step>
    <para>
     Check whether the network servers are running and whether your network
     setup allows you to establish a connection:
    </para>
    <important>
     <title>Limitations</title>
     <para>
      The debugging procedure described below only applies to a simple network
      server/client setup that does not involve any internal routing. It
      assumes both server and client are members of the same subnet without the
      need for additional routing.
     </para>
    </important>
    <substeps performance="required">
     <step>
      <para>
       Use <command>ping</command>
       <replaceable>IP_ADDRESS/HOSTNAME</replaceable>
       (replace with the host name or IP address of the server) to check whether
       each one of them is up and responding to the network. If this command is
       successful, it tells you that the host you were looking for is up and
       running and that the name service for your network is configured
       correctly.
      </para>
      <para>
       If ping fails with <literal>destination host unreachable</literal>,
       either your system or the desired server is not properly configured or
       down. Check whether your system is reachable by running
       <command>ping</command> <replaceable>IP address</replaceable> or
       <replaceable>YOUR_HOSTNAME</replaceable> from another machine. If you
       can reach your machine from another machine, it is the server that is
       not running or not configured correctly.
      </para>
      <para>
       If ping fails with <literal>unknown host</literal>, the name service is
       not configured correctly or the host name used was incorrect. For
       further checks on this matter, refer to
       <xref linkend="st.trouble.config.net.host" xrefstyle="StepOnPage"/>. If
       ping still fails, either your network card is not configured correctly
       or your network hardware is faulty.
      </para>
     </step>
     <step xml:id="st.trouble.config.net.host">
      <para>
       Use <command>host</command> <replaceable>HOSTNAME</replaceable> to
       check whether the host name of the server you are trying to connect to
       is properly translated into an IP address and vice versa. If this
       command returns the IP address of this host, the name service is up and
       running. If the <command>host</command> command fails, check all network
       configuration files relating to name and address resolution on your
       host:
      </para>
      <variablelist>
       <varlistentry>
        <term><filename>/etc/resolv.conf</filename>
        </term>
        <listitem>
         <para>
          This file is used to keep track of the name server and domain you are
          currently using. It can be modified manually or automatically
          adjusted by &yast; or DHCP. Automatic adjustment is preferable.
          However, make sure that this file has the following structure and all
          network addresses and domain names are correct:
         </para>
<screen>search <replaceable>FULLY_QUALIFIED_DOMAIN_NAME</replaceable>
nameserver <replaceable>IPADDRESS_OF_NAMESERVER</replaceable></screen>
         <para>
          This file can contain more than one name server address, but at least
          one of them must be correct to provide name resolution to your host.
          If needed, adjust this file using the &yast; Network Settings module
          (Hostname/DNS tab).
         </para>
         <para>
          If your network connection is handled via DHCP, enable DHCP to change
          host name and name service information by selecting <guimenu>Set
          Hostname via DHCP</guimenu> (can be set globally for any interface or
          per interface) and <guimenu>Update Name Servers and Search List via DHCP</guimenu>
          in the &yast; Network Settings module (Hostname/DNS tab).
         </para>
        </listitem>
       </varlistentry>
       <varlistentry>
        <term><filename>/etc/nsswitch.conf</filename>
        </term>
        <listitem>
         <para>
          This file tells Linux where to look for name service information. It
          should look like this:
         </para>
<screen> ...
hosts: files dns
networks: files dns
...</screen>
         <para>
          The <option>dns</option> entry is vital. It tells Linux to use an
          external name server. Normally, these entries are automatically
          managed by &yast;, but it would be prudent to check.
         </para>
         <para>
          If all the relevant entries on the host are correct, let your system
          administrator check the DNS server configuration for the correct zone
          information. <phrase os="sles;osuse">For detailed information about
          DNS, refer to <xref linkend="cha.dns"/>.</phrase> If you have made
          sure that the DNS configuration of your host and the DNS server are
          correct, proceed with checking the configuration of your network and
          network device.
         </para>
        </listitem>
       </varlistentry>
      </variablelist>
     </step>
     <step>
      <para>
       If your system cannot establish a connection to a network server and you
       have excluded name service problems from the list of possible culprits,
       check the configuration of your network card.
      </para>
      <para>
       Use the command <command>ip addr show</command>
       <replaceable>NETWORK_DEVICE</replaceable> to check whether this device
       was properly configured. Make sure that the <option>inet
       address</option> with the netmask
       (<literal>/<replaceable>MASK</replaceable></literal>) is configured
       correctly. An error in the IP address or a missing bit in your network
       mask would render your network configuration unusable. If necessary,
       perform this check on the server as well.
      </para>
     </step>
     <step>
      <para>
       If the name service and network hardware are properly configured and
       running, but some external network connections still get long time-outs
       or fail entirely, use <command>traceroute</command>
       <replaceable>FULLY_QUALIFIED_DOMAIN_NAME</replaceable> (executed as
       <systemitem class="username">root</systemitem>) to track the network
       route these requests are taking. This command lists any gateway (hop)
       that a request from your machine passes on its way to its destination.
       It lists the response time of each hop and whether this hop is
       reachable. Use a combination of traceroute and ping to track down the
       culprit and let the administrators know.
      </para>
     </step>
    </substeps>
   </step>
  </procedure>

  <para>
   Once you have identified the cause of your network trouble, you can resolve
   it yourself (if the problem is located on your machine) or let the system
   administrators of your network know about your findings so they can
   reconfigure the services or repair the necessary systems.
  </para>

  <sect2 xml:id="sec.trouble.networkmanager">
   <title>&nm; Problems</title>
   <remark>This is a bit small, needs more text.</remark>
   <para>
    If you have a problem with network connectivity, narrow it down as
    described in <xref linkend="proc.trouble.config.net"/>. If &nm; seems to be
    the culprit, proceed as follows to get logs providing hints on why &nm;
    fails:
   </para>
   <procedure>
    <step>
     <para>
      Open a shell and log in as
      <systemitem class="username">root</systemitem>.
     </para>
    </step>
    <step>
     <para>
      Restart the NetworkManager:
     </para>
<screen>&prompt.sudo;systemctl restart NetworkManager</screen>
    </step>
    <step>
     <para>
      Open a Web page, for example,
      <link xlink:href="http://www.opensuse.org"/> as normal user to see, if
      you can connect.
     </para>
    </step>
    <step>
     <para>
      Collect any information about the state of NetworkManager in
      <filename>/var/log/NetworkManager</filename>.
     </para>
    </step>
   </procedure>
   <para>
    For more information about NetworkManager, refer to
    <xref linkend="cha.nm"/>.
   </para>
  </sect2>
 </sect1>
 <sect1 xml:id="sec.trouble.data">
  <title>Data Problems</title>

  <para>
   Data problems are when the machine may or may not boot properly but, in
   either case, it is clear that there is data corruption on the system and
   that the system needs to be recovered. These situations call for a backup of
   your critical data, enabling you to recover the system state from before
   your system failed.
  </para>

  <sect2 xml:id="sec.trouble.data.partitions">
   <title>Managing Partition Images</title>
   <para>
    Sometimes you need to perform a backup from an entire partition or even
    hard disk. Linux comes with the <command>dd</command> tool which can create
    an exact copy of your disk. Combined with <command>gzip</command> you save
    some space.
   </para>
   <procedure>
    <title>Backing up and Restoring Hard Disks</title>
    <step>
     <para>
      Start a Shell as user &rootuser;.
     </para>
    </step>
    <step>
     <para>
      Select your source device. Typically this is something like
      <filename>/dev/sda</filename> (labeled as
      <replaceable>SOURCE</replaceable>).
     </para>
    </step>
    <step>
     <para>
      Decide where you want to store your image (labeled as
      <replaceable>BACKUP_PATH</replaceable>). It must be different from your
      source device. In other words: if you make a backup from
      <filename>/dev/sda</filename>, your image file must not to be stored
      under <filename>/dev/sda</filename>.
     </para>
    </step>
    <step>
     <para>
      Run the commands to create a compressed image file:
     </para>
<screen>&prompt.root;dd if=/dev/<replaceable>SOURCE</replaceable> | gzip &gt; /<replaceable>BACKUP_PATH</replaceable>/image.gz </screen>
    </step>
    <step>
     <para>
      Restore the hard disk with the following commands:
     </para>
<screen>&prompt.root;gzip -dc /<replaceable>BACKUP_PATH</replaceable>/image.gz | dd of=/dev/<replaceable>SOURCE</replaceable></screen>
    </step>
   </procedure>
   <para>
    If you only need to back up a partition, replace the
    <replaceable>SOURCE</replaceable> placeholder with your respective
    partition. In this case, your image file can lie on the same hard disk, but
    on a different partition.
   </para>
  </sect2>

<!-- TODO: please move this section to admin guide. Requirement from fate
    #305036 is:
- how and what to backup / recommendations
  o System configuration with YaST
- backup/restore recommentation:
  o customized config settings
  o ssh keys, certificates
  o system data backup (hints)
  o available backup tools
  o 3rd party backup tools (marketing task)
-->

<!-- 2014-063-14 tbazant: commenting out (FATE#308682)
  <sect2 id="sec.trouble.data.backup">
   <title>Backing Up Critical Data</title>
   <procedure id="proc.trouble.data.backup">
    <para>
     System backups can be easily managed using the &yast; System Backup
     module:
    </para>
    <step>
     <para>
      As &rootuser;, start &yast; and select <menuchoice>
      <guimenu>System</guimenu> <guimenu>System Backup</guimenu>
      </menuchoice>.
     </para>
    </step>
    <step>
     <para>
      Create a backup profile holding all details needed for the backup,
      file name of the archive file, scope, and type of the backup:
     </para>
     <substeps>
      <step>
       <para>
        Select <menuchoice> <guimenu>Profile Management</guimenu>
        <guimenu>Add</guimenu> </menuchoice>.
       </para>
      </step>
      <step>
       <para>
        Enter a name for the archive.
       </para>
      </step>
      <step>
       <para>
        Enter the path to the location of the backup if you want to keep a
        local backup. For your backup to be archived on a network server
        (via NFS), enter the IP address or name of the server and the
        directory that should hold your archive.
       </para>
      </step>
      <step>
       <para>
        Determine the archive type and click <guimenu>Next</guimenu>.
       </para>
      </step>
      <step>
       <para>
        Determine the backup options to use, such as whether files not
        belonging to any package should be backed up and whether a list of
        files should be displayed prior to creating the archive. Also
        determine whether changed files should be identified using the
        time-consuming MD5 mechanism.
       </para>
       <para>
        Use <guimenu>Expert</guimenu> to enter a dialog for the backup of
        entire hard disk areas. Currently, this option only applies to the
        Ext2 file system.
       </para>
      </step>
      <step>
       <para>
        Finally, set the search constraints to exclude certain system areas
        from the backup area that do not need to be backed up, such as lock
        files or cache files. Add, edit, or delete items until your needs
        are met and leave with <guimenu>OK</guimenu>.
       </para>
      </step>
     </substeps>
    </step>
    <step>
     <para>
      Once you have finished the profile settings, you can start the backup
      right away with <guimenu>Create Backup</guimenu> or configure
      automatic backup. It is also possible to create other profiles
      tailored for various other purposes.
     </para>
    </step>
   </procedure>
   <procedure id="proc.trouble.data.profile">
    <para>
     To configure automatic backup for a given profile, proceed as follows:
    </para>
    <step>
     <para>
      Select <guimenu>Automatic Backup</guimenu> from the <guimenu>Profile
      Management</guimenu> menu.
     </para>
    </step>
    <step>
     <para>
      Select <guimenu>Start Backup Automatically</guimenu>.
     </para>
    </step>
    <step>
     <para>
      Determine the backup frequency. Choose <guimenu>daily</guimenu>,
      <guimenu>weekly</guimenu>, or <guimenu>monthly</guimenu>.
     </para>
    </step>
    <step>
     <para>
      Determine the backup start time. These settings depend on the backup
      frequency selected.
     </para>
    </step>
    <step>
     <para>
      Decide whether to keep old backups and how many should be kept. To
      receive an automatically generated status message of the backup
      process, check <guimenu>Send Summary Mail to User root</guimenu>.
     </para>
    </step>
    <step>
     <para>
      Click <guimenu>OK</guimenu> to apply your settings and have the first
      backup start at the time specified.
     </para>
    </step>
   </procedure>
  </sect2>

  <sect2 id="sec.trouble.data.replay">
   <title>Restoring a System Backup</title>
   <para>
    Use the &yast; System Restoration module to restore the system
    configuration from a backup. Restore the entire backup or select
    specific components that were corrupted and need to be reset to their
    old state.
   </para>
   <procedure id="proc.trouble.data.replay">
    <step>
     <para>
      Start <menuchoice> <guimenu>&yast;</guimenu> <guimenu>System</guimenu>
      <guimenu>System Restoration</guimenu> </menuchoice>.
     </para>
    </step>
    <step>
     <para>
      Enter the location of the backup file. This could be a local file, a
      network mounted file, or a file on a removable device. Then click
      <guimenu>Next</guimenu>.
     </para>
     <para>
      The following dialog displays a summary of the archive properties,
      such as the file name, date of creation, type of backup, and optional
      comments.
     </para>
    </step>
    <step>
     <para>
      Review the archived content by clicking <guimenu>Archive
      Content</guimenu>. Clicking <guimenu>OK</guimenu> returns you to the
      <guimenu>Archive Properties</guimenu> dialog.
     </para>
    </step>
    <step>
     <para>
      <guimenu>Expert Options</guimenu> opens a dialog in which to fine-tune
      the restore process. Return to the <guimenu>Archive
      Properties</guimenu> dialog by clicking <guimenu>OK</guimenu>.
     </para>
    </step>
    <step>
     <para>
      Click <guimenu>Next</guimenu> to open the view of packages to restore.
      Press <guimenu>Accept</guimenu> to restore all files in the archive or
      use the various <guimenu>Select All</guimenu>, <guimenu>Deselect
      All</guimenu>, and <guimenu>Select Files</guimenu> buttons to
      fine-tune your selection. Only use the <guimenu>Restore RPM
      Database</guimenu> option if the RPM database is corrupted or deleted
      and this file is included in the backup.
     </para>
    </step>
    <step>
     <para>
      After you click <guimenu>Accept</guimenu>, the backup is restored.
      Click <guimenu>Finish</guimenu> to leave the module after the restore
      process is completed.
     </para>
    </step>
   </procedure>
  </sect2>
  -->

  <xi:include href="system_repair.xml"/>
 </sect1>
 <xi:include os="sles" arch="zseries" href="zseries_rescue_initrd.xml"/>
</chapter>
