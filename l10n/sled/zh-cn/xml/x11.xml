<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="x11.xml" version="5.0" xml:id="cha-gui-desktop">
 <title>图形用户界面</title>
 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:bugtracker/>
   <dm:translation>yes</dm:translation>
  </dm:docmanager>
  <abstract>
   <para>
    <phrase role="productname"><phrase os="sled">SUSE Linux Enterprise Desktop</phrase></phrase> 包含 X.org 服务器<phrase os="sled;osuse">、Wayland</phrase> 和 GNOME 桌面。本章介绍用于所有用户的图形用户界面配置。
   </para>
  </abstract>
 </info>
 <sect1 xml:id="sec-gui-desktop-xorg">
  <title>X Window 系统</title>
  <para>
   X.org 服务器是实施 X11 协议的事实上的标准。X 是基于网络的，可以使在一个主机上启动的应用程序显示在通过任何类型的网络（LAN 或互联网）连接的另一个主机上。
  </para>
  <para>
   在大多数情况下，X Window 系统不需要进行任何配置。X 启动期间会动态检测硬件。因此，<filename>xorg.conf</filename> 已被弃用。如果您仍然需要指定自定义选项来更改 X 的行为方式，还是可以通过修改 <filename>/etc/X11/xorg.conf.d/</filename> 下的配置文件来实现。
  </para>
  <para os="sled;osuse">
   <phrase role="productname"><phrase os="sled">SUSE Linux Enterprise Desktop</phrase></phrase> <phrase role="productnumber"><phrase os="sles;sled">15 SP6</phrase></phrase> 中包含 Wayland，作为 X.org 服务器的替代选择。安装期间可选择安装它。
  </para>
  
  <para>
   您可安装 <systemitem class="resource">xorg-docs</systemitem> 软件包以更深入地了解 X11。<command>man 5 xorg.conf</command> 提供了有关手动配置（如果需要）的格式的详细信息。有关 X11 开发的更多信息，请参见该项目的主页：<link xlink:href="https://www.x.org"/>。
  </para>

  <para>
   驱动程序位于 <systemitem>xf86-video-*</systemitem> 软件包中，例如 <systemitem>xf86-video-ati</systemitem>。相关手册页中详细说明了这些软件包附带的很多驱动程序。例如，如果您使用 <literal>ati</literal> 驱动程序，在 <command>man 4 ati</command> 中可以找到有关此驱动程序的更多信息。
  </para>

  <para>
   有关第三方驱动程序的信息位于 <filename>/usr/share/doc/packages/&lt;package_name&gt;</filename> 中。例如，<systemitem class="resource">x11-video-nvidiaG03</systemitem> 的文档在安装软件包之后位于 <filename>/usr/share/doc/packages/x11-video-nvidiaG04</filename> 中。
  </para>

  <para>
   在服务器上安装软件包 <systemitem class="resource">xrdp</systemitem>，并使用 RDP 客户端软件通过远程桌面协议访问服务器。
  </para>

 </sect1>
 <xi:include href="x11_fonts.xml"/>
 <sect1 xml:id="sec-gui-desktop-gnome">
  <title>适用于管理员的 GNOME 配置</title>

  <sect2 xml:id="sec-gui-desktop-gnome-dconf">
   <title><literal>dconf</literal> 系统</title>

   <para>
    GNOME 桌面的配置是使用 <literal>dconf</literal> 管理的。dconf 是按层次结构化的数据库或注册表，可让用户修改其个人设置，并可让系统管理员为所有用户设置默认值或强制值。<literal>dconf</literal> 取代了 GNOME 2 的 <literal>gconf</literal> 系统。
   </para>

   <para>
    使用 <command>dconf-editor</command> 可通过图形用户界面查看 <literal>dconf</literal> 选项。使用 <command>dconf</command> 可通过命令行访问和修改配置选项。
   </para>

   <para>
    GNOME <literal>Tweaks</literal> 工具提供易于使用的用户界面，其中包含不属于标准 GNOME 配置的其他配置选项。从 GNOME 应用程序菜单或在命令行中使用 <command>gnome-tweak-tool</command> 可启动该工具。
   </para>
  </sect2>

  <sect2 xml:id="sec-gui-desktop-gnome-global">
   <title>系统范围的配置</title>
   <para>
    全局 <literal>dconf</literal> 配置参数可在 <filename>/etc/dconf/db/</filename> 目录中设置，其中包括 GDM 的配置或针对用户锁定特定的配置选项。
   </para>
   <para>
    我们以下面的过程举例说明如何创建系统范围的配置：
   </para>
   <procedure>
    <step>
     <para>
      在 <filename>/etc/dconf/db/</filename> 中创建以 <literal>.d</literal> 结尾的新目录。此目录可包含任意数量的配置选项文本文件。在此例中，创建包含以下内容的文件 <filename>/etc/dconf/db/network.d/00-proxy</filename>：
     </para>
     <screen># This is a comment
[system/proxy/http]
host='10.0.0.1'
enabled=true</screen>
    </step>
    <step>
     <para>
      将新的配置指令分析为 dconf 数据库格式：
     </para>
     <screen><prompt>&gt; </prompt><command>sudo</command> <command>dconf update</command></screen>
    </step>
    <step>
     <para>
      创建 <filename>/etc/dconf/profiles/user</filename> 文件，以将新 <literal>network</literal> 配置数据库添加至默认用户配置文件。然后添加以下内容：
     </para>
     <screen>system-db:network</screen>
     <para>
      文件 <filename>/etc/dconf/profiles/user</filename> 是 GNOME 的默认配置文件。其他配置文件可在环境变量 <literal>DCONF_PROFILE</literal> 中定义。
     </para>
    </step>
    <step>
     <para>
      可选：要锁定用户的代理配置，请创建文件 <filename>/etc/dconf/db/network/locks/proxy</filename>。然后将含有不能更改的关键字的一行添加至此文件：
     </para>
     <screen>/system/proxy/http/host
/system/proxy/http/enabled</screen>
    </step>
   </procedure>
   <para>
    您可以使用图形 <command>dconf-editor</command> 创建包含一个用户的配置文件，然后使用 <command>dconf dump /</command> 列出所有配置选项。之后便可将配置选项存储在全局配置文件中。
   </para>
   <para>
    <link xlink:href="https://wiki.gnome.org/Projects/dconf/SystemAdministrators"/> 中提供了全局配置的详细说明。
   </para>
  </sect2>
  <sect2 xml:id="sec-gui-desktop-gnome-gtile" os="sled">
    <title>在 Wayland 上管理平铺</title>
    <para>
      如果您在 Wayland 上运行 GNOME 桌面，想让窗口并排排列，建议使用 <emphasis>gTile</emphasis> GNOME 扩展。gTile 可让您根据可配置的网格方案重新排列窗口。例如，您可以启动六个终端，将它们排成 3 行 2 列，占满整个桌面区域。
    </para>
    <sect3>
      <title>安装 gTile</title>
      <important>
        <para>
          要使用 gTile GNOME 扩展，您需要运行 GNOME 桌面并安装软件包 <package>chrome-gnome-shell</package>（适用于 <phrase role="productname"><phrase os="sled">SLED</phrase></phrase> 15 SP4 及更低版本）或 <package>gnome-browser-connector</package>（适用于 <phrase role="productname"><phrase os="sled">SLED</phrase></phrase> 15 SP5 及更高版本）。
        </para>
      </important>
      <procedure>
        <step>
          <para>
            使用浏览器访问 gTile 扩展网页 <link xlink:href="https://extensions.gnome.org/extension/28/gtile/"/>。如果您看到有关缺少浏览器扩展的警告，请单击该链接，然后按照 Web 浏览器的说明安装并启用 GNOME Shell 扩展。
          </para>
          <figure>
            <title>有关缺少 GNOME Shell 扩展的警告</title>
            <mediaobject>
              <imageobject role="fo">
                <imagedata fileref="gtile-browser-warning.png" width="75%"/>
              </imageobject>
              <imageobject role="html">
                <imagedata fileref="gtile-browser-warning.png" width="75%"/>
              </imageobject>
              <textobject role="description">
               <phrase>有关缺少 GNOME Shell 扩展的警告</phrase>
              </textobject>
            </mediaobject>
          </figure>
        </step>
        <step>
          <para>
            在 Web 浏览器中安装 GNOME Shell 扩展后，您会在 gTile 网页右上角看到一个 <guimenu>OFF</guimenu>（关）按钮。要激活 gTile 扩展，请单击该按钮将其切换为 <guimenu>ON</guimenu>（开）。
          </para>
          <figure>
            <title>激活的 GNOME gTile 扩展</title>
            <mediaobject>
              <imageobject role="fo">
                <imagedata fileref="gtile-extension-on.png" width="75%"/>
              </imageobject>
              <imageobject role="html">
                <imagedata fileref="gtile-extension-on.png" width="75%"/>
              </imageobject>
              <textobject role="description"><phrase>激活的 GNOME gTile 扩展</phrase>
              </textobject>
            </mediaobject>
          </figure>
        </step>
        <step>
          <para>
            GNOME 面板右侧的 GNOME 盘中会显示 gTile 托盘图标。您可以使用它来激活 gTile 窗口布局。
          </para>
          <figure>
            <title>gTile 托盘图标</title>
            <mediaobject>
              <imageobject role="fo">
                <imagedata fileref="gtile-tray-icon.png" width="75%"/>
              </imageobject>
              <imageobject role="html">
                <imagedata fileref="gtile-tray-icon.png" width="75%"/>
              </imageobject>
              <textobject role="description"><phrase>gTile 托盘图标</phrase>
              </textobject>
            </mediaobject>
          </figure>
        </step>
      </procedure>
    </sect3>
    <sect3>
      <title>使用 gTile 扩展</title>
      <procedure>
        <title>排列窗口</title>
        <step>
          <para>
            要对当前聚焦的窗口打开 gTile，请按 <keycombo><keycap function="meta"/><keycap function="enter"/></keycombo>。
          </para>
        </step>
        <step>
          <para>
            要设置将窗口排成几列，请按相应的数字键。
          </para>
        </step>
        <step>
          <para>
            要根据 <guimenu>Autotile Main window sizes</guimenu>（自动平铺主窗口大小）自动平铺窗口，请按 <keycap>M</keycap> 键。默认情况下，您首次按 <keycap>M</keycap> 键时，当前窗口会占据一半屏幕，所有其他窗口会在另一半屏幕中平铺成一列。您可以重复按 <keycap>M</keycap> 键在各种变化间循环切换。这样可以始终让一个主窗口占据较大区域，让几个次窗口占据较小区域。
          </para>
        </step>
        <step>
          <para>
           要将当前窗口移到屏幕的预定义平铺序列中，请使用方向键。
          </para>
          <para>
            要减少或增加窗口所占的平铺块数，请使用 <keycap function="shift"/> 和方向键。
          </para>
        </step>
        <step>
          <para>
            要将窗口拖到相邻窗口和桌面的边缘，请按 <keycombo><keycap function="control"/><keycap function="alt"/><keycap>S</keycap></keycombo>。
          </para>
        </step>
        <step>
          <para>
            要关闭 gTile 窗口，请按 <keycap function="escape"/>。
          </para>
        </step>
      </procedure>
      <procedure>
        <title>高级配置</title>
        <step>
          <para>
            要打开 gTile 设置，请运行以下命令：<command>gnome-extensions-app</command>。
          </para>
        </step>
        <step>
          <para>
            选择 gTile，然后单击 <guimenu>Settings</guimenu>（设置）。
          </para>
        </step>
        <step>
          <para>
           定义预设的组合键，可轻松在常用窗口布局间切换。
          </para>
          <para>
            有关如何配置 gTile 扩展的更多细节，请参见 <link xlink:href="https://github.com/gTile/gTile"/>。
          </para>
        </step>
      </procedure>
    </sect3>
  </sect2>

  <sect2 xml:id="sec-gui-desktop-gnome-more-info">
   <title>更多信息</title>
   <para>
    有关详细信息，请参见 <link xlink:href="https://help.gnome.org/admin/"/>。
   </para>
  </sect2>
 </sect1>

 <sect1 xml:id="sec-gui-desktop-suse-prime">
  <title>使用 SUSE Prime 在 Intel GPU 和 NVIDIA Optimus GPU 之间切换</title>
  <para>
   SUSE Prime 是一款用于在板载 Intel 图形处理器 (GPU) 和具有 NVIDIA“可切换图形”Optimus 技术的 NVIDIA GPU 之间切换的工具。Optimus 提供了一种可在板载 Intel GPU 和独立 NVIDIA GPU 之间轻松切换的机制。专为在省电模式下或以最佳性能运行笔记本电脑而设计：使用 Intel GPU 可省电，使用 NVIDIA GPU 可支持 3D 应用程序。
  </para>

  <para os="sled">
   SUSE Prime 随附在 SUSE Linux Enterprise <phrase role="productnumber"><phrase os="sles;sled">15 SP6</phrase></phrase> 的 SUSE Linux Enterprise Workstation Extension 中。
  </para>

  <para>
   SUSE Prime 只能在运行 X11（而不是 Wayland）的系统上工作。如果您的系统运行 Wayland，您必须将其禁用，并改回 X11 才能使用 SUSE Prime（请参见<xref linkend="sec-gui-desktop-suse-prime-prereqs"/>）。
  </para>

  <sect2 xml:id="sec-gui-desktop-suse-prime-prereqs">
   <title>先决条件</title>
    
   
   <para os="sle;sled">
    您必须有一个已配置好可正常工作的 NVIDIA Optimus GPU，并且该 GPU 使用 SUSE Linux Enterprise <phrase role="productnumber"><phrase os="sles;sled">15 SP6</phrase></phrase> 中包含的 NVIDIA 驱动程序（请参见<xref linkend="sec-gui-desktop-install-nvidia"/>），以及一个板载 Intel GPU。切勿安装 NVIDIA Optimus 的较旧切换工具 Bumblebee。
   </para>
   
   <para>
    <filename>/etc/X11/xorg.conf.d</filename> 目录中不能存在 <filename>/etc/X11/xorg.conf</filename> 文件，也不能存在包含有效 <literal>ServerLayout</literal>、<literal>Device</literal> 或 <literal>Screen</literal> 部分的配置文件。
   </para>
   <para>
    SUSE Prime 仅适用于 X11。请使用 <command>loginctl</command> 命令查看您的系统是使用 X11 还是 Wayland：
   </para>
<screen><prompt>&gt; </prompt>loginctl
   SESSION        UID USER             SEAT             TTY             
         2       1000 tux             seat0               
<prompt>&gt; </prompt>loginctl show-session 2|grep Type
Type=x11
</screen>
   <para>
    如果您的系统使用 Wayland，请编辑 <filename>/etc/gdm/custom.conf</filename> 并取消注释 <literal>WaylandEnable=false</literal> 将其禁用。然后重引导。
   </para>
  </sect2>

  <sect2 xml:id="sec-gui-desktop-suse-prime-install">
   <title>安装和使用 SUSE Prime</title>

    <para>
      您的 NVIDIA 显卡应已安装且正常工作。如果没有，请参见<xref linkend="sec-gui-desktop-install-nvidia"/>。 
    </para>

   <para>
       安装 <package>suse-prime</package> 软件包：
   </para>
       <screen><prompt>&gt; </prompt><command>sudo</command> zypper install suse-prime</screen>
     
   <para>
    要切换 GPU，请运行以下命令之一，然后注销并重新登录：
   </para>
<screen><prompt>&gt; </prompt><command>sudo</command> prime-select intel
<prompt>&gt; </prompt><command>sudo</command> prime-select intel2
<prompt>&gt; </prompt><command>sudo</command> prime-select nvidia
</screen>
   <para>
    如果是 modesetting 驱动程序，请使用 <command>intel</command> 驱动程序。<command>intel2</command> 用于使用 <package>xf86-video-intel</package> 驱动程序的系统。您可以通过安装和运行 <package>inxi</package> 来获取此信息：
   </para>
<screen><prompt>&gt; </prompt>inxi -G
Graphics: Device-1: Intel Xeon E3-1200 v3/4th Gen Core Processor Integrated Graphics Controller
          Display Server: x11(X.org 1.20.1 ) drivers: modesetting (unloaded: fbdev, vesa)
          Resolution: 1920x1080@60.00hz
          OpenGL: renderer: Mesa DRI Intel Haswell Desktop version: 4.5 Mesa 18.2.8
      </screen>
   <para>
    哪个 GPU 当前处于活动状态？
   </para>
<screen><prompt>&gt; </prompt><command>sudo</command> /usr/sbin/prime-select get-current
Driver configured: intel
</screen>
  </sect2>

  <sect2 xml:id="sec-gui-desktop-install-nvidia">
   <title>安装 NVIDIA 驱动程序</title>
   <para>
    如果您需要识别 NVIDIA 卡以便了解要使用哪个驱动程序，请运行以下命令：
</para>
   
<screen><prompt>&gt; </prompt>/sbin/lspci | grep VGA  
</screen>
   
      <para os="sles;sled">
    按照以下步骤使用 Zypper 安装驱动程序。
   </para>

   

   <para>
    列出可用的驱动程序软件包：
   </para>
<screen><prompt>&gt; </prompt><command>sudo</command> zypper se nvidia
</screen>
   <para>
    然后为您的 NVIDIA 显卡安装驱动程序：
   </para>
<screen><prompt>&gt; </prompt><command>sudo</command> zypper se <replaceable>packagename</replaceable>
</screen>
  </sect2>
 </sect1>
</chapter>
