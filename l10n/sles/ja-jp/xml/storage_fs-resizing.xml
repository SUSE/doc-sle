<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="storage_fs-resizing.xml" version="5.0" xml:id="cha-resize-fs" xml:lang="ja">
 <title>ファイルシステムのサイズ変更</title>
 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:bugtracker/>
   <dm:translation>yes</dm:translation>
  </dm:docmanager>
 </info>
 <para>
  ファイルシステムのサイズ変更(パーティションまたはボリュームのサイズ変更と混同しないでください)を使用して、物理ボリュームの使用可能な容量を増やしたり、物理ボリュームで増やした使用可能な容量を使用したりできます。
 </para>
 <sect1 xml:id="sec-resize-fs-usecases">
  <title>使用例</title>

  <para>
   パーティションまたは論理ボリュームのサイズ変更には、YaSTパーティショナを使用することをお勧めします。その際、ファイルシステムは自動的にパーティションまたはボリュームの新しいサイズに合わせて調整されます。ただし、YaSTではファイルシステムのサイズ変更はサポートされていないので、次のようなケースでは手動でサイズを変更する必要があります。
  </para>

  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>
     VM Guestの仮想ディスクのサイズを変更した後。
    </para>
   </listitem>
   <listitem>
    <para>
     NAS (Network Attached Storage)のボリュームのサイズを変更した後。
    </para>
   </listitem>
   <listitem>
    <para>
     手動でパーティションのサイズを変更した後(たとえば、<command>fdisk</command>または<command>parted</command>を使用)、または論理ボリュームのサイズを変更した後(たとえば、<command>lvresize</command>を使用)。
    </para>
   </listitem>
   <listitem>
    <para>
     Btrfsファイルシステムを縮小する場合(<phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> 12の時点ではYaSTはBtrfsファイルシステムの拡大のみをサポートしています)。
    </para>
   </listitem>
  </itemizedlist>
 </sect1>
 <sect1 xml:id="sec-resize-fs-guidelines">
  <title>サイズ変更のガイドライン</title>

  <para>
   ファイルシステムのサイズ変更には、データを失う可能性をはらむリスクが伴います。
  </para>

  <warning>
   <title>データのバックアップ</title>
   <para>
    データの喪失を避けるには、データを必ずバックアップしてから、サイズ変更タスクを開始します。
   </para>
  </warning>

  <para>
   ファイルシステムのサイズを変更する場合は、次のガイドラインに従ってください。
  </para>

  <sect2 xml:id="sec-resize-fs-guidelines-support">
   <title>サイズ変更をサポートしているファイルシステム</title>
   <para>
    ボリュームに使用可能な容量を増やせるようにするには、ファイルシステムがサイズ変更をサポートしている必要があります。<phrase role="productname"><phrase os="sles">SUSE® Linux Enterprise Server</phrase></phrase>では、ファイルシステムExt2、Ext3、およびExt4に対して、ファイルシステムのサイズ変更ユーティリティを使用できます。このユーティリティは、次のようにサイズの増減をサポートします。
   </para>
   <table>
    <title>ファイルシステムサイズ変更のサポート</title>
    <tgroup cols="4">
     <colspec colnum="1" colname="1" colwidth="2500*"/>
     <colspec colnum="2" colname="2" colwidth="2500*"/>
     <colspec colnum="3" colname="3" colwidth="2500*"/>
     <colspec colnum="4" colname="4" colwidth="2500*"/>
     <thead>
      <row>
       <entry>
        <para>
         ファイルシステム
        </para>
       </entry>
       <entry>
        <para>
         ユーティリティ
        </para>
       </entry>
       <entry>
        <para>
         サイズの増加(拡大)
        </para>
       </entry>
       <entry>
        <para>
         サイズの削減(縮小)
        </para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row>
       <entry>
        <para>
         Btrfs
        </para>
       </entry>
       <entry>
        <para>
         <command>btrfs filesystem resize</command>
        </para>
       </entry>
       <entry>
        <para>
         オンライン
        </para>
       </entry>
       <entry>
        <para>
         オンライン
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         XFS
        </para>
       </entry>
       <entry>
        <para>
         <command>xfs_growfs</command>
        </para>
       </entry>
       <entry>
        <para>
         オンライン
        </para>
       </entry>
       <entry>
        <para>
         サポートされていません。
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         Ext2
        </para>
       </entry>
       <entry>
        <para>
         <command>resize2fs</command>
        </para>
       </entry>
       <entry>
        <para>
         オンラインまたはオフライン
        </para>
       </entry>
       <entry>
        <para>
         オフラインのみ
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         Ext3
        </para>
       </entry>
       <entry>
        <para>
         <command>resize2fs</command>
        </para>
       </entry>
       <entry>
        <para>
         オンラインまたはオフライン
        </para>
       </entry>
       <entry>
        <para>
         オフラインのみ
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         Ext4
        </para>
       </entry>
       <entry>
        <para>
         <command>resize2fs</command>
        </para>
       </entry>
       <entry>
        <para>
         オンラインまたはオフライン
        </para>
       </entry>
       <entry>
        <para>
         オフラインのみ
        </para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </table>
  </sect2>

  <sect2 xml:id="sec-resize-fs-guidelines-increase">
   <title>ファイルシステムのサイズの増加</title>
   <para>
    デバイス上で使用可能な最大容量までファイルシステムを拡大することも、正確なサイズを指定することもできます。ファイルシステムのサイズを拡大する前に、必ずデバイス、または論理ボリュームのサイズを拡大しておいてください。
   </para>
   <para>
    ファイルシステムに正確なサイズを指定する場合は、その新しいサイズが次の条件を満たすかどうかを必ず確認してください。
   </para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>
      新しいサイズは、既存データのサイズより大きくなければなりません。さもないと、データが失われます。
     </para>
    </listitem>
    <listitem>
     <para>
      ファイルシステムのサイズは使用可能な容量より大きくできないので、新しいサイズは、現在のデバイスサイズ以下でなければなりません。
     </para>
    </listitem>
   </itemizedlist>
  </sect2>

  <sect2 xml:id="sec-resize-fs-guidelines-decrease">
   <title>ファイルシステムのサイズの削減</title>
   <para>
    デバイス上のファイルシステムのサイズを削減する際には、新しいサイズが次の条件を満たすかどうかを必ず確認してください。
   </para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>
      新しいサイズは、既存データのサイズより大きくなければなりません。さもないと、データが失われます。
     </para>
    </listitem>
    <listitem>
     <para>
      ファイルシステムのサイズは使用可能な容量より大きくできないので、新しいサイズは、現在のデバイスサイズ以下でなければなりません。
     </para>
    </listitem>
   </itemizedlist>
   <para>
    ファイルシステムが保存されている論理ボリュームのサイズを削減する場合は、デバイス、または論理ボリュームのサイズを削減しようとする前に、必ずファイルシステムのサイズを削減しておきます。
   </para>
   <important>
    <title>XFS</title>
    <para>
     XFSでフォーマットされたファイルシステムのサイズを縮小することはできません。XFSではそのような機能がサポートされていないためです。
    </para>
   </important>
  </sect2>
 </sect1>
 <sect1 xml:id="sec-resize-fs-btrfs">
  <title>Btrfsファイルシステムのサイズの変更</title>

  <para>
   Btrfsファイルシステムのサイズは、ファイルシステムがマウントされているときに、<command>btrfs filesystem resize</command>コマンドを使用して変更できます。ファイルシステムのマウント中にサイズの増加と縮小の両方を実行できます。
  </para>

  <procedure>
   <step>
    <para>
     端末コンソールを開きます。
    </para>
   </step>
   <step>
    <para>
     変更するファイルシステムがマウントされていることを確認します。
    </para>
   </step>
   <step>
    <para>
     次のどちらかの方法で<command>btrfs filesystem resize</command>コマンドを使用して、ファイルシステムのサイズを変更します。
    </para>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <para>
       ファイルシステムのサイズをデバイスの使用可能な最大サイズまで拡張するには、次のように入力します。
      </para>
<screen><prompt>&gt; </prompt><command>sudo</command> btrfs filesystem resize max /mnt</screen>
     </listitem>
     <listitem>
      <para>
       ファイルシステムを特定のサイズに拡張するには、次のコマンドを入力します。
      </para>
<screen><prompt>&gt; </prompt><command>sudo</command> btrfs filesystem resize <replaceable>SIZE</replaceable> /mnt</screen>
      <para>
       <replaceable>SIZE</replaceable>を目的のサイズ(バイト単位)で置き換えます。50000K(キロバイト)、250M(メガバイト)、2G (ギガバイト)など、値の単位を指定することもできます。または、プラス(<literal>+</literal>)記号またはマイナス(<literal>-</literal>)記号を値の前に付けることにより、現在のサイズに対する増減を指定することもできます。
      </para>
<screen><prompt>&gt; </prompt><command>sudo</command> btrfs filesystem resize +<replaceable>SIZE</replaceable> /mnt
sudo btrfs filesystem resize -<replaceable>SIZE</replaceable> /mnt</screen>
     </listitem>
    </itemizedlist>
   </step>
   <step>
    <para>
     次のように入力して、マウントされたファイルシステムに対するサイズ変更の効果をチェックします。
    </para>
<screen><prompt>&gt; </prompt>df -h</screen>
    <para>
     ディスクフリー(<command>df</command>)コマンドは、ディスクの合計サイズ、使用されたブロック数、およびファイルシステム上の使用可能なブロック数を表示します。-hオプションは、読みやすい形式でサイズを出力します(1K、234M、2Gなど)。
    </para>
   </step>
  </procedure>
 </sect1>
 <sect1 xml:id="sec-resize-fs-xfs">
  <title>XFSファイルシステムのサイズの変更</title>

  <para>
   XFSファイルシステムのサイズは、ファイルシステムがマウントされているときに、<command>xfs_growfs</command>コマンドを使用して増加できます。XFSファイルシステムのサイズを縮小することはできません。
  </para>

  <procedure>
   <step>
    <para>
     端末コンソールを開きます。
    </para>
   </step>
   <step>
    <para>
     変更するファイルシステムがマウントされていることを確認します。
    </para>
   </step>
   <step>
    <para>
     <command>xfs_growfs</command>コマンドを使用して、ファイルシステムのサイズを増やします。次に、ファイルシステムのサイズを、利用可能な最大値まで増やす例を示します。他のオプションについては、<command>man 8 xfs_growfs</command>を参照してください。
    </para>
<screen><prompt>&gt; </prompt><command>sudo</command> xfs_growfs -d /mnt</screen>
   </step>
   <step>
    <para>
     次のように入力して、マウントされたファイルシステムに対するサイズ変更の効果をチェックします。
    </para>
<screen><prompt>&gt; </prompt>df -h</screen>
    <para>
     ディスクフリー(<command>df</command>)コマンドは、ディスクの合計サイズ、使用されたブロック数、およびファイルシステム上の使用可能なブロック数を表示します。-hオプションは、読みやすい形式でサイズを出力します(1K、234M、2Gなど)。
    </para>
   </step>
  </procedure>
 </sect1>
 <sect1 xml:id="sec-resize-fs-ext">
  <title>Ext2、Ext3、またはExt4の各ファイルシステムのサイズの変更</title>

  <para>
   Ext2、Ext3、およびExt4ファイルシステムのサイズは、各パーティションがマウントされているかどうかにかかわらず、<command>resize2fs</command>コマンドを使用して増加できます。Extファイルシステムのサイズを減らすには、ファイルシステムをアンマウントする必要があります。
  </para>

  <procedure>
   <step>
    <para>
     端末コンソールを開きます。
    </para>
   </step>
   <step>
    <para>
     ファイルシステムのサイズを減らす必要がある場合は、アンマウントします。
    </para>
   </step>
   <step>
    <para>
     次のどちらかの方法で、ファイルシステムのサイズを変更します。
    </para>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <para>
       ファイルシステムのサイズを<filename>/dev/sda1</filename>と呼ばれるデバイスの、利用可能な最大サイズまで拡大するには、次のように入力します。
      </para>
<screen><prompt>&gt; </prompt><command>sudo</command> resize2fs /dev/sda1</screen>
      <para>
       sizeパラメータを指定しない場合、サイズはパーティションのサイズにデフォルト設定されます。
      </para>
     </listitem>
     <listitem>
      <para>
       ファイルシステムを特定のサイズに変更するには、次のコマンドを入力します。
      </para>
<screen><prompt>&gt; </prompt><command>sudo</command> resize2fs /dev/sda1 <replaceable>SIZE</replaceable></screen>
      <para>
       <replaceable>SIZE</replaceable>パラメータは、要求されたファイルシステムの新サイズを指定します。単位を指定しない場合のsizeパラメータの単位は、ファイルシステムのブロックサイズです。オプションとして、sizeパラメータの後ろに、次の単位指定子の1つを付けることができます。<literal>s</literal>は512バイトのセクタ、<literal>K</literal>はキロバイト(1キロバイトは1024バイト)、<literal>M</literal>はメガバイト、<literal>G</literal>はギガバイトを表します。
      </para>
     </listitem>
    </itemizedlist>
    <para>
     サイズ変更が完了するまで待って、続行します。
    </para>
   </step>
   <step>
    <para>
     ファイルシステムがマウントされていない場合は、この時点で、ファイルシステムをマウントします。
    </para>
   </step>
   <step>
    <para>
     次のように入力して、マウントされたファイルシステムに対するサイズ変更の効果をチェックします。
    </para>
<screen><prompt>&gt; </prompt>df -h </screen>
    <para>
     ディスクフリー(<command>df</command>)コマンドは、ディスクの合計サイズ、使用されたブロック数、およびファイルシステム上の使用可能なブロック数を表示します。-hオプションは、読みやすい形式でサイズを出力します(1K、234M、2Gなど)。
    </para>
   </step>
  </procedure>
 </sect1>
</chapter>
