<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="grub2.xml" version="5.0" xml:id="cha-grub2">
 <title>ブートローダGRUB 2</title>
 <info>
  <abstract>
   <para>
    この章では、<phrase role="productname"><phrase os="sles">SUSE® Linux Enterprise Server</phrase></phrase>で使用されているブートローダGRUB 2の設定方法について説明します。これは、現在<quote>GRUB Legacy</quote>と呼ばれる従来のGRUBブートローダの後継バージョンです。<phrase os="sled;sles">GRUB 2は、<phrase role="productname"><phrase os="sles">SUSE® Linux Enterprise Server</phrase></phrase>のバージョン 12以降でデフォルトのブートローダとして使用されています。</phrase>YaSTモジュールは、最も重要な設定を行うために使用できます。ブート手順は、総じて<xref linkend="cha-boot"/>で説明しています。UEFIマシンでのセキュアブートのサポートの詳細については、<xref linkend="cha-uefi"/>を参照してください。
   </para>
  </abstract>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:bugtracker/>
   <dm:translation>yes</dm:translation>
  </dm:docmanager>
 </info>
 <sect1 xml:id="sec-grub2-new-features">
  <title>GRUB LegacyとGRUB 2の主な相違点</title>

  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>
     設定が異なるファイルに保存されます。
    </para>
   </listitem>
   <listitem>
    <para>
     より多くのファイルシステム(Btrfsなど)がサポートされています。
    </para>
   </listitem>
   <listitem>
    <para>
     LVMまたはRAIDデバイスに保存されたファイルを直接読み込めます。
    </para>
   </listitem>
   <listitem>
    <para>
     テーマによってユーザインタフェースを翻訳および変更できます。
    </para>
   </listitem>
   <listitem>
    <para>
     ファイルシステムなどの追加機能をサポートするモジュールをロードするためのメカニズムが組み込まれています。
    </para>
   </listitem>
   <listitem>
    <para>
     他のカーネルとオペレーティングシステム(Windowsなど)のブートエントリを自動的に検索して生成します。
    </para>
   </listitem>
   <listitem>
    <para>
     Bashに似た最小限のコンソールが組み込まれています。
    </para>
   </listitem>
  </itemizedlist>
 </sect1>
 <sect1 xml:id="sec-grub2-file-structure">
  <title>設定ファイルの構造</title>

  <para>
   GRUB 2の設定は、次のファイルに基づいています。
  </para>

  <variablelist>
   <varlistentry>
    <term><filename>/boot/grub2/grub.cfg</filename>
    </term>
    <listitem>
     <para>
      このファイルには、GRUB 2メニュー項目の設定が含まれます。これは、GRUB Legacyで使用されていた<filename>menu.lst</filename>に代わるものです。<filename>grub.cfg</filename>は編集しないでください。コマンド<command>grub2-mkconfig -o /boot/grub2/grub.cfg</command>によって自動的に生成されます。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><filename>/boot/grub2/custom.cfg</filename>
    </term>
    <listitem>
     <para>
      このオプションファイルは、ブート時に<filename>grub.cfg</filename>によって直接調達され、ブートメニューにカスタム項目を追加するために使用できます。<phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase>からは、<command>grub-once</command>を使用する場合も、これらのエントリが解析されます。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><filename>/etc/default/grub</filename>
    </term>
    <listitem>
     <para>
      このファイルは、GRUB 2のユーザ設定を制御し、通常は背景やテーマなどの追加の環境設定を含みます。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><filename>/etc/grub.d/</filename>にあるスクリプト
    </term>
    <listitem>
     <para>
      このディレクトリのスクリプトは、コマンド<command>grub2-mkconfig -o /boot/grub2/grub.cfg</command>の実行中に読み込まれます。スクリプトの命令はメインの設定ファイル<filename>/boot/grub/grub.cfg</filename>に統合されます。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry xml:id="vle-grub2-sysconfig">
    <term><filename>/etc/sysconfig/bootloader</filename>
    </term>
    <listitem>
     <para>
      この設定ファイルは、ブートローダタイプや、UEFIセキュアブートサポートを有効にするかどうかなどのいくつかの基本的な設定を保持します。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><filename arch="x86_64">/boot/grub2/x86_64-efi</filename>、<filename arch="power">/boot/grub2/power-ieee1275</filename>、<filename arch="zseries">/boot/grub2/s390x</filename>
    </term>
    <listitem>
     <para>
      これらの設定ファイルにはアーキテクチャ固有のオプションが含まれます。
     </para>
    </listitem>
   </varlistentry>
  </variablelist>

  <para>
   GRUB 2は、さまざまな方法で制御できます。グラフィカルメニュー(スプラッシュ画面)を使用して、既存の設定からブートエントリを選択できます。設定は、他の設定ファイルからコンパイルされた<filename>/boot/grub2/grub.cfg</filename>ファイルからロードされます(以下を参照)。GRUB 2設定ファイルはすべてシステムファイルとみなされ、編集するには<systemitem class="username">root</systemitem>特権が必要です。
  </para>

  <note>
   <title>設定の変更の有効化</title>
   <para>
    GRUB 2設定ファイルを手動で編集した後で、<command>grub2-mkconfig -o /boot/grub2/grub.cfg</command>を実行して、変更を有効にする必要があります。ただし、YaSTを使用して設定を変更した場合、YaSTはこのコマンドを自動的に実行するため、この作業は必要ありません。
   </para>
  </note>

  <sect2 xml:id="sec-grub2-cfg">
   <title><filename>/boot/grub2/grub.cfg</filename>ファイル</title>
   <para>
    ブートメニューを含むグラフィカルスプラッシュ画面は、GRUB 2の設定ファイル<filename>/boot/grub2/grub.cfg</filename>に基づいており、このファイルにはメニューを使用してブートできるすべてのパーティションまたはオペレーティングシステムに関する情報が含まれています。
   </para>
   <para>
    システムをブートするたびに、GRUB 2はファイルシステムから直接メニューファイルをロードします。このため、設定ファイルを変更するたびにGRUB 2を再インストールする必要がありません。<filename>grub.cfg</filename>は、カーネルをインストールまたは削除すると自動的に再構築されます。
   </para>
   <para>
    <filename>grub.cfg</filename>は、ファイル<filename>/etc/default/grub</filename>、およびコマンド<command>grub2-mkconfig -o /boot/grub2/grub.cfg</command>の実行中に<filename>/etc/grub.d/</filename>ディレクトリで見つかったスクリプトからコンパイルされます。そのため、このファイルは手動で編集しないでください。代わりに、関連するソースファイルを編集するか、<xref linkend="sec-grub2-yast2-config"/>で説明されているようにYaST<guimenu>ブートローダ</guimenu>モジュールを使用して設定を変更します。
   </para>
  </sect2>

  <sect2 xml:id="sec-grub2-etc-default-grub">
   <title><filename>/etc/default/grub</filename>ファイル</title>
   <para>
    ここには、メニューを表示するタイミングやブートするデフォルトのOSなど、GRUB 2のより一般的なオプションが含まれます。すべての使用可能なオプションについては、次のコマンドの出力を参照してください。
   </para>
<screen>grep "export GRUB_DEFAULT" -A50 /usr/sbin/grub2-mkconfig | grep GRUB_</screen>
   <para>
    定義済みの変数以外にユーザ独自の変数を導入して、後から<filename>/etc/grub.d</filename>ディレクトリにあるスクリプト内でそれらの変数を使用できます。
   </para>
   <para>
    <filename>/etc/default/grub</filename>を編集した後で、<command>grub2-mkconfig -o /boot/grub2/grub.cfg</command>を使用してメインの設定ファイルをアップデートします。</para>
   <note>
    <title>スコープ</title>
    <remark>
     Do we really still have Xen-specific kernels? - sknorr, 2017-05-08
    </remark>
    <para>
     このファイルに設定されているオプションはすべて、全ブートエントリに影響する汎用オプションです。XenカーネルまたはXenハイバーバイザに固有のオプションは、GRUB_*_XEN_*設定オプションを介して設定できます。詳細については、以下を参照してください。
    </para>
   </note>
   <variablelist>
    <varlistentry>
     <term><literal>GRUB_DEFAULT</literal>
     </term>
     <listitem>
      <para>
       デフォルトでブートされるブートメニューエントリを設定します。値は、数値、メニューエントリの完全な名前、または<quote>saved</quote>になります。
      </para>
      <para>
       <literal>GRUB_DEFAULT=2</literal>は、3番目(0から数える)のブートメニューエントリをブートします。
      </para>
      <para>
       <literal>GRUB_DEFAULT="2&gt;0"</literal>は、3番目の最上位レベルのメニューエントリの1番目にあるサブメニューエントリをブートします。
      </para>
      <para>
       <literal>GRUB_DEFAULT="Example boot menu entry"</literal>は、<quote>Example boot menu entry</quote>というタイトルのメニューエントリをブートします。
      </para>
      <para>
       <literal>GRUB_DEFAULT=saved</literal>は、<command>grub2-once</command>コマンドまたは<command>grub2-set-default</command>コマンドによって指定されたエントリをブートします。<command>grub2-reboot</command>は次回の再起動時にのみ有効なデフォルトブートエントリを設定するのに対し、<command>grub2-set-default</command>は変更しない限りデフォルトとして使用されるブートエントリを設定します。<command>grub2-editenv list</command>は、次のブートエントリをリストします。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>GRUB_HIDDEN_TIMEOUT</literal>
     </term>
     <listitem>
      <para>
       ユーザがキーを押すまで、指定された秒数待機します。この間は、ユーザがキーを押さない限りメニューは表示されません。指定された時間内にキーが押されなかった場合、制御は<literal>GRUB_TIMEOUT</literal>に渡されます。<literal>GRUB_HIDDEN_TIMEOUT=0</literal>は、まず<keycap function="shift"/>キーが押されているかどうかを確認し、押されている場合はブートメニューを表示し、押されていない場合は即座にデフォルトのメニューエントリをブートします。これは、GRUB 2によって識別されるブート可能なOSが1つだけの場合のデフォルトです。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>GRUB_HIDDEN_TIMEOUT_QUIET</literal>
     </term>
     <listitem>
      <para>
       <literal>false</literal>が指定されていて、<literal>GRUB_HIDDEN_TIMEOUT</literal>機能が有効な場合は、空の画面にカウントダウンタイマが表示されます。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>GRUB_TIMEOUT</literal>
     </term>
     <listitem>
      <para>
       自動的にデフォルトのブートエントリをブートする前に、ブートメニューを表示する時間(秒数)。キーを押すとタイムアウトはキャンセルされ、GRUB 2はユーザが手動で選択するまで待機します。<literal>GRUB_TIMEOUT=-1</literal>は、ユーザがブートエントリを手動で選択するまでメニューを表示します。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>GRUB_CMDLINE_LINUX</literal>
     </term>
     <listitem>
      <para>
       この行のエントリは、標準モードおよび回復モード用のブートエントリの最後に追加されます。この行を使用して、カーネルパラメータをブートエントリに追加します。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>GRUB_CMDLINE_LINUX_DEFAULT</literal>
     </term>
     <listitem>
      <para>
       <literal>GRUB_CMDLINE_LINUX</literal>と同じですが、標準モードでのみエントリが追加されます。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>GRUB_CMDLINE_LINUX_RECOVERY</literal>
     </term>
     <listitem>
      <para>
       <literal>GRUB_CMDLINE_LINUX</literal>と同じですが、回復モードでのみエントリが追加されます。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>GRUB_CMDLINE_LINUX_XEN_REPLACE</literal>
     </term>
     <listitem>
      <para>
       このエントリは、すべてのXenブートエントリの<literal>GRUB_CMDLINE_LINUX</literal>パラメータを完全に置き換えます。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>GRUB_CMDLINE_LINUX_XEN_REPLACE_DEFAULT</literal>
     </term>
     <listitem>
      <para>
       <literal>GRUB_CMDLINE_LINUX_XEN_REPLACE</literal>と同じですが、<literal>GRUB_CMDLINE_LINUX_DEFAULT</literal>のパラメータのみを置き換えます。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>GRUB_CMDLINE_XEN</literal>
     </term>
     <listitem>
      <para>
       このエントリは、Xenゲストカーネルのカーネルパラメータのみを指定します。基本原則は、<literal>GRUB_CMDLINE_LINUX</literal>と同じです。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>GRUB_CMDLINE_XEN_DEFAULT</literal>
     </term>
     <listitem>
      <para>
       <literal>GRUB_CMDLINE_XEN</literal>と同じです。基本原則は、<literal>GRUB_CMDLINE_LINUX_DEFAULT</literal>と同じです。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>GRUB_TERMINAL</literal>
     </term>
     <listitem>
      <para>
       入出力端末デバイスを有効化および指定します。<literal>console</literal> (PC BIOSおよびEFIコンソール)、<literal>serial</literal> (シリアル端末)、<literal>ofconsole</literal> (Open Firmwareコンソール)、またはデフォルトの<literal>gfxterm</literal> (グラフィックモード出力)のいずれかになります。また、必要なオプションを引用符で囲むことで、2つ以上のデバイスを有効にすることもできます(たとえば、<literal>GRUB_TERMINAL="console serial"</literal>)。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>GRUB_GFXMODE</literal>
     </term>
     <listitem>
      <para>
       <literal>gfxterm</literal>グラフィカル端末で使用される解像度。使用できるモードはグラフィックカード(VBE)でサポートされているモードのみである点に注意してください。デフォルトは「auto」で、優先解像度の選択を試みます。GRUB 2のコマンドラインで「<command>videoinfo</command>」と入力すると、GRUB 2で使用可能な画面解像度が表示されます。コマンドラインにアクセスするには、GRUB 2ブートメニュー画面が表示されているときに<keycap>C</keycap>と入力します。
      </para>
      <para>
       また、色数を解像度設定に追加することで色数も指定できます(たとえば、<literal>GRUB_GFXMODE=1280x1024x24</literal>)。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>GRUB_BACKGROUND</literal>
     </term>
     <listitem>
      <para>
       <literal>gfxterm</literal>グラフィカル端末の背景イメージを設定します。イメージはブート時にGRUB 2によって読み込み可能なファイルでなければならず、拡張子<literal>.png</literal>、<literal>.tga</literal>、<literal>.jpg</literal>、または<literal>.jpeg</literal>で終わる必要があります。必要であれば、イメージは画面に合わせて拡大されます。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>GRUB_DISABLE_OS_PROBER</literal>
     </term>
     <listitem>
      <para>
       このオプションを<literal>true</literal>に設定すると、他のオペレーティングシステムの自動検索は無効になります。<filename>/boot/</filename>内のカーネルイメージと、<filename>/etc/grub.d/</filename>内にあるユーザ独意のスクリプトのオプションのみが検出されます。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>SUSE_BTRFS_SNAPSHOT_BOOTING</literal>
     </term>
     <listitem>
      <para>
       このオプションを<literal>true</literal>に設定すると、GRUB 2をSnapperのスナップショットの状態に直接ブートできます。詳細については、<xref linkend="sec-snapper-snapshot-boot"/>を参照してください。
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
   <para>
    すべてのオプションのリストについては、<link xlink:href="http://www.gnu.org/software/grub/manual/grub.html#Simple-configuration">GNU GRUBのマニュアル</link>を参照してください。すべての設定可能なパラメータのリストについては、<link xlink:href="http://en.opensuse.org/Linuxrc"/>を参照してください。
   </para>
  </sect2>

  <sect2 xml:id="sec-grub2-etc-grub-d">
   <title><filename>/etc/grub.d</filename>内のスクリプト</title>
   <para>
    このディレクトリのスクリプトは、コマンド<command>grub2-mkconfig -o /boot/grub2/grub.cfg</command>の実行中に読み込まれます。スクリプトの命令は<filename>/boot/grub2/grub.cfg</filename>に統合されます。<filename>grub.cfg</filename>内のメニュー項目の順序は、このディレクトリ内のファイルの実行順序によって決まります。まず、名前が数字で始まるファイルが、最も小さい数字が付いたものから順番に実行されます。<filename>00_header</filename>は<filename>10_linux</filename>の前に実行され、10_linuxは<filename>40_custom</filename>の前に実行されます。アルファベットの名前が付いたファイルが存在する場合は、名前が数字で始まるファイルの後に実行されます。<command>grub2-mkconfig</command>の実行中に<filename>grub.cfg</filename>へ出力を生成するのは実行可能ファイルのみです。デフォルトでは、<filename>/etc/grub.d</filename>ディレクトリ内のファイルはすべて実行可能ファイルです。
   </para>
   <tip>
    <title><filename>grub.cfg</filename>の永続的なカスタムコンテンツ</title>
    <para>
     <command>grub2-mkconfig</command>を実行するたびに<filename>/boot/grub2/grub.cfg</filename>が再コンパイルされるため、カスタムコンテンツはすべて失われます。<filename>grub2-mkconfig</filename>を実行した後に、それらを失うことなく<command>/boot/grub2/grub.cfg</command>に直接行を挿入したい場合は、以下の間に挿入してください: the
    </para>
    <screen>### BEGIN /etc/grub.d/90_persistent ###</screen>
    <para>
     and
    </para>
    <screen>### END /etc/grub.d/90_persistent ###</screen>
    <para>
     lines. <filename>90_persistent</filename>スクリプトにより、このようなコンテンツが確実に保存されます。
    </para>
    <para>
     最も重要なスクリプトのリストを以下に示します。
    </para>
   </tip>
   <variablelist>
    <varlistentry>
     <term><filename>00_header</filename>
     </term>
     <listitem>
      <para>
       システムファイルの場所、表示設定、テーマ、以前に保存したエントリなどの環境変数を設定します。また、<filename>/etc/default/grub</filename>に保存されている初期設定をインポートします。通常、このファイルを変更する必要はありません。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><filename>10_linux</filename>
     </term>
     <listitem>
      <para>
       ルートデバイス上のLinuxカーネルを識別し、関連するメニューエントリを作成します。これには、関連する回復モードオプション(有効な場合)が含まれます。最新のカーネルのみがメインメニューページに表示され、その他のカーネルはサブメニューに含まれます。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><filename>30_os-prober</filename>
     </term>
     <listitem>
      <para>
       このスクリプトは、<command>OS-prober</command>を使用してLinuxやその他のオペレーティングシステムを検索し、結果をGRUB 2メニューに示します。他の特定のオペレーティングシステム(WindowsやmacOSなど)を識別するためのセクションがあります。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><filename>40_custom</filename>
     </term>
     <listitem>
      <para>
       このファイルを使用すると、<filename>grub.cfg</filename>に簡単にカスタムブートエントリを組み込むことができます。最初の<literal>exec tail -n +3 $0</literal>の部分は変更しないようにしてください。
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
   <para>
    処理シーケンスは、名前の先頭の数値によって設定され、最も小さい数値が最初に実行されます。スクリプトの名前が同じ数値で始まる場合は、名前全体のアルファベット順で順序が決まります。
   </para>
   <tip>
    <title><filename>/boot/grub2/custom.cfg</filename></title>
    <para>
     <filename>/boot/grub2/custom.cfg</filename>を作成してコンテンツを入力すると、ブート時に40_customの直後に自動的に<filename>/boot/grub2/grub.cfg</filename>に組み込まれます。
    </para>
   </tip>
  </sect2>

  <sect2 xml:id="sec-grub2-map">
   <title>BIOSドライブとLinuxドライブのマッピング</title>
   <para>
    GRUB Legacyでは、<filename>device.map</filename>設定ファイルを使用して、BIOSドライブ番号からLinuxデバイス名を派生させていました。BIOSドライブとLinuxデバイスのマッピングは常に正しく推測できるとは限りません。たとえば、BIOS設定でIDEとSCSIのブートシーケンスが入れ替わると、GRUB Legacyは誤った順序を取得します。
   </para>
   <para>
    GRUB 2では、<filename>grub.cfg</filename>の生成時にデバイスID文字列(UUID)またはファイルシステムラベルを使用することで、この問題を回避しています。GRUB 2ユーティリティは一時デバイスマップをオンザフライで作成します。通常、特に単一ディスクのシステムの場合は、この処理で十分です。
   </para>
   <para>
    ただし、GRUB 2の自動デバイスマッピングメカニズムを無効にする必要がある場合は、カスタムマッピングファイル<filename>/boot/grub2/device.map</filename>を作成します。次の例では、マッピングを変更して、<literal>DISK 3</literal>をブートディスクにしています。パーティション番号は、GRUB Legacyでは<literal>0</literal>から始まっていましたが、GRUB 2では<literal>1</literal>から始まる点に注意してください。
   </para>
<screen>(hd1)  /dev/disk-by-id/<replaceable>DISK3 ID</replaceable>
(hd2)  /dev/disk-by-id/<replaceable>DISK1 ID</replaceable>
(hd3)  /dev/disk-by-id/<replaceable>DISK2 ID</replaceable></screen>
  </sect2>

  <sect2 xml:id="sec-grub2-menu-change">
   <title>ブート手順実行中のメニューエントリの編集</title>
   <para>
    メニューエントリを直接編集できると、誤設定が原因でシステムがブートしなくなった場合に役立ちます。また、システム設定を変更せずに新しい設定をテストする場合にも使用できます。
   </para>
   <procedure>
    <step>
     <para>
      グラフィカルブートメニューで、編集するエントリを矢印キーで選択します。
     </para>
    </step>
    <step>
     <para>
      <keycap>E</keycap>を押して、テキストベースのエディタを開きます。
     </para>
    </step>
    <step>
     <para>
      矢印キーを使用して、編集する行へ移動します。
     </para>
     <figure xml:id="fig-grub2-boot-editor">
      <title>GRUB 2ブートエディタ</title>
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="grub2_edit_config.png" width="75%"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="grub2_edit_config.png" width="75%"/>
       </imageobject>
      </mediaobject>
     </figure>
     <para>
      ここでは2つのオプションがあります。
     </para>
     <substeps performance="required">
      <step>
       <para>
        スペース区切りのパラメータを、<literal>linux</literal>または<literal>linuxefi</literal>で始まる行の終わりに追加して、カーネルパラメータを編集します。すべてのパラメータのリストは<link xlink:href="http://en.opensuse.org/Linuxrc"/>から入手できます。
       </para>
      </step>
      <step>
       <para>
        または、一般オプションを編集して、カーネルバージョンなどを変更します。<keycap function="tab"/>キーを押すと、考えられる完了結果がすべて提示されます。
       </para>
      </step>
     </substeps>
    </step>
    <step>
     <para>
      <keycap>F10</keycap>キーを押して変更内容が反映されたシステムをブートするか、<keycap function="escape"/>キーを押して編集内容は破棄し、GRUB 2メニューに戻ります。
     </para>
    </step>
   </procedure>
   <para>
    この方法で加えた変更は、現在のブートプロセスだけに適用され、永続的に保存されることはありません。
   </para>
   <important>
    <title>ブート手順実行中のキーボードレイアウト</title>
    <para>
     ブート時は、USキーボードレイアウトだけが使用可能です。詳細については、<xref linkend="fig-trouble-install-keyboard-us"/>を参照してください。
    </para>
   </important>
   <note arch="x86_64">
    <title>インストールメディアのブートローダ</title>
    <para>
     従来のBIOSが搭載されたシステム上にあるインストールメディアのブートローダは、引き続きGRUB Legacyになります。ブートオプションを追加するには、エントリを選択し、入力を開始します。インストールブートエントリに追加した内容は、インストール済みシステムに永続的に保存されます。
    </para>
   </note>
   <note arch="zseries">
    <title>IBM ZでのGRUB 2メニューエントリの編集</title>
    <para>
     IBM Zでのカーソルの移動と編集コマンドは異なります。詳細については、<xref linkend="sec-grub2-zseries"/>を参照してください。
    </para>
   </note>
  </sect2>

  <sect2 xml:id="sec-grub2-password">
   <title>ブートパスワードの設定</title>
   <para>
    GRUB 2は、オペレーティングシステムのブート前でも、ファイルシステムにアクセスできるようにします。rootパーミッションを持たないユーザは、システムのブート後、アクセス権のないLinuxシステム上のファイルにアクセスできます。この種のアクセスを阻止したり、ユーザによる特定のメニューエントリのブートを防止するために、ブートパスワードを設定できます。
   </para>
   <important>
    <title>ブート時にパスワードが必要です</title>
    <para>
     設定すると、ブートのたびにブートパスワードが必要になります。つまり、システムは自動的にはブートしません。
    </para>
   </important>
   <para>
    ブートパスワードを設定するには、次の手順に従います。または、YaSTを使用してください(<xref linkend="vle-grub2-yast2-boot-password"/>を参照してください)。
   </para>
   <procedure>
    <step>
     <para>
      <command>grub2-mkpasswd-pbkdf2</command>を使用してパスワードを暗号化します。
     </para>
<screen><prompt>tux &gt; </prompt>sudo grub2-mkpasswd-pbkdf2
Password: ****
Reenter password: ****
PBKDF2 hash of your password is grub.pbkdf2.sha512.10000.9CA4611006FE96BC77A...
</screen>
    </step>
    <step>
     <para>
      <command>set superusers</command>コマンドを使用して、結果の文字列をまとめて<filename>/etc/grub.d/40_custom</filename>ファイルに貼り付けます。
     </para>
<screen>set superusers="root"
password_pbkdf2 root grub.pbkdf2.sha512.10000.9CA4611006FE96BC77A...</screen>
    </step>
    <step>
     <para>
      メインの設定ファイルに変更をインポートするには、次を実行します。
     </para>
     <screen><prompt>tux &gt; </prompt><command>sudo</command> grub2-mkconfig -o /boot/grub2/grub.cfg</screen>
    </step>
   </procedure>
   <para>
    再起動後、メニューエントリのブートを試みると、ユーザ名とパスワードの入力が求められます。「<literal>root</literal>」と入力し、<command>grub2-mkpasswd-pbkdf2</command>コマンドの実行時に入力したパスワードを入力します。資格情報が正しい場合、システムは選択したブートエントリをブートします。
   </para>
   <para>
    詳細については、<link xlink:href="https://www.gnu.org/software/grub/manual/grub.html#Security"/>を参照してください。
   </para>
  </sect2>
 </sect1>
 <xi:include href="grub2_yast_i.xml"/>
 <sect1 xml:id="sec-grub2-zseries">
  <title>IBM Zにおける端末の使用上の相違点</title>

  <para>
   3215および3270端末では、カーソルの移動方法と、GRUB 2内での編集コマンドの実行方法にいくつかの相違点と制限事項があります。
  </para>

  <sect2 xml:id="sec-grub2-zseries-limitations">
   <title>制限</title>
   <variablelist>
    <varlistentry>
     <term>対話処理</term>
     <listitem>
      <para>
       対話処理は大幅に制限されています。多くの場合、入力しても結果は視覚的なフィードバックとして表示されません。カーソルの位置を確認するには、下線(<keycap>_</keycap>)を入力します。
      </para>
      <note>
       <title>3270の3215との比較</title>
       <para>
        3270端末では、画面の表示と更新は3215端末より優れています。
       </para>
      </note>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>カーソルの移動</term>
     <listitem>
      <para>
       <quote>従来</quote>の方法でカーソルを移動することはできません。<keycap function="alt"/>、<keycap function="meta"/>、<keycap function="control"/>、およびカーソルキーは動作しません。カーソルを移動するには、<xref linkend="sec-grub2-zseries-keys"/>に一覧にされたキーの組み合わせを使用します。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>キャレット</term>
     <listitem>
      <para>
       キャレット(<keycap>^</keycap>)は制御文字として使用されます。文字として<keycap>^</keycap>を入力し他の文字を続けるには、<keycap>^</keycap>、<keycap>^</keycap>、「<replaceable>LETTER</replaceable>」と入力します。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>&lt;Enter&gt;</term>
     <listitem>
      <para>
       <keycap function="enter"/>キーは機能しません。代わりに、<keycombo><keycap>^</keycap> <keycap>J</keycap></keycombo>を使用します。
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
  </sect2>

  <sect2 xml:id="sec-grub2-zseries-keys">
   <title>キーの組み合わせ</title>
   <informaltable>
    <tgroup cols="3">
     <tbody>
      <row>
       <entry morerows="2" valign="top">
        <para>
         共通の代用キー:
        </para>
       </entry>
       <entry>
        <para>
         <keycombo><keycap>^</keycap> <keycap>J</keycap></keycombo>
        </para>
       </entry>
       <entry>
        <para>
         決定する(<quote>Enter</quote>)
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <keycombo><keycap>^</keycap><keycap>L</keycap></keycombo>
        </para>
       </entry>
       <entry>
        <para>
         中止して、直前の<quote>状態</quote>に戻る
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <keycombo><keycap>^</keycap><keycap>I</keycap></keycombo>
        </para>
       </entry>
       <entry>
        <para>
         タブ補完機能(編集およびシェルモード)
        </para>
       </entry>
      </row>
      <row>
       <entry morerows="8" valign="top">
        <para>
         メニューモードで使用可能なキー:
        </para>
       </entry>
       <entry>
        <para>
         <keycombo><keycap>^</keycap><keycap>A</keycap></keycombo>
        </para>
       </entry>
       <entry>
        <para>
         最初のエントリ
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <keycombo><keycap>^</keycap><keycap>E</keycap></keycombo>
        </para>
       </entry>
       <entry>
        <para>
         最後のエントリ
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <keycombo><keycap>^</keycap><keycap>P</keycap></keycombo>
        </para>
       </entry>
       <entry>
        <para>
         前のエントリ
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <keycombo><keycap>^</keycap><keycap>N</keycap></keycombo>
        </para>
       </entry>
       <entry>
        <para>
         次のエントリ
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <keycombo><keycap>^</keycap><keycap>G</keycap></keycombo>
        </para>
       </entry>
       <entry>
        <para>
         前のページ
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <keycombo><keycap>^</keycap><keycap>C</keycap></keycombo>
        </para>
       </entry>
       <entry>
        <para>
         次のページ
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <keycombo><keycap>^</keycap><keycap>F</keycap></keycombo>
        </para>
       </entry>
       <entry>
        <para>
         選択したエントリをブートする、またはサブメニューに切り替える(<keycombo><keycap>^</keycap><keycap>J</keycap></keycombo>と同じ)
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <keycombo><keycap>E</keycap></keycombo>
        </para>
       </entry>
       <entry>
        <para>
         選択したエントリを編集する
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <keycombo><keycap>C</keycap></keycombo>
        </para>
       </entry>
       <entry>
        <para>
         GRUBシェルを起動する
        </para>
       </entry>
      </row>
      <row>
       <entry morerows="13" valign="top">
        <para>
         編集モードで使用可能なキー:
        </para>
       </entry>
       <entry>
        <para>
         <keycombo><keycap>^</keycap><keycap>P</keycap></keycombo>
        </para>
       </entry>
       <entry>
        <para>
         前の行に戻る
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <keycombo><keycap>^</keycap><keycap>N</keycap></keycombo>
        </para>
       </entry>
       <entry>
        <para>
         次の行に進む
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <keycombo><keycap>^</keycap><keycap>B</keycap></keycombo>
        </para>
       </entry>
       <entry>
        <para>
         1文字戻る
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <keycombo><keycap>^</keycap><keycap>F</keycap></keycombo>
        </para>
       </entry>
       <entry>
        <para>
         1文字進む
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <keycombo><keycap>^</keycap><keycap>A</keycap></keycombo>
        </para>
       </entry>
       <entry>
        <para>
         行の先頭に移動する
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <keycombo><keycap>^</keycap><keycap>E</keycap></keycombo>
        </para>
       </entry>
       <entry>
        <para>
         行の末尾
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <keycombo><keycap>^</keycap><keycap>H</keycap></keycombo>
        </para>
       </entry>
       <entry>
        <para>
         バックスペース
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <keycombo><keycap>^</keycap><keycap>D</keycap></keycombo>
        </para>
       </entry>
       <entry>
        <para>
         delete
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <keycombo><keycap>^</keycap><keycap>K</keycap></keycombo>
        </para>
       </entry>
       <entry>
        <para>
         行を削除する
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <keycombo><keycap>^</keycap><keycap>Y</keycap></keycombo>
        </para>
       </entry>
       <entry>
        <para>
         ヤンク(コピー)
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <keycombo><keycap>^</keycap><keycap>O</keycap></keycombo>
        </para>
       </entry>
       <entry>
        <para>
         行を開く
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <keycombo><keycap>^</keycap><keycap>L</keycap></keycombo>
        </para>
       </entry>
       <entry>
        <para>
         画面を更新する
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <keycombo><keycap>^</keycap><keycap>X</keycap></keycombo>
        </para>
       </entry>
       <entry>
        <para>
         エントリをブートする
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <keycombo><keycap>^</keycap><keycap>C</keycap></keycombo>
        </para>
       </entry>
       <entry>
        <para>
         GRUBシェルを起動する
        </para>
       </entry>
      </row>
      <row>
       <entry morerows="10" valign="top">
        <para>
         コマンドラインモードで使用可能なキー:
        </para>
       </entry>
       <entry>
        <para>
         <keycombo><keycap>^</keycap><keycap>P</keycap></keycombo>
        </para>
       </entry>
       <entry>
        <para>
         前のコマンド
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <keycombo><keycap>^</keycap><keycap>N</keycap></keycombo>
        </para>
       </entry>
       <entry>
        <para>
         履歴の次のコマンド
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <keycombo><keycap>^</keycap><keycap>A</keycap></keycombo>
        </para>
       </entry>
       <entry>
        <para>
         行の先頭に移動する
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <keycombo><keycap>^</keycap><keycap>E</keycap></keycombo>
        </para>
       </entry>
       <entry>
        <para>
         行の末尾
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <keycombo><keycap>^</keycap><keycap>B</keycap></keycombo>
        </para>
       </entry>
       <entry>
        <para>
         1文字戻る
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <keycombo><keycap>^</keycap><keycap>F</keycap></keycombo>
        </para>
       </entry>
       <entry>
        <para>
         1文字進む
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <keycombo><keycap>^</keycap><keycap>H</keycap></keycombo>
        </para>
       </entry>
       <entry>
        <para>
         バックスペース
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <keycombo><keycap>^</keycap><keycap>D</keycap></keycombo>
        </para>
       </entry>
       <entry>
        <para>
         delete
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <keycombo><keycap>^</keycap><keycap>K</keycap></keycombo>
        </para>
       </entry>
       <entry>
        <para>
         行を削除する
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <keycombo><keycap>^</keycap><keycap>U</keycap></keycombo>
        </para>
       </entry>
       <entry>
        <para>
         行を破棄する
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <keycombo><keycap>^</keycap><keycap>Y</keycap></keycombo>
        </para>
       </entry>
       <entry>
        <para>
         ヤンク(コピー)
        </para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
 </sect1>
 <sect1 xml:id="sec-grub2-commands">
  <title>役立つGRUB 2コマンド</title>

  <variablelist>
   <varlistentry xml:id="vle-grub2-mkconfig">
    <term><command>grub2-mkconfig</command>
    </term>
    <listitem>
     <para>
      <filename>/etc/default/grub</filename>および<filename>/etc/grub.d/</filename>のスクリプトに基づいて、新しい<filename>/boot/grub2/grub.cfg</filename>を生成します。
     </para>
     <example>
      <title>grub2-mkconfigの使用法</title>
<screen>grub2-mkconfig -o /boot/grub2/grub.cfg</screen>
     </example>
     <tip>
      <title>構文チェック</title>
      <para>
       パラメータを付けずに<command>grub2-mkconfig</command>を実行すると、設定がSTDOUTに出力され、そこで設定を確認できます。構文をチェックするには、<filename>/boot/grub2/grub.cfg</filename>が書き込まれた後に<xref linkend="vle-grub2-script-check"/>を使用します。
      </para>
     </tip>
     <important>
      <title><command>grub2-mkconfig</command>はUEFIセキュアブートテーブルを修復できません</title>
      <para>
       UEFIセキュアブートを使用していて、システムがGRUB 2に正常にアクセスできなくなった場合、Shimを再インストールして、UEFIブートテーブルを再生成する必要がある場合があります。次のようにします。
      </para>
<screen><prompt role="root">root # </prompt>shim-install --config-file=/boot/grub2/grub.cfg</screen>
     </important>
    </listitem>
   </varlistentry>
   <varlistentry xml:id="vle-grub2-mkrescue">
    <term><command>grub2-mkrescue</command></term>
    <listitem>
     <para>
      インストールされたGRUB 2設定の、ブート可能なレスキューイメージを作成します。
     </para>
     <example>
      <title>grub2-mkrescueの使用法</title>
<screen>grub2-mkrescue -o save_path/name.iso iso</screen>
     </example>
    </listitem>
   </varlistentry>
   <varlistentry xml:id="vle-grub2-script-check">
    <term><command>grub2-script-check</command>
    </term>
    <listitem>
     <para>
      指定したファイルの構文エラーをチェックします。
     </para>
     <example>
      <title>grub2-script-checkの使用</title>
<screen>grub2-script-check /boot/grub2/grub.cfg</screen>
     </example>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><command>grub2-once</command>
    </term>
    <listitem>
     <para>
      次のブート時にのみ使用されるデフォルトブートエントリを設定します。使用可能なブートエントリのリストを取得するには、<option>--list</option>オプションを使用します。
     </para>
     <example>
      <title>grub2-onceの使用法</title>
<screen>grub2-once number_of_the_boot_entry</screen>
     </example>
     <tip>
      <title><command>grub2-once</command>のヘルプ</title>
      <para>
       オプションを付けずにプログラムを呼び出すと、使用可能なすべてのオプションのリストを取得できます。
      </para>
     </tip>
    </listitem>
   </varlistentry>
  </variablelist>
 </sect1>
 <sect1 xml:id="sec-grub2-info">
  <title>詳細情報</title>

  <para>
   GRUB 2の詳細情報は、<link xlink:href="http://www.gnu.org/software/grub/"/>で入手できます。また、<command>grub</command>情報ページも参照してください。<phrase os="sles;sled"><quote>にあるTechnical Information Search(技術情報検索)で、キーワード</quote>GRUB 2<link xlink:href="http://www.suse.com/support"/>を検索して、特別な事項に関する情報を入手することもできます。</phrase>
  </para>
 </sect1>
</chapter>
