<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="tuning_sapconf.xml" version="5.0" xml:id="cha-tuning-sapconf">
 <info>
  <title>微调 SUSE Linux Enterprise for SAP</title>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:translation>yes</dm:translation>
  </dm:docmanager>
 </info>
 <para>
  本章介绍如何通过 <literal>sapconf</literal> 准备和微调 <phrase role="productname"><phrase os="sled">SUSE Linux Enterprise Desktop</phrase></phrase>，以便以最佳方式使用 SAP 应用程序。<literal>sapconf</literal> 适用于安装了 SAP 应用程序的 SUSE Linux Enterprise 系统。安装了 SUSE Linux Enterprise Server for SAP Applications 的客户应使用 <command>saptune</command>。
 </para>

 <note>
   <title>已去除 <command>sapconf</command> 命令</title>
   <para>
    在 SUSE Linux Enterprise Server 以及 <phrase role="productname"><phrase os="sled">SUSE Linux Enterprise Desktop</phrase></phrase> 11 和 12 中，<command>sapconf</command> 命令随附在同名的软件包中。
  </para>
  <para>
    对于 SUSE Linux Enterprise Server 和 <phrase role="productname"><phrase os="sled">SUSE Linux Enterprise Desktop</phrase></phrase> 15，情况已发生变化：命令 <command>sapconf</command> 已从 <package>sapconf</package> 软件包中去除。该软件包仅包含 <systemitem class="daemon">systemd</systemitem> 服务，不再包含 <literal>sapconf</literal> 命令行工具，以及 <literal>sapconf</literal>/<systemitem class="daemon">tuned</systemitem> 配置文件和 <systemitem class="daemon">tuned</systemitem>。
   </para>
  </note>

  <sect1 xml:id="sec-sapconf-5">
  <title>使用 <literal>sapconf</literal> 5 微调 SLE 系统</title>
  <para>
   SUSE Linux Enterprise Server 和 SUSE Linux Enterprise Server for SAP Applications 中提供了 <systemitem>sapconf</systemitem> 软件包。此软件包可为以下类型的 SAP 应用程序设置建议的参数：SAP NetWeaver、SAP HANA 和基于 SAP HANA 的应用程序。
  </para>

  <variablelist>
   <title>SUSE® Linux Enterprise Server 12 中的 <literal>sapconf</literal>5 概览</title>
   <varlistentry>
    <term><literal>sapconf</literal>5（不包含 <systemitem class="daemon">tuned</systemitem>）</term>
    <listitem>
     <itemizedlist>
      <listitem>
       <para><systemitem>sapconf-netweaver</systemitem>（取代了 <systemitem class="daemon">tuned</systemitem> 配置文件的 <literal>sapconf</literal> 配置文件）</para>
      </listitem>
      <listitem>
       <para><systemitem>sapconf-hana</systemitem>（取代了 <systemitem class="daemon">tuned</systemitem> 配置文件的 <literal>sapconf</literal> 配置文件）</para>
      </listitem>
      <listitem>
       <para><systemitem>sapconf-bobj</systemitem>（取代了 <systemitem class="daemon">tuned</systemitem> 配置文件的 <literal>sapconf</literal> 配置文件）</para>
      </listitem>
      <listitem>
       <para><systemitem>sapconf-ase</systemitem>（取代了 <systemitem class="daemon">tuned</systemitem> 配置文件的 <literal>sapconf</literal> 配置文件）</para>
      </listitem>
     </itemizedlist>
    </listitem>
   </varlistentry>
  </variablelist>

  <variablelist>
   <title>SUSE® Linux Enterprise Server 15 中的 <literal>sapconf</literal>5 概览</title>
   <varlistentry>
    <term><literal>sapconf</literal>5（不包含 <systemitem class="daemon">tuned</systemitem>）</term>
    <listitem>
     <para>不再包含配置文件</para>
    </listitem>
   </varlistentry>
  </variablelist>

  <para>
   请注意，如果您之前对系统微调进行了更改，<literal>sapconf</literal> 可能会重写这些更改。
  </para>
  <para>
   <literal>sapconf</literal> 5 随附了一个 <systemitem class="daemon">systemd</systemitem> 服务，该服务会应用微调并确保相关的服务正在运行。
  </para>
  <para>
   要使用 <literal>sapconf</literal>，请确保您的系统上已安装 <package>sapconf</package> 软件包。
  </para>

  <note>
   <title>SUSE Linux Enterprise Server 和 <phrase role="productname"><phrase os="sled">SUSE Linux Enterprise Desktop</phrase></phrase> <phrase role="productnumber"><phrase os="sles;sled">15 SP4</phrase></phrase> 中不包含配置文件</title>
   <para>
    在 SUSE Linux Enterprise Server 和 <phrase role="productname"><phrase os="sled">SUSE Linux Enterprise Desktop</phrase></phrase> 15 中，<literal>sapconf</literal> 不再支持配置文件。
   </para>
  </note>

  <sect2 xml:id="sec-sapconf-5-verify">
   <title>校验 <literal>sapconf</literal> 设置</title>
   <para>
    <literal>sapconf</literal> 5.0.2 和更高版本中提供了检查工具 <command>sapconf_check</command>，用于校验是否已正确设置 <literal>sapconf</literal>。例如：
   </para>
   <screen><prompt role="root"># </prompt><command>sapconf_check</command>
This is sapconf_check v1.0.
It verifies if sapconf is set up correctly and will give advice to do so.
Please keep in mind:
{{ - This tool does not check, if the tuning itself works correctly.}}
{{ - Follow the hints from top to down to minimize side effects.}}
Checking sapconf
================
[ OK ] sapconf package has version 5.0.2
[ OK ] saptune.service is inactive
[ OK ] saptune.service is disabled
[WARN] tuned.service is enabled/active with profile 'virtual-guest -&gt; Sapconf does not require tuned! Run 'systemctl stop tuned.service', if not needed otherwise.
[FAIL] sapconf.service is inactive -&gt; Run 'systemctl start sapconf.service' to activate the tuning now.
[FAIL] sapconf.service is disabled -&gt; Run 'systemctl enable sapconf.service' to activate sapconf at boot.1 warning(s) have been found.
2 error(s) have been found.
Sapconf will not work properly!</screen>
   <para>
    如果 <command>sapconf_check</command> 发现了问题，将会提供有关如何解决问题的提示。该工具不会校验是否已正确微调系统，只会检查 <literal>sapconf</literal> 是否已正确设置且已启动。
   </para>
  </sect2>

  <sect2 xml:id="sec-sapconf-5-enable">
   <title>启用和禁用 <literal>sapconf</literal> 并查看其状态</title>
   <para>
    安装 <literal>sapconf</literal> 后，将启用 <literal>sapconf</literal> 服务。
   </para>
   <para>
    您可以按如下所述检查或更改 <literal>sapconf</literal> 的状态：
   </para>
   <itemizedlist>
    <listitem>
     <para>
      要查看 <systemitem class="daemon">sapconf</systemitem> 服务的状态，请运行以下命令：
     </para>
     <screen><prompt role="root"># </prompt><command>systemctl status sapconf</command></screen>
     <para>
      该服务应显示为 <emphasis>active (exited)</emphasis>。
     </para>
    </listitem>
    <listitem>
     <para>
      要启动 <systemitem class="daemon">sapconf</systemitem> 服务，请运行以下命令：
     </para>
     <screen><prompt role="root"># </prompt><command>systemctl start sapconf</command></screen>
    </listitem>
    <listitem>
     <para>
      如果 <systemitem class="daemon">sapconf</systemitem> 处于禁用状态，请使用以下命令将其启用并启动：
     </para>
     <screen><prompt role="root"># </prompt><command>systemctl enable --now sapconf</command></screen>
    </listitem>
    <listitem>
     <para>
      要停止 <systemitem class="daemon">sapconf</systemitem> 服务，请运行以下命令：
     </para>
     <screen><prompt role="root"># </prompt><command>systemctl stop sapconf</command></screen>
     <para>
      此命令将立即禁用绝大多数优化设置。只有需要重引导系统才能启用/禁用的选项例外。
     </para>
    </listitem>
    <listitem>
     <para>
      要禁用 <systemitem class="daemon">sapconf</systemitem>，请使用以下命令：
     </para>
     <screen><prompt role="root"># </prompt><command>systemctl disable sapconf</command></screen>
     <para>
      如果您未特意自行启用 <literal>sapconf</literal> 所依赖的任何服务，则此命令还会禁用 <literal>sapconf</literal> 所使用的大多数微调参数和所有服务。
     </para>
    </listitem>
   </itemizedlist>

   <tip>
    <title><literal>sapconf</literal> 依赖的其他服务</title>
    <para>
     除了 <literal>sapconf</literal> 服务以外，它还依赖于以下两个服务：
    </para>
    <itemizedlist>
     <listitem>
      <para>
       <systemitem class="daemon">sysstat</systemitem>，该服务用于收集有关系统活动的数据。
      </para>
     </listitem>
     <listitem>
      <para>
       <systemitem class="daemon">uuidd</systemitem>，该服务会生成基于时间的 UUID，即使是在涉及许多处理器核心的设置中，也能保证这些 UUID 是唯一的。这对于 SAP 应用程序而言非常必要。
      </para>
     </listitem>
    </itemizedlist>
   </tip>
  </sect2>
  <sect2 xml:id="sec-sapconf-5-configure">
   <title>配置 <literal>sapconf</literal>5</title>
   <para>
    一般情况下，<literal>sapconf</literal> 的默认配置已使用 SAP 建议的参数值。但如果您有特殊需求，可以配置该工具以更好地满足这些需求。
   </para>
   <para>
    您可以在 <filename>/etc/sysconfig/sapconf</filename> 文件查看 <literal>sapconf</literal> 的所有参数。您可以直接编辑此文件。此文件中的所有参数都会通过注释和对 SAP 说明（可在 <link xlink:href="https://launchpad.support.sap.com/"/> 上查看）的引用进行解释。
   </para>
   <para>
    更新 <literal>sapconf</literal> 时，系统会尽可能多地保留此文件中的所有自定义参数。但是，有时无法将参数完全传输到新配置文件中。因此，建议在更新后检查以前的自定义配置（在更新期间将转移到 <filename>/etc/sysconfig/sapconf.rpmsave</filename>）与新版本（位于 <filename>/etc/sysconfig/sapconf</filename>）之间的差异。
   </para>
   <para>
    与此文件相关的日志消息将写入 <filename>/var/log/sapconf.log</filename> 中。
   </para>
   <para>
    编辑其中的任一文件时，您会发现，某些值已通过行首的 <literal>#</literal> 字符注释掉。这表示尽管该参数与微调相关，但它没有适当的默认值。
   </para>
   <para>
    相反，您可以在行首添加 <literal>#</literal> 字符来注释掉特定参数。但应该避免这种做法，因为这可能会导致 <literal>sapconf</literal> 无法正常应用配置文件。
   </para>
   <para>
    要应用编辑的配置，请重启动 <literal>sapconf</literal>：
   </para>
   <screen><prompt role="root"># </prompt><command>systemctl restart sapconf</command></screen>
   <para>
    确认是否正确应用了某个参数值的方式根据参数的不同而异。因此，以下方法仅用作示例：
   </para>
   <example xml:id="ex-sapconf-change-parameter-5">
    <title>检查参数</title>
    <para>
     要确认是否已应用 <literal>TCP_SLOW_START</literal> 的设置，请执行以下操作：
    </para>
    <itemizedlist>
     <listitem>
      <para>
       查看 <literal>sapconf</literal> 的日志文件，以确定它是否应用了该值。在 <filename>/var/log/sapconf.log</filename> 中，检查是否存在包含以下文本的行：
      </para>
      <screen>Change net.ipv4.tcp_slow_start_after_idle from 1 to 0</screen>
      <para>
       或者，参数可能在 <literal>sapconf</literal> 启动之前已正确设置。在这种情况下，<literal>sapconf</literal> 将不更改其值：
      </para>
      <screen>Leaving net.ipv4.tcp_slow_start_after_idle unchanged at 1</screen>
     </listitem>
     <listitem>
      <para>
       可以在 <filename>/proc/sys/net.ipv4.tcp_slow_start_after_idle</filename> 中手动配置 <literal>TCP_SLOW_START</literal> 后面的基础选项。要检查其实际的当前值，请使用以下命令：
      </para>
      <screen><prompt role="root"># </prompt><command>sysctl net.ipv4.tcp_slow_start_after_idle</command></screen>
     </listitem>
    </itemizedlist>
   </example>
  </sect2>
  <sect2 xml:id="sec-sapconf-5-remove">
   <title>去除 <literal>sapconf</literal></title>
   <para>
    要从系统中去除 <literal>sapconf</literal>，请使用以下命令卸装其软件包：
   </para>
   <screen><prompt role="root"># </prompt><command>zypper rm sapconf</command></screen>
   <para>
    请注意，执行此操作不会卸装 <literal>sapconf</literal> 的依赖项，但 <systemitem class="daemon">sysstat</systemitem> 服务将进入禁用状态。如果您仍然需要此服务，请务必再次启用它。
   </para>
  </sect2>
  <sect2 xml:id="sec-sapconf-5-more">
   <title>更多信息</title>
   <para>
    以下手册页提供了有关 <literal>sapconf</literal> 的更多信息：
   </para>
   <itemizedlist>
    <listitem>
     <para>
      <literal>sapconf</literal> 设置的所有微调参数的详细说明：<command>man 5 sapconf</command>
     </para>
    </listitem>
    <listitem>
     <para>
      有关配置和自定义 <literal>sapconf</literal> 配置文件的信息：<command>man 7 sapconf</command>
     </para>
    </listitem>
   </itemizedlist>
   <para>
    另请参见 <link xlink:href="https://www.suse.com/c/a-new-sapconf-is-available/"/> 上的博客系列，其中详细介绍了 <literal>sapconf</literal> 的更新版本。
   </para>
  </sect2>
  <sect2 xml:id="sec-sapconf-5-tuned">
   <title>将 <command>tuned</command> 与 <literal>sapconf</literal> 一起使用</title>
   <para>
    在版本 5 中，<literal>sapconf</literal> 不再依赖于 <systemitem class="daemon">tuned</systemitem>。这意味着，这两个工具都可以单独使用。如果 <command>tuned</command> 服务已启动，<literal>sapconf</literal> 将在其日志中列显警告。
   </para>
   <important>
    <title>将 <command>tuned</command> 与 <literal>sapconf</literal> 一起使用</title>
    <para>
     如果您要同时使用 <command>tuned</command> 和 <literal>sapconf</literal>，请务必小心，因为这两个工具配置的系统参数不同。
    </para>
   </important>
  </sect2>
 </sect1>
</chapter>
