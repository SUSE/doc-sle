<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sect1 PUBLIC "-//Novell//DTD NovDoc XML V1.0//EN" "novdocx.dtd">
<!--
*********************************
Please see LICENSE.txt for this document's license.
*********************************
-->
<sect1 xml:base="lvm.xml" id="sec.yast2.system.lvm">
 <title>Configuração do LVM</title><indexterm> <primary>YaST</primary> <secondary>LVM</secondary></indexterm><indexterm> <primary>LVM</primary> <secondary>YaST</secondary></indexterm><indexterm> <primary>Gerenciador de Volumes Lógicos</primary> <see>LVM</see></indexterm>

 <para>
  Esta seção descreve resumidamente os princípios por trás do Gerenciador de Volumes Lógicos (LVM) e seus recursos para várias finalidades. Na <xref linkend="sec.yast2.system.lvm.yast"/>, aprenda como configurar o LVM com o YaST.
 </para>

 <warning>
  <title>Fazer backup dos dados</title>
  <para>
   O uso do LVM é algumas vezes associado a um risco mais elevado, como perda de dados. O risco também inclui falhas de aplicativo, de energia e em comandos. Grave os dados antes de implementar o LVM ou reconfigurar volumes. Nunca trabalhe sem backup.
  </para>
 </warning>

 <sect2 id="sec.yast2.system.lvm.explained">
  <title>Gerenciador de Volumes Lógicos</title>
  <para>
   O LVM permite uma distribuição flexível do espaço do disco rígido em vários sistemas de arquivos. Ele foi desenvolvido porque, às vezes, a necessidade de mudar a segmentação do espaço no disco rígido surge logo após a realização do particionamento inicial. Como é difícil modificar partições em um sistema em execução, o LVM fornece um pool virtual, ou seja, VG (Volume Group — Grupo de Volume) de espaço em memória com base no qual os LVs (Logical Volumes — Volumes Lógicos) podem ser criados conforme o necessário. O sistema operacional acessa esses LVs, em vez de acessar as partições físicas. Os grupos de volume podem ocupar mais de um disco, de forma que vários discos ou partes deles possam constituir um único grupo de volume. Dessa forma, o LVM oferece um tipo de abstração do espaço em disco físico, permitindo que a segmentação seja modificada de maneira muito mais fácil e segura do que no reparticionamento físico. É possível encontrar outras informações sobre o particionamento físico na <xref linkend="sec.IB.part.typen"/> e na<xref linkend="sec.yast2.i_y2_part_expert"/>.
  </para>
  <figure id="fig.lvm.explained.schematic">
   <title>Particionamento físico versus LVM</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="lvm.svg" width="75%" format="SVG"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="lvm.png" width="75%" format="PNG"/>
    </imageobject>
   </mediaobject>
  </figure>
  <para>
   <xref linkend="fig.lvm.explained.schematic"/> A  compara o particionamento físico (esquerda) com a segmentação do LVM (direita). Do lado esquerdo, um único disco foi dividido em três partições físicas (PART), cada uma com um ponto de montagem (MP) atribuído para que o sistema operacional possa obter acesso. Do lado direito, dois discos foram divididos em duas e três partições físicas cada. Foram definidos dois grupos de volume (VG1 e VG2) do LVM. O VG1 contém duas partições do DISCO 1 e uma do DISCO 2. O VG2 contém as duas partições restantes do DISCO 2. No LVM, as partições físicas do disco incorporadas a um grupo de volume são chamadas de PVs (physical volumes — volumes físicos). Dentro dos grupos de volume, quatro volumes lógicos (LVs) (LV 1 a LV 4) foram definidos. Eles podem ser usados pelo sistema operacional por meio dos pontos de montagem associados. A fronteira entre os diferentes LVs não precisa estar alinhada com as fronteiras das partições. Veja a fronteira entre LV1 e LV2 neste exemplo.
  </para>
  <para>
   Recursos do LVM:
  </para>
  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>
     Vários discos rígidos ou partições podem ser combinados em um grande volume lógico.
    </para>
   </listitem>
   <listitem>
    <para>
     Se a configuração for adequada, um LV (como <filename>/usr</filename>) poderá ser aumentado quando esgotar o espaço livre.
    </para>
   </listitem>
   <listitem>
    <para>
     Com o LVM, é possível adicionar discos rígidos ou LVs no sistema em execução. No entanto, isso requer hardware hot pluggable (conectável a quente).
    </para>
   </listitem>
   <listitem>
    <para>
     É possível ativar um "modo de distribuição" que distribua o fluxo de dados de um LV entre vários PVs. Se esses volumes físicos (PVs) residirem em discos diferentes, o desempenho de leitura e gravação será aprimorado, assim como no RAID 0.
    </para>
   </listitem>
   <listitem>
    <para>
     O recurso de instantâneo permite backups consistentes (especialmente para servidores) do sistema em execução.
    </para>
   </listitem>
  </itemizedlist>
  <para>
   Com esses recursos, o LVM está pronto para computadores pessoais amplamente usados ou pequenos servidores. O LVM é perfeito para usuário com crescente estoque de dados (como no caso de bancos de dados, arquivos de música ou diretórios de usuário). Ele permite o uso de sistemas de arquivos maiores do que o disco rígido físico. Outra vantagem do LVM é a possibilidade de adicionar até 256 LVs. No entanto, trabalhar com o LVM é diferente de trabalhar com partições convencionais. Instruções e informações adicionais sobre a configuração do LVM estão disponíveis no HOWTO (Como Fazer) oficial do LVM, em <ulink url="http://tldp.org/HOWTO/LVM-HOWTO/"/>.
  </para>
  <para>
   O LVM versão 2 está disponível desde a versão 2.6 do Kernel, que possui compatibilidade retroativa com o LVM anterior e permite o gerenciamento contínuo de grupos de volume antigos. Ao criar novos grupos de volume, decida se vai usar o novo formato ou a versão com compatibilidade retroativa. O LVM 2 não requer qualquer patch de kernel. Ele usa o mapeador de dispositivos integrado ao kernel 2.6. Esse kernel suporta apenas o LVM versão 2. Portanto, ao mencionar o LVM, esta seção sempre fará referência ao LVM versão 2.
  </para>
  <sect3 id="sec.yast2.system.lvm.explained.thin">
   <title>Aprovisionamento dinâmico</title>
   <para>
    A partir da versão do Kernel 3.4, o LVM suporta o aprovisionamento dinâmico. O volume com aprovisionamento dinâmico dispõe de capacidade virtual e real. A capacidade <emphasis>virtual</emphasis> é a quantidade de armazenamento de volume disponível para o host. A capacidade <emphasis>real</emphasis> é a quantidade de armazenamento alocada a uma cópia de volume de um pool de armazenamento. Em um volume completamente alocado, as capacidades virtual e real são as mesmas. Em um volume com aprovisionamento dinâmico, no entanto, a capacidade virtual pode ser muito maior que a capacidade real. Se o volume com aprovisionamento dinâmico não tiver capacidade real suficiente para uma operação de gravação, o volume será colocado offline e um erro será registrado.
   </para>
   <para>
    Para obter mais informações gerais, consulte <ulink url="http://wikibon.org/wiki/v/Thin_provisioning"/>.
   </para>
  </sect3>
 </sect2>

 <sect2 id="sec.yast2.system.lvm.yast">
  <title>Configuração do LVM com o YaST</title>
  <para>
   A configuração do YaST LVM pode ser feita através do Particionador Técnico do YaST (consulte a <xref linkend="sec.yast2.i_y2_part_expert"/>) no item <guimenu>Gerenciamento de Volumes</guimenu> do painel <guimenu>Tela do Sistema</guimenu>. O Particionador Técnico permite editar e apagar partições existentes e também criar partições novas que precisam ser usadas com o LVM. A primeira tarefa consiste em criar PVs que forneçam espaço para um grupo de volumes:
  </para>
  <procedure>
   <step performance="required">
    <para>
     Selecione um disco rígido em <guimenu>Discos Rígidos</guimenu>.
    </para>
   </step>
   <step performance="required">
    <para>
     Mude para a guia <guimenu>Partições</guimenu>.
    </para>
   </step>
   <step performance="required">
    <para>
     Clique em <guimenu>Adicionar</guimenu> e digite o tamanho desejado do PV neste disco.
    </para>
   </step>
   <step performance="required">
    <para>
     Use <guimenu>Não formatar a partição</guimenu> e mude o <guimenu>ID do Sistema de Arquivos</guimenu> para <guimenu>0x8E Linux LVM</guimenu>. Não monte essa partição.
    </para>
   </step>
   <step performance="required">
    <para>
     Repita esse procedimento até definir todos os volumes físicos desejados nos discos disponíveis.
    </para>
   </step>
  </procedure>
  <sect3 id="sec.yast2.system.lvm.yast.volume_groups">
   <title>Criando grupos de volume</title>
   <para>
    Se não houver nenhum grupo de volume no sistema, adicione um (veja a <xref linkend="fig.lvm.yast.volgrp"/>). É possível criar grupos adicionais clicando em <guimenu>Gerenciamento de Volumes</guimenu> no painel <guimenu>Tela do Sistema</guimenu> e depois clicando em <guimenu>Adicionar Grupo de Volume</guimenu>. Um único grupo de volume geralmente é suficiente.
   </para>
   <procedure>
    <step performance="required">
     <para>
      Digite um nome para o VG, por exemplo, <literal>system</literal>.
     </para>
    </step>
    <step performance="required">
     <para>
      Selecione o <guimenu>Tamanho Físico Estendido</guimenu> desejado. O valor define o tamanho de um bloco físico no grupo de volumes. Todo o espaço em disco no grupo de volume é trabalhado em blocos desse tamanho.
     </para>
    </step>
    <step performance="required">
     <para>
      Adicione os PVs preparados ao VG, selecionando o dispositivo e clicando em <guimenu>Adicionar</guimenu>. É possível selecionar vários dispositivos pressionando <keycap function="control"/> e, ao mesmo tempo, selecionando os dispositivos.
     </para>
    </step>
    <step performance="required">
     <para>
      Selecione <guimenu>Concluir</guimenu> para disponibilizar o VG para mais etapas de configuração.
     </para>
    </step>
   </procedure>
   <figure id="fig.lvm.yast.volgrp">
    <title>Criando um grupo de volume</title>
    <mediaobject>
     <imageobject role="fo">
      <imagedata fileref="yast2_lvm4.png" width="75%" format="PNG"/>
     </imageobject>
     <imageobject role="html">
      <imagedata fileref="yast2_lvm4.png" width="75%" format="PNG"/>
     </imageobject>
    </mediaobject>
   </figure>
   <para>
    Se tiver vários grupos de volume definidos e quiser adicionar ou remover PVs, selecione o grupo de volume na lista <guimenu>Gerenciamento de Volumes</guimenu> e clique em <guimenu>Redimensionar</guimenu>. Na janela a seguir, é possível adicionar ou remover PVs para o grupo de volume selecionado.
   </para>
  </sect3>
  <sect3 id="sec.yast2.system.lvm.yast.logical_vol">
   <title>Configurando volumes lógicos</title>
   <para>
    Depois que o grupo de volume for preenchido com PVs, defina os LVs que o sistema operacional usará na próxima caixa de diálogo. Escolha o grupo de volumes atual e mude para a guia <guimenu>Volumes Lógicos</guimenu>. <guimenu>Adicione</guimenu>, <guimenu>Edite</guimenu>, <guimenu>Redimensione</guimenu> e <guimenu>Apague</guimenu> LVs conforme necessário até todo o espaço no grupo de volume ser ocupado. Atribua pelo menos um LV a cada grupo de volumes.
   </para>
   <figure id="fig.lvm.yast.mgmt">
    <title>Gerenciamento de volume lógico</title>
    <mediaobject>
     <imageobject role="fo">
      <imagedata fileref="yast2_lvm6.png" width="75%" format="PNG"/>
     </imageobject>
     <imageobject role="html">
      <imagedata fileref="yast2_lvm6.png" width="75%" format="PNG"/>
     </imageobject>
    </mediaobject>
   </figure>
   <para>
    Clique em <guimenu>Adicionar</guimenu> e percorra o popup semelhante a um assistente que é aberto:
   </para>
   <orderedlist spacing="normal">
    <listitem>
     <para>
      Digite o nome do LV. Para uma partição que deve ser montada em <filename>/home</filename>, é possível usar um nome como <literal>HOME</literal>.
     </para>
    </listitem>
    <listitem>
     <para>
      Selecione o tipo de LV. Ele pode ser <guimenu>Volume Normal</guimenu>, <guimenu>Pool Dinâmico</guimenu> ou <guimenu>Volume Dinâmico</guimenu>. Observe que você precisa criar primeiro o pool dinâmico, que é capaz de armazenar volumes dinâmicos individuais.
     </para>
    </listitem>
    <listitem>
     <para>
      Selecione o tamanho e o número de distribuições do LV. Se você tem apenas um PV, não é útil selecionar mais de uma distribuição.
     </para>
     <tip>
      <para>
       A grande vantagem do aprovisionamento dinâmico é que a soma de todos os volumes dinâmicos armazenados no pool dinâmico pode exceder o tamanho do próprio pool.
      </para>
     </tip>
    </listitem>
    <listitem>
     <para>
      Escolha o sistema de arquivos para utilizar no LV e também o ponto de montagem.
     </para>
    </listitem>
   </orderedlist>
   <para>
    O uso de distribuições permite distribuir o fluxo de dados no LV entre vários PVs (distribuição). Entretanto, a remoção de um volume pode ser feita apenas por PVs diferentes, cada um fornecendo pelo menos a quantidade de espaço do volume. O número máximo de distribuições é igual ao número de PVs, em que Distribuição "1" significa "sem distribuição". Distribuir só faz sentido com PVs em discos rígidos diferentes; do contrário, o desempenho será reduzido.
   </para>
   <warning>
    <title>Distribuindo</title>
    <para>
     O YaST não pode, até este ponto, verificar se as suas entradas estão corretas no que diz respeito à distribuição. Qualquer erro realizado aqui será mostrado somente mais tarde, quando o LVM for implementado em disco.
    </para>
   </warning>
   <para>
    Se você já tiver configurado o LVM no sistema, os volumes lógicos existentes também poderão ser usados. Antes de continuar, atribua os pontos de montagem apropriados a esses LVs. Clique em <guimenu>Concluir</guimenu> para retornar ao Particionador Técnico do YaST e concluir seu trabalho.
   </para>
  </sect3>
 </sect2>


</sect1>
