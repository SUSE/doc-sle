<?xml version="1.0" encoding="UTF-8"?>
<sect1 xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="zypper.xml" version="5.0" xml:id="sec.zypper">
 <title>Usando o zypper</title>

 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:bugtracker/>
   <dm:translation>yes (sim)</dm:translation>
  </dm:docmanager>
 </info>

 <para>
  O Zypper é um gerenciador de pacote de linha de comando para instalar, atualizar e remover pacotes, além de gerenciar repositórios. Ele é especialmente útil para realizar tarefas de gerenciamento remoto de software ou gerenciar software de scripts de shell.
 </para>

 <sect2 xml:id="sec.zypper.usage">
  <title>Uso geral</title>
  <para>
   A sintaxe geral do zypper é:
  </para>
<screen><prompt>tux &gt; </prompt>zypper <option>[--global-options]</option> <replaceable>command</replaceable> <option> [--command-options]</option> <option>[arguments]</option></screen>

  <para>
   Os componentes entre colchetes não são obrigatórios. Consulte <command>zypper help</command> para obter uma lista de opções gerais e todos os comandos. Para obter ajuda sobre determinado comando, digite <command>zypper help</command> <replaceable>comando</replaceable>.
  </para>
  <variablelist>
   <varlistentry>
    <term>Comandos do Zypper</term>
    <listitem>
     <para>
      A maneira mais simples de executar o zypper é digitar seu nome seguido de um comando. Por exemplo, para aplicar todos os patches necessários ao sistema, use:
     </para>
<screen><prompt>tux &gt; </prompt>sudo zypper patch</screen>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Opções globais</term>
    <listitem>
     <para>
      Você também pode escolher dentre uma ou mais opções globais, digitando-as logo antes do comando:
     </para>
<screen><prompt>tux &gt; </prompt>sudo zypper --non-interactive patch</screen>
     <para>
      No exemplo acima, a opção <option>--non-interactive</option> significa que o comando é executado sem perguntar nada (aplicando as respostas padrão automaticamente).
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Opções específicas do comando</term>
    <listitem>
     <para>
      Para usar as opções específicas de determinado comando, digite-as logo após o comando:
     </para>
<screen><prompt>tux &gt; </prompt>sudo zypper patch --auto-agree-with-licenses</screen>
     <para>
      No exemplo acima, a opção <option>--auto-agree-with-licenses</option> é usada para aplicar todos os patches necessários a um sistema sem que você precise confirmar todas as licenças. Em vez disso, a licença é aceita automaticamente.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Argumentos</term>
    <listitem>
     <para>
      Alguns comandos requerem um ou mais argumentos. Por exemplo, ao usar o comando <command>install</command>, você precisa especificar qual pacote (ou pacotes) deseja <emphasis>instalar</emphasis>:
     </para>
<screen><prompt>tux &gt; </prompt>sudo zypper install mplayer</screen>
     <para>
      Algumas opções também requerem um único argumento. O comando a seguir lista todos os padrões conhecidos:
     </para>
<screen><prompt>tux &gt; </prompt>zypper search -t pattern</screen>
    </listitem>
   </varlistentry>
  </variablelist>
  <para>
   Você pode combinar todos os anteriores. Por exemplo, o comando a seguir instala os pacotes
   <package>aspell-de</package>
   e
   <package>aspell-fr</package>
   do repositório <literal>factory</literal> durante o modo verboso:
  </para>
<screen><prompt>tux &gt; </prompt>sudo zypper -v install --from factory aspell-de aspell-fr</screen>
  <para>
   A opção <option>--from</option> trata de manter todos os repositórios habilitados (para resolução de dependências) enquanto solicita o pacote do repositório especificado.
  </para>
  <para>
   Quase todos os comandos zypper possuem uma opção <literal>dry-run</literal> que simula o comando indicado. Ela pode ser usada para fins de teste.
  </para>
<screen><prompt>tux &gt; </prompt>sudo zypper remove --dry-run MozillaFirefox</screen>
  <para>
   O Zypper suporta a opção global <option>--userdata <replaceable>string</replaceable></option>. É possível especificar uma string com essa opção, que é gravada nos arquivos de registro e plug-ins do Zypper (como o plug-in Btrfs). Ela pode ser usada para marcar e identificar transações nos arquivos de registro.
  </para>
<screen><prompt>tux &gt; </prompt>sudo zypper --userdata <replaceable>string</replaceable> patch</screen>
 </sect2>

 <sect2 xml:id="sec.zypper.softman">
  <title>Instalando e removendo software com o zypper</title>
  <para>
   Para instalar ou remover pacotes, use os seguintes comandos:
  </para>
<screen><prompt>tux &gt; </prompt>sudo zypper install <replaceable>package_name</replaceable>
<prompt>tux &gt; </prompt>sudo zypper remove <replaceable>package_name</replaceable></screen>

  <warning>
   <title>Não remova pacotes obrigatórios do sistema</title>
   <para>
    Não remova pacotes obrigatórios do sistema, como
    <package>glibc</package>
    ,
    <package>zypper</package>
    ,
    <package>kernel</package>
    . Se eles forem removidos, o sistema poderá ficar instável ou parar de funcionar completamente.
   </para>
  </warning>
  <sect3 xml:id="sec.zypper.selectpackage">
   <title>Selecionando os pacotes para instalar ou remover</title>
   <para>
    Há várias maneiras de resolver pacotes com os comandos <command>zypper install</command> e <command>zypper remove</command>.
   </para>
   <variablelist>
    <varlistentry>
     <term>Pelo Nome Exato do Pacote</term>
     <listitem>
<screen><prompt>tux &gt; </prompt>sudo zypper install MozillaFirefox</screen>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>Pelo Nome Exato e Número da Versão do Pacote</term>
     <listitem>
<screen><prompt>tux &gt; </prompt>sudo zypper install MozillaFirefox-3.5.3</screen>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>Pelo Álias do Repositório e Nome do Pacote</term>
     <listitem>
<screen><prompt>tux &gt; </prompt>sudo zypper install mozilla:MozillaFirefox</screen>
      <para>
       onde <literal>mozilla</literal> é o álias do repositório do qual instalar.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>Pelo Nome do Pacote Usando Curingas</term>
     <listitem>
      <para>
       Você pode selecionar todos os pacotes que tenham nomes iniciando ou terminando com determinada string. Use os curingas com cuidado, principalmente ao remover pacotes. O comando a seguir instala todos os pacotes que começam com <quote>Moz</quote>:
      </para>
<screen><prompt>tux &gt; </prompt>sudo zypper install 'Moz*'</screen>
      <tip>
       <title>Removendo todos os pacotes <filename>-debuginfo</filename></title>
       <para>
        Ao depurar um problema, às vezes você precisa instalar temporariamente muitos pacotes <filename>-debuginfo</filename>, que apresentam mais informações sobre a execução dos processos. Depois que a sessão de depuração termina, e você precisa limpar o ambiente, execute o seguinte:
       </para>
<screen><prompt>tux &gt; </prompt>sudo zypper remove '*-debuginfo'</screen>
      </tip>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>Por Recurso</term>
     <listitem>
      <para>
       Por exemplo, para instalar um módulo Perl sem saber o nome do pacote, os recursos podem ser convenientes:
      </para>
<screen><prompt>tux &gt; </prompt>sudo zypper install firefox</screen>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>Por Recurso, Arquitetura de Hardware ou Versão</term>
     <listitem>
      <para>
       Juntamente com um recurso, você pode especificar uma arquitetura de hardware e uma versão:
      </para>
      <itemizedlist>
       <listitem>
        <para>
         O nome da arquitetura de hardware desejada é anexado ao recurso após um ponto final. Por exemplo, para especificar as arquiteturas AMD64/Intel 64 (que no Zypper é denominada <literal>x86_64</literal>), use:
        </para>
<screen><prompt>tux &gt; </prompt>sudo zypper install 'firefox.x86_64'</screen>
       </listitem>
       <listitem>
        <para>
         As versões devem ser anexadas ao fim da string e precedidas por um operador: <literal>&lt;</literal> (menor do que), <literal>&lt;=</literal> (menor do que ou igual a), <literal>=</literal> (igual a), <literal>&gt;=</literal> (maior do que ou igual a), <literal>&gt;</literal> (maior do que).
        </para>
<screen><prompt>tux &gt; </prompt>sudo zypper install 'firefox&gt;=3.5.3'</screen>
       </listitem>
       <listitem>
        <para>
         Você também pode combinar um requisito de versão e arquitetura de hardware:
        </para>
<screen><prompt>tux &gt; </prompt>sudo zypper install 'firefox.x86_64&gt;=3.5.3'</screen>
       </listitem>
      </itemizedlist>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>Por Caminho para o arquivo RPM</term>
     <listitem>
      <para>
       Você também pode especificar um local ou caminho remoto para um pacote:
      </para>
<screen><prompt>tux &gt; </prompt>sudo zypper install /tmp/install/MozillaFirefox.rpm
<prompt>tux &gt; </prompt>sudo zypper install http://download.opensuse.org/repositories/mozilla/SLE_12/x86_64/MozillaFirefox-45.0.2-1.1.x86_64.rpm</screen>
     </listitem>
    </varlistentry>
   </variablelist>
  </sect3>
  <sect3 xml:id="sec.zypper.combineinstall">
   <title>Combinando a instalação e remoção de pacotes</title>
   <para>
    Para instalar e remover pacotes simultaneamente, use os modificadores <literal>+/-</literal>. Para instalar
    <package>emacs</package>
    e remover simultaneamente
    <package>vim</package>
    , usar:
   </para>
<screen><prompt>tux &gt; </prompt>sudo zypper install emacs -vim</screen>
   <para>
    Para remover
    <package>emacs</package>
    e instalar simultaneamente
    <package>vim</package>
    , usar:
   </para>
<screen><prompt>tux &gt; </prompt>sudo zypper remove emacs +vim</screen>
   <para>
    Para impedir que o nome do pacote iniciado por <literal>-</literal> seja interpretado como uma opção de comando, use-o sempre como segundo argumento. Se isso não for possível, preceda-o com <literal>--</literal>:
   </para>
<screen><prompt>tux &gt; </prompt>sudo zypper install -emacs +vim       # Wrong
<prompt>tux &gt; </prompt>sudo zypper install vim -emacs        # Correct
<prompt>tux &gt; </prompt>sudo zypper install -- -emacs +vim    # same as above
<prompt>tux &gt; </prompt>sudo zypper remove emacs +vim         # same as above</screen>
  </sect3>
  <sect3 xml:id="sec.zypper.clean">
   <title>Limpando as dependências dos pacotes removidos</title>
   <para>
    Para (com determinado pacote) remover automaticamente qualquer pacote desnecessário após remover o pacote especificado, use a opção <option>--clean-deps</option>:
   </para>
<screen><prompt>tux &gt; </prompt>sudo zypper rm <replaceable>package_name</replaceable> --clean-deps</screen>
  </sect3>
  <sect3 xml:id="sec.zypper.script">
   <title>Usando o Zypper em scripts</title>
   <para>
    Por padrão, o zypper solicita uma confirmação antes de instalar ou remover um pacote selecionado, ou quando ocorre um problema. Você pode anular esse comportamento usando a opção <option>--non-interactive</option>. Essa opção deve ser inserida antes do comando real (<command>install</command>, <command>remove</command> e <command>patch</command>), conforme mostrado a seguir:
   </para>
<screen><prompt>tux &gt; </prompt>sudo zypper <option>--non-interactive</option> install <replaceable>package_name</replaceable></screen>
   <para>
    Essa opção permite o uso do zypper em scripts e tarefas cron.
   </para>
  </sect3>
  <sect3 xml:id="sec.zypper.softman.sources">
   <title>Instalando ou fazendo download dos pacotes de origem</title>
   <para>
    Se você deseja instalar o pacote de origem correspondente de um pacote, use:
   </para>
<screen><prompt>tux &gt; </prompt>zypper source-install <replaceable>package_name</replaceable></screen>
   <para>
    Quando executados como <systemitem class="username">root</systemitem>, o local padrão para instalar pacotes de origem é <filename>/usr/src/packages/</filename> e <filename>~/rpmbuild</filename>, quando executados como usuário. Esses valores podem ser mudados em sua configuração de <command>rpm</command> local.
   </para>
   <para>
    Esse comando também instala as dependências de compilação do pacote especificado. Se não quiser isso, adicione o switch <literal>-D</literal>. Para instalar apenas as dependências de compilação, use <literal>-d</literal>.
   </para>
<screen><prompt>tux &gt; </prompt>sudo zypper source-install -D <replaceable>package_name</replaceable> # source package only
<prompt>tux &gt; </prompt>sudo zypper source-install -d <replaceable>package_name</replaceable> # build dependencies only</screen>
   <para>
    Naturalmente isso só funcionará se o repositório com os pacotes de origem estiver habilitado na sua lista de repositórios (ele é adicionado por padrão, mas não habilitado). Consulte a <xref linkend="sec.zypper.instrepo"/> para obter os detalhes sobre o gerenciamento de repositórios.
   </para>
   <para>
    Uma lista de todos os pacotes de origem disponíveis nos seus repositórios pode ser obtida com:
   </para>
<screen><prompt>tux &gt; </prompt>zypper search -t srcpackage</screen>
   <para>
    É possível também fazer download dos pacotes de origem para todos os pacotes instalados em um diretório local. Para fazer download dos pacotes de origem, use:
   </para>
<screen><prompt>tux &gt; </prompt>zypper source-download</screen>
   <para>
    O diretório de download padrão é <filename>/var/cache/zypper/source-download</filename>. Você pode mudá-lo usando a opção <option>--directory</option>. Para mostrar apenas os pacotes ausentes ou incorretos sem fazer download nem apagar nada, use a opção <option>--status</option>. Para apagar pacotes de origem incorretos, use a opção <option>--delete</option>. Para desabilitar a exclusão, use a opção <option>--no-delete</option>.
   </para>
  </sect3>
  <sect3 xml:id="sec.zypper.softman.pluscontent">
   <title>Instalando pacotes de repositórios desabilitados</title>
   <para>
    Normalmente, você só pode instalar pacotes de repositórios habilitados. A opção <option>--plus-content <replaceable>tag</replaceable></option> ajuda você a especificar os repositórios que devem ser atualizados, temporariamente habilitados durante a sessão atual do Zypper e desabilitados após sua conclusão.
   </para>
   <para>
    Por exemplo, para habilitar os repositórios que podem fornecer pacotes <filename>-debuginfo</filename> ou <filename>-debugsource</filename> adicionais, use <option>--plus-content debug</option>. É possível especificar essa opção várias vezes.
   </para>
   <para>
    Para habilitar temporariamente esses repositórios de "depuração" para instalar determinado pacote <filename>-debuginfo</filename>, use a opção da seguinte forma:
   </para>
<screen><prompt>tux &gt; </prompt>sudo zypper --plus-content debug install "debuginfo(build-id)=eb844a5c20c70a59fc693cd1061f851fb7d046f4"</screen>
   <para>
    A string <literal>build-id</literal> é informada pelo <command>gdb</command> a respeito dos pacotes debuginfo ausentes.
   </para>
  </sect3>
  <sect3 xml:id="sec.zypper.softman.util">
   <title>Utilitários</title>
   <para>
    Para verificar se todas as dependências ainda são atendidas e para reparar dependências ausentes, use:
   </para>
<screen><prompt>tux &gt; </prompt>zypper verify</screen>
   <para>
    Além das dependências que precisam ser atendidas, alguns pacotes <quote>recomendam</quote> outros pacotes. Esses pacotes recomendados são instalados apenas quando estão realmente disponíveis e são instaláveis. Caso os pacotes recomendados fiquem disponíveis após a instalação do pacote que os recomendou (adicionando outros pacotes ou hardware), use o seguinte comando:
   </para>
<screen><prompt>tux &gt; </prompt>sudo zypper install-new-recommends</screen>
   <para>
    Esse comando será muito útil após conectar uma webcam ou um dispositivo Wi-Fi. Ele instala drivers para o dispositivo e software relacionado, se disponíveis. Os drivers e o software relacionado serão instaláveis se determinadas dependências de hardware forem atendidas.
   </para>
  </sect3>
 </sect2>

 <sect2 xml:id="sec.zypper.softup">
  <title>Atualizando software com o zypper</title>
  <para>
   Existem três maneiras diferentes de atualizar o software usando o zypper: instalando patches, instalando uma versão nova de um pacote ou atualizando a distribuição inteira. Para a segunda opção, use o comando <command>zypper dist-upgrade</command>. O upgrade do <phrase role="productname"><phrase os="sled">SUSE Linux Enterprise Desktop</phrase></phrase> é abordado no <phrase os="sles;sled"><xref linkend="cha.update.sle"/></phrase> .
  </para>
  <sect3 xml:id="sec.zypper.softup.patch">
   <title>Instalando todos os patches necessários</title>
   <para>
    Para instalar todos os patches lançados oficialmente que se aplicam ao seu sistema, execute:
   </para>
<screen><prompt>tux &gt; </prompt>sudo zypper patch</screen>
   <para>
    Todos os patches disponíveis dos repositórios configurados em seu computador são verificados quanto à relevância em sua instalação. Se eles forem relevantes (e não classificados como <literal>opcional</literal> ou <literal>recurso</literal>), eles serão instalados imediatamente. <phrase os="sles;sled">Observe que o repositório de atualização oficial apenas estará disponível após o registro de sua instalação do <phrase role="productname"><phrase os="sled">SUSE Linux Enterprise Desktop</phrase></phrase>.</phrase>
   </para>
   <para>
    Se um patch que estiver prestes a ser instalado incluir mudanças que exijam reinicialização do sistema, você será avisado antes.
   </para>

   <para>
    Para instalar também os patches opcionais, use:
   </para>
<screen><prompt>tux &gt; </prompt>sudo zypper patch --with-optional</screen>
   <remark>
    The structure here is a bit unfortunate: We explain how to use the
    --cve/--bugzilla options in more detail below ("Listing Patches").
    However, the first bit people get is the very brief intro immediately below.
    Not sure whether to replicate all the information from "Listing Patches"
    here.
    - sknorr, 2016-04-25
   </remark>
   <para>
    Para instalar todos os patches referentes a um problema específico do Bugzilla, use:
   </para>
<screen><prompt>tux &gt; </prompt>sudo zypper patch --bugzilla=<replaceable>number</replaceable></screen>
   <para>
    Para instalar todos os patches referentes a uma entrada específica do banco de dados CVE, use:
   </para>
<screen><prompt>tux &gt; </prompt>sudo zypper patch --cve=<replaceable>number</replaceable></screen>
   <para>
    Por exemplo, para instalar um patch de segurança com o número do CVE <literal>CVE-2010-2713</literal>, execute:
   </para>
<screen><prompt>tux &gt; </prompt>sudo zypper patch --cve=CVE-2010-2713</screen>
   <para>
    Para instalar apenas os patches que afetam o Zypper e o gerenciamento de pacote propriamente dito, use:
   </para>
<screen><prompt>tux &gt; </prompt>sudo zypper patch --updatestack-only</screen>
  </sect3>
  <sect3 xml:id="sec.zypper.softup.listpatch">
   <title>Listando os patches</title>
   <para>
    Para saber se há patches disponíveis, o Zypper permite ver as seguintes informações:
   </para>
   <variablelist>
    <varlistentry>
     <term>Número de Patches Necessários</term>
     <listitem>
      <para>
       Para listar o número de patches necessários (patches que se aplicam ao seu sistema, mas ainda não foram instalados), use <command>patch-check</command>:
      </para>
<screen><prompt>tux &gt; </prompt>zypper patch-check
Loading repository data...
Reading installed packages...
5 patches needed (1 security patch)</screen>
      <para>
       Esse comando pode ser combinado com a opção <option>--updatestack-only</option> para listar apenas os patches que afetam o Zypper e o gerenciamento de pacote propriamente dito.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>Lista de Patches Necessários</term>
     <listitem>
      <para>
       Para listar todos os patches necessários (patches que se aplicam ao seu sistema, mas ainda não foram instalados), use <command>list-patches</command>:
      </para>
<screen><?dbsuse-fo font-size="0.70em"?>

<prompt>tux &gt; </prompt>zypper list-patches
Loading repository data...
Reading installed packages...

Repository     | Name        | Version | Category | Status  | Summary
---------------+-------------+---------+----------+---------+---------
SLES12-Updates | SUSE-2014-8 | 1       | security | needed  | openssl: Update for OpenSSL
</screen>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>Lista de Todos os Patches</term>
     <listitem>
      <para>
       Para listar todos os patches disponíveis para o <phrase role="productname"><phrase os="sled">SUSE Linux Enterprise Desktop</phrase></phrase>, independentemente de já estarem instalados ou de se aplicarem à sua instalação, use <command>zypper patches</command>.
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
   <para>
    Também é possível listar e instalar todos os patches relevantes a problemas específicos. Para listar patches específicos, use o comando <command>zypper list-patches</command> com as seguintes opções:
   </para>
   <variablelist>
    <varlistentry>
     <term>Por Problemas do Bugzilla</term>
     <listitem>
      <para>
       Para listar todos os patches necessários relacionados a problemas do Bugzilla, use a opção <option>--bugzilla</option>.
      </para>
      <para>
       Para listar os patches referentes a um bug específico, você também pode informar o número do bug: <option>--bugzilla=<replaceable>número</replaceable></option>. Para pesquisar patches relacionados a vários problemas do Bugzilla, adicione vírgulas entre os números de bug, por exemplo:
      </para>
<screen><prompt>tux &gt; </prompt>zypper list-patches --bugzilla=972197,956917</screen>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>Por Número do CVE</term>
     <listitem>
      <para>
       Para listar todos os patches necessários relacionados a uma entrada no banco de dados CVE (Common Vulnerabilities and Exposures – Exposições e Vulnerabilidades Comuns), use a opção <option>--cve</option>.
      </para>
      <para>
       Para listar os patches de uma entrada específica do banco de dados CVE, você também pode informar o número do CVE: <option>--cve=<replaceable>número</replaceable></option>. Para pesquisar patches relacionados a várias entradas do banco de dados CVE, adicione vírgulas entre os números do CVE, por exemplo:
      </para>
<screen><prompt>tux &gt; </prompt>zypper list-patches --bugzilla=CVE-2016-2315,CVE-2016-2324</screen>
     </listitem>
    </varlistentry>
   </variablelist>
   <para>
    Para listar todos os patches, independentemente de serem necessários, use também a opção <option>--all</option>. Por exemplo, para listar todos os patches com um número do CVE atribuído, use:
   </para>
<screen><?dbsuse-fo font-size="0.70em"?>

<prompt>tux &gt; </prompt>zypper list-patches --all --cve
Issue | No.           | Patch             | Category    | Severity  | Status
------+---------------+-------------------+-------------+-----------+----------
cve   | CVE-2015-0287 | SUSE-SLE-Module.. | recommended | moderate  | needed
cve   | CVE-2014-3566 | SUSE-SLE-SERVER.. | recommended | moderate  | not needed
[...]</screen>
  </sect3>
  <sect3 xml:id="sec.zypper.softup.update">
   <title>Instalando novas versões de pacotes</title>
   <para>
    Se um repositório contém apenas pacotes novos, mas não fornece patches, <command>zypper patch</command> não surte nenhum efeito. Para atualizar todos os pacotes instalados com as versões mais recentes disponíveis (sem afetar a integridade do sistema), use:
   </para>
<screen><prompt>tux &gt; </prompt>sudo zypper update</screen>
   <para>
    Para atualizar pacotes individuais, especifique o pacote com o comando update ou install:
   </para>
<screen><prompt>tux &gt; </prompt>sudo zypper update <replaceable>package_name</replaceable>
<prompt>tux &gt; </prompt>sudo zypper install <replaceable>package_name</replaceable></screen>
   <para>
    Uma lista de todos os novos pacotes instaláveis pode ser obtida pelo comando:
   </para>
<screen><prompt>tux &gt; </prompt>zypper list-updates</screen>
   <para>
    Observe que este comando apenas lista os pacotes correspondentes aos seguintes critérios:
   </para>
   <itemizedlist>
    <listitem>
     <para>
      têm os mesmo fornecedor que o pacote já instalado,
     </para>
    </listitem>
    <listitem>
     <para>
      são fornecidos por repositórios com pelo menos a mesma prioridade que o pacote já instalado,
     </para>
    </listitem>
    <listitem>
     <para>
      são instaláveis (todas as dependências foram atendidas).
     </para>
    </listitem>
   </itemizedlist>
   <para>
    Uma lista de <emphasis>todos</emphasis> os novos pacotes disponíveis (sejam instaláveis ou não) pode ser obtida com:
   </para>
<screen><prompt>tux &gt; </prompt>sudo zypper list-updates --all</screen>
   <para>
    Para descobrir o motivo pelo qual um novo pacote não pode ser instalado, use o comando <command>zypper install</command> ou <command>zypper update</command> conforme descrito acima.
   </para>
  </sect3>
  <sect3 xml:id="sec.zypper.softup.orphaned">
   <title>Identificando pacotes órfãos</title>
   <para>
    Sempre que você remove um repositório do Zypper ou faz upgrade do sistema, alguns pacotes podem entrar no estado <quote>órfão</quote>. Esses pacotes <emphasis>órfãos</emphasis> não pertencem mais a nenhum repositório ativo. O comando a seguir fornece uma lista deles:
   </para>
<screen><prompt>tux &gt; </prompt>sudo zypper packages --orphaned</screen>
   <para>
    Com essa lista, você pode decidir se um pacote ainda é necessário ou pode ser removido com segurança.
   </para>
  </sect3>

 </sect2>

 <sect2 xml:id="sec.zypper.ps">
  <title>Identificando processos e serviços que usam arquivos apagados</title>
  <para>
   Durante a aplicação de patches, atualização ou remoção de pacotes, pode haver processos em execução no sistema que continuam usando os arquivos que foram apagados pela atualização ou remoção. Use o <command>zypper ps</command> para listar os processos que usam arquivos apagados. Se o processo pertence a um serviço conhecido, o nome do serviço é listado para facilitar sua reinicialização. Por padrão, o <command>zypper ps</command> mostra uma tabela:
  </para>
<screen>PID   | PPID | UID | User  | Command      | Service      | Files
------+------+-----+-------+--------------+--------------+-------------------
814   | 1    | 481 | avahi | avahi-daemon | avahi-daemon | /lib64/ld-2.19.s-&gt;
      |      |     |       |              |              | /lib64/libdl-2.1-&gt;
      |      |     |       |              |              | /lib64/libpthrea-&gt;
      |      |     |       |              |              | /lib64/libc-2.19-&gt;
[...]</screen>
  <simplelist>
   <member><emphasis role="bold">PID</emphasis>: ID do processo </member> <member><emphasis role="bold">PPID</emphasis>: ID do processo pai </member> <member><emphasis role="bold">UID</emphasis>: ID do usuário que executa o processo </member> <member><emphasis role="bold">Login</emphasis>: Nome de login do usuário que executa o processo </member> <member><emphasis role="bold">Comando</emphasis>: Comando usado para executar o processo </member> <member><emphasis role="bold">Serviço</emphasis>: Nome do serviço (apenas se o comando estiver associado a um serviço do sistema) </member> <member><emphasis role="bold">Arquivos</emphasis>: A lista de arquivos apagados </member>
  </simplelist>
  <para>
   O formato de saída do <command>zypper ps</command> pode ser controlado da seguinte maneira:
  </para>
  <variablelist>
   <varlistentry>
    <term><command>zypper ps</command><option>-s</option>
    </term>
    <listitem>
     <para>
      Criar uma tabela resumida sem mostrar os arquivos apagados.
     </para>
<screen>PID   | PPID | UID  | User    | Command      | Service
------+------+------+---------+--------------+--------------
814   | 1    | 481  | avahi   | avahi-daemon | avahi-daemon
817   | 1    | 0    | root    | irqbalance   | irqbalance
1567  | 1    | 0    | root    | sshd         | sshd
1761  | 1    | 0    | root    | master       | postfix
1764  | 1761 | 51   | postfix | pickup       | postfix
1765  | 1761 | 51   | postfix | qmgr         | postfix
2031  | 2027 | 1000 | tux     | bash         |</screen>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><command>zypper ps</command><option>-ss</option>
    </term>
    <listitem>
     <para>
      Mostrar apenas os processos associados a um serviço do sistema.
     </para>
<screen>PID   | PPID | UID  | User    | Command      | Service
------+------+------+---------+--------------+--------------
814   | 1    | 481  | avahi   | avahi-daemon | avahi-daemon
817   | 1    | 0    | root    | irqbalance   | irqbalance
1567  | 1    | 0    | root    | sshd         | sshd
1761  | 1    | 0    | root    | master       | postfix
1764  | 1761 | 51   | postfix | pickup       | postfix
1765  | 1761 | 51   | postfix | qmgr         | postfix</screen>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><command>zypper ps</command><option>-sss</option>
    </term>
    <listitem>
     <para>
      Mostrar apenas os serviços do sistema que usam os arquivos apagados.
     </para>
<screen>avahi-daemon
irqbalance
postfix
sshd</screen>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><command>zypper ps</command><option>--print "systemctl status %s"</option>
    </term>
    <listitem>
     <para>
      Mostrar os comandos para recuperar informações de status dos serviços que possam precisar de reinicialização.
     </para>
<screen>systemctl status avahi-daemon
systemctl status irqbalance
systemctl status postfix
systemctl status sshd</screen>
    </listitem>
   </varlistentry>
  </variablelist>
  <para>
   Para obter mais informações sobre o gerenciamento de serviços, consulte o <xref linkend="cha.systemd"/>.
  </para>
 </sect2>





 <sect2 xml:id="sec.zypper.instrepo">
  <title>Gerenciando repositórios com o zypper</title>
  <para>
   Todos os comandos de instalação ou patch do zipper dependem de uma lista de repositórios conhecidos. Para listar todos os repositórios conhecidos para o sistema, use o comando:
  </para>
<screen><prompt>tux &gt; </prompt>zypper repos</screen>
  <para>
   O resultado parecerá com o seguinte:
  </para>
  <example xml:id="ex.zypper.repos">
   <title>Zypper: lista de repositórios conhecidos</title>
<screen><?dbsuse-fo font-size="0.60em"
?>


# | Alias        | Name          | Enabled | Refresh
--+--------------+---------------+---------+--------
1 | SLEHA-12-GEO | SLEHA-12-GEO  | Yes     | No
2 | SLEHA-12     | SLEHA-12      | Yes     | No
3 | SLES12       | SLES12        | Yes     | No
  </screen>
  </example>
  <para>
   Na especificação de repositórios em vários comandos, é possível usar um álias, URI ou número de repositório a partir da saída do comando <command>zypper repos</command>. O álias do repositório é uma versão abreviada do nome do repositório para uso em comandos de gerenciamento de repositórios. Observe que os números dos repositórios podem ser mudados após modificar a lista de repositórios. O álias nunca mudará sozinho.
  </para>
  <para>
   Por padrão; detalhes, como o URI ou a prioridade do repositório, não são exibidos. Use o seguinte comando para listar todos os detalhes:
  </para>
<screen><prompt>tux &gt; </prompt>zypper repos -d</screen>
  <sect3 xml:id="sec.zypper.instrepo.add">
   <title>Adicionando repositórios</title>
   <para>
    Para adicionar um repositório, execute
   </para>
<screen><prompt>tux &gt; </prompt>sudo zypper addrepo <replaceable>URI</replaceable> <replaceable>alias</replaceable></screen>
   <para>
    O <replaceable>URI</replaceable> pode ser um repositório da Internet, um recurso de rede, um diretório ou um CD ou DVD (consulte <link xlink:href="http://en.opensuse.org/openSUSE:Libzypp_URIs"/> para obter os detalhes). O <replaceable>álias</replaceable> é um identificador abreviado e exclusivo do repositório. Você tem livre escolha, com a única condição de que seja exclusivo. O zypper emitirá um aviso se você especificar um álias que já está em uso.
   </para>
  </sect3>
  <sect3 xml:id="sec.zypper.instrepo.rm">
   <title>Removendo repositórios</title>
   <para>
    Se você deseja remover um repositório da lista, use o comando <command>zypper removerepo</command> junto com o álias ou o número do repositório que você deseja apagar. Por exemplo, para remover o repositório <literal>SLEHA-12-GEO</literal> do <xref linkend="ex.zypper.repos"/>, use um dos seguintes comandos:
   </para>
<screen><prompt>tux &gt; </prompt>sudo zypper removerepo 1
<prompt>tux &gt; </prompt>sudo zypper removerepo "SLEHA-12-GEO"</screen>
  </sect3>
  <sect3 xml:id="sec.zypper.instrepo.mofify">
   <title>Modificando repositórios</title>
   <para>
    Habilite ou desabilite os repositórios com <command>zypper modifyrepo</command>. Você também pode alterar as propriedades do repositório (por exemplo, atualizar o comportamento, o nome ou a prioridade) com esse comando. O comando a seguir habilita o repositório chamado <literal>updates</literal>, ativa a atualização automática e define sua prioridade como 20:
   </para>
<screen><prompt>tux &gt; </prompt>sudo zypper modifyrepo -er -p 20 'updates'</screen>
   <para>
    A modificação de repositórios não se limita a um único repositório, você também pode operar em grupos:
   </para>
   <simplelist>
    <member><option>-a</option>: todos os repositórios</member> <member><option>-l</option>: repositórios locais</member> <member><option>-t</option>: repositórios remotos</member> <member><option>-m <replaceable>TIPO</replaceable></option>: repositórios de um tipo específico (em que <replaceable>TIPO</replaceable> pode ser um dos seguintes: <literal>http</literal>, <literal>https</literal>, <literal>ftp</literal>, <literal>cd</literal>, <literal>dvd</literal>, <literal>dir</literal>, <literal>file</literal>, <literal>cifs</literal>, <literal>smb</literal>, <literal>nfs</literal>, <literal>hd</literal>, <literal>iso</literal>) </member>
   </simplelist>
   <para>
    Para renomear o álias de um repositório, use o comando <literal>renamerepo</literal>. O exemplo a seguir muda o álias de <literal>Mozilla Firefox</literal> para <literal>firefox</literal>:
   </para>
<screen><prompt>tux &gt; </prompt>sudo zypper renamerepo 'Mozilla Firefox' firefox</screen>
  </sect3>
 </sect2>

 <sect2 xml:id="sec.zypper.query">
  <title>Consultando repositórios e pacotes com o zypper</title>
  <para>
   O zypper oferece vários métodos de consulta a repositórios ou pacotes. Para obter as listas de todos os produtos, padrões, pacotes ou patches disponíveis, use os seguintes comandos:
  </para>
<screen><prompt>tux &gt; </prompt>zypper products
<prompt>tux &gt; </prompt>zypper patterns
<prompt>tux &gt; </prompt>zypper packages
<prompt>tux &gt; </prompt>zypper patches</screen>
  <para>
   Para consultar todos os repositórios para determinados pacotes, use <literal>search</literal>. Ela funciona em nomes de pacotes ou, opcionalmente, em resumos e descrições de pacotes. Uma string entre <literal>/</literal> é interpretada como expressão regular. Por padrão, a pesquisa não diferencia maiúsculas de minúsculas.
  </para>
  <variablelist>
   <varlistentry>
    <term>Pesquisa simples de nome de pacote que inclua <literal>fire</literal>
    </term>
    <listitem>
<screen><prompt>tux &gt; </prompt>zypper search "fire"</screen>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Pesquisa simples do pacote exato <literal>MozillaFirefox</literal>
    </term>
    <listitem>
<screen><prompt>tux &gt; </prompt>zypper search --match-exact "MozillaFirefox"</screen>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Pesquisar também em descrições e resumos de pacotes</term>
    <listitem>
<screen><prompt>tux &gt; </prompt>zypper search -d fire</screen>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Exibir apenas pacotes ainda não instalados</term>
    <listitem>
<screen><prompt>tux &gt; </prompt>zypper search -u fire</screen>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Exibir pacotes que tenham a string <literal>fir</literal>, não seguida por <literal>e</literal>
    </term>
    <listitem>
<screen><prompt>tux &gt; </prompt>zypper se "/fir[^e]/"</screen>
    </listitem>
   </varlistentry>
  </variablelist>
  <para>
   Para procurar pacotes que oferecem um recurso específico, use o comando <literal>what-provides</literal>. Por exemplo, para saber qual pacote inclui o módulo Perl <literal>SVN::Core</literal>, use o seguinte comando:
  </para>
<screen><prompt>tux &gt; </prompt>zypper what-provides 'perl(SVN::Core)'</screen>
  <para>
   Para consultar pacotes únicos, use <command>info</command> com um nome exato de pacote como argumento. Ele exibe informações detalhadas sobre um pacote. Para mostrar também o que é exigido/recomendado pelo pacote, use as opções <option>--requires</option> e <option>--recommends</option>:
  </para>
<screen><prompt>tux &gt; </prompt>zypper info --requires MozillaFirefox</screen>
  <para>
   O <literal>what-provides <replaceable>pacote</replaceable></literal> é semelhante ao <command>rpm -q --whatprovides</command> <replaceable>pacote</replaceable>, mas o RPM só pode consultar o banco de dados RPM (que é o banco de dados de todos os pacotes instalados). O zypper, por outro lado, o informará sobre fornecedores do recurso a partir de qualquer repositório, não apenas aqueles que estão instalados.
  </para>
 </sect2>

 <sect2 xml:id="sec.zypper.configure">
  <title>Configurando o Zypper</title>
  <para>
   O Zypper agora vem com um arquivo de configuração que permite mudar permanentemente o comportamento do Zypper (de todo o sistema ou de um usuário específico). Para mudanças de todo o sistema, edite <filename>/etc/zypp/zypper.conf</filename>. Para mudanças específicas do usuário, edite <filename>~/.zypper.conf</filename>. Se <filename>~/.zypper.conf</filename> ainda não existir, você poderá usar <filename>/etc/zypp/zypper.conf</filename> como gabarito: copie-o para <filename>~/.zypper.conf</filename> e ajuste-o como desejar. Consulte os comentários no arquivo para obter ajuda sobre as opções disponíveis.
  </para>
 </sect2>

 <sect2 xml:id="sec.zypper.trouble">
  <title>Solucionando problemas</title>
  <para>
   Caso tenha problemas para acessar os pacotes dos repositórios configurados (por exemplo, o Zypper não encontra determinado pacote apesar de você saber que ele existe em um dos repositórios), poderá ajudar se você atualizar os repositórios com:
  </para>
<screen><prompt>tux &gt; </prompt>sudo zypper refresh</screen>
  <para>
   Se isso não ajudar, tente
  </para>
<screen><prompt>tux &gt; </prompt>sudo zypper refresh -fdb</screen>
  <para>
   Isso força uma atualização completa e a reconstrução do banco de dados, incluindo um download forçado dos metadados iniciais.
  </para>
 </sect2>

 <sect2 xml:id="sec.zypper.rollback">
  <title>Recurso de rollback do Zypper no sistema de arquivos Btrfs</title>
  <para>
   Se o sistema de arquivos Btrfs for usado na partição raiz e o <command>snapper</command> estiver instalado, o Zypper chamará automaticamente o <command>snapper</command> (usando o script instalado pelo <command>snapper</command>) ao confirmar as mudanças no sistema de arquivos para criar os instantâneos apropriados do sistema de arquivos. É possível usar esses instantâneos para reverter as mudanças feitas pelo Zypper. Consulte o <xref linkend="cha.snapper"/> para obter mais informações.
  </para>
 </sect2>

 <sect2 xml:id="sec.zypper.more">
  <title>Para obter mais informações</title>
  <para>
   Para obter mais informações sobre gerenciamento de software da linha de comando, digite <command>zypper help</command>, <command>zypper help </command> <replaceable>comando</replaceable> ou consulte a página de manual do <command>zypper(8)</command>. Para obter uma referência completa e detalhada dos comandos, incluindo <literal>folhetos de dicas</literal> com os comandos mais importantes, e informações sobre como usar o Zypper em scripts e aplicativos, consulte <link xlink:href="http://en.opensuse.org/SDB:Zypper_usage"/>. Você encontra uma lista das mudanças de software da versão mais recente do <phrase role="productname"><phrase os="sled">SUSE Linux Enterprise Desktop</phrase></phrase> em <link xlink:href="http://en.opensuse.org/openSUSE:Zypper versions"/>.
  </para>
 </sect2>
</sect1>
