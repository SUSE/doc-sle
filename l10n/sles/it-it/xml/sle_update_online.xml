<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="sle_update_online.xml" version="5.0" xml:id="cha-upgrade-online">
 <title os="sles;sled">Upgrade online</title>
 
 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:bugtracker/>
   <dm:translation>yes</dm:translation>
  </dm:docmanager>
  <abstract>
   <para os="sles;sled">
    SUSE offre uno strumento grafico intuitivo e uno strumento da riga di comando semplice per eseguire l&apos;upgrade di un sistema in esecuzione al nuovo Service Pack. Entrambi questi strumenti forniscono il supporto necessario per il <quote>rollback</quote> dei Service Pack e altro. In questo capitolo sono fornite istruzioni passo passo su come eseguire un upgrade di un Service Pack utilizzando questi strumenti.
   </para>

   
  </abstract>
 </info>
 <sect1 xml:id="sec-upgrade-online-conceptual-overview">
  <title>Panoramica concettuale</title>

  <para os="sles;sled">
   SUSE rilascia Service Pack per la famiglia SUSE Linux Enterprise a intervalli regolari. Per semplificare la migrazione a un nuovo Service Pack da parte dei clienti e ridurre al minimo il tempo di inattività, SUSE supporta la migrazione online mentre il sistema è in esecuzione.
  </para>

  

  <para os="sles;sled">
   A partire da SLE 12 , YaST Wagon è stato sostituito dalla migrazione di YaST (tramite GUI) e dalla migrazione di Zypper (dalla riga di comando). Ciò comporta i vantaggi seguenti:
  </para>

  

  

  <itemizedlist>
   <listitem>
    <para>
     Il sistema è in uno stato definito fino all&apos;aggiornamento del primo RPM.
    </para>
   </listitem>
   <listitem>
    <para>
     L&apos;annullamento è possibile fino all&apos;aggiornamento del primo RPM.
    </para>
   </listitem>
   <listitem>
    <para>
     In caso di errore il recupero è semplice.
    </para>
   </listitem>
   <listitem>
    <para>
     È possibile eseguire un <quote>rollback</quote> tramite gli strumenti di sistema (backup o ripristino non necessari).
    </para>
   </listitem>
   <listitem>
    <para>
     Vengono utilizzati tutti gli archivi attivi.
    </para>
   </listitem>
   <listitem os="sles;sled">
    <para>
     È possibile ignorare un Service Pack.
    </para>
   </listitem>
  </itemizedlist>

  <warning os="sles;sled">
   <title>migrazione online non supportata per le release principali</title>
   <para>
    La migrazione online è supportata <emphasis>solo</emphasis> per eseguire la migrazione tra Service Pack. La migrazione online <emphasis>non è supportata</emphasis> per eseguire l&apos;upgrade alle nuove versioni principali. Per informazioni, vedere <xref linkend="cha-upgrade-paths"/>.
   </para>
   <para>
    Utilizzare la migrazione offline per eseguire l&apos;upgrade a una nuova release principale. Per informazioni, vedere <xref linkend="cha-upgrade-offline"/>.
   </para>
  </warning>

  <important os="sles;sled">
   <title>upgrade dei client SUSE Manager</title>
   <para>
    Se il sistema da sottoporre ad upgrade è un client SUSE Manager, è impossibile eseguire l&apos;upgrade tramite la migrazione online YaST o <command>zypper migration</command>. Seguire invece la procedura per la <citetitle>migrazione del client</citetitle>. Tale procedura è descritta in <link xlink:href="https://documentation.suse.com/suma/">
    <citetitle>SUSE Manager Upgrade Guide</citetitle></link> (Guida all&apos;upgrade di SUSE Manager).
   </para>
  </important>
 </sect1>
 <sect1 os="sles;sled" xml:id="sec-upgrade-online-workflow">
  <title>Flusso di lavoro di migrazione del Service Pack</title>

  <para>
   Per eseguire la migrazione di un Service Pack è possibile utilizzare YaST, <command>zypper</command> o AutoYaST.
  </para>

  <para>
   Prima di iniziare la migrazione di un Service Pack è necessario registrare il sistema in SUSE Customer Center o in un server RMT locale. È possibile utilizzare anche SUSE Manager.
  </para>

  <para>
   Indipendentemente dal metodo, una migrazione del Service Pack consiste nei seguenti passaggi:
  </para>

  <orderedlist>
   <listitem>
    <para>
     Trovare le possibili destinazioni di migrazione nei sistemi registrati.
    </para>
   </listitem>
   <listitem>
    <para>
     Selezionare una destinazione di migrazione.
    </para>
   </listitem>
   <listitem>
    <para>
     Richiedere e abilitare nuovi archivi.
    </para>
   </listitem>
   <listitem>
    <para>
     Eseguire la migrazione.
    </para>
   </listitem>
  </orderedlist>

  <para>
   L&apos;elenco delle destinazioni di migrazione dipende dai prodotti installati e registrati. Se è installata un&apos;estensione per cui non è ancora disponibile il nuovo Service Pack, è possibile che non venga resa disponibile alcuna destinazione.
  </para>

  <para>
   L&apos;elenco delle destinazioni di migrazione disponibili per l&apos;host in uso viene sempre recuperato da SUSE Customer Center e dipende dalle estensioni o dai prodotti installati.
  </para>
 </sect1>
 
 <sect1 os="sles;sled" xml:id="sec-upgrade-online-cancel">
  <title>Annullamento della migrazione di un Service Pack</title>

  <para>
   La migrazione di un Service Pack può essere annullata solo in alcune fasi specifiche del processo di migrazione:
  </para>

  <orderedlist>
   <listitem>
    <para>
     Finché non ha inizio l&apos;upgrade del pacchetto, al sistema vengono apportate solo alcune modifiche minime, ad esempio a servizi e archivi. Ripristinare <filename>/etc/zypp/repos.d/*</filename> per tornare allo stato precedente.
    </para>
   </listitem>
   <listitem>
    <para>
     Per tornare allo stato precedente dopo l&apos;avvio dell&apos;upgrade del pacchetto, è possibile utilizzare un&apos;istantanea di Snapper (vedere il <xref linkend="cha-snapper"/>).
    </para>
   </listitem>
   <listitem>
    <para>
     Dopo la selezione della destinazione di migrazione, SUSE Customer Center modifica i dati dell&apos;archivio. Per tornare manualmente allo stato precedente, utilizzare <command>SUSEConnect</command>
     <option> --rollback</option>.
    </para>
   </listitem>
  </orderedlist>
 </sect1>
 
 <sect1 os="sles;sled" xml:id="sec-upgrade-online-yast">
  <title>Upgrade con lo strumento di migrazione online (YaST)</title>

  <para>
   Per eseguire la migrazione di un Service Pack con YaST, utilizzare lo strumento <guimenu>Migrazione online</guimenu>. Per default, YaST non installa i pacchetti da un archivio di terze parti. Se un pacchetto è stato installato da un archivio di terze parti, YaST impedisce che il pacchetto venga sostituito con lo stesso pacchetto proveniente da SUSE.
  </para>

  <note>
   <title>ridurre la dimensione dell&apos;installazione</title>
   <para>
    Quando si esegue la migrazione di un Service Pack, YaST installa tutti i pacchetti consigliati. Soprattutto nel caso di un&apos;installazione minima personalizzata, questo può aumentare notevolmente la dimensione dell&apos;installazione del sistema.
   </para>
   <para>
    Per modificare questo comportamento di default e consentire solo i pacchetti necessari, regolare l&apos;opzione <option>solver.onlyRequires</option> in <filename>/etc/zypp/zypp.conf</filename>.
   </para>
<screen>solver.onlyRequires = true</screen>
   <para>
    Modificare inoltre il file <filename>/etc/zypp/zypper.conf</filename> e l&apos;opzione <option>installRecommends</option>.
   </para>
   <screen>installRecommends=false</screen>
   <para>
    Questo modifica il comportamento di tutte le operazioni sui pacchetti, come l&apos;installazione di patch o nuovi pacchetti. Per modificare il comportamento di Zypper per una singola chiamata, utilizzare il parametro <option>--no-recommends</option>.
  </para>
</note>

  <para>
   Per avviare la migrazione di un Service Pack, procedere come segue:
  </para>

  <procedure xml:id="pro-upgrade-online-yast">
   <step>
    <para>
     Disattivare tutte le estensioni inutilizzate sul server di registrazione per evitare futuri conflitti di dipendenza futuri. Nel caso in cui ci si dimenticasse un&apos;estensione, in un momento successivo YaST rileverà i repository delle estensioni inutilizzate e li disattiverà.
    </para>
   </step>
   <step>
    <para>
     Se si è eseguito il login a una sessione GNOME in esecuzione su un computer che verrà sottoposto ad aggiornamento, passare a una console di testo. L&apos;esecuzione dell&apos;aggiornamento da una sessione GNOME non è consigliata. Tenere presente che ciò non si applica quando si esegue il login da un computer remoto (a meno che non sia in esecuzione una sessione VNC con GNOME).
    </para>
   </step>
   
   <step>
    <para>
     Eseguire l&apos;aggiornamento online tramite YaST per recuperare gli ultimi aggiornamenti dei pacchetti per il sistema in uso.
    </para>
   </step>
   <step>
    <para>
     Installare il pacchetto <package>yast2-migration</package> e le relative dipendenze (in YaST in <menuchoice> <guimenu>Software</guimenu>
     <guimenu>Gestione software</guimenu> </menuchoice>).
    </para>
   </step>
   <step>
    <para>
     Riavviare YaST. In caso contrario il modulo appena installato non verrà mostrato nel centro di controllo.
    </para>
   </step>
   <step>
    <para>
     In YaST, scegliere <guimenu>Migrazione online</guimenu> (a seconda della versione di <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> dalla quale si sta eseguendo l&apos;upgrade, questo modulo viene classificato come <guimenu>Sistema</guimenu> o <guimenu>Software</guimenu>). YaST mostrerà le destinazioni di migrazione possibili e un riepilogo. Se per il sistema in uso sono disponibili più destinazioni di migrazione, selezionarne una dall&apos;elenco.
    </para>
   </step>
   <step>
    <para>
     Selezionare una destinazione di migrazione dall&apos;elenco e fare clic su <guimenu>Avanti</guimenu> per continuare.
    </para>
   </step>
   <step>
    <para>
     Se lo strumento di migrazione offre archivi di aggiornamento, è consigliabile selezionare <guimenu>Sì</guimenu> per procedere.
    </para>
   </step>
   <step>
    <para>
     <remark>toms 2015-09-09: FATE#319140</remark>
     Se lo strumento di migrazione online rileva archivi obsoleti provenienti da DVD o da un server locale, è consigliabile disabilitarli. Gli archivi obsoleti provengono da un Service Pack precedente. Gli archivi precedenti di SUSE Customer Center o RMT vengono rimossi automaticamente.
    </para>
   </step>
   <step>
    <para>
     Controllare il riepilogo e continuare con la migrazione facendo clic su <guimenu>Avanti</guimenu>. Confermare con <guimenu>Avvia aggiornamento</guimenu>.
    </para>
    <remark>toms 2016-07-13: What to do in case of problems?</remark>
   </step>
   <step>
    <para>
     Al termine della migrazione, riavviare il sistema.
    </para>
   </step>
  </procedure>
 </sect1>
 <sect1 os="sles;sled" xml:id="sec-upgrade-online-zypper">
  <title>Upgrade con Zypper</title>

  <para>
   Per eseguire la migrazione di un Service Pack con Zypper, utilizzare lo strumento a riga di comando <command>zypper</command> <option>migration</option> dal pacchetto <package>zypper-migration-plugin</package>.
  </para>

  <note>
   <title>ridurre la dimensione dell&apos;installazione</title>
   <para>
    Quando si esegue la migrazione di un Service Pack, YaST installa tutti i pacchetti consigliati. Soprattutto nel caso di un&apos;installazione minima personalizzata, questo può aumentare notevolmente la dimensione dell&apos;installazione del sistema.
   </para>
   <para>
    Per modificare questo comportamento di default e consentire solo i pacchetti necessari, regolare l&apos;opzione <option>solver.onlyRequires</option> in <filename>/etc/zypp/zypp.conf</filename>.
   </para>
<screen>solver.onlyRequires = true</screen>
   <para>
    Modificare inoltre il file <filename>/etc/zypp/zypper.conf</filename> e l&apos;opzione <option>installRecommends</option>.
   </para>
   <screen>installRecommends=false</screen>
   <para>
    Questo modifica il comportamento di tutte le operazioni sui pacchetti, come l&apos;installazione di patch o nuovi pacchetti. Per modificare il comportamento di Zypper per una singola chiamata, utilizzare il parametro <option>--no-recommends</option>.
  </para>
</note>

  <para>
   Per avviare la migrazione di un Service Pack, procedere come segue:
  </para>

  <procedure xml:id="pro-upgrade-online-zypper">
   <step>
    <para>
     Se si è eseguito il login a una sessione GNOME in esecuzione su un computer che verrà sottoposto ad aggiornamento, passare a una console di testo. L&apos;esecuzione dell&apos;aggiornamento da una sessione GNOME non è consigliata. Tenere presente che ciò non si applica quando si esegue il login da un computer remoto (a meno che non sia in esecuzione una sessione VNC con GNOME).
    </para>
   </step>
   <step>
    <para>
     Se non è ancora stato fatto, registrare il computer SUSE Linux Enterprise in uso:
    </para>
<screen><prompt>&gt; </prompt><command>sudo</command> <command>SUSEConnect</command> --regcode <replaceable>YOUR_REGISTRATION_CODE</replaceable></screen>
   </step>
   
   <step>
    <para>
     Avviare la migrazione:
    </para>
<screen><prompt>&gt; </prompt><command>sudo</command> <command>zypper migration</command></screen>
    <para>
     Note sul processo di migrazione:
    </para>
    <itemizedlist>
     <listitem>
      <para>
       Se per il sistema in uso sono disponibili più destinazioni di migrazione, Zypper consente di selezionarne una dall&apos;elenco. È come ignorare uno o più Service Pack. Ricordare che la migrazione online per i prodotti base (SLES, SLED) rimane disponibile solo tra i Service Pack di una versione principale.
      </para>
     </listitem>
     <listitem>
      <para>
       Per default, Zypper usa l&apos;opzione <option>--no-allow-vendor-change</option>, che viene passata a <command>zypper</command> <option>dup</option>. Se un pacchetto è stato installato da un archivio di terze parti, questa opzione impedisce che il pacchetto venga sostituito con lo stesso pacchetto proveniente da SUSE.
      </para>
     </listitem>
     <listitem>
      <para>
       <remark>toms 2015-09-09: FATE#319140</remark>
        Se Zypper rileva archivi obsoleti provenienti da DVD o da un server locale, è consigliabile disabilitarli. Gli archivi precedenti di SUSE Customer Center o RMT vengono rimossi automaticamente.
      </para>
     </listitem>
    </itemizedlist>
   </step>
   <step>
    <para>
     Rivedere tutte le modifiche, soprattutto i pacchetti che verranno rimossi. Procedere digitando <literal>y</literal> (il numero esatto di pacchetti di cui eseguire l&apos;upgrade può variare in base al sistema):
    </para>
<screen>266 packages to upgrade, 54 to downgrade, 17 new, 8 to reinstall, 5 to remove, 1 to change arch.
Overall download size: 285.1 MiB. Already cached: 0 B  After the operation, additional 139.8 MiB will be used.
Continue? [y/n/? shows all options] (y):</screen>
    <para>
     Utilizzare i tasti <keycombo> <keycap function="shift"/> <keycap function="pageup"/>
     </keycombo>    o <keycombo> <keycap function="shift"/>
     <keycap function="pagedown"/> </keycombo>    per scorrere nella shell.
    </para>
   </step>
   <step>
    <para>
     Al termine della migrazione, riavviare il sistema.
    </para>
   </step>
  </procedure>
 </sect1>
 <sect1 os="sles;sled" xml:id="sec-upgrade-online-zypper-plain">
  <title>Upgrade con Zypper semplice</title>

  <para>
   Se il sistema non è registrato perché non si dispone dell&apos;accesso a Internet o a un server di registrazione, non è possibile eseguire la migrazione a un nuovo Service Pack con la migrazione YaST o <command>zypper migration</command>. In questo caso, è comunque possibile eseguire la migrazione a un nuovo Service Pack con Zypper semplice e alcune interazioni manuali.
  </para>

  <important>
   <title>solo per i sistemi non registrati</title>
   <para>
    Questo percorso di migrazione a un nuovo Service Pack è supportato <emphasis>soltanto</emphasis> per i sistemi non registrati che non dispongono dell&apos;accesso a Internet o a un server di registrazione. Questo potrebbe essere ad esempio il caso dei computer che si trovano in reti con protezione speciale. Se si dispone di un sistema registrato, utilizzare la migrazione YaST o Zypper.
   </para>
  </important>

  <important>
   <title>origini di installazione</title>
   <para>
    Questo percorso di migrazione richiede che il sistema di cui si sta eseguendo la migrazione disponga dell’accesso alle origini di installazione. A tal fine, è possibile ad esempio configurare un server RMT o SLP.
   </para>
   <para>
    È inoltre necessario che il sistema disponga dell&apos;accesso a un repository di aggiornamento aggiornato della versione del prodotto installata.
   </para>
  </important>

  <procedure>
   <step>
    <para>
     Se si è eseguito il login a una sessione grafica in esecuzione sul computer di cui verrà eseguita la migrazione, eseguire il logout dalla sessione e passare a una console di testo. L&apos;esecuzione dell&apos;aggiornamento da una sessione grafica non è consigliata. Tenere presente che ciò non si applica quando si esegue il login da un computer remoto (a meno che non sia in esecuzione una sessione VNC con X).
    </para>
   </step>
   <step>
    <para>
     Aggiornare gli strumenti di gestione dei pacchetti con gli archivi precedenti di SUSE Linux Enterprise:
    </para>
<screen><prompt>&gt; </prompt><command>sudo</command> <command>zypper</command> patch --updatestack-only</screen>
   </step>
   <step>
    <para>
     Ottenere un elenco dei pacchetti attualmente senza un repository loro assegnato (pacchetti orfani). Non verrà eseguita la migrazione di tali pacchetti e non è possibile garantirne il funzionamento in seguito alla migrazione (dal momento che gli altri pacchetti su cui si basano possono essere stati modificati e non essere quindi più compatibili). Per ottenere l&apos;elenco, eseguire:
    </para>
<screen><prompt>&gt; </prompt><command>sudo</command> zypper packages --orphaned</screen>
    <para>
     Esaminare con attenzione l&apos;elenco e rimuovere tutti i pacchetti orfani non più necessari. Prendere nota di tutti i pacchetti orfani rimanenti per poterne eseguire un confronto in un secondo momento.
    </para>
   </step>
   <step>
    <para>
     Ottenere un elenco di tutti i repository a cui il sistema è attualmente registrato eseguendo:
    </para>
<screen><prompt>&gt; </prompt><command>sudo</command> zypper repos -u</screen>
    <para>
     Aggiornare ogni URL di repository in modo che il numero di versione sia <literal>15-SP4</literal>. Se ad esempio l&apos;URL di un repository è
    </para>
<screen>http://rmt.example.com/repo/SUSE/Products/SLE-15-SP2-Product-SLES/x86_64/product/</screen>
    <para>
     modificarlo in
    </para>
<screen>http://rmt.example.com/repo/SUSE/Products/SLE-15-SP3-Product-SLES/x86_64/product/</screen>
    <para>
     Occorre procedere in questo modo per tutti i repository abilitati. È consigliabile eseguire questa operazione anche per i repository attualmente disabilitati per evitare che nel sistema siano presenti origini di installazione errate al momento della loro attivazione in futuro.
    </para>
    <para>
     Per modificare gli URL dei repository, è possibile scegliere tra le opzioni seguenti:
    </para>
    <substeps>
     <step>
      <para>
       Utilizzo di <menuchoice> <guimenu>YaST</guimenu> <guimenu>Programmi</guimenu>
       <guimenu>Repository dei programmi</guimenu></menuchoice>. Selezionare un repository e fare clic su <guimenu>Modifica</guimenu> per apportare la modifica necessaria. Ripetere questa operazione per tutti i repository.
      </para>
     </step>
     <step>
      <para>
       Utilizzo di Zypper. Rimuovere il repository precedente eseguendo
      </para>
<screen><prompt>&gt; </prompt><command>sudo</command> zypper removerepo <replaceable>OLD_REPO_ID</replaceable></screen>
      <para>
       Aggiungere quindi il nuovo repository corrispondente eseguendo
      </para>
<screen> <prompt>&gt; </prompt><command>sudo</command> zypper addrepo -f <replaceable>URL</replaceable> <replaceable>NAME</replaceable>-15-SP4</screen>
     </step>
     <step>
      <para>
       Modifica dei file di configurazione del repository in <filename>/etc/zypp/repos.d</filename>. Ogni repository è rappresentato da un file di configurazione. La modifica del valore del parametro <literal>baseurl</literal> è obbligatoria per ogni file.
      </para>
     </step>
    </substeps>
   </step>
   <step>
    <para>
     Rivedere le modifiche eseguendo <command>zypper repos -u</command> e aggiornare i repository eseguendo:
    </para>
<screen><prompt>&gt; </prompt><command>sudo</command> zypper refresh -f -s</screen>
    <para>
     Se l&apos;aggiornamento di un repository non riesce, accertarsi di aver immesso l&apos;URL corretto. Se non è possibile correggere il problema, si consiglia di disabilitare il repository con errori.
    </para>
    <para>
     Se tutti i repository sono stati configurati correttamente, eseguire nuovamente
    </para>
<screen><prompt>&gt; </prompt><command>sudo</command> zypper refresh -f -s</screen>
    <para>
     per assicurarsi che <emphasis>tutti</emphasis> i repository siano stati aggiornati.
    </para>
   </step>
   <step>
    <para>
     Prima di avviare la migrazione, si consiglia di eseguire un&apos;esecuzione di prova:
    </para>
<screen><prompt>&gt; </prompt><command>sudo</command> zypper dup -D --no-allow-vendor-change --no-recommends</screen>
    <para>
     Il parametro <option>-D</option> eseguirà un test in cui viene simulata la migrazione senza apportare alcuna modifica effettiva al sistema. Correggere eventuali problemi prima di continuare. Se l&apos;esecuzione di prova viene completata senza errori, eseguire la migrazione reale eseguendo:
    </para>
<screen><prompt>&gt; </prompt><command>sudo</command> zypper dup --no-allow-vendor-change --no-recommends</screen>
    <para>
     L&apos;opzione <option>-no-allow-vendor-change</option> assicura che gli RPM di terze parti non sovrascrivano gli RPM del sistema di base. L&apos;opzione <option>--no-recommends</option> assicura che i pacchetti deselezionati durante l&apos;installazione iniziale non verranno aggiunti di nuovo.
    </para>
   </step>
   <step>
    <para>
     In seguito alla migrazione e all&apos;avvio del sistema nella nuova versione del Service Pack, verificare nuovamente la presenza di pacchetti orfani:
    </para>
<screen><prompt>&gt; </prompt><command>sudo</command> zypper packages --orphaned</screen>
    <para>
     Confrontare il nuovo elenco con quello generato prima di avviare la migrazione. La presenza di nuovi pacchetti nell&apos;elenco potrebbe dipendere dal fatto che questi sono stati spostati in un modulo diverso nel nuovo Service Pack. Se tale modulo non era presente nell&apos;installazione precedente, il pacchetto non è stato aggiornato.
    </para>
    <para>
     È possibile verificare a quale modulo appartiene un pacchetto all&apos;indirizzo <link xlink:href="https://scc.suse.com/packages"/>. Aggiungere i moduli mancanti utilizzando <command>zypper addrepo</command> o il modulo dei repository dei programmi YaST e aggiornare i pacchetti orfani in un secondo momento eseguendo:
    </para>
<screen><prompt>&gt; </prompt><command>sudo</command> zypper install --no-recommends <replaceable>LIST OF PACKAGES</replaceable></screen>
   </step>
   <step>
    <para>
     La migrazione a un nuovo Service Pack è stata eseguita correttamente.
    </para>
   </step>
  </procedure>
 </sect1>
 <sect1 os="sles;sled" xml:id="sec-upgrade-online-rollback">
  <title>Rollback di un Service Pack</title>

  <para>
   Se un Service Pack non è adatto alle proprie esigenze, SUSE Linux Enterprise supporta il ripristino del sistema allo stato precedente l&apos;avvio della migrazione del Service Pack. Il prerequisito è una partizione radice Btrfs con istantanee abilitate (questa è l&apos;impostazione predefinita a partire da SLES 12). Per informazioni, vedere <xref linkend="cha-snapper"/>.
  </para>

  <procedure xml:id="pro-upgrade-online-rollback">
   <step>
    <para>
     Recuperare un elenco di tutte le istantanee di Snapper:
    </para>
<screen><prompt>&gt; </prompt><command>sudo</command> snapper list</screen>
    <para>
     Rivedere l&apos;output per individuare lo snapshot creato subito prima dell&apos;avvio della migrazione del Service Pack. Nella colonna <guimenu>Descrizione</guimenu> è contenuta l&apos;istruzione corrispondente e lo snapshot è contrassegnato come <literal>importante</literal> nella colonna <guimenu>Dati utente</guimenu>. Memorizzare il numero di snapshot nella colonna <guimenu>N.</guimenu> e la rispettiva data nella colonna <guimenu>Data</guimenu>.
    </para>
   </step>
   <step>
    <para>
     Riavviare il computer. Dal menu di avvio, selezionare <guimenu>Avvia boot loader da uno snapshot di sola lettura</guimenu> e scegliere lo snapshot con la data e il numero memorizzato al passaggio precedente. Viene caricato un secondo menu di avvio (quello dello snapshot). Selezionare la voce che inizia con SLES <phrase role="productnumber"><phrase os="sles;sled">15 SP4</phrase></phrase> ed eseguirne l&apos;avvio.
    </para>
   </step>
   <step>
    <para>
     Il sistema viene avviato nello stato precedente con la partizione del sistema montata in sola lettura. Eseguire il login come <systemitem class="username">root</systemitem> e verificare che lo snapshot selezionato sia corretto. Verificare inoltre che tutto funzioni come previsto. Si noti che poiché il file system radice è montato in sola lettura, è possibile che vengano applicate restrizioni alle funzionalità.
    </para>
    <para>
     In caso di problemi o se è stato avviato lo snapshot errato, riavviare e scegliere uno snapshot diverso dal quale eseguire l&apos;avvio. Le modifiche apportate finora non sono permanenti. Se lo snapshot è corretto e funziona come previsto, apportare la modifica permanente eseguendo il seguente comando:
    </para>
<screen><prompt>&gt; </prompt><command>sudo</command> snapper rollback</screen>
    <para>
     Riavviare il computer. Nella schermata di avvio, scegliere la voce di avvio di default per riavviare nel sistema ripristinato.
    </para>
   </step>
   <step>
    <para>
     Verificare che la configurazione dell&apos;archivio sia stata reimpostata correttamente. Verificare inoltre che tutte le procedure siano registrate adeguatamente. Se una delle suddette condizioni non è soddisfatta, l&apos;aggiornamento del sistema in un momento successivo potrebbe risultare impossibile o il sistema potrebbe essere aggiornato con archivi di pacchetti errati.
    </para>
    <para>
     Assicurarsi che il sistema sia in grado di accedere a Internet prima di iniziare questa procedura.
    </para>
    <substeps>
     <step>
      <para>
       Aggiornare servizi e archivi eseguendo
      </para>
<screen><prompt>&gt; </prompt><command>sudo</command> zypper ref -fs</screen>
     </step>
     <step>
      <para>
       Ottenere un elenco di archivi attivi eseguendo
      </para>
<screen><prompt>&gt; </prompt><command>sudo</command> zypper lr</screen>
      <para>
       Verificare attentamente l&apos;output di questo comando. Nell&apos;elenco non dovrebbero comparire servizi e archivi aggiunti per l&apos;aggiornamento. Ad esempio, se si sta eseguendo il rollback da SLES <phrase role="productnumber"><phrase os="sles;sled">15 SP4</phrase></phrase> a SLES15 GA, l&apos;elenco deve contenere i repository <literal>SLES15-GA</literal> e non i repository <literal>SLES15-SP4</literal>.
      </para>
      <para>
       Nel caso in cui siano elencati archivi errati, eliminarli e, se necessario, sostituirli con le versioni che corrispondono al prodotto o alla versione del Service Pack in uso. Per un elenco di archivi per i percorsi delle migrazioni supportate, fare riferimento alla <xref linkend="sec-upgrade-background-modules"/>. (Tenere presente che non dovrebbe essere necessario intervenire manualmente, dal momento che i repository dovrebbero essere aggiornati automaticamente; tuttavia, è buona norma verificare e correggere se necessario).
      </para>
     </step>
     <step>
      <para>
       Infine, verificare che nello stato di registrazione siano presenti tutti i prodotti installati eseguendo
      </para>
<screen><prompt>&gt; </prompt><command>sudo</command> SUSEConnect --status</screen>
      <para>
       Lo stato di tutti i prodotti deve essere <literal>Registrato</literal>. In caso contrario, correggere la registrazione eseguendo
      </para>
<screen><prompt>&gt; </prompt><command>sudo</command> SUSEConnect --rollback</screen>
     </step>
    </substeps>
   </step>
  </procedure>

  <para>
   Il sistema viene ripristinato allo stato acquisito immediatamente prima dell&apos;avvio della migrazione del Service Pack.
  </para>
 </sect1>
 <sect1 os="sles;sled" xml:id="sec-upgrade-online-manager">
  <title>Upgrade con SUSE Manager</title>

  <para>
   SUSE Manager è una soluzione server che fornisce aggiornamenti, patch e correzioni per la sicurezza dei client SUSE Linux Enterprise. Viene fornito in dotazione con un set di strumenti e un&apos;interfaccia utente basata su Web per i task di gestione. Per ulteriori informazioni su SUSE Manager, vedere <link xlink:href="https://www.suse.com/products/suse-manager/"/>.
  </para>

  <para>
   La migrazione SP consente di eseguire la migrazione da un Service Pack (SP) a un altro all&apos;interno di una versione principale (ad esempio, da SLES 15 GA a SLES 15 SP4).
  </para>

  
  <para>
  Se il computer è gestito da SUSE Manager, aggiornarlo come descritto nella documentazione di SUSE Manager. La procedura per la <citetitle>migrazione del client</citetitle> è descritta in <citetitle>SUSE Manager Upgrade Guide</citetitle> (Guida all&apos;upgrade di SUSE Manager), disponibile all&apos;indirizzo <link xlink:href="https://documentation.suse.com/suma/"/>.
 </para>
 </sect1>
 <sect1 xml:id="sec-upgrade-online-leap-to-sle" os="sles">
  <title>Upgrade da openSUSE Leap a <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase></title>

  <para>
   È possibile eseguire l&apos;upgrade di un&apos;installazione openSUSE a <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase>. La procedura è analoga a quella della <xref linkend="sec-upgrade-online-yast"/>, ma richiede alcuni passaggi aggiuntivi. Prima di eseguire questa procedura in un sistema di produzione, si consiglia di eseguirla su un sistema di test in cui è replicata la configurazione di produzione.
  </para>

  <para>
   Per scoprire quali versioni di openSUSE Leap sono supportate per la migrazione, fare riferimento alla <xref linkend="sec-upgrade-paths-supported"/>.
  </para>

  <remark>cwickert 2012-02-25: For openSUSE Leap 15.3 and SLE 15 SP3, removing
   packages should not be necessary. Everything should be provided through
   Package Hub. For SP2 and earlier however, orphaned packages should be
   removed.</remark>

  <warning>
   <title>non tutti i pacchetti openSUSE possono essere sottoposti a migrazione</title>
   <para>
    openSUSE fornisce più pacchetti rispetto a <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase>. La maggior parte dei pacchetti aggiuntivi è disponibile tramite SUSE Package Hub e viene sottoposto a migrazione. Eventuali pacchetti aggiuntivi non disponibili tramite SUSE Package Hub non riceveranno più aggiornamenti dopo la migrazione e dovranno quindi essere successivamente rimossi.
   </para>
   <para>
    Assicurarsi che tutti i pacchetti necessari per il sistema siano disponibili nei repository di <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> e SUSE Package Hub. Per ulteriori informazioni su SUSE Package Hub, fare riferimento alla <link xlink:href="https://packagehub.suse.com/"/>.
   </para>
  </warning>

  <procedure xml:id="pro-upgrade-online-leap-to-sle">
   <title>Upgrade da openSUSE Leap a <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase></title>
   <para>
    Per eseguire la migrazione da openSUSE Leap a <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase>, procedere come segue:
   </para>
   <step>
    <para>
     Passare a un TTY, premendo ad esempio <keycombo><keycap function="control"/>
     <keycap function="alt"/><keycap>F1</keycap></keycombo>. Quindi, eseguire il login come <systemitem class="username">root</systemitem>.
    </para>
   </step>
   <step>
    <para>
     Installare i pacchetti <package>yast2-registration</package> e <package>rollback-helper</package>:
    </para>
<screen><prompt role="root"># </prompt><command>zypper in yast2-registration rollback-helper</command></screen>
   </step>
   
   <step>
    <para>
     Abilitare il servizio <systemitem class="service">rollback-helper</systemitem>:
    </para>
<screen><prompt role="root"># </prompt><command>systemctl enable rollback</command></screen>
   </step>
   <step>
    <para>
     Registrare il sistema con SUSE Customer Center:
    </para>
<screen><prompt role="root"># </prompt><command>yast2 registration</command></screen>
   </step>
   <step>
    <para>
     Eseguire la migrazione:
    </para>
<screen><prompt role="root"># </prompt><command>yast2 migration</command></screen>
    <para>
     In caso di conflitti tra pacchetti, YaST mostra un elenco di risoluzioni disponibili.
    </para>
   </step>
   <step>
    <para>
     Rimuovere i pacchetti orfani:
    </para>
<screen><prompt role="root"># </prompt><command>zypper rm $(zypper --no-refresh packages --orphaned | gawk '{print $5}' | tail -n +5)</command></screen>
   </step>
   <step>
    <para>
     Riavviare il computer:
    </para>
<screen><prompt role="root"># </prompt><command>reboot</command></screen>
   </step>
  </procedure>

  <para>
   Il sistema è stato migrato a <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase>.
  </para>

  <para>
   Se si verifica un problema dopo la migrazione, è possibile ripristinare lo stato precedente come un upgrade di Service Pack. Per ulteriori informazioni, vedere <xref linkend="sec-upgrade-online-rollback"/>.
  </para>
 </sect1>
</chapter>
