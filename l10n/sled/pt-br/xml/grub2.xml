<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="grub2.xml" version="5.0" xml:id="cha-grub2">
  <title>Carregador de boot GRUB 2</title>
  <info>
    <abstract>
      <para>
        Este capítulo descreve como configurar o GRUB 2, o carregador de boot usado no <phrase role="productname"><phrase os="sled">SUSE® Linux Enterprise Desktop</phrase></phrase>. <phrase os="sled;sles">Ele é o sucessor do carregador de boot GRUB tradicional, agora chamado de <quote>GRUB Legacy</quote>. O GRUB 2 tem sido o carregador de boot padrão no <phrase role="productname"><phrase os="sled">SUSE® Linux Enterprise Desktop</phrase></phrase> desde a versão 12.</phrase> Um módulo do YaST está disponível para definir as configurações mais importantes. O procedimento de boot como um todo é detalhado no <xref linkend="cha-boot"/>. Para obter detalhes sobre o suporte a Boot Seguro para máquinas UEFI, consulte o <xref linkend="cha-uefi"/>.
      </para>
    </abstract>
    <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
      <dm:bugtracker/>
      <dm:translation>yes</dm:translation>
    </dm:docmanager>
  </info>
  <sect1 xml:id="sec-grub2-new-features">
    <title>Principais diferenças entre o GRUB Legacy e o GRUB 2</title>

    <itemizedlist mark="bullet" spacing="normal">
      <listitem>
        <para>
          A configuração é armazenada em arquivos diferentes.
        </para>
      </listitem>
      <listitem>
        <para>
          Mais sistemas de arquivos são suportados (por exemplo, Btrfs).
        </para>
      </listitem>
      <listitem>
        <para>
          Pode ler arquivos armazenados em dispositivos LVM ou RAID diretamente.
        </para>
      </listitem>
      <listitem>
        <para>
          A interface do usuário pode ser traduzida e alterada com temas.
        </para>
      </listitem>
      <listitem>
        <para>
          Inclui um mecanismo para carregar módulos que suportam recursos adicionais, como sistemas de arquivos, etc
        </para>
      </listitem>
      <listitem>
        <para>
          Pesquisa e gera automaticamente entradas de boot para outros kernels e sistemas operacionais, como o Windows.
        </para>
      </listitem>
      <listitem>
        <para>
          Inclui um console mínimo do tipo Bash.
        </para>
      </listitem>
    </itemizedlist>
  </sect1>
  <sect1 xml:id="sec-grub2-file-structure">
    <title>Estrutura do arquivo de configuração</title>

    <para>
      A configuração do GRUB 2 baseia-se nos seguintes arquivos:
    </para>

    <variablelist>
      <varlistentry>
        <term><filename>/boot/grub2/grub.cfg</filename></term>
        <listitem>
          <para>
            Este arquivo inclui a configuração dos itens de menu do GRUB 2. Ele substitui o <filename>menu.lst</filename> usado no GRUB Legacy. O <filename>grub.cfg</filename> não deve ser editado. Ele é gerado automaticamente pelo comando <command>grub2-mkconfig -o
            /boot/grub2/grub.cfg</command>.
          </para>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term><filename>/boot/grub2/custom.cfg</filename></term>
        <listitem>
          <para>
            Este arquivo opcional é diretamente originado pelo <filename>grub.cfg</filename> no momento da inicialização e pode ser usado para adicionar itens personalizados ao menu de boot. A partir do <phrase role="productname"><phrase os="sled">SUSE Linux Enterprise Desktop</phrase></phrase>
            <phrase os="sles;sled">12 SP2</phrase>, essas entradas também são analisadas ao usar o <command>grub-once</command>.
          </para>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term><filename>/etc/default/grub</filename></term>
        <listitem>
          <para>
            Esse arquivo controla as configurações de usuário do GRUB 2 e, normalmente, inclui outras configurações de ambiente, como fundos e temas.
          </para>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term>Scripts em <filename>/etc/grub.d/</filename></term>
        <listitem>
          <para>
            Os scripts nesse diretório são lidos durante a execução do comando <command>grub2-mkconfig -o /boot/grub2/grub.cfg</command>. Suas instruções estão integradas ao arquivo de configuração principal <filename>/boot/grub/grub.cfg</filename>.
          </para>
        </listitem>
      </varlistentry>
      <varlistentry xml:id="vle-grub2-sysconfig">
        <term><filename>/etc/sysconfig/bootloader</filename></term>
        <listitem>
          <para>
            Esse arquivo de configuração armazena determinadas configurações básicas, como o tipo de carregador de boot e se é para habilitar o suporte a Boot Seguro UEFI.
          </para>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term><filename arch="x86_64">/boot/grub2/x86_64-efi</filename>, <filename arch="power">/boot/grub2/power-ieee1275</filename></term>
        <listitem>
          <para>
            Estes arquivos de configuração incluem opções específicas da arquitetura.
          </para>
        </listitem>
      </varlistentry>
    </variablelist>

    <para>
      O GRUB 2 pode ser controlado de várias maneiras. As entradas de boot de uma configuração existente podem ser selecionadas no menu gráfico (splash screen). A configuração é carregada do arquivo <filename>/boot/grub2/grub.cfg</filename>, que é compilado de outros arquivos de configuração (veja abaixo). Todos os arquivos de configuração do GRUB 2 são considerados arquivos do sistema, e você precisa de privilégios de <systemitem class="username">root</systemitem> para editá-los.
    </para>

    <note>
      <title>Ativando mudanças de configuração</title>
      <para>
        Depois de editar manualmente os arquivos de configuração do GRUB 2, será necessário executar <command>grub2-mkconfig -o /boot/grub2/grub.cfg</command> para ativar as mudanças. No entanto, isso não é necessário ao mudar a configuração com o YaST porque ele executa esse comando automaticamente.
      </para>
    </note>

    <sect2 xml:id="sec-grub2-cfg">
      <title>O arquivo <filename>/boot/grub2/grub.cfg</filename></title>
      <para>
        A splash screen gráfica com o menu de boot baseia-se no arquivo de configuração <filename>/boot/grub2/grub.cfg</filename> do GRUB 2, que contém as informações sobre todas as partições ou os sistemas operacionais que podem ser inicializados pelo menu.
      </para>
      <para>
        Todas as vezes que o sistema é inicializado, o GRUB 2 carrega o arquivo de menu diretamente do sistema de arquivos. Por essa razão, o GRUB 2 não precisa ser reinstalado após as modificações no arquivo de configuração. O <filename>grub.cfg</filename> é recriado automaticamente com as instalações ou remoções do kernel.
      </para>
      <para>
        <filename>grub.cfg</filename> é compilado com base no arquivo <filename>/etc/default/grub</filename> e nos scripts disponíveis no diretório <filename>/etc/grub.d/</filename> durante a execução do comando <command>grub2-mkconfig -o /boot/grub2/grub.cfg</command>. Portanto, você nunca deve editar o arquivo manualmente. Em vez disso, edite os arquivos de origem relacionados ou use o módulo <guimenu>Carregador de Boot</guimenu> do YaST para modificar a configuração, conforme descrito na <xref linkend="sec-grub2-yast2-config"/>.
      </para>
    </sect2>

    <sect2 xml:id="sec-grub2-etc-default-grub">
      <title>O arquivo <filename>/etc/default/grub</filename></title>
      <para>
        Há mais opções gerais do GRUB 2 nesse arquivo, como o horário em que o menu é exibido ou o OS padrão para boot. Para listar todas as opções disponíveis, consulte a saída do seguinte comando:
      </para>
<screen><prompt>&gt; </prompt>grep "export GRUB_DEFAULT" -A50 /usr/sbin/grub2-mkconfig | grep GRUB_</screen>
      <para>
        Você pode introduzir variáveis personalizadas e usá-las posteriormente nos scripts que estão no diretório <filename>/etc/grub.d</filename>.
      </para>
      <para>
        Após editar o <filename>/etc/default/grub</filename>, atualize o arquivo de configuração principal com o <command>grub2-mkconfig -o
        /boot/grub2/grub.cfg</command>.
      </para>
      <note>
        <title>Escopo</title>
        <para>
          Todas as opções especificadas neste arquivo são opções gerais que afetam todas as entradas de boot. As opções específicas de um hipervisor Xen incluem a substring <literal>_XEN_</literal>.
        </para>
      </note>
      <important>
        <title>Escapando aspas internas</title>
        <para>
          As opções mais complexas com espaços exigem aspas para que sejam processadas como uma opção. Essas aspas internas precisam ter o escape correto, por exemplo:
        </para>
<screen>GRUB_CMDLINE_LINUX_XEN="debug loglevel=9 log_buf_len=5M \"ddebug_query=file drivers/xen/xen-acpi-processor.c +p\""</screen>
      </important>
      <variablelist>
        <varlistentry>
          <term><literal>GRUB_DEFAULT</literal></term>
          <listitem>
            <para>
              Define a entrada do menu de boot que será inicializada por padrão. Seu valor pode ser numérico, o nome completo de uma entrada do menu ou <quote>saved</quote> (gravado).
            </para>
            <para>
              <literal>GRUB_DEFAULT=2</literal> inicializa a terceira entrada (contada a partir de zero) do menu de boot.
            </para>
            <para>
              <literal>GRUB_DEFAULT="2&gt;0"</literal> inicializa a primeira entrada do submenu da terceira entrada do menu de nível superior.
            </para>
            <para>
              <literal>GRUB_DEFAULT="Example boot menu entry"</literal> inicializa a entrada de menu com o título <quote>Exemplo de entrada de menu de boot</quote>.
            </para>
            <para>
              <literal>GRUB_DEFAULT=saved</literal> inicializa a entrada especificada pelos comandos <command>grub2-once</command> ou <command>grub2-set-default</command>. Enquanto <command>grub2-reboot</command> define a entrada de boot padrão apenas para a próxima reinicialização, o <command>grub2-set-default</command> define a entrada de boot padrão até ser modificada. <command>grub2-editenv
              list</command> lista a entrada de boot seguinte.
            </para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term><literal>GRUB_HIDDEN_TIMEOUT</literal></term>
          <listitem>
            <para>
              Aguarda o usuário pressionar uma tecla durante o número especificado de segundos. Durante o período, nenhum menu é exibido, exceto se o usuário pressionar uma tecla. Se nenhuma tecla for pressionada durante o período especificado, o controle será passado para <literal>GRUB_TIMEOUT</literal>. <literal>GRUB_HIDDEN_TIMEOUT=0</literal> verifica primeiro se a tecla <keycap function="shift"/> foi pressionada e mostra o menu de boot em caso afirmativo; do contrário, inicializa a entrada do menu padrão imediatamente. Esse é o procedimento padrão quando apenas um OS inicializável é identificado pelo GRUB 2.
            </para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term><literal>GRUB_HIDDEN_TIMEOUT_QUIET</literal></term>
          <listitem>
            <para>
              Se <literal>false</literal> (falso) for especificado, um temporizador de contagem regressiva será exibido em uma tela em branco quando o recurso <literal>GRUB_HIDDEN_TIMEOUT</literal> estiver ativo.
            </para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term><literal>GRUB_TIMEOUT</literal></term>
          <listitem>
            <para>
              O período em segundos durante o qual o menu de boot é exibido antes de inicializar a entrada de boot padrão automaticamente. Se você pressionar uma tecla, o tempo de espera será cancelado, e o GRUB 2 aguardará você fazer uma seleção manualmente. <literal>GRUB_TIMEOUT=-1</literal> exibe o menu até você selecionar a entrada de boot manualmente.
            </para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term><literal>GRUB_CMDLINE_LINUX</literal></term>
          <listitem>
            <para>
              As entradas nessa linha são adicionadas ao fim das entradas de boot para os modos normal e de recuperação. Use-a para adicionar parâmetros do kernel à entrada de boot.
            </para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term><literal>GRUB_CMDLINE_LINUX_DEFAULT</literal></term>
          <listitem>
            <para>
              Igual a <literal>GRUB_CMDLINE_LINUX</literal>, mas as entradas são anexadas apenas no modo normal.
            </para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term><literal>GRUB_CMDLINE_LINUX_RECOVERY</literal></term>
          <listitem>
            <para>
              Igual a <literal>GRUB_CMDLINE_LINUX</literal>, mas as entradas são anexadas apenas no modo de recuperação.
            </para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term><literal>GRUB_CMDLINE_LINUX_XEN_REPLACE</literal></term>
          <listitem>
            <para>
              Essa entrada substitui os parâmetros <literal>GRUB_CMDLINE_LINUX</literal> de todas as entradas de boot do Xen.
            </para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term><literal>GRUB_CMDLINE_LINUX_XEN_REPLACE_DEFAULT</literal></term>
          <listitem>
            <para>
              Igual a <literal>GRUB_CMDLINE_LINUX_XEN_REPLACE</literal>, mas substitui apenas os parâmetros de <literal>GRUB_CMDLINE_LINUX_DEFAULT</literal>.
            </para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term><literal>GRUB_CMDLINE_XEN</literal></term>
          <listitem>
            <para>
              Essas entradas são passadas para as entradas do menu Xen do hypervisor Xen para os modos normal e de recuperação. Por exemplo:
            </para>
            <screen>GRUB_CMDLINE_XEN="loglvl=all guest_loglvl=all"</screen>
            <tip>
              <title>Opções do hipervisor Xen</title>
              <para>
                Encontre uma lista completa de opções do hipervisor Xen em <link xlink:href="https://xenbits.xen.org/docs/unstable/misc/xen-command-line.html"/>
              </para>
            </tip>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term><literal>GRUB_CMDLINE_XEN_DEFAULT</literal></term>
          <listitem>
            <para>
              Igual a <literal>GRUB_CMDLINE_XEN</literal>, mas as entradas são anexadas apenas no modo normal.
            </para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term><literal>GRUB_TERMINAL</literal></term>
          <listitem>
            <para>
              Habilita e especifica um dispositivo de terminal de entrada/saída. Pode ser <literal>console</literal> (consoles BIOS e EFI do PC), <literal>serial</literal> (terminal serial), <literal>ofconsole</literal> (console do Open Firmware) ou o <literal>gfxterm</literal> padrão (saída do modo gráfico). É possível também habilitar mais de um dispositivo colocando as opções necessárias entre aspas, por exemplo, <literal>GRUB_TERMINAL="console
              serial"</literal>.
            </para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term><literal>GRUB_GFXMODE</literal></term>
          <listitem>
            <para>
              A resolução usada para o terminal gráfico <literal>gfxterm</literal> . Você pode usar apenas os modos suportados por sua placa gráfica (VBE). O padrão é &apos;&apos;auto&apos;&apos;, que tenta selecionar uma resolução preferencial. É possível exibir as resoluções de tela disponíveis para o GRUB 2 digitando <command>videoinfo</command> na linha de comando do GRUB 2. Para acessar a linha de comando, digite <keycap>C</keycap> quando aparecer a tela do menu de boot do GRUB 2.
            </para>
            <para>
              É possível também especificar a profundidade de cores anexando-a à configuração da resolução, por exemplo, <literal>GRUB_GFXMODE=1280x1024x24</literal>.
            </para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term><literal>GRUB_BACKGROUND</literal></term>
          <listitem>
            <para>
              Defina uma imagem de fundo para o terminal gráfico <literal>gfxterm</literal>. A imagem deve ser um arquivo legível pelo GRUB 2 no momento da inicialização, que deve terminar com o sufixo <literal>.png</literal>, <literal>.tga</literal>, <literal>.jpg</literal> ou <literal>.jpeg</literal>. Se necessário, a imagem é dimensionada para caber na tela.
            </para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term><literal>GRUB_DISABLE_OS_PROBER</literal></term>
          <listitem>
            <para>
              Se esta opção for definida como <literal>true</literal> (verdadeiro), a pesquisa automática de outros sistemas operacionais será desabilitada. Apenas as imagens do kernel em <filename>/boot/</filename> e as opções de seus próprios scripts em <filename>/etc/grub.d/</filename> serão detectadas.
            </para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term><literal>SUSE_BTRFS_SNAPSHOT_BOOTING</literal></term>
          <listitem>
            <para>
              Se essa opção for definida como <literal>true</literal> (verdadeiro), o GRUB 2 poderá ser inicializado diretamente nos instantâneos do Snapper. Para obter mais informações, consulte a <xref linkend="sec-snapper-snapshot-boot"/>. 
            </para>
          </listitem>
        </varlistentry>
      </variablelist>
      <para>
        Para obter uma lista completa de opções, consulte o <link xlink:href="https://www.gnu.org/software/grub/manual/grub/grub.html#Simple-configuration">
        GNU GRUB manual</link>.
      </para>
    </sect2>

    <sect2 xml:id="sec-grub2-etc-grub-d">
      <title>Scripts em <filename>/etc/grub.d</filename></title>
      <para>
        Os scripts nesse diretório são lidos durante a execução do comando <command>grub2-mkconfig -o /boot/grub2/grub.cfg</command>. As instruções deles estão incorporadas ao <filename>/boot/grub2/grub.cfg</filename>. A ordem dos itens de menu no <filename>grub.cfg</filename> é determinada pela ordem em que os arquivos são executados nesse diretório. Os arquivos com um número à esquerda são executados primeiro, começando pelo número mais baixo. <filename>00_header</filename> é executado antes de <filename>10_linux</filename>, que é executado antes de <filename>40_custom</filename>. Se houver arquivos com nomes alfabéticos, eles serão executados depois dos arquivos com números nos nomes. Apenas os arquivos executáveis geram uma saída para <filename>grub.cfg</filename> durante a execução de <command>grub2-mkconfig</command>. Por padrão, todos os arquivos no diretório <filename>/etc/grub.d</filename> são executáveis.
      </para>
      <tip>
        <title>Conteúdo personalizado persistente no <filename>grub.cfg</filename></title>
        <para>
          Como <filename>/boot/grub2/grub.cfg</filename> é recompilado sempre que <command>grub2-mkconfig</command> é executado, qualquer conteúdo personalizado é perdido. Para inserir suas linhas diretamente no <filename>/boot/grub2/grub.cfg</filename> sem as perder após a execução de <command>grub2-mkconfig</command>, insira-as entre
        </para>
<screen>### BEGIN /etc/grub.d/90_persistent ###</screen>
        <para>
          e
        </para>
<screen>### END /etc/grub.d/90_persistent ###</screen>
        <para>
          O script <filename>90_persistent</filename> garante que o conteúdo seja preservado.
        </para>
        <para>
          Veja a seguir uma lista dos scripts mais importantes:
        </para>
      </tip>
      <variablelist>
        <varlistentry>
          <term><filename>00_header</filename></term>
          <listitem>
            <para>
              Define variáveis de ambiente, como locais de arquivos do sistema, configurações de tela, temas e entradas que já foram gravadas. Ele também importa as preferências armazenadas no <filename>/etc/default/grub</filename>. Normalmente, não é necessário modificar este arquivo.
            </para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term><filename>10_linux</filename></term>
          <listitem>
            <para>
              Identifica os kernels do Linux no dispositivo raiz e cria entradas de menu relevantes. Inclui a opção de modo de recuperação associada, se habilitada. Somente o kernel mais recente é exibido na página de menu principal, com kernels adicionais incluídos em um submenu.
            </para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term><filename>30_os-prober</filename></term>
          <listitem>
            <para>
              Esse script usa o <command>os-prober</command> para procurar o Linux e outros sistemas operacionais e apresenta os resultados no menu do GRUB 2. Há seções para identificar outros sistemas operacionais específicos, como Windows ou macOS.
            </para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term><filename>40_custom</filename></term>
          <listitem>
            <para>
              Este arquivo oferece uma forma simples de incluir entradas de boot personalizadas no <filename>grub.cfg</filename>. Não mude a parte <literal>exec tail -n +3 $0</literal> que fica no começo.
            </para>
          </listitem>
        </varlistentry>
      </variablelist>
      <para>
        A sequência de processamento é definida pelos números precedentes, sendo o menor número executado primeiro. Se os scripts forem precedidos pelo mesmo número, a ordem alfabética do nome completo determinará a disposição.
      </para>
      <tip>
        <title><filename>/boot/grub2/custom.cfg</filename></title>
        <para>
          Se você criar e preencher o <filename>/boot/grub2/custom.cfg</filename> com conteúdo, ele será incluído automaticamente no <filename>/boot/grub2/grub.cfg</filename> logo após <filename>40_custom</filename> no momento da inicialização.
        </para>
      </tip>
    </sect2>

    <sect2 xml:id="sec-grub2-map">
      <title>Mapeamento entre unidades BIOS e dispositivos Linux</title>
      <para>
        No GRUB Legacy, o arquivo de configuração <filename>device.map</filename> era usado para derivar nomes de dispositivos Linux dos números das unidades BIOS. O mapeamento entre as unidades BIOS e os dispositivos Linux nem sempre pode ser previsto corretamente. Por exemplo, o GRUB Legacy obterá a ordem incorreta se a sequência de boot das unidades IDE e SCSI for trocada na configuração do BIOS.
      </para>
      <para>
        O GRUB 2 evita este problema usando strings de ID de dispositivo (UUIDs) ou rótulos de sistema de arquivos ao gerar o <filename>grub.cfg</filename>. Os utilitários do GRUB 2 criam um mapa de dispositivos temporário imediatamente, o que, na maioria das vezes, é suficiente, sobretudo para sistemas de disco único.
      </para>
      <para>
        Porém, se você precisa anular o mecanismo de mapeamento de dispositivos automático do GRUB 2, crie seu arquivo de mapeamento personalizado <filename>/boot/grub2/device.map</filename>. O seguinte exemplo muda o mapeamento para transformar o <literal>DISK 3</literal> no disco de boot. Os números de partição do GRUB 2 começam com <literal>1</literal>, e não com <literal>0</literal> como no GRUB 2 Legacy.
      </para>
<screen>(hd1)  /dev/disk-by-id/<replaceable>DISK3 ID</replaceable>
(hd2)  /dev/disk-by-id/<replaceable>DISK1 ID</replaceable>
(hd3)  /dev/disk-by-id/<replaceable>DISK2 ID</replaceable></screen>
    </sect2>

    <sect2 xml:id="sec-grub2-menu-change">
      <title>Editando as entradas de menu durante o procedimento de boot</title>
      <para>
        É útil editar diretamente as entradas de menu quando o sistema não é mais inicializado por causa de falha na configuração. Ele também pode ser usado para testar novas configurações sem alterar a configuração do sistema.
      </para>
      <procedure>
        <step>
          <para>
            No menu gráfico de boot, selecione a entrada que deseja editar com as teclas de seta.
          </para>
        </step>
        <step>
          <para>
            Pressione <keycap>E</keycap> para abrir o editor baseado em texto.
          </para>
        </step>
        <step>
          <para>
            Use as teclas de seta para ir até a linha que deseja editar.
          </para>
          <figure xml:id="fig-grub2-boot-editor">
            <title>Editor de boot do GRUB 2</title>
            <mediaobject>
              <imageobject role="fo">
                <imagedata fileref="grub2_edit_config.png" width="75%"/>
              </imageobject>
              <imageobject role="html">
                <imagedata fileref="grub2_edit_config.png" width="75%"/>
              </imageobject>
            </mediaobject>
          </figure>
          <para>
            Agora você tem duas opções:
          </para>
          <substeps performance="required">
            <step>
              <para>
                Adicione parâmetros separados por espaço ao fim da linha que começa com <literal>linux</literal> ou <literal>linuxefi</literal> para editar os parâmetros de kernel. Há uma lista completa de parâmetros disponível em <link xlink:href="https://en.opensuse.org/Linuxrc"/>. 
              </para>
            </step>
            <step>
              <para>
                Se preferir, edite as opções gerais para mudar a versão do kernel, por exemplo. A tecla <keycap function="tab"/> sugere todas as complementações possíveis.
              </para>
            </step>
          </substeps>
        </step>
        <step>
          <para>
            Pressione <keycap>F10</keycap> para inicializar o sistema com as mudanças feitas ou pressione <keycap function="escape"/> para descartar suas edições e retornar ao menu do GRUB 2.
          </para>
        </step>
      </procedure>
      <para>
        As mudanças feitas desta maneira só se aplicam ao processo de boot atual, elas não são gravadas permanentemente.
      </para>
      <important>
        <title>Layout do teclado durante o procedimento de boot</title>
        <para>
          O layout do teclado norte-americano é o único disponível na hora de inicializar. Consulte o <xref linkend="fig-trouble-install-keyboard-us"/>.
        </para>
      </important>
      <note arch="x86_64">
        <title>Carregador de boot na mídia de instalação</title>
        <para>
          O Carregador de Boot da mídia de instalação em sistemas com BIOS tradicional ainda é o GRUB Legacy. Para adicionar parâmetros de boot, selecione uma entrada e comece a digitar. As adições feitas à entrada de boot de instalação são gravadas no sistema instalado permanentemente.
        </para>
      </note>
      
    </sect2>

    <sect2 xml:id="sec-grub2-password">
      <title>Definindo uma senha de boot</title>
      <para>
        Mesmo antes da inicialização do sistema operacional, o GRUB 2 permite acessar os sistemas de arquivos. Os usuários que não têm permissões de root poderão acessar os arquivos no sistema Linux aos quais não têm acesso depois que o sistema for inicializado. Para bloquear esse tipo de acesso ou impedir que os usuários inicializem determinadas entradas de menu, defina uma senha de boot.
      </para>
      <important>
        <title>A inicialização exige uma senha</title>
        <para>
          Se definida, a senha de boot será necessária em cada inicialização, o que significa que o sistema não será inicializado automaticamente.
        </para>
      </important>
      <para>
        Para definir uma senha de boot, faça o seguinte. Se preferir, use o YaST (<xref linkend="vle-grub2-yast2-boot-password"/>).
      </para>
      <procedure>
        <step>
          <para>
            Criptografe a senha usando <command>grub2-mkpasswd-pbkdf2:</command>
          </para>
<screen><prompt>&gt; </prompt><command>sudo</command> grub2-mkpasswd-pbkdf2
Password: ****
Reenter password: ****
PBKDF2 hash of your password is grub.pbkdf2.sha512.10000.9CA4611006FE96BC77A...
</screen>
        </step>
        <step>
          <para>
            Cole a string resultante no arquivo <filename>/etc/grub.d/40_custom</filename> junto com o comando <command>set superusers</command>.
          </para>
<screen>set superusers="root"
password_pbkdf2 root grub.pbkdf2.sha512.10000.9CA4611006FE96BC77A...</screen>
        </step>
        <step>
          <para>
            Para importar as mudanças para o arquivo de configuração principal, execute:
          </para>
<screen><prompt>&gt; </prompt><command>sudo</command> grub2-mkconfig -o /boot/grub2/grub.cfg</screen>
        </step>
      </procedure>
      <para>
        Após a reinicialização, o GRUB 2 solicitará para você informar o nome de usuário e a senha ao tentar inicializar uma entrada de menu. Insira <literal>root</literal> e a senha que você digitou durante o comando <command>grub2-mkpasswd-pbkdf2</command>. Se as credenciais estiverem corretas, o sistema inicializará a entrada de boot selecionada.
      </para>
      <para>
        Para obter mais informações, consulte <link xlink:href="https://www.gnu.org/software/grub/manual/grub/grub.html#Security"/>. 
      </para>
    </sect2>

    <sect2 xml:id="sec-grub2-authorization">
      <title>Acesso autorizado às entradas do menu de boot</title>
      <para>
        Você pode configurar o GRUB 2 para permitir acesso às entradas do menu de boot, dependendo do nível de autorização. Você pode configurar várias contas de usuário protegidas por senhas e atribuir a elas acesso a diferentes entradas de menu. Para configurar a autorização no GRUB 2, siga estas etapas:
      </para>
      <procedure>
        <step>
          <para>
            Crie e criptografe uma senha para cada conta do usuário que deseja usar no GRUB 2. Use o comando <command>grub2-mkpasswd-pbkdf2</command> conforme descrito na <xref linkend="sec-grub2-password"/>.
          </para>
        </step>
        <step>
          <para>
            Apague o arquivo <filename>/etc/grub.d/10_linux</filename>. Isso impede a saída das entradas do menu padrão do GRUB 2.
          </para>
        </step>
        <step>
          <para>
            Edite o arquivo <filename>/boot/grub2/custom.cfg</filename> e adicione entradas de menu personalizadas manualmente. O seguinte gabarito é um exemplo, ajuste-o de acordo com o seu caso de uso:
          </para>
<screen>
set superusers=admin
password admin <replaceable>ADMIN_PASSWORD</replaceable>
password maintainer <replaceable>MAINTAINER_PASSWORD</replaceable>

menuentry 'Operational mode' {
  insmod ext2
  set root=hd0,1
  echo 'Loading Linux ...'
  linux /boot/vmlinuz root=/dev/vda1 $GRUB_CMDLINE_LINUX_DEFAULT $GRUB_CMDLINE_LINUX mode=operation
  echo 'Loading Initrd ...'
  initrd /boot/initrd
}

menuentry 'Maintenance mode' --users maintainer {
  insmod ext2
  set root=hd0,1
  echo 'Loading Linux ...'
  linux /boot/vmlinuz root=/dev/vda1 $GRUB_CMDLINE_LINUX_DEFAULT $GRUB_CMDLINE_LINUX mode=maintenance
  echo 'Loading Initrd ...'
  initrd /boot/initrd
}
</screen>
        </step>
        <step>
          <para>
            Importe as mudanças para o arquivo de configuração principal:
          </para>
<screen><prompt>&gt; </prompt><command>sudo</command> grub2-mkconfig -o /boot/grub2/grub.cfg</screen>
        </step>
      </procedure>
      <para>
        No exemplo acima:
      </para>
      <itemizedlist>
        <listitem>
          <para>
            O menu do GRUB 2 tem duas entradas, <guimenu>Modo operacional</guimenu> e <guimenu>Modo de manutenção</guimenu>.
          </para>
        </listitem>
        <listitem>
          <para>
            Se nenhum usuário for especificado, ambas as entradas do menu de boot estarão acessíveis, mas ninguém poderá acessar a linha de comando do GRUB 2 nem editar as entradas do menu existentes.
          </para>
        </listitem>
        <listitem>
          <para>
            O usuário <literal>admin</literal> pode acessar a linha de comando do GRUB 2 e editar as entradas de menu existentes.
          </para>
        </listitem>
        <listitem>
          <para>
            O usuário <literal>maintenance</literal> pode selecionar o item do menu de recuperação.
          </para>
        </listitem>
      </itemizedlist>
    </sect2>
  </sect1>
  <xi:include href="grub2_yast_i.xml"/>
  
  <sect1 xml:id="sec-grub2-commands">
    <title>Comandos úteis do GRUB 2</title>

    <variablelist>
      <varlistentry xml:id="vle-grub2-mkconfig">
        <term><command>grub2-mkconfig</command></term>
        <listitem>
          <para>
            Gera um novo <filename>/boot/grub2/grub.cfg</filename> com base em <filename>/etc/default/grub</filename> e nos scripts de <filename>/etc/grub.d/</filename>.
          </para>
          <example>
            <title>Uso do grub2-mkconfig</title>
<screen>grub2-mkconfig -o /boot/grub2/grub.cfg</screen>
          </example>
          <tip>
            <title>Verificação de sintaxe</title>
            <para>
              A execução de <command>grub2-mkconfig</command> sem nenhum parâmetro imprime a configuração em STDOUT, de onde é possível revisá-la. Use <xref linkend="vle-grub2-script-check"/> após a gravação de <filename>/boot/grub2/grub.cfg</filename> para verificar a sintaxe.
            </para>
          </tip>
          <important>
            <title>O <command>grub2-mkconfig</command> não conserta tabelas de boot seguro UEFI</title>
            <para>
              Se você usa Boot Seguro UEFI e o sistema não acessa mais o GRUB 2 corretamente, talvez seja necessário reinstalar o Shim e gerar novamente a tabela de boot UEFI. Para fazer isso, use:
            </para>
<screen><prompt role="root"># </prompt>shim-install --config-file=/boot/grub2/grub.cfg</screen>
          </important>
        </listitem>
      </varlistentry>
      <varlistentry xml:id="vle-grub2-mkrescue">
        <term><command>grub2-mkrescue</command></term>
        <listitem>
          <para>
            Cria uma imagem de recuperação inicializável da configuração do GRUB 2 instalado.
          </para>
          <example>
            <title>Uso do grub2-mkrescue</title>
<screen>grub2-mkrescue -o save_path/name.iso iso</screen>
          </example>
        </listitem>
      </varlistentry>
      <varlistentry xml:id="vle-grub2-script-check">
        <term><command>grub2-script-check</command></term>
        <listitem>
          <para>
            Verifica se há erros de sintaxe no arquivo especificado.
          </para>
          <example>
            <title>Uso do grub2-script-check</title>
<screen>grub2-script-check /boot/grub2/grub.cfg</screen>
          </example>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term><command>grub2-once</command></term>
        <listitem>
          <para>
            Defina a entrada de boot padrão apenas para a próxima inicialização. Para ver a lista de entradas de boot disponíveis, use a opção <option>--list</option>.
          </para>
          <example>
            <title>Uso do grub2-once</title>
<screen>grub2-once number_of_the_boot_entry</screen>
          </example>
          <tip>
            <title><command>grub2-once</command> help</title>
            <para>
              Chame o programa sem nenhuma opção para obter a lista completa de todas as opções possíveis.
            </para>
          </tip>
        </listitem>
      </varlistentry>
    </variablelist>
  </sect1>

  <sect1 xml:id="grub-rescue-target">
    <title>Modo de recuperação</title>

    <para>
      O <emphasis>Modo de recuperação</emphasis> é uma sessão de usuário <systemitem class="username">root</systemitem> específica para solução de problemas e conserto de sistemas em que o processo de inicialização falha. Ele oferece um ambiente de usuário único com sistemas de arquivos locais e serviços do sistema central ativos. As interfaces de rede não estão ativadas. Para entrar no modo de recuperação, siga estas etapas.
    </para>

    <procedure xml:id="proc-rescue-mode">
     <title>Entrando no modo de recuperação</title>
      <step>
        <para>
          Reinicialize o sistema. A tela de boot é exibida com o menu de boot do GRUB 2.
        </para>
      </step>
      <step>
        <para>
          Selecione a entrada do menu que será inicializada e pressione <keycap>e</keycap> para editar a linha de boot.
        </para>
      </step>
      <step>
        <para>
          Anexe o seguinte parâmetro à linha que contém os parâmetros do kernel:
        </para>
<screen>systemd.unit=rescue.target</screen>
      </step>
      <step>
        <para>
          Pressione <keycap function="control"/>+<keycap>X</keycap> para fazer a inicialização com essas configurações.
        </para>
      </step>
      <step>
        <para>
          Insira a senha de <systemitem class="username">root</systemitem>.
        </para>
      </step>
      <step>
        <para>
          Faça as mudanças necessárias.
        </para>
      </step>
      <step>
        <para>
          Insira o destino operacional normal novamente digitando <command>systemctl isolate multi-user.target</command> ou <command>systemctl isolate graphical.target</command> na linha de comando.
        </para>
      </step>
    </procedure>
  </sect1>

  <sect1 xml:id="sec-grub2-info">
    <title>Mais informações</title>

    <para>
      Em <link xlink:href="https://www.gnu.org/software/grub/"/>, há informações abrangentes sobre o GRUB 2. Consulte também a página de informações <command>grub</command>. <phrase os="sles;sled">Você também pode pesquisar a palavra-chave <quote>GRUB 2</quote> na Pesquisa de Informações Técnicas em <link xlink:href="https://www.suse.com/support"/> para obter informações sobre problemas específicos.</phrase>
    </para>
  </sect1>
</chapter>
