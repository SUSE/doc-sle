<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE chapter PUBLIC "-//Novell//DTD NovDoc XML V1.0//EN" "novdocx.dtd"
[
  <!ENTITY % NOVDOC.DEACTIVATE.IDREF "INCLUDE">
  <!ENTITY % entities SYSTEM "entity-decl.ent">
  %entities;
]>
<!--PM's doc requirements:
 *  Server based automounting of home directories
       1.Configuration and usage description (m)
       2.Firewall configuration for SMB support (m)
       3.Kerberos support description (d)

 This is related to #300967: Mount Server Home Directory Automatically with
 Authentication.  Everything that's being done there to ensure that the users
 will be able to access their home directories when hosted on CIFS.
-->
<chapter id="cha.samba">
 <title>Samba</title><indexterm id="idx.Samba" class="startofrange">
 <primary>Samba</primary></indexterm><indexterm>
 <primary>SMB</primary>
 <see>Samba</see></indexterm><indexterm>
 <primary>Mac OS X</primary>
 <secondary>sharing files</secondary></indexterm><indexterm>
 <primary>Windows</primary>
 <secondary>sharing files</secondary></indexterm><indexterm>
 <primary>OS/2</primary>
 <secondary>sharing files</secondary></indexterm><indexterm>
 <primary>Linux</primary>
 <secondary>sharing files with another OS</secondary></indexterm>
 <abstract>
  <para>
   Using Samba, a Unix machine can be configured as a file and print server
   for Mac OS X, Windows, and OS/2 machines. Samba has developed into a
   fully-fledged and rather complex product. Configure Samba with &yast;, or
   by editing the configuration file manually.
  </para>
 </abstract>
 <sect1 id="sec.samba.term">
  <title>Terminology</title>

  <para>
   The following are some terms used in Samba documentation and in the
   &yast; module.
  </para>

  <variablelist>
   <varlistentry>
    <term>SMB protocol</term>
    <listitem>
     <para>
      <indexterm>
      <primary>Samba</primary>
      <secondary>SMB</secondary>
      </indexterm> <indexterm>
      <primary>protocols</primary>
      <secondary>SMB</secondary>
      </indexterm> <indexterm>
      <primary>smbd</primary>
      </indexterm> Samba uses the SMB (server message block) protocol that
      is based on the <phrase role="productname">NetBIOS</phrase> services.
      Microsoft released the protocol so other software manufacturers could
      establish connections to a Microsoft domain network. With Samba, the
      SMB protocol works on top of the TCP/IP protocol, so the TCP/IP
      protocol must be installed on all clients. <indexterm>
      <primary>Samba</primary>
      <secondary>TCP/IP and</secondary>
      </indexterm>
     </para>
     <tip arch="zseries" os="sles">
      <title>IBM &zseries;: NetBIOS Support</title>
      <para>
       IBM &zseries; merely supports SMB over TCP/IP. NetBIOS support is not
       available on these systems.
      </para>
     </tip>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>CIFS protocol</term>
    <listitem>
     <para>
      <indexterm>
      <primary>Samba</primary>
      <secondary>CIFS</secondary>
      </indexterm> <indexterm>
      <primary>protocols</primary>
      <secondary>CIFS</secondary>
      </indexterm> CIFS (common Internet file system) protocol is another
      protocol supported by Samba. CIFS defines a standard remote file
      system access protocol for use over the network, enabling groups of
      users to work together and share documents across the network.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>NetBIOS</term>
    <listitem>
     <para>
      <indexterm>
      <primary>NetBIOS</primary>
      </indexterm> NetBIOS is a software interface (API) designed for
      communication between machines providing a name service. It enables
      machines connected to the network to reserve names for themselves.
      After reservation, these machines can be addressed by name. There is
      no central process that checks names. Any machine on the network can
      reserve as many names as it wants as long as the names are not already
      in use. The NetBIOS interface can be implemented for different network
      architectures. An implementation that works relatively closely with
      network hardware is called
      <phrase role="productname">NetBEUI</phrase>, but this is often
      referred to as <phrase role="productname">NetBIOS</phrase>. Network
      protocols implemented with NetBIOS are IPX from Novell (NetBIOS via
      TCP/IP) and TCP/IP.
     </para>
     <para>
      The NetBIOS names sent via TCP/IP have nothing in common with the
      names used in <filename>/etc/hosts</filename> or those defined by DNS.
      NetBIOS uses its own, completely independent naming convention.
      However, it is recommended to use names that correspond to DNS host
      names to make administration easier or use DNS natively. This is the
      default used by Samba.
     </para><indexterm>
     <primary>Samba</primary>
     <secondary>names</secondary></indexterm>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Samba server</term>
    <listitem><indexterm>
     <primary>Samba</primary>
     <secondary>server</secondary></indexterm>
     <para>
      Samba server provides SMB/CIFS services and NetBIOS over IP naming
      services to clients. For Linux, there are three daemons for Samba
      server: smbd for SMB/CIFS services, nmbd for naming services, and
      winbind for authentication.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Samba client</term>
    <listitem><indexterm id="idx.Samba_clients" class="startofrange">
     <primary>Samba</primary>
     <secondary>clients</secondary></indexterm>
     <para>
      The Samba client is a system that uses Samba services from a Samba
      server over the SMB protocol. All common operating systems, such as
      Mac OS X, Windows, and OS/2, support the SMB protocol. The TCP/IP
      protocol must be installed on all computers. Samba provides a client
      for the different Unix flavors. For Linux, there is a kernel module
      for SMB that allows the integration of SMB resources on the Linux
      system level. You do not need to run any daemon for the Samba client.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Shares</term>
    <listitem>
     <para>
      <indexterm>
      <primary>Samba</primary>
      <secondary>shares</secondary>
      </indexterm> SMB servers provide resources to the clients by means of
      shares. Shares are printers and directories with their subdirectories
      on the server. It is exported by means of a name and can be accessed
      by its name. The share name can be set to any name&mdash;it does not
      need to be the name of the export directory. A printer is also
      assigned a name. Clients can access the printer by its name.
      <indexterm>
      <primary>printing</primary>
      <secondary>Samba</secondary>
      </indexterm> <indexterm>
      <primary>Samba</primary>
      <secondary>printers</secondary>
      </indexterm>
      <indexterm class="endofrange" startref="idx.Samba_clients"/>
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>DC</term>
    <listitem>
     <para>
      <indexterm>
      <primary>Samba</primary>
      <secondary>DC</secondary>
      </indexterm> A domain controller (DC) is a server that handles
      accounts in a domain. For data replication, additional domain
      controllers are available in one domain.
     </para>
    </listitem>
   </varlistentry>
  </variablelist>
 </sect1>
 <sect1 id="sec.samba.install">
  <title>Installing a Samba Server</title>

  <para>
   To install a Samba server, start &yast; and select
   <menuchoice><guimenu>Software</guimenu> <guimenu>Software
   Management</guimenu></menuchoice>. Choose
   <menuchoice><guimenu>View</guimenu>
   <guimenu>Patterns</guimenu></menuchoice> and select <guimenu>File
   Server</guimenu>. Confirm the installation of the required packages to
   finish the installation process.
  </para>
 </sect1>
 <sect1 id="sec.samba.serv.start" os="sles">
  <title>Starting and Stopping Samba</title>

  <para>
   You can start or stop the Samba server automatically (during boot) or
   manually. Starting and stopping policy is a part of the &yast; Samba
   server configuration described in
   <xref
    linkend="sec.samba.yast2.conf"/>.
  </para>

  <para>
   From a command line, stop services required for Samba with
   <command>systemctl stop smb.service nmb.service</command> and start them
   with <command>systemctl start nmb.service smb.service</command>. The
   <literal>smb.service</literal> cares about <literal>winbind</literal> if
   needed.
  </para>

  <tip>
   <para>
    <systemitem>winbind</systemitem> is an independent service, and as such
    is also offered as an individual <systemitem>samba-winbind</systemitem>
    package.
   </para>
  </tip><indexterm>

  <primary>Samba</primary>

  <secondary>starting</secondary></indexterm><indexterm>

  <primary>Samba</primary>

  <secondary>stopping</secondary></indexterm>
 </sect1>
 <sect1 id="sec.samba.serv.inst">
  <title>Configuring a Samba Server</title><indexterm>

  <primary>Samba</primary>

  <secondary>installing</secondary></indexterm><indexterm>

  <primary>Samba</primary>

  <secondary>servers</secondary></indexterm><indexterm>

  <primary>Samba</primary>

  <secondary>configuring</secondary></indexterm><indexterm>

  <primary>configuring</primary>

  <secondary>Samba</secondary></indexterm>

  <para os="sles">
   A Samba server in &productnamereg; can be configured in two different
   ways: with &yast; or manually. Manual configuration offers a higher level
   of detail, but lacks the convenience of the &yast; GUI.
  </para>

  <para os="sled">
   For configuring a Samba server, see the &sls; documentation.
  </para>

  <sect2 id="sec.samba.yast2.conf" os="sles">
   <title>Configuring a Samba Server with &yast;</title>
   <para>
    To configure a Samba server, start &yast; and select
    <menuchoice><guimenu>Network Services</guimenu><guimenu>Samba
    Server</guimenu></menuchoice>.
   </para>
   <sect3 id="sec.samba.yast2.conf.inst">
    <title>Initial Samba Configuration</title>
    <para>
     When starting the module for the first time, the <guimenu>Samba
     Installation</guimenu> dialog starts, prompting you to make a few basic
     decisions concerning administration of the server. At the end of the
     configuration it prompts for the Samba administrator password
     (<guimenu>Samba Root Password</guimenu>). For later starts, the
     <guimenu>Samba Configuration</guimenu> dialog appears.
    </para>
    <para>
     The <guimenu>Samba Installation</guimenu> dialog consists of two steps
     and optional detailed settings:
    </para>
    <variablelist>
     <varlistentry>
      <term>Workgroup or Domain Name</term>
      <listitem>
       <para>
        Select an existing name from <guimenu>Workgroup or Domain
        Name</guimenu> or enter a new one and click <guimenu>Next</guimenu>.
       </para>
<!--<figure id="fig.yast2.samba.startup">
      <title>Samba Configuration&mdash;Workgroup or
      Domain
      Name</title>
      <mediaobject>
      <imageobject role="fo">
      <imagedata fileref="yast2_samba_workgroup.png" width="70%" format="PNG"/>
     </imageobject>
      <imageobject role="html">
      <imagedata fileref="yast2_samba_workgroup.png" width="75%" format="PNG"/>
     </imageobject>
     </mediaobject>
     </figure>-->
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>Samba Server Type</term>
      <listitem>
       <para>
        In the next step, specify whether your server should act as a
        primary domain controller (PDC), backup domain controller (BDC), or
        not to act as a domain controller at all. Continue with
        <guimenu>Next</guimenu>.
       </para>
      </listitem>
     </varlistentry>
    </variablelist>
    <para>
     If you do not want to proceed with a detailed server configuration,
     confirm with <guimenu>OK</guimenu>. Then in the final pop-up box, set
     the <guimenu>Samba root Password</guimenu>.
    </para>
    <para>
     You can change all settings later in the <guimenu>Samba
     Configuration</guimenu> dialog with the <guimenu>Start-Up</guimenu>,
     <guimenu>Shares</guimenu>, <guimenu>Identity</guimenu>,
     <guimenu>Trusted Domains</guimenu>, and <guimenu>LDAP
     Settings</guimenu> tabs.
    </para>
   </sect3>
   <sect3 id="sec.samba.yast2.conf.adv">
    <title>Advanced Samba Configuration</title>
    <para>
     During the first start of the Samba server module the <guimenu>Samba
     Configuration</guimenu> dialog appears directly after the two initial
     steps described in <xref linkend="sec.samba.yast2.conf.inst"/>. Use it
     to adjust your Samba server configuration.
    </para>
    <para>
     After editing your configuration, click <guimenu>OK</guimenu> to save
     your settings.
    </para>
    <sect4 id="sec.samba.yast2.conf.adv.start">
     <title>Starting the Server</title>
     <para>
      In the <guimenu>Start Up</guimenu> tab, configure the start of the
      Samba server. To start the service every time your system boots,
      select <guimenu>During Boot</guimenu>. To activate manual start,
      choose <guimenu>Manually</guimenu>. More information about starting a
      Samba server is provided in <xref linkend="sec.samba.serv.start"/>.
     </para>
     <para>
      In this tab, you can also open ports in your firewall. To do so,
      select <guimenu>Open Port in Firewall</guimenu>. If you have multiple
      network interfaces, select the network interface for Samba services by
      clicking <guimenu>Firewall Details</guimenu>, selecting the
      interfaces, and clicking <guimenu>OK</guimenu>.
     </para>
<!--
      <figure id="fig.yast2.samba.startup">
      <title>Samba Configuration&mdash;Start
      Up</title>
      <mediaobject>
      <imageobject role="fo">
      <imagedata fileref="yast2_samba_startup.png" width="70%" format="PNG"/>
     </imageobject>
      <imageobject role="html">
      <imagedata fileref="yast2_samba_startup.png" width="75%" format="PNG"/>
     </imageobject>
     </mediaobject>
     </figure>-->
    </sect4>
    <sect4 id="sec.samba.yast2.conf.adv.shares">
     <title>Shares</title>
     <para>
      In the <guimenu>Shares</guimenu> tab, determine the Samba shares to
      activate. There are some predefined shares, like homes and printers.
      Use <guimenu>Toggle Status</guimenu> to switch between
      <guimenu>Active</guimenu> and <guimenu>Inactive</guimenu>. Click
      <guimenu>Add</guimenu> to add new shares and <guimenu>Delete</guimenu>
      to delete the selected share.
     </para>
<!-- <figure id="fig.yast2.samba.shares">
      <title>Samba Configuration&mdash;Shares</title>
      <mediaobject>
      <imageobject role="fo">
      <imagedata fileref="yast2_samba_shares.png" width="70%" format="PNG"/>
     </imageobject>
      <imageobject role="html">
      <imagedata fileref="yast2_samba_shares.png" width="75%" format="PNG"/>
     </imageobject>
     </mediaobject>
     </figure>
      -->
     <para>
      <guimenu>Allow Users to Share Their Directories</guimenu> enables
      members of the group in <guimenu>Permitted Group</guimenu> to share
      directories they own with other users. For example,
      <systemitem>users</systemitem> for a local scope or
      <systemitem>DOMAIN\Users</systemitem> for a domain scope. The user
      also must make sure that the file system permissions allow access.
      With <guimenu>Maximum Number of Shares</guimenu>, limit the total
      amount of shares that may be created. To permit access to user shares
      without authentication, enable <guimenu>Allow Guest Access</guimenu>.
<!-- Bug 579993 is this option gone? -->
     </para>
    </sect4>
    <sect4 id="sec.samba.yast2.conf.adv.identity">
     <title>Identity</title>
     <para>
      In the <guimenu>Identity</guimenu> tab, you can determine the domain
      with which the host is associated (<guimenu>Base Settings</guimenu>)
      and whether to use an alternative host name in the network
      (<guimenu>NetBIOS Hostname</guimenu>).
<!--
   [x] Retrieve WINS server via DHCP
   [ ] Use WINS for Hostname Resolution
-->
      It is also possible to use Microsoft Windows Internet Name Service
      (WINS) for name resolution. In this case, activate <guimenu>Use WINS
      for Hostname Resolution</guimenu> and decide whether to
      <guimenu>Retrieve WINS server via DHCP</guimenu>. To set expert global
      settings or set a user authentication source,
      <phrase
      os="sles">for example LDAP instead of TDB database,
      </phrase>click <guimenu>Advanced Settings</guimenu>.
<!-- FIXME: check, whether
           http://bugzilla.suse.com/show_bug.cgi?id=580102 causes GUI
           changes. 2010-02-16, ke
      -->
     </para>
<!--<figure id="fig.yast2.samba.names">
      <title>Samba
      Configuration&mdash;Identity</title>
      <mediaobject>
      <imageobject role="fo">
      <imagedata fileref="yast2_samba_names.png" width="75%" format="PNG"/>
     </imageobject>
      <imageobject role="html">
      <imagedata fileref="yast2_samba_names.png" width="75%" format="PNG"/>
     </imageobject>
     </mediaobject>
     </figure>
      -->
    </sect4>
    <sect4 id="sec.samba.yast2.conf.adv.trusted">
     <title>Trusted Domains</title>
     <para>
      To enable users from other domains to access your domain, make the
      appropriate settings in the <guimenu>Trusted Domains</guimenu> tab. To
      add a new domain, click <guimenu>Add</guimenu>. To remove the selected
      domain, click <guimenu>Delete</guimenu>.
     </para>
    </sect4>
    <sect4 id="sec.samba.yast2.conf.adv.ldap">
     <title>LDAP Settings</title>
     <para>
      In the tab <guimenu>LDAP Settings</guimenu>, you can determine the
      LDAP server to use for authentication. To test the connection to your
      LDAP server, click <guimenu>Test Connection</guimenu>. To set expert
      LDAP settings or use default values, click <guimenu>Advanced
      Settings</guimenu>.
     </para>
     <para>
      For more information about LDAP configuration, see
      <xref
      linkend="cha.security.ldap"/>.
     </para>
    </sect4>
   </sect3>
  </sect2>

<!-- 2014-07-08 tbazant: according to Lars Muller, SWAT is no longer included
  <sect2 id="sec.samba.serv.inst.swat" os="sles">
   <title>Web Administration with SWAT</title>
   <para>
    <indexterm>
    <primary>Samba</primary>
    <secondary>swat</secondary>
    </indexterm> <indexterm>
    <primary>configuration files</primary>
    <secondary>samba</secondary>
    </indexterm> <indexterm>
    <primary>configuration files</primary>
    <secondary>services</secondary>
    </indexterm> An alternative tool for Samba server administration is SWAT
    (Samba Web Administration Tool). It provides a simple Web interface with
    which to configure the Samba server. To use SWAT, open
    <ulink url="http://localhost:901"/> in a Web browser and log in as user
    <systemitem class="username">root</systemitem>. If you do not have a
    special Samba root account, use the system
    <systemitem class="username">root</systemitem> account.
   </para>
   <note>
    <title>Activating SWAT</title>
    <para>
     After Samba server installation, SWAT is not activated. To activate it,
     open <menuchoice><guimenu>Network Services</guimenu> <guimenu>Network
     Services (xinetd)</guimenu></menuchoice> in &yast;, enable the network
     services configuration, select <guimenu>swat</guimenu> from the table,
     and click <guimenu>Toggle Status (On or Off)</guimenu>.
    </para>
   </note>
  </sect2>
  -->

  <sect2 id="sec.samba.serv.inst.manual" os="sles">
   <title>Configuring the Server Manually</title>
   <para>
    <indexterm>
    <primary>Samba</primary>
    <secondary>configuring</secondary>
    </indexterm> <indexterm>
    <primary>configuring</primary>
    <secondary>Samba</secondary>
    </indexterm> <indexterm>
    <primary>configuration files</primary>
    <secondary>smb.conf</secondary>
    </indexterm> If you intend to use Samba as a server, install
    <systemitem
    class="resource">samba</systemitem>. The main
    configuration file for Samba is
    <filename>/etc/samba/smb.conf</filename>. This file can be divided into
    two logical parts. The <literal>[global]</literal> section contains the
    central and global settings. The following default sections contain the
    individual file and printer shares:
   </para>
   <itemizedlist>
    <listitem>
     <para>
      [homes]
     </para>
    </listitem>
    <listitem>
     <para>
      [profiles]
     </para>
    </listitem>
    <listitem>
     <para>
      [users]
     </para>
    </listitem>
    <listitem>
     <para>
      [groups]
     </para>
    </listitem>
    <listitem>
     <para>
      [printers]
     </para>
    </listitem>
    <listitem>
     <para>
      [print$]
     </para>
    </listitem>
   </itemizedlist>
   <para>
    By means of this approach, details regarding the shares can be set
    differently or globally in the <literal>[global]</literal> section,
    which enhances the structural transparency of the configuration file.
   </para>
   <sect3 id="sec.samba.smb.conf.Erlaeuterung">
    <title>The global Section</title>
    <para>
     The following parameters of the <literal>[global]</literal> section
     need some adjustment to match the requirements of your network setup so
     other machines can access your Samba server via SMB in a Windows
     environment.
    </para>
    <remark>ke: Important entries missing?</remark>
    <variablelist>
     <varlistentry>
      <term><literal>workgroup = WORKGROUP</literal>
      </term>
      <listitem>
       <para>
        This line assigns the Samba server to a workgroup. Replace
        <literal>WORKGROUP</literal> with an appropriate workgroup of your
        networking environment. Your Samba server appears under its DNS name
        unless this name has been assigned to some other machine in the
        network. If the DNS name is not available, set the server name using
        <literal>netbiosname=<replaceable>MYNAME</replaceable></literal>.
        For more details about this parameter, see the
        <systemitem>smb.conf</systemitem> man page.
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term><literal>os level = 20</literal>
      </term>
      <listitem>
       <para>
        This parameter triggers whether your Samba server tries to become
        LMB (local master browser) for its workgroup. Choose a very low
        value such as <literal>2</literal> to spare the existing Windows
        network from any disturbances caused by a misconfigured Samba
        server. More information about this important topic can be found in
        the Network Browsing chapter of the Samba 3 Howto; for more
        information on the Samba 3 Howto, see
        <xref
        linkend="sec.samba.info" />.
       </para>
       <para>
        If no other SMB server is present in your network (such as a Windows
        2000 server) and you want the Samba server to keep a list of all
        systems present in the local environment, set the <literal>os
        level</literal> to a higher value (for example,
        <literal>65</literal>). Your Samba server is then chosen as LMB for
        your local network.
       </para>
       <para>
        When changing this setting, consider carefully how this could affect
        an existing Windows network environment. First test the changes in
        an isolated network or at a noncritical time of day.
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term><literal>wins support</literal> and <literal>wins server</literal>
      </term>
      <listitem>
       <para>
        To integrate your Samba server into an existing Windows network with
        an active WINS server, enable the <option>wins server</option>
        option and set its value to the IP address of that WINS server.
       </para>
       <para>
        If your Windows machines are connected to separate subnets and need
        to still be aware of each other, you need to set up a WINS server.
        To turn a Samba server into such a WINS server, set the option
        <literal>wins support = Yes</literal>. Make sure that only one Samba
        server of the network has this setting enabled. The options
        <literal>wins server</literal> and <literal>wins support</literal>
        must never be enabled at the same time in your
        <filename>smb.conf</filename> file.
       </para>
      </listitem>
     </varlistentry>
    </variablelist>
   </sect3>
   <sect3 id="sec.samba.smb.conf.shares">
    <title>Shares</title><indexterm>
    <primary>Samba</primary>
    <secondary>shares</secondary></indexterm>
    <para>
     The following examples illustrate how a CD-ROM drive and the user
     directories (<literal>homes</literal>) are made available to the SMB
     clients.
    </para>
    <variablelist>
     <varlistentry>
      <term>[cdrom]</term>
      <listitem>
       <para>
        To avoid having the CD-ROM drive accidentally made available, these
        lines are deactivated with comment marks (semicolons in this case).
        Remove the semicolons in the first column to share the CD-ROM drive
        with Samba.
       </para>
       <example id="dat.cd.rom">
        <title>A CD-ROM Share</title>
<screen>[cdrom]
       comment = Linux CD-ROM
       path = /media/cdrom
       locking = No</screen>
       </example>
       <variablelist>
        <varlistentry>
         <term><option>[cdrom]</option> and <option>comment</option>
         </term>
         <listitem>
          <para>
           The <literal>[cdrom]</literal> section entry is the name of the
           share that can be seen by all SMB clients on the network. An
           additional <literal>comment</literal> can be added to further
           describe the share.
          </para>
         </listitem>
        </varlistentry>
        <varlistentry>
         <term><option>path = /media/cdrom</option>
         </term>
         <listitem>
          <para>
           <option>path</option> exports the directory
           <filename>/media/cdrom</filename>.
          </para>
         </listitem>
        </varlistentry>
       </variablelist>
       <para>
        By means of a very restrictive default configuration, this kind of
        share is only made available to the users present on this system. If
        this share should be made available to everybody, add a line
        <literal>guest ok = yes</literal> to the configuration. This setting
        gives read permissions to anyone on the network. It is recommended
        to handle this parameter with great care. This applies even more to
        the use of this parameter in the <literal>[global]</literal>
        section.
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term><option>[homes]</option>
      </term>
      <listitem>
       <para>
        The <option>[homes]</option> share is of special importance here. If
        the user has a valid account and password for the Linux file server
        and his own home directory, he can be connected to it.
       </para>
       <example id="dat.homes.frei">
        <title>[homes] Share</title>
<screen>[homes]
	comment = Home Directories
	valid users = %S
	browseable = No
	read only = No
	inherit acls = Yes</screen>
       </example>
       <variablelist>
        <varlistentry>
         <term>[homes]</term>
         <listitem>
          <para>
           As long as there is no other share using the share name of the
           user connecting to the SMB server, a share is dynamically
           generated using the <literal>[homes]</literal> share directives.
           The resulting name of the share is the user name.
          </para>
         </listitem>
        </varlistentry>
        <varlistentry>
         <term><option>valid users = %S</option>
         </term>
         <listitem>
          <para>
           <literal>%S</literal> is replaced with the concrete name of the
           share as soon as a connection has been successfully established.
           For a <option>[homes]</option> share, this is always the user
           name. As a consequence, access rights to a user's share are
           restricted exclusively to that user.
          </para>
         </listitem>
        </varlistentry>
        <varlistentry>
         <term><option>browseable = No</option>
         </term>
         <listitem>
          <para>
           This setting makes the share invisible in the network
           environment.
          </para>
         </listitem>
        </varlistentry>
        <varlistentry>
         <term><option>read only = No</option>
         </term>
         <listitem>
          <para>
           By default, Samba prohibits write access to any exported share by
           means of the <literal>read only = Yes</literal> parameter. To
           make a share writable, set the value <literal>read only =
           No</literal>, which is synonymous with <literal>writable =
           Yes</literal>.
          </para>
         </listitem>
        </varlistentry>
        <varlistentry>
         <term><option>create mask = 0640</option>
         </term>
         <listitem>
          <para>
           Systems that are not based on MS Windows NT do not understand the
           concept of Unix permissions, so they cannot assign permissions
           when creating a file. The parameter <literal>create
           mask</literal> defines the access permissions assigned to newly
           created files. This only applies to writable shares. In effect,
           this setting means the owner has read and write permissions and
           the members of the owner's primary group have read permissions.
           <option>valid users = %S</option> prevents read access even if
           the group has read permissions. For the group to have read or
           write access, deactivate the line <option>valid users =
           %S</option>.
          </para>
         </listitem>
        </varlistentry>
       </variablelist>
      </listitem>
     </varlistentry>
    </variablelist>
   </sect3>
   <sect3 id="sec.samba.rechte">
    <title>Security Levels</title><indexterm id="idx.Samba_security" class="startofrange">
    <primary>Samba</primary>
    <secondary>security</secondary></indexterm><indexterm>
    <primary>security</primary>
    <secondary>Samba</secondary></indexterm><indexterm>
    <primary>Samba</primary>
    <secondary>permissions</secondary></indexterm>
    <para>
     To improve security, each share access can be protected with a
     password. SMB offers the following ways of checking permissions:
    </para>
    <variablelist>
     <varlistentry>
      <term>User Level Security (<literal>security = user</literal>)</term>
      <listitem>
       <para>
        This variant introduces the concept of the user to SMB. Each user
        must register with the server with his or her own password. After
        registration, the server can grant access to individual exported
        shares dependent on user names.
       </para>
      </listitem>
     </varlistentry>
<!-- 2014-07-28 tbazant: BNC#888522
     <varlistentry>
      <term>Server Level Security (<literal>security = server</literal>)</term>
      <listitem>
       <para>
        To its clients, Samba pretends to be working in user level mode.
        However, it passes all password queries to another user level mode
        server, which takes care of authentication. This setting requires
        the additional <option>password server</option> parameter.
       </para>
      </listitem>
     </varlistentry>
     -->
     <varlistentry>
      <term>ADS Level Security (<literal>security = ADS</literal>)</term>
      <listitem>
       <para>
        In this mode, Samba will act as a domain member in an Active
        Directory environment. To operate in this mode, the machine running
        Samba needs Kerberos installed and configured. You must join the
        machine using Samba to the ADS realm. This can be done using the
        &yast; <guimenu>Windows Domain Membership</guimenu> module.
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>Domain Level Security (<literal>security = domain</literal>)</term>
      <listitem>
       <para>
        This mode will only work correctly if the machine has been joined
        into a Windows NT Domain. Samba will try to validate user name and
        password by passing it to a Windows NT Primary or Backup Domain
        Controller. The same way as a Windows NT Server would do. It expects
        the encrypted passwords parameter to be set to
        <literal>yes</literal>.
       </para>
      </listitem>
     </varlistentry>
    </variablelist>
    <para>
     The selection of share, user, server, or domain level security applies
     to the entire server. It is not possible to offer individual shares of
     a server configuration with share level security and others with user
     level security. However, you can run a separate Samba server for each
     configured IP address on a system.
    </para>
    <para>
     More information about this subject can be found in the Samba 3 HOWTO.
     For multiple servers on one system, pay attention to the options
     <option>interfaces</option> and <option>bind interfaces only</option>.
    </para><indexterm class="endofrange"
     startref="idx.Samba_security"/>
   </sect3>
  </sect2>
 </sect1>
 <sect1 id="sec.samba.client.inst">
  <title>Configuring Clients</title><indexterm>

  <primary>Samba</primary>

  <secondary>clients</secondary></indexterm>

  <para>
   Clients can only access the Samba server via TCP/IP. NetBEUI and NetBIOS
   via IPX cannot be used with Samba.
  </para>

  <sect2 id="sec.samba.client.inst.yast">
   <title>Configuring a Samba Client with &yast;</title><indexterm>
   <primary>YaST</primary>
   <secondary>Samba</secondary>
   <tertiary>clients</tertiary></indexterm><indexterm>
   <primary>Samba</primary>
   <secondary>clients</secondary></indexterm><indexterm>
   <primary>configuring</primary>
   <secondary>Samba</secondary>
   <tertiary>clients</tertiary></indexterm>
   <para>
    Configure a Samba client to access resources (files or printers) on the
    Samba or Windows server. Enter the NT or Active Directory domain or
    workgroup in the dialog <menuchoice> <guimenu>Network Services</guimenu>
    <guimenu>Windows Domain Membership</guimenu></menuchoice>. If you
    activate <guimenu>Also Use SMB Information for Linux
    Authentication</guimenu>, the user authentication runs over the Samba,
    NT or Kerberos server.
   </para>
   <para>
    Click <guimenu>Expert Settings</guimenu> for advanced configuration
    options. For example, use the <guimenu>Mount Server
    Directories</guimenu> table to enable mounting server home directory
    automatically with authentication. This way users will be able to access
    their home directories when hosted on CIFS. For details, see the
    <systemitem>pam_mount</systemitem> man page.
   </para>
   <para>
    After completing all settings, confirm the dialog to finish the
    configuration.
   </para>
  </sect2>
 </sect1>
 <sect1 id="sec.samba.anmeld.serv">
  <title>Samba as Login Server</title><indexterm>

  <primary>Samba</primary>

  <secondary>login</secondary></indexterm>

  <para>
   In networks where predominantly Windows clients are found, it is often
   preferable that users may only register with a valid account and
   password. In a Windows-based network, this task is handled by a primary
   domain controller (PDC). You can use a Windows NT server configured as
   PDC, but this task can also be done with a Samba server. The entries that
   must be made in the <literal>[global]</literal> section of
   <filename>smb.conf</filename> are shown in
   <xref linkend="dat.samba.smb.conf.dom"/>.
  </para>

  <example id="dat.samba.smb.conf.dom">
   <title>Global Section in smb.conf</title>
<screen>[global]
    workgroup = WORKGROUP
    domain logons = Yes
    domain master = Yes</screen>
  </example>

  <para>
   It is necessary to prepare user accounts and passwords in an encryption
   format that conforms with Windows. Do this with the command
   <command>smbpasswd <option>-a name</option></command>. Create the domain
   account for the computers, required by the Windows domain concept, with
   the following commands:
  </para>

<screen>useradd hostname\$
smbpasswd -a -m hostname</screen><indexterm>

  <primary>commands</primary>

  <secondary>smbpasswd</secondary></indexterm>

  <para>
   With the <command>useradd</command> command, a dollar sign is added. The
   command <command>smbpasswd</command> inserts this automatically when the
   parameter <option>-m</option> is used. The commented configuration
   example
   (<filename>/usr/share/doc/packages/samba/examples/smb.conf.SUSE</filename>)
   contains settings that automate this task.
  </para>

<screen>add machine script = /usr/sbin/useradd -g nogroup -c "NT Machine Account" \
-s /bin/false %m\$
     </screen>

  <para>
   To make sure that Samba can execute this script correctly, choose a Samba
   user with the required administrator permissions and add it to the
   <systemitem class="groupname">ntadmin</systemitem> group. Then all users
   belonging to this Linux group can be assigned <literal>Domain
   Admin</literal> status with the command:
  </para>

<screen>net groupmap add ntgroup="Domain Admins" unixgroup=ntadmin</screen>
 </sect1>
 <sect1 id="sec.samba.adnet" os="sles">
  <title>Samba Server in the Network with Active Directory</title>

  <para>
   If you run Linux servers and Windows servers together, you can build two
   independent authentication systems and networks or connect servers to one
   network with one central authentication system. Because Samba can
   cooperate with an active directory domain, you can join your &sls; to
   Active Directory (AD).
  </para>

  <para>
   To join an AD domain proceed as follows:
  </para>

  <procedure>
   <step>
    <para>
     Log in as &rootuser; and start &yast;.
    </para>
   </step>
   <step>
    <para>
     Start <menuchoice> <guimenu>Network Services</guimenu> <guimenu>Windows
     Domain Membership</guimenu> </menuchoice>.
    </para>
   </step>
   <step>
    <para>
     Enter the domain to join at <guimenu>Domain or Workgroup</guimenu> in
     the <guimenu>Windows Domain Membership</guimenu> screen.
    </para>
    <figure>
     <title>Determining Windows Domain Membership</title>
     <mediaobject>
      <imageobject role="fo">
       <imagedata fileref="ad_sambaclient.png" width="75%" format="PNG"/>
      </imageobject>
      <imageobject role="html">
       <imagedata fileref="ad_sambaclient.png" width="75%" format="PNG"/>
      </imageobject>
     </mediaobject>
    </figure>
   </step>
   <step>
    <para>
     Check <guimenu>Also Use SMB Information for Linux
     Authentication</guimenu> to use the SMB source for Linux authentication
     on your &sls;.
    </para>
   </step>
   <step>
    <para>
     Click <guimenu>OK</guimenu> and confirm the domain join when prompted
     for it.
    </para>
   </step>
   <step>
    <para>
     Provide the password for the Windows Administrator on the AD server and
     click <guimenu>OK</guimenu>.
    </para>
<!--
    <figure>
     <title>Providing Administrator Credentials</title>
     <mediaobject>
      <imageobject role="fo">
       <imagedata fileref="ad_join1.png" width="30%" format="PNG"/>
      </imageobject>
      <imageobject role="html">
       <imagedata fileref="ad_join1.png" width="30%" format="PNG"/>
      </imageobject>
     </mediaobject>
    </figure>
    -->
    <para>
     Your server is now set up to pull in all authentication data from the
     Active Directory domain controller.
    </para>
   </step>
  </procedure>
 </sect1>
 <sect1 id="samba.advanced">
  <title>Advanced Topics</title>

  <para>
   This section introduces more advanced techniques to manage both the
   client and server part of the Samba suite.
  </para>

  <sect2 id="samba.advanced.compress">
   <title>Transparent File Compression on Btrfs</title>
   <para>
    Samba allows clients to remotely manipulate file and directory
    compression flags for shares placed on the Btrfs file system. Windows
    Explorer provides the ability to flag files/directories for transparent
    compression via the
    <menuchoice><guimenu>File</guimenu><guimenu>Properties</guimenu><guimenu>Advanced</guimenu></menuchoice>
    dialog:
   </para>
   <figure>
    <title>Windows Explorer <guimenu>Advanced Attributes</guimenu> Dialog</title>
    <mediaobject>
     <imageobject role="fo">
      <imagedata fileref="samba_win_expl_advattr.png" width="30%" format="PNG"/>
     </imageobject>
     <imageobject role="html">
      <imagedata fileref="samba_win_expl_advattr.png" width="30%" format="PNG"/>
     </imageobject>
    </mediaobject>
   </figure>
   <para>
    Files flagged for compression are transparently compressed and
    decompressed by the underlying file system when accessed or modified.
    This normally results in storage capacity savings at the expense of
    extra CPU overhead when accessing the file. New files and directories
    inherit the compression flag from the parent directory, unless created
    with the FILE_NO_COMPRESSION option.
   </para>
   <para>
    Windows Explorer presents compressed files and directories visually
    differently to those that are not compressed:
   </para>
   <figure>
    <title>Windows Explorer Directory Listing with Compressed Files</title>
    <mediaobject>
     <imageobject role="fo">
      <imagedata fileref="samba_win_expl_view_compressed.png" width="30%" format="PNG"/>
     </imageobject>
     <imageobject role="html">
      <imagedata fileref="samba_win_expl_view_compressed.png" width="30%" format="PNG"/>
     </imageobject>
    </mediaobject>
   </figure>
   <para>
    You can enable Samba share compression either manually by adding
   </para>
<screen>vfs objects = btrfs</screen>
   <para>
    to the share configuration in <filename>/etc/samba/smb.conf</filename>,
    or using &yast;: <menuchoice><guimenu>Network
    Services</guimenu><guimenu>Samba
    Server</guimenu><guimenu>Add</guimenu></menuchoice>, and checking
    <guimenu>Utilize Btrfs Features</guimenu>.
   </para>
  </sect2>

  <sect2 id="samba.advanced.snapshots">
   <title>Snapshots</title>
   <para>
    Snapshots, also referred to as Shadow Copies, are copies of the state of
    a file system subvolume at a certain point of time. Snapper is the tool
    to manage these snapshots in Linux. Snapshots are supported on the Btrfs
    file system or thin-provisioned LVM volumes. The Samba suite supports
    managing of remote snapshots through the FSRVP protocol on both the
    server and client side.
   </para>
   <sect3 id="samba.advanced.snapshots.client">
    <title>Previous Versions</title>
    <para>
     Snapshots on a Samba server can be exposed to remote Windows clients as
     file or directory previous versions.
    </para>
    <para>
     To enable snapshots on a Samba server, the following conditions must be
     fulfilled:
    </para>
    <itemizedlist>
     <listitem>
      <para>
       The SMB network share resides on a Btrfs subvolume.
      </para>
     </listitem>
     <listitem>
      <para>
       The SMB network share path has a related snapper configuration file.
       You can create the snapper file with
      </para>
<screen>snapper -c &lt;cfg_name&gt; create-config <option>/path/to/share</option></screen>
      <para>
       For more information on snapper, see <xref linkend="cha.snapper"/>.
      </para>
     </listitem>
     <listitem>
      <para>
       The snapshot directory tree must allow access for relevant users. For
       more information, see the PERMISSIONS section of the vfs_snapper
       manual page (<command>man 8 vfs_snapper</command>).
      </para>
     </listitem>
    </itemizedlist>
    <para>
     To support remote snapshots, you need to modify the
     <filename>/etc/samba/smb.conf</filename> file. You can do it either
     with <menuchoice><guimenu>&yast;</guimenu><guimenu>Network
     Services</guimenu><guimenu>Samba Server</guimenu></menuchoice>, or
     manually by enhancing the relevant share section with
    </para>
<screen>vfs objects = snapper</screen>
    <para>
     Note that you need to restart the Samba service for manual
     <filename>smb.conf</filename> changes to take effect:
    </para>
<screen>systemctl restart nmb.service smb.service</screen>
    <figure id="fig.yast2.samba.snapshot">
     <title>Adding a New Samba Share with Snapshotting Enabled</title>
     <mediaobject>
      <imageobject role="fo">
       <imagedata fileref="yast2_samba_snapshot.png" width="70%" format="PNG"/>
      </imageobject>
      <imageobject role="html">
       <imagedata fileref="yast2_samba_snapshot.png" width="75%" format="PNG"/>
      </imageobject>
     </mediaobject>
    </figure>
    <para>
     After being configured, snapshots created by snapper for the Samba
     share path can be accessed from Windows Explorer from a file or
     directory's <guimenu>Previous Versions</guimenu> tab.
    </para>
    <figure id="fig.samba.win_explorer">
     <title>The <guimenu>Previous Versions</guimenu> tab in Windows Explorer</title>
     <mediaobject>
      <imageobject role="fo">
       <imagedata fileref="samba_winexpl_previous_versions.png" width="70%" format="PNG"/>
      </imageobject>
      <imageobject role="html">
       <imagedata fileref="samba_winexpl_previous_versions.png" width="75%" format="PNG"/>
      </imageobject>
     </mediaobject>
    </figure>
   </sect3>
   <sect3 id="samba.advanced.snapshots.server">
    <title>Remote Share Snapshots</title>
    <para>
     By default, snapshots can only be created and deleted on the Samba
     server locally, via the snapper command line utility, or using
     snapper's time line feature.
    </para>
    <para>
     Samba can be configured to process share snapshot creation and deletion
     requests from remote hosts using the File Server Remote VSS Protocol
     (FSRVP).
    </para>
    <para>
     In addition to the configuration and prerequisites documented in
     <xref linkend="samba.advanced.snapshots.client"/>, the following global
     configuration is required in <filename>/etc/samba/smb.conf</filename>:
    </para>
<screen>[global]
rpc_daemon:fssd = fork
registry shares = yes
include = registry</screen>
    <para>
     FSRVP clients, including Samba's <command>rpcclient</command> and
     Windows Server 2012 <command>DiskShadow.exe</command>, can then
     instruct Samba to create or delete a snapshot for a given share, and
     expose the snapshot as a new share.
    </para>
   </sect3>
   <sect3 id="samba.advanced.snapshots.client.linux">
    <title>Managing Snapshots Remotely from Linux with <command>rpcclient</command></title>
    <para>
     The <systemitem>samba-client</systemitem> package contains an FSRVP
     client that can remotely request a Windows/Samba server to create and
     expose a snapshot of a given share. You can then use existing tools in
     &sls; to mount the exposed share and back up its files. Requests to the
     server are sent using the <command>rpcclient</command> binary.
    </para>
    <example>
     <title>Using <command>rpcclient</command> to Request a Windows Server 2012 Share Snapshot</title>
     <para>
      Connect to <literal>win-server.example.com</literal> server as an
      administrator in an <literal>EXAMPLE</literal> domain:
     </para>
<screen># rpcclient -U '<replaceable>EXAMPLE</replaceable>\Administrator' ncacn_np:<replaceable>win-server.example.com</replaceable>[ndr64,sign]
Enter EXAMPLE/Administrator's password:</screen>
     <para>
      Check that the SMB share is visible for <command>rpcclient</command>:
     </para>
<screen>rpcclient $> netshareenum
netname: windows_server_2012_share
remark: 
path:   C:\Shares\windows_server_2012_share
password:       (null)</screen>
     <para>
      Check that the SMB share supports snapshot creation:
     </para>
<screen>rpcclient $> fss_is_path_sup windows_server_2012_share \
UNC \\WIN-SERVER\windows_server_2012_share\ supports shadow copy requests</screen>
     <para>
      Request the creation of a share snapshot:
     </para>
<screen>rpcclient $> fss_create_expose backup ro windows_server_2012_share
13fe880e-e232-493d-87e9-402f21019fb6: shadow-copy set created
13fe880e-e232-493d-87e9-402f21019fb6(1c26544e-8251-445f-be89-d1e0a3938777): \
\\WIN-SERVER\windows_server_2012_share\ shadow-copy added to set
13fe880e-e232-493d-87e9-402f21019fb6: prepare completed in 0 secs
13fe880e-e232-493d-87e9-402f21019fb6: commit completed in 1 secs
13fe880e-e232-493d-87e9-402f21019fb6(1c26544e-8251-445f-be89-d1e0a3938777): \
share windows_server_2012_share@{1C26544E-8251-445F-BE89-D1E0A3938777} \
exposed as a snapshot of \\WIN-SERVER\windows_server_2012_share\</screen>
     <para>
      Confirm that the snapshot share is exposed by the server:
     </para>
<screen>rpcclient $> netshareenum
netname: windows_server_2012_share
remark: 
path:   C:\Shares\windows_server_2012_share
password:       (null)

netname: windows_server_2012_share@{1C26544E-8251-445F-BE89-D1E0A3938777}
remark: (null)
path:   \\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy{F6E6507E-F537-11E3-9404-B8AC6F927453}\Shares\windows_server_2012_share\
password:       (null)</screen>
     <para>
      Attempt to delete the snapshot share:
     </para>
<screen>rpcclient $> fss_delete windows_server_2012_share \
13fe880e-e232-493d-87e9-402f21019fb6 1c26544e-8251-445f-be89-d1e0a3938777
13fe880e-e232-493d-87e9-402f21019fb6(1c26544e-8251-445f-be89-d1e0a3938777): \
\\WIN-SERVER\windows_server_2012_share\ shadow-copy deleted</screen>
     <para>
      Confirm that the snapshot share has been removed by the server:
     </para>
<screen>rpcclient $> netshareenum
netname: windows_server_2012_share
remark: 
path:   C:\Shares\windows_server_2012_share
password:       (null)</screen>
    </example>
   </sect3>
   <sect3 id="samba.advanced.snapshots.client.winserver">
    <title>Managing Snapshots Remotely from Windows with <command>DiskShadow.exe</command></title>
    <para>
     You can manage snapshots of SMB shares on the Linux Samba server from
     the Windows environment acting as a client as well. Windows Server 2012
     includes the <command>DiskShadow.exe</command> utility that can manage
     remote shares similar to the <command>rpcclient</command> described in
     <xref linkend="samba.advanced.snapshots.client.linux"/>. Note that you
     need to carefully set up the Samba server first.
    </para>
    <para>
     Following is an example procedure to set up the Samba server so that
     the Windows Server client can manage its share's snapshots. Note that
     EXAMPLE is the Active Directory domain used in the testing environment,
     fsrvp-server.example.com is the host name of the Samba server, and
     <filename>/srv/smb</filename> is the path to the SMB share.
    </para>
    <procedure>
     <title>Detailed Samba Server Configuration</title>
     <step>
      <para>
       Join Active Directory domain via &yast;.<phrase os="sles"> For more
       information, <xref linkend="sec.samba.adnet"/>.</phrase>
      </para>
     </step>
     <step>
      <para>
       Ensure that the Active Domain DNS entry was correct:
      </para>
<screen>fsrvp-server:~ # net -U 'Administrator' ads dns register \
fsrvp-server.example.com &lt;IP address>
Successfully registered hostname with DNS</screen>
     </step>
     <step>
      <para>
       Create Btrfs subvolume at <filename>/srv/smb</filename>
      </para>
<screen>fsrvp-server:~ # btrfs subvolume create /srv/smb</screen>
     </step>
     <step>
      <para>
       Create snapper configuration file for path
       <filename>/srv/smb</filename>
      </para>
<screen>fsrvp-server:~ # snapper -c &lt;snapper_config> create-config /srv/smb</screen>
     </step>
     <step>
      <para>
       Create new share with path <filename>/srv/smb</filename>, and &yast;
       <guimenu>Expose Snapshots</guimenu> checkbox enabled. Make sure to
       add the following snippets to the global section of
       <filename>/etc/samba/smb.conf</filename> as mentioned in
       <xref
         linkend="samba.advanced.snapshots.server"/>:
      </para>
<screen>[global]
 rpc_daemon:fssd = fork
 registry shares = yes
 include = registry</screen>
     </step>
     <step>
      <para>
       Restart Samba with <command>systemctl restart nmb.service
       smb.service</command>
      </para>
     </step>
     <step>
      <para>
       Configure snapper permissions:
      </para>
<screen>fsrvp-server:~ # snapper -c &lt;snapper_config> set-config \
ALLOW_USERS="EXAMPLE\\\\Administrator EXAMPLE\\\\win-client$"</screen>
      <para>
       Ensure that any ALLOW_USERS are also permitted traversal of the
       <filename>.snapshots</filename> subdirectory.
      </para>
<screen>fsrvp-server:~ # snapper -c &lt;snapper_config> set-config SYNC_ACL=yes</screen>
      <important>
       <title>Path Escaping</title>
       <para>
        Be careful about the '\' escapes! Escape twice to ensure that the
        value stored in
        <filename>/etc/snapper/configs/&lt;snapper_config></filename> is
        escaped once.
       </para>
      </important>
      <para>
       "EXAMPLE\win-client$" corresponds to the Windows client computer
       account. Windows issues initial FSRVP requests while authenticated
       with this account.
      </para>
     </step>
     <step>
      <para>
       Grant Windows client account necessary privileges:
      </para>
<screen>fsrvp-server:~ # net -U 'Administrator' rpc rights grant \
"EXAMPLE\\win-client$" SeBackupPrivilege
Successfully granted rights.</screen>
      <para>
       The previous command is not needed for the "EXAMPLE\Administrator"
       user, which has privileges already granted.
      </para>
     </step>
    </procedure>
    <procedure>
     <title>Windows Client Setup and <command>DiskShadow.exe</command> in Action</title>
     <step>
      <para>
       Boot Windows Server 2012 (example host name WIN-CLIENT).
      </para>
     </step>
     <step>
      <para>
       Join the same Active Directory domain EXAMPLE as with the &sle;
       server.
      </para>
     </step>
     <step>
      <para>
       Reboot.
      </para>
     </step>
     <step>
      <para>
       Open Powershell.
      </para>
     </step>
     <step>
      <para>
       Start <command>DiskShadow.exe</command> and begin the backup
       procedure:
      </para>
<screen>PS C:\Users\Administrator.EXAMPLE> diskshadow.exe
Microsoft DiskShadow version 1.0
Copyright (C) 2012 Microsoft Corporation
On computer:  WIN-CLIENT,  6/17/2014 3:53:54 PM

DISKSHADOW> begin backup</screen>
     </step>
     <step>
      <para>
       Specify that shadow copy persists across program exit, reset or
       reboot:
      </para>
<screen>DISKSHADOW> set context PERSISTENT</screen>
     </step>
     <step>
      <para>
       Check whether the specified share supports snapshots, and create one:
      </para>
<screen>DISKSHADOW> add volume \\fsrvp-server\sles_snapper

DISKSHADOW> create
Alias VSS_SHADOW_1 for shadow ID {de4ddca4-4978-4805-8776-cdf82d190a4a} set as \
 environment variable.
Alias VSS_SHADOW_SET for shadow set ID {c58e1452-c554-400e-a266-d11d5c837cb1} \
 set as environment variable.

Querying all shadow copies with the shadow copy set ID \
 {c58e1452-c554-400e-a266-d11d5c837cb1}

 * Shadow copy ID = {de4ddca4-4978-4805-8776-cdf82d190a4a}     %VSS_SHADOW_1%
    - Shadow copy set: {c58e1452-c554-400e-a266-d11d5c837cb1}  %VSS_SHADOW_SET%
    - Original count of shadow copies = 1
    - Original volume name: \\FSRVP-SERVER\SLES_SNAPPER\ \
      [volume not on this machine]
    - Creation time: 6/17/2014 3:54:43 PM
    - Shadow copy device name: 
      \\FSRVP-SERVER\SLES_SNAPPER@{31afd84a-44a7-41be-b9b0-751898756faa}
    - Originating machine: FSRVP-SERVER
    - Service machine: win-client.example.com
    - Not exposed
    - Provider ID: {89300202-3cec-4981-9171-19f59559e0f2}
    - Attributes:  No_Auto_Release Persistent FileShare

Number of shadow copies listed: 1</screen>
     </step>
     <step>
      <para>
       Finish the backup procedure:
      </para>
<screen>DISKSHADOW> end backup</screen>
     </step>
     <step>
      <para>
       After the snapshot was created, try to delete it and verify the
       deletion:
      </para>
<screen>DISKSHADOW> delete shadows volume \\FSRVP-SERVER\SLES_SNAPPER\
Deleting shadow copy {de4ddca4-4978-4805-8776-cdf82d190a4a} on volume \
 \\FSRVP-SERVER\SLES_SNAPPER\ from provider \
{89300202-3cec-4981-9171-19f59559e0f2} [Attributes: 0x04000009]...

Number of shadow copies deleted: 1

DISKSHADOW> list shadows all

Querying all shadow copies on the computer ...
No shadow copies found in system.</screen>
     </step>
    </procedure>
   </sect3>
  </sect2>
 </sect1>
 <sect1 id="sec.samba.info">
  <title>For More Information</title>

  <para>
   Documentation for Samba ships with the <systemitem>samba-doc</systemitem>
   package which is not installed by default. Install it with
   <command>zypper install samba-doc</command>. Enter
   <command>apropos</command> <option>samba</option> at the command line to
   display some manual pages or browse the
   <filename>/usr/share/doc/packages/samba</filename> directory for more
   online documentation and examples. Find a commented example configuration
   (<filename>smb.conf.SUSE</filename>) in the <filename>examples</filename>
   subdirectory. Another file to look for Samba related information is
   <filename>/usr/share/doc/packages/samba/README.SUSE</filename>.
   <indexterm>
   <primary>configuration files</primary>
   <secondary>smb.conf</secondary>
   </indexterm>
  </para>

  <para>
   The Samba HOWTO (see <ulink
   url="https://wiki.samba.org"/>) provided
   by the Samba team includes a section about troubleshooting. In addition
   to that, Part V of the document provides a step-by-step guide to checking
   your configuration.
  </para><indexterm class="endofrange" startref="idx.Samba"/>
 </sect1>
</chapter>
