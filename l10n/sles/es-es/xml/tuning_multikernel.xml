<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="tuning_multikernel.xml" version="5.0" xml:id="cha-tuning-multikernel">
 <title>Instalación de varias versiones del núcleo</title>
 <info>
  <abstract>
   <para>
    <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> admite la instalación en paralelo de varias versiones del núcleo. Al instalar un segundo núcleo, se crean automáticamente una entrada de arranque y un initrd, por lo que no es necesaria realizar más configuración manual. Al rearrancar el equipo, el núcleo recién añadido estará disponible como parámetro de arranque adicional.
   </para>

   <para>
    Mediante esta función, es posible probar con seguridad las actualizaciones del núcleo y volver en cualquier momento al núcleo anterior. Para ello, no utilice las herramientas de actualización (como YaST Online Update o el applet de actualización), sino que debe seguir el proceso descrito en este capítulo.
   </para>
  </abstract>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:bugtracker/>
   <dm:translation>sí</dm:translation>
  </dm:docmanager>
 </info>
 <warning os="sles;sled">

  <title>derecho de asistencia técnica</title>
  <para>
   Tenga en cuenta que perderá todo el derecho de asistencia técnica para el equipo al instalar un núcleo autocompilado o de otros fabricantes. Solo se admiten los núcleos incluidos con <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> y los núcleos proporcionados a través de los canales de actualización oficiales para <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase>.
  </para>
 </warning>
 <tip>
  <title>compruebe el núcleo de configuración del cargador de arranque</title>
  <para>
   Se recomienda comprobar la configuración del cargador de arranque después de instalar otro núcleo a fin de establecer la entrada de arranque por defecto deseada. Consulte la <xref linkend="sec-grub2-yast2-config"/> para obtener más información. 
  </para>
 </tip>
 <sect1 xml:id="sec-tuning-multikernel-enable">
  <title>Habilitación y configuración de la compatibilidad multiversión</title>



  <para>
   La instalación de varias versiones de un paquete de software (compatibilidad multiversión) está habilitada por defecto desde <phrase os="sles;sled">SUSE Linux Enterprise Server 12.</phrase> Para verificar este valor, realice este procedimiento:
  </para>

  <procedure>
   <step>
    <para>
     Abra <filename>/etc/zypp/zypp.conf</filename> con el editor que desee como usuario <systemitem class="username">root</systemitem>.
    </para>
   </step>
   <step>
    <para>
     Busque la cadena <literal>multiversion</literal>. Si la multiversión está habilitada para todos los paquetes de núcleo compatibles con esta función, se muestra la siguiente línea sin marcas de comentario:
    </para>
<screen>multiversion = provides:multiversion(kernel)</screen>
   </step>
   <step>
    <para>
     Para restringir la compatibilidad multiversión a versiones concretas del núcleo, añada los nombres de paquetes en forma de lista separada por comas a la opción <literal>multiversion</literal> de <filename>/etc/zypp/zypp.conf</filename>; por ejemplo:
    </para>
<screen>multiversion = kernel-default,kernel-default-base,kernel-source
</screen>
   </step>
   <step>
    <para>
     Guarde los cambios.
    </para>
   </step>
  </procedure>

  <warning>
   <title>paquetes de módulo de núcleo (KMP)</title>
   <para>
    Asegúrese de que los módulos de núcleo necesarios proporcionados por el proveedor (los paquetes de módulo de núcleo) también están instalados para el nuevo núcleo actualizado. El proceso de actualización del núcleo no advierte sobre si faltan módulos del núcleo, ya que el núcleo anterior que permanece en el sistema sigue cumpliendo los requisitos del paquete.
   </para>
  </warning>

  <sect2 xml:id="sec-tuning-multikernel-enable-keep">
   <title>Supresión automática de núcleos no utilizados</title>
   <para>
    Si se prueban con frecuencia nuevos núcleos con la compatibilidad multiversión habilitada, el menú de arranque no tarda en empezar a confundirse. Dado que la partición <filename>/boot</filename> suele disponer de espacio limitado, también puede haber problemas de desbordamiento de <filename>/boot</filename>. Aunque puede suprimir versiones no utilizadas del núcleo de forma manual con YaST o Zypper (tal como se describe más abajo), también es posible configurar <systemitem class="library">libzypp</systemitem> para suprimir de forma automática núcleos que ya no se usen. Por defecto, no se suprime ningún núcleo.
   </para>
   <procedure>
    <step>
     <para>
      Abra <filename>/etc/zypp/zypp.conf</filename> con el editor que desee como usuario <systemitem class="username">root</systemitem>.
     </para>
    </step>
    <step>
     <para>
      Busque la cadena <literal>multiversion.kernels</literal> y active esta opción quitando la marca de comentario de la línea. Esta opción recibe una lista separada por comas de los siguientes valores:
     </para>
     <formalpara>
      <title><literal><replaceable>5.3.18-53.3</replaceable></literal>:</title>
      <para>
       conserva el núcleo con el número de versión especificado.
      </para>
     </formalpara>
     <formalpara>
      <title><literal>latest</literal>:</title>
      <para>
       conserva el núcleo con el número de versión más alto.
      </para>
     </formalpara>
     <formalpara>
      <title><literal>latest-N</literal>:</title>
      <para>
       conserva el núcleo con el enésimo (N) número de versión más alto.
      </para>
     </formalpara>
     <formalpara>
      <title><literal>running</literal>:</title>
      <para>
       conserva el núcleo en ejecución.
      </para>
     </formalpara>
     <formalpara>
      <title><literal>oldest</literal>:</title>
      <para>
       conserva el núcleo con el número de versión más bajo (el que se incluía de forma original con <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase>).
      </para>
     </formalpara>
     <formalpara>
      <title><literal>oldest+N</literal></title>
      <para>
       conserva el núcleo con el enésimo (N) número de versión más bajo.
      </para>
     </formalpara>
     <para>
      A continuación, ofreceremos algunos ejemplos
     </para>
     <variablelist>
      <varlistentry>
       <term><literal>multiversion.kernels = latest,running</literal>
       </term>
       <listitem>
        <para>
         Conserva el núcleo más reciente y el que se está ejecutando actualmente. Es similar a no habilitar la función de multiversión, excepto en que el núcleo antiguo se elimina <emphasis>después del próximo rearranque</emphasis> y no inmediatamente después de la instalación.
        </para>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term><literal>multiversion.kernels = latest,latest-1,running </literal>
       </term>
       <listitem>
        <para>
         Conserva los dos núcleos más recientes y el que se está ejecutando actualmente.
        </para>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term><literal>multiversion.kernels = latest,running,<replaceable>5.3.18-53.3 </replaceable></literal>
       </term>
       <listitem>
        <para>
         Conserva el núcleo más reciente, el que se está ejecutando y la versión <replaceable>5.3.18-53.3</replaceable>.
        </para>
       </listitem>
      </varlistentry>
     </variablelist>
     <tip>
      <title>conserva el núcleo en ejecución.</title>
      <para>
       A no ser que utilice una configuración especial, conserve siempre el núcleo marcado como <literal>running</literal> (en ejecución).
      </para>
      <para>
       Si no conserva el núcleo en ejecución, se suprimirá cuando se actualice el núcleo. Eso significa que todos los módulos del núcleo en ejecución también se suprimen y no es posible volver a cargarlos.
      </para>
      <para>
       Si decide no conservar el núcleo en ejecución, reinicie siempre inmediatamente después de una actualización del núcleo para evitar problemas con los módulos.
      </para>
     </tip>
    </step>
   </procedure>
  </sect2>
  <sect2 xml:id="sec-tuning-multikernel-deleteoldkernel">
   <title>Caso de uso: supresión de un núcleo anterior solo después de rearrancar</title>
   <para>
    Quiere asegurarse de que un núcleo antiguo solo se suprimirá después de que el sistema se haya arrancado correctamente con el núcleo nuevo.
   </para>
   <para>
    Cambie la línea siguiente en <filename>/etc/zypp/zypp.conf</filename>:
   </para>
<screen>multiversion.kernels = latest,running</screen>
   <para>
    Los parámetros anteriores indican al sistema que conserve el núcleo más reciente y el que se está ejecutando solo si son distintos.
   </para>
  </sect2>

  <sect2 xml:id="sec-tuning-multikernel-fallback">
   <title>Caso de uso: conservación de núcleos anteriores como medida de recuperación</title>
   <para>
    Desea conservar uno o varios núcleos para disponer de uno o varios núcleos <quote>de repuesto</quote>.
   </para>
   <para>
    Esto puede ser útil si necesita núcleos para realizar pruebas. Si algo va mal, por ejemplo, si el equipo no arranca, podrá seguir usando una o varias versiones del núcleo que se sabe que funcionan.
   </para>
   <para>
    Cambie la línea siguiente en <filename>/etc/zypp/zypp.conf</filename>:
   </para>
<screen>multiversion.kernels = latest,latest-1,latest-2,running</screen>
   <para>
    Cuando se rearranque el sistema después de la instalación de un núcleo nuevo, el sistema conservará tres núcleos: el actual (configurado como <literal>latest,running</literal>) y sus dos predecesores inmediatos (configurados como <literal>latest-1</literal> y <literal>latest-2</literal>).
   </para>
  </sect2>

  <sect2 xml:id="sec-tuning-multikernel-specificversion">
   <title>Caso de uso: conservación de una versión específica del núcleo</title>
   <para>
    Realiza actualizaciones habituales del sistema e instala nuevas versiones del núcleo. Sin embargo, también compila su propia versión del núcleo y desea asegurarse de que el sistema lo conservará.
   </para>
   <para>
    Cambie la línea siguiente en <filename>/etc/zypp/zypp.conf</filename>:
   </para>
<screen>multiversion.kernels = latest,5.3.18-53.3,running</screen>
   <para>
    Cuando se rearranca el sistema después de la instalación de un núcleo nuevo, el sistema conservará dos núcleos: el nuevo y el que se está ejecutando (configurados como <literal>latest,running</literal>) y el núcleo que ha compilado (configurado como <literal>5.3.18-53.3</literal>).
   </para>
  </sect2>
 </sect1>
 <sect1 xml:id="sec-tuning-multikernel-yast">
  <title>Instalación y eliminación de varias versiones del núcleo con YaST</title>
  <para>
   Puede instalar o eliminar varios núcleos con YaST:
  </para>
  <procedure>
   <step>
    <para>
     Inicie YaST y abra el gestor de software con la opción <menuchoice>
     <guimenu>Software</guimenu> <guimenu>Gestión de software</guimenu>
     </menuchoice>.
    </para>
   </step>
   <step>
    <para>
     Muestre todos los paquetes que admiten varias versiones. Para ello, seleccione <menuchoice> <guimenu>Ver</guimenu> <guimenu>Grupos de paquetes</guimenu>
     <guimenu>Paquetes multiversión</guimenu> </menuchoice>.
    </para>
    <figure>
     <title>gestor de software de YaST, vista multiversión</title>
     <mediaobject>
      <imageobject role="fo">
       <imagedata fileref="yast2_sw_multiversion.png" width="90%" format="PNG"/>
      </imageobject>
      <imageobject role="html">
       <imagedata fileref="yast2_sw_multiversion.png" width="90%" format="PNG"/>
      </imageobject>
     </mediaobject>
    </figure>
   </step>
   <step>
    <para>
     Seleccione un paquete y abra su pestaña <guimenu>Versión</guimenu> en el panel de abajo a la izquierda.
    </para>
   </step>
   <step>
    <para>
     Para instalar un paquete, haga clic en la casilla de verificación junto a él. Una marca de verificación verde indica que está seleccionado para instalarse.
    </para>
    <para>
     Para eliminar un paquete ya instalado (marcado con una marca de verificación blanca), haga clic en su casilla de verificación hasta que aparezca una <literal>X</literal> roja que indica que se ha seleccionado para eliminarse.
    </para>
   </step>
   <step>
    <para>
     Haga clic en <guimenu>Aceptar</guimenu> para iniciar la instalación.
    </para>
   </step>
  </procedure>
 </sect1>
 <sect1 xml:id="sec-tuning-multikernel-zypper">
  <title>Instalación y eliminación de varias versiones del núcleo con Zypper</title>
  <para>
   Puede instalar y eliminar varios núcleos con <command>zypper</command>:
  </para>
  <procedure>
   <step>
    <para>
     Use el comando <command>zypper se -s 'kernel*'</command> para mostrar una lista de todos los paquetes de núcleos disponibles:
    </para>
<screen><?dbsuse-fo font-size="7pt"?>


S  | Name                 | Type    | Version           | Arch   | Repository
---+----------------------+---------+-------------------+--------+---------------------------------
i+ | kernel-default       | package | 5.3.18-53.3       | x86_64 | (System Packages)
i+ | kernel-default       | package | 5.3.18-54.2       | x86_64 | SLE-Module-Basesystem15-SP3-Pool
   | kernel-default-base  | package | 5.3.18-54.2.16.15 | x86_64 | SLE-Module-Basesystem15-SP3-Pool
   | kernel-default-devel | package | 5.3.18-54.2       | x86_64 | SLE-Module-Basesystem15-SP3-Pool
   | kernel-devel         | package | 5.3.18-54.2       | noarch | SLE-Module-Basesystem15-SP3-Pool
i  | kernel-firmware      | package | 20210208-2.4      | noarch | SLE-Module-Basesystem15-SP3-Pool
   | kernel-macros        | package | 5.3.18-54.2       | noarch | SLE-Module-Basesystem15-SP3-Pool
   | kernel-preempt       | package | 5.3.18-54.2       | x86_64 | SLE-Module-Basesystem15-SP3-Pool
</screen>
   </step>
   <step>
    <para>
     Especifique la versión exacta durante la instalación:
    </para>
<screen><prompt>tux &gt; </prompt><command>sudo</command> zypper in kernel-default-5.3.18-53.3</screen>
   </step>
   <step>
    <para>
     Para desinstalar un núcleo, use los comandos <command>zypper se -si 'kernel*'</command> para mostrar todos los núcleos instalados y <command>zypper rm</command> <replaceable> NOMBREPAQUETE-VERSIÓN</replaceable> para eliminar el paquete.
    </para>
   </step>
  </procedure>
 </sect1>
 
</chapter>
