<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="adm_wbem.xml" version="5.0" xml:id="cha.wbem">
 <title>透過 SFCB 實作的網路企業管理</title>
 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:bugtracker/>
   <dm:translation>yes</dm:translation>
  </dm:docmanager>
 </info>
 <para/>
 <sect1 xml:id="sec.wbem.intro">
  <title>簡介與基本概念</title>

  <para>
   SUSE® Linux Enterprise Server (SLES) 提供一系列基於開放式標準的工具，用於統一管理不同的計算系統和環境。我們的企業解決方案執行 Distributed Management Task Force 所建議的標準。以下段落將介紹其基本元件。
  </para>

  <para>
   Distributed Management Task Force, Inc (DMTF) 是業內一個引領企業和網際網路環境管理標準開發的組織。該組織的目標是統一管理標準與計劃，並制定整合性更強、更為經濟有效且更具互通性的管理解決方案。DMTF 標準為實施控制和通訊提供了通用的系統管理元件。它們的解決方案與平台和技術無關。<emphasis>網路企業管理</emphasis>和 <emphasis>Common Information Model</emphasis> 是其重要技術之一。
  </para>

  <para>
   網路企業管理 (WBEM) 是一套管理和網際網路標準技術。WBEM 的開發目的是為了統一管理企業計算環境。它能夠讓整個行業使用 Web 技術提供一系列整合性極強的管理工具。WBEM 包含以下標準︰
  </para>

  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>
     資料模型︰標準的通用資訊模型 (CIM)
    </para>
   </listitem>
   <listitem>
    <para>
     編碼規格︰CIM-XML 編碼規格
    </para>
   </listitem>
   <listitem>
    <para>
     輸送機制︰透過 HTTP 的 CIM 操作
    </para>
   </listitem>
  </itemizedlist>

  <para>
   Common Information Model 是一個概念性的資訊模型，對系統管理進行了描述。該模型並非限於某種實作，而且可以實現管理系統、網路、服務與應用程式之間管理資訊的交換。CIM 由兩個部分組成 — CIM 規格與 CIM 綱要。
  </para>

  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>
     <emphasis>CIM 規格</emphasis>描述語言、命名和中繼綱要。中繼綱要是正式的模型定義。它定義了用來表達此模型的詞彙，以及這些詞彙的使用和語意。中繼綱要包含<emphasis>類別</emphasis> (class)、<emphasis>內容</emphasis> (property) 和<emphasis>方法</emphasis> (method) 這幾個元素。它還允許將<emphasis>指示</emphasis>與<emphasis>關聯</emphasis>做為<emphasis>類別</emphasis>的類型，將<emphasis>參考</emphasis>做為<emphasis>內容</emphasis>的類型。
    </para>
   </listitem>
   <listitem>
    <para>
     <emphasis>CIM 綱要</emphasis>提供實際的模型描述。它提供一組類別，這些類別包含的屬性和關聯可提供完整解讀的概念框架，使用者可運用此框架來組織關於受管理環境的可用資訊。
    </para>
   </listitem>
  </itemizedlist>

  <para>
   共用資訊模型物件管理員 (Common Information Model Object Manager, CIMOM) 就是 CIM 物件管理員，更詳細說來，就是指根據 CIM 標準管理物件的應用程式。CIMOM 會管理 CIMOM 提供者與 CIM 用戶端之間的通訊，而管理員則會管理系統。
  </para>

  <para>
   <emphasis>CIMOM 提供者</emphasis>是指透過 CIMOM 來執行用戶端應用程式所要求之特定工作的軟體。每個提供者都會執行 CIMOM 綱要的一項或多項範疇工作。這些提供者會直接與硬體互動。
  </para>

  <para>
   <emphasis>Standards Based Linux Instrumentation for Manageability (SBLIM)</emphasis> 是為實現網路企業管理 (WBEM) 而設計的一系列工具。SUSE® Linux Enterprise Server 使用 SBLIM 專案 <emphasis>Small Footprint CIM Broker</emphasis> 的開放原始碼 CIMOM (或 CIM 伺服器)。
  </para>

  <para>
   <emphasis>Small Footprint CIM Broker</emphasis> 是一款適用於資源受限或內嵌式環境的 CIM 伺服器，可同時實現模組化與輕量化。它基於開放式標準，並支援 CMPI 提供者、CIM-XML 編碼和<emphasis>受管理物件格式 (MOF)</emphasis>。這款伺服器不僅設定自由度高，而且在提供者當機時仍能穩定運作。此外，它還支援各種傳輸通訊協定 (例如 HTTP、HTTPS、Unix Domain Socket、服務位置通訊協定 (SLP) 和 Java 資料庫連接 (JDBC))，因此存取方便。
  </para>
 </sect1>
 <sect1 xml:id="sec.wbem.setting">
  <title>設定 SFCB</title>

  <para>
   若要設定 Small Footprint CIM Broker (SFCB) 環境，請務必在 <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> 安裝期間選取 YaST 中的<guimenu>網路企業管理</guimenu>模式。或者，也可以選擇將其做為一個元件，安裝於目前正在執行的伺服器上。請確定系統上已安裝下列套件︰
  </para>

  <variablelist>
   <varlistentry>
    <term>cim-schema，Common Information Model (CIM) 綱要</term>
    <listitem>
     <para>
      包含 Common Information Model (CIM)。CIM 是描述網路或企業環境內所有管理資訊的模型。CIM 由規格和綱要所組成。其中的規格定義了與其他管理模型整合的詳細資訊。而綱要則會提供實際的模型描述。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>cmpi-bindings-pywbem</term>
    <listitem>
     <para>
      包含可在 Python 中寫入並執行 CMPI 類型 CIM 提供者的介面卡。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>cmpi-pywbem-base</term>
    <listitem>
     <para>
      包含基礎系統 CIM 提供者。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>cmpi-pywbem-power-management</term>
    <listitem>
     <para>
      包含基於 DSP1027 的電源管理提供者。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>python-pywbem</term>
    <listitem>
     <para>
      包含 Python 模組，用於透過 WBEM 通訊協定進行 CIM 操作呼叫，以查詢及更新受管理物件。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>cmpi-provider-register，與 CIMOM 無關的提供者註冊公用程式</term>
    <listitem>
     <para>
      包含一個公用程式，無論 CIMOM 在系統中執行何種操作，都可讓 CMPI 提供者套件進行註冊。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>sblim-sfcb，Small Footprint CIM Broker</term>
    <listitem>
     <para>
      包含 Small Footprint CIM Broker。這是一個 CIM 伺服器，執行透過 HTTP 通訊協定的 CIM 操作。這款伺服器功能全，資源佔用率低，因此特別適合內嵌式環境以及資源受限的環境。SFCB 允許透過通用管理程式介面 (CMPI) 寫入提供者。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>sblim-sfcc</term>
    <listitem>
     <para>
      包含 Small Footprint CIM Client Library 執行時期程式庫。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>sblim-wbemcli</term>
    <listitem>
     <para>
      包含 WBEM 指令行介面。它是一個獨立的指令行 WBEM 用戶端，特別適合基本系統管理任務。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>smis-providers</term>
    <listitem>
     <para>
      包含多個提供者，適用於 Linux 檔案系統上的磁碟區和快照。它們均基於 SNIA 的 SMI 磁碟區管理設定檔與複製服務設定檔。
     </para>
    </listitem>
   </varlistentry>
  </variablelist>

  <figure xml:id="fig.wbem.setting.yast_install">
   <title>網路企業管理模式的套件選擇</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="yast_install_wbem.png" width="80%" format="PNG"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="yast_install_wbem.png" width="75%" format="PNG"/>
    </imageobject>
   </mediaobject>
  </figure>

  <sect2 xml:id="sec.wbem.setting.addinst">
   <title>安裝其他提供者</title>
   <para>
    <phrase role="productname"><phrase os="sles">SUSE® Linux Enterprise Server</phrase></phrase> 軟體儲存庫包含網路企業管理安裝模式中沒有的其他 CIM 提供者。您可以透過在 YaST 軟體安裝模組中搜尋模式 <literal>sblim-cmpi-</literal>，輕鬆獲得這些提供者的清單與安裝狀態。這些提供者能夠完成各種系統管理任務，例如 DHCP、NFS 或核心參數設定。安裝要與 SFCB 配合使用的提供者很有必要。
   </para>
   <figure xml:id="fig.wbem.setting.yast_cimproviders_install">
    <title>其他 CIM 提供者的套件選擇</title>
    <mediaobject>
     <imageobject role="fo">
      <imagedata fileref="yast_cim_providers_install.png" width="80%" format="PNG"/>
     </imageobject>
     <imageobject role="html">
      <imagedata fileref="yast_cim_providers_install.png" width="75%" format="PNG"/>
     </imageobject>
    </mediaobject>
   </figure>
  </sect2>

  <sect2 xml:id="sec.wbem.setting.daemon">
   <title>啟動、停止和檢查 SFCB 的狀態</title>
   <para>
    CIM 伺服器 sfcbd 精靈隨網路企業管理軟體一起安裝，並且預設會在系統啟動時啟動。下表將說明如何啟動、停止和檢查 sfcbd 的狀態。
   </para>
   <table xml:id="tab.wbem.setting.daemon.1" frame="topbot" rowsep="0">
    <title>管理 sfcbd 的指令</title>
    <tgroup cols="2">
     <colspec colnum="1" colname="1"/>
     <colspec colnum="2" colname="2"/>
     <thead>
      <row rowsep="1">
       <entry colname="1">
        <para>
         任務
        </para>
       </entry>
       <entry colname="2">
        <para>
         Linux指令
        </para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row rowsep="0">
       <entry colname="1">
        <para>
         啟動 sfcbd
        </para>
       </entry>
       <entry colname="2">
        <para>
         在指令行中以 <systemitem class="username">root</systemitem> 身分輸入 <command>systemctl start sfcb</command>。
        </para>
       </entry>
      </row>
      <row rowsep="0">
       <entry colname="1">
        <para>
         停止 sfcbd
        </para>
       </entry>
       <entry colname="2">
        <para>
         在指令行中以 <systemitem class="username">root</systemitem> 身分輸入 <command>systemctl stop sfcb</command>。
        </para>
       </entry>
      </row>
      <row rowsep="0">
       <entry colname="1">
        <para>
         檢查 sfcbd 狀態
        </para>
       </entry>
       <entry colname="2">
        <para>
         在指令行中以 <systemitem class="username">root</systemitem> 身分輸入 <command>systemctl status sfcb</command>。
        </para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </table>
  </sect2>

  <sect2 xml:id="sec.wbem.setting.secure">
   <title>確保安全的存取</title>
   <para>
    SFCB 的預設設定相當安全。不過，仍須檢查 SFCB 元件存取的安全級別是否符合您組織的要求。
   </para>
   <sect3 xml:id="sec.wbem.setting.secure.cert">
    <title>憑證</title>
    <para>
     安全通訊端層 (SSL) 傳輸必須使用證書，才能執行安全的通訊服務。安裝 SFCB 時，會產生自行簽署的證書。
    </para>
    <para>
     您可以變更 <filename>/etc/sfcb/sfcb.cfg</filename> 中的 <literal>sslCertificateFilePath: <replaceable>路徑_檔名</replaceable></literal>設定，以商業證書或自行簽署證書的路徑取代預設證書的路徑。該檔案必須為 PEM 格式。
    </para>
    <para>
     預設產生的伺服器證書會存放在以下位置：
    </para>
    <para>
     <filename>/etc/sfcb/server.pem</filename>
    </para>
    <note>
     <title>SSL 證書的路徑</title>
     <para>
      預設產生的證書檔案 <filename>servercert.pem</filename> 與 <filename>serverkey.pem</filename> 會儲存於 <filename>/etc/ssl/servercerts</filename> 目錄。檔案 <filename>/etc/sfcb/client.pem</filename>、<filename>/etc/sfcb/file.pem</filename> 和 <filename>/etc/sfcb/server.pem</filename> 為上述檔案的符號連結。
     </para>
    </note>
    <para>
     若要產生新證書，請在指令行中以 <systemitem class="username">root</systemitem> 身分輸入以下指令︰
    </para>
<screen><prompt>tux &gt; </prompt>sh /usr/share/sfcb/genSslCert.sh
Generating SSL certificates in .
Generating a 2048 bit RSA private key
...................................................................+++
.+++
writing new private key to '/var/tmp/sfcb.0Bjt69/key.pem'
-----</screen>
    <para>
     預設情況下，程序檔會在目前的工作目錄下產生證書 <filename>client.pem</filename>、<filename>file.pem</filename> 和 <filename>server.pem</filename>。若要讓程序檔在 <filename>/etc/sfcb</filename> 目錄中產生證書，則需要在指令中附加該路徑。如果這些檔案已存在，系統只會顯示警告訊息，不會覆寫舊證書。
    </para>
<screen><prompt>tux &gt; </prompt>sh /usr/share/sfcb/genSslCert.sh /etc/sfcb
Generating SSL certificates in .
WARNING: server.pem SSL Certificate file already exists.
         old file will be kept intact.
WARNING: client.pem SSL Certificate trust store already exists.
         old file will be kept intact.</screen>
    <para>
     必須從檔案系統中移除舊證書，然後再次執行指令。
    </para>
    <para>
     若要變更 SFCB 使用證書的方式，請參閱<xref linkend="sec.wbem.setting.secure.auth"/>。
    </para>
   </sect3>
   <sect3 xml:id="sec.wbem.setting.secure.ports">
    <title>埠</title>
    <para>
     預設情況下，SFCB 設定為接受所有透過安全連接埠 5989 傳輸的通訊。以下段落將介紹通訊連接埠設定以及建議的組態。
    </para>
    <variablelist>
     <varlistentry>
      <term>連接埠 5989 (安全)</term>
      <listitem>
       <para>
        SFCB 通訊使用的安全連接埠，提供 HTTPS 服務。這是預設值。如果使用這項設定，當透過網際網路在伺服器和工作站之間傳送時，所有 CIMOM 和用戶端應用程式之間的通訊都會進行加密。使用者必須使用用戶端應用程式進行驗證才能連接 SFCB 伺服器。建議您保留此設定。如果用戶端應用程式和受監控的節點之間存在路由器和防火牆，則必須在這些路由器和防火牆上開啟此連接埠，SFCB CIMOM 才能與必要的應用程式進行通訊。
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>連接埠 5988 (不安全)</term>
      <listitem>
       <para>
        SFCB 通訊使用的非安全連接埠，提供 HTTP 服務。這項設定已預設為停用。使用這項設定時，所有 CIMOM 和用戶端應用程式之間的通訊，在透過網際網路在伺服器和工作站之間傳送時都會開放，任何人無須經過任何驗證即可檢視。建議您只在嘗試為 CIMOM 相關問題除錯時使用這項設定。一旦問題解決，請再次停用不安全連接埠選項。如果 SFCB CIMOM 要與需要進行不安全存取的必要應用程式進行通訊，則必須在用戶端應用程式與受監控節點之間的路由器和防火牆上開啟此連接埠。
       </para>
      </listitem>
     </varlistentry>
    </variablelist>
    <para>
     如果您要變更預設的埠指定，請參閱<xref linkend="sec.wbem.setting.secure.ports"/>。
    </para>
   </sect3>
   <sect3 xml:id="sec.wbem.setting.secure.auth">
    <title>驗證</title>
    <para>
     SFCB 支援 HTTP 基本驗證和基於用戶端證書的驗證 (HTTP over SSL 連接)。在 SFCB 組態檔案 (預設為 <filename>/etc/sfcb/sfcb.cfg</filename>) 中指定 <literal>doBasicAuth</literal> =<replaceable>true</replaceable>，可啟用基本 HTTP 驗證。SFCB 的 SUSE® Linux Enterprise Server 安裝支援可插入驗證模組 (PAM) 方法，因此本地 root 使用者可以使用本地 root 使用者身分證明向 SFCB CIMOM 進行驗證。
    </para>
    <para>
     如果 <literal>sslClientCertificate</literal> 組態內容設為 <replaceable>accept</replaceable> 或 <replaceable>require</replaceable>，則 SFCB HTTP 介面卡會在用戶端透過 HTTP over SSL (HTTPS) 連接時要求其提供證書。如果指定 <replaceable>require</replaceable>，則用戶端<emphasis role="bold">必須</emphasis>提供有效的證書 (依據透過 <replaceable>sslClientTrustStore</replaceable> 指定的用戶端信任儲存區)。如果用戶端無法提供有效證書，CIM 伺服器會拒絕連接。
    </para>
    <para>
     <literal>sslClientCertificate</literal> =<replaceable>accept</replaceable> 設定產生的作用可能並不明顯。不過，當要同時允許基本驗證與用戶端證書驗證時，此設定非常有用。如果用戶端能夠提供有效的證書，HTTPS 連接便會建立，並且不再執行基本驗證程序。如果此功能無法驗證該證書，則會執行 HTTP 基本驗證。
    </para>
   </sect3>
  </sect2>
 </sect1>
 <sect1 xml:id="sec.wbem.config">
  <title>SFCB CIMOM 組態</title>

  <para>
   SFCB 是 CIM 伺服器的輕量化實作，但設定的自由度很高。有多個選項可控制其行為。控制 SFCB 伺服器的方法有三種︰
  </para>

  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>
     設定相應的環境變數
    </para>
   </listitem>
   <listitem>
    <para>
     使用指令行選項
    </para>
   </listitem>
   <listitem>
    <para>
     變更其組態檔案
    </para>
   </listitem>
  </itemizedlist>

  <sect2 xml:id="sec.wbem.config.env">
   <title>環境變數</title>
   <para>
    有多個環境變數會直接影響 SFCB 的行為。您需要透過 <command>systemctl restart sfcb</command> 重新啟動 SFCB 精靈，才能讓上述變更生效。
   </para>
   <variablelist>
    <varlistentry>
     <term><literal>PATH</literal>
     </term>
     <listitem>
      <para>
       指定 <systemitem>sfcbd</systemitem> 精靈及公用程式的路徑。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>LD_LIBRARY_PATH</literal>
     </term>
     <listitem>
      <para>
       指定 sfcb 執行時期程式庫的路徑。或者，您也可以將此路徑新增至系統層級的動態載入程式組態檔案 <filename>/etc/ld.so.conf</filename>。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>SFCB_PAUSE_PROVIDER</literal>
     </term>
     <listitem>
      <para>
       指定提供者名稱。SFCB 伺服器會在首次載入提供者後暫停。此時，您可以將執行時期除錯程式附加至提供者的程序，以進行除錯。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>SFCB_PAUSE_CODEC</literal>
     </term>
     <listitem>
      <para>
       指定 SFCB 轉碼器的名稱 (目前僅支援 <literal>http</literal>)。SFCB 伺服器會在首次載入轉碼器後暫停。此時，您可以將執行時期除錯程式附加至程序。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>SFCB_TRACE</literal>
     </term>
     <listitem>
      <para>
       為 SFCB 指定除錯訊息的等級。有效值為 0 (無除錯訊息)，或 1 (重要除錯訊息) 至 4 (所有除錯訊息)。預設值為 1。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>SFCB_TRACE_FILE</literal>
     </term>
     <listitem>
      <para>
       SFCB 預設會將其除錯訊息輸出至標準錯誤輸出 (STDERR)。若要將除錯訊息改寫到指定的檔案，可以設定此變數。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>SBLIM_TRACE</literal>
     </term>
     <listitem>
      <para>
       為 SBLIM 提供者指定除錯訊息的等級。有效值為 0 (無除錯訊息)，或 1 (重要除錯訊息) 至 4 (所有除錯訊息)。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>SBLIM_TRACE_FILE</literal>
     </term>
     <listitem>
      <para>
       SBLIM 提供者預設會將其追蹤訊息輸出至 STDERR。若要將追蹤訊息改寫到指定的檔案，可以設定此變數。
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
  </sect2>

  <sect2 xml:id="sec.wbem.config.cmdline">
   <title>指令行選項</title>
   <para>
    SFCB 精靈 <systemitem>sfcbd</systemitem> 有多個指令行選項，可開啟或關閉特定的執行時期功能。請在 SFCB 精靈啟動時輸入這些選項。
   </para>
   <variablelist>
    <varlistentry>
     <term><literal>-c、--config-file</literal>=<replaceable>檔案</replaceable>
     </term>
     <listitem>
      <para>
       SFCB 精靈啟動時，預設會從 <filename>/etc/sfcb/sfcb.cfg</filename> 中讀取組態。借助此選項，可以指定替代的組態檔案。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>-d、--daemon</literal>
     </term>
     <listitem>
      <para>
       強制 sfcbd 及其子程序在背景執行。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>-s、--collect-stats</literal>
     </term>
     <listitem>
      <para>
       開啟執行時期的統計資料收集。各種 sfcbd 執行時期統計資料將被寫入到目前工作目錄下的 <filename>sfcbStat</filename> 檔案。預設情況下，不會收集任何統計資料。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>-l、--syslog-level</literal>=<replaceable>記錄層級</replaceable>
     </term>
     <listitem>
      <para>
       指定系統記錄機能的詳細度。<replaceable>記錄層級</replaceable>可以是 LOG_INFO、LOG_DEBUG 或 LOG_ERR，預設為 LOG_ERR。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>-k、--color-trace</literal>=<replaceable>記錄層級</replaceable>
     </term>
     <listitem>
      <para>
       使用不同的色彩列印各程序的追蹤輸出，以方便您除錯。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>-t、--trace-components</literal>=<replaceable>數字</replaceable>
     </term>
     <listitem>
      <para>
       啟動元件層級的訊息追蹤，其中<replaceable>數字</replaceable>為使用 OR 指定的位元遮罩整數，用於定義要追蹤的元件。如果指定 <option>-t ?</option>，會列出所有元件及其關聯的整數位元遮罩︰
      </para>
<screen><prompt>tux &gt; </prompt>sfcbd -t ?
---   Traceable Components:     Int       Hex
---            providerMgr:          1  0x0000001
---            providerDrv:          2  0x0000002
---             cimxmlProc:          4  0x0000004
---             httpDaemon:          8  0x0000008
---                upCalls:         16  0x0000010
---               encCalls:         32  0x0000020
---        ProviderInstMgr:         64  0x0000040
---       providerAssocMgr:        128  0x0000080
---              providers:        256  0x0000100
---            indProvider:        512  0x0000200
---       internalProvider:       1024  0x0000400
---             objectImpl:       2048  0x0000800
---                  xmlIn:       4096  0x0001000
---                 xmlOut:       8192  0x0002000
---                sockets:      16384  0x0004000
---              memoryMgr:      32768  0x0008000
---               msgQueue:      65536  0x0010000
---             xmlParsing:     131072  0x0020000
---         responseTiming:     262144  0x0040000
---              dbpdaemon:     524288  0x0080000
---                    slp:    1048576  0x0100000</screen>
      <para>
       <option>-t</option> <replaceable>2019</replaceable> 會顯示 sfcbd 的內部函數，但不會產生過多訊息，因此很有用。
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
  </sect2>

  <sect2 xml:id="sec.wbem.config.confile">
   <title>SFCB 組態檔案</title>
   <para>
    SFCB 會在啟動後從組態檔案 <filename>/etc/sfcb/sfcb.cfg</filename> 讀取其執行時期組態。若想覆寫啟動時的這一行為，可以使用 <option>-c</option> 選項。
   </para>
   <para>
    組態檔案包含多組 <option>option</option> : <replaceable>值</replaceable>，每行一組。變更此檔案時，可以使用以所用環境原生格式儲存檔案的任何文字編輯器。
   </para>
   <para>
    如果設定中包含以數字符號 (#) 設為備註的選項，則該設定會使用預設設定。
   </para>
   <para>
    下面的選項清單可能不完整。如需完整的清單，請參閱 <filename>/etc/sfcb/sfcb.cfg</filename> 和 <filename>/usr/share/doc/packages/sblim-sfcb/README</filename> 中的相關內容。
   </para>
   <sect3 xml:id="sec.wbem.config.confile.1">
    <title>httpPort</title>
    <bridgehead>用途</bridgehead>
    <para>
     指定 sfcbd 監聽來自 CIM 用戶端之 HTTP (不安全) 請求的本地連接埠值。預設值為 <literal>5988</literal>。
    </para>
    <bridgehead>語法</bridgehead>
    <para>
     <literal>httpPort:</literal> <replaceable>埠號</replaceable>
    </para>
   </sect3>
   <sect3 xml:id="sec.wbem.config.confile.2">
    <title>enableHttp</title>
    <bridgehead>用途</bridgehead>
    <para>
     指定 SFCB 是否應接受 HTTP 用戶端連接。預設值為 <literal>false</literal>。
    </para>
    <bridgehead>語法</bridgehead>
    <para>
     <literal>enableHttp:</literal> <replaceable>選項</replaceable>
    </para>
    <informaltable frame="topbot" rowsep="1">
     <tgroup cols="2">
      <thead>
       <row>
        <entry>
         <para>
          選項
         </para>
        </entry>
        <entry>
         <para>
          描述
         </para>
        </entry>
       </row>
      </thead>
      <tbody>
       <row>
        <entry>
         <para>
          true
         </para>
        </entry>
        <entry>
         <para>
          啟用 HTTP 連接。
         </para>
        </entry>
       </row>
       <row>
        <entry>
         <para>
          false
         </para>
        </entry>
        <entry>
         <para>
          停用 HTTP 連接。
         </para>
        </entry>
       </row>
      </tbody>
     </tgroup>
    </informaltable>
   </sect3>
   <sect3 xml:id="sec.wbem.config.confile.3">
    <title>httpProcs</title>
    <bridgehead>用途</bridgehead>
    <para>
     指定可同時建立之 HTTP 用戶端連接的最大數量。達到該數量後，所有新的內送 HTTP 請求都將遭到阻擋。預設值為 <literal>8</literal>。
    </para>
    <bridgehead>語法</bridgehead>
    <para>
     <literal>httpProcs:</literal> <replaceable>最大連接數</replaceable>
    </para>
   </sect3>
   <sect3 xml:id="sec.wbem.config.confile.3.5">
    <title>httpUserSFCB、httpUser</title>
    <bridgehead>用途</bridgehead>
    <para>
     這些選項可控制 HTTP 伺服器將以何使用者的身分執行。如果 <option>httpUserSFCB</option> 為 <literal>true</literal>，HTTP 將以 SFCB 主程序所用的相同使用者身分執行。如果為 <literal>false</literal>，將使用為 <option>httpUser</option> 指定的使用者名稱。此設定用於 HTTP 和 HTTPS 兩種伺服器。若 <option>httpUserSFCB</option> 設定為 <literal>false</literal>，就<emphasis>必須</emphasis>指定 <option>httpUser</option>。預設值為 <literal>true</literal>。
    </para>
    <bridgehead>語法</bridgehead>
    <para>
     <literal>httpUserSFCB:</literal> <replaceable>true</replaceable>
    </para>
   </sect3>
   <sect3 xml:id="sec.wbem.config.confile.3.8">
    <title>httpLocalOnly</title>
    <bridgehead>用途</bridgehead>
    <para>
     指定是否將 HTTP 要求局限於本地主機。預設值為 <literal>false</literal>。
    </para>
    <bridgehead>語法</bridgehead>
    <para>
     <literal>httpLocalOnly:</literal> <replaceable>false</replaceable>
    </para>
   </sect3>
   <sect3 xml:id="sec.wbem.config.confile.4">
    <title>httpsPort</title>
    <bridgehead>用途</bridgehead>
    <para>
     指定 sfcbd 監聽來自 CIM 用戶端之 HTTPS 請求的本地連接埠值。預設值為 <literal>5989</literal>。
    </para>
    <bridgehead>語法</bridgehead>
    <para>
     <literal>httpsPort:</literal> <replaceable>埠號</replaceable>
    </para>
   </sect3>
   <sect3 xml:id="sec.wbem.config.confile.5">
    <title>enableHttps</title>
    <bridgehead>用途</bridgehead>
    <para>
     指定 SFCB 是否接受 HTTPS 用戶端連接。預設值為 <literal>true</literal>。
    </para>
    <bridgehead>語法</bridgehead>
    <para>
     <literal>enableHttps:</literal> <replaceable>選項</replaceable>
    </para>
    <informaltable frame="topbot" rowsep="1">
     <tgroup cols="2">
      <thead>
       <row>
        <entry>
         <para>
          選項
         </para>
        </entry>
        <entry>
         <para>
          描述
         </para>
        </entry>
       </row>
      </thead>
      <tbody>
       <row>
        <entry>
         <para>
          true
         </para>
        </entry>
        <entry>
         <para>
          啟用 HTTPS 連接。
         </para>
        </entry>
       </row>
       <row>
        <entry>
         <para>
          false
         </para>
        </entry>
        <entry>
         <para>
          停用 HTTPS 連接。
         </para>
        </entry>
       </row>
      </tbody>
     </tgroup>
    </informaltable>
   </sect3>
   <sect3 xml:id="sec.wbem.config.confile.7">
    <title>httpsProcs</title>
    <bridgehead>用途</bridgehead>
    <para>
     指定可同時建立之 HTTPS 用戶端連接的最大數量。達到該數量後，所有新的內送 HTTPS 請求都將遭到阻擋。預設值為 <literal>8</literal>。
    </para>
    <bridgehead>語法</bridgehead>
    <para>
     <literal>httpsProcs:</literal> <replaceable>最大連接數</replaceable>
    </para>
   </sect3>
   <sect3 xml:id="sec.wbem.config.confile.8">
    <title>enableInterOp</title>
    <bridgehead>用途</bridgehead>
    <para>
     指定 SFCB 是否提供 <emphasis>interop</emphasis> 名稱空間，用於指示支援。預設值為 <literal>true</literal>。
    </para>
    <bridgehead>語法</bridgehead>
    <para>
     <literal>enableInterOp:</literal> <replaceable>選項</replaceable>
    </para>
    <informaltable frame="topbot" rowsep="1">
     <tgroup cols="2">
      <thead>
       <row>
        <entry>
         <para>
          選項
         </para>
        </entry>
        <entry>
         <para>
          描述
         </para>
        </entry>
       </row>
      </thead>
      <tbody>
       <row>
        <entry>
         <para>
          true
         </para>
        </entry>
        <entry>
         <para>
          啟用 interop 名稱空間。
         </para>
        </entry>
       </row>
       <row>
        <entry>
         <para>
          false
         </para>
        </entry>
        <entry>
         <para>
          停用 interop 名稱空間。
         </para>
        </entry>
       </row>
      </tbody>
     </tgroup>
    </informaltable>
   </sect3>
   <sect3 xml:id="sec.wbem.config.confile.9">
    <title>provProcs</title>
    <bridgehead>用途</bridgehead>
    <para>
     指定可同時執行之提供者程序的最大數量。達到該數量之後，如果有新的內送請求要求載入新提供者，則會先自動卸載某個現有的提供者。預設值為 <literal>32</literal>。
    </para>
    <bridgehead>語法</bridgehead>
    <para>
     <literal>provProcs:</literal> <replaceable>最大程序數</replaceable>
    </para>
   </sect3>
   <sect3 xml:id="sec.wbem.config.confile.10">
    <title>doBasicAuth</title>
    <bridgehead>用途</bridgehead>
    <para>
     接受請求之前，依據用戶端使用者識別碼開啟或關閉基本驗證。預設值為 <literal>true</literal>，表示系統會執行基本用戶端驗證。
    </para>
    <bridgehead>語法</bridgehead>
    <para>
     <literal>doBasicAuth:</literal> <replaceable>選項</replaceable>
    </para>
    <informaltable frame="topbot" rowsep="1">
     <tgroup cols="2">
      <thead>
       <row>
        <entry>
         <para>
          選項
         </para>
        </entry>
        <entry>
         <para>
          描述
         </para>
        </entry>
       </row>
      </thead>
      <tbody>
       <row>
        <entry>
         <para>
          true
         </para>
        </entry>
        <entry>
         <para>
          啟用基本驗證。
         </para>
        </entry>
       </row>
       <row>
        <entry>
         <para>
          false
         </para>
        </entry>
        <entry>
         <para>
          停用基本驗證。
         </para>
        </entry>
       </row>
      </tbody>
     </tgroup>
    </informaltable>
   </sect3>
   <sect3 xml:id="sec.wbem.config.confile.11">
    <title>basicAuthLib</title>
    <bridgehead>用途</bridgehead>
    <para>
     指定本地程式庫名稱。SFCB 伺服器會載入程式庫，以驗證用戶端使用者識別碼。預設值為 <literal>sfcBasicPAMAuthentication</literal>。
    </para>
    <bridgehead>語法</bridgehead>
    <para>
     <literal>provProcs:</literal> <replaceable>最大程序數</replaceable>
    </para>
   </sect3>
   <sect3 xml:id="sec.wbem.config.confile.12">
    <title>useChunking</title>
    <bridgehead>用途</bridgehead>
    <para>
     此選項可啟用或停用 HTTP/HTTPS<quote>區塊化</quote>功能。如果啟用，伺服器會將大量回應資料以較小的<quote>區塊</quote>傳回到用戶端，而不是採用緩衝資料，然後以一個區塊全部送回的方式。預設值為 <literal>true</literal>。
    </para>
    <bridgehead>語法</bridgehead>
    <para>
     <literal>useChunking:</literal> <replaceable>選項</replaceable>
    </para>
    <informaltable frame="topbot" rowsep="1">
     <tgroup cols="2">
      <thead>
       <row>
        <entry>
         <para>
          選項
         </para>
        </entry>
        <entry>
         <para>
          描述
         </para>
        </entry>
       </row>
      </thead>
      <tbody>
       <row>
        <entry>
         <para>
          true
         </para>
        </entry>
        <entry>
         <para>
          啟用 HTTP/HTTPS 資料區塊化功能。
         </para>
        </entry>
       </row>
       <row>
        <entry>
         <para>
          false
         </para>
        </entry>
        <entry>
         <para>
          停用 HTTP/HTTPS 資料區塊化功能。
         </para>
        </entry>
       </row>
      </tbody>
     </tgroup>
    </informaltable>
   </sect3>
   <sect3 xml:id="sec.wbem.config.confile.13">
    <title>keepaliveTimeout</title>
    <bridgehead>用途</bridgehead>
    <para>
     指定 SFCB HTTP 程序在同一個連接上兩次請求間的最長等待時間 (秒)。達到此時間後，程序將終止。如果將其設定為 <literal>0</literal>，則會停用 HTTP 保持連線功能。預設值為 <literal>0</literal>。
    </para>
    <bridgehead>語法</bridgehead>
    <para>
     <literal>keepaliveTimeout:</literal> <replaceable>秒數</replaceable>
    </para>
   </sect3>
   <sect3 xml:id="sec.wbem.config.confile.14">
    <title>keepaliveMaxRequest</title>
    <bridgehead>用途</bridgehead>
    <para>
     指定一個連接上連續請求的最大數量。如果將其設定為 <literal>0</literal>，則會停用 HTTP 保持連線功能。預設值為 <literal>10</literal>。
    </para>
    <bridgehead>語法</bridgehead>
    <para>
     <literal>keepaliveMaxRequest:</literal> <replaceable>連接數</replaceable>
    </para>
   </sect3>
   <sect3 xml:id="sec.wbem.config.confile.15">
    <title>registrationDir</title>
    <bridgehead>用途</bridgehead>
    <para>
     指定註冊目錄，其中包含提供者註冊資料、階段區域和靜態儲存庫。預設值為 <filename>/var/lib/sfcb/registration</filename>。
    </para>
    <bridgehead>語法</bridgehead>
    <para>
     <literal>registrationDir:</literal> <replaceable>目錄</replaceable>
    </para>
   </sect3>
   <sect3 xml:id="sec.wbem.config.confile.16">
    <title>providerDirs</title>
    <bridgehead>用途</bridgehead>
    <para>
     指定 SFCB 從中搜尋提供者程式庫的目錄清單，以空格分隔。預設值為 <filename>/usr/lib64 /usr/lib64 /usr/lib64/cmpi</filename>。
    </para>
    <bridgehead>語法</bridgehead>
    <para>
     <literal>providerDirs:</literal> <replaceable>目錄</replaceable>
    </para>
   </sect3>
   <sect3 xml:id="sec.wbem.config.confile.17">
    <title>providerSampleInterval</title>
    <bridgehead>用途</bridgehead>
    <para>
     指定提供者管理員檢查閒置提供者的間隔 (秒)。預設值為 <literal>30</literal>。
    </para>
    <bridgehead>語法</bridgehead>
    <para>
     <literal>providerSampleInterval:</literal> <replaceable>秒數</replaceable>
    </para>
   </sect3>
   <sect3 xml:id="sec.wbem.config.confile.18">
    <title>providerTimeoutInterval</title>
    <bridgehead>用途</bridgehead>
    <para>
     指定提供者在閒置多少時間 (秒) 後由提供者管理員卸載。預設值為 <literal>60</literal>。
    </para>
    <bridgehead>語法</bridgehead>
    <para>
     <literal>providerTimeoutInterval:</literal> <replaceable>秒數</replaceable>
    </para>
   </sect3>
   <sect3 xml:id="sec.wbem.config.confile.19">
    <title>providerAutoGroup</title>
    <bridgehead>用途</bridgehead>
    <para>
     如果提供者註冊檔案未指定其他任何群組，並且該選項設定為 <replaceable>true</replaceable>，則同一個共享程式庫中的所有提供者都會在同一個程序中執行。
    </para>
    <bridgehead>語法</bridgehead>
    <para>
     <literal>providerAutoGroup:</literal> <replaceable>選項</replaceable>
    </para>
    <informaltable frame="topbot" rowsep="1">
     <tgroup cols="2">
      <thead>
       <row>
        <entry>
         <para>
          選項
         </para>
        </entry>
        <entry>
         <para>
          描述
         </para>
        </entry>
       </row>
      </thead>
      <tbody>
       <row>
        <entry>
         <para>
          true
         </para>
        </entry>
        <entry>
         <para>
          啟用提供者分組。
         </para>
        </entry>
       </row>
       <row>
        <entry>
         <para>
          false
         </para>
        </entry>
        <entry>
         <para>
          停用提供者分組。
         </para>
        </entry>
       </row>
      </tbody>
     </tgroup>
    </informaltable>
   </sect3>
   <sect3 xml:id="sec.wbem.config.confile.20">
    <title>sslCertificateFilePath</title>
    <bridgehead>用途</bridgehead>
    <para>
     指定包含伺服器證書的檔案名稱。檔案必須為 PEM (隱私增強郵件，採用 RFC 1421 與 RFC 1424 標準) 格式。不過，此檔案僅在 <literal>enableHttps</literal> 設定為 <literal>true</literal> 時才要求使用。預設值為 <filename>/etc/sfcb/server.pem</filename>。
    </para>
    <bridgehead>語法</bridgehead>
    <para>
     <literal>sslCertificateFilePath:</literal> <replaceable>路徑</replaceable>
    </para>
   </sect3>
   <sect3 xml:id="sec.wbem.config.confile.21">
    <title>sslKeyFilePath</title>
    <bridgehead>用途</bridgehead>
    <para>
     指定包含伺服器證書之私密金鑰的檔案名稱。該檔案必須為 PEM 格式，可以不含密碼片語保護。不過，此檔案僅在 <literal>enableHttps</literal> 設定為 <literal>true</literal> 時才要求使用。預設值為 <filename>/etc/sfcb/file.pem</filename>。
    </para>
    <bridgehead>語法</bridgehead>
    <para>
     <literal>sslKeyFilePath:</literal> <replaceable>路徑</replaceable>
    </para>
   </sect3>
   <sect3 xml:id="sec.wbem.config.confile.22">
    <title>sslClientTrustStore</title>
    <bridgehead>用途</bridgehead>
    <para>
     指定包含 CA 或自行簽署之客戶端證書的檔案名稱。此檔必須為 PEM 格式，不過僅在 <literal>sslClientCertificate</literal> 設定為 <literal>accept</literal> 或 <literal>require</literal> 時才要求使用。預設值為 <filename>/etc/sfcb/client.pem</filename>。
    </para>
    <bridgehead>語法</bridgehead>
    <para>
     <literal>sslClientTrustStore:</literal> <replaceable>路徑</replaceable>
    </para>
   </sect3>
   <sect3 xml:id="sec.wbem.config.confile.23">
    <title>sslClientCertificate</title>
    <bridgehead>用途</bridgehead>
    <para>
     指定 SFCB 處理用戶端證書驗證的方式。如果設定為 <literal>ignore</literal>，則不會要求用戶端提供證書。如果設定為 <literal>accept</literal>，則會要求用戶端提供證書，不過即使用戶端不提供，操作也不會失敗。如果設定為 <literal>require</literal>，則會在客戶端不提供證書時拒絕客戶端連接。預設值為 <literal>ignore</literal>。
    </para>
    <bridgehead>語法</bridgehead>
    <para>
     <literal>sslClientCertificate:</literal> <replaceable>選項</replaceable>
    </para>
    <informaltable frame="topbot" rowsep="1">
     <tgroup cols="2">
      <thead>
       <row>
        <entry>
         <para>
          選項
         </para>
        </entry>
        <entry>
         <para>
          描述
         </para>
        </entry>
       </row>
      </thead>
      <tbody>
       <row>
        <entry>
         <para>
          ignore
         </para>
        </entry>
        <entry>
         <para>
          停用用戶端證書的請求。
         </para>
        </entry>
       </row>
       <row>
        <entry>
         <para>
          accept
         </para>
        </entry>
        <entry>
         <para>
          停用用戶端證書的請求。
         </para>
         <para>
          即使不提供證書，也不會失敗。
         </para>
        </entry>
       </row>
       <row>
        <entry>
         <para>
          require
         </para>
        </entry>
        <entry>
         <para>
          如果沒有有效的證書，便拒絕用戶端連接。
         </para>
        </entry>
       </row>
      </tbody>
     </tgroup>
    </informaltable>
   </sect3>
   <sect3 xml:id="sec.wbem.config.confile.24">
    <title>certificateAuthLib</title>
    <bridgehead>用途</bridgehead>
    <para>
     指定本地程式庫的名稱，以便請求基於用戶端證書的使用者驗證。僅當 <literal>sslClientCertificate</literal> 未設定為 <literal>ignore</literal> 時才需要指定。預設值為 <filename>sfcCertificateAuthentication</filename>。
    </para>
    <bridgehead>語法</bridgehead>
    <para>
     <literal>certificateAuthLib:</literal> <replaceable>檔案</replaceable>
    </para>
   </sect3>
   <sect3 xml:id="sec.wbem.config.confile.25">
    <title>traceLevel</title>
    <bridgehead>用途</bridgehead>
    <para>
     指定 SFCB 的追蹤層級。您可以透過設定環境變數 <literal>SFCB_TRACE_LEVEL</literal> 的方式對其進行覆寫。預設值為 <literal>0</literal>。
    </para>
    <bridgehead>語法</bridgehead>
    <para>
     <literal>traceLevel:</literal> <replaceable>層級數</replaceable>
    </para>
   </sect3>
   <sect3 xml:id="sec.wbem.config.confile.26">
    <title>traceMask</title>
    <bridgehead>用途</bridgehead>
    <para>
     指定 SFCB 的追蹤遮罩。您可以透過指令行選項 <option>--trace-components</option> 對其進行覆寫。預設值為 <literal>0</literal>。
    </para>
    <bridgehead>語法</bridgehead>
    <para>
     <literal>traceMask:</literal> <replaceable>遮罩</replaceable>
    </para>
   </sect3>
   <sect3 xml:id="sec.wbem.config.confile.27">
    <title>traceFile</title>
    <bridgehead>用途</bridgehead>
    <para>
     指定 SFCB 的追蹤檔案。您可以透過設定環境變數 <literal>SFCB_TRACE_FILE</literal> 的方式對其進行覆寫。預設值為 <literal>stderr</literal> (標準錯誤輸出)。
    </para>
    <bridgehead>語法</bridgehead>
    <para>
     <literal>traceFile:</literal> <replaceable>輸出</replaceable>
    </para>
   </sect3>
  </sect2>
 </sect1>
 <sect1 xml:id="sec.wbem.advanced">
  <title>進階 SFCB 任務</title>

  <para>
   本章介紹有關 SFCB 使用的更多進階主題。為了便於理解，您需要先掌握 Linux 檔案系統的基本知識，並具備 Linux 指令行的操作經驗。本章包括以下任務︰
  </para>

  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>
     安裝 CMPI 提供者
    </para>
   </listitem>
   <listitem>
    <para>
     測試 SFCB
    </para>
   </listitem>
   <listitem>
    <para>
     使用 <command>wbemcli</command> CIM 用戶端
    </para>
   </listitem>
  </itemizedlist>

  <sect2 xml:id="sec.wbem.advanced.cmpinst">
   <title>安裝 CMPI 提供者</title>
   <para>
    若要安裝 CMPI 提供者，需要確定其共享程式庫複製到 <literal>providerDirs</literal> 組態選項指定的其中一個目錄，請參閱<xref linkend="sec.wbem.config.confile.16"/>。還必須使用 <command>sfcbstage</command> 與 <command>sfcbrepos</command> 指令正確註冊提供者。
   </para>
   <para>
    系統通常會為 SFCB 準備提供者套件，以便安裝程序能夠正確進行註冊。此外，還為 SFCB 準備了大多數 SBLIM 提供者。
   </para>
   <sect3 xml:id="sec.wbem.advanced.cmpinst.crep">
    <title>類別儲存庫</title>
    <para>
     <emphasis>類別儲存庫</emphasis>是 SFCB 儲存 CIM 類別之相關資訊的位置。它通常由包含名稱空間元件的目錄樹組成。常見的 CIM 名稱空間為 <literal>root/cimv2</literal> 或 <literal>root/interop</literal>，它們會分別轉譯為檔案系統上的類別儲存庫目錄路徑
    </para>
    <para>
     <filename>/var/lib/sfcb/registration/repository/root/cimv2</filename>
    </para>
    <para>
     和
    </para>
    <para>
     <filename>/var/lib/sfcb/registration/repository/root/interop</filename>
    </para>
    <para>
     每個名稱空間目錄都包含檔案 <filename>classSchemas</filename>。該檔案內有所有在該名稱空間下註冊之 CIM 類別的編譯二進位表示。同時還包含有關其 CIM 超類別的必要資訊。
    </para>
    <para>
     此外，每個名稱空間目錄可能會包含檔案 <filename>qualifiers</filename>，內有該命名空間的所有修飾詞。Sfcbd 重新啟動時，類別提供者會掃描目錄 <filename>/var/lib/sfcb/registration/repository/</filename> 及其所有子目錄，以確定註冊的名稱空間。然後解碼 <filename>classSchemas</filename> 檔案，並建立每個名稱空間的類別階層。
    </para>
   </sect3>
   <sect3 xml:id="sec.wbem.advanced.cmpinst.classadd">
    <title>新增類別</title>
    <para>
     SFCB 無法執行線上 CIM 類別操作。您需要在離線模式下新增、變更或移除類別，然後使用 <command>systemctl restart sfcb</command> 重新啟動 SFCB 服務以註冊變更。
    </para>
    <para>
     儲存提供者類別和註冊資訊時，SFCB 會使用一個稱為<emphasis>階段區域</emphasis>的位置。在 SUSE® Linux Enterprise Server 系統中，即 <filename>/var/lib/sfcb/stage/</filename> 下的目錄結構。
    </para>
    <para>
     若要新增提供者，需要︰
    </para>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <para>
       將提供者類別定義檔案複製到階段區域目錄 (<filename>/var/lib/sfcb/stage/mofs</filename>) 下的 <filename>./mofs</filename> 子目錄。
      </para>
     </listitem>
     <listitem>
      <para>
       將包含類別名稱或提供者類型，以及可執行程式庫檔案名稱的註冊檔案複製到 <filename>./regs</filename> 子目錄。
      </para>
     </listitem>
    </itemizedlist>
    <para>
     階段目錄中有兩個預設 <quote>mof</quote> (類別定義) 檔案︰<filename>indication.mof</filename> 與 <filename>interop.mof</filename>。執行 <filename>sfcbrepos</filename> 指令後，根階段目錄 <filename>/var/lib/sfcb/stage/mofs</filename> 下的 MOF 檔案將複製到每個名稱空間中。<filename>interop.mof</filename> 只會編譯至 <emphasis>interop</emphasis> 名稱空間。
    </para>
    <para>
     目錄配置可能如下例所示︰
    </para>
<screen><prompt>tux &gt; </prompt>ls /var/lib/sfcb/stage
default.reg  mofs  regs</screen>
<screen><prompt>tux &gt; </prompt>ls /var/lib/sfcb/stage/mofs
indication.mof  root</screen>
<screen><prompt>tux &gt; </prompt>ls /var/lib/sfcb/stage/mofs/root
cimv2  interop  suse  virt</screen>
<screen><prompt>tux &gt; </prompt>ls -1 /var/lib/sfcb/stage/mofs/root/cimv2 | less
Linux_ABIParameter.mof
Linux_BaseIndication.mof
Linux_Base.mof
Linux_DHCPElementConformsToProfile.mof
Linux_DHCPEntity.mof
[..]
OMC_StorageSettingWithHints.mof
OMC_StorageVolumeDevice.mof
OMC_StorageVolume.mof
OMC_StorageVolumeStorageSynchronized.mof
OMC_SystemStorageCapabilities.mof</screen>
<screen><prompt>tux &gt; </prompt>ls -1 /var/lib/sfcb/stage/mofs/root/interop
ComputerSystem.mof
ElementConformsToProfile.mof
HostSystem.mof
interop.mof
Linux_DHCPElementConformsToProfile.mof
[..]
OMC_SMIElementSoftwareIdentity.mof
OMC_SMISubProfileRequiresProfile.mof
OMC_SMIVolumeManagementSoftware.mof
ReferencedProfile.mof
RegisteredProfile.mof</screen>
<screen><prompt>tux &gt; </prompt>ls -1 /var/lib/sfcb/stage/regs
AllocationCapabilities.reg
Linux_ABIParameter.reg
Linux_BaseIndication.reg
Linux_DHCPGlobal.reg
Linux_DHCPRegisteredProfile.reg
[..]
OMC_Base.sfcb.reg
OMC_CopyServices.sfcb.reg
OMC_PowerManagement.sfcb.reg
OMC_Server.sfcb.reg
RegisteredProfile.reg</screen>
<screen><prompt>tux &gt; </prompt>cat /var/lib/sfcb/stage/regs/Linux_DHCPRegisteredProfile.reg
[Linux_DHCPRegisteredProfile]
   provider: Linux_DHCPRegisteredProfileProvider
   location: cmpiLinux_DHCPRegisteredProfile
   type: instance
   namespace: root/interop
#
[Linux_DHCPElementConformsToProfile]
   provider: Linux_DHCPElementConformsToProfileProvider
   location: cmpiLinux_DHCPElementConformsToProfile
   type: instance association
   namespace: root/cimv2
#
[Linux_DHCPElementConformsToProfile]
   provider: Linux_DHCPElementConformsToProfileProvider
   location: cmpiLinux_DHCPElementConformsToProfile
   type: instance association
   namespace: root/interop</screen>
    <para>
     SFCB 會對每個提供者使用一個自訂的提供者註冊檔案。
    </para>
    <note>
     <title>SBLIM 提供者註冊檔案</title>
     <para>
      SBLIM 網站上的所有 SBLIM 提供者都已包含用於產生 SFCB 之 .reg 檔案的註冊檔案。
     </para>
    </note>
    <para>
     SFCB 註冊檔案的格式如下︰
    </para>
<screen>
[&lt;class-name&gt;]
   provider: &lt;provide-name&gt;
   location: &lt;library-name&gt;
   type: [instance] [association] [method] [indication]
   group: &lt;group-name&gt;
   unload: never
   namespace: &lt;namespace-for-class&gt; ...
</screen>
    <para>
     其中，
    </para>
    <variablelist>
     <varlistentry>
      <term><literal>&lt;類別名稱&gt;</literal>
      </term>
      <listitem>
       <para>
        CIM 類別名稱 (必要)
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term><literal>&lt;provider-name&gt;</literal>
      </term>
      <listitem>
       <para>
        CMPI 提供者名稱 (必要)
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term><literal>&lt;location-name&gt;</literal>
      </term>
      <listitem>
       <para>
        提供者程式庫名稱 (必要)
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term><literal>type</literal>
      </term>
      <listitem>
       <para>
        提供者類型 (必要)可以是 <literal>instance</literal>、<literal>association</literal>、<literal>method</literal> 或 <literal>indication</literal> 的任意組合。
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term><literal>&lt;group-name&gt;</literal>
      </term>
      <listitem>
       <para>
        可以將多個提供者組合在一起，在單一程序下執行，以便進一步減少對執行時期資源的佔用。在相同 &lt;group-name&gt; 下註冊的所有提供者會在同一程序下執行。預設情況下，每個提供者會做為獨立的程序執行。
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term><literal>unload</literal>
      </term>
      <listitem>
       <para>
        指定提供者的卸載規則。目前唯一支援的選項為 <option>never</option>，即不監控提供者的閒置時間，也不卸載提供者。預設情況下，當提供者的閒置時間超過組態檔案中指定的值時，就會被卸載。
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term><literal>namespace</literal>
      </term>
      <listitem>
       <para>
        可以執行此提供者之名稱空間的清單。這是必要選項，雖然對大多數提供者而言，此值均為 <replaceable>root/cimv2</replaceable>。
       </para>
      </listitem>
     </varlistentry>
    </variablelist>
    <para>
     在階段區域中儲存所有類別定義和提供者註冊檔案後，需要使用指令 <command>sfcbrepos </command><option>-f</option> 重建 SFCB 類別儲存庫。
    </para>
    <para>
     您可以使用此方式新增、變更或移除類別。重建類別儲存庫後，使用指令 <command>systemctl restart sfcb</command> 重新啟動 SFCB。
    </para>
    <para>
     此外，SFCB 套件還包含一個公用程式，會將提供者類別 mof 檔案和註冊檔案複製到階段區域中的正確位置。
    </para>
    <para>
     <command>sfcbstage </command><option>-r</option> <literal>[provider.reg] [class1.mof] [class2.mof] ...</literal>
    </para>
    <para>
     執行此指令行後，仍需重建類別儲存庫並重新啟動 SFCB 服務。
    </para>
   </sect3>
  </sect2>

  <sect2 xml:id="sec.wbem.advanced.testing">
   <title>測試 SFCB</title>
   <para>
    SFCB 套件包含兩個測試程序檔︰<command>wbemcat</command> 和 <command>xmltest</command>。
   </para>
   <para>
    <command>wbemcat</command> 會透過 HTTP 通訊協定將原始 CIM-XML 資料傳送至在連接埠 5988 上監聽的指定 SFCB 主機 (預設為 localhost)。然後顯示傳回的結果。以下檔案包含標準 EnumerateClasses 請求的 CIM-XML 表示︰
   </para>
<screen>&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;CIM CIMVERSION="2.0" DTDVERSION="2.0"&gt;
  &lt;MESSAGE ID="4711" PROTOCOLVERSION="1.0"&gt;
    &lt;SIMPLEREQ&gt;
      &lt;IMETHODCALL NAME="EnumerateClasses"&gt;
        &lt;LOCALNAMESPACEPATH&gt;
          &lt;NAMESPACE NAME="root"/&gt;
          &lt;NAMESPACE NAME="cimv2"/&gt;
        &lt;/LOCALNAMESPACEPATH&gt;
        &lt;IPARAMVALUE NAME="ClassName"&gt;
          &lt;CLASSNAME NAME=""/&gt;
        &lt;/IPARAMVALUE&gt;
        &lt;IPARAMVALUE NAME="DeepInheritance"&gt;
          &lt;VALUE&gt;TRUE&lt;/VALUE&gt;
        &lt;/IPARAMVALUE&gt;
        &lt;IPARAMVALUE NAME="LocalOnly"&gt;
          &lt;VALUE&gt;FALSE&lt;/VALUE&gt;
        &lt;/IPARAMVALUE&gt;
        &lt;IPARAMVALUE NAME="IncludeQualifiers"&gt;
          &lt;VALUE&gt;FALSE&lt;/VALUE&gt;
        &lt;/IPARAMVALUE&gt;
        &lt;IPARAMVALUE NAME="IncludeClassOrigin"&gt;
          &lt;VALUE&gt;TRUE&lt;/VALUE&gt;
        &lt;/IPARAMVALUE&gt;
      &lt;/IMETHODCALL&gt;
    &lt;/SIMPLEREQ&gt;
  &lt;/MESSAGE&gt;
&lt;/CIM&gt;</screen>
   <para>
    將此請求傳送至 SFCB CIMOM 會傳回有註冊提供者之所有支援類別的清單。假設將檔案儲存為 <filename>cim_xml_test.xml</filename>。
   </para>
<screen><prompt>tux &gt; </prompt>wbemcat cim_xml_test.xml | less
HTTP/1.1 200 OK
Content-Type: application/xml; charset="utf-8"
Content-Length: 337565
Cache-Control: no-cache
CIMOperation: MethodResponse

&lt;?xml version="1.0" encoding="utf-8" ?&gt;
&lt;CIM CIMVERSION="2.0" DTDVERSION="2.0"&gt;
&lt;MESSAGE ID="4711" PROTOCOLVERSION="1.0"&gt;
&lt;SIMPLERSP&gt;
&lt;IMETHODRESPONSE NAME="EnumerateClasses"&gt;
[..]
&lt;CLASS NAME="Linux_DHCPParamsForEntity" SUPERCLASS="CIM_Component"&gt;
&lt;PROPERTY.REFERENCE NAME="GroupComponent" REFERENCECLASS="Linux_DHCPEntity"&gt;
&lt;/PROPERTY.REFERENCE&gt;
&lt;PROPERTY.REFERENCE NAME="PartComponent" REFERENCECLASS="Linux_DHCPParams"&gt;
&lt;/PROPERTY.REFERENCE&gt;
&lt;/CLASS&gt;
&lt;/IRETURNVALUE&gt;
&lt;/IMETHODRESPONSE&gt;
&lt;/SIMPLERSP&gt;
&lt;/MESSAGE&gt;
&lt;/CIM&gt;</screen>
   <para>
    列出的類別會視系統上安裝的提供者而有所不同。
   </para>
   <para>
    第二個程序檔 <command>xmltest</command> 也用於將原始 CIM-XML 測試檔案傳送至 SFCB CIMOM。傳送之後，它會將傳回的結果與之前儲存的<quote>OK</quote>結果檔案進行比較。如果不存在對應的<quote>OK</quote>檔案，則會予以建立，供後續使用。
   </para>
<screen><prompt>tux &gt; </prompt>xmltest cim_xml_test.xml
Running test cim_xml_test.xml ... OK
        Saving response as cim_xml_test.OK
<prompt>root # </prompt>xmltest cim_xml_test.xml
Running test cim_xml_test.xml ... Passed</screen>
  </sect2>

  <sect2 xml:id="sec.wbem.advanced.wbemcli">
   <title>指令行 CIM 用戶端︰wbemcli</title>
   <para>
    除了 <command>wbemcat</command> 與 <command>xmltest</command> 外，SBLIM 專案還包含更進階的指令行 CIM 用戶端 <command>wbemcli</command>。該用戶端用於向 SFCB 伺服器傳送 CIM 請求，並顯示傳回的結果。它不依賴 CIMOM 程式庫，並可用於所有與 WBEM 相容的實作。
   </para>
   <para>
    例如，如果需要列出由註冊到您 SFCB 的 SBLIM 提供者執行的所有類別，可向 SFCB 傳送 <quote>EnumerateClasses</quote> (ec) 要求︰
   </para>
<screen><prompt>tux &gt; </prompt>wbemcli -dx ec http://localhost/root/cimv2
To server: &lt;?xml version="1.0" encoding="utf-8" ?&gt;
&lt;CIM CIMVERSION="2.0" DTDVERSION="2.0"&gt;
&lt;MESSAGE ID="4711" PROTOCOLVERSION="1.0"&gt;&lt;SIMPLEREQ&gt;&lt;IMETHODCALL \
    NAME="EnumerateClasses"&gt;&lt;LOCALNAMESPACEPATH&gt;&lt;NAMESPACE NAME="root"&gt; \
    &lt;/NAMESPACE&gt;&lt;NAMESPACE NAME="cimv2"&gt;&lt;/NAMESPACE&gt; \
    &lt;/LOCALNAMESPACEPATH&gt;
&lt;IPARAMVALUE NAME="DeepInheritance"&gt;&lt;VALUE&gt;TRUE&lt;/VALUE&gt; \
    &lt;/IPARAMVALUE&gt;
&lt;IPARAMVALUE NAME="LocalOnly"&gt;&lt;VALUE&gt;FALSE&lt;/VALUE&gt;&lt;/IPARAMVALUE&gt;
&lt;IPARAMVALUE NAME="IncludeQualifiers"&gt;&lt;VALUE&gt;FALSE&lt;/VALUE&gt; \
    &lt;/IPARAMVALUE&gt;
&lt;IPARAMVALUE NAME="IncludeClassOrigin"&gt;&lt;VALUE&gt;TRUE&lt;/VALUE&gt; \
    &lt;/IPARAMVALUE&gt;
&lt;/IMETHODCALL&gt;&lt;/SIMPLEREQ&gt;
&lt;/MESSAGE&gt;&lt;/CIM&gt;
From server: Content-Type: application/xml; charset="utf-8"
From server: Content-Length: 337565
From server: Cache-Control: no-cache
From server: CIMOperation: MethodResponse
From server: &lt;?xml version="1.0" encoding="utf-8" ?&gt;
&lt;CIM CIMVERSION="2.0" DTDVERSION="2.0"&gt;
&lt;MESSAGE ID="4711" PROTOCOLVERSION="1.0"&gt;
&lt;SIMPLERSP&gt;
&lt;IMETHODRESPONSE NAME="EnumerateClasses"&gt;
&lt;IRETURNVALUE&gt;
&lt;CLASS NAME="CIM_ResourcePool" SUPERCLASS="CIM_LogicalElement"&gt;
&lt;PROPERTY NAME="Generation" TYPE="uint64"&gt;
&lt;/PROPERTY&gt;
&lt;PROPERTY NAME="ElementName" TYPE="string"&gt;
&lt;/PROPERTY&gt;
&lt;PROPERTY NAME="Description" TYPE="string"&gt;
&lt;/PROPERTY&gt;
&lt;PROPERTY NAME="Caption" TYPE="string"&gt;
&lt;/PROPERTY&gt;
&lt;PROPERTY NAME="InstallDate" TYPE="datetime"&gt;
&lt;/PROPERTY&gt;
[..]
&lt;CLASS NAME="Linux_ReiserFileSystem" SUPERCLASS="CIM_UnixLocalFileSystem"&gt;
&lt;PROPERTY NAME="FSReservedCapacity" TYPE="uint64"&gt;
&lt;/PROPERTY&gt;
&lt;PROPERTY NAME="TotalInodes" TYPE="uint64"&gt;
&lt;/PROPERTY&gt;
&lt;PROPERTY NAME="FreeInodes" TYPE="uint64"&gt;
&lt;/PROPERTY&gt;
&lt;PROPERTY NAME="ResizeIncrement" TYPE="uint64"&gt;
&lt;VALUE&gt;0&lt;/VALUE&gt;
&lt;/PROPERTY&gt;
&lt;PROPERTY NAME="IsFixedSize" TYPE="uint16"&gt;
&lt;VALUE&gt;0&lt;/VALUE&gt;
&lt;/PROPERTY&gt;
[..]</screen>
   <para>
    <option>-dx</option> 選項會顯示由 <command>wbemcli</command> 傳送至 SFCB 的實際 XML，以及實際收到的 XML。在上例中，傳回的第一個類別是 <literal>CIM_ResourcePool</literal>，然後是 <literal>Linux_ReiserFileSystem</literal>。所有其他註冊類別也會顯示類似的項目。
   </para>
   <para>
    如果省略 <option>-dx</option> 選項，則 <command>wbemcli</command> 只會顯示傳回資料的精簡表示︰
   </para>
<screen><prompt>tux &gt; </prompt>wbemcli ec http://localhost/root/cimv2
localhost:5988/root/cimv2:CIM_ResourcePool Generation=,ElementName=, \
    Description=,Caption=,InstallDate=,Name=,OperationalStatus=, \
    StatusDescriptions=,Status=,HealthState=,PrimaryStatus=, \
    DetailedStatus=,OperatingStatus=,CommunicationStatus=,InstanceID=, \
    PoolID=,Primordial=,Capacity=,Reserved=,ResourceType=, \
    OtherResourceType=,ResourceSubType=, \AllocationUnits=
localhost:5988/root/cimv2:Linux_ReiserFileSystem FSReservedCapacity=, \
    TotalInodes=,FreeInodes=,ResizeIncrement=,IsFixedSize=,NumberOfFiles=, \
    OtherPersistenceType=,PersistenceType=,FileSystemType=,ClusterSize=, \
    MaxFileNameLength=,CodeSet=,CasePreserved=,CaseSensitive=, \
    CompressionMethod=,EncryptionMethod=,ReadOnly=,AvailableSpace=, \
    FileSystemSize=,BlockSize=,Root=,Name=,CreationClassName=,CSName=, \
    CSCreationClassName=,Generation=,ElementName=,Description=,Caption=, \
    InstanceID=,InstallDate=,OperationalStatus=,StatusDescriptions=, \
    Status=,HealthState=,PrimaryStatus=,DetailedStatus=,OperatingStatus= \
    ,CommunicationStatus=,EnabledState=,OtherEnabledState=,RequestedState= \
    ,EnabledDefault=,TimeOfLastStateChange=,AvailableRequestedStates=, \
    TransitioningToState=,PercentageSpaceUse=
    [..]</screen>
  </sect2>
 </sect1>
 <sect1 xml:id="sec.wbem.moreinfo">
  <title>更多資訊</title>

  <variablelist>
   <title>如需有關 WBEM 和 SFCB 的詳細資料，請參閱以下來源︰</title>
   <varlistentry>
    <term><link xlink:href="http://www.dmtf.org"/>
    </term>
    <listitem>
     <para>
      Distributed Management Task Force 網站
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><link xlink:href="http://www.dmtf.org/standards/wbem/"/>
    </term>
    <listitem>
     <para>
      網路企業管理 (WBEM) 網站
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><link xlink:href="http://www.dmtf.org/standards/cim/"/>
    </term>
    <listitem>
     <para>
      Common Information Model (CIM) 網站
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><link xlink:href="http://sblim.wiki.sourceforge.net/"/>
    </term>
    <listitem>
     <para>
      Standards Based Linux Instrumentation (SBLIM) 網站
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><link xlink:href="http://sblim.sourceforge.net/wiki/index.php/Sfcb"/>
    </term>
    <listitem>
     <para>
      Small Footprint CIM Broker (SFCB) 網站
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><link xlink:href="http://sblim.sourceforge.net/wiki/index.php/Providers"/>
    </term>
    <listitem>
     <para>
      SBLIM 提供者套件
     </para>
    </listitem>
   </varlistentry>
  </variablelist>
 </sect1>
</chapter>
