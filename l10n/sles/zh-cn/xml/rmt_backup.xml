<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="rmt_backup.xml" version="5.0" xml:id="cha-rmt-backup">
 <info>
  <title>备份 RMT 服务器</title>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:translation>yes</dm:translation>
  </dm:docmanager>
 </info>
 <para>
  本章说明如何创建 RMT 服务器的备份以及如何基于备份恢复该服务器。
 </para>
 <sect1 xml:id="sec-rmt-backup-create">
  <title>创建备份</title>
  <para>
   此过程详细说明如何创建 RMT 服务器的完整备份。假设您有一个挂载到 <filename>/mnt/backup</filename> 中用作备份目标的外部磁盘或网络共享。
  </para>
  <procedure>
   <step>
    <para>
     切换到备份目录。
    </para>
    <screen><prompt role="root"># </prompt><command>cd /mnt/backup</command></screen>
   </step>
   <step>
    <para>
     创建包含 SQL 数据库转储的文件。您需要提供安装期间为 <literal>rmt</literal> 数据库用户设置的口令。
    </para>
    <screen><prompt role="root"># </prompt><command>mysqldump -u rmt -p rmt &gt; rmt_backup.sql</command></screen>
   </step>
   <step>
    <para>
     （可选）创建镜像数据的副本。
    </para>
<screen><prompt role="root"># </prompt><command>mkdir repos</command>
<prompt role="root"># </prompt><command>rmt-cli export repos ./repos/</command></screen>
   </step>
  </procedure>
 </sect1>

 <sect1 xml:id="sec-rmt-backup-restore">
  <title>恢复备份</title>
  <para>
   此过程详细说明如何通过<xref linkend="sec-rmt-backup-create"/>中创建的备份恢复 RMT 服务器。假设备份挂载到 <filename>/mnt/backup</filename> 中，并且您要在新安装的 SLES 上恢复服务器。
  </para>
  <procedure>
   <step>
    <para>
     按<xref linkend="cha-rmt-installation"/>中所述安装并配置 RMT 服务器。
    </para>
   </step>
   <step>
    <para>
     转到备份目录。
    </para>
    <screen><prompt role="root"># </prompt><command>cd /mnt/backup/</command></screen>
   </step>
   <step>
    <para>
     使用 <command>mysql</command> 去除新创建的数据库并导入数据。
    </para>
<screen><prompt role="root"># </prompt><command>mysql -u rmt -p</command>
Enter password:
Welcome to the MariaDB monitor.  Commands end with ; or \g.
[...]

<prompt>MariaDB [(none)]&gt;</prompt> <command>DROP DATABASE rmt;</command>
Query OK, 14 rows affected (0.84 sec)

<prompt>MariaDB [(none)]&gt;</prompt> <command>CREATE DATABASE rmt;</command>
Query OK, 1 row affected (0.00 sec)

<prompt>MariaDB [(none)]&gt;</prompt> <command>use rmt;</command>
Database changed

<prompt>MariaDB [rmt]&gt;</prompt> <command>source rmt_backup.sql;</command>
[...]

<prompt>MariaDB [rmt]&gt;</prompt> <command>quit</command></screen>
   </step>
   <step>
    <para>
     （可选）导入导出的储存库。
    </para>
    <screen><prompt role="root"># </prompt><command>rmt-cli import repos ./repos/</command></screen>
   </step>
   <step>
    <para>
     同步您的数据并更新储存库。
    </para>
<screen><prompt role="root"># </prompt><command>rmt-cli sync</command>
<prompt role="root"># </prompt><command>rmt-cli mirror</command></screen>
   </step>
  </procedure>
 </sect1>
</chapter>
