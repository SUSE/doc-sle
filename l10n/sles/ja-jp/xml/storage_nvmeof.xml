<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="storage_nvmeof.xml" version="5.0" xml:id="cha-nvmeof" xml:lang="ja">
  <title>NVMe-oF</title>
  <info>
    <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
      <dm:bugtracker/>
      <dm:translation>yes</dm:translation>
    </dm:docmanager>
    <abstract>
      <para>
        この章では、NVMe over Fabricホストおよびターゲットの設定方法について説明します。
      </para>
    </abstract>
  </info>
  <sect1 xml:id="sec-nvmeof-overview">
    <title>概要</title>

    <para>
      <emphasis><trademark class="registered">NVM
      Express</trademark></emphasis> (<emphasis><trademark class="registered">NVMe</trademark></emphasis>)は、不揮発性ストレージ(通常はSSDディスク)にアクセスするためのインタフェース規格です。NVMeはSATAをはるかに上回る処理速度をサポートし、レイテンシも低くなります。
    </para>

    <para>
      <emphasis><trademark class="trade">NVMe-oF</trademark></emphasis>は<emphasis>RDMA</emphasis>、<emphasis>TCP</emphasis>、<emphasis>NVMe over Fibre Channel</emphasis> (<emphasis>FC-NVMe</emphasis>)などの異なるネットワーキングファブリックを介してNVMeストレージにアクセスするためのアーキテクチャです。NVMe-oFの役割はiSCSIと同様です。耐障害性を向上させるため、NVMe-oFにはマルチパスのサポートが組み込まれています。NVMe-oFマルチパスは、従来のデバイスマッパーマルチパスに基づいていません。
    </para>

    <para>
      NVMeホストは、NVMeターゲットに接続するマシンです。NVMeターゲットは、そのNVMeブロックデバイスを共有するマシンです。
    </para>

    <para>
      NVMeはSUSE Linux Enterprise Server <phrase role="productnumber"><phrase os="sles;sled">15 SP6</phrase></phrase>でサポートされています。NVMeブロックストレージおよびNVMe-oFターゲットとホストには、専用のカーネルモジュールが用意されています。
    </para>

    <para>
      ご使用のハードウェアに関する特別な考慮事項があるかどうかを確認するには、<xref linkend="sec-nvmeof-hardware"/>を参照してください。
    </para>
  </sect1>
  <sect1 xml:id="sec-nvmeof-host-configuration">
    <title>NVMe-oFホストの設定</title>

    <para>
      NVMe-oFを使用するには、サポートされているネットワーキング方法のいずれかでターゲットを使用可能にする必要があります。NVMe over Fibre Channel、TCP、およびRDMAがサポートされています。以降のセクションでは、NVMe over FabricホストをNVMeターゲットに接続する方法について説明します。
    </para>

    <sect2 xml:id="sec-nvmeof-host-configuration-cli">
      <title>コマンドラインクライアントのインストール</title>
      <para>
        NVMe-oFを使用するには、<command>nvme</command>コマンドラインツールが必要です。インストールするには、<command>zypper</command>を実行します。
      </para>
<screen><prompt>&gt; </prompt><command>sudo</command> <command>zypper in nvme-cli</command></screen>
      <para>
        すべての使用可能なサブコマンドを一覧にするには、<command>nvme --help</command>を使用します。<command>nvme</command>サブコマンド用のマニュアルページが提供されています。<command>man
        nvme-<replaceable>SUBCOMMAND</replaceable></command>を実行すると、このページを参照できます。たとえば、<option>discover</option>サブコマンドのマニュアルページを参照するには、<command>man nvme-discover</command>を実行します。
      </para>
    </sect2>

    <sect2 xml:id="sec-nvmeof-host-configuration-target-discovery">
      <title>NVMe-oFターゲットの検出</title>
      <para>
        NVMe-oFターゲットで使用可能なNVMeサブシステムを一覧にするには、検出コントローラのアドレスとサービスIDが必要です。
      </para>
<screen><prompt>&gt; </prompt><command>sudo</command> <command>nvme discover -t <replaceable>TRANSPORT</replaceable> -a <replaceable>DISCOVERY_CONTROLLER_ADDRESS</replaceable> -s <replaceable>SERVICE_ID</replaceable></command></screen>
      <para>
        <replaceable>TRANSPORT</replaceable>は、基盤となる転送メディア(<option>loop</option>、<option>rdma</option>、<option>tcp</option>、または<option>fc</option>)で置き換えます。<replaceable>DISCOVERY_CONTROLLER_ADDRESS</replaceable>は、検出コントローラのアドレスで置き換えます。RDMAとTCPの場合、これはIPv4アドレスである必要があります。<replaceable>SERVICE_ID</replaceable>は、転送サービスIDで置き換えます。RDMAまたはTCPのように、サービスがIPベースの場合、サービスIDはポート番号を指定します。ファイバチャネルの場合、サービスIDは必要ありません。
      </para>
      <para>
        NVMeホストは、接続が許可されているサブシステムのみを参照します。
      </para>
      <para>
        例:
      </para>
<screen><prompt>&gt; </prompt><command>sudo</command> nvme discover -t tcp -a 10.0.0.3 -s 4420</screen>
      <para>
        FCの場合、次のようになります。
      </para>
<screen><prompt>&gt; </prompt><command>sudo</command> nvme discover --transport=fc \
                --traddr=nn-0x201700a09890f5bf:pn-0x201900a09890f5bf \
                --host-traddr=nn-0x200000109b579ef6:pn-0x100000109b579ef6</screen>
      <para>
        詳細については、<command>man nvme-discover</command>を参照してください。
      </para>
    </sect2>

    <sect2 xml:id="sec-nvmeof-host-configuration-connect-target">
      <title>NVMe-oFターゲットへの接続</title>
      <para>
        NVMeサブシステムを特定した後で、<command>nvme connect</command>コマンドを使用して接続できます。
      </para>
<screen><prompt>&gt; </prompt><command>sudo</command> <command>nvme connect -t <replaceable>transport</replaceable> -a <replaceable>DISCOVERY_CONTROLLER_ADDRESS</replaceable> -s <replaceable>SERVICE_ID</replaceable> -n <replaceable>SUBSYSTEM_NQN</replaceable></command></screen>
      <para>
        <replaceable>TRANSPORT</replaceable>は、基盤となる転送メディア(<option>loop</option>、<option>rdma</option>、<option>tcp</option>または<option>fc</option>)で置き換えます。<replaceable>DISCOVERY_CONTROLLER_ADDRESS</replaceable>は、検出コントローラのアドレスで置き換えます。RDMAとTCPの場合、これはIPv4アドレスである必要があります。<replaceable>SERVICE_ID</replaceable>は、転送サービスIDで置き換えます。RDMAまたはTCPのように、サービスがIPベースの場合、これはポート番号を指定します。<replaceable>SUBSYSTEM_NQN</replaceable>は、検出コマンドによって検出された、目的のサブシステムのNVMe修飾名で置き換えます。NQNは、NVMe修飾名(NVMe Qualified Name)の略語です。NQNは固有である必要があります。
      </para>
      <para>
        例:
      </para>
<screen><prompt>&gt; </prompt><command>sudo</command> <command>nvme connect -t tcp -a 10.0.0.3 -s 4420 -n nqn.2014-08.com.example:nvme:nvm-subsystem-sn-d78432</command></screen>
      <para>
        FCの場合、次のようになります。
      </para>
<screen><prompt>&gt; </prompt><command>sudo</command> nvme connect --transport=fc \
             --traddr=nn-0x201700a09890f5bf:pn-0x201900a09890f5bf \
             --host-traddr=nn-0x200000109b579ef6:pn-0x100000109b579ef6 \
             --nqn=nqn.2014-08.org.nvmexpress:uuid:1a9e23dd-466e-45ca-9f43-a29aaf47cb21</screen>
      <para>
        または、<command>nvme connect-all</command>を使用して、すべての検出されたネームスペースに接続します。高度な使用法については、<command>man
        nvme-connect</command>および<command>man nvme-connect-all</command>を参照してください。
      </para>
      <para>
        パスが失われると、NVMeサブシステムでは、<command>nvme connect</command>コマンドの<literal>ctrl-loss-tmo</literal>オプションで定義された時間、再接続しようとします。この時間(デフォルト値は600秒)が経過したら、パスが削除され、ブロックレイヤの上位レイヤ(ファイルシステム)に通知されます。デフォルトでは、ファイルシステムは、読み取り専用にマウントされます。これは通常望ましい動作ではありません。したがって、NVMeサブシステムが制限なしで再接続を試行し続けるように<literal>ctrl-loss-tmo</literal>オプションを設定することをお勧めします。そのためには、次のコマンドを実行します。
      </para>
<screen><prompt>&gt; </prompt><command>sudo</command> nvme connect --ctrl-loss-tmo=-1</screen>
      <para>
        NVMe over Fabricsサブシステムを起動時に使用できるようにするには、ホストに<filename>/etc/nvme/discovery.conf</filename>ファイルを作成し、パラメータを<command>discover</command>コマンドに渡します(<xref linkend="sec-nvmeof-host-configuration-target-discovery"/>を参照)。たとえば、次のように<command>discover</command>コマンドを使用します。
      </para>
<screen><prompt>&gt; </prompt><command>sudo</command> nvme discover -t tcp -a 10.0.0.3 -s 4420</screen>
      <para>
        <command>discover</command>コマンドのパラメータを<filename>/etc/nvme/discovery.conf</filename>ファイルに追加します。
      </para>
<screen>echo "-t tcp -a 10.0.0.3 -s 4420" | sudo tee -a /etc/nvme/discovery.conf</screen>
      <para>
        次に、<guimenu>nvmf-autoconnect</guimenu>サービスを有効にします。
      </para>
<screen><prompt>&gt; </prompt><command>sudo</command> systemctl enable nvmf-autoconnect.service</screen>
    </sect2>

    <sect2 xml:id="sec-nvmeof-host-configuration-multipathing">
      <title>マルチパス処理</title>
      <para>
        NVMeネイティブマルチパス処理はデフォルトで有効になっています。コントローラID設定の<option>CMIC</option>オプションが設定されている場合、NVMeスタックはNVMEドライブをデフォルトでマルチパスデバイスとして認識します。
      </para>
      <para>
        マルチパスを管理するには、以下を使用できます。
      </para>
      <variablelist>
        <title>マルチパスの管理</title>
        <varlistentry>
          <term><command>nvme list-subsys</command></term>
          <listitem>
            <para>
              マルチパスデバイスのレイアウトを印刷します。
            </para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term><command>multipath -ll</command></term>
          <listitem>
            <para>
              コマンドには互換性モードがあり、NVMeマルチパスデバイスを表示します。<literal>enable_foreign</literal>オプションを有効にしてこのコマンドを使用する必要があることに留意してください。詳細については、<xref linkend="sec-multipath-conf-misc"/>を参照してください。
            </para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term><option>nvme-core.multipath=N</option></term>
          <listitem>
            <para>
              オプションがブートパラメータとして追加されると、NVMeネイティブマルチパスが無効になります。
            </para>
          </listitem>
        </varlistentry>
      </variablelist>
    </sect2>
  </sect1>
  <sect1 xml:id="sec-nvmeof-target-configuration">
    <title>NVMe-oFターゲットの設定</title>

    <sect2 xml:id="sec-nvmeof-target-configuration-cli">
      <title>コマンドラインクライアントのインストール</title>
      <para>
        NVMe-oFターゲットを設定するには、<command>nvmetcli</command>コマンドラインツールが必要です。インストールするには、<command>zypper</command>を実行します。
      </para>
<screen><prompt>&gt; </prompt><command>sudo</command> <command>zypper in nvmetcli</command></screen>
      <para>
        <command>nvmetcli</command>の現在のドキュメントは<link xlink:href="https://git.infradead.org/users/hch/nvmetcli.git/blob_plain/HEAD:/Documentation/nvmetcli.txt"/>から入手できます。
      </para>
    </sect2>

    <sect2 xml:id="sec-nvmeof-target-configuration-steps">
      <title>設定手順</title>
      <para>
        次の手順に、NVMe-oFターゲットの設定方法の例を示します。
      </para>
      <para>
        設定はツリー構造で格納されます。移動するには、<command>cd</command>コマンドを使用します。オブジェクトを一覧にするには、<command>ls</command>を使用します。<command>create</command>を使用して新しいオブジェクトを作成できます。
      </para>
      <procedure>
        <step>
          <para>
            <command>nvmetcli</command>インタラクティブシェルを起動します。
          </para>
<screen><prompt>&gt; </prompt><command>sudo</command> <command>nvmetcli</command></screen>
        </step>
        <step>
          <para>
            新しいポートを作成します。
          </para>
<screen><prompt>(nvmetcli)&gt; </prompt><command>cd ports</command>
<prompt>(nvmetcli)&gt; </prompt><command>create 1</command>
<prompt>(nvmetcli)&gt; </prompt><command>ls 1/</command>
o- 1
  o- referrals
  o- subsystems</screen>
        </step>
        <step>
          <para>
            NVMeサブシステムを作成します。
          </para>
<screen><prompt>(nvmetcli)&gt; </prompt><command>cd /subsystems</command>
<prompt>(nvmetcli)&gt; </prompt><command>create nqn.2014-08.org.nvmexpress:NVMf:uuid:c36f2c23-354d-416c-95de-f2b8ec353a82</command>
<prompt>(nvmetcli)&gt; </prompt><command>cd nqn.2014-08.org.nvmexpress:NVMf:uuid:c36f2c23-354d-416c-95de-f2b8ec353a82/</command>
<prompt>(nvmetcli)&gt; </prompt><command>ls</command>
o- nqn.2014-08.org.nvmexpress:NVMf:uuid:c36f2c23-354d-416c-95de-f2b8ec353a82
  o- allowed_hosts
  o- namespaces</screen>
        </step>
        <step>
          <para>
            新しいネームスペースを作成し、そのネームスペースにNVMeデバイスを設定します。
          </para>
<screen><prompt>(nvmetcli)&gt; </prompt><command>cd namespaces</command>
<prompt>(nvmetcli)&gt; </prompt><command>create 1</command>
<prompt>(nvmetcli)&gt; </prompt><command>cd 1</command>
<prompt>(nvmetcli)&gt; </prompt><command>set device path=/dev/nvme0n1</command>
Parameter path is now '/dev/nvme0n1'.</screen>
        </step>
        <step>
          <para>
            以前に作成したネームスペースを有効にします。
          </para>
<screen><prompt>(nvmetcli)&gt; </prompt><command>cd ..</command>
<prompt>(nvmetcli)&gt; </prompt><command>enable</command>
The Namespace has been enabled.</screen>
        </step>
        <step>
          <para>
            作成したネームスペースを表示します。
          </para>
<screen><prompt>(nvmetcli)&gt; </prompt><command>cd ..</command>
<prompt>(nvmetcli)&gt; </prompt><command>ls</command>
o- nqn.2014-08.org.nvmexpress:NVMf:uuid:c36f2c23-354d-416c-95de-f2b8ec353a82
  o- allowed_hosts
  o- namespaces
    o- 1</screen>
        </step>
        <step>
          <para>
            すべてのホストがサブシステムを使用できるようにします。この操作は、セキュリティ保護された環境でのみ実行します。
          </para>
<screen><prompt>(nvmetcli)&gt; </prompt><command>set attr allow_any_host=1</command>
Parameter allow_any_host is now '1'.</screen>
          <para>
            または、特定のホストのみが接続できるようにします。
          </para>
<screen><prompt>(nvmetcli)&gt; </prompt><command>cd nqn.2014-08.org.nvmexpress:NVMf:uuid:c36f2c23-354d-416c-95de-f2b8ec353a82/allowed_hosts/</command>
<prompt>(nvmetcli)&gt; </prompt><command>create hostnqn</command></screen>
        </step>
        <step>
          <para>
            すべての作成されたオブジェクトを一覧にします。
          </para>
<screen><prompt>(nvmetcli)&gt; </prompt><command>cd /</command>
<prompt>(nvmetcli)&gt; </prompt><command>ls</command>
o- /
  o- hosts
  o- ports
  | o- 1
  |   o- referrals
  |   o- subsystems
  o- subsystems
    o- nqn.2014-08.org.nvmexpress:NVMf:uuid:c36f2c23-354d-416c-95de-f2b8ec353a82
      o- allowed_hosts
      o- namespaces
        o- 1</screen>
        </step>
        <step>
          <para>
            TCPを介してターゲットを使用できるようにします。RDMAには<literal>trtype=rdma</literal>を使用します。
          </para>
<screen><prompt>(nvmetcli)&gt; </prompt><command>cd ports/1/</command>
<prompt>(nvmetcli)&gt; </prompt><command>set addr adrfam=ipv4 trtype=tcp traddr=10.0.0.3 trsvcid=4420</command>
Parameter trtype is now 'tcp'.
Parameter adrfam is now 'ipv4'.
Parameter trsvcid is now '4420'.
Parameter traddr is now '10.0.0.3'.</screen>
          <para>
            または、ファイバチャネルを介して使用可能にすることができます。
          </para>
<screen><prompt>(nvmetcli)&gt; </prompt><command>cd ports/1/</command>
<prompt>(nvmetcli)&gt; </prompt><command>set addr adrfam=fc trtype=fc traddr=nn-0x1000000044001123:pn-0x2000000055001123 trsvcid=none</command></screen>
        </step>
        <step>
          <para>
            サブシステムをポートにリンクします。
          </para>
<screen><prompt>(nvmetcli)&gt; </prompt><command>cd /ports/1/subsystems</command>
<prompt>(nvmetcli)&gt; </prompt><command>create nqn.2014-08.org.nvmexpress:NVMf:uuid:c36f2c23-354d-416c-95de-f2b8ec353a82</command>
      </screen>
          <para>
            <command>dmesg</command>を使用してポートが有効になっていることを確認できるようになりました。
          </para>
<screen><prompt role="root"># </prompt>dmesg
        ...
[  257.872084] nvmet_tcp: enabling port 1 (10.0.0.3:4420)
      </screen>
        </step>
      </procedure>
    </sect2>

    <sect2 xml:id="sec-nvmeof-target-configuration-backup-configuration">
      <title>ターゲット設定のバックアップと復元</title>
      <para>
        次のコマンドを使用してJSONファイルにターゲット設定を保存できます。
      </para>
<screen><prompt>&gt; </prompt><command>sudo</command> <command>nvmetcli</command>
<prompt>(nvmetcli)&gt; </prompt><command>saveconfig nvme-target-backup.json</command></screen>
      <para>
        設定を復元するには、次のコマンドを使用します。
      </para>
<screen><prompt>(nvmetcli)&gt; </prompt><command>restore nvme-target-backup.json</command></screen>
      <para>
        現在の設定を消去することもできます。
      </para>
<screen><prompt>(nvmetcli)&gt; </prompt><command>clear</command></screen>
    </sect2>
  </sect1>
  <sect1 xml:id="sec-nvmeof-hardware">
    <title>特定のハードウェアの設定</title>

    <sect2 xml:id="sec-nvmeof-hardware-overview">
      <title>概要</title>
      <para>
        一部のハードウェアでは、正しく動作させるために特殊な設定が必要です。次の各セクションの見出しを参照し、記載されているデバイスまたはベンダのいずれかに該当しないか確認してください。
      </para>
    </sect2>

    <sect2 xml:id="sec-nvmeof-hardware-broadcom">
      <title>Broadcom</title>
      <para>
        <emphasis>Broadcom Emulex LightPulse Fibre Channel SCSI</emphasis>ドライバを使用している場合は、<literal>lpfc</literal>モジュールのターゲットおよびホスト上にカーネル設定パラメータを追加します。
      </para>
<screen><prompt>&gt; </prompt><command>sudo</command> <command>echo "options lpfc lpfc_enable_fc4_type=3" &gt; /etc/modprobe.d/lpfc.conf</command></screen>
      <para>
        Broadcomアダプタファームウェアのバージョンが11.4.204.33以降であることを確認します。現在のバージョンの<package>nvme-cli</package>、<package>nvmetcli</package>、およびカーネルがインストールされていることも確認します。
      </para>
      <para>
        ファイバチャネルポートをNVMeターゲットとして有効にするには、追加のモジュールパラメータを設定する必要があります。たとえば、<option>lpfc_enable_nvmet=<replaceable>
        COMMA_SEPARATED_WWPNS</replaceable></option>と指定します。先行する<literal>0x</literal>とともにWWPNを入力します。たとえば、<option>lpfc_enable_nvmet=0x2000000055001122,0x2000000055003344</option>と指定します。一覧表示されているWWPNのみがターゲットモードに設定されます。ファイバチャネルポートは、ターゲットまたはイニシエータとして設定できます。
      </para>
    </sect2>

    <sect2 xml:id="sec-nvmeof-hardware-marvell">
      <title>Marvell</title>
      <para>
        FC-NVMeは、QLE269xおよびQLE27xxアダプタでサポートされています。FC-NVMeのサポートは、Marvell® QLogic® QLA2xxxファイバチャネルドライバでデフォルトで有効になっています。
      </para>
      <para>
        NVMeが有効になっていることを確認するには、次のコマンドを実行します。
      </para>
<screen><prompt>&gt; </prompt>cat /sys/module/qla2xxx/parameters/ql2xnvmeenable</screen>
      <para>
        結果の<literal>1</literal>は、NVMeが有効になっていることを示し、<literal>0</literal>は無効になっていることを示します。
      </para>
      <para>
        次に、Marvellアダプタファームウェアが少なくともバージョン8.08.204であることを次のコマンドの出力をチェックして確認します。
      </para>
<screen><prompt>&gt; </prompt>cat /sys/class/scsi_host/host0/fw_version</screen>
      <para>
        最後に、<phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase>で使用可能な最新バージョンの<package>nvme-cli</package>、<package>QConvergeConsoleCLI</package>、およびカーネルがインストールされていることを確認します。たとえば、次を実行して
      </para>
<screen><prompt role="root"># </prompt>zypper lu &amp;&amp; zypper pchk</screen>
      <para>
        更新とパッチを確認します。
      </para>
      <para>
        インストールに関する詳細については、次のMarvellユーザガイドのFC-NVMeのセクションを参照してください。
      </para>
      <itemizedlist>
        <listitem>
          <para>
            <link xlink:href="https://driverdownloads.qlogic.com/QLogicDriverDownloads_UI/ShowEula.aspx?resourceid=32769&amp;docid=96728&amp;ProductCategory=39&amp;Product=1259&amp;Os=126"/>
          </para>
        </listitem>
        <listitem>
          <para>
            <link xlink:href="https://driverdownloads.qlogic.com/QLogicDriverDownloads_UI/ShowEula.aspx?resourceid=32761&amp;docid=96726&amp;ProductCategory=39&amp;Product=1261&amp;Os=126"/>
          </para>
        </listitem>
      </itemizedlist>
    </sect2>
  </sect1>
  <sect1 xml:id="sec-nvmeof-boot">
    <title>NVMe-oF over TCPからのブート</title>

    <para>
      <phrase role="productname"><phrase os="sles">SLES</phrase></phrase>では、<link xlink:href="https://nvmexpress.org/wp-content/uploads/NVM-Express-Boot-Specification-2022.11.15-Ratified.pdf">NVM
      Express® Boot Specification 1.0</link>に従って、NVMe-oF over TCPからのブートをサポートしています。
    </para>

    <para>
      リモートストレージサーバへのNVMe-oF over TCP接続を試行し、これらの接続をブートに使用するように、UEFIプリブート環境を設定できます。プリブート環境では、ACPIテーブル(NVMe Boot Firmware Table (NBFT))を作成し、ブートに使用されるNVMe-oF設定に関する情報を格納します。オペレーティングシステムは後のブートステージでこのテーブルを使用し、ネットワーキングとNVMe-oF接続を設定して、ルートファイルシステムにアクセスします。
    </para>

    <sect2 xml:id="sec-nvmeof-tcp-requirements">
      <title>システム要件</title>
      <para>
        NVMe-oF over TCPからシステムをブートするには、次の要件を満たしている必要があります。
      </para>
      <itemizedlist>
        <listitem>
          <para>
            <phrase role="productname"><phrase os="sles">SLES</phrase></phrase><phrase role="productnumber"><phrase os="sles;sled">15 SP6</phrase></phrase>以降。
          </para>
        </listitem>
        <listitem>
          <para>
            NVMe-oF over TCPをサポートするSANストレージアレイ。
          </para>
        </listitem>
        <listitem>
          <para>
            NVMe-oF over TCPからのブートをサポートするBIOSを備えたホストシステム。この機能のサポートについては、ハードウェアのベンダにお問い合わせください。NVMe-oF over TCPからのブートは現在、UEFIプラットフォームでのみサポートされています。
          </para>
        </listitem>
      </itemizedlist>
    </sect2>

    <sect2 xml:id="sec-install-nvme-tcp">
      <title>インストール</title>
      <para>
        NVMe-oF over TCPから<phrase role="productname"><phrase os="sles">SLES</phrase></phrase>をインストールするには、次の手順に従います。
      </para>
      <procedure>
        <step>
          <para>
            ホストシステムのUEFIセットアップメニューを使用して、ブート時にNVMe-oF接続が確立されるように設定します。通常、ネットワーキング(ローカルIPアドレス、ゲートウェイなど)とNVMe-oFターゲット(リモートIPアドレス、サブシステムNQN、または検出NQN)の両方を設定する必要があります。設定の説明については、ハードウェアのマニュアルを参照してください。ハードウェアベンダが、BIOS設定を一元的かつリモートで管理する手段を提供している場合があります。詳細については、ハードウェアベンダに問い合わせてください。
          </para>
        </step>
        <step>
          <para>
            <xref linkend="book-deployment"/>の説明に従ってインストールを準備します。
          </para>
        </step>
        <step>
          <para>
            サポートされているインストール方法を使用して、システムのインストールを開始します。NVMe-oF over TCPへのインストールを有効にするために、特定のブートパラメータを使用する必要はありません。
          </para>
        </step>
        <step>
          <para>
            BIOSが正しく設定されている場合は、YaSTのディスクパーティション設定ダイアログに、BIOSで設定されたサブシステムによってエクスポートされたNVMeネームスペースが表示されます。これらはNVMeデバイスとして表示され、<literal>tcp</literal>文字列は、デバイスがTCPトランスポートを介して接続されていることを示しています。これらのネームスペースにオペレーティングシステム(特にEFIブートパーティションとルートファイルシステム)をインストールします。
          </para>
        </step>
        <step>
          <para>
            インストールを完了します。
          </para>
        </step>
      </procedure>
      <para>
        インストール後、システムはNVMe-oF over TCPから自動的にブートするはずです。ブートしない場合は、ブートの優先度がBIOSセットアップで正しく設定されているか確認します。
      </para>
      <para>
        ブートに使用されるネットワークインタフェース名は、<literal>nbft0</literal>、<literal>nbft1</literal>などです。NVMe-oFブートに関する情報を取得するには、次のコマンドを実行します。
      </para>
<screen><prompt role="root"># </prompt><command>nvme nbft show</command></screen>
    </sect2>
  </sect1>
  <sect1 xml:id="sec-nvmeof-more-information">
    <title>詳細情報</title>

    <para>
      <command>nvme</command>コマンドの機能の詳細については、<command>nvme nvme-help</command>を参照してください。
    </para>

    <para>
      次のリンクには、NVMeおよびNVMe-oFの概要があります。
    </para>

    <itemizedlist>
      <listitem>
        <para>
          <link xlink:href="https://nvmexpress.org/"/>
        </para>
      </listitem>
      <listitem>
        <para>
          <link xlink:href="https://www.nvmexpress.org/wp-content/uploads/NVMe_Over_Fabrics.pdf"/>
        </para>
      </listitem>
      <listitem>
        <para>
          <link xlink:href="https://storpool.com/blog/demystifying-what-is-nvmeof"/>
        </para>
      </listitem>
    </itemizedlist>
  </sect1>
</chapter>
