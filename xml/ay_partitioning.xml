<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sect1
[
  <!ENTITY % entities SYSTEM "entity-decl.ent">
    %entities;
]>

<sect1 version="5.0" xml:id="CreateProfile-Partitioning"
  xmlns="http://docbook.org/ns/docbook"
  xmlns:xi="http://www.w3.org/2001/XInclude"
  xmlns:xlink="http://www.w3.org/1999/xlink">
  <title>Partitioning</title>

 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:bugtracker></dm:bugtracker>
   <dm:translation>yes</dm:translation>
  </dm:docmanager>
 </info>

  <para>
    When it comes to partitioning, we can categorize &ay; use cases into three
    different levels:
   </para>

   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>
      Automatic partitioning. The user does not care about the partitioning and
      trusts in &ay; to do the right thing.
     </para>
    </listitem>
    <listitem>
     <para>
      Guided partitioning. The user would like to set some basic settings.
      For example, a user would like to use LVM but has no idea about how to configure
      partitions, volume groups, and so on.
     </para>
    </listitem>
    <listitem>
     <para>
      Expert partitioning. The user specifies how the layout should look.
      However, a complete definition is not required, and AutoYaST should propose
      reasonable defaults for missing parts.
     </para>
    </listitem>
   </itemizedlist>

   <para>
    To some extent, it is like using the regular installer. You can skip
    the partitioning screen and trust in &yast;, use the <emphasis>Guided
    Proposal</emphasis>, or define the partitioning layout through the
    <emphasis>Expert Partitioner</emphasis>.
   </para>

   <sect2 xml:id="CreateProfile-Automatic-Partitioning">
    <title>Automatic Partitioning</title>

    <para>
     &ay; can come up with a sensible partitioning layout without any
     user indication. Although it depends on the selected product to install,
     &ay; usually proposes a Btrfs root file system, a separate
     <literal>/home</literal> using XFS and a swap partition. Additionally,
     depending on the architecture, it adds any partition that might be needed
     to boot (like BIOS GRUB partitions).
    </para>

    <para>
     However, these defaults might change depending on factors like the
     available disk space. For example, having a separate <literal>/home</literal>
     depends on the amount of available disk space.
    </para>

    <para>
     If you want to influence these default values, you can use the approach
     described in <xref linkend="CreateProfile-Guided-Partitioning" />.
    </para>
   </sect2>

   <sect2 xml:id="CreateProfile-Guided-Partitioning">
<!-- this section differs from older releases, do not backport, 
      see https://github.com/SUSE/doc-sle/pull/513. (cjs, feb 4 2020) -->       
    <title>Guided Partitioning</title>

    <para>
     Although &ay; can come up with a partitioning layout without any user
     indication, sometimes it is useful to set some generic parameters and let
     &ay; do the rest. For example, you may be interested in using LVM or
     encrypting your file systems without having to deal with the details. It is
     similar to what you would do when using the guided proposal in a regular
     installation.
    </para>

    <para>
     The <literal>storage</literal> section in <xref
     linkend="example-lvm-guided"/> instructs &ay; to set up a partitioning
     layout using LVM and deleting all Windows partitions, no matter whether
     they are needed.
    </para>

    <example xml:id="example-lvm-guided">
     <title>LVM-based Guided Partitioning</title>
     <screen>&lt;general&gt;
   &lt;storage&gt;
     &lt;proposal&gt;
       &lt;lvm config:type="boolean"&gt;true&lt;lvm&gt;
       &lt;windows_delete_mode config:type="symbol"&gt;all&lt;windows_delete_mode&gt;
     &lt;/proposal&gt;
   &lt;storage&gt;
&lt;general&gt;</screen>
    </example>

    <variablelist>
     <varlistentry>
      <term>lvm</term>
      <listitem>
       <para>
        Creates an LVM-based proposal. The default is <literal>false</literal>.
       </para>
       <screen>&lt;lvm config:type="boolean"&gt;true&lt;/lvm&gt;</screen>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>resize_windows</term>
      <listitem>
       <para>
        When set to <literal>true</literal>, &ay; resizes Windows partitions
        if needed to make room for the installation.
       </para>
       <screen>&lt;resize_windows config:type="boolean"&gt;false&lt;/resize_windows&gt;</screen>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>windows_delete_mode</term>
      <listitem>
        <itemizedlist mark="bullet" spacing="normal">
         <listitem>
          <para>
           <literal>none</literal> does not remove Windows partitions.
          </para>
         </listitem>
         <listitem>
          <para>
           <literal>ondemand</literal> removes Windows partitions if needed.
          </para>
         </listitem>
         <listitem>
          <para>
           <literal>all</literal> removes all Windows partitions.
          </para>
         </listitem>
        </itemizedlist>
       <screen>&lt;windows_delete_mode config:type="symbol"&gt;ondemand&lt;/windows_delete_mode&gt;</screen>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>linux_delete_mode</term>
      <listitem>

        <itemizedlist mark="bullet" spacing="normal">
         <listitem>
          <para>
           <literal>none</literal> does not remove Linux partitions.
          </para>
         </listitem>
         <listitem>
          <para>
           <literal>ondemand</literal> removes Linux partitions if needed.
          </para>
         </listitem>
         <listitem>
          <para>
           <literal>all</literal> removes all Linux partitions.
          </para>
         </listitem>
        </itemizedlist>
       <screen>&lt;linux_delete_mode config:type="symbol"&gt;ondemand&lt;/linux_delete_mode&gt;</screen>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>other_delete_mode</term>
      <listitem>
        <itemizedlist mark="bullet" spacing="normal">
         <listitem>
          <para>
           <literal>none</literal> does not remove other partitions.
          </para>
         </listitem>
         <listitem>
          <para>
           <literal>ondemand</literal> removes other partitions if needed.
          </para>
         </listitem>
         <listitem>
          <para>
           <literal>all</literal> removes all other partitions.
          </para>
         </listitem>
        </itemizedlist>
       <screen>&lt;other_delete_mode config:type="symbol"&gt;ondemand&lt;/other_delete_mode&gt;</screen>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>encryption_password</term>
      <listitem>
       <para>
        Enables encryption using the specified password. By default, encryption is disabled.
       </para>
       <screen>&lt;encryption_password&gt;some-secret&lt;/encryption_password&gt;</screen>
      </listitem>
     </varlistentry>
    </variablelist>
   </sect2>

   <sect2 xml:id="CreateProfile-Expert-Partitioning">
    <title>Expert Partitioning</title>

    <para>
     As an alternative to guided partitioning, &ay; allows to describe the
     partitioning layout through a <literal>partitioning</literal>
     section. However, &ay; does not need to know every single detail and is
     able to build a sensible layout from a rather incomplete specification.
    </para>

    <para>
     The <literal>partitioning</literal> section is a list of
     <literal>drive</literal> elements. Each of these sections describes an
     element of the partitioning layout like a disk, an LVM volume group, a
     RAID, a multi-device Btrfs file system, and so on.
    </para>

    <para>
     <xref linkend="example-partitioning"/>, asks &ay; to create a
     <literal>/</literal>, a <literal>/home</literal> and a
     <literal>swap</literal> partition using the whole disk. Note that some
     information is missing, like which file systems each partition should
     use. However, that is not a problem, and &ay; will propose sensible values
     for them.
    </para>

    <example xml:id="example-partitioning">
     <title>Creating <literal>/</literal>, <literal>/home</literal> and
     <literal>swap</literal> partitions</title>
     <screen>&lt;partitioning config:type="list"&gt;
  &lt;drive&gt;
    &lt;use&gt;all&lt;/use&gt;
    &lt;partitions config:type="list"&gt;
      &lt;partition&gt;
        &lt;mount&gt;/&lt;/mount&gt;
        &lt;size&gt;20GiB&lt;/size&gt;
      &lt;/partition&gt;
      &lt;partition&gt;
        &lt;mount&gt;/home&lt;/mount&gt;
        &lt;size&gt;max&lt;/size&gt;
      &lt;/partition&gt;
      &lt;partition&gt;
        &lt;mount&gt;swap&lt;/mount&gt;
        &lt;size&gt;1GiB&lt;/size&gt;
      &lt;/partition&gt;
    &lt;/partitions&gt;
  &lt;/drive&gt;</screen>
    </example>

    <tip xml:id="ay-boot-partition">
     <title>Proposing a Boot Partition</title>
     <para>
      &ay; checks whether the layout described in the profile is bootable or
      not. If it is not, it adds the missing partitions. So, if you are unsure
      about which partitions are needed to boot, you can rely on &ay; to make
      the right decision.
     </para>
    </tip>

    <sect3 xml:id="CreateProfile-Partitioning-config">
     <title>Drive Configuration</title>
     <para>
      The elements listed below must be placed within the following XML
      structure:
     </para>

     <screen>&lt;profile&gt;
  &lt;partitioning config:type="list"&gt;
    &lt;drive&gt;
     ...
    &lt;/drive&gt;
  &lt;/partitioning&gt;
&lt;/profile&gt;</screen>

<variablelist>
    <varlistentry>
        <term>device</term>
        <listitem>
          <para>
           Optional, the device you want to configure. If left out, &ay; tries 
           to guess the device. See
           <xref linkend="ay-partitioning-skip-devices"/> on how to influence
           guessing.
          </para>
          <para>
           If set to <literal>ask</literal>, &ay; will ask the user which device 
           to use during installation.
          </para>
          <para>
            You can use persistent device names via ID, like
           <filename>/dev/disk/by-id/ata-WDC_WD3200AAKS-75L9A0_WD-WMAV27368122</filename>
           or <emphasis>by-path</emphasis>, like
           <filename>/dev/disk/by-path/pci-0001:00:03.0-scsi-0:0:0:0</filename>.
          </para>
          <screen>&lt;device&gt;/dev/sda&lt;/device&gt;</screen>
          <para>
           In case of volume groups, software RAID or &bcache; devices, the name in the installed
           system may be different (to avoid clashes with existing devices).
          </para>
          <para>
           See <xref linkend="ay-partition-multipath"/> for further information
           about dealing with multipath devices.
          </para>
      </listitem>      
  </varlistentry>
  
  <varlistentry>
      <term>initialize</term>
      <listitem>
          <para>
              Optional, the default is <literal>false</literal>. If set to 
              <literal>true</literal>, the partition table is wiped
           out before &ay; starts the partition calculation.
          </para>
          <screen>&lt;initialize config:type="boolean"&gt;true&lt;/initialize&gt;</screen>
      </listitem>
  </varlistentry>
  
  <varlistentry>
      <term>partitions</term>
      <listitem>
          <para>Optional, a list of <literal>&lt;partition&gt;</literal> entries 
              (see <xref linkend="ay-partition-configuration"/>).
          </para>
          <screen>&lt;partitions config:type="list"&gt;
          &lt;partition&gt;...&lt;/partition&gt;
          ...
          &lt;/partitions&gt;</screen>
          <para>
          If no partitions are specified, &ay; will create a reasonable 
          partitioning layout (see
           <xref linkend="ay-auto-partitioning"/>).
          </para>
      </listitem>
  </varlistentry>  
  <varlistentry>
      <term>pesize</term>
      <listitem>
          <para>
              Optional, for LVM only. The default is 4M for LVM volume groups.
          </para>
          <screen>&lt;pesize&gt;8M&lt;/pesize&gt;</screen>
      </listitem>
  </varlistentry>
  
  <varlistentry>
      <term>use</term>
      <listitem>
          <para>
           Recommended, specifies the strategy &ay; will use to partition the hard
           disk. Choose from:
          </para>
          <para>
             <literal>all</literal>, uses the whole device while calculating
             the new partitioning.
          </para>
          <para>
             <literal>linux</literal>, only existing Linux partitions are
             used.
          </para>
          <para>
             <literal>free</literal>, only unused space on the device is
             used, no existing partitions are touched.
          </para>
          <para>
             <replaceable>1,2,3</replaceable>, a list of comma-separated partition 
             numbers to use.
          </para>
      </listitem>
  </varlistentry>
  
  <varlistentry>
      <term>type</term>
      <listitem>
          <para>
              Optional, specify the type of the <literal>drive</literal>. The
              default is <literal>CT_DISK</literal> for a normal physical hard 
              disk. The following is a list of all options:
          </para>
          <para>
            <literal>CT_DISK</literal> for physical hard disks (default).
           </para>
           <para>
            <literal>CT_LVM</literal> for LVM volume groups.
           </para>
           <para>
            <literal>CT_MD</literal> for software RAID devices.
           </para>
           <para>
            <literal>CT_BCACHE</literal> for software &bcache; devices.
           </para>
           <para>
            <literal>CT_BTRFS</literal> for multi-device Btrfs file systems.
           </para>
           <para>
            <literal>CT_NFS</literal> for NFS file systems.
           </para>
           <para>
            <literal>CT_TMPFS</literal> for <literal>tmpfs</literal> file systems.
           </para>
          <screen>&lt;type config:type="symbol"&gt;CT_LVM&lt;/type&gt;</screen>
      </listitem>
  </varlistentry>
  
  <varlistentry>
      <term>disklabel</term>
      <listitem>
          <para>
              Optional. By default &yast; decides what makes sense. If a 
              partition table of a different type already exists, it will be 
              recreated with the given type only if it does not include any 
              partition that should be kept or reused. To use the disk without 
              creating any partition, set this element to <literal>none</literal>.
              The following is a list of all options:
          </para>
          <para>
             <literal>msdos</literal>
            </para>
            <para>
             <literal>gpt</literal>
            </para>
            <para>
             <literal>none</literal>
            </para>
          <screen>&lt;disklabel&gt;gpt&lt;/disklabel&gt;</screen>
      </listitem>
  </varlistentry>
  
  <varlistentry>
      <term>keep_unknown_lv</term>
      <listitem>
          <para>
           Optional, the default is <literal>false</literal>.
          </para>
          <para>
           This value only makes sense for type=CT_LVM drives. If you are
           reusing a logical volume group and you set this to
           <literal>true</literal>, all existing logical volumes in that
           group will not be touched unless they are specified in the
           &lt;partitioning&gt; section. So you can keep existing
           logical volumes without specifying them.
          </para>
          <screen>&lt;keep_unknown_lv config:type="boolean"&gt;false&lt;/keep_unknown_lv&gt;</screen>          
      </listitem>
  </varlistentry> 
  
  <varlistentry>
      <term>enable_snapshots</term>
      <listitem>
          <para>
           Optional, the default is <literal>true</literal>.
          </para>
          <para>
           Enables snapshots on Btrfs file systems mounted at <literal>/</literal>
           (does not apply to other file systems, or Btrfs file systems not mounted
           at <literal>/</literal>).
          </para>
          <screen>&lt;enable_snapshots config:type="boolean"&gt;false&lt;/enable_snapshots&gt;</screen>          
      </listitem>
  </varlistentry>
  <varlistentry>
      <term>quotas</term>
      <listitem>
          <para>
           Optional, the default is <literal>false</literal>.
          </para>
          <para>
           Enables support for Btrfs subvolumes quotas. Setting this element to 
           <literal>true</literal> will enable support for quotas for the file 
           system. However, you need to set the limits for each subvolume. Check 
           <xref linkend="ay-btrfs-subvolumes"/> for further information. 
          </para>
          <screen>&lt;quotas config:type="boolean"&gt;true&lt;/quotas&gt;</screen>          
      </listitem>
  </varlistentry>
</variablelist>

     <important>
      <title>Beware of Data Loss</title>
      <para>
       The value provided in the <literal>use</literal> property determines
       how existing data and partitions are treated. The value
       <literal>all</literal> means that the entire disk will be erased. Make
       backups and use the <literal>confirm</literal> property if you need to
       keep some partitions with important data. Otherwise, no pop-ups will
       notify you about partitions being deleted.
      </para>
     </important>

     <tip xml:id="ay-partitioning-skip-devices">
      <title>Skipping Devices</title>
      <para>
       You can influence &ay;'s device-guessing for cases where you do not
       specify a &lt;device&gt; entry on your own. Usually &ay;
       would use the first device it can find that looks reasonable but you
       can configure it to skip some devices like this:
      </para>
      <screen>&lt;partitioning config:type="list"&gt;
  &lt;drive&gt;
    &lt;initialize config:type="boolean"&gt;true&lt;/initialize&gt;
    &lt;skip_list config:type="list"&gt;
      &lt;listentry&gt;
        &lt;!-- skip devices that use the usb-storage driver --&gt;
        &lt;skip_key&gt;driver&lt;/skip_key&gt;
        &lt;skip_value&gt;usb-storage&lt;/skip_value&gt;
      &lt;/listentry&gt;
      &lt;listentry&gt;
        &lt;!-- skip devices that are smaller than 1GB --&gt;
        &lt;skip_key&gt;size_k&lt;/skip_key&gt;
        &lt;skip_value&gt;1048576&lt;/skip_value&gt;
        &lt;skip_if_less_than config:type="boolean"&gt;true&lt;/skip_if_less_than&gt;
      &lt;/listentry&gt;
      &lt;listentry&gt;
        &lt;!-- skip devices that are larger than 100GB --&gt;
        &lt;skip_key&gt;size_k&lt;/skip_key&gt;
        &lt;skip_value&gt;104857600&lt;/skip_value&gt;
        &lt;skip_if_more_than config:type="boolean"&gt;true&lt;/skip_if_more_than&gt;
      &lt;/listentry&gt;
    &lt;/skip_list&gt;
  &lt;/drive&gt;
&lt;/partitioning&gt;</screen>
      <para>
       For a list of all possible &lt;skip_key&gt;s, run <command>yast2
       ayast_probe</command> on a system that has already been installed.
      </para>
     </tip>
    </sect3>

    <sect3 xml:id="ay-partition-configuration">
     <title>Partition Configuration</title>
     <para>
      The elements listed below must be placed within the following XML
      structure:
     </para>
     <screen>&lt;drive&gt;
  &lt;partitions config:type="list"&gt;
    &lt;partition&gt;
      ...
    &lt;/partition&gt;
  &lt;/partitions&gt;
&lt;/drive&gt;</screen>
     <variablelist>
         <varlistentry>
             <term>create</term>
             <listitem>
                 <para>
                     Specify if this partition or logical volume must be created, 
                     or if it already exists. If set to <literal>false</literal>, 
                     you also need to set one of <literal>partition_nr</literal>, <literal>lv_name</literal>, <literal>label</literal>, or <literal>uuid</literal> to tell &ay; which device to use.
                 </para>
<screen>&lt;create config:type="boolean"&gt;false&lt;/create&gt;</screen>                 
             </listitem>
         </varlistentry>
     </variablelist>
     
     <variablelist>
         <varlistentry>
             <term>crypt_method</term>
             <listitem>
                 <para>
                     Optional, the partition will be encrypted using one of these methods:
                 </para>
                     <itemizedlist mark="bullet" spacing="normal">
           <listitem>
            <para>
             <literal>luks1</literal>: regular LUKS1 encryption.
            </para>
           </listitem>
           <listitem>
            <para>
             <literal>pervasive_luks2</literal>: pervasive volume encryption.
            </para>
           </listitem>
           <listitem>
            <para>
             <literal>protected_swap</literal>: encryption with volatile
             protected key.
            </para>
           </listitem>
           <listitem>
            <para>
             <literal>secure_swap</literal>: encryption with volatile secure key.
            </para>
           </listitem>
           <listitem>
            <para>
             <literal>random_swap</literal>: encryption with volatile random key.
            </para>
           </listitem>
          </itemizedlist>
          <screen>&lt;crypt_method config:type="symbol"&gt;luks1&lt;/crypt_method&gt;</screen>
          <para>
          Encryption method selection was introduced in &productname;
           <phrase os="sles;sled">15 SP2</phrase><phrase os="osuse">15.2</phrase>.
           To mimic the behavior of previous versions, use <literal>luks1</literal>.
          </para>
          <para>
           See <literal>crypt_key</literal> element to learn how to specify
           the encryption password if needed.
          </para>
             </listitem>
         </varlistentry>
     </variablelist>

     <variablelist>
         <varlistentry>
             <term>crypt_fs</term>
             <listitem>
                 <para>
                     Partition will be encrypted, the default is 
                     <literal>false</literal>. This element is deprecated. Use
                     <literal>crypt_method</literal> instead.
                 </para>
<screen>&lt;crypt_fs config:type="boolean"&gt;true&lt;/crypt_fs&gt;</screen>
             </listitem>
         </varlistentry>
     </variablelist>

     <variablelist>
         <varlistentry>
             <term>crypt_key</term>
             <listitem>
                 <para>
                     Required if <literal>crypt_method</literal> has been set to
                     a method that requires a password (i.e., 
                     <literal>luks1</literal> or 
                     <literal>pervasive_luks2</literal>).
                 </para>
<screen>&lt;crypt_key&gt;xxxxxxxx&lt;/crypt_key&gt;</screen>                 
             </listitem>
         </varlistentry>
     </variablelist>      
     
     <variablelist>
         <varlistentry>
             <term>mount</term>
             <listitem>
                 <para>
                     You should have at least a root partition (/) and a swap
                     partition.
                 </para>
 <screen>&lt;mount&gt;/&lt;/mount&gt;&lt;mount&gt;swap&lt;/mount&gt;</screen>                
             </listitem>
         </varlistentry>
     </variablelist>

     <variablelist>
         <varlistentry>
             <term>fstopt</term>
             <listitem>
                 <para>
                     Mount options for this partition; see 
                     <command>man mount</command> for available mount options.
                 </para>
<screen>&lt;fstopt&gt;ro,noatime,user,data=ordered,acl,user_xattr&lt;/fstopt&gt;</screen>                 
             </listitem>
         </varlistentry>
     </variablelist>  
     
       <variablelist>
         <varlistentry>
             <term>label</term>
             <listitem>
                 <para>
                     The label of the partition. Useful when formatting the device
                      (especially if the <literal>mountby</literal> parameter is
                      set to <literal>label</literal>) and for identifying a 
                      device that already exists (see <literal>create</literal> 
                      above). See <command>man e2label</command> for an example.
                 </para>
<screen>&lt;label&gt;mydata&lt;/label&gt;</screen>               
             </listitem>
         </varlistentry>
     </variablelist>  
     
       <variablelist>
         <varlistentry>
             <term>uuid</term>
             <listitem>
                 <para>
                      The uuid of the partition. Only useful for identifying an
                      existing device (see <literal>create</literal> above). The
                      uuid cannot be enforced for new devices. (See
                      <command>man uuidgen</command>.)
                 </para>
<screen>&lt;uuid&gt;1b4e28ba-2fa1-11d2-883f-b9a761bde3fb&lt;/uuid&gt;</screen>                
             </listitem>
         </varlistentry>
     </variablelist>

       <variablelist>
         <varlistentry>
             <term>size</term>
             <listitem>
                 <para>
                      The size of the partition, for example 4G, 4500M, etc. The 
                      /boot partition and the swap partition can have 
                      <literal>auto</literal> as size. Then &ay; calculates a
                      reasonable size. One partition can have the value 
                      <literal>max</literal> to use all remaining space.
                 </para>
                 <para>
                      You can also specify the size in percentage. So 10% will 
                      use 10% of the size of the hard disk or volume group. You 
                      can mix <literal>auto</literal>, <literal>max</literal>,
                      <literal>size</literal>, and percentage as you like.
                 </para>
<screen>&lt;size&gt;10G&lt;/size&gt;</screen>                    
                 <para>
                     Starting with &productname; 15, all values (including
                     <literal>auto</literal> and <literal>max</literal>) can be
                     used for resizing partitions as well.
                 </para>
             </listitem>
         </varlistentry>
     </variablelist>  
     
       <variablelist>
         <varlistentry>
             <term>format</term>
             <listitem>
                 <para>
                     Specify if &ay; should format the partition. If you set
                     <literal>create</literal> to <literal>true</literal>,
                     then you likely want this option set to 
                     <literal>true</literal> as well. 
                 </para>
<screen>&lt;format config:type="boolean"&gt;false&lt;/format&gt;</screen>                
             </listitem>
         </varlistentry>
     </variablelist>     
     
       <variablelist>
         <varlistentry>
             <term>file system</term>
             <listitem>
                 <para>
                     Optional. The default is <literal>btrfs</literal> for the 
                     root partition (<filename>/</filename>) and 
                     <literal>xfs</literal> for data partitions. 
                     Specify the file system to use on this partition:
                 </para>
         <itemizedlist mark="bullet" spacing="normal">
           <listitem>
            <para>
             <literal>btrfs</literal>
            </para>
           </listitem>
           <listitem>
            <para>
             <literal>ext2</literal>
            </para>
           </listitem>
           <listitem>
            <para>
             <literal>ext3</literal>
            </para>
           </listitem>
           <listitem>
            <para>
             <literal>ext4</literal>
            </para>
           </listitem>
           <listitem>
            <para>
             <literal>fat</literal>
            </para>
           </listitem>
           <listitem>
            <para>
             <literal>xfs</literal>
            </para>
           </listitem>
           <listitem>
            <para>
             <literal>swap</literal>
            </para>
<screen>&lt;filesystem config:type="symbol"&gt;ext3&lt;/filesystem&gt;</screen>            
           </listitem>
          </itemizedlist>
             </listitem>
         </varlistentry>
     </variablelist>     
     
       <variablelist>
         <varlistentry>
             <term>mkfs_options</term>
             <listitem>
                 <para>
                     Optional, specify an option string for the 
                     <command>mkfs</command>. Only use this when you know what 
                     you are doing (see the relevant mkfs man page for the 
                     filesystem you want to use.)
                 </para>
<screen>&lt;mkfs_options&gt;-I 128&lt;/mkfs_options&gt;</screen>                 
             </listitem>
         </varlistentry>
     </variablelist> 
     
       <variablelist>
         <varlistentry>
             <term>partition_nr</term>
             <listitem>
                 <para>
                     The number of this partition. If you have set
                     <literal>create=false</literal> or if you use LVM, then you
                     can specify the partition via <literal>partition_nr</literal>.
                 </para>
<screen>&lt;partition_nr config:type="integer"&gt;2&lt;/partition_nr&gt;</screen>                 
             </listitem>
         </varlistentry>
     </variablelist>     
     
       <variablelist>
         <varlistentry>
             <term>partition_id</term>
             <listitem>
                 <para>
                     The <literal>partition_id</literal> sets the id of the 
                     partition. If you want different identifiers than 131 for 
                     Linux partition or  130 for swap, configure them with
                     <literal>partition_id.</literal> The default is 
                     <literal>131</literal> for a Linux partition and
                     <literal>130</literal> for swap.
                 </para>
<screen>&lt;partition_id config:type="integer"&gt;131&lt;/partition_id&gt;</screen>                 
<simplelist>
 <member>Swap: <literal>130</literal></member>
 <member>Linux: <literal>131</literal></member>
 <member>LVM: <literal>142</literal></member>
 <member>MD RAID: <literal>253</literal></member>
 <member>EFI partition: <literal>259</literal></member>
</simplelist>
             </listitem>
         </varlistentry>
     </variablelist>   
     
        <variablelist>
         <varlistentry>
             <term>partition_type</term>
             <listitem>
                 <para>
                     Optional. Allowed values are <literal>primary</literal>
                     (default) and <literal>logical</literal>.When using an
                     <literal>msdos</literal> partition table, this
                     element sets the type of the partition. The value can be
                     <literal>primary</literal> or <literal>logical</literal>.
                     This value is ignored when using a <literal>gpt</literal>
                     partition table, because such a distinction does not exist in
                     that case.
                 </para>
<screen>&lt;partition_type&gt;primary&lt;/partition_type&gt;</screen>                 
             </listitem>
         </varlistentry>
     </variablelist>     
     
        <variablelist>
         <varlistentry>
             <term>mountby</term>
             <listitem>
                 <para>
                     Instead of a partition number, you can tell &ay; to mount a
                     partition by <literal>device</literal>, 
                     <literal>label</literal>, <literal>uuid</literal>,
                     <literal>path</literal> or <literal>id</literal>, which 
                     are the udev path and udev id (see 
                     <filename>/dev/disk/...</filename>).
                 </para>
                 <para>
                     See <literal>label</literal> and <literal>uuid</literal>
                     documentation above. The default depends on &yast; and 
                     usually is <literal>id</literal>.
                 </para>
<screen>&lt;mountby config:type="symbol"&gt;label&lt;/mountby&gt;</screen>               
             </listitem>
         </varlistentry>
     </variablelist>    
     
        <variablelist>
         <varlistentry>
             <term>subvolumes</term>
             <listitem>
                 <para>
                     List of subvolumes to create for a file system of type 
                     Btrfs. This key only makes sense for file systems of type Btrfs. 
                     (See <xref linkend="ay-btrfs-subvolumes"/> for more information.)
                 </para>
                 <para>
                     If no <tag>subvolumes</tag> section has been defined for a
                     partition description, &ay; will create a predefined set of
                     subvolumes for the given mount point.
                 </para>
<screen>&lt;subvolumes config:type="list"&gt;
  &lt;path&gt;tmp&lt;/path&gt;
  &lt;path&gt;opt&lt;/path&gt;
  &lt;path&gt;srv&lt;/path&gt;
  &lt;path&gt;var&lt;/path&gt;
  ...
&lt;/subvolumes&gt;</screen>                 
             </listitem>
         </varlistentry>
     </variablelist>
     
        <variablelist>
         <varlistentry>
             <term>create_subvolumes</term>
             <listitem>
                 <para>
                     Determine whether Btrfs subvolumes should be created or not.
                     It is set to <literal>true</literal> by default. When set to
                     <literal>false</literal>, no subvolumes will be created.
                 </para>
             </listitem>
         </varlistentry>
     </variablelist>
     
        <variablelist>
         <varlistentry>
             <term>subvolumes_prefix</term>
             <listitem>
                 <para>
                     Set the Btrfs subvolumes prefix name. If no prefix is wanted,
                     it must be set to an empty value:
                 </para>
<screen>&lt;subvolumes_prefix&gt;&lt;![CDATA[]]&gt;&lt;/subvolumes_prefix&gt;</screen>
                 <para>It is set to <literal>@</literal> by default.
                 </para>
             </listitem>
         </varlistentry>
     </variablelist> 

        <variablelist>
         <varlistentry>
             <term>lv_name</term>
             <listitem>
                 <para>
                     If this partition is on a logical volume in a volume group,
                     specify the logical volume name here (see the 
                     <literal>type</literal> parameter in the drive configuration).
                 </para>
<screen>&lt;lv_name&gt;opt_lv&lt;/lv_name&gt;</screen>                 
             </listitem>
         </varlistentry>
     </variablelist>
     
        <variablelist>
         <varlistentry>
             <term>stripes</term>
             <listitem>
                 <para>
                     An integer that configures LVM striping. Specify across how 
                     many devices you want to stripe (spread data).
                 </para>
<screen>&lt;stripes config:type="integer"&gt;2&lt;/stripes&gt;</screen>               
             </listitem>
         </varlistentry>
     </variablelist>

        <variablelist>
         <varlistentry>
             <term>stripesize</term>
             <listitem>
                 <para>
                     Specify the size of each block in KB.
                 </para>
<screen>&lt;stripesize config:type="integer"&gt;4&lt;/stripesize&gt;</screen>               
             </listitem>
         </varlistentry>
     </variablelist>

        <variablelist>
         <varlistentry>
             <term>lvm_group</term>
             <listitem>
                 <para>
                     If this is a physical partition used by (part of) a volume
                     group (LVM), you need to specify the name of the volume group
                     here.
                 </para>
<screen>&lt;lvm_group&gt;system&lt;/lvm_group&gt;</screen>                 
             </listitem>
         </varlistentry>
     </variablelist>
     
        <variablelist>
         <varlistentry>
             <term>pool</term>
             <listitem>
                 <para>
                     <literal>pool</literal> must be set to <literal>true</literal>
                     if the LVM logical volume should be an LVM thin pool.
                 </para>
<screen>&lt;pool config:type="boolean"&gt;true&lt;/pool&gt;</screen>              
             </listitem>
         </varlistentry>
     </variablelist>
     
        <variablelist>
         <varlistentry>
             <term>used_pool</term>
             <listitem>
                 <para>
                      The name of the LVM thin pool that is used as a data store
                      for this thin logical volume. If this is set to something
                      non-empty, it implies that the volume is a so-called thin
                      logical volume. 
                 </para>
<screen>&lt;used_pool&gt;my_thin_pool&lt;/used_pool&gt;</screen>              
             </listitem>
         </varlistentry>
     </variablelist>     

        <variablelist>
         <varlistentry>
             <term>raid_name</term>
             <listitem>
                 <para>
                     If this physical volume is part of a RAID array, specify 
                     the name of the RAID array.
                 </para>
<screen>&lt;raid_name&gt;/dev/md/0&lt;/raid_name&gt;</screen>               
             </listitem>
         </varlistentry>
     </variablelist> 
     
        <variablelist>
         <varlistentry>
             <term>raid_options</term>
             <listitem>
                 <para>
                     Specify RAID options, Setting the RAID options at the
                     <literal>partition</literal> level is deprecated.
                     See <xref linkend="ay-partition-sw-raid"/>
                 </para>
             </listitem>
         </varlistentry>
     </variablelist>  
     
        <variablelist>
         <varlistentry>
             <term>bcache_backing_for</term>
             <listitem>
                 <para>
                     If this device is used as a <emphasis>&bcache; backing
                     device</emphasis>, specify the name of the &bcache;
                     device. See <xref linkend="ay-partition-bcache"/> for 
                     further details.
                 </para>
<screen>&lt;bcache_backing_for&gt;/dev/bcache0&lt;/bcache_backing_for&gt;</screen>              
             </listitem>
         </varlistentry>
     </variablelist>    
     
        <variablelist>
         <varlistentry>
             <term>bcache_caching_for</term>
             <listitem>
                 <para>
                     If this device is used as a 
                     <emphasis>&bcache; caching device</emphasis>, specify the 
                     names of the &bcache; devices. See 
                     <xref linkend="ay-partition-bcache"/> for further details.
                 </para>
  <screen>&lt;bcache_caching_for config:type="list"&gt;&lt;listentry&gt;/dev/bcache0&lt;/listentry&gt;&lt;/bcache_caching_for&gt;</screen>               
             </listitem>
         </varlistentry>
     </variablelist>      
     
        <variablelist>
         <varlistentry>
             <term>resize</term>
             <listitem>
                 <para>
                     Starting with &productname; 15 resizing works with physical
                     disk partitions and with LVM volumes
                 </para>
 <screen>&lt;resize config:type="boolean"&gt;false&lt;/resize&gt;</screen>                
             </listitem>
         </varlistentry>
     </variablelist>     
    </sect3>

    <sect3 xml:id="ay-btrfs-subvolumes">
     <title>Btrfs subvolumes</title>
     <para>
      As mentioned in <xref linkend="ay-partition-configuration"/>, it is
      possible to define a set of subvolumes for each Btrfs file system. In
      its simplest form, they are specified using a list of paths:
     </para>

<screen>&lt;subvolumes config:type="list"&gt;
  &lt;path&gt;usr/local&lt;/path&gt;
  &lt;path&gt;tmp&lt;/path&gt;
  &lt;path&gt;opt&lt;/path&gt;
  &lt;path&gt;srv&lt;/path&gt;
  &lt;path&gt;var&lt;/path&gt;
&lt;/subvolumes&gt;</screen>

     <para>
      However, it is possible to specify additional settings for each
      subvolume. For instance, we might want to set a quota or to disable the
      copy-on-write mechanism. For that purpose, it is possible to expand any
      of the elements of the list as shown in the example below:
     </para>

<screen>&lt;subvolumes config:type="list"&gt;
  &lt;listentry&gt;usr/local&lt;/listentry&gt;
  &lt;listentry&gt;
    &lt;path&gt;tmp&lt;/path&gt;
    &lt;referenced_limit&gt;1 GiB&lt;/referenced_limit&gt;
  &lt;/listentry&gt;
  &lt;listentry&gt;opt&lt;/listentry&gt;
  &lt;listentry&gt;srv&lt;/listentry&gt;
  &lt;listentry&gt;
    &lt;path&gt;var/lib/pgsql&lt;/path&gt;
    &lt;copy_on_write config:type="boolean"&gt;false&lt;/copy_on_write&gt;
  &lt;/listentry&gt;
&lt;/subvolumes&gt;</screen>

     <para>

     </para>

     <informaltable>
      <tgroup cols="3">
       <colspec colwidth="1*"/>
       <colspec colwidth="3*"/>
       <colspec colwidth="2*"/>
       <thead>
        <row>
         <entry>
          <para>
           Attribute
          </para>
         </entry>
         <entry>
          <para>
           Values
          </para>
         </entry>
         <entry>
          <para>
           Description
          </para>
         </entry>
        </row>
       </thead>
       <tbody>
        <row>
         <entry>
          <para>
           <literal>path</literal>
          </para>
         </entry>
         <entry>
          <para>
           Mount point for the subvolume.
          </para>
          <screen>&lt;path&gt;tmp&lt;/tmp&gt;</screen>
         </entry>
         <entry>
          <para>
           Required. &ay; will ignore the subvolume if the
           <literal>path</literal> is not specified.
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           <literal>copy-on-write</literal>
          </para>
         </entry>
         <entry>
          <para>
           Whether copy-on-write should be enabled for the subvolume.
          </para>
          <screen>&lt;copy-on-write config:type="boolean"&gt;false&lt;/copy-on-write&gt;</screen>
         </entry>
         <entry>
          <para>
           Optional. The default value is <literal>false</literal>.
          </para>
         </entry>
        </row>
        <row>
         <entry>
          <para>
           <literal>referenced_limit</literal>
          </para>
         </entry>
         <entry>
          <para>
           Set a quota for the subvolume.
          </para>
          <screen>&lt;referenced_limit&gt;1 GiB&lt;/referenced_limit&gt;</screen>
         </entry>
         <entry>
          <para>
           Optional. The default value is <literal>unlimited</literal>. Btrfs
           supports two kind of limits: <literal>referenced</literal> and
           <literal>exclusive</literal>. At this point, only the former is
           supported.
          </para>
         </entry>
        </row>
       </tbody>
      </tgroup>
     </informaltable>

     <para>
      If there is a default subvolume used for the distribution (for example
      <filename>@</filename> in &productname;), the name of this default
      subvolume is automatically prefixed to the names of the defined
      subvolumes. This behavior can be disabled by setting the
      <literal>subvolumes_prefix</literal> in the <link
      xlink:href="CreateProfile-Partitioning-config">drive</link> section
     </para>

     <screen>&lt;subvolumes_prefix&gt;&lt;![CDATA[]]&gt;&lt;/subvolumes_prefix&gt;</screen>
    </sect3>

    <sect3 xml:id="ay-use-whole-disk">
     <title>Using the Whole Disk</title>

     <para>
      &ay; allows to use a whole disk without creating any partition by setting
      the <literal>disklabel</literal> to <literal>none</literal> as described
      in <xref linkend="CreateProfile-Partitioning-config"/>. In such cases, the
      configuration in the first <literal>partition</literal> from the
      <literal>drive</literal> will be applied to the whole disk.
     </para>

     <para>
      In the example below, we are using the second disk (<literal>/dev/sdb</literal>)
      as the <literal>/home</literal> file system.
     </para>

     <example>
      <title>Using a Whole Disk as a File System</title>
      <screen>&lt;partitioning config:type="list"&gt;
  &lt;drive&gt;
    &lt;device&gt;/dev/sda&lt;/device&gt;
    &lt;partitions config:type="list"&gt;
      &lt;partition&gt;
        &lt;create config:type="boolean"&gt;true&lt;/create&gt;
        &lt;format config:type="boolean"&gt;true&lt;/format&gt;
        &lt;mount&gt;/&lt;/mount&gt;
        &lt;size&gt;max&lt;/size&gt;
      &lt;/partition&gt;
    &lt;/partitions&gt;
  &lt;/drive&gt;
  &lt;drive&gt;
    &lt;device&gt;/dev/sdb&lt;/device&gt;
    &lt;disklabel&gt;none&lt;/disklabel&gt;
    &lt;partitions config:type="list"&gt;
      &lt;partition&gt;
        &lt;format config:type="boolean"&gt;true&lt;/format&gt;
        &lt;mount&gt;/home&lt;/mount&gt;
      &lt;/partition&gt;
    &lt;/partitions&gt;
  &lt;/drive&gt;</screen>
     </example>

     <para>
      In addition, the whole disk can be used as an LVM physical volume or as a software RAID
      member. See <xref linkend="ay-partition-lvm"/> and <xref linkend="ay-partition-sw-raid"/>
      for further details about setting up an LVM or a software RAID.
     </para>

     <para>
      For backward compatibility reasons, it is possible to achieve the same
      result by setting the <literal>&lt;partition_nr&gt;</literal> element to
      <literal>0</literal>. However, this usage of the
      <literal>&lt;partition_nr&gt;</literal> element is deprecated from
      &productname; 15.
     </para>
    </sect3>

    <sect3 xml:id="ay-auto-partitioning">
     <title>Filling the Gaps</title>
     <para>
      When using the Expert Partitioner approach, &ay; can create a
      partition plan from a rather incomplete profile. The following profiles
      show how you can describe some details of the partitioning layout and
      let &ay; do the rest.
     </para>
     <example>
      <title>Automated Partitioning on Selected Drives</title>
      <para>
       The following is an example of a single drive system, which is not
       pre-partitioned and should be automatically partitioned according to
       the described pre-defined partition plan. If you do not specify the
       device, it will be automatically detected.
      </para>
      <screen>&lt;partitioning config:type="list"&gt;
  &lt;drive&gt;
    &lt;device&gt;/dev/sda&lt;/device&gt;
    &lt;use&gt;all&lt;/use&gt;
  &lt;/drive&gt;
&lt;/partitioning&gt;
</screen>
     </example>
     <para>
      A more detailed example shows how existing partitions and multiple
      drives are handled.
     </para>
     <example>
      <title>Installing on Multiple Drives</title>
      <screen>&lt;partitioning config:type="list"&gt;
  &lt;drive&gt;
    &lt;device&gt;/dev/sda&lt;/device&gt;
    &lt;use&gt;all&lt;/use&gt;
    &lt;partitions config:type="list"&gt;
      &lt;partition&gt;
        &lt;mount&gt;/&lt;/mount&gt;
        &lt;size&gt;10G&lt;/size&gt;
      &lt;/partition&gt;
      &lt;partition&gt;
        &lt;mount&gt;swap&lt;/mount&gt;
        &lt;size&gt;1G&lt;/size&gt;
      &lt;/partition&gt;
    &lt;/partitions&gt;
  &lt;/drive&gt;
  &lt;drive&gt;
    &lt;device&gt;/dev/sdb&lt;/device&gt;
    &lt;use&gt;free&lt;/use&gt;
    &lt;partitions config:type="list"&gt;
      &lt;partition&gt;
        &lt;filesystem config:type="symbol"&gt;ext4&lt;/filesystem&gt;
        &lt;mount&gt;/data1&lt;/mount&gt;
        &lt;size&gt;15G&lt;/size&gt;
      &lt;/partition&gt;
      &lt;partition&gt;
        &lt;filesystem config:type="symbol"&gt;xfs&lt;/filesystem&gt;
        &lt;mount&gt;/data2&lt;/mount&gt;
        &lt;size&gt;auto&lt;/size&gt;
      &lt;/partition&gt;
    &lt;/partitions&gt;
  &lt;/drive&gt;
&lt;/partitioning&gt;
</screen>
     </example>
    </sect3>
   </sect2>

   <sect2 xml:id="ay-partition-advanced">
    <title>Advanced Partitioning Features</title>
    <para>
     <remark role="fixme">Add a short description</remark>
    </para>
    <sect3 xml:id="ay-partition-advanced-wipe">
     <title>Wipe out Partition Table</title>
     <para>
      Usually this is not needed because &ay; can delete partitions one
      by one automatically. But you need the option to let &ay; clear the
      partition table instead of deleting partitions individually.
     </para>
     <para>
      Go to the <literal>drive</literal> section and add:
     </para>
<screen>&lt;initialize config:type="boolean"&gt;true&lt;/initialize&gt;</screen>
     <para>
      With this setting &ay; will delete the partition table before it
      starts to analyze the actual partitioning and calculates its partition
      plan. Of course this means, that you cannot keep any of your existing
      partitions.
     </para>
    </sect3>
    <sect3 xml:id="ay-partition-advanced-mount">
     <title>Mount Options</title>
     <para>
      By default a file system to be mounted is identified in
      <filename>/etc/fstab</filename> by the device name. This
      identification can be changed so the file system is found by searching
      for a UUID or a volume label. Note that not all file systems can be
      mounted by UUID or a volume label. To specify how a partition is to be
      mounted, use the <literal>mountby</literal> property which has the
      <literal>symbol</literal> type. Possible options are:
     </para>
     <itemizedlist mark="bullet" spacing="normal">
      <listitem>
       <para>
        <literal>device</literal> (default)
       </para>
      </listitem>
      <listitem>
       <para>
        <literal>label</literal>
       </para>
      </listitem>
      <listitem>
       <para>
        <literal>UUID</literal>
       </para>
      </listitem>
     </itemizedlist>
     <para>
      If you choose to mount a new partition using a label, use the
      <literal>label</literal> property to specify its value.
     </para>
     <para>
      Add any valid mount option in the fourth field of
      <filename>/etc/fstab</filename>. Multiple options are separated by
      commas. Possible fstab options:
     </para>
     <variablelist>
      <varlistentry>
       <term>Mount read-only (<literal>ro</literal>)</term>
       <listitem>
        <para>
         No write access to the file system. Default is
         <literal>false</literal>.
        </para>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term>No access time (<literal>noatime</literal>)</term>
       <listitem>
        <para>
         Access times are not updated when a file is read. Default is
         <literal>false</literal>.
        </para>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term>Mountable by User (<literal>user</literal>)</term>
       <listitem>
        <para>
         The file system can be mounted by a normal user. Default is
         <literal>false</literal>.
        </para>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term>
        Data Journaling Mode (<literal>ordered</literal>,
        <literal>journal</literal>, <literal>writeback</literal>)
       </term>
       <listitem>
        <variablelist>
         <varlistentry>
          <term><literal>journal</literal>
          </term>
          <listitem>
           <para>
            All data is committed to the journal prior to being written to
            the main file system.
           </para>
          </listitem>
         </varlistentry>
         <varlistentry>
          <term><literal>ordered</literal>
          </term>
          <listitem>
           <para>
            All data is directly written to the main file system before its
            metadata is committed to the journal.
           </para>
          </listitem>
         </varlistentry>
         <varlistentry>
          <term><literal>writeback</literal>
          </term>
          <listitem>
           <para>
            Data ordering is not preserved.
           </para>
          </listitem>
         </varlistentry>
        </variablelist>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term>Access Control List (<literal>acl</literal>)</term>
       <listitem>
        <para>
         Enable access control lists on the file system.
        </para>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term>Extended User Attributes (<literal>user_xattr</literal>)</term>
       <listitem>
        <para>
         Allow extended user attributes on the file system.
        </para>
       </listitem>
      </varlistentry>
     </variablelist>
     <example>
      <title>Mount Options</title>
<screen>&lt;partitions config:type="list"&gt;
  &lt;partition&gt;
    &lt;filesystem config:type="symbol"&gt;ext4&lt;/filesystem&gt;
    &lt;format config:type="boolean"&gt;true&lt;/format&gt;
    &lt;fstopt&gt;ro,noatime,user,data=ordered,acl,user_xattr&lt;/fstopt&gt;
    &lt;mount&gt;/local&lt;/mount&gt;
    &lt;mountby config:type="symbol"&gt;uuid&lt;/mountby&gt;
    &lt;partition_id config:type="integer"&gt;131&lt;/partition_id&gt;
    &lt;size&gt;10G&lt;/size&gt;
  &lt;/partition&gt;
&lt;/partitions&gt;
</screen>
     </example>

    <note>
     <title>
      Check Supported File System Options
     </title>
     <para>
      Different file system types support different options.
      Check the documentation carefully before setting them.
     </para>
    </note>
    </sect3>
    <sect3 xml:id="ay-partition-advanced-keep">
     <title>Keeping Specific Partitions</title>
     <para>
      In some cases you should leave partitions untouched and only format
      specific target partitions, rather than creating them from scratch.
      For example, if different Linux installations coexist, or you have
      another operating system installed, likely you do not want to wipe
      these out. You may also want to leave data partitions untouched.
     </para>
     <para>
      Such scenarios require specific knowledge about the target systems and
      hard disks. Depending on the scenario, you might need to know the
      exact partition table of the target hard disk with partition IDs,
      sizes and numbers. With this data, you can tell &ay; to keep certain
      partitions, format others and create new partitions if needed.
     </para>
     <para>
      The following example will keep partitions 1, 2 and 5 and delete
      partition 6 to create two new partitions. All remaining partitions
      will only be formatted.
      <remark>emap 2011-11-05: Not the best example for the scenarios two paras up with coexisting operating systems or data partitions. Who'd want to format those?</remark>
     </para>
     <example>
      <title>Keeping partitions</title>
<screen>&lt;partitioning config:type="list"&gt;
  &lt;drive&gt;
    &lt;device&gt;/dev/sdc&lt;/device&gt;
      &lt;partitions config:type="list"&gt;
        &lt;partition&gt;
          &lt;create config:type="boolean"&gt;false&lt;/create&gt;
          &lt;format config:type="boolean"&gt;true&lt;/format&gt;
          &lt;mount&gt;/&lt;/mount&gt;
          &lt;partition_nr config:type="integer"&gt;1&lt;/partition_nr&gt;
        &lt;/partition&gt;
        &lt;partition&gt;
          &lt;create config:type="boolean"&gt;false&lt;/create&gt;
          &lt;format config:type="boolean"&gt;false&lt;/format&gt;
          &lt;partition_nr config:type="integer"&gt;2&lt;/partition_nr&gt;
          &lt;mount&gt;/space&lt;/mount&gt;
        &lt;/partition&gt;
        &lt;partition&gt;
          &lt;create config:type="boolean"&gt;false&lt;/create&gt;
          &lt;format config:type="boolean"&gt;true&lt;/format&gt;
          &lt;filesystem config:type="symbol"&gt;swap&lt;/filesystem&gt;
          &lt;partition_nr config:type="integer"&gt;5&lt;/partition_nr&gt;
          &lt;mount&gt;swap&lt;/mount&gt;
        &lt;/partition&gt;
        &lt;partition&gt;
          &lt;format config:type="boolean"&gt;true&lt;/format&gt;
          &lt;mount&gt;/space2&lt;/mount&gt;
          &lt;size&gt;5G&lt;/size&gt;
        &lt;/partition&gt;
        &lt;partition&gt;
          &lt;format config:type="boolean"&gt;true&lt;/format&gt;
          &lt;mount&gt;/space3&lt;/mount&gt;
          &lt;size&gt;max&lt;/size&gt;
        &lt;/partition&gt;
      &lt;/partitions&gt;
    &lt;use&gt;6&lt;/use&gt;
  &lt;/drive&gt;
&lt;/partitioning&gt;</screen>
     </example>
     <para>
      The last example requires exact knowledge of the existing partition
      table and the partition numbers of those partitions that should be
      kept. In some cases however, such data may not be available,
      especially in a mixed hardware environment with different hard disk
      types and configurations. The following scenario is for a system with
      a non-Linux OS with a designated area for a Linux installation.
     </para>
     <figure xml:id="partitioning-keep1">
      <title>Keeping partitions</title>
      <mediaobject>
       <imageobject role="html">
        <imagedata fileref="partitioning-keep1.png"/>
       </imageobject>
       <imageobject role="fo">
        <imagedata fileref="partitioning-keep1.png" width="75%"/>
       </imageobject>
      </mediaobject>
     </figure>
     <para>
      In this scenario, shown in figure
      <xref linkend="partitioning-keep1"/>, &ay; will not create new
      partitions. Instead it searches for certain partition types on the
      system and uses them according to the partitioning plan in the control
      file. No partition numbers are given in this case, only the mount
      points and the partition types (additional configuration data can be
      provided, for example file system options, encryption and file system
      type).
     </para>
     <example>
      <title>Auto-detection of partitions to be kept.</title>
<screen>&lt;partitioning config:type="list"&gt;
  &lt;drive&gt;
    &lt;partitions config:type="list"&gt;
      &lt;partition&gt;
        &lt;create config:type="boolean"&gt;false&lt;/create&gt;
        &lt;format config:type="boolean"&gt;true&lt;/format&gt;
        &lt;mount&gt;/&lt;/mount&gt;
        &lt;partition_id config:type="integer"&gt;131&lt;/partition_id&gt;
      &lt;/partition&gt;
      &lt;partition&gt;
        &lt;create config:type="boolean"&gt;false&lt;/create&gt;
        &lt;format config:type="boolean"&gt;true&lt;/format&gt;
        &lt;filesystem config:type="symbol"&gt;swap&lt;/filesystem&gt;
        &lt;partition_id config:type="integer"&gt;130&lt;/partition_id&gt;
        &lt;mount&gt;swap&lt;/mount&gt;
      &lt;/partition&gt;
    &lt;/partitions&gt;
  &lt;/drive&gt;
&lt;/partitioning&gt;</screen>
     </example>

     <note>
      <title>Keeping Encrypted Devices</title>
      <para>
       When &ay; is probing the storage devices, the partitioning
       section from the profile is not yet analyzed. In some scenarios,
       it is not clear which key should be used to unlock a device. For
       example, this can happen when more than one encryption key is
       defined. To solve this problem, &ay; will try all defined keys
       on all encrypted devices until a working key is found.
      </para>
     </note>
    </sect3>
   </sect2>

   <sect2 xml:id="ay-partition-lvm">
    <title>Logical Volume Manager (LVM)</title>
    <para>
     To configure LVM, first create a physical volume using the normal
     partitioning method described above.
    </para>
    <example>
     <title>Create LVM Physical Volume</title>
     <para>
      The following example shows how to prepare for LVM in the
      <literal>partitioning</literal> resource. A non-formatted partition is
      created on device <filename>/dev/sda1</filename> of the type
      <literal>LVM</literal> and with the volume group
      <literal>system</literal>. This partition will use all space available
      on the drive.
     </para>
<screen>&lt;partitioning config:type="list"&gt;
  &lt;drive&gt;
    &lt;device&gt;/dev/sda&lt;/device&gt;
    &lt;partitions config:type="list"&gt;
      &lt;partition&gt;
        &lt;create config:type="boolean"&gt;true&lt;/create&gt;
        &lt;lvm_group&gt;system&lt;/lvm_group&gt;
        &lt;partition_type&gt;primary&lt;/partition_type&gt;
        &lt;partition_id config:type="integer"&gt;142&lt;/partition_id&gt;
        &lt;partition_nr config:type="integer"&gt;1&lt;/partition_nr&gt;
        &lt;size&gt;max&lt;/size&gt;
      &lt;/partition&gt;
    &lt;/partitions&gt;
    &lt;use&gt;all&lt;/use&gt;
  &lt;/drive&gt;
&lt;/partitioning&gt;</screen>
    </example>
    <example>
     <title>LVM Logical Volumes</title>
<screen>&lt;partitioning config:type="list"&gt;
  &lt;drive&gt;
    &lt;device&gt;/dev/sda&lt;/device&gt;
    &lt;partitions config:type="list"&gt;
      &lt;partition&gt;
        &lt;lvm_group&gt;system&lt;/lvm_group&gt;
        &lt;partition_type&gt;primary&lt;/partition_type&gt;
        &lt;size&gt;max&lt;/size&gt;
      &lt;/partition&gt;
    &lt;/partitions&gt;
    &lt;use&gt;all&lt;/use&gt;
  &lt;/drive&gt;
  &lt;drive&gt;
    &lt;device&gt;/dev/system&lt;/device&gt;
      &lt;type config:type="symbol"&gt;CT_LVM&lt;/type&gt;
      &lt;partitions config:type="list"&gt;
        &lt;partition&gt;
          &lt;filesystem config:type="symbol"&gt;ext4&lt;/filesystem&gt;
          &lt;lv_name&gt;user_lv&lt;/lv_name&gt;
          &lt;mount&gt;/usr&lt;/mount&gt;
          &lt;size&gt;15G&lt;/size&gt;
        &lt;/partition&gt;
        &lt;partition&gt;
          &lt;filesystem config:type="symbol"&gt;ext4&lt;/filesystem&gt;
          &lt;lv_name&gt;opt_lv&lt;/lv_name&gt;
          &lt;mount&gt;/opt&lt;/mount&gt;
          &lt;size&gt;10G&lt;/size&gt;
        &lt;/partition&gt;
        &lt;partition&gt;
          &lt;filesystem config:type="symbol"&gt;ext4&lt;/filesystem&gt;
          &lt;lv_name&gt;var_lv&lt;/lv_name&gt;
          &lt;mount&gt;/var&lt;/mount&gt;
          &lt;size&gt;1G&lt;/size&gt;
        &lt;/partition&gt;
      &lt;/partitions&gt;
      &lt;pesize&gt;4M&lt;/pesize&gt;
    &lt;use&gt;all&lt;/use&gt;
  &lt;/drive&gt;
&lt;/partitioning&gt;
</screen>
    </example>
    <para>
     It is possible to set the <literal>size</literal> to
     <literal>max</literal> for the logical volumes. Of course, you can only
     use <literal>max</literal> for one(!) logical volume. You cannot set
     two logical volumes in one volume group to <literal>max</literal>.
    </para>
   </sect2>

   <sect2 xml:id="ay-partition-sw-raid">
    <title>Software RAID</title>
    <para>
     The support for software RAID devices has been greatly improved in
     &productname; <phrase os="sles;sled">15 SP2</phrase><phrase os="osuse">15.2</phrase>.
    </para>
     <para>
      If needed, see <xref linkend="ay-partition-sw-raid-deprecated"/> to find
      out further details about the old way of specifying a software RAID,
      which is still supported for backward compatibility.
     </para>
     <para>
     Using &ay;, you can create and assemble software RAID devices. The
     supported RAID levels are the following:
    </para>
    <variablelist>
     <varlistentry>
      <term>RAID 0</term>
      <listitem>
       <para>
        This level increases your disk performance. There is
        <emphasis>no</emphasis> redundancy in this mode. If one of the
        drives crashes, data recovery will not be possible.
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>RAID 1</term>
      <listitem>
       <para>
        This mode offers the best redundancy. It can be used with two or
        more disks. An exact copy of all data is maintained on all disks. As
        long as at least one disk is still working, no data is lost. The
        partitions used for this type of RAID should have approximately the
        same size.
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>RAID 5</term>
      <listitem>
       <para>
        This mode combines management of a larger number of disks and still
        maintains some redundancy. This mode can be used on three disks or
        more. If one disk fails, all data is still intact. If two disks fail
        simultaneously, all data is lost.
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>Multipath</term>
      <listitem>
       <para>
        This mode allows access to the same physical device via multiple
        controllers for redundancy against a fault in a controller card.
        This mode can be used with at least two devices.
       </para>
      </listitem>
     </varlistentry>
    </variablelist>
    <para>
     Similar to LVM, a software RAID definition in an &ay; profile is composed
     of two different parts:
    </para>

    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <para>
       Determining which disks or partitions are going to be used as RAID
       members.  In order to do that, you need to set the
       <literal>raid_name</literal> element in such devices.
      </para>
     </listitem>
     <listitem>
      <para>
       Defining the RAID itself by using a dedicated <literal>drive</literal>
       section.
      </para>
     </listitem>
    </itemizedlist>

    <para>
     The following example shows a RAID1 configuration that uses a partition from the first disk
     and another one from the second disk as RAID members:
    </para>
    <example>
     <title>RAID1 Configuration</title>
<screen>&lt;partitioning config:type="list"&gt;
  &lt;drive&gt;
    &lt;device&gt;/dev/sda&lt;/device&gt;
    &lt;partitions config:type="list"&gt;
      &lt;partition&gt;
        &lt;mount&gt;/&lt;/mount&gt;
        &lt;size&gt;20G&lt;/size&gt;
      &lt;/partition&gt;
      &lt;partition&gt;
        &lt;raid_name&gt;/dev/md/0&lt;/raid_name&gt;
        &lt;size&gt;max&lt;/size&gt;
      &lt;/partition&gt;
    &lt;/partitions&gt;
    &lt;use&gt;all&lt;/use&gt;
  &lt;/drive&gt;
  &lt;drive&gt;
    &lt;device&gt;/dev/sdb&lt;/device&gt;
    &lt;disklabel&gt;none&lt;/disklabel&gt;
    &lt;partitions config:type="list"&gt;
      &lt;partition&gt;
        &lt;raid_name&gt;/dev/md/0&lt;/raid_name&gt;
      &lt;/partition&gt;
    &lt;/partitions&gt;
    &lt;use&gt;all&lt;/use&gt;
  &lt;/drive&gt;
  &lt;drive&gt;
    &lt;device&gt;/dev/md/0&lt;/device&gt;
    &lt;partitions config:type="list"&gt;
      &lt;partition&gt;
        &lt;mount&gt;/home&lt;/mount&gt;
        &lt;size&gt;40G&lt;/size&gt;
      &lt;/partition&gt;
      &lt;partition&gt;
        &lt;mount&gt;/srv&lt;/mount&gt;
        &lt;size&gt;10G&lt;/size&gt;
      &lt;/partition&gt;
    &lt;/partitions&gt;
    &lt;raid_options&gt;
      &lt;chunk_size&gt;4&lt;/chunk_size&gt;
      &lt;parity_algorithm&gt;left_asymmetric&lt;/parity_algorithm&gt;
      &lt;raid_type&gt;raid1&lt;/raid_type&gt;
    &lt;/raid_options&gt;
    &lt;use&gt;all&lt;/use&gt;
  &lt;/drive&gt;
&lt;/partitioning&gt;</screen>
    </example>

    <para>
     If you do not want to create partitions in the software RAID, set
     the <literal>disklabel</literal> to <literal>none</literal> as you would
     do for a regular disk. In the example below, only the RAID
     <literal>drive</literal> section is shown for simplicity's sake:
    </para>

    <example>
     <title>RAID1 Without Partitions</title>
<screen>&lt;drive&gt;
  &lt;device&gt;/dev/md/0&lt;/device&gt;
  &lt;disklabel&gt;none&lt;/disklabel&gt;
  &lt;partitions config:type="list"&gt;
    &lt;partition&gt;
      &lt;mount&gt;/home&lt;/mount&gt;
      &lt;size&gt;40G&lt;/size&gt;
    &lt;/partition&gt;
  &lt;/partitions&gt;
  &lt;raid_options&gt;
    &lt;chunk_size&gt;4&lt;/chunk_size&gt;
    &lt;parity_algorithm&gt;left_asymmetric&lt;/parity_algorithm&gt;
    &lt;raid_type&gt;raid1&lt;/raid_type&gt;
  &lt;/raid_options&gt;
  &lt;use&gt;all&lt;/use&gt;
&lt;/drive&gt;</screen>
    </example>

   <sect3 xml:id="ay-partition-sw-raid-deprecated">
    <title>Using the Deprecated Syntax</title>
    <para>
     If the installer self-update feature is enabled, it is possible to partition a software RAID
     for &productname; 15. However, that scenario was not supported in previous versions and hence
     the way to define a software RAID was slightly different.
    </para>

    <para>
     This section defines what the old-style configuration looks like because
     it is still supported for backward compatibility.
    </para>

    <para>
     Keep the following in mind when configuring a RAID using this deprecated
     syntax:
    </para>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <para>
       The device for RAID is always <filename>/dev/md</filename>.
      </para>
     </listitem>
     <listitem>
      <para>
       The property <literal>partition_nr</literal> is used to determine the
       MD device number. If <literal>partition_nr</literal> is equal to 0,
       then <filename>/dev/md/0</filename> is configured. Adding several
       <literal>partition</literal> sections means that you want to have
       multiple software RAIDs (<filename>/dev/md/0</filename>,
       <filename>/dev/md/1</filename>, etc.).
      </para>
     </listitem>
     <listitem>
      <para>
       All RAID-specific options are contained in the <literal>raid_options</literal> resource.
      </para>
     </listitem>
    </itemizedlist>

    <example>
     <title>Old Style RAID1 Configuration</title>
<screen>&lt;partitioning config:type="list"&gt;
  &lt;drive&gt;
    &lt;device&gt;/dev/sda&lt;/device&gt;
    &lt;partitions config:type="list"&gt;
      &lt;partition&gt;
        &lt;partition_id config:type="integer"&gt;253&lt;/partition_id&gt;
        &lt;format config:type="boolean"&gt;false&lt;/format&gt;
        &lt;raid_name&gt;/dev/md0&lt;/raid_name&gt;
        &lt;raid_type&gt;raid1&lt;/raid_type&gt;
        &lt;size&gt;4G&lt;/size&gt;
      &lt;/partition&gt;

        &lt;!-- Insert a configuration for the regular partitions located on
                /dev/sda here (for example / and swap) --&gt;

    &lt;/partitions&gt;
    &lt;use&gt;all&lt;/use&gt;
  &lt;/drive&gt;
  &lt;drive&gt;
    &lt;device&gt;/dev/sdb&lt;/device&gt;
    &lt;partitions config:type="list"&gt;
      &lt;partition&gt;
        &lt;format config:type="boolean"&gt;false&lt;/format&gt;
        &lt;partition_id config:type="integer"&gt;253&lt;/partition_id&gt;
        &lt;raid_name&gt;/dev/md0&lt;/raid_name&gt;
        &lt;size&gt;4gb&lt;/size&gt;
      &lt;/partition&gt;
    &lt;/partitions&gt;
    &lt;use&gt;all&lt;/use&gt;
  &lt;/drive&gt;
  &lt;drive&gt;
    &lt;device&gt;/dev/md&lt;/device&gt;
    &lt;partitions config:type="list"&gt;
      &lt;partition&gt;
        &lt;filesystem config:type="symbol"&gt;ext4&lt;/filesystem&gt;
        &lt;format config:type="boolean"&gt;true&lt;/format&gt;
        &lt;mount&gt;/space&lt;/mount&gt;
        &lt;partition_id config:type="integer"&gt;131&lt;/partition_id&gt;
        &lt;partition_nr config:type="integer"&gt;0&lt;/partition_nr&gt;
        &lt;raid_options&gt;
          &lt;chunk_size&gt;4&lt;/chunk_size&gt;
          &lt;parity_algorithm&gt;left_asymmetric&lt;/parity_algorithm&gt;
        &lt;/raid_options&gt;
      &lt;/partition&gt;
    &lt;/partitions&gt;
    &lt;use&gt;all&lt;/use&gt;
  &lt;/drive&gt;
&lt;/partitioning&gt;</screen>
    </example>
   </sect3>

   <sect3 xml:id="ay-raid-configuration">
    <title>RAID Options</title>
    <para>
     The following elements must be placed within the following XML
     structure:
    </para>
<screen>&lt;partition&gt;
     &lt;raid_options&gt;
     ...
     &lt;/raid_options&gt;
     &lt;/partition&gt;</screen>
    
    <variablelist>
     <varlistentry>
      <term>chunk_size</term>
      <listitem>
<screen>&lt;chunk_size&gt;4&lt;/chunk_size&gt;</screen>
      </listitem>
     </varlistentry>
     
     <varlistentry>
      <term>parity_algorithm</term>
      <listitem>
       <para>
        Possible values are:
       </para>
       <para>
        <literal>left_asymmetric</literal>, <literal>left_symmetric</literal>,
        <literal>right_asymmetric</literal>, or
        <literal>right_symmetric</literal>.
       </para>
       
       <para>
        For RAID6 and RAID10, the following values can be used:
       </para>
       <para>
        <literal>parity_first</literal>, <literal>parity_last</literal>,
        <literal>left_asymmetric_6</literal>, <literal>left_symmetric_6</literal>,
        <literal>right_asymmetric_6</literal>, <literal>right_symmetric_6</literal>,
        <literal>parity_first_6</literal>, <literal>n2</literal>,
        <literal>o2</literal>, <literal>f2</literal>, <literal>n3</literal>,
        <literal>o3</literal>, or <literal>f3</literal>.
       </para>
<screen>&lt;parity_algorithm&gt;left_asymmetric&lt;/parity_algorithm&gt;</screen>
      </listitem>
     </varlistentry>
     
     <varlistentry>
      <term>raid_type</term>
      <listitem>
       <para>
        Possible values are: <literal>raid0</literal>, <literal>raid1</literal>,
        <literal>raid5</literal>, <literal>raid6</literal> and
        <literal>raid10</literal>.
       </para>
<screen>&lt;raid_type&gt;raid1&lt;/raid_type&gt;</screen>
       <para>
        The default is <literal>raid1</literal>.
       </para>
      </listitem>
     </varlistentry>
     
     <varlistentry>
      <term>device_order</term>
      <listitem>
       <para>
        This list contains the order of the physical devices:
       </para>
<screen>&lt;device_order config:type="list"&gt;&lt;device&gt;/dev/sdb2&lt;/device&gt;&lt;device&gt;/dev/sda1&lt;/device&gt;...&lt;/device_order&gt;</screen>
       <para>
        This is optional, and the default is alphabetical order.
       </para>
      </listitem>
     </varlistentry>
     
    </variablelist>
    
   </sect3>
  </sect2>

  <sect2 xml:id="ay-partition-multipath">
<!-- this section differs from older releases, do not backport, 
      see https://github.com/SUSE/doc-sle/pull/535. (cjs, feb 4 2020) -->      
   <title>Multipath Support</title>
   <para>
    &ay; can handle multipath devices. In order to take advantage of
    them, you need to enable multipath support, as shown in <xref
    linkend="multipath-example"/>. Alternatively, you can use the following
    parameter on the Kernel command line:
    <literal>LIBSTORAGE_MULTIPATH_AUTOSTART=ON</literal>.
   </para>

   <para>
    Unlike &sle; 12, it is not required to set the drive section type to
    <literal>CT_DMMULTIPATH</literal>. You should use
    <literal>CT_DISK</literal>, although for historical reasons, both values are
    equivalent.
   </para>

    <example xml:id="multipath-example">
     <title>Using Multipath Devices</title>
     <screen><![CDATA[<general>
  <storage>
    <start_multipath config:type="boolean">true</start_multipath>
  <storage>
</general>
<partitioning>
  <drive>
    <partitions config:type="list">
      <partition>
        <size>20G</size>
        <mount>/</mount>
        <filesystem config:type="symbol">ext4</filesystem>
      </partition>
      <partition>
        <size>auto</size>
        <mount>swap</mount>
      </partition>
    </partitions>
    <type config:type="symbol">CT_DISK</type>
    <use>all</use>
  </drive>
</partitioning>]]></screen>
    </example>

    <para>
     If you want to specify the device, you could use the World Wide Identifier
     (WWID), its device name (for example, <literal>/dev/dm-0</literal>), any other
     path under <literal>/dev/disk</literal> that refers to the multipath device
     or any of its paths.
    </para>

    <para>
     For example, given the <literal>multipath</literal> listing from <xref
     linkend="multipath-ll-output"/>, you could use
     <literal>/dev/mapper/14945540000000000f86756dce9286158be4c6e3567e75ba5</literal>,
     <literal>/dev/dm-3</literal>, any other corresponding path under
     <literal>/dev/disk</literal> (as shown in <xref
     linkend="multipath-wwid-example"/>), or any of its paths
     (<literal>/dev/sda</literal> or <literal>/dev/sdb</literal>).
    </para>

    <example xml:id="multipath-ll-output">
     <title>Listing multipath devices</title>
     <screen><![CDATA[# multipath -l
14945540000000000f86756dce9286158be4c6e3567e75ba5 dm-3 ATA,VIRTUAL-DISK
size=40G features='0' hwhandler='0' wp=rw
|-+- policy='service-time 0' prio=1 status=active
| `- 2:0:0:0 sda 8:0  active ready running
`-+- policy='service-time 0' prio=1 status=enabled
  `- 3:0:0:0 sdb 8:16 active ready running]]></screen>
    </example>

    <example xml:id="multipath-wwid-example">
     <title>Using the WWID to Identify a Multipath Device</title>
     <screen><![CDATA[<drive>
  <partitions config:type="list">
    <device>/dev/mapper/14945540000000000f86756dce9286158be4c6e3567e75ba5</device>
    <partition>
      <size>20G</size>
      <mount>/</mount>
      <filesystem config:type="symbol">ext4</filesystem>
    </partition>
  </partitions>
  <type config:type="symbol">CT_DISK</type>
  <use>all</use>
</drive>]]></screen>
    </example>
  </sect2>

  <sect2 xml:id="ay-partition-bcache">
   <title>&bcache; Configuration</title>
   <para>
    &bcache; is a caching system which allows the use of multiple fast drives to speed up the access
    to one or more slower drives. For example, you can improve the performance
    of a large (but slow) drive by using a fast one as a cache.
   </para>

   <para>
    For more information about bcache on &productname;, also see the blog post
    at <link xlink:href="https://www.suse.com/c/combine-the-performance-of-solid-state-drive-with-the-capacity-of-a-hard-drive-with-bcache-and-yast/"/>.
   </para>

   <para>
    To set up a &bcache; device, &ay; needs a profile that specifies the
    following:
   </para>

   <itemizedlist>
    <listitem>
     <para>
      To set a (slow) block device as <emphasis>backing device</emphasis>, use
      the <literal>bcache_backing_for</literal> element.
     </para>
    </listitem>
    <listitem>
     <para>
      To set a (fast) block device as <emphasis>caching device</emphasis>, use
      the <literal>bcache_caching_for</literal> element. You can use the same
      device to speed up the access to several drives.
     </para>
    </listitem>
    <listitem>
     <para>
      To specify the layout of the &bcache; device, use a <literal>drive</literal>
      section and set the <literal>type</literal> element to
      <literal>CT_BCACHE</literal>. The layout of the &bcache; device may contain
      partitions.
     </para>
    </listitem>
   </itemizedlist>

   <example>
    <title>&bcache; Definition</title>
<screen>&lt;partitioning config:type="list"&gt;
  &lt;drive&gt;
    &lt;device&gt;/dev/sda&lt;/device&gt;
    &lt;type config:type="symbol"&gt;CT_DISK&lt;/type&gt;
    &lt;use&gt;all&lt;/use&gt;
    &lt;enable_snapshots config:type="boolean"&gt;true&lt;/enable_snapshots&gt;
    &lt;partitions config:type="list"&gt;
      &lt;partition&gt;
        &lt;filesystem config:type="symbol"&gt;btrfs&lt;/filesystem&gt;
        &lt;mount&gt;/&lt;/mount&gt;
        &lt;create config:type="boolean"&gt;true&lt;/create&gt;
        &lt;size&gt;max&lt;/size&gt;
      &lt;/partition&gt;
      &lt;partition&gt;
        &lt;filesystem config:type="symbol"&gt;swap&lt;/filesystem&gt;
        &lt;mount&gt;swap&lt;/mount&gt;
        &lt;create config:type="boolean"&gt;true&lt;/create&gt;
        &lt;size&gt;2GiB&lt;/size&gt;
      &lt;/partition&gt;
    &lt;/partitions&gt;
  &lt;/drive&gt;

  &lt;drive&gt;
    &lt;type config:type="symbol"&gt;CT_DISK&lt;/type&gt;
    &lt;device&gt;/dev/sdb&lt;/device&gt;
    &lt;disklabel&gt;msdos&lt;/disklabel&gt;
    &lt;use&gt;all&lt;/use&gt;
    &lt;partitions config:type="list"&gt;
      &lt;partition&gt;
        &lt;!-- It can serve as caching device for several bcaches --&gt;
        &lt;bcache_caching_for config:type="list"&gt;
          &lt;listentry&gt;/dev/bcache0&lt;/listentry&gt;
        &lt;/bcache_caching_for&gt;
        &lt;size&gt;max&lt;/size&gt;
      &lt;/partition&gt;
    &lt;/partitions&gt;
  &lt;/drive&gt;

  &lt;drive&gt;
    &lt;type config:type="symbol"&gt;CT_DISK&lt;/type&gt;
    &lt;device&gt;/dev/sdc&lt;/device&gt;
    &lt;use&gt;all&lt;/use&gt;
    &lt;disklabel&gt;msdos&lt;/disklabel&gt;
    &lt;partitions config:type="list"&gt;
      &lt;partition&gt;
        &lt;!-- It can serve as backing device for one bcache --&gt;
        &lt;bcache_backing_for&gt;/dev/bcache0&lt;/bcache_backing_for&gt;
      &lt;/partition&gt;
    &lt;/partitions&gt;
  &lt;/drive&gt;

  &lt;drive&gt;
    &lt;type config:type="symbol"&gt;CT_BCACHE&lt;/type&gt;
    &lt;device&gt;/dev/bcache0&lt;/device&gt;
    &lt;bcache_options&gt;
      &lt;cache_mode&gt;writethrough&lt;/cache_mode&gt;
    &lt;/bcache_options&gt;
    &lt;use&gt;all&lt;/use&gt;
    &lt;partitions config:type="list"&gt;
      &lt;partition&gt;
        &lt;mount&gt;/data&lt;/mount&gt;
        &lt;size&gt;20GiB&lt;/size&gt;
      &lt;/partition&gt;
      &lt;partition&gt;
        &lt;mount&gt;swap&lt;/mount&gt;
        &lt;filesystem config:type="symbol"&gt;swap&lt;/filesystem&gt;
        &lt;size&gt;1GiB&lt;/size&gt;
      &lt;/partition&gt;
    &lt;/partitions&gt;
  &lt;/drive&gt;
&lt;/partitioning&gt;
</screen>
</example>

   <para>
    For the time being, the only supported option in the
    <literal>bcache_options</literal> section is <literal>cache_mode</literal>,
    described below.
   </para>
   <variablelist>
    <varlistentry>
     <term>cache_mode</term>
     <listitem>
      <para>
       Cache mode for &bcache;. Possible values are:
      </para>
      <itemizedlist>
       <listitem>
        <para>
        <literal>writethrough</literal>
        </para>
       </listitem>
       <listitem>
        <para>
         <literal>writeback</literal>
        </para>
       </listitem>
       <listitem>
        <para>
         <literal>writearound</literal>
        </para>
       </listitem>
       <listitem>
        <para>
         <literal>none</literal>
        </para>
       </listitem>
      </itemizedlist>
<screen>&lt;cache_mode&gt;writethrough&lt;/cache_mode&gt;</screen>
     </listitem>
    </varlistentry>
   </variablelist>
  </sect2>

  <sect2 xml:id="ay-multidevice-btrfs">
   <title>Multi-device Btrfs Configuration</title>

   <para>
    Btrfs supports creating a single volume that spans more than one
    storage device, offering similar features to software RAID implementations
    such as the Linux kernel's built-in <command>mdraid</command> subsystem.
    <emphasis>Multi-device Btrfs</emphasis> offers advantages over some other
    RAID implementations. For example, you can dynamically migrate a
    multi-device Btrfs volume from one RAID level to another, RAID levels can
    be set on a per-file basis, and more. However, not all of these features are
    fully supported yet in &productname; &product-ga; SP &product-sp;.
   </para>
    
   <para>With &ay;, a multi-device Btrfs can be configured by specifying a drive
    with the <literal>CT_BTRFS</literal> type. The <literal>device</literal>
    property is used as an arbitrary name to identify each multi-device Btrfs.
   </para>

   <para>
    As with RAID, you need to create all block devices first (e.g., partitions,
    LVM logical volumes, etc.) and assign them to the Btrfs file system you want
    to create over such block devices.
   </para>

   <para>
    The following example shows a simple multi-device Btrfs configuration:
   </para>

   <example>
    <title>Multi-device Btrfs configuration</title>
      <screen>&lt;partitioning config:type="list"&gt;
  &lt;drive&gt;
    &lt;device&gt;/dev/sda&lt;/device&gt;
    &lt;disklabel&gt;none&lt;/disklabel&gt;
    &lt;partitions&gt;
      &lt;partition&gt;
        &lt;btrfs_name&gt;root_fs&lt;/btrfs_name&gt;
      &lt;/partition&gt;
    &lt;/partitions&gt;
    &lt;use&gt;all&lt;/use&gt;
  &lt;/drive&gt;
  &lt;drive&gt;
    &lt;device&gt;/dev/sdb&lt;/device&gt;
    &lt;disklabel&gt;gpt&lt;/disklabel&gt;
    &lt;partitions&gt;
      &lt;partition&gt;
        &lt;partition_nr&gt;1&lt;/partition_nr&gt;
        &lt;size&gt;4gb&lt;/size&gt;
        &lt;filesystem&gt;ext4&lt;/filesystem&gt;
        &lt;btrfs_name&gt;root_fs&lt;/btrfs_name&gt;
      &lt;/partition&gt;
    &lt;/partitions&gt;
    &lt;use&gt;all&lt;/use&gt;
  &lt;/drive&gt;
  &lt;drive&gt;
    &lt;device&gt;root_fs&lt;/device&gt;
    &lt;type config:type="symbol"&gt;CT_BTRFS&lt;/type&gt;
    &lt;partitions&gt;
      &lt;partition config:type="list&gt;
        &lt;mount&gt;/&lt;/mount&gt;
      &lt;/partition&gt;
    &lt;/partitions&gt;
    &lt;btrfs_options&gt;
      &lt;raid_leve&gt;raid1&lt;/raid_level&gt;
      &lt;metadata_raid_leve&gt;raid1&lt;/metadata_raid_level&gt;
    &lt;/btrfs_options&gt;
  &lt;/drive&gt;
&lt;/partitioning&gt;</screen>
   </example>

   <para>
    The supported data and meta-data RAID levels are: <literal>default</literal>,
    <literal>single</literal>, <literal>dup</literal>, <literal>raid0</literal>,
    <literal>raid1</literal>, and <literal>raid10</literal>. By default, file
    system meta-data is mirrored across two devices and data is striped across
    all of the devices. If only one device is present, meta-data will be
    duplicated on that one device.
   </para>
   
<!--lproven 2020-06-30: omitting raid5 & raid6 for now as unsupported in 15SP2
as per ancorgs' comment on Github-->
 
   <para>
    Keep the following in mind when configuring a multi-device Btrfs file
    system:
   </para>

   <itemizedlist>
    <listitem>
     <para>
      Devices need to indicate the <literal>btrfs_name</literal> property to be
      included into a multi-device Btrfs file system.
     </para>
    </listitem>
    <listitem>
     <para>
      All Btrfs-specific options are contained in the
      <literal>btrfs_options</literal> resource of a <literal>CT_BTRFS</literal>
      drive.
     </para>
    </listitem>
   </itemizedlist>
  </sect2>


  <sect2 xml:id="ay-partition-nfs">
   <title>NFS Configuration</title>

   <para>
    &ay; allows to install &productname; onto
    <emphasis>Network File System</emphasis> (NFS) shares. To do so, you have
    to create a drive with the <literal>CT_NFS</literal> type and provide the
    NFS share name (<replaceable>SERVER:PATH</replaceable>) as device name.
    The information relative to the mount point is included as part of its first
    partition section. Note that for an NFS drive, only the first partition is
    taken into account.
   </para>
   <para>
    For more information on how to configure an NFS client and server after the
    system has been installed, refer to <xref linkend="ay-partition-nfs"/>.
   </para>

   <example>
    <title>NFS Share Definition</title>
      <screen>
        &lt;partitioning config:type="list"&gt;
          &lt;drive&gt;
            &lt;device&gt;192.168.1.1:/exports/root_fs&lt;/device&gt;
            &lt;type config:type="symbol"&gt;CT_NFS&lt;/type&gt;
            &lt;use&gt;all&lt;/use&gt;
            &lt;partitions config:type="list"&gt;
              &lt;partition&gt;
                &lt;mount&gt;/&lt;/mount&gt;
                &lt;fstopt&gt;nolock&lt;/fstopt&gt;
              &lt;/partition&gt;
            &lt;/partitions&gt;
          &lt;/drive&gt;
        &lt;/partitioning&gt;
      </screen>
    </example>
  </sect2>

  <sect2 xml:id="ay-partition-tmpfs">
   <title><literal>tmpfs</literal> Configuration</title>

   <para>
    &ay; supports the definition of <literal>tmpfs</literal> virtual file systems by
    setting the <literal>type</literal> element to <literal>CT_TMPFS</literal>.
    Each <literal>partition</literal> section represents a <literal>tmpfs</literal>
    file system.
   </para>

   <example>
    <title><literal>tmpfs</literal> definition</title>
    <screen>
      &lt;partitioning config:type="list"&gt;
        &lt;drive&gt;
          &lt;type config:type="symbol"&gt;CT_TMPFS&lt;/type&gt;
          &lt;partitions config:type="list"&gt;
            &lt;partition&gt;
              &lt;mount&gt;/srv&lt;/mount&gt;
              &lt;fstopt&gt;size=512M&lt;/fstopt&gt;
            &lt;/partition&gt;
            &lt;partition&gt;
              &lt;mount&gt;/temp&lt;/mount&gt;
            &lt;/partition&gt;
          &lt;/partitions&gt;
        &lt;drive&gt;
      &lt;partitioning&gt;
     </screen>
   </example>

   <para>
     <literal>tmpfs</literal> devices are different from regular file systems
     like Ext4 or Btrfs. Therefore, the only relevant elements are
     <literal>mount</literal>, which is mandatory, and
     <literal>fstopt</literal>. The latter is used to set file system attributes
     like its size limit, mode, and so on. You can find additional information
     about the known options in the <literal>tmpfs</literal> manpage.
   </para>
  </sect2>

   <sect2 os="sles" xml:id="ay-partition-s390">
    <title>&zseries; Specific Configuration</title>
    <para/>
    <sect3 xml:id="ay-partition-s390-dasd">
     <title>Configuring DASD Disks</title>
     <para>
      The elements listed below must be placed within the following XML
      structure:
     </para>
<screen>&lt;dasd&gt;
 &lt;devices config:type="list"&gt;
  &lt;listentry&gt;
   ...
  &lt;/listentry&gt;
 &lt;/devices&gt;
&lt;/dasd&gt;</screen>
     <para>
      tags in the &lt;profile&gt; section. Each disk needs to be
      configured in a separate &lt;listentry&gt; ...
      &lt;/listentry&gt; section.
     </para>

     <variablelist>
      <title>DASD Configuration</title>
      
      <varlistentry>
       <term>device</term>
       <listitem>
        <para>
         <literal>DASD</literal> is the only value allowed
        </para>
<screen>&lt;device&gt;DASD&lt;/dev_name&gt;</screen>
       </listitem>
      </varlistentry>
      
      <varlistentry>
       <term>dev_name</term>
       <listitem>
        <para>
         The device (<literal>dasd<replaceable>N</replaceable></literal>) you
         want to configure in this section.
        </para>
<screen>&lt;dev_name&gt;/dev/dasda&lt;/dev_name&gt;</screen>
        <para>
         Optional but recommended. If left out, &ay; tries to guess the device.
        </para>
       </listitem>
      </varlistentry>
      
      <varlistentry>
       <term>channel</term>
       <listitem>
        <para>
         Channel by which the disk is accessed.
        </para>
<screen>&lt;channel&gt;0.0.0150&lt;/channel&gt;</screen>
        <para>
         Mandatory.
        </para>
       </listitem>
      </varlistentry>
      
      <varlistentry>
       <term>diag</term>
       <listitem>
        <para>
         Enable or disable the use of <literal>DIAG</literal>. Possible values
         are <literal>true</literal> (enable) or <literal>false</literal>
         (disable).
        </para>
<screen>&lt;diagconfig:type="boolean"&gt;true&lt;/diag&gt;</screen>
         <para>
          Optional.
         </para>
       </listitem>
      </varlistentry>
      
     </variablelist>
    </sect3>
    <sect3 xml:id="ay-partition-s390-zfcp">
     <title>Configuring zFCP Disks</title>
     <para>
      The following elements must be placed within the following XML
      structure:
     </para>
<screen>&lt;profile&gt;
  &lt;zfcp&gt;
    &lt;devices config:type="list"&gt;
      &lt;listentry&gt;
        ...
      &lt;/listentry&gt;
    &lt;/devices&gt;
  &lt;/zfcp&gt;
&lt;profile&gt;</screen>
     <para>
      Each disk needs to be configured in a separate
      <literal>listentry</literal> section.
     </para>

     <variablelist>
      <varlistentry>
       <term>controller_id</term>
       <listitem>
       <para>
        Channel number
       </para>
<screen>&lt;controller_id&gt;0.0.fc00&lt;/controller_id&gt;</screen>
       </listitem>
      </varlistentry>
     </variablelist>
     
    </sect3>
   </sect2>
  </sect1>
