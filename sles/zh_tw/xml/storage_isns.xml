<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="storage_isns.xml" version="5.0" xml:id="cha.isns" xml:lang="zh-tw">
 <title>iSNS for Linux</title>
 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:bugtracker/>
   <dm:translation>yes</dm:translation>
  </dm:docmanager>
 </info>
 <para>
  儲存區域網路 (SAN) 可包含許多在複雜網路中散佈的磁碟機。這可能會使探查及擁有裝置變得困難。iSCSI 啟動程式必須可識別 SAN 中的儲存資源，並確定這些資源是否已進行存取。
 </para>
 <para>
  網際網路儲存名稱服務 (iSNS) 是一項標準式服務，可便於自動化探查、管理和設定 TCP/IP 網路上的 iSCSI 裝置。iSNS 提供可與光纖通道媲美的智能儲存探查與管理服務。
 </para>
 <important>
  <title>安全性考量</title>
  <para>
   iSNS 只可用於安全的內部網路中。
  </para>
 </important>
 <sect1 xml:id="sec.isns.overview">
  <title>iSNS 的工作原理</title>

  <para>
   若要讓 iSCSI 啟動程式探查 iSCSI 目標，則需要識別網路中屬於儲存資源的裝置及需要存取的 IP 位址。對於 iSNS 伺服器的查詢會傳回應用程式有權存取的 iSCSI 目標與 IP 位址。
  </para>

  <para>
   透過使用 iSNS，您可以建立 iSNS 探查網域，隨後將 iSCSI 目標和啟動器按這些網域來分組或組織。透過將儲存節點劃分為網域，您就可以將每台主機的探查程序限定為使用 iSNS 註冊的目標之最合適的子集，這樣就可透過減少不必要的探查數量並限制每台主機用於建立探查關係所耗費的時間讓儲存網路進行縮放。此操作可讓您控制並簡化必須進行探查的目標與啟動程式的數量。
  </para>

  <figure>
   <title>iSNS 探查網域</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="isns_a.png" width="80%" format="PNG"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="isns_a.png" width="100%" format="PNG"/>
    </imageobject>
   </mediaobject>
  </figure>

  <para>
   iSCSI 目標與 iSCSI 啟動程式都是使用 iSNS 用戶端透過 iSNS 通訊協定啟動與 iSNS 伺服器的異動。然後在常見探查網域中註冊裝置屬性資訊，下載其他註冊用戶端相關的資訊，並接收發生在探查網域中的事件之非同步通知。
  </para>

  <para>
   iSNS 伺服器會回應 iSNS 用戶端使用 iSNS 通訊協定作出的 iSNS 通訊協定查詢與申請。iSNS 伺服器會啟動 iSNS 通訊協定狀態變更通知，並將註冊申請提交的經適當驗證的資訊儲存到 iSNS 資料庫中。
  </para>

  <para>
   iSNS for Linux 提供的優點包括︰
  </para>

  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>
     為註冊、探查與管理網路內的儲存資產帶來資訊便利。
    </para>
   </listitem>
   <listitem>
    <para>
     與 DNS 基礎結構相整合。
    </para>
   </listitem>

   <listitem>
    <para>
     合併 iSCSI 儲存的註冊、探查與管理。
    </para>
   </listitem>
   <listitem>
    <para>
     簡化了儲存管理實作。
    </para>
   </listitem>
   <listitem>
    <para>
     與其他探查方法相比，提高了擴充性。
    </para>
   </listitem>
  </itemizedlist>

  <para>
   透過以下的情況可以讓您更了解 iSNS 所能提供的利益。
  </para>



  <para>
   假設您擁有一個包含 100 個 iSCSI 啟動程式與 100 個 iSCSI 目標的公司。根據您的配置，所有 iSCSI 啟動程式可能會嘗試探查並連接到 100 個 iSCSI 目標中的任一一個。這樣可能會造成探查與連接方面的問題。透過將啟動程式與目標分組到探查網域中，您就可以阻止一個部門中的 iSCSI 啟動程式探查另一個部門中的 iSCSI 目標。這樣做的結果是，特定部門中的 iSCSI 啟動器將會只探查屬於該部門探查網域的 iSCSI 目標。
  </para>
 </sect1>
 <sect1 xml:id="sec.isns.install">
  <title>安裝 iSNS Server for Linux</title>

  <para>
   <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> 中隨附了 iSNS Server for Linux，但預設不會安裝或設定。您需要安裝套件 <systemitem class="resource">open-isns</systemitem> 並設定 iSNS 服務。
  </para>



  <note>
   <title>iSNS 和 iSCSI 在同一伺服器上</title>
   <para>
    可將 iSNS 安裝在 iSCSI 目標或 iSCSI 起始程式軟體所在的伺服器上。不能將 iSCSI 目標軟體與 iSCSI 起始程式軟體安裝在同一部伺服器上。
   </para>
  </note>

  <para>
   安裝 iSNS for Linux︰
  </para>

  <procedure>
   <step>
    <para>
     啟動 YaST 並選取<menuchoice><guimenu>網路服務</guimenu> <guimenu>iSNS 伺服器</guimenu></menuchoice>。
    </para>
   </step>
   <step>
    <para>
     如果 <systemitem class="resource">open-isns</systemitem> 尚未安裝，系統會提示您現在安裝。按一下<guimenu>安裝</guimenu>確認安裝。
    </para>
   </step>
   <step>
    <para>
     「iSNS 服務」組態對話方塊會自動開啟並顯示<guimenu>服務</guimenu>索引標籤。
    </para>
    <informalfigure>
     <mediaobject>
      <imageobject role="fo">
       <imagedata fileref="isns_config_a.png" width="80%" format="PNG"/>
      </imageobject>
      <imageobject role="html">
       <imagedata fileref="isns_config_a.png" width="100%" format="PNG"/>
      </imageobject>
     </mediaobject>
    </informalfigure>
   </step>

   <step>
    <para>
     在<guimenu>服務啟動</guimenu>中選取下列其中一項：
    </para>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <formalpara>
       <title>開機時：</title>
       <para>
        iSNS 服務會在伺服器啟動時自動啟動。
       </para>
      </formalpara>
     </listitem>
     <listitem>
      <formalpara>
       <title>手動 (預設)：</title>
       <para>
        您必須在用於安裝 iSNS 服務之伺服器的主控台中輸入 <command>sudo systemctl start isnsd</command>，來手動啟動 iSNS 服務。
       </para>
      </formalpara>
     </listitem>
    </itemizedlist>
   </step>
   <step>
    <para>
     指定下列防火牆設定：
    </para>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <formalpara>
       <title>在防火牆中開啟埠</title>
       <para>
        選取核取方塊開啟防火牆，並允許從遠端電腦存取服務。預設關閉防火牆連接埠。
       </para>
      </formalpara>
     </listitem>
     <listitem>
      <formalpara>
       <title>防火牆詳細資料</title>
       <para>
        如果開啟防火牆連接埠，則依預設會在所有網路介面上開啟連接埠。按一下<guimenu>防火牆詳細資料</guimenu>選取要在其上開啟連接埠的介面，並選取要使用的網路，然後按一下<guimenu>確定</guimenu>。
       </para>
      </formalpara>
     </listitem>
    </itemizedlist>
   </step>
   <step>
    <para>
     按一下<guimenu>確定</guimenu>套用組態設定並完成安裝。
    </para>
   </step>
   <step>
    <para>
     請繼續執行<xref linkend="sec.isns.domains" xrefstyle="SectTitleOnPage"/>。
    </para>
   </step>
  </procedure>
 </sect1>
 <sect1 xml:id="sec.isns.domains">
  <title>設定 iSNS 探查網域</title>

  <para>
   若要讓 iSCSI 啟動器與 iSCSI 目標使用 iSNS 服務，則它們必須屬於探查網域。
  </para>

  <important>
   <title>iSNS 服務必須處於使用中狀態</title>
   <para>
    iSNS 服務必須已安裝並且執行，您才能設定 iSNS 探查網域。如需更多資訊，請參閱<xref linkend="sec.isns.start" xrefstyle="SectTitleOnPage"/>。
   </para>
  </important>

  <sect2 xml:id="sec.isns.domains.ddcreate">
   <title>建立 iSNS 探查網域</title>
   <para>
    安裝 iSNS 服務時，會自動建立名稱為 <guimenu>default DD</guimenu> 的預設探查網域。設定使用 iSNS 的現有 iSCSI 目標與啟動程式會自動新增至預設探查網域。
   </para>
   <para>
    建立新的探查網域︰
   </para>
   <procedure>
    <step>
     <para>
      啟動 YaST，然後在<guimenu>網路服務</guimenu>之下選取<guimenu>iSNS 伺服器</guimenu>。
     </para>
    </step>
    <step>
     <para>
      按一下<guimenu>探查網域</guimenu>索引標籤。
     </para>
     <para>
      <guimenu>探查網域</guimenu>區域列出了所有現有的探查網域。您可以<guimenu>建立探查網域</guimenu>或<guimenu>刪除</guimenu>現有的探查網域。刪除網域會從網域中移除成員，但不會刪除 iSCSI 節點成員。
     </para>
     <para>
      <guimenu>探查網域成員</guimenu>區域列出了為所選探查網域指定的所有 iSCSI 節點。如果選取其他探查網域，則會重新整理清單，並列出該探查網域的成員。您可以對選取的探查網域新增或刪除 iSCSI 節點。如果刪除 iSCSI 節點，則會將其從網域中移除，但不會刪除該 iSCSI 節點。
     </para>
     <para>
      <guimenu>建立 iSCSI 節點成員</guimenu>允許將尚未註冊的節點新增為探查網域成員。該節點經 iSCSI 啟動器或目標註冊後，就會成為此網域的一部分。
     </para>
     <para role="intro">
      iSCSI 啟動器執行探查申請時，iSNS 服務會傳回屬於同一探查網域的所有 iSCSI 節點目標。
     </para>
     <informalfigure>
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="isns_discdomains_a.png" width="80%" format="PNG"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="isns_discdomains_a.png" width="100%" format="PNG"/>
       </imageobject>
      </mediaobject>
     </informalfigure>
    </step>
    <step>
     <para>
      按一下<guimenu>建立探查網域</guimenu>按鈕。
     </para>
     <para>
      您也可以選取現有的探查網域，然後按一下<guimenu>刪除</guimenu>按鈕移除該探查網域。
     </para>
    </step>
    <step>
     <para>
      指定您正在建立的探查網域之名稱，然後按一下<guimenu>確定</guimenu>。
     </para>
    </step>
    <step>
     <para>
      請繼續執行<xref linkend="sec.isns.domains.iscsi_nodes" xrefstyle="SectTitleOnPage"/>。
     </para>
    </step>
   </procedure>
  </sect2>

  <sect2 xml:id="sec.isns.domains.iscsi_nodes">
   <title>將 iSCSI 節點新增至探查網域</title>
   <procedure>
    <step>
     <para>
      啟動 YaST，然後在<guimenu>網路服務</guimenu>之下選取<guimenu>iSNS 伺服器</guimenu>。
     </para>
    </step>
    <step>
     <para>
      按一下<guimenu>iSCSI 節點</guimenu>索引標籤。
     </para>
     <informalfigure>
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="isns_iscsinodes_a.png" width="80%" format="PNG"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="isns_iscsinodes_a.png" width="100%" format="PNG"/>
       </imageobject>
      </mediaobject>
     </informalfigure>
    </step>
    <step>
     <para>
      檢閱節點清單，確定已列出要使用 iSNS 服務的 iSCSI 目標和啟動器。
     </para>
     <para>
      若未列出 iSCSI 目標或啟動程式，您可能需要重新啟動節點上的 iSCSI 服務。為此，您可以執行
     </para>
<screen>sudo systemctl restart iscsid.socket
sudo systemctl restart iscsi</screen>
     <para>
      重新啟動啟動器，或執行
     </para>
<screen>sudo systemctl restart target-isns</screen>
     <para>
      重新啟動目標。
     </para>
     <para>
      您可以選取 iSCSI 節點，然後按一下<guimenu>刪除</guimenu>按鈕將該節點從 iSNS 資料庫移除。若您不再使用 iSCSI 節點或已對該節點進行重新命名，這會帶來幫助。
     </para>
     <para>
      除非您移除 iSCSI 組態檔案的 iSNS 部分或將其注解化，否則在重新啟動 SCSI 服務或伺服器時，iSCSI 節點會自動再次新增至清單 (iSNS 資料庫)。
     </para>
    </step>
    <step>
     <para>
      按一下<guimenu>探查網域</guimenu>索引標籤，然後選取所需的探查網域。
     </para>
    </step>
    <step>
     <para>
      按一下<guimenu>新增現有的 iSCSI 節點</guimenu>，選取您要新增至網域的節點，然後再按<guimenu>新增節點</guimenu>。
     </para>
    </step>
    <step>
     <para>
      對要新增至探查網域的所有節點重複上述步驟，當您新增完節點時，再按一下<guimenu>完成</guimenu>。
     </para>
     <para>
      請注意，一個 iSCSI 節點可屬於多個探查網域。
     </para>
    </step>
   </procedure>
  </sect2>
 </sect1>
 <sect1 xml:id="sec.isns.start">
  <title>啟動 iSNS 服務</title>

  <para>
   iSNS 必須在所安裝到的伺服器上啟動。如果您未將它設定為在開機時啟動 (請參閱<xref linkend="sec.isns.install"/>瞭解詳細資料)，請在終端機主控台中輸入以下指令︰
  </para>

<screen>sudo systemctl start isnsd</screen>

  <para>
   您也可以使用 iSNS 的 <command>stop</command>、<command>status</command> 與 <command>restart</command> 選項。
  </para>
 </sect1>
 <sect1 xml:id="sec.isns.info">
  <title>更多資訊</title>

  <para>
   如需相關資訊，請參閱「<citetitle>Linux iSNS for iSCSI project</citetitle>」(Linux iSNS for iSCSI 專案，網址為 <link xlink:href="http://sourceforge.net/projects/linuxisns/"/>)。<link xlink:href="http://sourceforge.net/mailarchive/forum.php?forum_name=linuxisns-discussion"/> 上提供了此專案的電子郵寄清單。
  </para>

  <para>
   如需 iSNS 的一般資訊，請參閱「<citetitle>RFC 4171: Internet Storage Name Service</citetitle>」(RFC 4171：網際網路儲存名稱服務，網址為 <link xlink:href="http://www.ietf.org/rfc/rfc4171"/>)。
  </para>
 </sect1>
</chapter>
