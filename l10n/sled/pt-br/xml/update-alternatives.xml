<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet href="urn:x-suse:xslt:profiling:docbook51-profile.xsl"
                 type="text/xml"
                 title="Profiling step"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="update-alternatives.xml" version="5.1" xml:id="cha-update-alternative">
 <title><command>update-alternatives</command>: Gerenciando várias versões de comandos e arquivos</title>
 <info>
  <abstract>
   <para>
    Normalmente, há várias versões da mesma ferramenta instaladas em um sistema. Para que os administradores possam escolher e para possibilitar a instalação e o uso de versões diferentes lado a lado, o sistema de alternativas permite gerenciar as versões consistentemente.
   </para>
  </abstract>
 <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:bugtracker/>
   <dm:translation>yes</dm:translation>
  </dm:docmanager>
 </info>

  <sect1 xml:id="sec-ua-concept">
   <title>Visão Geral</title>
   <para>
    No <phrase role="productname"><phrase os="sled">SUSE Linux Enterprise Desktop</phrase></phrase>, alguns programas executam tarefas iguais ou semelhantes. Por exemplo, se ambos Java 1.7 e Java 1.8 estiverem instalados no sistema, o script do sistema de alternativas (<command>update-alternatives</command>) será chamado do pacote RPM. Por padrão, o sistema de alternativas fará referência à versão 1.8: Versões superiores também têm maior prioridade. No entanto, o administrador pode mudar o padrão e apontar o nome genérico para a versão 1.7.
   </para>
   <para>
    A seguinte terminologia é usada neste capítulo:
   </para>
   <variablelist>
    <title>Terminologia</title>
    <varlistentry>
     <term>Diretório administrativo</term>
     <listitem>
      <para>
       O diretório padrão <filename class="directory">/var/lib/rpm/alternatives</filename> contém informações sobre o estado atual das alternativas.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>Alternativa</term>
     <listitem>
      <para>
       O nome de um arquivo específico no sistema de arquivos, que pode tornar-se acessível por meio de um nome genérico usando o sistema de alternativas.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>Diretório de alternativas</term>
     <listitem>
      <para>
       O diretório padrão <filename class="directory">/etc/alternativas</filename> que contém links simbólicos.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>Nome genérico</term>
     <listitem>
      <para>
       Um nome (por exemplo, <command>/usr/bin/edit</command>) que se refere a um arquivo, dentre vários disponíveis, usando o sistema de alternativas.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>Grupo de links</term>
     <listitem>
      <para>
       Um conjunto de links simbólicos relacionados que podem ser atualizados como um grupo.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>Link master</term>
     <listitem>
      <para>
       O link, em um grupo de links, que determina como os outros links no grupo são configurados.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>Link escravo</term>
     <listitem>
      <para>
       Um link, em um grupo de links, controlado pelo link master.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>Link simbólico (symlink)</term>
     <listitem>
      <para>
       Um arquivo que é uma referência a outro arquivo no mesmo sistema de arquivos. O sistema de alternativas usa os links simbólicos no diretório de alternativas para alternar entre as versões de um arquivo.
      </para>
      <para>
       Os links simbólicos no diretório de alternativas podem ser modificados pelo administrador por meio do comando <command>update-alternatives</command>.
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
   <para>
    O sistema de alternativas oferece o comando <command>update-alternatives</command> para criar, remover, manter e mostrar informações sobre os links simbólicos. Embora esses links simbólicos geralmente apontem para comandos, eles também podem apontar para arquivos JAR, páginas de manual e outros arquivos. Os exemplos neste capítulo usam comandos e páginas de manual, mas também podem ser aplicáveis a outros tipos de arquivos.
   </para>
   <para>
    O sistema de alternativas usa o diretório de alternativas para coletar os links para possíveis alternativas. Quando um novo pacote com uma alternativa é instalado, a nova alternativa é adicionada ao sistema. Dependendo da prioridade e do modo definido, a nova alternativa do pacote será selecionada como padrão. Em geral, os pacotes com uma versão superior também têm maior prioridade. O sistema de alternativas pode operar em dois modos:
   </para>
   <itemizedlist>
    <listitem>
     <formalpara>
      <title>Modo automático</title>
      <para>
       Nesse modo, o sistema de alternativas garante que os links no grupo apontem para as alternativas de prioridade mais alta apropriadas ao grupo.
      </para>
     </formalpara>
    </listitem>
    <listitem>
     <formalpara>
      <title>Modo manual</title>
      <para>
       Nesse modo, o sistema de alternativas não faz quaisquer mudanças nas configurações do administrador do sistema.
      </para>
     </formalpara>
    </listitem>
   </itemizedlist>
   <para>
    Por exemplo, o comando <command>java</command> tem a seguinte hierarquia de links no sistema de alternativas:
   </para>
   <example>
    <title>Sistema de alternativas do comando <command>java</command></title>
    <screen>/usr/bin/java <co xml:id="co-ua-java-name"/>
 -&gt; /etc/alternatives/java <co xml:id="co-ua-java-symbolic-link"/>
     -&gt; /usr/lib64/jvm/jre-10-openjdk/bin/java <co xml:id="co-ua-java-alternatives"/></screen>
    
    <calloutlist>
     <callout arearefs="co-ua-java-name">
      <para>
       O nome genérico.
      </para>
     </callout>
     <callout arearefs="co-ua-java-symbolic-link">
      <para>
       O link simbólico no diretório de alternativas.
      </para>
     </callout>
     <callout arearefs="co-ua-java-alternatives">
      <para>
       Uma das alternativas.
      </para>
     </callout>
    </calloutlist>
   </example>
  </sect1>

  <sect1 xml:id="sec-ua-use-cases">
   <title>Casos de uso</title>
   <para>
    Por padrão, o script <command>update-alternatives</command> é chamado de um pacote RPM. Quando um pacote é instalado ou removido, o script se encarrega de todos os seus links simbólicos. Porém, você pode executá-lo manualmente da linha de comando para:
   </para>
   <itemizedlist>
    <listitem>
     <para>
      exibir as alternativas atuais para um nome genérico.
     </para>
    </listitem>
    <listitem>
     <para>
      mudar os padrões de uma alternativa.
     </para>
    </listitem>
    <listitem>
     <para>
     criar um conjunto de arquivos relacionados para uma alternativa.
     </para>
    </listitem>
   </itemizedlist>
  </sect1>

  <sect1 xml:id="sec-ua-view-all">
   <title>Obtendo uma visão geral das alternativas</title>
   <para>
    Para recuperar os nomes de todas as alternativas configuradas, use:
   </para>
 <screen><prompt>&gt; </prompt><command>ls /var/lib/alternatives</command></screen>
   <para>
    Para obter uma visão geral de todas as alternativas configuradas e os respectivos valores, use
   </para>
   <screen><prompt>&gt; </prompt><command>sudo</command> <command>update-alternatives --get-selections</command>
asadmin                        auto     /usr/bin/asadmin-2.7
awk                            auto     /usr/bin/gawk
chardetect                     auto     /usr/bin/chardetect-3.6
dbus-launch                    auto     /usr/bin/dbus-launch.x11
default-displaymanager         auto     /usr/lib/X11/displaymanagers/gdm
[...]</screen>
  </sect1>

  <sect1 xml:id="sec-ua-view">
   <title>Vendo detalhes das alternativas específicas</title>
   <para>
    A maneira mais fácil de verificar as alternativas é seguir os links simbólicos do seu comando. Por exemplo, para saber a que o comando <command>java</command> se refere, execute o seguinte comando:
   </para>
   <screen><prompt>&gt; </prompt><command>readlink --canonicalize /usr/bin/java</command>
/usr/lib64/jvm/jre-10-openjdk/bin/java</screen>
   <para>
    Se aparecer o mesmo caminho (em nosso exemplo, o caminho é <filename>/usr/bin/java</filename>), não haverá alternativas disponíveis para esse comando.
   </para>
   
   <para>
    Para ver as alternativas completas (incluindo escravos), use a opção <option>--display</option>:
   </para>
   <screen><prompt>&gt; </prompt><command>sudo</command> <command>update-alternatives --display java</command>
java - auto mode
  link best version is /usr/lib64/jvm/jre-1.8.0-openjdk/bin/java
  link currently points to /usr/lib64/jvm/jre-1.8.0-openjdk/bin/java
  link java is /usr/bin/java
  slave java.1.gz is /usr/share/man/man1/java.1.gz
  slave jre is /usr/lib64/jvm/jre
  slave jre_exports is /usr/lib64/jvm-exports/jre
  slave keytool is /usr/bin/keytool
  slave keytool.1.gz is /usr/share/man/man1/keytool.1.gz
  slave orbd is /usr/bin/orbd
  slave orbd.1.gz is /usr/share/man/man1/orbd.1.gz
[...]</screen>
  </sect1>

  <sect1 xml:id="sec-ua-set">
   <title>Definindo a versão padrão das alternativas</title>
   <para>
    Por padrão, os comandos em <filename>/usr/bin</filename> fazem referência ao diretório de alternativas com a prioridade mais alta. Por exemplo, por padrão, o comando <command>java</command> mostra o seguinte número da versão:
   </para>
   <screen><prompt>&gt; </prompt><command>java -version</command>
openjdk version "10.0.1" 2018-04-17
OpenJDK Runtime Environment (build 10.0.1+10-suse-lp150.1.11-x8664)
OpenJDK 64-Bit Server VM (build 10.0.1+10-suse-lp150.1.11-x8664, mixed mode)</screen>
   <para>
    Para mudar o comando <command>java</command> padrão para fazer referência a uma versão anterior, execute:
   </para>
   <screen><prompt>&gt; </prompt><command>sudo</command> <command>update-alternatives --config java</command>
root's password:
There are 2 choices for the alternative java (providing /usr/bin/java).

  Selection    Path                                       Priority   Status
------------------------------------------------------------
* 0            /usr/lib64/jvm/jre-10-openjdk/bin/java      2005      auto mode
  1            /usr/lib64/jvm/jre-1.8.0-openjdk/bin/java   1805      manual mode
  2            /usr/lib64/jvm/jre-10-openjdk/bin/java      2005      manual mode
  3            /usr/lib64/jvm/jre-11-openjdk/bin/java      0         manual mode

Press &lt;enter&gt; to keep the current choice[*], or type selection number:</screen>
   <para>
    Dependendo do sistema e das versões instaladas, o número exato da versão do Java será diferente. Depois que você selecionar <literal>1</literal>, o <command>java</command> mostrará o seguinte número da versão:
   </para>
   <screen><prompt>&gt; </prompt><command>java -version</command>
java version "1.8.0_171"
OpenJDK Runtime Environment (IcedTea 3.8.0) (build 1.8.0_171-b11 suse-lp150.2.3.1-x86_64)
OpenJDK 64-Bit Server VM (build 25.171-b11, mixed mode)</screen>
   <para>
    Além disso, tenha em mente os seguintes pontos:
   </para>
   <itemizedlist>
    <listitem>
     <para>
      Ao trabalhar no modo manual e instalar outra versão do Java, o sistema de alternativas não afeta os links nem muda o nome genérico.
     </para>
    </listitem>
    <listitem>
     <para>
      Ao trabalhar no modo automático e instalar outra versão do Java, o sistema de alternativas muda o link master do Java e todos os links escravos (como você pode ver na <xref linkend="sec-ua-view"/>). Para verificar os relacionamentos entre master e escravo, use:
     </para>
     <screen><prompt>&gt; </prompt><command>sudo</command> <command>update-alternatives --display java</command></screen>
    </listitem>
   </itemizedlist>
  </sect1>

  <sect1 xml:id="sec-ua-install">
   <title>Instalando alternativas personalizadas</title>
   <para>
    Esta seção descreve como configurar alternativas personalizadas em um sistema. O exemplo faz as seguintes suposições:
   </para>
   <itemizedlist>
    <listitem>
     <para>
      Há dois scripts, <command>foo-2</command> e <command>foo-3</command>, com funcionalidade semelhante.
     </para>
    </listitem>
    <listitem>
     <para>
      Os scripts são armazenados no diretório <filename>/usr/local/bin</filename> para evitar conflitos com as ferramentas do sistema em <filename>/usr/bin</filename>.
     </para>
    </listitem>
    <listitem>
     <para>
      Há um link master <command>foo</command> que aponta para <command>foo-2</command> ou <command>foo-3</command>.
     </para>
    </listitem>
   </itemizedlist>
   <para>
    Para oferecer alternativas no sistema, siga estas etapas:
   </para>
   <procedure>
    <step>
     <para>
      Copie seus scripts para o diretório <filename>/usr/local/bin</filename>.
     </para>
    </step>
    <step>
     <para>
      Torne os scripts executáveis:
     </para>
     <screen><prompt>&gt; </prompt><command>sudo</command> <command>chmod +x /usr/local/bin/foo-{2,3}</command></screen>
    </step>
    <step>
     <para>
      Execute <command>update-alternatives</command> para os dois scripts:
     </para>
     <screen><prompt>&gt; </prompt><command>sudo</command> update-alternatives --install \
   /usr/local/bin/foo <co xml:id="co-ua-ua-install-usr-local-bin-foo"/>\
   foo <co xml:id="co-ua-ua-install-foo"/>\
   /usr/local/bin/foo-2 <co xml:id="co-ua-ua-install-usr-local-bin-foo-path"/>\
   200 <co xml:id="co-ua-ua-install-prio"/>
<prompt>&gt; </prompt><command>sudo</command> update-alternatives --install \
   /usr/local/bin/foo <xref linkend="co-ua-ua-install-usr-local-bin-foo"/>\
   foo <xref linkend="co-ua-ua-install-foo"/>\
   /usr/local/bin/foo-3 <xref linkend="co-ua-ua-install-usr-local-bin-foo-path"/>\
   300 <xref linkend="co-ua-ua-install-prio"/></screen>
     <para>
      As opções após <option>--install</option> têm os seguintes significados:
     </para>
     <calloutlist>
      <callout arearefs="co-ua-ua-install-usr-local-bin-foo">
       <para>
        O nome genérico. Para evitar confusão, geralmente é o nome do script sem quaisquer números de versão.
       </para>
      </callout>
      <callout arearefs="co-ua-ua-install-foo">
       <para>
        O nome do link master. Deve ser o mesmo.
       </para>
      </callout>
      <callout arearefs="co-ua-ua-install-usr-local-bin-foo-path">
       <para>
        O caminho para o(s) script(s) original(is) localizado(s) em <filename>/usr/local/bin</filename>.
       </para>
      </callout>
      <callout arearefs="co-ua-ua-install-prio">
       <para>
        A prioridade. Especificamos para <command>foo-2</command> uma prioridade mais baixa do que para <command>foo-3</command>. É recomendável usar um aumento significativo de número para separar as prioridades. Por exemplo, uma prioridade de 200 para <command>foo-2</command> e de 300 para <command>foo-3</command>.
       </para>
      </callout>
     </calloutlist>
    </step>
    <step>
     <para>
      Verifique o link master:
     </para>
     <screen><prompt>&gt; </prompt><command>sudo</command> <command>update-alternatives --display foo</command>
foo - auto mode
  link best version is /usr/local/bin/foo-3
  link currently points to /usr/local/bin/foo-3
  link foo is /usr/local/bin/foo
/usr/local/bin/foo-2 - priority 200
/usr/local/bin/foo-3 - priority 300</screen>
    </step>
   </procedure>
   <para>
    Após concluir as etapas descritas, você poderá usar o link master <command>/usr/local/bin/foo</command>.
   </para>
   <para>
    Se necessário, você poderá instalar outras alternativas. Para remover uma alternativa, use o seguinte comando:
   </para>
   <screen><prompt>&gt; </prompt><command>sudo</command> <command>update-alternatives --remove foo /usr/local/bin/foo-2</command></screen>
   <para>
    Depois que esse script for removido, o sistema de alternativas do grupo foo terá esta aparência:
   </para>
   <screen><prompt>&gt; </prompt><command>sudo</command> <command>update-alternatives --display foo</command>
foo - auto mode
  link best version is /usr/local/bin/foo-3
  link currently points to /usr/local/bin/foo-3
  link foo is /usr/local/bin/foo
/usr/local/bin/foo-3 - priority 300</screen>
  </sect1>

  <sect1 xml:id="sec-ua-slave">
   <title>Definindo alternativas dependentes</title>
   <para>
    Se você tem alternativas, o próprio script não é suficiente. A maioria dos comandos não é completamente independente: Em geral, eles são fornecidos com arquivos adicionais, como extensões, configurações ou páginas de manual. Para criar alternativas que dependem de um link master, use as <emphasis>alternativas de escravos</emphasis>.
   </para>
   <para>
    Vamos supor que desejamos estender nosso exemplo na <xref linkend="sec-ua-install"/> e fornecer páginas de manual e arquivos de configuração:
   </para>
   <itemizedlist>
    <listitem>
     <para>
      Duas páginas de manual, <filename>foo-2.1.gz</filename> e <filename>foo-3.1.gz</filename>, armazenadas no diretório <filename>/usr/local/man/man1</filename>.
     </para>
    </listitem>
    <listitem>
     <para>
      Dois arquivos de configuração, <filename>foo-2.conf</filename> e <filename>foo-3.conf</filename>, armazenados em <filename>/etc</filename>.
     </para>
    </listitem>
   </itemizedlist>
   <para>
    Siga estas etapas para adicionar os outros arquivos às alternativas:
   </para>
   <procedure>
    <step>
     <para>
      Copie os arquivos de configuração em <filename>/etc</filename>:
     </para>
     <screen><prompt>&gt; </prompt><command>sudo</command> <command>cp foo-{2,3}.conf /etc</command></screen>
    </step>
    <step>
     <para>
      Copie as páginas de manual para o diretório <filename>/usr/local/man/man1</filename>:
     </para>
     <screen><prompt>&gt; </prompt><command>sudo</command> <command>cp foo-{2,3}.1.gz /usr/local/man/man1/</command></screen>
    </step>
    <step>
     <para>
      Adicione os links escravos aos scripts principais com a opção <option>--slave</option>:
     </para>
     <screen><prompt>&gt; </prompt><command>sudo</command> <command>update-alternatives --install \
   /usr/local/bin/foo foo /usr/local/bin/foo-2 200 \
   --slave /usr/local/man/man1/foo.1.gz \
   foo.1.gz \
   /usr/local/man/man1/foo-2.1.gz \
   --slave /etc/foo.conf \
   foo.conf \
   /etc/foo-2.conf</command>
<prompt>&gt; </prompt><command>sudo</command> <command>update-alternatives --install \
   /usr/local/bin/foo foo /usr/local/bin/foo-3 300 \
   --slave /usr/local/man/man1/foo.1.gz \
   foo.1.gz \
   /usr/local/man/man1/foo-3.1.gz \
   --slave /etc/foo.conf \
   foo.conf \
   /etc/foo-3.conf</command></screen>
    </step>
    <step>
     <para>Verifique o link master:</para>
     <screen>foo - auto mode
  link best version is /usr/local/bin/foo-3
  link currently points to /usr/local/bin/foo-3
  link foo is /usr/local/bin/foo
  slave foo.1.gz is /usr/local/man/man1/foo.1.gz
  slave foo.conf is /etc/foo.conf
/usr/local/bin/foo-2 - priority 200
  slave foo.1.gz: /usr/local/man/man1/foo-2.1.gz
  slave foo.conf: /etc/foo-2.conf
/usr/local/bin/foo-3 - priority 300
  slave foo.1.gz: /usr/local/man/man1/foo-3.1.gz
  slave foo.conf: /etc/foo-3.conf</screen>
    </step>
   </procedure>
   <para>
    Se você mudar os links com <command>update-alternatives --config foo</command> para <command>foo-2</command>, todos os links escravos também serão mudados.
   </para>
  </sect1>

  
</chapter>
