<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="storage_degraded_raid.xml" version="5.0" xml:id="cha-raid-degraded" xml:lang="zh-tw">
 <title>建立降級 RAID 陣列</title>
 <info>
  <abstract>
   <para>
    降級陣列是指其中某些裝置遺失的陣列。只有 RAID 1、RAID 4、RAID 5 和 RAID 6 支援降級陣列。這些 RAID 類型具有容錯功能，可容許遺失某些裝置。降級陣列通常發生在裝置故障時。也可能會出於某種目的而建立降級陣列。
   </para>
  </abstract>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:bugtracker/>
   <dm:translation>yes</dm:translation>
  </dm:docmanager>
 </info>
 <informaltable>
  <tgroup cols="2">
   <colspec colnum="1" colname="1" colwidth="30*"/>
   <colspec colnum="2" colname="2" colwidth="70*"/>
   <thead>
    <row>
     <entry>
      <para>
       RAID 類型
      </para>
     </entry>
     <entry>
      <para>
       允許遺失插槽數量
      </para>
     </entry>
    </row>
   </thead>
   <tbody>
    <row>
     <entry>
      <para>
       RAID 1
      </para>
     </entry>
     <entry>
      <para>
       只要有一個裝置未遺失即可
      </para>
     </entry>
    </row>
    <row>
     <entry>
      <para>
       RAID 4
      </para>
     </entry>
     <entry>
      <para>
       一個插槽
      </para>
     </entry>
    </row>
    <row>
     <entry>
      <para>
       RAID 5
      </para>
     </entry>
     <entry>
      <para>
       一個插槽
      </para>
     </entry>
    </row>
    <row>
     <entry>
      <para>
       RAID 6
      </para>
     </entry>
     <entry>
      <para>
       一或兩個插槽
      </para>
     </entry>
    </row>
   </tbody>
  </tgroup>
 </informaltable>
 <para>
  若要建立其中某些裝置遺失的降級陣列，只需以 <literal>missing</literal> 一詞替換裝置名稱。這會導致 <command>mdadm</command> 將陣列中的相應插槽保留空白。
 </para>
 <para>
  建立 RAID 5 陣列時，<command>mdadm</command> 會自動建立具有額外備用磁碟機的降級陣列。這是因為在降級陣列中建立備用磁碟機通常比重新同步非降級但不乾淨的陣列上的同位要快得多。您可以使用 <literal>--force</literal> 選項覆寫該功能。
 </para>
 <para>
  如果您要建立 RAID，但要使用的其中一個裝置上已有資料，則可以建立降級陣列。在這種情況下，建立具有其他裝置的降級陣列，將資料從使用中的裝置複製到在降級模式下執行的 RAID，再將該裝置新增至 RAID，然後等候 RAID 重建，如此操作資料就會分佈到所有裝置。下列程序是該處理程序的一個範例：
 </para>
 <procedure>
  <step>
   <para>
    若要使用單個磁碟機 <filename>/dev/sd1</filename> 建立降級的 RAID 1 裝置 <filename>/dev/md0</filename>，請在命令提示字元處輸入以下指令：
   </para>
<screen><prompt>&gt; </prompt><command>sudo</command> mdadm --create /dev/md0 -l 1 -n 2 /dev/sda1 missing</screen>
   <para>
    該裝置大小應不小於您計劃新增的裝置。
   </para>
  </step>
  <step>
   <para>
    如果您要新增至鏡像複製的裝置包含要移至 RAID 陣列的資料，請將該資料立即複製到在降級模式下執行的 RAID 陣列。
   </para>
  </step>
  <step>
   <para>
    將您從中複製資料的裝置新增至鏡像。例如，若要新增 <filename>/dev/sdb1</filename> 至 RAID，請在命令提示字元處輸入以下指令：
   </para>
<screen><prompt>&gt; </prompt><command>sudo</command> mdadm /dev/md0 -a /dev/sdb1</screen>
   <para>
    您一次只能新增一個裝置。請耐心等候核心建立鏡像複製並將其完全發佈到線上，然後才能新增其他鏡像複製。
   </para>
  </step>
  <step>
   <para>
    在命令提示字元下輸入以下指令以監控建立進度：
   </para>
<screen><prompt>&gt; </prompt><command>sudo</command> cat /proc/mdstat</screen>
   <para>
    若要查看每秒重新整理一次的重建進度，請輸入
   </para>
<screen><prompt>&gt; </prompt><command>sudo</command> watch -n 1 cat /proc/mdstat </screen>
  </step>
 </procedure>
</chapter>
