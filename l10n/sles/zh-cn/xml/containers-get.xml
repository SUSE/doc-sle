<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="containers-get.xml" version="5.0" xml:id="cha-containers-get">
 <info>
  <title>获取容器</title>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:translation>yes</dm:translation>
  </dm:docmanager>
 </info>
 <para>
  本章提供获取容器映像的相关信息。
 </para>
 <sect1 xml:id="sec-sle-base-images">
  <title>SUSE Linux Enterprise 基本映像</title>

  <para>
   SUSE 提供了多个官方基本容器映像，您可以基于这些映像构建自定义容器。每个 SLE 基本映像提供一个具有外壳和软件包管理功能的最小环境。
  </para>

  <para>
   您可从 <link xlink:href="https://registry.suse.com"/> 获取基本映像。有关 SUSE 注册表的信息，请参见<xref linkend="sec-suse-registry"/>。SUSE 注册表中的基本映像都处于“正式发布”状态（也就是说，它们适合用于生产环境），并且是 SLES 12 和 SLES 15 的 <link xlink:href="https://www.suse.com/products/long-term-service-pack-support/">LTSS</link> 版本。SUSE 注册表中的 SUSE Linux Enterprise 基本映像会收到安全更新，并涵盖在 SUSE 支持计划中。有关这些支持计划的详细信息，请参见<xref linkend="cha-containers-support"/>。
  </para>
 </sect1>
 <sect1 xml:id="sec-suse-container-properties">
  <title>SUSE 容器属性</title>

  <para>
   SUSE 容器映像都有标识符，这些标识符提供有关这些映像的版本、来源和创建时间的信息。从储存库中提取容器映像并在其上运行 <literal>podman inspect</literal> 之后，便可访问下面列出的各个标识符。
  </para>

  <sect2 xml:id="sec-repository-names">
   <title>储存库名称</title>
   <para>
    软件源名称以产品名称开头，例如：<literal>suse/sle...</literal> 和 <literal>opensuse/tumbleweed</literal>。适用于所有服务包的 SLE 15 容器位于储存库 <literal>suse/sle15</literal> 中。但对于 SLE 12，每个服务包都有一个单独的储存库名称，例如 <literal>suse/sles12sp3</literal>、<literal>suse/sles12sp4</literal> 和 <literal>suse/sles12sp5</literal>。
   </para>
  </sect2>

  <sect2 xml:id="sec-labels">
   <title>标签</title>
   <para>
    标签有助于识别映像。所有 SLE 容器映像标签均以 <literal>com.suse.<replaceable>PRODUCT</replaceable><replaceable>CONTAINER_NAME</replaceable></literal> 开头，后跟其他详细信息。容器映像还包含 <literal>org.opencontainers.image</literal> 标签。
   </para>
   <para>
    下面是所有当前定义的标签的列表。
   </para>
   <variablelist>
    <varlistentry>
     <term><literal>org.opencontainers.image.<emphasis role="strong">title</emphasis></literal>、<literal>com.suse.sle.base.<emphasis role="strong">title</emphasis></literal></term>
     <listitem>
      <itemizedlist>
       <listitem>
        <para>
         <emphasis>必须由派生映像提供：</emphasis>是
        </para>
       </listitem>
       <listitem>
        <para>
         <emphasis>OCI 表示法：</emphasis>
         <literal>org.opencontainers.image.title</literal>
        </para>
       </listitem>
       <listitem>
        <para>
         <emphasis>说明：</emphasis>映像标题
        </para>
       </listitem>
       <listitem>
        <para>
         <emphasis>示例：</emphasis> <literal>SUSE Linux Enterprise 15 基本容器</literal>
        </para>
       </listitem>
      </itemizedlist>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>org.opencontainers.image.<emphasis role="strong">description</emphasis></literal>、<literal>com.suse.sle.base.<emphasis role="strong">description</emphasis></literal></term>
     <listitem>
      <itemizedlist>
       <listitem>
        <para>
         <emphasis>必须由派生映像提供：</emphasis>是
        </para>
       </listitem>
       <listitem>
        <para>
         <emphasis>OCI 表示法：</emphasis>
         <literal>org.opencontainers.image.description</literal>
        </para>
       </listitem>
       <listitem>
        <para>
         <emphasis>说明：</emphasis>映像的简要说明
        </para>
       </listitem>
       <listitem>
        <para>
         <emphasis>示例：</emphasis> <literal>包含基于 SUSE Linux Enterprise 15 的容器适用最小环境的映像</literal>
        </para>
       </listitem>
      </itemizedlist>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>org.opencontainers.image.<emphasis role="strong">version</emphasis></literal>、<literal>com.suse.sle.base.<emphasis role="strong">version</emphasis></literal></term>
     <listitem>
      <itemizedlist>
       <listitem>
        <para>
         <emphasis>必须由派生映像提供：</emphasis>是
        </para>
       </listitem>
       <listitem>
        <para>
         <emphasis>OCI 表示法：</emphasis>
         <literal>org.opencontainers.image.version</literal>
        </para>
       </listitem>
       <listitem>
        <para>
         <emphasis>说明：</emphasis>映像版本 (<literal><replaceable>MAJOR</replaceable>.<replaceable>SP</replaceable>.<replaceable>CICOUNT</replaceable>.<replaceable>BUILDCOUNT</replaceable></literal>)
        </para>
       </listitem>
       <listitem>
        <para>
         <emphasis>示例：</emphasis> <literal>15.0.4.2</literal>
        </para>
       </listitem>
      </itemizedlist>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>org.opencontainers.image.<emphasis role="strong">created</emphasis></literal>、<literal>com.suse.sle.base.<emphasis role="strong">created</emphasis></literal></term>
     <listitem>
      <itemizedlist>
       <listitem>
        <para>
         <emphasis>必须由派生映像提供：</emphasis>是
        </para>
       </listitem>
       <listitem>
        <para>
         <emphasis>OCI 表示法：</emphasis>
         <literal>org.opencontainers.image.created</literal>
        </para>
       </listitem>
       <listitem>
        <para>
         <emphasis>说明：</emphasis>映像构建时戳
        </para>
       </listitem>
       <listitem>
        <para>
         <emphasis>示例：</emphasis> <literal>2018-07-27T14:12:30Z</literal>
        </para>
       </listitem>
      </itemizedlist>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>org.opencontainers.image.<emphasis role="strong">vendor</emphasis></literal>、<literal>com.suse.sle.base.<emphasis role="strong">vendor</emphasis></literal></term>
     <listitem>
      <itemizedlist>
       <listitem>
        <para>
         <emphasis>必须由派生映像提供：</emphasis>否
        </para>
       </listitem>
       <listitem>
        <para>
         <emphasis>OCI 表示法：</emphasis>
         <literal>org.opencontainers.image.vendor</literal>
        </para>
       </listitem>
       <listitem>
        <para>
         <emphasis>说明：</emphasis>映像供应商
        </para>
       </listitem>
       <listitem>
        <para>
         <emphasis>示例：</emphasis> <literal>SUSE LLC</literal>
        </para>
       </listitem>
      </itemizedlist>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>org.opencontainers.image.<emphasis role="strong">url</emphasis></literal>、<literal>com.suse.sle.base.<emphasis role="strong">url</emphasis></literal></term>
     <listitem>
      <itemizedlist>
       <listitem>
        <para>
         <emphasis>必须由派生映像提供：</emphasis>否
        </para>
       </listitem>
       <listitem>
        <para>
         <emphasis>OCI 表示法：</emphasis>
         <literal>org.opencontainers.image.url</literal>
        </para>
       </listitem>
       <listitem>
        <para>
         <emphasis>说明：</emphasis>附加信息
        </para>
       </listitem>
       <listitem>
        <para>
         <emphasis>示例：</emphasis>
         <literal>https://www.suse.com/products/server/</literal>
        </para>
       </listitem>
      </itemizedlist>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>org.openbuildservice.<emphasis role="strong">disturl</emphasis></literal>、<literal>com.suse.sle.base.<emphasis role="strong">disturl</emphasis></literal></term>
     <listitem>
      <itemizedlist>
       <listitem>
        <para>
         <emphasis>必须由派生映像提供：</emphasis>是
        </para>
       </listitem>
       <listitem>
        <para>
         <emphasis>OCI 表示法：</emphasis>
         <literal>org.openbuildservice.disturl</literal>
        </para>
       </listitem>
       <listitem>
        <para>
         <emphasis>说明：</emphasis>映像 OBS URL
        </para>
       </listitem>
       <listitem>
        <para>
         <emphasis>示例：</emphasis>
         <literal>obs://build.suse.de/SUSE:SLE-15:Update:CR/images/2951b67133dd6384cacb28203174e030-sles15-image</literal>
        </para>
       </listitem>
      </itemizedlist>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>org.opensuse.<emphasis role="strong">reference</emphasis></literal>、<literal>com.suse.sle.base.<emphasis role="strong">reference</emphasis></literal></term>
     <listitem>
      <itemizedlist>
       <listitem>
        <para>
         <emphasis>必须由派生映像提供：</emphasis>是
        </para>
       </listitem>
       <listitem>
        <para>
         <emphasis>OCI 表示法：</emphasis>
         <literal>org.opensuse.reference</literal>
        </para>
       </listitem>
       <listitem>
        <para>
         <emphasis>说明：</emphasis>指向映像的引用。切勿更改您使用 <command>docker pull <replaceable>REF_NAME</replaceable></command> 获取的映像。
        </para>
       </listitem>
       <listitem>
        <para>
         <emphasis>示例：</emphasis>
         <literal>registry.suse.com/suse/sle15:4.2</literal>
        </para>
       </listitem>
      </itemizedlist>
     </listitem>
    </varlistentry>
   </variablelist>
  </sect2>

  <sect2 xml:id="sec-tags">
   <title>标记</title>
   <para>
    标记用于引用映像。标记是映像名称的组成部分。与标签不同，标记可以自由定义，通常用于表示版本号。
   </para>
   <para>
    如果某个标记存在于多个映像中，则将使用最新的映像。由映像维护者决定指派给容器映像的标记。
   </para>
   <para>
    常规标记格式为：<literal>储存库名称</literal>: <literal>映像版本规范</literal>（通常为版本号）。例如，<phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> 15 SP2 的最新发布映像的标记将为 <literal>suse/sle15:15.2</literal>。
   </para>
  </sect2>
 </sect1>
 <sect1 xml:id="sec-suse-registry">
  <title>SUSE 注册表</title>

  <para>
   官方 SUSE 注册表可从 <link xlink:href="https://registry.suse.com"/> 获取。它包含经过测试和更新的 SUSE Linux Enterprise 基本容器映像。SUSE 注册表中的所有映像都要经历一个维护过程。构建的映像包含最新可用的更新和修复。SUSE 注册表的 Web 用户界面列出了一部分可用映像。
  </para>
 </sect1>
<sect1 xml:id="sec-verify-containers">
  <title>校验容器</title>
  <para>
  通过 SUSE 注册表提供的映像签名储存在 Notary 中。您可以使用以下命令校验特定映像的签名：
  </para>
<screen>docker trust inspect --pretty registry.suse.com/suse<replaceable>IMAGE</replaceable>:<replaceable>TAG</replaceable></screen>
<para>
例如，<command>docker trust inspect --pretty registry.suse.com/suse/sle15:latest</command> 命令可校验最新 SLE15 基本映像的签名。
</para>
<para>
要在提取映像时自动校验该映像，请将环境变量 <literal>DOCKER_CONTENT_TRUST</literal> 设置为 <literal>1</literal>。例如：
</para>
<screen>env DOCKER_CONTENT_TRUST=1 docker pull registry.suse.com/suse/sle15:latest</screen>
  </sect1>
 <sect1 xml:id="sec-compare-containers">
  <title>比较容器</title>

  <para>
   <link xlink:href="https://github.com/GoogleContainerTools/container-diff#container-diff">container-diff</link> 工具可用于分析和比较容器映像。<literal>container-diff</literal> 可根据多个准则检查映像，其中包括：
  </para>

  <itemizedlist>
   <listitem>
    <para>
     Docker 映像历史
    </para>
   </listitem>
   <listitem>
    <para>
     映像文件系统
    </para>
   </listitem>
   <listitem>
    <para>
     DEB 软件包
    </para>
   </listitem>
   <listitem>
    <para>
     RPM 软件包
    </para>
   </listitem>
   <listitem>
    <para>
     PyPI 软件包
    </para>
   </listitem>
   <listitem>
    <para>
     NPM 软件包
    </para>
   </listitem>
  </itemizedlist>

  <para>
   您可以检查单个映像，也可以对两个映像执行 diff 操作。<literal>container-diff</literal> 支持位于本地 Docker 守护程序和远程注册表中的 Docker 映像。您也可以对 <filename>.tar</filename>、<filename>.tar.gz</filename> 和 <filename>.tgz</filename> 存档使用该工具。
  </para>

  <para>
   <package>container-diff</package> 软件包属于 <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase>
   <phrase role="productnumber"><phrase os="sles;sled">15 SP4</phrase></phrase> Containers 模块的一部分。您也可以单独安装该软件包。有关安装该软件包的说明，请参见 <link xlink:href="https://github.com/GoogleContainerTools/container-diff#installation">container-diff 文档</link>。
  </para>
 </sect1>
</chapter>
