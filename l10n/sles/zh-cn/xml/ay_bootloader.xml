<?xml version="1.0" encoding="UTF-8"?>
<sect1 xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="ay_bootloader.xml" version="5.0" xml:id="CreateProfile-Bootloader">
 <title>引导装载程序</title>

 <info>
      <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
        <dm:bugtracker/>
        <dm:translation>是</dm:translation>
      </dm:docmanager>
    </info>
    <para>
    本文档用于 <command>yast2-bootloader</command>，并适用于 GRUB 2。对于传统 GRUB 随附的早期产品版本，请参见 <filename>/usr/share/doc/packages/autoyast2/</filename> 中发行套件随附的文档
   </para>

   <para>
    AutoYaST 引导加载程序部分的一般结构如下所示：
   </para>

<screen>&lt;bootloader&gt;
  &lt;loader_type&gt;
    &lt;!-- boot loader type (grub2 or grub2-efi) --&gt;
  &lt;/loader_type&gt;
  &lt;global&gt;
    &lt;!--
      entries defining the installation settings for GRUB 2 and
      the generic boot code
    --&gt;
  &lt;/global&gt;
  &lt;device_map config:type="list"&gt;
    &lt;!-- entries defining the order of devices --&gt;
  &lt;/device_map&gt;
 &lt;/bootloader&gt;</screen>

   <sect2 xml:id="CreateProfile-Bootloader-type">
    <title>加载程序类型</title>
    <para>
     此部分定义要使用哪个引导加载程序（UEFI 或 BIOS/传统）。并非所有体系结构都支持引导加载程序的传统和 EFI 这两种变体。最安全的 (<literal>default</literal>) 选项是让安装程序做出决定。
    </para>
    <screen>&lt;loader_type&gt;<replaceable>LOADER_TYPE</replaceable>&lt;/loader_type&gt;</screen>
    <para>
     <replaceable>LOADER_TYPE</replaceable> 的可能值为：
    </para>
    <itemizedlist>
     <listitem>
      <para>
       <literal>default</literal>：安装程序选择正确的引导加载程序。未定义选项时，这是默认选项。
      </para>
     </listitem>
     <listitem>
      <para>
       <literal>grub2</literal>：使用传统 BIOS 引导加载程序。
      </para>
     </listitem>
     <listitem>
      <para>
       <literal>grub2-efi</literal>：使用 EFI 引导加载程序。
      </para>
     </listitem>
     <listitem>
      <para>
       <literal>none</literal>：引导进程不由安装程序管理和配置。
      </para>
     </listitem>
    </itemizedlist>
   </sect2>

   <sect2 xml:id="CreateProfile-Bootloader-globals">
    <title>全局</title>
    <para>
     这是一个可选但又很重要的部分。在此处定义要将 GRUB 2 安装到何处以及引导进程的工作方式。同样，如果您未定义配置，<command>yast2-bootloader</command> 将建议一种配置。通常，AutoYaST 控制文件仅包含此部分，在安装期间 <command>yast2-bootloader</command> 会自动添加所有其他部分。除非您有特殊的要求，否则请不要在 XML 文件中指定引导加载程序配置。
    </para>
<screen>&lt;global&gt;
  &lt;activate config:type="boolean"&gt;true&lt;/activate&gt;
  &lt;timeout config:type="integer"&gt;10&lt;/timeout&gt;
  &lt;suse_btrfs config:type="boolean"&gt;true&lt;/suse_btrfs&gt;
  &lt;terminal&gt;gfxterm&lt;/terminal&gt;
  &lt;gfxmode&gt;1280x1024x24&lt;/gfxmode&gt;
&lt;/global&gt;</screen>
    <informaltable>
     <tgroup cols="2">
      <thead>
       <row>
        <entry>
         <para>
          属性
         </para>
        </entry>
        <entry>
         <para>
          说明
         </para>
        </entry>
       </row>
      </thead>
      <tbody>
       <row>
        <entry>
         <para>
          <literal>activate</literal>
         </para>
        </entry>
        <entry>
         <para>
          在引导分区上设置引导标志。如果没有单独的 /boot 分区，引导分区可以是 <filename>/</filename>。如果引导分区位于逻辑分区上，引导标志将设置为扩展分区。
         </para>
<screen>&lt;activate config:type="boolean"&gt;true&lt;/activate&gt;</screen>
        </entry>
       </row>
       <row>
        <entry>
         <para>
          <literal>append</literal>
         </para>
        </entry>
        <entry>
         <para>
          在常规和恢复模式的引导项末尾添加的内核参数。
         </para>
<screen>&lt;append&gt;nomodeset vga=0x317&lt;/append&gt;</screen>
        </entry>
       </row>
       <row>
        <entry>
         <para>
          <literal>boot_boot</literal>
         </para>
        </entry>
        <entry>
         <para>
          将 GRUB 2 写入单独的 /boot 分区。如果不存在单独的 /boot 分区，则将 GRUB 2 写入 <filename>/</filename>。
         </para>
<screen>&lt;boot_boot&gt;false&lt;/boot_boot&gt;</screen>
        </entry>
       </row>
       <row>
        <entry>
         <para>
          <literal>boot_custom</literal>
         </para>
        </entry>
        <entry>
         <para>
          将 GRUB 2 写入自定义设备。
         </para>
<screen>&lt;boot_custom&gt;/dev/sda3&lt;/boot_custom&gt;</screen>
        </entry>
       </row>
       <row>
        <entry>
         <para>
          <literal>boot_extended</literal>
         </para>
        </entry>
        <entry>
         <para>
          将 GRUB 2 写入扩展分区（如果您想要使用通用引导代码，而 <filename>/boot</filename> 分区是逻辑分区，则此属性非常重要）。注意：如果引导分区是逻辑分区，则您应该使用 <literal>boot_mbr</literal>（将 GRUB 2 写入 MBR）而不是 <literal>generic_mbr</literal>。
         </para>
<screen>&lt;boot_extended&gt;false&lt;/boot_extended&gt;</screen>
        </entry>
       </row>
       <row>
        <entry>
         <para>
          <literal>boot_mbr</literal>
         </para>
        </entry>
        <entry>
         <para>
          将 GRUB 2 按顺序写入第一个磁盘的 MBR（device.map 包含磁盘顺序）。
         </para>
<screen>&lt;boot_mbr&gt;false&lt;/boot_mbr&gt;</screen>
        </entry>
       </row>
       <row>
        <entry>
         <para>
          <literal>boot_root</literal>
         </para>
        </entry>
        <entry>
         <para>
          将 GRUB 2 写入 <filename>/</filename> 分区。
         </para>
<screen>&lt;boot_root&gt;false&lt;/boot_root&gt;</screen>
        </entry>
       </row>
       <row>
        <entry>
         <para>
          <literal>generic_mbr</literal>
         </para>
        </entry>
        <entry>
         <para>
          将通用引导代码写入 MBR（如果 <literal>boot_mbr</literal> 设置为 <literal>true</literal>，将忽略此属性）。
         </para>
<screen>&lt;generic_mbr config:type="boolean"&gt;false&lt;/generic_mbr&gt;</screen>
        </entry>
       </row>
       <row>
        <entry>
         <para>
          <literal>gfxmode</literal>
         </para>
        </entry>
        <entry>
         <para>
          GRUB 2 屏幕的图形分辨率（要求将 &lt;terminal&gt; 设置为 <literal>gfxterm</literal>）。有效项为 <literal>auto</literal>、<literal><replaceable>HORIZONTAL</replaceable>x<replaceable>VERTICAL</replaceable></literal> 或 <literal><replaceable>HORIZONTAL</replaceable>x<replaceable>VERTICAL</replaceable>x<replaceable>COLOR DEPTH</replaceable></literal>。您可以在运行中系统的 GRUB 2 命令行上，使用 <command>vbeinfo</command> 命令来查看特定系统上的 GRUB 2 支持的屏幕分辨率。
         </para>
<screen>&lt;gfxmode&gt;1280x1024x24&lt;/gfxmode&gt;</screen>
        </entry>
       </row>
       <row>
        <entry>
         <para>
          <literal>os_prober</literal>
         </para>
        </entry>
        <entry>
         <para>
          如果设置为 <literal>true</literal>，则在安装期间会自动搜索已安装的操作系统并为其生成引导项
         </para>
<screen>&lt;os_prober config:type="boolean"&gt;false&lt;/os_prober&gt;</screen>
        </entry>
       </row>
       <row>
        <entry>
         <para>
          <literal>cpu_mitigations</literal>
         </para>
        </entry>
        <entry>
         <para>
          允许选择 CPU 缓解措施内核引导命令行参数的默认设置（同时在安全性与性能之间取得平衡）。可能的值为：</para>
         <formalpara>
          <title><literal>auto</literal></title>
           <para>
   启用您的 CPU 型号所需的全部缓解措施，但不防范跨 CPU 线程的攻击。此设置可能会在一定程度上影响性能，具体视工作负载而定。
  </para>
         </formalpara>
         <formalpara>
          <title><literal>nosmt</literal></title>
           <para>
    提供整套可用的安全缓解措施。启用您的 CPU 型号所需的全部缓解措施。此外，它还会禁用同步多线程 (SMT)，以免受到跨多个 CPU 线程发起的边信道攻击。此设置可能会进一步影响性能，具体取决于工作负载。
    </para>
         </formalpara>
         <formalpara>
          <title><literal>off</literal></title>
           <para>
    禁用所有缓解措施。CPU 可能会遭到边信道攻击，具体取决于 CPU 型号。此设置不会对性能造成任何影响。
   </para>
         </formalpara>
         <formalpara>
          <title>
           <literal>manual</literal>
          </title>
          <para>
    不设置任何缓解措施级别。请使用内核命令行选项手动指定 CPU 缓解措施。
   </para>
         </formalpara>
<screen>&lt;cpu_mitigations&gt;auto&lt;/cpu_mitigations&gt;</screen>
         <para>
          如果未在 AutoYaST 中设置，可通过内核命令行更改相应设置。默认将使用安装媒体上 <filename>/control.xml</filename> 文件中的（特定于产品的）设置（如果未指定其他设置）。
         </para>
        </entry>
       </row>
       <row>
        <entry>
         <para>
          <literal>suse_btrfs</literal>
         </para>
        </entry>
        <entry>
         <para>
          已过时，不再使用。将自动启用从 Btrfs 快照引导。
         </para>
        </entry>
       </row>
       <row>
        <entry>
         <para>
          <literal>serial</literal>
         </para>
        </entry>
        <entry>
         <para>
          当 GRUB 2 终端模式设置为 <literal>serial</literal> 时要执行的命令。
         </para>
<screen>&lt;serial&gt;
  serial --speed=115200 --unit=0 --word=8 --parity=no --stop=1
&lt;/serials&gt;</screen>
        </entry>
       </row>
       <row>
        <entry>
         <para>

           <literal>secure_boot</literal>
         </para>
        </entry>
        <entry>
         <para>
          如果设置为 <literal>false</literal>，则禁用 UEFI 安全引导。仅适用于 <literal>grub2-efi</literal> 引导加载程序。
         </para>
<screen>&lt;secure_boot"&gt;false&lt;/secure_boot&gt;</screen>
        </entry>
       </row>
       <row>
        <entry>
         <para>
          <literal>terminal</literal>
         </para>
        </entry>
        <entry>
         <para>
          指定要使用的 GRUB 2 终端模式，有效项为 <literal>console</literal>、<literal>gfxterm</literal> 和 <literal>serial</literal>。如果设置为 <literal>serial</literal>，则还需要使用 &lt;serial&gt; 指定串行命令。
         </para>
<screen>&lt;terminal&gt;serial&lt;/terminal&gt;</screen>
        </entry>
       </row>
       <row>
        <entry>
         <para>
          <literal>timeout</literal>
         </para>
        </entry>
        <entry>
         <para>
          在自动引导默认引导项之前经过的超时（以秒为单位）。
         </para>
<screen>&lt;timeout config:type="integer"&gt;10&lt;/timeout&gt;</screen>
        </entry>
       </row>
       <row>
        <entry>
         <para>
          <literal>trusted_boot</literal>
         </para>
        </entry>
        <entry>
         <para>
          如果设置为 <literal>true</literal>，则使用可信 GRUB。可信 GRUB 支持可信平台模块 (TPM)。仅适用于 <literal>grub2</literal> 引导加载程序。
         </para>
<screen>&lt;trusted_boot"&gt;true&lt;/trusted_boot&gt;</screen>
        </entry>
       </row>
       <row>
        <entry>
         <para>
          <literal>vgamode</literal>
         </para>
        </entry>
        <entry>
         <para>
          将内核参数 <literal>vga=<replaceable>VALUE</replaceable></literal> 添加到引导项。
         </para>
<screen>&lt;vgamode&gt;0x317&lt;/vgamode&gt;</screen>
        </entry>
       </row>
       <row>
        <entry>
         <para>
          <literal>xen_append</literal>
         </para>
        </entry>
        <entry>
         <para>
          在 Xen Guest 的引导项末尾添加的内核参数。
         </para>
<screen>&lt;xen_append&gt;nomodeset vga=0x317&lt;/xen_append&gt;</screen>
        </entry>
       </row>
       <row>
        <entry>
         <para>
          <literal>xen_kernel_append</literal>
         </para>
        </entry>
        <entry>
         <para>
          在 VM 主机服务器上的 Xen 内核的引导项末尾添加的内核参数。
         </para>
<screen>&lt;xen_kernel_append&gt;dom0_mem=768M&lt;/xen_kernel_append&gt;</screen>
        </entry>
       </row>
      </tbody>
     </tgroup>
    </informaltable>
   </sect2>

   <sect2 xml:id="CreateProfile-Bootloader-dev-map">
    <title>设备映射</title>
    <para>
     GRUB 2 在生成其配置文件时，会使用设备 ID 字符串 (UUID) 或文件系统标签来避免 BIOS 驱动器与 Linux 设备之间出现映射问题。GRUB 2 实用程序会即时创建一个临时设备映射，这通常足以满足需要，在单磁盘系统上尤其如此。但是，如果您需要覆盖自动设备映射机制，请在此部分创建自定义映射。
    </para>
<screen>&lt;device_map config:type="list"&gt;
  &lt;device_map_entry&gt;
    &lt;firmware&gt;hd0&lt;/firmware&gt; &lt;!-- order of devices in target map  --&gt;
    &lt;linux&gt;/dev/disk/by-id/ata-ST3500418AS_6VM23FX0&lt;/linux&gt; &lt;!-- name of device (disk)  --&gt;
  &lt;/device_map_entry&gt;
&lt;/device_map&gt;</screen>
   </sect2>
  </sect1>
