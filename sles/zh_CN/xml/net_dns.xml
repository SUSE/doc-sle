<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="net_dns.xml" version="5.0" xml:id="cha.dns">




 <title>域名系统</title>
 <info>
      <abstract>
        <para>
    需要使用 DNS（域名系统）将域名和主机名解析成 IP 地址。这样，便可以将 IP 地址指派给主机名，例如，将 192.168.2.100 指派给 <literal>jupiter</literal>。在设置您自己的名称服务器前，请阅读<xref linkend="sec.basicnet.nameres"/>中有关 DNS 的一般信息。下列配置示例中使用了默认的 DNS 服务器 - BIND。
   </para>
      </abstract>
      <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
        <dm:bugtracker>
          </dm:bugtracker>
        <dm:translation>yes</dm:translation>
      </dm:docmanager>
    </info>
    <indexterm> <primary>域名系统</primary><see>DNS</see></indexterm><indexterm><primary>DNS</primary><secondary>配置</secondary></indexterm><indexterm><primary>配置</primary><secondary>DNS</secondary></indexterm><indexterm><primary>名称服务器</primary><see>DNS</see></indexterm>
 <sect1 xml:id="sec.dns.basic">
  <title>DNS 术语</title><indexterm> <primary>DNS</primary><secondary>术语</secondary> </indexterm>

  <variablelist>
   <varlistentry>
    <term>区域</term>
    <listitem>
     <para>
      域名称空间由一些区域 (zone) 组成。例如，如果您拥有 <literal>example.com</literal>，您就拥有 <literal>com</literal> 域的 <literal>example</literal> 段（或区域）。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>DNS 服务器</term>
    <listitem>
     <para>
      DNS 服务器是维护域的名称和 IP 信息的服务器。主 DNS 服务器可用于主要区域、次要服务器可用于从属区域，不含有任何区域的从属服务器可用于缓存。
     </para>
     <variablelist>
      <varlistentry>
       <term>主区域 DNS 服务器</term>
       <listitem>
        <para>
         主区域包含网络中的所有主机，DNS 服务器主区域储存域中所有主机的最新记录。
        </para>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term>从属区域 DNS 服务器</term>
       <listitem>
        <para>
         从属区域是主区域的副本。从属区域 DNS 服务器将使用区域传送操作从其主服务器获取区域数据。只要从属区域 DNS 服务器具有有效（没到期）的区域数据，便会对区域作出权威响应。如果从属服务器不能获取区域数据的新副本，它将停止响应区域。
        </para>
       </listitem>
      </varlistentry>
     </variablelist>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>转发器</term>
    <listitem>
     <para>
      转发器是您的 DNS 服务器应将无法应答的查询发送到的 DNS 服务器。使用 <literal>netconfig</literal>，以便在一个配置中启用不同配置源（另请参见 <command>man 8 netconfig</command>）。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>记录</term>
    <listitem>
     <para>
      记录就是有关名称和 IP 地址的信息。有关支持的记录及其语法的描述可在 BIND 文档中获取。以下是一些特殊记录：
     </para>
     <variablelist>
      <varlistentry>
       <term>NS 记录</term>
       <listitem>
        <para>
         NS 记录会告诉命名服务器哪些计算机负责给定域区域。
        </para>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term>MX 记录</term>
       <listitem>
        <para>
         MX（邮件交换）记录描述在因特网中定向邮件时要联系的计算机。
        </para>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term>SOA 记录</term>
       <listitem>
        <para>
         SOA（起始授权机构）记录是区域文件中的第一条记录。当使用 DNS 在多台计算机之间同步数据时，使用 SOA 记录。
        </para>
       </listitem>
      </varlistentry>
     </variablelist>
    </listitem>
   </varlistentry>
  </variablelist>
 </sect1>

 <sect1 xml:id="sec.dns.install">
  <title>安装</title>

  <para>
   要安装 DNS 服务器，请启动 YaST 并选择<menuchoice><guimenu>软件</guimenu> <guimenu>软件管理</guimenu></menuchoice>。选择<menuchoice><guimenu>视图</guimenu> <guimenu>模式</guimenu></menuchoice>，然后选择 <guimenu>DHCP 和 DNS 服务器</guimenu>。确认安装相关的包来完成安装进程。
  </para>
 </sect1>

 <sect1 xml:id="sec.dns.yast">
  <title>使用 YaST 进行配置</title>

  <para>
   使用 YaST DNS 模块为本地网络配置 DNS 服务器。第一次启动此模块时，会启动向导，提示您做出一些有关服务器管理的决定。完成此初始设置后，将产生基本服务器配置。使用专家模式可处理更高级的配置任务，例如设置 ACL、日志记录、TSIG 密钥和其他选项。
  </para>

  <sect2 xml:id="sec.dns.yast.wizard">
   <title>向导配置</title>


   <para>
    向导由三个步骤或对话框组成。您可以从对话框的适当位置进入专家配置模式。
   </para>
   <procedure>
    <step>
     <para>



      第一次启动模块时，您将看到<xref linkend="fig.yast2.dnsinst.forwarders"/>中显示的<guimenu>转发器设置</guimenu>对话框将打开。<guimenu>本地 DNS 解析策略</guimenu>允许设置以下选项：
     </para>
     <itemizedlist mark="bullet" spacing="normal">
      <listitem>
       <para>
        <guimenu>已禁用合并转发器</guimenu>

       </para>
      </listitem>
      <listitem>
       <para>
        <guimenu>自动合并</guimenu>

       </para>
      </listitem>
      <listitem>


       <para>
        <guimenu>已启用合并转发器</guimenu>

       </para>
      </listitem>
      <listitem>
       <para>

        <guimenu>自定义配置</guimenu> — 如果已选择<guimenu>自定义配置</guimenu>，则可以指定<guimenu>自定义策略</guimenu>；默认情况下，在已选择<guimenu>自动合并</guimenu>的情况下，<guimenu>自定义策略</guimenu>将设置为<literal>自动</literal>，但是，您可以在此处设置接口名称，或者从 <literal>STATIC</literal> 与 <literal>STATIC_FALLBACK</literal> 这两个特殊策略名称中做出选择。
       </para>
      </listitem>
     </itemizedlist>

     <para>
      在<guimenu>本地 DNS 解析转发器</guimenu>中，指定要使用的服务：<guimenu>使用系统名称服务器</guimenu>、<guimenu>此名称服务器 (bind)</guimenu>或<guimenu>本地 dnsmasq 服务器</guimenu>。
     </para>
     <para>
      有关有关所有这些设置的更多信息，请参见 <command>man 8 netconfig</command>。
     </para>
     <figure xml:id="fig.yast2.dnsinst.forwarders">
      <title>DNS 服务器安装：转发器设置</title>
      <mediaobject>
       <imageobject role="fo">
        <imagedata width="75%" fileref="yast2_dns_wiz_forw.png" format="PNG"/>
       </imageobject>
       <imageobject role="html">
        <imagedata width="75%" fileref="yast2_dns_wiz_forw.png" format="PNG"/>
       </imageobject>
      </mediaobject>
     </figure>
     <para>
      转发器是接收您的 DNS 服务器自己无法应答的查询的 DNS 服务器。输入它们的 IP 地址，然后单击<guimenu>添加</guimenu>。
     </para>
    </step>
    <step>
     <para>
      <guimenu>DNS 区域</guimenu>对话框由多个部分组成，负责管理区域文件（如<xref linkend="sec.dns.zonefile"/>中所述）。对于新区域，请在<guimenu>名称</guimenu>中为其提供一个名称。要添加反向区域，名称必须以 <literal>.in-addr.arpa</literal> 结尾。最后选择<guimenu>类型</guimenu>（主、从属或转发）。参见<xref linkend="fig.yast2.dnsinst.zones"/>。单击<guimenu>编辑</guimenu>可配置现有区域的其他设置。要删除区域，请单击<guimenu>删除</guimenu>。
     </para>
     <figure xml:id="fig.yast2.dnsinst.zones">
      <title>DNS 服务器安装：DNS 区域</title>
      <mediaobject>
       <imageobject role="fo">
        <imagedata width="72%" fileref="yast2_dns_wiz_zone.png" format="PNG"/>
       </imageobject>
       <imageobject role="html">
        <imagedata width="75%" fileref="yast2_dns_wiz_zone.png" format="PNG"/>
       </imageobject>
      </mediaobject>
     </figure>
    </step>
    <step>
     <para>
      在最后对话框中，您可以通过单击<guimenu>打开防火墙中的端口</guimenu>打开防火墙中的 DNS 端口。然后决定是否在引导时启动 DNS 服务器（<guimenu>开启</guimenu>或<guimenu>关闭</guimenu>）。您还可以激活 LDAP 支持。请参见<xref linkend="fig.yast2.dnsinst.finish"/>。
     </para>
     <figure xml:id="fig.yast2.dnsinst.finish">
      <title>DNS 服务器安装：完成向导</title>
      <mediaobject>
       <imageobject role="fo">
        <imagedata width="72%" fileref="yast2_dns_wiz_finish.png" format="PNG"/>
       </imageobject>
       <imageobject role="html">
        <imagedata width="75%" fileref="yast2_dns_wiz_finish.png" format="PNG"/>
       </imageobject>
      </mediaobject>
     </figure>
    </step>
   </procedure>
  </sect2>

  <sect2 xml:id="sec.dns.yast.expert">
   <title>专家配置</title>
   <para>
    启动此模块后，YaST 将打开一个窗口，其中显示了多个配置选项。完成此窗口会生成具有基本功能的 DNS 服务器配置：
   </para>
   <sect3 xml:id="sec.dns.yast.expert.startup">
    <title>币笆</title>
    <para>
     在<guimenu>启动</guimenu>下，定义是要在引导系统时启动 DNS 服务器，还是手动启动 DNS 服务器。要立即启动 DNS 服务器，请单击<guimenu>立即启动 DNS 服务器</guimenu>。要停止 DNS 服务器，请单击<guimenu>立即停止 DNS 服务器</guimenu>。要保存当前设置，请选择<guimenu>保存设置并立即重新装载 DNS 服务器</guimenu>。您可以用<guimenu>打开防火墙中的端口</guimenu>打开防火墙中的 DNS 端口，并用<guimenu>防火墙细节</guimenu>修改防火墙设置。
    </para>
    <para>
     通过选择 <guimenu>LDAP 支持处于活动状态</guimenu>，让 LDAP 数据库管理区域文件。重启动 DNS 服务器或提示重装载其配置时，DNS 服务器将立刻挑选出写入到 LDAP 数据库的任何区域数据更改。
    </para>
   </sect3>
   <sect3 xml:id="sec.dns.yast.expert.forwarders">
    <title>转发器</title>
    <para>
     如果您的本地 DNS 服务器无法应答请求，则会尝试将请求转发给<guimenu>转发器</guimenu>（如果进行了这样的配置）。转发器可手动添加到<guimenu>转发器列表</guimenu>。如果在拨号连接中转发器不是静态的，则 <guimenu>netconfig</guimenu> 会处理配置。有关 netconfig 的更多信息，请参见 <command>man 8 netconfig</command>。
    </para>
   </sect3>
   <sect3 xml:id="sec.dns.yast.expert.basics">
    <title>基本选项</title>
    <para>
     在这一部分，设置基本的服务器选项。从<guimenu>选项</guimenu>菜单中选择所需的项，然后在相应文本框中指定值。选择<guimenu>添加</guimenu>包括新的条目。
    </para>

   </sect3>
   <sect3 xml:id="sec.dns.yast.expert.logging">
    <title>日志记录</title>
    <para>
     要设置 DNS 服务器应该记录的内容和记录方法，请选择<guimenu>日志记录</guimenu>。在<guimenu>日志类型</guimenu>下，指定 DNS 服务器将日志数据写入的位置。选择<guimenu>系统日志</guimenu>以使用系统范围的日志，或选择<guimenu>文件</guimenu>以指定另一个文件。对于后者，请额外指定名称、最大文件大小（以兆字节为单位）以及要储存的日志文件版本数。
    </para>
    <para>
     在<guimenu>附加日志记录</guimenu>下可以使用其他一些选项。启用<guimenu>记录所有的 DNS 查询</guimenu>将记录<emphasis>每个</emphasis>查询，在这种情况下，日志文件可能会变得非常大。出于这个原因，如果不是为了调试，则最好不要启用此选项。要记录区域更新期间 DHCP 和 DNS 服务器之间的通讯数据，请启用<guimenu>记录区域更新</guimenu>。要记录将区域从主服务器传送到从属服务器期间的数据流量，请启用<guimenu>记录区域传送</guimenu>。请参见<xref linkend="fig.yast2.dns.logging"/>。
    </para>
    <figure xml:id="fig.yast2.dns.logging">
     <title>DNS 服务器：日志记录</title>
     <mediaobject>
      <imageobject role="fo">
       <imagedata width="75%" fileref="yast2_dns_def_logging.png" format="PNG"/>
      </imageobject>
      <imageobject role="html">
       <imagedata width="75%" fileref="yast2_dns_def_logging.png" format="PNG"/>
      </imageobject>
     </mediaobject>
    </figure>
   </sect3>
   <sect3 xml:id="sec.dns.yast.expert.acls">
    <title>ACL</title>
    <para>
     使用此对话框定义 ACL（访问控制列表）来强制执行访问限制。在<guimenu>名称</guimenu>下提供不同的名称后，在<guimenu>值</guimenu>下指定具有下列形式的 IP 地址（带有或不带有网络掩码）：
    </para>
<screen>{ 192.168.1/24; }</screen>
    <para>
     配置文件的语法要求地址以分号结尾且放在花括号中。
    </para>

   </sect3>
   <sect3 xml:id="sec.dns.yast.expert.tsig">
    <title>TSIG 密钥</title>
    <para>
     TSIG（事务签名）的主要用途是保护 DHCP 和 DNS 服务器间通讯的安全性。这些内容在<xref linkend="sec.dns.tsig"/>中有所介绍。
    </para>
    <para>
     要生成 TSIG 密钥，请在标为<guimenu>密钥 ID</guimenu> 的字段中输入一个唯一名称，并指定储存密钥的文件（<guimenu>文件名</guimenu>）。用<guimenu>生成</guimenu>确认选择。
    </para>
    <para>
     要使用以前创建的密钥，请将<guimenu>密钥 ID</guimenu> 字段保留为空，并在<guimenu>文件名</guimenu>下选择储存这个密钥 ID 的文件。选择后，请用<guimenu>添加</guimenu>按钮进行确认。
    </para>

   </sect3>
   <sect3 xml:id="sec.dns.yast.expert.add_slave">
    <title>DNS 区域（添加从属区域）</title>
    <para>
     要添加从属区域，请选择 <guimenu>DNS 区域</guimenu>，然后选择区域类型<guimenu>从属</guimenu>，写入新区域名称并单击<guimenu>添加</guimenu>。
    </para>
    <para>
     在<guimenu>主 DNS 服务器 IP</guimenu> 下的<guimenu>区域编辑器</guimenu>子对话框中，指定从属服务器将从中获取数据的主服务器。要限制对此服务器的访问，可从列表中选择一个 ACL。

    </para>

   </sect3>
   <sect3 xml:id="sec.dns.yast.expert.add_master">
    <title>DNS 区域（添加主区域）</title>
    <para>
     要添加主区域，请选择 <guimenu>DNS 区域</guimenu>，然后选择区域类型<guimenu>主</guimenu>，写入新区域名称并单击<guimenu>添加</guimenu>。当添加主区域时，也需要一个反向区域。例如，当添加区域 <systemitem>example.com</systemitem>（指向子集 <literal>192.168.1.0/24</literal> 中的主机）时，也应为包含的 IP 地址范围添加一个反时向区域。按照定义，应命名为 <literal>1.168.192.in-addr.arpa</literal>。
    </para>
   </sect3>
   <sect3 xml:id="sec.dns.yast.expert.edit_master">
    <title>DNS 区域（编辑主区域）</title>
    <para>
     要编辑主区域，请选择 <guimenu>DNS 区域</guimenu>，从表中选择主区域，最后单击<guimenu>编辑</guimenu>。该对话框包含几个页面：<guimenu>基本</guimenu>（第一个打开的页面）、<guimenu>NS 记录</guimenu>、<guimenu>MX 记录</guimenu>、<guimenu>SOA</guimenu> 和<guimenu>记录</guimenu>。
    </para>
    <para os="sles">
     <xref linkend="fig.yast2.dns.ddns"/>中显示的基本对话框用于定义动态 DNS 的设置以及指向客户端和从属名称服务器的区域传送的访问选项。要允许动态更新区域，请选择<guimenu>允许动态更新</guimenu>及相应的 TSIG 密钥。必须在更新操作开始前定义密钥。要启用区域传送，请选择相应的 ACL。必须已经定义了 ACL。
    </para>
    <para>
     在<guimenu>基本</guimenu>对话框中，选择是否启用区域传输。使用所列 ACL 来定义谁能够下载区域。
    </para>
    <figure xml:id="fig.yast2.dns.ddns" os="sles">
     <title>DNS 服务器：区域编辑器（基本）</title>
     <mediaobject>
      <imageobject role="fo">
       <imagedata width="65%" fileref="yast2_dns_def_ddns.png" format="PNG"/>
      </imageobject>
      <imageobject role="html">
       <imagedata width="65%" fileref="yast2_dns_def_ddns.png" format="PNG"/>
      </imageobject>
     </mediaobject>
    </figure>
    <variablelist>
     <varlistentry>
      <term>区域编辑器（NS 记录）</term>
      <listitem>
       <para>
        <guimenu>NS 记录</guimenu>对话框用于为指定的区域定义备用名称服务器。确保已将自己的名称服务器包括在列表中。要添加记录，请在<guimenu>要添加的名称服务器</guimenu>下输入其名称，然后用<guimenu>添加</guimenu>按钮确认。请参见<xref linkend="fig.yast2.dns.nsrec"/>。
       </para>
       <figure xml:id="fig.yast2.dns.nsrec">
        <title>DNS 服务器：区域编辑器（NS 记录）</title>
        <mediaobject>
         <imageobject role="fo">
          <imagedata width="65%" fileref="yast2_dns_def_nsrec.png" format="PNG"/>
         </imageobject>
         <imageobject role="html">
          <imagedata width="65%" fileref="yast2_dns_def_nsrec.png" format="PNG"/>
         </imageobject>
        </mediaobject>
       </figure>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>区域编辑器（MX 记录）</term>
      <listitem>
       <para>
        要将当前区域的邮件服务器添加到现有的列表中，请输入相应的地址和优先级值。执行完此操作后，请选择<guimenu>添加</guimenu>进行确认。请参见<xref linkend="fig.yast2.dns.mxrec"/>。
       </para>
       <figure xml:id="fig.yast2.dns.mxrec">
        <title>DNS 服务器：区域编辑器（MX 记录）</title>
        <mediaobject>
         <imageobject role="fo">
          <imagedata width="72%" fileref="yast2_dns_def_mxrec.png" format="PNG"/>
         </imageobject>
         <imageobject role="html">
          <imagedata width="75%" fileref="yast2_dns_def_mxrec.png" format="PNG"/>
         </imageobject>
        </mediaobject>
       </figure>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>区域编辑器 (SOA)</term>
      <listitem>
       <para>
        此页用于创建 SOA（起始授权机构）记录。有关各选项的描述，请参见<xref linkend="ex.welt.zone"/>。<phrase os="sles">通过 LDAP 管理的动态区域不支持更改 SOA 记录。</phrase>
       </para>
       <figure xml:id="fig.yast2.dns.soa">
        <title>DNS 服务器：区域编辑器 (SOA)</title>
        <mediaobject>
         <imageobject role="fo">
          <imagedata width="75%" fileref="yast2_dns_def_soa.png" format="PNG"/>
         </imageobject>
         <imageobject role="html">
          <imagedata width="75%" fileref="yast2_dns_def_soa.png" format="PNG"/>
         </imageobject>
        </mediaobject>
       </figure>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>区域编辑器（记录）</term>
      <listitem>
       <para>
        此对话框用于管理名称解析。在<guimenu>记录密钥</guimenu>中，输入主机名并选择其类型。<guimenu>A</guimenu> 类型表示主项。此项的值应为一个 IP 地址 (IPv4)。对于 IPv6 地址，请使用 <guimenu>AAAA</guimenu>。<guimenu>CNAME</guimenu> 是别名。对于要根据 <guimenu>NS 记录</guimenu>和 <guimenu>MX 记录</guimenu>选项卡中提供的信息而扩展的详细或部分记录，应使用类型 <guimenu>NS</guimenu> 和 <guimenu>MX</guimenu>。这三种类型解析为现有的 <literal>A</literal> 记录。<guimenu>PTR</guimenu> 用于反向区域。它与 <literal>A</literal> 记录相反，例如：
       </para>
<screen>hostname.example.com. IN A 192.168.0.1
1.0.168.192.in-addr.arpa IN PTR hostname.example.com.</screen>
      </listitem>
     </varlistentry>
    </variablelist>
    <sect4 xml:id="sec.dns.yast.expert.edit_master.rev">
     <title>添加反向区域</title>
     <para>
      要添加反向区域，请遵循以下过程：
     </para>
     <procedure>
      <step>
       <para>
        启动 <menuchoice><guimenu>YaST</guimenu><guimenu>DNS 服务器</guimenu><guimenu>DNS 区域</guimenu></menuchoice>。
       </para>
      </step>
      <step>
       <para>
        如果您尚未添加主正向区域，请添加并<guimenu>编辑</guimenu>它。
       </para>
      </step>
      <step>
       <para>
        在<guimenu>记录</guimenu>选项卡中，填写相应的<guimenu>记录键</guimenu>和<guimenu>值</guimenu>，然后单击<guimenu>添加</guimenu>来添加记录，并单击<guimenu>确定</guimenu>来确认。如果 YaST 告知不存在某个名称服务器的记录，请在 <guimenu>DNS 记录</guimenu>选项卡中添加该记录。
       </para>
       <figure>
        <title>为主区域添加记录</title>
        <mediaobject>
         <imageobject role="fo">
          <imagedata fileref="yast2_dns_revzone1.png" width="70%" format="PNG"/>
         </imageobject>
         <imageobject role="html">
          <imagedata fileref="yast2_dns_revzone1.png" width="70%" format="PNG"/>
         </imageobject>
        </mediaobject>
       </figure>
      </step>
      <step>
       <para>
        返回 <guimenu>DNS 区域</guimenu>窗口，添加一个主反向区域。
       </para>
       <figure>
        <title>添加反向区域</title>
        <mediaobject>
         <imageobject role="fo">
          <imagedata fileref="yast2_dns_revzone2.png" width="70%" format="PNG"/>
         </imageobject>
         <imageobject role="html">
          <imagedata fileref="yast2_dns_revzone2.png" width="70%" format="PNG"/>
         </imageobject>
        </mediaobject>
       </figure>
      </step>
      <step>
       <para>
        <guimenu>编辑</guimenu>该反向区域，然后在<guimenu>记录</guimenu>选项卡中，您可以看到 <guimenu>PTR：反向转换</guimenu>记录类型。添加相应的<guimenu>记录键</guimenu>和<guimenu>值</guimenu>，然后单击<guimenu>添加</guimenu>并单击<guimenu>确定</guimenu>来确认。
       </para>
       <figure>
        <title>添加反向记录</title>
        <mediaobject>
         <imageobject role="fo">
          <imagedata fileref="yast2_dns_revzone3.png" width="70%" format="PNG"/>
         </imageobject>
         <imageobject role="html">
          <imagedata fileref="yast2_dns_revzone3.png" width="70%" format="PNG"/>
         </imageobject>
        </mediaobject>
       </figure>
       <para>
        根据需要添加名称服务器记录。
       </para>
      </step>
     </procedure>
    <tip>
     <title>编辑反向区域</title>
     <para>
      添加正向区域后，返回到主菜单并选择该反向区域以进行编辑。在选项卡<guimenu>基础</guimenu>中激活复选框<guimenu>自动生成记录的区域</guimenu>，然后选择正向区域。这样，对正向区域的所有更改都会在反向区域中更新。
     </para>
    </tip>
    </sect4>
   </sect3>
  </sect2>
 </sect1>
 <sect1 xml:id="sec.dns.bind">
  <title>启动 BIND 名称服务器</title><indexterm xml:id="idx.DNS_BIND" class="startofrange"> <primary>DNS</primary><secondary>BIND</secondary></indexterm> <indexterm xml:id="idx.BIND" class="startofrange"><primary>BIND</primary></indexterm>

  <para>
   在 <phrase role="productname"><phrase os="sles">SUSE® Linux Enterprise Server</phrase></phrase> 系统上，已预先配置名称服务器 BIND（<emphasis>Berkeley 因特网名称域</emphasis>），因此可以在安装后立即启动此名称服务器而不会出现任何问题。如果您已有一个有效的因特网连接并在 <filename>/etc/resolv.conf</filename> 中输入了 <systemitem class="ipaddress">127.0.0.1</systemitem> 作为 <systemitem class="domainname">localhost</systemitem> 的名称服务器地址，那么您已经在使用名称解析功能了，而不需要知道提供商的 DNS。BIND 通过 root 名称服务器执行名称解析，这个过程非常慢。通常，应将提供商的 DNS 及其 IP 地址输入配置文件 <filename>/etc/named.conf</filename> 的 <systemitem>forwarders</systemitem> 下，以确保能进行有效而安全的名称解析。如果到目前为止是这种情况，则该名称服务器将作为<emphasis>仅用于缓存</emphasis>的纯名称服务器运行。只有在配置了该名称服务器自己的区域后，它才能成为正确的 DNS。在 <filename>/usr/share/doc/packages/bind/config</filename> 中可找到简单的示例。
  </para><indexterm> <primary>配置文件</primary><secondary>resolv.conf</secondary></indexterm><indexterm><primary>配置文件</primary><secondary>named.conf</secondary></indexterm>

  <tip>
   <title>名称服务器信息的自动适应</title>
   <para>
    根据因特网连接或网络连接的类型，名称服务器信息可以自动适应当前的情况。为此，请将 <filename>/etc/sysconfig/network/config</filename> 文件中的 <systemitem>NETCONFIG_DNS_POLICY</systemitem> 变量设置为 <literal>auto</literal>。
   </para>
  </tip>

  <para>
   但是不要设置正式域，而是让负责机构指派给您。即使您有自己的域且提供商管理此域，也最好不要使用此域，因为如果使用此域，BIND 将不转发对此域的请求。例如，此域不能访问提供商的 Web 服务器。
  </para>

  <para>
   要启动名称服务器，请以 <systemitem class="username">root</systemitem> 身份输入命令 <command>systemctl start named</command>。使用 <command>systemctl status named</command> 检查 named（当调用名称服务器进程时）是否已成功启动。请用 <command>host</command> 或 <command>dig</command> 程序立即在本地系统上测试名称服务器，该测试应返回 <systemitem class="domainname">localhost</systemitem> 作为默认服务器，地址为 <systemitem class="ipaddress">127.0.0.1</systemitem>。如果未返回所需的结果，则 <filename>/etc/resolv.conf</filename> 可能包含不正确的名称服务器项或此文件根本不存在。如果是第一次测试，请输入 <command>host</command> <option>127.0.0.1</option>，此命令应始终有效。如果收到错误讯息，请使用 <command>systemctl status named</command> 查看服务器是否确实在运行。如果该名称服务器未启动或者出现意外的行为，请检查 <command>journalctl -e</command> 的输出。
  </para>

<indexterm> <primary>日志文件</primary><secondary>消息</secondary></indexterm><indexterm><primary>DNS</primary><secondary>启动</secondary> </indexterm><indexterm><primary>DNS</primary><secondary>查错</secondary></indexterm>

  <para>
   要将提供商的名称服务器（或网络上正在运行的名称服务器）用作转发器，请在 <systemitem>options</systemitem> 部分的 <systemitem>forwarders</systemitem> 下输入相应的一个或多个 IP 地址。<xref linkend="ex.forward"/>中包含的地址仅用作示例。请根据您自己的设置调整这些项。<indexterm> <primary>DNS</primary><secondary>转发</secondary> </indexterm>
  </para>

  <example xml:id="ex.forward">
   <title>named.conf 中的转发选项</title>


<screen>options { 
        directory "/var/lib/named";
        forwarders { 10.11.12.13; 10.11.12.14; };
        listen-on { 127.0.0.1; 192.168.1.116; };
        allow-query { 127/8; 192.168/16 };
        notify no;
};</screen>
  </example>

  <para>
   <systemitem>options</systemitem> 项后跟区域的项 <systemitem class="domainname">localhost</systemitem> 和 <systemitem>0.0.127.in-addr.arpa</systemitem>。<quote>.</quote> 下的 <literal>type hint</literal> 项应始终存在。无需修改相应的文件，应照原样使用。还要确保每个项都以 <quote>;</quote> 结束，同时确保花括号位于正确的位置。更改配置文件 <filename>/etc/named.conf</filename> 或区域文件后，使用 <command>systemctl reload named</command> 来通知 BIND 重新读取这些文件。使用 <command>systemctl restart named</command> 停止然后重启动名称服务器也会获得相同的效果。您随时可以输入 <command>systemctl stop named</command> 来停止服务器。
  </para>
 </sect1>
 <sect1 xml:id="sec.dns.named">
  <title>/etc/named.conf 配置文件</title><indexterm xml:id="idx.configuration_files_named.conf" class="startofrange"> <primary>配置文件</primary><secondary>named.conf</secondary> </indexterm>

  <para>
   BIND 名称服务器本身的所有设置都储存在文件 <filename>/etc/named.conf</filename> 中。但是，将要处理的域的区域数据（由主机名、IP 地址等组成）储存在目录 <filename>/var/lib/named</filename> 下单独的文件中。稍后将介绍其详细信息。
  </para>

  <para>
   <filename>/etc/named.conf</filename> 大致分为两部分。一部分是存放常规设置的 <systemitem>options</systemitem> 部分，另一部分由各个域的 <systemitem>zone</systemitem> 项组成。而 <systemitem>logging</systemitem> 部分和 <systemitem>acl</systemitem>（访问控制列表）项是可选的。注释行以 <literal>#</literal> 符号或 <literal>//</literal> 开头。<xref linkend="ex.named.mini"/>显示了一个最小的 <filename>/etc/named.conf</filename>。
  </para>

  <example xml:id="ex.named.mini">
   <title>基本的 /etc/named.conf</title>
<screen>options { 
        directory "/var/lib/named"; 
        forwarders { 10.0.0.1; };
        notify no;
};

zone "localhost" in {
       type master;
       file "localhost.zone";
};

zone "0.0.127.in-addr.arpa" in {
        type master;
        file "127.0.0.zone";
};

zone "." in {
        type hint;
        file "root.hint";
};</screen>
  </example>

  <sect2 xml:id="sec.dns.named.options">
   <title>重要的配置选项</title><indexterm> <primary>DNS</primary><secondary>选项</secondary> </indexterm>
   <variablelist>
    <varlistentry>
     <term>directory "<replaceable>filename</replaceable>";</term>
     <listitem>
      <para>
       指定目录，BIND 可以在该目录中找到包含区域数据的文件。通常，此目录是 <filename>/var/lib/named</filename>。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>forwarders { <replaceable>ip-address</replaceable>; };</term>
     <listitem>
      <para>
       指定在无法直接解析 DNS 请求的情况下应将其转发到的名称服务器（大多数情况下是提供商的名称服务器）。用 IP 地址（例如 <replaceable>192.168.1.116</replaceable>）替换 <literal>ip-address</literal>。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>forward first;</term>
     <listitem>
      <para>
       在尝试通过 root 名称服务器解析 DNS 请求前，对 DNS 请求进行转发。可以写入 <systemitem>forward only</systemitem>（而不是 <systemitem>forward first</systemitem>）转发所有请求并且不将任何请求发送到 root 名称服务器。这可以用于防火墙配置。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>listen-on port 53 { 127.0.0.1; <replaceable>IP 地址</replaceable>; };</term>
     <listitem><indexterm> <primary>端口</primary> <secondary>53</secondary></indexterm>
      <para>
       指示 BIND 通过哪些网络接口和哪个端口来接受客户端查询。不需要显式指定 <literal>port 53</literal>，因为 <literal>53</literal> 是默认端口。输入 <literal>127.0.0.1</literal> 允许接收来自 Localhost 的请求。如果完全省略此项，则在默认情况下使用所有接口。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>listen-on-v6 port 53 {any; };</term>
     <listitem>
      <para>
       指示 BIND 应通过哪个端口侦听 IPv6 客户端请求。唯一可以替代 <literal>any</literal> 的是 <literal>none</literal>。就 IPv6 而言，服务器只接受通配符地址。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>query-source address * port 53;</term>
     <listitem>
      <para>
       如果防火墙阻止外发的 DNS 请求，则需要此项。此项指示 BIND 从端口 53 向外部发送请求，而不使用端口号大于 1024 的任何端口。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>query-source-v6 address * port 53;</term>
     <listitem>
      <para>
       指示 BIND 将哪个端口用于 IPv6 查询。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>allow-query { 127.0.0.1; <replaceable>net</replaceable>; };</term>
     <listitem>
      <para>
       定义客户端可以自此发送 DNS 请求的网络。用地址信息（例如 <replaceable>192.168.2.0/24</replaceable>）替换 <literal>net</literal>。末尾的 <systemitem>/24</systemitem> 是网络掩码的缩写表示（在本例中为 <systemitem class="netmask">255.255.255.0</systemitem>）。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>allow-transfer ! *;;</term>
     <listitem>
      <para>
       控制哪些主机可以请求区域传送。在本例中，用 <systemitem>! *</systemitem>. 如果没有此项，则可以从没有限制的任何位置请求区域传送。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>statistics-interval 0;</term>
     <listitem>
      <para>
       如果缺少此项，则 BIND 每小时都会在系统的日记中生成几行统计信息。将其设置为 0 可以完全禁止生成此类统计信息，也可以设置时间间隔（以分钟为单位）。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>cleaning-interval 720;</term>
     <listitem>
      <para>
       此选项定义 BIND 间隔多长时间清除其缓存。每次清除时都会在系统的日记中触发一项。时间是以分钟为单位指定的。默认值为 60 分钟。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>interface-interval 0;</term>
     <listitem>
      <para>
       BIND 定期在网络接口中搜索新接口或不存在的接口。如果将该值设置为 <systemitem>0</systemitem>，则不执行搜索，BIND 只侦听启动时检测到的接口。否则，采用分钟定义时间间隔。默认值是 60 分钟。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>notify no;</term>
     <listitem>
      <para>
       指定 <option>no</option> 将阻止其他名称服务器在区域数据被更改或名称服务器被重启动时得到通知。
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
   <para>
    有关可用选项的列表，请阅读手册页 <command>man 5 named.conf</command>。
   </para>
  </sect2>

  <sect2 xml:id="sec.dns.named.log">
   <title>日志记录</title><indexterm> <primary>DNS</primary><secondary>日志记录</secondary> </indexterm>
   <para>
    可以在 BIND 中详细配置日志记录的内容、方式和位置。通常，默认设置就已足够。<xref linkend="ex.no.log"/>显示了此项最简单的形式，并完全抑制任何日志记录。
   </para>
   <example xml:id="ex.no.log">
    <title>禁用日志记录的项</title>
<screen>logging {
        category default { null; };
};</screen>
   </example>
  </sect2>

  <sect2 xml:id="sec.dns.named.zones">
   <title>区域项</title>
   <example xml:id="ex.meine.domain">
    <title>example.com 的区域项</title>
<screen>zone "example.com" in {
      type master;
      file "example.com.zone";
      notify no;
};</screen>
   </example>
   <para>
    在 <systemitem>zone</systemitem> 后，指定要管理的域的名称 (<systemitem class="domainname">example.com</systemitem>)，后跟 <systemitem>in</systemitem> 和用花括号括起来的相关选项块，如<xref linkend="ex.meine.domain"/>所示。要定义<emphasis>从属区域</emphasis>，请将 <systemitem>type</systemitem> 切换为 <literal>slave</literal> 并将管理此区域的名称服务器指定为 <literal>master</literal>（它可能是另一个主区域的从属区域），如 <xref linkend="ex.andere.domain"/> 所示。
   </para>
   <example xml:id="ex.andere.domain">
    <title>example.net 的区域项</title>
<screen>zone "example.net" in {
      type slave;
      file "slave/example.net.zone";
      masters { 10.0.0.1; }; 
};</screen>
   </example>
   <para>
    区域选项：
   </para>
   <variablelist>
    <varlistentry>
     <term>type master;</term>
     <listitem>
      <para>
       通过指定 <literal>master</literal>，指示 BIND 由本地名称服务器对区域进行处理。这假定已用正确的格式创建了区域文件。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>type slave;</term>
     <listitem>
      <para>
       从另一个名称服务器传送此区域。必须将它与 <systemitem>masters</systemitem> 一起使用。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>type hint;</term>
     <listitem>
      <para>
       区域 <literal>.</literal>（<literal>hint</literal> 类型）用于设置 root 名称服务器。此区域定义可以保留原样。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>文件 <filename>example.com.zone</filename> 或文件 <quote>slave/example.net.zone</quote>；</term>
     <listitem>
      <para>
       此项指定域的区域数据所在的文件。从属区域不需要此文件，因为此数据是从另一个名称服务器中获取的。要区分主文件和从属文件，请对从属文件使用目录 <filename>slave</filename>。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>masters { <replaceable>server-ip-address</replaceable>; };</term>
     <listitem>
      <para>
       只有从属区域需要此项。它指定应从哪个名称服务器传送区域文件。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>allow-update {! *; };</term>
     <listitem>
      <para>
       此选项控制外部写访问，这将允许客户端创建 DNS 项（出于安全原因，通常不希望出现这种情况）。没有此项，就不允许进行区域更新。上述项可以实现相同的结果，因为 <literal>! *</literal> 有效地禁止了此类操作。
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
  </sect2>
 </sect1>
 <sect1 xml:id="sec.dns.zonefile">
  <title>区域文件</title><indexterm> <primary>DNS</primary><secondary>区域</secondary><tertiary>文件</tertiary> </indexterm>

  <para>
   所需的区域文件有两种类型。一种类型将 IP 地址指派给主机名，另一种类型则正好相反：为 IP 地址提供主机名。
  </para>

  <tip>
   <title>在区域文件中使用点（句点）</title>
   <para>
    此 <literal>"."</literal> 在区域文件中有重要的含义。如果指定的主机名末尾没有点 (<literal>.</literal>)，则会追加区域。使用完整域名指定的完整主机名必须以点 (<literal>.</literal>) 结尾，这是为了避免再次向它添加域。“.”丢失或放错位置可能是名称服务器配置出错最常见的原因。
   </para>
  </tip>



  <para>
   第一个要考虑的情况是负责域 <filename>example.com</filename> 的区域文件 <filename>example.com.zone</filename>，如<xref linkend="ex.welt.zone"/>中所示。
  </para>



  <example xml:id="ex.welt.zone">
   <title>/var/lib/named/example.com.zone 文件</title>
<screen linenumbering="numbered">1.  $TTL 2D 
2.  example.com. IN SOA      dns  root.example.com. ( 
3.               2003072441  ; serial
4.               1D          ; refresh
5.               2H          ; retry
6.               1W          ; expiry
7.               2D )        ; minimum
8.  
9.               IN NS       dns 
10.              IN MX       10 mail
11. 
12. gate         IN A        192.168.5.1 
13.              IN A        10.0.0.1 
14. dns          IN A        192.168.1.116 
15. mail         IN A        192.168.3.108 
16. jupiter      IN A        192.168.2.100
17. venus        IN A        192.168.2.101
18. saturn       IN A        192.168.2.102
19. mercury      IN A        192.168.2.103
20. ntp          IN CNAME    dns 
21. dns6         IN A6  0    2002:c0a8:174::
</screen>

  </example>

  <variablelist>
   <varlistentry>
    <term>第 1 行：</term>
    <listitem>
     <para>
      <systemitem>$TTL</systemitem> 定义默认存活时间，它适用于此文件中的所有项。在本例中，项在两天 (<literal>2 D</literal>) 内有效。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>第 2 行：</term>
    <listitem>
     <para>
      这是 SOA（Start Of Authority，起始授权机构）控制记录开始的位置：
     </para>
     <itemizedlist mark="bullet" spacing="normal">
      <listitem>
       <para>
        最前面的 <literal>example.com</literal> 是要管理的域的名称。此域名以<literal>“.”</literal>结尾，否则可能会再次追加区域。或者，可以在这里输入 <literal>@</literal>，在这种情况下，可以从 <filename>/etc/named.conf</filename> 中的相应项中抽取区域。
       </para>
      </listitem>
      <listitem>
       <para>
        <systemitem>IN SOA</systemitem> 之后是用作此区域主服务器的名称服务器的名称。此名称会从 <literal>dns</literal> 扩展为 <literal>dns.example.com</literal>，因为它没有以<literal>“.”</literal>结尾。
       </para>
      </listitem>
      <listitem>
       <para>
        随后是负责此名称服务器的用户的电子邮件地址。因为 <literal>@</literal> 符号已经有特殊含义，所以在这里改为输入<literal>“.”</literal>。对于 <systemitem>root@example.com</systemitem>，该项必须读作 <systemitem>root.example.com.</systemitem>。此 <literal>"."</literal> 必须包含在末尾，以防止添加区域。
       </para>
      </listitem>
      <listitem>
       <para>
        <literal>(</literal> 和 <literal>)</literal> 之间包含的所有行组成 SOA 记录。
       </para>
      </listitem>
     </itemizedlist>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>第 3 行：</term>
    <listitem>
     <para>
      <systemitem>serial number</systemitem> 可以是任一数字，每次更改此文件时此数字都会增加。需要将这些更改通知给辅助名称服务器（从属服务器）。为此，日期和运行数字常采用 10 位数字格式，书写方式为 YYYYMMDDNN，这已成为惯用格式。
     </para>

    </listitem>
   </varlistentry>
   <varlistentry>
    <term>第 4 行：</term>
    <listitem>
     <para>
      <systemitem>refresh rate</systemitem> 指定二级名称服务器校验区域 <systemitem>serial number</systemitem> 的时间间隔。在本例中，此时间间隔为一天。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>第 5 行：</term>
    <listitem>
     <para>
      <systemitem>retry rate</systemitem> 指定二级名称服务器在出现错误时尝试再次联系主服务器的时间间隔。这里的时间间隔是两小时。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>第 6 行：</term>
    <listitem>
     <para>
      <systemitem>expiration time</systemitem> 指定二级名称服务器在无法重新联系上主服务器时将在多长时间后丢弃缓存的数据。在本例中为一周。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>第 7 行：</term>
    <listitem>
     <para>
      SOA 记录中的最后一项指定 <systemitem>negative caching TTL</systemitem>，这是超速缓存来自其它服务器的未解析 DNS 查询结果的时间。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>第 9 行：</term>
    <listitem>
     <para>
      <systemitem>IN NS</systemitem> 指定负责此域的名称服务器。<systemitem>dns</systemitem> 会扩展为 <systemitem>dns.example.com</systemitem>，因为它的没有以<literal>“.”</literal>. 可以有多个与此行类似的行，一行用于主名称服务器，其它每行分别用于每个辅助名称服务器。如果 <filename>/etc/named.conf</filename> 中未将 <systemitem>notify</systemitem> 设置为 <option>no</option>，则会将区域数据的更改通知给这里列出的所有名称服务器。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>第 10 行：</term>
    <listitem>
     <para>
      MX 记录指定接受、处理和转发域 <systemitem class="domainname">example.com</systemitem> 的电子邮件的邮件服务器。在本例中，该邮件服务器是主机 <systemitem class="domainname">mail.example.com</systemitem>。主机名称前面的数字是优先顺序值。如果有多个 MX 项，则首先采用具有最小值的邮件服务器，如果向此服务器递送邮件失败，则尝试采用具有稍大一些值的邮件服务器。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>第 12-19 行：</term>
    <listitem>
     <para>
      这些都是实际的地址记录，在这里将一个或多个 IP 礬u216 OO穃u214 O竆u197 AE竆u248 oO鱘u187 机Auu163名称在此处列出，不带 <literal>"."</literal>，因为它们不包含自身的域，因此会将 <systemitem class="domainname">example.com</systemitem> 添加到所有名称。因为主机 <systemitem>gate</systemitem> 有两个网卡，所以为其指派两个 IP 地址。只要主机地址是传统地址 (IPv4)，就将使用 <literal>A</literal> 标记该记录。如果地址是 IPv6 地址，则使用 <literal>AAAA</literal> 标记此项。

     </para>


     <note>
      <title>IPv6 语法</title>
      <para>
       IPv6 记录与 IPv4 记录的语法稍有不同。由于可能进行碎片整理，所以需要在寻址前提供有关缺失位的信息。要使用所需的数字<quote>}0</quote>填写 IPv6 地址，请在地址中的正确位置添加两个冒号。

      </para>
<screen>pluto     AAAA 2345:00C1:CA11::1234:5678:9ABC:DEF0
pluto     AAAA 2345:00D2:DA11::1234:5678:9ABC:DEF0</screen>

     </note>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>第 20 行：</term>
    <listitem>
     <para>
      别名 <literal>ntp</literal> 可用于确定 <literal>dns</literal>（<systemitem>CNAME</systemitem> 是指<emphasis>规范名称</emphasis>）的地址。
     </para>
    </listitem>
   </varlistentry>
  </variablelist>



  <para>
   伪域 <literal>in-addr.arpa</literal> 用于 IP 地址到主机名的反向查找。它被追加到采用反向表示法的地址的网络部分。因此，将 <systemitem class="ipaddress">192.168</systemitem> 解析成 <systemitem>168.192.in-addr.arpa</systemitem>。参见 <xref linkend="dat.arpa"/>。<indexterm> <primary>DNS</primary><secondary>反向查找</secondary> </indexterm>
  </para>



  <example xml:id="dat.arpa">
   <title>反向查找</title>
<screen linenumbering="numbered">1.  $TTL 2D
2.  168.192.in-addr.arpa.   IN SOA dns.example.com. root.example.com. (
3.                          2003072441      ; serial
4.                          1D              ; refresh
5.                          2H              ; retry
6.                          1W              ; expiry
7.                          2D )            ; minimum
8.
9.                          IN NS           dns.example.com.
10. 
11. 1.5                     IN PTR          gate.example.com. 
12. 100.3                   IN PTR          www.example.com. 
13. 253.2                   IN PTR          cups.example.com. </screen>
  </example>

  <variablelist>
   <varlistentry>
    <term>第 1 行：</term>
    <listitem>
     <para>
      $TTL 定义应用于此处所有项的标准 TTL。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>第 2 行：</term>
    <listitem>
     <para>

      此配置文件应激活网络 <systemitem class="ipaddress">192.168</systemitem> 的反向查找。假设区域名为 <systemitem>168.192.in-addr.arpa</systemitem>，则不应将此区域添加到主机名。因此，采用完整形式输入所有主机名 — 带有它们的域并以<literal>“.”</literal> 结尾。其余的项对应于上一个 <systemitem>example.com</systemitem> 示例介绍的那些内容。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>第 3-7 行：</term>
    <listitem>
     <para>
      请参见上一个 <systemitem>example.com</systemitem> 的示例。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>第 9 行：</term>
    <listitem>
     <para>
      此行也是指定负责此区域的名称服务器。但这次采用完整形式输入名称，带有域且末尾带有<literal>“.”</literal>。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>第 11–13 行：</term>
    <listitem>
     <para>
      这些都是提示各自主机上 IP 地址的指针记录。只在行的开头输入 IP 地址的最后一部分，在末尾不加<literal>“.”</literal>。将区域追加到这个地址（不带 <systemitem>.in-addr.arpa</systemitem>）将产生采用反向顺序的完整 IP 地址。
     </para>
    </listitem>
   </varlistentry>
  </variablelist>

  <para>
   通常，可以在 BIND 的不同版本间传输区域，不会产生任何问题。<indexterm class="endofrange" startref="idx.DNS_BIND"/> <indexterm class="endofrange" startref="idx.BIND"/> <indexterm class="endofrange" startref="idx.configuration_files_named.conf"/>

  </para>
 </sect1>

 <sect1 xml:id="sec.dns.dynupdate">
  <title>区域数据的动态更新</title>

  <para>
   术语<emphasis>动态更新</emphasis>指添加、更改或删除主服务器区域文件中的项的操作。RFC 2136 对此机制进行了介绍。通过添加可选的 <systemitem>allow-update</systemitem> 或 <systemitem>update-policy</systemitem> 规则，可以为每个区域项单独配置动态更新。不应手动编辑要动态更新的区域。
  </para>

  <para>
   用命令 <command>nsupdate</command> 将要更新的项传送到服务器。有关此命令的精确语法，请查看关于 nsupdate 的手册页 (<command>man</command> <option>8 nsupdate</option>)。出于安全原因，应使用 <xref linkend="sec.dns.tsig"/> 中介绍的 TSIG 密钥执行此类更新。
  </para>
 </sect1>
 <sect1 xml:id="sec.dns.tsig">
  <title>安全事务</title>

  <para>
   借助于基于共享密钥（也称为 TSIG 密钥）的事务签名 (TSIG) 可以实现安全事务。本节介绍如何生成和使用此类密钥。
  </para>

  <para>
   不同服务器间的通信和区域数据的动态更新需要安全事务。依靠密钥进行访问控制比只靠 IP 地址进行访问控制要安全得多。
  </para>

  <para>
   使用下列命令生成 TSIG 密钥（有关细节，请参见 <command>man</command> <option>dnssec-keygen</option>）：
  </para>

<screen>dnssec-keygen -a hmac-md5 -b 128 -n HOST host1-host2</screen>

  <para>
   此命令创建两个文件，名称与下面的名称类似：
  </para>

<screen>Khost1-host2.+157+34265.private Khost1-host2.+157+34265.key</screen>

  <para>
   密钥本身（类似于 <literal>ejIkuCyyGJwwuN3xAteKgg==</literal> 的字符串）位于这两个文件中。要将密钥用于事务，必须将第二个文件 (<filename>Khost1-host2.+157+34265.key</filename>) 传送到远程主机，而且最好采用安全的方式（例如，使用 scp）传送。在远程服务器上，密钥必须包括在文件 <filename>/etc/named.conf</filename> 中以实现 <literal>host1</literal> 和 <literal>host2</literal> 之间的安全通信：
  </para>

<screen>key host1-host2 {
 algorithm hmac-md5;
 secret "ejIkuCyyGJwwuN3xAteKgg==";
};</screen>

  <warning>
   <title><filename>/etc/named.conf</filename> 的文件权限</title>
   <para>
    确保正确限制了 <filename>/etc/named.conf</filename> 的权限。此文件的默认值是 <literal>0640</literal>，拥有者为 <systemitem class="username">root</systemitem> 和组 <systemitem class="username">named</systemitem>。或者，可以将密钥移到具有特殊限制权限的另一个文件中，然后将该文件包括在 <filename>/etc/named.conf</filename> 中。要包括外部文件，请使用：
   </para>
<screen>include  "filename"</screen>
   <para>
    用带有密钥的文件的绝对路径替换 <option>filename</option>。
   </para>
  </warning>

  <para>





   要使服务器 <literal>host1</literal> 能使用 <literal>host2</literal>（在本例中，其地址为 <literal>10.1.2.3</literal>）的密钥，服务器的 <filename>/etc/named.conf</filename> 必须包含下列规则：
  </para>

<screen>server 10.1.2.3 {
  keys { host1-host2. ;};
};</screen>

  <para>
   必须将类似的项包括在 <literal>host2</literal> 的配置文件中。
  </para>

  <para>
   向为 IP 地址和地址范围定义的任何 ACL（访问控制列表，请不要与文件系统的 ACL 混淆）添加 TSIG 密钥可以实现事务安全性。相应的项如下所示：
  </para>

<screen>allow-update { key host1-host2. ;};</screen>

  <para>
   <emphasis>BIND 管理员参考手册</emphasis>的 <literal>update-policy</literal> 对此主题进行了详细介绍。
  </para>
 </sect1>
 <sect1 xml:id="sec.dns.dnssec">
  <title>DNS 安全性</title>

  <para>
   RFC 2535 中介绍了 DNSSEC（即 DNS 安全性）。BIND 手册讨论了可用于 DNSSEC 的工具。
  </para>

  <para>
   被认为是安全的区域必须有一个或多个与之关联的区域密钥。这些密钥是通过 <command>dnssec-keygen</command> 生成的，就像主机密钥一样。当前使用 DSA 加密算法来生成这些密钥。应使用 <systemitem>$INCLUDE</systemitem> 规则将所生成的公共密钥包括在相应的区域文件中。
  </para>

  <para>
   使用命令 <command>dnssec-signzone</command>，您可以创建生成的密钥集（<literal>keyset-</literal> 文件），将它们以安全方式传送到父区域并加以签名。这会生成要包含在 <filename>/etc/named.conf</filename> 中的针对每个区域的文件。
  </para>


 </sect1>
 <sect1 xml:id="sec.dns.info">
  <title>更多信息</title>

  <para>
   有关更多信息，请参见安装在 <filename>/usr/share/doc/packages/bind/arm</filename> 下的 <systemitem class="resource">bind-doc</systemitem> 包中的 <emphasis>BIND Administrator Reference Manual</emphasis>（BIND 管理员参考手册）。另外，请考虑参考该手册中所引用的 RFC 和 BIND 附带的手册页。<filename>/usr/share/doc/packages/bind/README.SUSE</filename> 包含有关 <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> 中 BIND 的最新信息。
  </para>
 </sect1>
</chapter>
