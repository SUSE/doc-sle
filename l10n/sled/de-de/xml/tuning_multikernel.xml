<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="tuning_multikernel.xml" version="5.0" xml:id="cha-tuning-multikernel">
 <title>Installieren von mehreren Kernel-Versionen</title>
 <info>
  <abstract>
   <para>
    <phrase role="productname"><phrase os="sled">SUSE Linux Enterprise Desktop</phrase></phrase> unterstützt die parallele Installation von mehreren Kernel-Versionen. Beim Installieren eines zweiten Kernels werden automatisch ein Boot-Eintrag und ein initrd erstellt; es sind also keine weiteren manuellen Konfigurationsschritte erforderlich. Beim Neustarten des Rechners wird der hinzugefügte Kernel als zusätzlicher Boot-Parameter angeboten.
   </para>

   <para>
    Mithilfe dieser Funktion können Sie Kernel-Aktualisierungen zunächst auf sichere Weise testen, wobei Sie jederzeit ein Fallback auf den bisherigen (einwandfrei funktionsfähigen) Kernel vornehmen können. Verwenden Sie hierzu nicht die Aktualisierungswerkzeuge (wie YaST-Online-Update oder das Aktualisierungsmodul), sondern befolgen Sie die Anweisungen in diesem Kapitel.
   </para>
  </abstract>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:bugtracker/>
   <dm:translation>Ja</dm:translation>
  </dm:docmanager>
 </info>
 <warning os="sles;sled">

  <title>Supportberechtigung</title>
  <para>
   Es ist zu beachten, dass Ihre gesamte Supportberechtigung für den Rechner erlischt, sobald Sie einen selbst kompilierten Kernel oder einen Kernel von Drittanbietern installieren. Es werden nur solche Kernels unterstützt, die zum Lieferumfang von <phrase role="productname"><phrase os="sled">SUSE Linux Enterprise Desktop</phrase></phrase> gehören oder über die offiziellen Aktualisierungskanäle für <phrase role="productname"><phrase os="sled">SUSE Linux Enterprise Desktop</phrase></phrase> bezogen werden.
  </para>
 </warning>
 <tip>
  <title>Prüfen der Bootloader-Konfiguration</title>
  <para>
   Nach dem Installieren eines weiteren Kernels wird empfohlen, die Bootloader-Konfiguration zu prüfen und den gewünschten Standard-Booteintrag festzulegen. Weitere Informationen hierzu finden Sie im <xref linkend="sec-grub2-yast2-config"/>.
  </para>
 </tip>
 <sect1 xml:id="sec-tuning-multikernel-enable">
  <title>Aktivieren und Konfigurieren der Multiversions-Unterstützung</title>



  <para>
   Die Unterstützung für die Installation mehrerer Versionen eines Softwarepakets (Multiversions-Unterstützung) ist seit <phrase os="sles;sled">SUSE Linux Enterprise Server 12</phrase> standardmäßig aktiviert. Diese Einstellung können Sie wie folgt überprüfen:
  </para>

  <procedure>
   <step>
    <para>
     Öffnen Sie <filename>/etc/zypp/zypp.conf</filename> als <systemitem class="username">root</systemitem> in einem Editor.
    </para>
   </step>
   <step>
    <para>
     Suchen Sie die Zeichenkette <literal>multiversion</literal>. Wenn „multiversion“ für alle Kernel-Pakete aktiviert ist, die diese Funktion unterstützen, wird folgende Zeile ohne Kommentare angezeigt:
    </para>
<screen>multiversion = provides:multiversion(kernel)</screen>
   </step>
   <step>
    <para>
     Soll die Multiversions-Unterstützung auf bestimmte Kernel-Varianten beschränkt werden, fügen Sie die Paketnamen in einer durch Komma getrennten Liste an die Option <literal>multiversion</literal> in <filename>/etc/zypp/zypp.conf</filename> an, beispielsweise
    </para>
<screen>multiversion = kernel-default,kernel-default-base,kernel-source
</screen>
   </step>
   <step>
    <para>
     Speichern Sie die Änderungen.
    </para>
   </step>
  </procedure>

  <warning>
   <title>Kernel-Modul-Pakete (KMP)</title>
   <para>
    Stellen Sie sicher, dass die erforderlichen, vom Hersteller bereitgestellten Kernel-Module (Kernel-Modul-Pakete) auch für den neuen, aktualisierten Kernel installiert werden. Während der Aktualisierung des Kernels erhalten Sie keine Warnung zu fehlenden Kernel-Modulen, da die Paketanforderungen noch vom alten, auf dem System beibehaltenen Kernel erfüllt werden.
   </para>
  </warning>

  <sect2 xml:id="sec-tuning-multikernel-enable-keep">
   <title>Automatisches Löschen nicht verwendeter Kernel</title>
   <para>
    Wenn Sie häufig neue Kernel mit aktivierter Multiversions-Unterstützung testen, wird das Bootmenü rasch unübersichtlich. Für eine <filename>/boot</filename>-Partition gilt in der Regel eine Längenbeschränkung, sodass zu lange Angaben für <filename>/boot</filename> zu Problemen führen können. Sie können die nicht verwendeten Kernel-Versionen durchaus manuell mit YaST oder Zypper entfernen (Anweisungen siehe unten) oder auch alternativ <systemitem class="library">libzypp</systemitem> so konfigurieren, dass alle nicht mehr genutzten Kernel automatisch gelöscht werden. Standardmäßig werden keine Kernel gelöscht.
   </para>
   <procedure>
    <step>
     <para>
      Öffnen Sie <filename>/etc/zypp/zypp.conf</filename> als <systemitem class="username">root</systemitem> in einem Editor.
     </para>
    </step>
    <step>
     <para>
      Suchen Sie die Zeichenkette <literal>multiversion.kernels</literal>, und aktivieren Sie die Option, indem Sie die Auskommentierung der Zeile aufheben. Diese Option erfordert eine durch Komma getrennte Liste der folgenden Werte:
     </para>
     <formalpara>
      <title><literal><replaceable>5.3.18-53.3</replaceable></literal>:</title>
      <para>
       Kernel mit angegebener Versionsnummer beibehalten
      </para>
     </formalpara>
     <formalpara>
      <title><literal>neusten</literal>:</title>
      <para>
       Kernel mit höchster Versionsnummer beibehalten
      </para>
     </formalpara>
     <formalpara>
      <title><literal>latest-N</literal>:</title>
      <para>
       Kernel mit n-höchster Versionsnummer beibehalten
      </para>
     </formalpara>
     <formalpara>
      <title><literal>ist und ausgeführt wird</literal>:</title>
      <para>
       Derzeit ausgeführten Kernel beibehalten
      </para>
     </formalpara>
     <formalpara>
      <title><literal>weitesten</literal>:</title>
      <para>
       Kernel mit niedrigster Versionsnummer beibehalten (also den Kernel, der aus dem ursprünglichen Lieferumfang von <phrase role="productname"><phrase os="sled">SUSE Linux Enterprise Desktop</phrase></phrase> stammt)
      </para>
     </formalpara>
     <formalpara>
      <title><literal>oldest+N</literal>:</title>
      <para>
       Kernel mit n-niedrigster Versionsnummer beibehalten
      </para>
     </formalpara>
     <para>
      Hier einige Beispiele
     </para>
     <variablelist>
      <varlistentry>
       <term><literal>multiversion.kernels = latest,running</literal>
       </term>
       <listitem>
        <para>
         Behält den jüngsten Kernel und den derzeit ausgeführten Kernel bei. Dies entspricht nahezu dem Nichtaktivieren der Multiversionsfunktion, mit der Ausnahme, dass der alte Kernel nicht direkt nach der Installation entfernt wird, sondern erst <emphasis>nach dem nächsten Neubooten</emphasis>.
        </para>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term><literal>multiversion.kernels = latest,latest-1,running </literal>
       </term>
       <listitem>
        <para>
         Behält die beiden jüngsten Kernel und den derzeit ausgeführten Kernel bei.
        </para>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term><literal>multiversion.kernels = latest,running,<replaceable>5.3.18-53.3 </replaceable></literal>
       </term>
       <listitem>
        <para>
         Behält den jüngsten Kernel, den derzeit ausgeführten Kernel sowie den Kernel <replaceable>5.3.18-53.3</replaceable> bei.
        </para>
       </listitem>
      </varlistentry>
     </variablelist>
     <tip>
      <title>Derzeit ausgeführten Kernel beibehalten</title>
      <para>
       Wenn Sie nicht mit einer besonderen Einrichtung arbeiten, behalten Sie den als derzeit <literal>ausgeführt</literal> markierten Kernel bei.
      </para>
      <para>
       Falls Sie den derzeit ausgeführten Kernel nicht beibehalten, wird dieser Kernel bei einer Kernel-Aktualisierung gelöscht. Dies bedeutet wiederum, dass auch alle Module des derzeit ausgeführten Kernels gelöscht werden und nicht mehr geladen werden können.
      </para>
      <para>
       Wenn Sie sich entscheiden, den derzeit ausgeführten Kernel tatsächlich nicht beizubehalten, booten Sie nach einer Kernel-Aktualisierung stets unmittelbar neu, damit keine Probleme mit den Modulen auftreten.
      </para>
     </tip>
    </step>
   </procedure>
  </sect2>
  <sect2 xml:id="sec-tuning-multikernel-deleteoldkernel">
   <title>Anwendungsfall: Löschen eines alten Kernels erst nach dem Neustart</title>
   <para>
    Ein alter Kernel soll erst dann gelöscht werden, wenn das System fehlerfrei mit dem neuen Kernel gebootet wurde.
   </para>
   <para>
    Ändern Sie die folgende Zeile in <filename>/etc/zypp/zypp.conf</filename>:
   </para>
<screen>multiversion.kernels = latest,running</screen>
   <para>
    Die Parameter weisen das System an, den aktuellen Kernel und den ausgeführten Kernel nur dann beizubehalten, wenn sie nicht identisch sind.
   </para>
  </sect2>

  <sect2 xml:id="sec-tuning-multikernel-fallback">
   <title>Anwendungsfall: Beibehalten älterer Kernel als Fallback</title>
   <para>
    Mindestens eine Kernel-Version soll als <quote>Ersatz</quote>-Kernel beibehalten werden.
   </para>
   <para>
    Dies kann von Nutzen sein, wenn Sie mehrere Kernel zu Testzwecken beibehalten möchten. Sollte ein Problem eintreten (beispielsweise weil der Computer nicht bootet), können Sie dennoch auf mindestens eine bekanntermaßen funktionsfähige Kernel-Version zurückgreifen.
   </para>
   <para>
    Ändern Sie die folgende Zeile in <filename>/etc/zypp/zypp.conf</filename>:
   </para>
<screen>multiversion.kernels = latest,latest-1,latest-2,running</screen>
   <para>
    Wenn Sie das System nach dem Installieren eines neuen Kernels neu booten, behält das System drei Kernel bei: den aktuellen Kernel (als <literal>latest,running</literal> konfiguriert) und die beiden unmittelbaren Vorgänger (als <literal>latest-1</literal> und <literal>latest-2</literal> konfiguriert).
   </para>
  </sect2>

  <sect2 xml:id="sec-tuning-multikernel-specificversion">
   <title>Anwendungsfall: Beibehalten einer bestimmten Kernel-Version</title>
   <para>
    Sie nehmen regelmäßige Systemaktualisierungen vor und installieren neue Kernel-Versionen. Daneben kompilieren Sie eine eigene Kernel-Version, die im System beibehalten werden soll.
   </para>
   <para>
    Ändern Sie die folgende Zeile in <filename>/etc/zypp/zypp.conf</filename>:
   </para>
<screen>multiversion.kernels = latest,5.3.18-53.3,running</screen>
   <para>
    Wenn Sie das System nach der Installation eines neuen Kernels neu booten, behält das System zwei Kernel bei: den neuen und ausgeführten Kernel (als <literal>latest,running</literal> konfiguriert) und den selbst kompilierten Kernel (als <literal>latest-5.3.18-53.3</literal> konfiguriert).
   </para>
  </sect2>
 </sect1>
 <sect1 xml:id="sec-tuning-multikernel-yast">
  <title>Installieren/Entfernen von mehreren Kernel-Versionen mit YaST</title>
  <para>
   Mit YaST können Sie mehrere Kernel installieren oder entfernen:
  </para>
  <procedure>
   <step>
    <para>
     Starten Sie YaST, und öffnen Sie den Software-Manager mit <menuchoice>
     <guimenu>Software</guimenu> <guimenu>Software installieren oder löschen</guimenu>
     </menuchoice>.
    </para>
   </step>
   <step>
    <para>
     Wählen Sie <menuchoice> <guimenu>Anzeigen</guimenu> <guimenu>Paketgruppen</guimenu>
     <guimenu>Multiversions-Pakete</guimenu> </menuchoice>. Eine Liste aller Pakete, die mehrere Versionen bieten, wird angezeigt.
    </para>
    <figure>
     <title>Der YaST-Software-Manager: Multiversionsanzeige</title>
     <mediaobject>
      <imageobject role="fo">
       <imagedata fileref="yast2_sw_multiversion.png" width="90%" format="PNG"/>
      </imageobject>
      <imageobject role="html">
       <imagedata fileref="yast2_sw_multiversion.png" width="90%" format="PNG"/>
      </imageobject>
     </mediaobject>
    </figure>
   </step>
   <step>
    <para>
     Wählen Sie ein Paket aus, und öffnen Sie den Karteireiter <guimenu>Version</guimenu> im unteren linken Bereich.
    </para>
   </step>
   <step>
    <para>
     Zum Installieren eines Pakets klicken Sie auf das Kontrollkästchen neben dem Paket. Ein grünes Häkchen zeigt, dass das betreffende Paket zur Installation ausgewählt wurde.
    </para>
    <para>
     Soll ein bereits installiertes Paket (mit einem weißen Häkchen markiert) entfernt werden, klicken Sie auf das zugehörige Kontrollkästchen, bis ein rotes <literal>X</literal> sichtbar ist. Dies bedeutet, dass das Paket zum Entfernen ausgewählt wurde.
    </para>
   </step>
   <step>
    <para>
     Klicken Sie auf <guimenu>Übernehmen</guimenu>, um mit der Installation zu beginnen.
    </para>
   </step>
  </procedure>
 </sect1>
 <sect1 xml:id="sec-tuning-multikernel-zypper">
  <title>Installieren/Entfernen von mehreren Kernel-Versionen mit Zypper</title>
  <para>
   Mit <command>zypper</command> können Sie mehrere Kernel installieren oder entfernen:
  </para>
  <procedure>
   <step>
    <para>
     Rufen Sie mit dem Kommando <command>zypper se -s 'kernel*'</command> eine Liste aller verfügbaren Kernel-Pakete ab:
    </para>
<screen><?dbsuse-fo font-size="7pt"?>


S  | Name                 | Type    | Version           | Arch   | Repository
---+----------------------+---------+-------------------+--------+---------------------------------
i+ | kernel-default       | package | 5.3.18-53.3       | x86_64 | (System Packages)
i+ | kernel-default       | package | 5.3.18-54.2       | x86_64 | SLE-Module-Basesystem15-SP3-Pool
   | kernel-default-base  | package | 5.3.18-54.2.16.15 | x86_64 | SLE-Module-Basesystem15-SP3-Pool
   | kernel-default-devel | package | 5.3.18-54.2       | x86_64 | SLE-Module-Basesystem15-SP3-Pool
   | kernel-devel         | package | 5.3.18-54.2       | noarch | SLE-Module-Basesystem15-SP3-Pool
i  | kernel-firmware      | package | 20210208-2.4      | noarch | SLE-Module-Basesystem15-SP3-Pool
   | kernel-macros        | package | 5.3.18-54.2       | noarch | SLE-Module-Basesystem15-SP3-Pool
   | kernel-preempt       | package | 5.3.18-54.2       | x86_64 | SLE-Module-Basesystem15-SP3-Pool
</screen>
   </step>
   <step>
    <para>
     Geben Sie beim Installieren die genaue Version an:
    </para>
<screen><prompt>tux &gt; </prompt><command>sudo</command> zypper in kernel-default-5.3.18-53.3</screen>
   </step>
   <step>
    <para>
     Zum Deinstallieren eines Kernels rufen Sie mit dem Kommando <command>zypper se -si 'kernel*'</command> eine Liste aller installierter Kernel ab und entfernen Sie das gewünschte Paket mit dem Kommando <command>zypper rm</command> <replaceable> PAKETNAME-VERSION</replaceable>.
    </para>
   </step>
  </procedure>
 </sect1>
 
</chapter>
