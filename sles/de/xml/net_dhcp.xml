<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="net_dhcp.xml" version="5.0" xml:id="cha.dhcp">

 <title>DHCP</title>
 <info>
  <abstract>
   <para>
    <emphasis>DHCP</emphasis> (Dynamic Host Configuration Protocol) dient dazu, Einstellungen in einem Netzwerk zentral (von einem Server) aus zuzuweisen. Einstellungen müssen also nicht dezentral an einzelnen Arbeitsplatzcomputern konfiguriert werden. Ein für DHCP konfigurierter Host verfügt nicht über eine eigene statische Adresse. Er konfiguriert sich stattdessen vollständig und automatisch nach den Vorgaben des DHCP-Servers. Wenn Sie auf der Clientseite den NetworkManager verwenden, brauchen Sie den Client nicht zu konfigurieren. Das ist nützlich, wenn Sie in wechselnden Umgebungen arbeiten und nur jeweils eine Schnittstelle aktiv ist. Verwenden Sie den NetworkManager nie auf einem Computer, der einen DHCP-Server ausführt.
   </para>
  </abstract>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:bugtracker/>
   <dm:translation>Ja</dm:translation>
  </dm:docmanager>
 </info>
<indexterm class="startofrange" xml:id="idx.DHCP">
 <primary>DHCP</primary></indexterm><indexterm>
 <primary>Netzwerke</primary>
 <secondary>DHCP</secondary></indexterm><indexterm>
 <primary>IP-Adressen</primary>
 <secondary>Dynamische Zuweisung</secondary></indexterm>
 <tip arch="zseries" os="sles">
  <title>IBM z Systems: DHCP-Unterstützung</title>
  <para>
   Auf IBM z Systems-Plattformen funktioniert DHCP nur bei Schnittstellen, die die OSA- und OSA Express-Netzwerkkarten verwenden. Nur diese Karten verfügen über eine für die Autokonfigurationsfunktionen von DHCP erforderliche MAC-Adresse.
  </para>
 </tip>
 <para>
  Eine Möglichkeit zur Konfiguration von DHCP-Servern besteht darin, jeden Client mithilfe der Hardwareadresse seiner Netzwerkkarte zu identifizieren (die in den meisten Fällen statisch ist) und anschließend diesen Client bei jeder Verbindung zum Server mit identischen Einstellungen zu versorgen. Zum anderen kann DHCP aber auch so konfiguriert werden, dass der Server jedem relevanten Client eine Adresse aus einem dafür vorgesehenen Adresspool dynamisch zuweist. In diesem Fall versucht der DHCP-Server, dem Client bei jeder Anforderung dieselbe Adresse zuzuweisen – auch über einen längeren Zeitraum hinweg. Das ist nur möglich, wenn die Anzahl der Clients im Netzwerk nicht die Anzahl der Adressen übersteigt.
 </para>
 <para>
  DHCP erleichtert Systemadministratoren das Leben. Alle (selbst umfangreiche) Änderungen der Netzwerkadressen oder der -konfiguration können zentral in der Konfigurationsdatei des DHCP-Servers vorgenommen werden. Dies ist sehr viel komfortabler als das Neukonfigurieren zahlreicher Arbeitsstationen. Außerdem können vor allem neue Computer sehr einfach in das Netzwerk integriert werden, indem sie aus dem Adresspool eine IP-Adresse zugewiesen bekommen. Das Abrufen der entsprechenden Netzwerkeinstellungen von einem DHCP-Server ist auch besonders interessant für Notebooks, die regelmäßig in unterschiedlichen Netzwerken verwendet werden.
 </para>
 <para>
  In diesem Kapitel wird der DHCP-Server im gleichen Subnetz wie die Workstations (<systemitem class="ipaddress">192.168.2.0/24</systemitem>) mit <systemitem class="ipaddress">192.168.2.1</systemitem> als Gateway ausgeführt. Er hat die feste IP-Adresse <systemitem class="ipaddress">192.168.2.254</systemitem> und bedient die beiden Adressbereiche <systemitem class="ipaddress">192.168.2.10</systemitem> bis <systemitem class="ipaddress">192.168.2.20</systemitem> und <systemitem class="ipaddress">192.168.2.100</systemitem> bis <systemitem class="ipaddress">192.168.2.200</systemitem>.
 </para>
 <para>
  Neben IP-Adresse und Netzmaske werden dem Client nicht nur der Computer- und Domänenname, sondern auch das zu verwendende Gateway und die Adressen der Nameserver mitgeteilt. Im Übrigen können auch mehrere andere Parameter zentral konfiguriert werden, z. B. ein Zeitserver, von dem die Clients die aktuelle Uhrzeit abrufen können, oder ein Druckserver.
 </para>
 <sect1 xml:id="sec.dhcp.yast">
  <title>Konfigurieren eines DHCP-Servers mit YaST</title>

<indexterm>

  <primary>YaST</primary>

  <secondary> DHCP</secondary></indexterm><indexterm>

  <primary> DHCP</primary>

  <secondary> Konfigurieren mit YaST</secondary></indexterm>

  <para>
   Zur Installation eines DNS-Servers starten Sie YaST, und wählen Sie <menuchoice><guimenu>Software</guimenu> <guimenu>Software installieren oder löschen</guimenu></menuchoice>. Wählen Sie <menuchoice><guimenu>Filter</guimenu>
   <guimenu>Schemata</guimenu></menuchoice> und schließlich <guimenu>DHCP- und DNS-Server</guimenu> aus. Bestätigen Sie die Installation der abhängigen Pakete, um den Installationsvorgang abzuschließen.
  </para>

  <important>
   <title>LDAP-Unterstützung</title>
   <para>
    Das DHCP-Modul von YaST kann so eingestellt werden, dass die Serverkonfiguration lokal gespeichert wird (auf dem Host, der den DHCP-Server ausführt), oder so, dass die Konfigurationsdaten von einem LDAP-Server verwaltet werden. Wenn Sie LDAP verwenden möchten, richten Sie die LDAP-Umgebung ein, bevor Sie den DHCP-Server konfigurieren.
   </para>
   <para>
    Weitere Informationen zu LDAP finden Sie unter <xref linkend="cha.security.ldap"/>.
   </para>
  </important>

  <para>
   Das DHCP-Modul von YaST (<systemitem>yast2-dhcp-server</systemitem>) ermöglicht die Einrichtung Ihres eigenen DHCP-Servers für das lokale Netzwerk. Das Modul kann im Assistentenmodus oder im Expertenkonfigurationsmodus ausgeführt werden.
  </para>

  <sect2 xml:id="sec.dhcp.yast.init">
   <title>Anfängliche Konfiguration (Assistent)</title>
   <para>
    Beim ersten Starten des Moduls werden Sie von einem Assistenten aufgefordert, einige grundlegende Entscheidungen hinsichtlich der Serveradministration zu treffen. Nach Abschluss der anfänglichen Konfiguration ist eine grundlegende Serverkonfiguration verfügbar, die für einfache Szenarien ausreichend ist. Komplexere Konfigurationsaufgaben können im Expertenmodus ausgeführt werden. Führen Sie dazu die folgenden Schritte aus:
   </para>
   <remark>
   It has changed in the meantime.  DHCP Server Configuration ("expert mode")
   now allows more detailed configuration.  2010-06-22, ke.
  </remark>
   <procedure xml:id="pro.dhcp.yast.init">
    <step>
     <para>
      Wählen Sie in dieser Liste die Schnittstelle aus, die der DHCP-Server überwachen soll, und klicken Sie auf <guimenu>Auswählen</guimenu>. Wählen Sie anschließend die Option <guimenu>Firewall für gewählte Schnittstelle öffnen</guimenu>, um die Firewall für diese Schnittstelle zu öffnen, und klicken Sie auf <guimenu>Weiter</guimenu>. Weitere Informationen hierzu finden Sie unter <xref linkend="fig.yast2.dhcp.wiz1"/>.
     </para>
     <figure xml:id="fig.yast2.dhcp.wiz1">
      <title>DHCP-Server: Kartenauswahl</title>
      <mediaobject>
       <imageobject role="fo">
        <imagedata width="75%" fileref="yast2_dhcp_wiz1.png" format="PNG"/>
       </imageobject>
       <imageobject role="html">
        <imagedata width="75%" fileref="yast2_dhcp_wiz1.png" format="PNG"/>
       </imageobject>
      </mediaobject>
     </figure>
    </step>
    <step>
     <para>
      Geben Sie anhand des Kontrollkästchens an, ob Ihre DHCP-Einstellungen automatisch von einem LDAP-Server gespeichert werden sollen. In den Textfeldern legen Sie die Netzwerkinformationen fest, die jeder von diesem DHCP-Server verwaltete Client erhalten soll. Diese sind: Domänenname, Adresse eines Zeitservers, Adressen der primären und sekundären Namenserver, Adressen eines Druck- und WINS-Servers (für gemischte Netzwerkumgebungen mit Windows- und Linux-Clients), Gateway-Adressen und Leasing-Zeit. Weitere Informationen hierzu finden Sie unter <xref linkend="fig.yast2.dhcp.wiz2"/>.
     </para>
     <figure xml:id="fig.yast2.dhcp.wiz2">
      <title>DHCP-Server: Globale Einstellungen</title>
      <mediaobject>
       <imageobject role="fo">
        <imagedata width="75%" fileref="yast2_dhcp_wiz2.png" format="PNG"/>
       </imageobject>
       <imageobject role="html">
        <imagedata width="75%" fileref="yast2_dhcp_wiz2.png" format="PNG"/>
       </imageobject>
      </mediaobject>
     </figure>
    </step>
    <step>
     <para>
      Konfigurieren Sie die Vergabe der dynamischen IP-Adressen an Clients. Hierzu legen Sie einen Bereich von IP-Adressen fest, in dem die zu vergebenden Adressen der DHCP-Clients liegen dürfen. Alle zu vergebenden Adressen müssen unter eine gemeinsame Netzmaske fallen. Legen Sie abschließend die Leasing-Zeit fest, für die ein Client seine IP-Adresse behalten darf, ohne eine Verlängerung der Leasing-Zeit beantragen zu müssen. Legen Sie optional auch die maximale Leasing-Zeit fest, für die eine bestimmte IP-Adresse auf dem Server für einen bestimmten Client reserviert bleibt. Weitere Informationen hierzu finden Sie unter <xref linkend="fig.yast2.dhcp.wiz3"/>.
     </para>
     <figure xml:id="fig.yast2.dhcp.wiz3">
      <title>DHCP-Server: Dynamisches DHCP</title>
      <mediaobject>
       <imageobject role="fo">
        <imagedata width="75%" fileref="yast2_dhcp_wiz3.png" format="PNG"/>
       </imageobject>
       <imageobject role="html">
        <imagedata width="75%" fileref="yast2_dhcp_wiz3.png" format="PNG"/>
       </imageobject>
      </mediaobject>
     </figure>
    </step>
    <step>
     <para>
      Geben Sie an, auf welche Weise der DHCP-Server gestartet werden soll. Legen Sie fest, ob der DHCP-Server automatisch beim Booten des Systems oder bei Bedarf manuell (z. B. zu Testzwecken) gestartet werden soll. Klicken Sie auf <guimenu>Verlassen</guimenu>, um die Konfiguration des Servers abzuschließen. Weitere Informationen hierzu finden Sie unter <xref linkend="fig.yast2.dhcp.start"/>. 

     </para>
     <figure xml:id="fig.yast2.dhcp.start">
      <title>DHCP-Server: Start</title>
      <mediaobject>
       <imageobject role="fo">
        <imagedata width="75%" fileref="yast2_dhcp_start.png" format="PNG"/>
       </imageobject>
       <imageobject role="html">
        <imagedata width="75%" fileref="yast2_dhcp_start.png" format="PNG"/>
       </imageobject>
      </mediaobject>
     </figure>
    </step>
    <step os="sles;osuse">
     <para>
      Statt der Verwendung des dynamischen DHCP, wie in den vorigen Schritten beschrieben, können Sie den Server auch so konfigurieren, dass Adressen in fast statischer Weise zugewiesen werden. Geben Sie in die Textfelder im unteren Teil eine Liste der in dieser Art zu verwaltenden Clients ein. Geben Sie vor allem <guimenu>Name</guimenu> und <guimenu>IP-Adresse</guimenu> für einen solchen Client an, die <guimenu>Hardware-Adresse</guimenu> und den <guimenu>Netzwerktyp</guimenu> (Token-Ring oder Ethernet). Ändern Sie die oben angezeigte Liste der Clients mit <guimenu>Hinzufügen</guimenu>, <guimenu>Bearbeiten</guimenu> und <guimenu>Löschen</guimenu>. Weitere Informationen hierzu finden Sie unter <xref linkend="fig.yast2.dhcp.statdhcp"/>.
     </para>
     <figure xml:id="fig.yast2.dhcp.statdhcp">
      <title>DHCP-Server: Host-Verwaltung</title>
      <mediaobject>
       <imageobject role="fo">
        <imagedata width="75%" fileref="yast2_dhcp_statdhcp.png" format="PNG"/>
       </imageobject>
       <imageobject role="html">
        <imagedata width="75%" fileref="yast2_dhcp_statdhcp.png" format="PNG"/>
       </imageobject>
      </mediaobject>
     </figure>
    </step>
   </procedure>
  </sect2>

  <sect2 xml:id="sec.dhcp.yast.expert" os="sles;osuse">
   <title>DHCP-Server-Konfiguration (Experten)</title>
   <para>
    Zusätzlich zu den bisher erwähnten Konfigurationsmethoden gibt es einen Expertenkonfigurationsmodus, mit dem Sie die Einrichtung des DHCP-Servers detailgenau ändern können. Zum Starten der Expertenkonfiguration klicken Sie auf <guimenu>Expertenkonfiguration für DHCP-Server</guimenu> im Dialogfeld <guimenu>Start</guimenu> (siehe <xref linkend="fig.yast2.dhcp.start"/>).
   </para>
   <variablelist>
    <varlistentry>
     <term>Chroot-Umgebung und Deklarationen</term>
     <listitem>
      <para>
       Im ersten Dialogfeld bearbeiten Sie die vorhandene Konfiguration, indem Sie <guimenu>DHCP-Server starten</guimenu> wählen. Eine wichtige Funktion des Verhaltens eines DHCP-Servers ist, dass er in einer Chroot-Umgebung (oder einem Chroot-Jail) ausgeführt werden kann und so den Server-Host schützt. Sollte der DHCP-Server durch einen Angriff von außen beeinträchtigt werden, bleibt der Angreifer gefangen im Chroot-Jail und kann auf den Rest des Systems nicht zugreifen. Im unteren Bereich des Dialogfelds sehen Sie eine Baumstruktur mit den bereits definierten Deklarationen. Diese verändern Sie mit <guimenu>Hinzufügen</guimenu>, <guimenu>Löschen</guimenu> und <guimenu>Bearbeiten</guimenu>. Wenn Sie <guimenu>Erweitert</guimenu> wählen, werden zusätzliche Experten-Dialogfelder angezeigt. Weitere Informationen hierzu finden Sie unter <xref linkend="fig.yast2.dhcp.chroot"/>. Nach der Auswahl von <guimenu>Hinzufügen</guimenu> legen Sie den hinzuzufügenden Deklarationstyp fest. Mit <guimenu>Erweitert</guimenu> zeigen Sie die Protokolldatei des Servers an, konfigurieren die TSIG-Schlüsselverwaltung und passen die Konfiguration der Firewall an die Einrichtung des DHCP-Servers an.
      </para>
      <figure xml:id="fig.yast2.dhcp.chroot">
       <title>DHCP-Server: Chroot Jail und Deklarationen</title>
       <mediaobject>
        <imageobject role="fo">
         <imagedata width="75%" fileref="yast2_dhcp_chroot.png" format="PNG"/>
        </imageobject>
        <imageobject role="html">
         <imagedata width="75%" fileref="yast2_dhcp_chroot.png" format="PNG"/>
        </imageobject>
       </mediaobject>
      </figure>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>Auswählen des Deklarationstyps</term>
     <listitem>
      <para>
       Die <guimenu>Globalen Optionen</guimenu> des DHCP-Servers bestehen aus mehreren Deklarationen. In diesem Dialogfeld legen Sie die Deklarationstypen <guimenu>Subnetz</guimenu>, <guimenu>Host</guimenu>, <guimenu>Gemeinsames Netzwerk</guimenu>, <guimenu>Gruppe</guimenu>, <guimenu>Adressen-Pool</guimenu> und <guimenu>Klasse</guimenu> fest. In diesem Beispiel sehen Sie die Auswahl eines neuen Subnetzes (siehe <xref linkend="fig.yast2.dhcp.newdec"/>).
      </para>
      <figure xml:id="fig.yast2.dhcp.newdec">
       <title>DHCP-Server: Wählen eines Deklarationstyps</title>
       <mediaobject>
        <imageobject role="fo">
         <imagedata width="75%" fileref="yast2_dhcp_newdec.png" format="PNG"/>
        </imageobject>
        <imageobject role="html">
         <imagedata width="75%" fileref="yast2_dhcp_newdec.png" format="PNG"/>
        </imageobject>
       </mediaobject>
      </figure>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>Konfiguration des Subnetzes</term>
     <listitem>
      <para>
       In diesem Dialogfeld können Sie ein neues Subnetz mit seiner IP-Adresse und Netzmaske angeben. In der Mitte des Dialogfelds ändern Sie die Startoptionen des DHCP-Servers für das ausgewählte Subnetz mit den Optionen <guimenu>Hinzufügen</guimenu>, <guimenu>Bearbeiten</guimenu> und <guimenu>Löschen</guimenu>. Um einen dynamischen DNS für das Subnetz einzurichten, wählen Sie <guimenu>Dynamisches DNS</guimenu>.
      </para>
      <figure xml:id="fig.yast2.dhcp.sub">
       <title>DHCP-Server: Konfigurieren von Subnetzen</title>
       <mediaobject>
        <imageobject role="fo">
         <imagedata width="75%" fileref="yast2_dhcp_sub.png" format="PNG"/>
        </imageobject>
        <imageobject role="html">
         <imagedata width="75%" fileref="yast2_dhcp_sub.png" format="PNG"/>
        </imageobject>
       </mediaobject>
      </figure>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>TSIG-Schlüsselverwaltung</term>
     <listitem>
      <para>
       Wenn Sie im vorigen Dialogfeld die Konfiguration des dynamischen DNS vorgenommen haben, können Sie jetzt die Schlüsselverwaltung für einen sicheren Zonentransfer konfigurieren. Wenn Sie <guimenu>OK</guimenu> wählen, gelangen Sie zu einem weiteren Dialogfeld, in dem Sie die Schnittstelle für das dynamische DNS konfigurieren können (siehe <xref linkend="fig.yast2.dhcp.dyndns"/>).
      </para>
      <figure xml:id="fig.yast2.dhcp.tsig">
       <title>DHCP Server: TSIG-Konfiguration</title>
       <mediaobject>
        <imageobject role="fo">
         <imagedata width="75%" fileref="yast2_dhcp_tsig.png" format="PNG"/>
        </imageobject>
        <imageobject role="html">
         <imagedata width="75%" fileref="yast2_dhcp_tsig.png" format="PNG"/>
        </imageobject>
       </mediaobject>
      </figure>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>Dynamisches DNS: Schnittstellenkonfiguration</term>
     <listitem>
      <para>
       Jetzt können Sie das dynamische DNS für das Subnetz aktivieren, indem Sie <guimenu>Dynamisches DNS für dieses Subnetz aktivieren</guimenu> wählen. Danach aktivieren Sie im Dropdown-Feld die TSIG-Schlüssel für Forward und Reverse Zones. Vergewissern Sie sich dabei, dass die Schlüssel für den DNS- und den DHCP-Server dieselben sind. Mit der Option <guimenu>Globale dynamische DNS-Einstellungen aktualisieren</guimenu> aktivieren Sie die automatische Aktualisierung und Einstellung der globalen DHCP-Servereinstellungen entsprechend der dynamischen DNS-Umgebung. Nun legen Sie fest, welche Forward und Reverse Zones über das dynamische DNS aktualisiert werden sollen. Dafür geben Sie den primären Namenserver für beide Zonen an. Wenn Sie <guimenu>OK</guimenu> wählen, gelangen Sie wieder zum Dialogfeld für die Subnetzkonfiguration (siehe <xref linkend="fig.yast2.dhcp.sub"/>). Wenn Sie noch einmal auf <guimenu>OK</guimenu> klicken, gelangen Sie wieder zum ursprünglichen Dialogfeld für die Expertenkonfiguration.
      </para>
      <figure xml:id="fig.yast2.dhcp.dyndns">
       <title>DHCP-Server: Schnittstellenkonfiguration für dynamisches DNS</title>
       <mediaobject>
        <imageobject role="fo">
         <imagedata width="75%" fileref="yast2_dhcp_dyndns.png" format="PNG"/>
        </imageobject>
        <imageobject role="html">
         <imagedata width="75%" fileref="yast2_dhcp_dyndns.png" format="PNG"/>
        </imageobject>
       </mediaobject>
      </figure>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>Netzwerkschnittstellenkonfiguration</term>
     <listitem>
      <para>
       Wenn Sie die Schnittstellen festlegen möchten, die vom DHCP-Server überwacht werden sollen, und die Firewall-Konfiguration anpassen, wählen Sie im Dialogfeld für die Expertenkonfiguration <menuchoice>
       <guimenu>Erweitert</guimenu> <guimenu>Schnittstellenkonfiguration</guimenu>
       </menuchoice>. In der Liste der angezeigten Schnittstellen wählen Sie die gewünschte(n) Schnittstelle(n) für den DHCP-Server aus. Falls Clients in allen Subnetzen mit dem Server kommunizieren müssen und der Server-Host durch eine Firewall geschützt ist, passen Sie die Einstellungen der Firewall entsprechend an. Dafür wählen Sie <guimenu>Firewall-Einstellungen anpassen</guimenu>. YaST passt dann die Regeln der SuSEFirewall2 an die neuen Bedingungen an (siehe <xref linkend="fig.yast2.dhcp.fire"/>). Jetzt können Sie zum ursprünglichen Dialogfeld zurückkehren, indem Sie auf  <guimenu>OK </guimenu> klicken.
      </para>
      <figure xml:id="fig.yast2.dhcp.fire">
       <title>DHCP-Server: Netzwerkschnittstelle und Firewall</title>
       <mediaobject>
        <imageobject role="fo">
         <imagedata width="75%" fileref="yast2_dhcp_fire.png" format="PNG"/>
        </imageobject>
        <imageobject role="html">
         <imagedata width="75%" fileref="yast2_dhcp_fire.png" format="PNG"/>
        </imageobject>
       </mediaobject>
      </figure>
     </listitem>
    </varlistentry>
   </variablelist>
   <para>
    Nach Abschluss aller Konfigurationsschritte schließen Sie das Dialogfeld mit <guimenu>OK</guimenu>. Der Server wird jetzt mit seiner neuen Konfiguration gestartet.
   </para>
  </sect2>
 </sect1>
 <sect1 xml:id="sec.dhcp.soft">
  <title>DHCP-Softwarepakete</title><indexterm>

  <primary> DHCP</primary>

  <secondary> Pakete</secondary></indexterm> 

  <para>
   Sowohl der DHCP-Server als auch die DHCP-Clients stehen für SUSE Linux Enterprise Server zur Verfügung. Der vom Internet Systems Consortium (ISC) herausgegebene DHCP-Server <systemitem class="daemon">dhcpd</systemitem> stellt die Serverfunktionalität zur Verfügung. Auf der Clientseite befinden sich <systemitem>dhcp-client</systemitem> (ebenfalls von ISC) sowie Werkzeuge aus dem <systemitem>wicked</systemitem>-Paket.
  </para>

  <para>
   Standardmäßig werden die <systemitem>wicked</systemitem>-Werkzeuge mit den Diensten <systemitem>wicked-dhcp4</systemitem> und <systemitem>wicked-dhcp6</systemitem> installiert. Beide Services werden automatisch bei jedem Booten des Systems gestartet und übernehmen die Überwachung auf einem DHCP-Server. Sie kommen ohne eine Konfigurationsdatei aus und funktionieren im Normalfall ohne weitere Konfiguration. Für komplexere Situationen greifen Sie auf <systemitem>dhcp-client</systemitem> von ISC zurück, das sich über die Konfigurationsdateien <filename>/etc/dhclient.conf</filename> und <filename>/etc/dhclient6.conf</filename> steuern lässt. <indexterm>
   <primary>Konfigurationsdateien</primary>
   <secondary> dhclient.conf</secondary>
   </indexterm>
  </para>
 </sect1>
 <sect1 xml:id="sec.dhcp.server">
  <title>Der DHCP-Server dhcpd</title>

<indexterm>

  <primary>Konfigurationsdateien</primary>

  <secondary>dhcpd.conf</secondary></indexterm><indexterm class="startofrange" xml:id="idx.dhcp_server">

  <primary>DHCP</primary>

  <secondary>Server</secondary></indexterm><indexterm class="startofrange" xml:id="idx.dhcp_dhcpd">

  <primary>DHCP</primary>

  <secondary>dhcpd</secondary></indexterm>

  <para>
   Das Kernstück des DHCP-Systems ist der dhcpd-Daemon. Dieser Server <emphasis>least</emphasis> Adressen und überwacht deren Nutzung gemäß den Vorgaben in der Konfigurationsdatei <filename>/etc/dhcpd.conf</filename>. Über die dort definierten Parameter und Werte stehen dem Systemadministrator eine Vielzahl von Möglichkeiten zur Verfügung, das Verhalten des Programms anforderungsgemäß zu beeinflussen. Sehen Sie sich die einfache Beispieldatei <filename>/etc/dhcpd.conf</filename> in <xref linkend="dat.dhcp.conf"/> an.
  </para>

  <example xml:id="dat.dhcp.conf">
   <title>Die Konfigurationsdatei „/etc/dhcpd.conf“</title>
<screen>
default-lease-time 600;         # 10 minutes
max-lease-time 7200;            # 2  hours

option domain-name "example.com";
option domain-name-servers 192.168.1.116;
option broadcast-address 192.168.2.255;
option routers 192.168.2.1;
option subnet-mask 255.255.255.0;

subnet 192.168.2.0 netmask 255.255.255.0
 {
  range 192.168.2.10 192.168.2.20;
  range 192.168.2.100 192.168.2.200;
 }
</screen>
  </example>

  <para>
   Diese einfache Konfigurationsdatei reicht bereits aus, damit der DHCP-Server im Netzwerk IP-Adressen zuweisen kann. Bitte achten Sie insbesondere auf die Semikolons am Ende jeder Zeile, ohne die dhcpd nicht startet.
  </para>

  <para>
   Die Beispieldatei lässt sich in drei Abschnitte unterteilen. Im ersten Abschnitt wird definiert, wie viele Sekunden eine IP-Adresse standardmäßig an einen anfragenden Client geleast wird, bevor dieser eine Verlängerung anfordern sollte (<literal>default-lease-time</literal>). Hier wird auch festgelegt, wie lange ein Computer maximal eine vom DHCP-Server vergebene IP-Adresse behalten darf, ohne für diese eine Verlängerung anfordern zu müssen (<literal>max-lease-time</literal>).
  </para>

  <para>
   Im zweiten Abschnitt werden einige grundsätzliche Netzwerkparameter global festgelegt:
  </para>

  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>
     Die Zeile <literal>option domain-name</literal> enthält die Standarddomäne des Netzwerks.
    </para>
   </listitem>
   <listitem>
    <para>
     Mit dem Eintrag <literal>option domain-name-servers</literal> können Sie bis zu drei Werte für die DNS-Server angeben, die zur Auflösung von IP-Adressen in Hostnamen (und umgekehrt) verwendet werden sollen. Idealerweise sollten Sie vor dem Einrichten von DHCP einen Namenserver auf dem Computer oder im Netzwerk konfigurieren. Dieser Nameserver sollte für jede dynamische Adresse jeweils einen Hostnamen und umgekehrt bereithalten. Weitere Informationen zum Konfigurieren eines eigenen Namenservers finden Sie in <xref linkend="cha.dns"/>.
    </para>
   </listitem>
   <listitem>
    <para>
     Die Zeile <literal>option broadcast-address</literal> definiert die Broadcast-Adresse, die der anfragende Client verwenden soll.
    </para>
   </listitem>
   <listitem>
    <para>
     Mit <literal>option routers</literal> wird festgelegt, wohin der Server Datenpakete schicken soll, die (aufgrund der Adresse von Quell- und Zielhost sowie der Subnetzmaske) nicht im lokalen Netzwerk zugestellt werden können. In der Regel ist gerade bei kleineren Netzwerken dieser Router auch meist mit dem Internet-Gateway identisch.
    </para>
   </listitem>
   <listitem>
    <para>
     Mit <literal>option subnet-mask</literal> wird die den Clients zugewiesene Netzmaske angegeben.
    </para>
   </listitem>
  </itemizedlist>

  <para>
   Im letzten Abschnitt der Datei werden ein Netzwerk und eine Subnetzmaske angegeben. Abschließend muss noch ein Adressbereich gewählt werden, aus dem der DHCP-Daemon IP-Adressen an anfragende Clients vergeben darf. In <xref linkend="dat.dhcp.conf"/> können Clients Adressen zwischen <literal>192.168.2.10</literal> und <literal>192.168.2.20</literal> oder <literal>192.168.2.100</literal> und <literal>192.168.2.200</literal> zugewiesen werden.
  </para>

  <para>
   Nach dem Bearbeiten dieser wenigen Zeilen sollten Sie bereits in der Lage sein, den DHCP-Daemon mit dem Befehl <command>systemctl start dhcpd</command> zu aktivieren. Der DHCP-Daemon ist sofort einsatzbereit. Mit dem Befehl <command>rcdhcpd</command> <option>check-syntax</option> können Sie eine kurze Überprüfung der Konfigurationsdatei vornehmen. Sollte wider Erwarten ein Problem mit der Konfiguration auftreten (der Server wird beispielsweise mit einem Fehler beendet oder gibt beim Starten nicht <literal>done</literal> zurück), finden Sie in der zentralen Systemprotokolldatei, die mit dem Kommando <command>journalctl</command> abgefragt werden kann, weitere Informationen dazu (siehe <xref linkend="cha.journalctl"/>).
  </para>

  <para>
   Auf einem <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise</phrase></phrase>-Standardsystem wird der DHCP-Daemon aus Sicherheitsgründen in einer chroot-Umgebung gestartet. Damit der Daemon die Konfigurationsdateien finden kann, müssen diese in die chroot-Umgebung kopiert werden. In der Regel müssen Sie dazu nur den Befehl <command>systemctl start dhcpd</command> eingeben und die Dateien werden automatisch kopiert.
  </para><indexterm class="endofrange" startref="idx.dhcp_server"/><indexterm class="endofrange" startref="idx.dhcp_dhcpd"/>

  <sect2 xml:id="sec.dhcp.statip">
   <title>Clients mit statischen IP-Adressen</title><indexterm>
   <primary> DHCP</primary>
   <secondary> Zuweisung statischer Adressen</secondary></indexterm> 
   <para>
    DHCP lässt sich auch verwenden, um einem bestimmten Client eine vordefinierte statische Adresse zuzuweisen. Solche expliziten Adresszuweisungen haben Vorrang vor dynamischen Adressen aus dem Pool. Im Unterschied zu den dynamischen verfallen die statischen Adressinformationen nie, z. B. wenn nicht mehr genügend freie Adressen zur Verfügung stehen und deshalb eine Neuverteilung unter den Clients erforderlich ist.
   </para>
   <para>
    Zur Identifizierung eines mit einer statischen Adresse konfigurierten Clients verwendet dhcpd die Hardware-Adresse. Dies ist eine global eindeutige, fest definierte Zahl aus sechs Oktettpaaren, über die jedes Netzwerkgerät verfügt, z. B. <literal>00:30:6E:08:EC:80</literal>. Werden die entsprechenden Zeilen, wie z. B. in <xref linkend="dat.dhcp.conf.add"/> zur Konfigurationsdatei von <xref linkend="dat.dhcp.conf"/> hinzugefügt, weist der DHCP-Daemon dem entsprechenden Client immer dieselben Daten zu.
   </para>
   <example xml:id="dat.dhcp.conf.add">
    <title>Ergänzungen zur Konfigurationsdatei</title>
<screen>host jupiter {
hardware ethernet 00:30:6E:08:EC:80;
fixed-address 192.168.2.100;
}</screen>
   </example>
   <para>
    Der Name des entsprechenden Clients (<literal>Host</literal>
    <replaceable> Hostname</replaceable>, hier <systemitem>jupiter</systemitem>) wird in die erste Zeile und die MAC-Adresse wird in die zweite Zeile eingegeben. Auf Linux-Hosts kann die MAC-Adresse mit dem Befehl <command>ip</command>
    <option>link show</option> gefolgt vom Netzwerkgerät (z. B. <literal>eth0</literal>) ermittelt werden. Die Ausgabe sollte in etwa wie folgt aussehen:
   </para>
<screen>link/ether 00:30:6E:08:EC:80</screen>
   <para>
    Im vorherigen Beispiel wird also dem Client, dessen Netzwerkkarte die MAC-Adresse <literal>00:30:6E:08:EC:80</literal> hat, automatisch die IP-Adresse <systemitem class="ipaddress">192.168.2.100</systemitem> und der Hostname <literal>jupiter</literal> zugewiesen. Als Hardwaretyp kommt heutzutage in aller Regel <literal>ethernet</literal> zum Einsatz, wobei durchaus auch das vor allem bei IBM-Systemen häufig zu findende <literal>token-ring</literal> unterstützt wird.
   </para>
  </sect2>

  <sect2 xml:id="sec.dhcp.sle">
   <title>Die <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase>-Version</title>
   <para>
    Aus Sicherheitsgründen enthält bei <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> der DHCP-Server von ISC den non-root/chroot-Patch von Ari Edelkind. Damit kann dhcpd mit der Benutzer-ID <systemitem class="username">nobody</systemitem> und in einer chroot-Umgebung (<filename>/var/lib/dhcp</filename>) ausgeführt werden. Um dies zu ermöglichen, muss sich die Konfigurationsdatei <filename>dhcpd.conf</filename> im Verzeichnis <filename>/var/lib/dhcp/etc</filename> befinden. Sie wird vom Init-Skript beim Start automatisch dorthin kopiert.
   </para>
   <para>
    Dieses Verhalten lässt sich über Einträge in der Datei <filename>/etc/sysconfig/dhcpd</filename> steuern. Um den dhcpd ohne chroot-Umgebung laufen zu lassen, setzen Sie die Variable <systemitem>DHCPD_RUN_CHROOTED</systemitem> in der Datei <filename>/etc/sysconfig/dhcpd</filename> auf <quote>no</quote>.
   </para>
   <para>
    Damit der dhcpd auch in der chroot-Umgebung Hostnamen auflösen kann, müssen außerdem einige weitere Konfigurationsdateien kopiert werden:
   </para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>
      <filename>/etc/localtime</filename>
     </para>
    </listitem>
    <listitem>
     <para>
      <filename>/etc/host.conf</filename>
     </para>
    </listitem>
    <listitem>
     <para>
      <filename>/etc/hosts</filename>
     </para>
    </listitem>
    <listitem>
     <para>
      <filename>/etc/resolv.conf</filename>
     </para>
    </listitem>
   </itemizedlist>
   <para>
    Diese Dateien werden beim Starten des Init-Skripts in das Verzeichnis <filename>/var/lib/dhcp/etc/</filename> kopiert. Berüchsichtigen Sie die Kopien bei Aktualisierungen, die benötigt werden, wenn sie durch ein Skript wie <filename>/etc/ppp/ip-up</filename> dynamisch modifiziert werden. Falls in der Konfigurationsdatei anstelle von Hostnamen nur IP-Adressen verwendet werden, sind jedoch keine Probleme zu erwarten.
   </para>
   <para>
    Wenn in Ihrer Konfiguration weitere Dateien in die chroot-Umgebung kopiert werden müssen, können Sie diese mit der Variablen <systemitem>DHCPD_CONF_INCLUDE_FILES</systemitem> in der Datei <filename>/ etc/sysconfig/dhcpd</filename> festlegen. Damit der dhcp-Daemon aus der chroot-Umgebung heraus auch nach einem Neustart des syslog-Daemons weiter protokollieren kann, befindet sich der zusätzliche Eintrag <systemitem>SYSLOGD_ADDITIONAL_SOCKET_DHCP</systemitem> in der Datei <filename>/etc/sysconfig/syslog</filename>.
   </para>
  </sect2>
 </sect1>
 <sect1 xml:id="sec.dhcp.addinfo">
  <title>Weiterführende Informationen</title>

  <para>
   Weitere Informationen zu DHCP finden Sie auf der Website des <emphasis>Internet Systems Consortium</emphasis> (<link xlink:href="http://www.isc.org/products/DHCP/"/>). Weitere Informationen finden Sie zudem auf den man-Seiten <option>dhcpd</option>, <option>dhcpd.conf</option>, <option>dhcpd.leases</option> und <option>dhcp-options</option>.
  </para><indexterm class="endofrange" startref="idx.DHCP"/>
 </sect1>
</chapter>
