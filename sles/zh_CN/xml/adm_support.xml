<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="adm_support.xml" version="5.0" xml:id="cha.adm.support">


 <title>收集用于支持的系统信息</title>
 <info>
      <abstract>
        <para>
    为了让用户快速概览计算机的所有系统相关信息，<phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> 提供了 <systemitem class="systemname">hostinfo</systemitem> 包。该包还可以帮助系统管理员检查污染的（不支持的）内核，或者计算机上安装的任何第三方包。
   </para>
        <para>
    出现问题时，可以使用 <command>supportconfig</command> 命令行工具或 YaST <guimenu>支持</guimenu>模块创建详细的系统报告。这两种方法都会收集系统的相关信息，包括当前内核版本、硬件、已安装包、分区设置及其他信息。最后会生成一个包含多个文件的 TAR 存档。在建立服务请求 (SR) 后，您可以将该 TAR 存档上载至全球技术支持。该存档有助于跟踪您所报告的问题，并可以帮助您解决问题。
   </para>
        <para>
    此外，您可以分析 <command>supportconfig</command> 输出来发现已知问题，以帮助快速解决问题。为此，<phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> 提供了一个设备和一个命令行工具用于进行 <literal>Supportconfig 分析</literal> (SCA)。
   </para>
      </abstract>
      <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
        <dm:bugtracker>
        </dm:bugtracker>
        <dm:translation>yes</dm:translation>
      </dm:docmanager>
    </info>
    <indexterm> <primary>支持</primary> </indexterm> <indexterm> <primary>系统信息</primary></indexterm>
 <sect1 xml:id="sec.admsupport.hostinfo">
  <title>显示当前系统信息</title>



  <para>
   在登录到服务器时，要想快速方便地概览所有相关系统信息，请使用包 <systemitem class="systemname">hostinfo</systemitem>。在计算机上安装该包后，控制台将会向登录到该计算机的任何 <systemitem class="username">root</systemitem> 用户显示以下信息：
  </para>

  <example xml:id="ex.support.hostinfo">
   <title>以 <systemitem class="username">root</systemitem> 身份登录时的 <command>hostinfo</command> 输出</title>
<screen>Hostname:                 earth
Current As Of:            Wed 12 Mar 2014 03:57:05 PM CET
Distribution:             SUSE Linux Enterprise Server 12
 -Service Pack:           0
Architecture:             x86_64
Kernel Version:           3.12.12-3-default
 -Installed:              Mon 10 Mar 2014 03:15:05 PM CET
 -Status:                 Not Tainted
Last Updated Package:     Wed 12 Mar 2014 03:56:43 PM CET
 -Patches Needed:         0
 -Security:               0
 -3rd Party Packages:     0
IPv4 Address:             ens3 192.168.1.1
Total/Free/+Cache Memory: 983/95/383 MB (38% Free)
Hard Disk:                /dev/sda 10 GB</screen>
  </example>

  <para>
   如果输出显示 <literal>tainted</literal> 内核状态，请参见<xref linkend="sec.admsupport.kernel"/>以了解更多细节。
  </para>
 </sect1>
 <sect1 xml:id="sec.admsupport.supportconfig">
  <title>使用 Supportconfig 收集系统信息</title>

  <para>
   要创建包含详细系统信息的 TAR 存档以提交给全球技术支持，请直接使用 <command>supportconfig</command> 命令行工具，或者使用 YaST <guimenu>支持</guimenu>模块。该命令行工具由默认安装的包 <systemitem>supportutils</systemitem> 提供。YaST <guimenu>支持</guimenu>模块也基于该命令行工具。
  </para>

  <sect2 xml:id="sec.admsupport.supportconfig.sr">
   <title>创建服务请求编号</title>
   <para>
    系统随时都可以生成 Supportconfig 存档。但是，要将 supportconfig 数据提交给全球技术支持，首先需要生成一个服务请求编号。上载存档以获取支持时，您需要使用此编号。
   </para>
   <para>
    要创建服务请求，请访问 <link xlink:href="http://www.novell.com/center/eservice"/> 并遵照屏幕上的说明操作。写下您的 11 位服务请求编号。
   </para>
   <note>
    <title>隐私声明</title>
    <para>
     SUSE 和 Novell 将系统报告视为机密数据。有关我们在隐私方面所做承诺的详细信息，请参见 <link xlink:href="http://www.novell.com/company/legal/privacy/"/>。
    </para>
   </note>
  </sect2>

  <sect2 xml:id="sec.admsupport.supportconfig.upload">
   <title>上载目标</title>
   <para>
    在创建服务请求编号后，可以根据<xref linkend="pro.admsupport.submit.yast"/>或<xref linkend="pro.admsupport.submit.cli"/>中所述将 supportconfig 存档上载到全球技术支持。使用下列上载目标之一：
   </para>


   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>
      美国客户：<link xlink:href="ftp://ftp.novell.com/incoming"/>
     </para>
    </listitem>
    <listitem>
     <para>
      EMEA（欧洲、中东和非洲）：<link xlink:href="ftp://support-ftp.suse.com/in"/>
     </para>
    </listitem>
   </itemizedlist>
   <para>
    或者，可以使用以下服务请求 URL 手动将该 TAR 存档附加到您的服务请求：<link xlink:href="http://www.novell.com/center/eservice"/>。
   </para>
  </sect2>

  <sect2 xml:id="sec.admsupport.yast">
   <title>使用 YaST 创建 Supportconfig 存档</title>
   <para>
    要使用 YaST 收集系统信息，请按如下所述操作： <remark>2008-11-20 toms: YaST asks the user to open a URL as
     root(!). This happens when the users clicks on "Open" (Open
     Support Center/ This will start a browser with 
     Support Center Portal). I don't think we should describe this
     and only *use* the above URL as a normal user for security
     reasons.</remark>
   </para>
   <procedure>
    <step>
     <para>
      启动 YaST 并打开<guimenu>支持</guimenu>模块。
     </para>
     <informalfigure>
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="yast2-support-main.png" width="70%" format="PNG"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="yast2-support-main.png" width="60%" format="PNG"/>
       </imageobject>
      </mediaobject>
     </informalfigure>
    </step>
    <step>
     <para>
      单击<guimenu>创建报告 tarball</guimenu>。
     </para>
    </step>
    <step>
     <para>
      在随后出现的窗口中，从单选按钮列表中选择一个 supportconfig 选项。系统默认会预先选择<guimenu>使用自定义（专家）设置</guimenu>。如果要先测试报告功能，请使用<guimenu>仅收集最少量的信息</guimenu>。有关其他选项的某些背景信息，请参考 <command>supportconfig</command> 手册页。
     </para>
     <para>
      按<guimenu>下一步</guimenu>继续。
     </para>
    </step>
    <step xml:id="step.supportconfig.contact">
     <para>
      输入您的联系信息。该信息将写入名为 <filename>basic-environment.txt</filename> 的文件，并包含在要创建的存档中。
     </para>
    </step>
    <step xml:id="step.supportconfig.upload.target">
     <para>
      如果要在结束信息收集过程时将存档提交到全球技术支持，则需要指定<guimenu>上载信息</guimenu>。YaST 会自动推荐一个上载服务器。如果要修改该服务器，请参考<xref linkend="sec.admsupport.supportconfig.upload"/>，以详细了解可以使用哪些上载服务器。
     </para>
     <para>
      如果希望稍后提交存档，则可以暂时将<guimenu>上载信息</guimenu>留空。
     </para>
    </step>
    <step>
     <para>
      按<guimenu>下一步</guimenu>继续。
     </para>
    </step>
    <step>
     <para>
      开始收集信息。
     </para>
     <informalfigure>
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="yast2-support-conf.png" width="90%" format="PNG"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="yast2-support-conf.png" width="80%" format="PNG"/>
       </imageobject>
      </mediaobject>
     </informalfigure>
     <para>
      该过程完成后，按<guimenu>下一步</guimenu>继续。
     </para>
    </step>
    <step>
     <para>
      检查数据收集：选择日志文件的<guimenu>文件名</guimenu>可以在 YaST 中查看其内容。在将 TAR 存档提交到支持部门之前，如果要去除您不希望包含在该存档中的文件，请使用<guimenu>从数据中去除</guimenu>。按<guimenu>下一步</guimenu>继续。
     </para>
    </step>
    <step>
     <para>
      保存该 TAR 存档。如果您以 <systemitem class="username">root</systemitem> 用户身份启动了 YaST 模块，则默认情况下，YaST 会建议将该存档保存到 <filename>/var/log</filename>（否则将保存到您的主目录）。文件名格式为 <filename>nts_<replaceable>主机</replaceable>_<replaceable>日期</replaceable>_<replaceable>时间</replaceable>.tbz</filename>。
     </para>
    </step>
    <step>
     <para>
      如果要直接将该存档上载到支持部门，请确保<guimenu>将日志文件 tarball 上载到 URL</guimenu> 已激活。此处显示的<guimenu>上载目标</guimenu>是<xref linkend="step.supportconfig.upload.target"/> 中 YaST 建议的上载目标。如果要修改上载目标，请在 <xref linkend="sec.admsupport.supportconfig.upload"/> 中查找有关哪些上载服务器可用的详细信息。
     </para>
    </step>
    <step>
     <para>
      如果要跳过上载步骤，请停用<guimenu>将日志文件 tarball 上载到 URL</guimenu>。
     </para>
    </step>
    <step>
     <para>
      确认更改以关闭 YaST 模块。
     </para>
    </step>
   </procedure>
  </sect2>

  <sect2 xml:id="sec.admsupport.cli">
   <title>从命令行创建 Supportconfig 存档</title>
   <para>
    以下过程显示了如何创建 supportconfig 存档但不将它直接提交到支持部门。要上载该存档，需要根据<xref linkend="pro.admsupport.submit.cli"/>中所述，结合某些选项运行命令。
   </para>
   <procedure>
    <step>
     <para>
      打开外壳并转换为<systemitem class="username"> root </systemitem>用户。
     </para>
    </step>
    <step>
     <para>
      运行 <command>supportconfig</command>，不使用任何选项。这会收集默认的系统信息。
     </para>
    </step>
    <step>
     <para>
      等待工具完成操作。
     </para>
    </step>
    <step>
     <para>
      默认的存档位置为 <filename>/var/log</filename>，文件名格式为 <filename>nts_<replaceable>主机</replaceable>_<replaceable>日期</replaceable>_<replaceable>时间</replaceable>.tbz</filename>
     </para>
    </step>
   </procedure>
  </sect2>

  <sect2 xml:id="sec.admsupport.options">
   <title>常用的 supportconfig 选项</title>
   <para>
    <command>supportconfig</command> 实用程序在调用时通常不带任何选项。使用 <command>supportconfig</command> <option>-h</option> 显示所有选项的列表或参见手册页。下面的列表提供了某些常见用例的简述：
   </para>
   <variablelist>
    <varlistentry>
     <term>减少所收集信息的大小</term>
     <listitem>
      <para>
       使用最少量选项 (<option>-m</option>)：
      </para>
<screen>supportconfig -m</screen>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>将信息限制为特定的主题</term>
     <listitem>
      <para>
       如果您已使用默认的 <command>supportconfig</command> 输出找到问题原因所在，并发现该问题只与特定的区域或功能集相关，则您在下一次运行 <command>supportconfig</command> 时，可以将收集的信息限制为特定的区域。例如，如果您检测到 LVM 出现问题并想要测试最近对 LVM 配置所做的更改，则合适的做法是只收集有关 LVM 的最少量 supportconfig 信息：
      </para>
<screen>supportconfig -i LVM</screen>
      <para>
       要查看可用于将所收集信息限制为特定区域的功能关键字的完整列表，请运行
      </para>
<screen>supportconfig -F</screen>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>在输出中包含其他联系信息：</term>
     <listitem>
<screen>supportconfig -E tux@example.org -N "Tux Penguin" -O "Penguin Inc." ...</screen>
      <para>
       （在一行中输入所有命令）
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>收集已经过轮换的日志文件</term>
     <listitem>
<screen>supportconfig -l</screen>
      <para>
       在日志记录较多的环境下或当重引导后 syslog 轮换日志文件时发生内核崩溃的情况下，此项功能尤为有用。
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
  </sect2>
 </sect1>
 <sect1 xml:id="sec.admsupport.submit">
  <title>将信息提交到全球技术支持</title>

  <para>
   可以使用 YaST <guimenu>支持</guimenu>模块或 <command>supportconfig</command> 命令行实用程序向全球技术支持提交系统信息。如果您遇到服务器问题并想要获得支持人员的帮助，则首先需要建立一个服务请求。有关细节，请参见<xref linkend="sec.admsupport.supportconfig.sr"/>。
  </para>

  <para>
   以下示例使用 <replaceable>12345678901</replaceable> 作为服务请求编号的占位符。请将 <replaceable>12345678901</replaceable> 替换为您在<xref linkend="sec.admsupport.supportconfig.sr"/>中创建的服务请求编号。
  </para>

  <procedure xml:id="pro.admsupport.submit.yast">
   <title>使用 YaST 向支持部门提交信息</title>
   <para>
    以下过程假设您已创建但尚未上载某个 supportconfig 存档。请确保已按<xref linkend="sec.admsupport.yast"/>中的<xref linkend="step.supportconfig.contact" xrefstyle="select:label nopage"/> 所述在存档中包含了您的联系信息。有关如何通过一个步骤生成并提交 supportconfig 存档的说明，请参见<xref linkend="sec.admsupport.yast"/>。
   </para>
   <step>
    <para>
     启动 YaST 并打开<guimenu>支持</guimenu>模块。
    </para>
   </step>
   <step>
    <para>
     单击<guimenu>上载</guimenu>。
    </para>
   </step>
   <step>
    <para>
     在<guimenu>有日志文件的包</guimenu>中，指定现有 supportconfig 存档的路径，或者单击<guimenu>浏览</guimenu>找到该存档。
    </para>
   </step>
   <step xml:id="step.supportcfg.submit.upltarget">
    <para>
     YaST 会自动推荐一个上载服务器。如果要修改该服务器，请参考<xref linkend="sec.admsupport.supportconfig.upload"/>，以详细了解可以使用哪些上载服务器。
    </para>
    <informalfigure>
     <mediaobject>
      <imageobject role="fo">
       <imagedata fileref="yast2-support-conf-upload.png" width="70%" format="PNG"/>
      </imageobject>
      <imageobject role="html">
       <imagedata fileref="yast2-support-conf-upload.png" width="60%" format="PNG"/>
      </imageobject>
     </mediaobject>
    </informalfigure>
    <para>
     <remark>taroth 2014-04-11: this does not make sense to me - why does the
      YaST module *not* ask for the SR number now? and lets you continue after
      specifying an upload target (but no RC or customer info at all)? I would
      expect it to *check* if an SR has been entered and otherwise show an error
      message - filed http://bugzilla.suse.com/show_bug.cgi?id=880943 for this, unfortunately it
      was rejected for technical reasons</remark>单击<guimenu>下一步</guimenu>继续。
    </para>
   </step>
   <step>
    <para>
     单击<guimenu>完成</guimenu>。
    </para>
   </step>
  </procedure>

  <procedure xml:id="pro.admsupport.submit.cli">
   <title>从命令行向支持部门提交信息</title>
   <para>
    以下过程假设您已创建但尚未上载某个 supportconfig 存档。有关如何通过一个步骤生成并提交 supportconfig 存档的说明，请参见<xref linkend="sec.admsupport.yast"/>。
   </para>
   <step>
    <para>
     具有因特网连接的服务器：
    </para>
    <substeps performance="required">
     <step>
      <para>
       要使用默认上载目标，请运行：
      </para>
<screen>supportconfig -ur <replaceable>12345678901</replaceable></screen>
     </step>
     <step>
      <para>
       对于安全上载目标，请使用以下命令：
      </para>

<screen>supportconfig -ar <replaceable>12345678901</replaceable></screen>
     </step>
    </substeps>
   </step>
   <step>
    <para>
     <emphasis>不具有</emphasis>因特网连接的服务器：
    </para>
    <substeps performance="required">
     <step>
      <para>
       运行以下命令：
      </para>
<screen>supportconfig -r <replaceable>12345678901</replaceable></screen>
     </step>
     <step>
      <para>
       将 <filename>/var/log/nts_<replaceable>SR12345678901</replaceable>*tbz</filename> 存档手动上载到我们的 FTP 服务器之一。要使用哪个服务器取决于您所在的位置。有关概览，请参见<xref linkend="sec.admsupport.supportconfig.upload"/>。
      </para>
     </step>
    </substeps>
   </step>
   <step>
    <para>
     将 TAR 存档上载到我们 FTP 服务器的接收目录后，它会自动附加到您的服务请求中。
    </para>
   </step>
  </procedure>
 </sect1>

 <sect1 xml:id="sec.admsupport.sca">
  <title>分析系统信息</title>

  <para>
   您可以分析使用 <command>supportconfig</command> 创建的系统报告来发现已知问题，以帮助快速解决问题。为此，<phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> 提供了一个设备和一个命令行工具用于进行 <literal>Supportconfig 分析</literal> (SCA)。SCA 设备是一个非交互式服务器端工具。SCA 工具 (<command>scatool</command>) 在客户端运行，并通过命令行执行。这两个工具都能分析来自受影响服务器的 supportconfig 存档。初始服务器分析在 SCA 设备或运行 scatool 的工作站上进行。生产服务器上不发生任何分析周期。
  </para>

  <para>
   此外，该设备和命令行工具还需要产品特定的模式，这样它们才能分析关联产品的 supportconfig 输出。每个模式是一个脚本，用于针对某个已知问题分析和评估 supportconfig 存档。模式以 RPM 包的形式提供。
  </para>

  <para>
   例如，如果您想要分析 SUSE Linux Enterprise 11 计算机上生成的 supportconfig 存档，则需要将 <systemitem class="resource">sca-patterns-sle11</systemitem> 包随 SCA 工具一起安装（或者，在您想要用作 SCA 设备服务器的计算机上安装该包）。要分析 SUSE Linux Enterprise 10 计算机上生成的 supportconfig 存档，需要安装 <systemitem class="resource">sca-patterns-sle10</systemitem> 包。
  </para>

  <para>
   您也可以根据<xref linkend="sec.admsupport.sca.patterns"/>中的简述开发自己的模式。
  </para>

  <sect2 xml:id="sec.admsupport.sca.tool">
   <title>SCA 命令行工具</title>
   <para>
    SCA 命令行工具可让您既可使用 <command>supportconfig</command> 又可使用本地计算机上安装的特定产品的分析模式来分析该本地计算机。该工具将创建一份 HTML 报告来显示分析结果。有关示例，请参见 <xref linkend="fig.scatool.html"/>。
   </para>
   <figure xml:id="fig.scatool.html">
    <title>SCA 工具生成的 HTML 报告</title>
    <mediaobject>
     <imageobject role="fo">
      <imagedata fileref="sca_tool_report_html.png" width="100%"/>
     </imageobject>
     <imageobject role="html">
      <imagedata fileref="sca_tool_report_html.png" width="100%"/>
     </imageobject>
    </mediaobject>
   </figure>
   <para>
    <command>scatool</command> 命令由 <systemitem class="resource">sca-server-report</systemitem> 包提供。默认情况下不会安装该包。此外，您需要 <systemitem class="resource">sca-patterns-base</systemitem> 包，以及任一产品特定的 <systemitem class="resource">sca-patterns-*</systemitem> 包（与您想要在其上运行 <command>scatool</command> 命令的计算机上安装的产品匹配）。
   </para>
   <para>
    以 <systemitem class="username">root</systemitem> 用户身份或者结合 <command>sudo</command> 执行 <command>scatool</command> 命令。在调用 SCA 工具时，您可以分析现有的 <command>supportconfig</command> TAR 存档，或者让该工具通过一个步骤生成并分析新的存档。该工具还提供了一个交互式控制台（带 Tab 键补齐功能），并允许用户在外部计算机上运行 <command>supportconfig</command>，然后在本地计算机上执行后续分析。
   </para>
   <para>
    下面提供了一些示例命令：
   </para>
   <variablelist>
    <varlistentry>
     <term><command>sudo scatool </command><option>-s</option>
     </term>
     <listitem>
      <para>
       调用 <command>supportconfig</command> 并在本地计算机上生成新的 supportconfig 存档。通过应用与所安装产品匹配的 SCA 分析模式来分析存档以发现已知问题。显示基于分析结果生成的 HTML 报告的路径。通常，该报告将写入到 supportconfig 存档所在的同一个目录。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><command>sudo scatool </command><option>-s</option> <option>-o</option> <replaceable>/opt/sca/reports/</replaceable> 
     </term>
     <listitem>
      <para>
       与 <command>sudo scatool </command><option>-s</option> 类似，唯一的差别在于，HTML 报告将写入到 <option>-o</option> 指定的路径。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><command>sudo scatool </command><option>-a</option> <replaceable>PATH_TO_TARBALL_OR_DIR</replaceable> 
     </term>
     <listitem>
      <para>
       分析指定的 supportconfig 存档文件（或者 supportconfig 存档解压缩到的指定目录）。生成的 HTML 报告保存在 supportconfig 存档或目录所在的位置。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><command>sudo scatool </command><option>-a</option> <replaceable>sles_server.company.com</replaceable> 
     </term>
     <listitem>
      <para>
       与外部服务器 <replaceable>sles_server.company.com</replaceable> 建立 SSH 连接，并在该服务器上运行 <command>supportconfig</command>。supportconfig 存档随后将复制回本地计算机，并在该计算机上进行分析。生成的 HTML 报告保存在默认的 <filename>/var/log</filename> 目录中。（<replaceable>sles_server.company.com</replaceable> 上只创建 supportconfig 存档）。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><command>sudo scatool </command><option>-c</option>
     </term>
     <listitem>
      <para>
       启动 <command>scatool</command> 的交互式控制台。按 <keycap function="tab"/> 两次可查看可用命令。
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
   <para>
    有关其他选项和信息，请运行 <command>sudo scatool -h</command> 或参见 <command>scatool</command> 手册页。
   </para>
  </sect2>

  <sect2 xml:id="sec.admsupport.sca.appliance">
   <title>SCA 设备</title>
   <para>
    如果您决定使用 SCA 设备来分析 supportconfig 存档，则需要配置一台服务器（或虚拟机）作为专用的 SCA 设备服务器。然后，可以使用 SCA 设备服务器，在企业中运行 SUSE Linux Enterprise Server 或 SUSE Linux Enterprise Desktop 的所有计算机上分析 supportconfig 存档。您只需要将 supportconfig 存档上载到设备服务器，等待它进行分析。此过程无需任何交互。在 MariaDB 数据库中，SCA 设备将会跟踪已分析的所有 supportconfig 存档。您可以直接从设备 Web 界面阅读 SCA 报告。或者，可以让设备通过电子邮件将 HTML 报告发送给任何管理用户。有关细节，请参见<xref linkend="sec.admsupport.sca.appliance.config.mail"/>。
   </para>
   <para>
    要通过命令行快速安装和设置 SCA 设备，请遵照<xref linkend="sec.admsupport.sca.appliance.installquick"/>中的说明操作。该过程面向专家用户，主要通过单纯的安装与设置命令来完成。有关更多信息，请参考<xref linkend="sec.admsupport.sca.appliance.pre"/>到<xref linkend="sec.admsupport.sca.appliance.install"/>中的详细说明。
   </para>
   <sect3 xml:id="sec.admsupport.sca.appliance.installquick">
    <title>安装快速入门</title>
    <itemizedlist mark="bullet" spacing="normal">
     <title>先决条件</title>
     <listitem>
      <para>
       Web 和 LAMP 模式
      </para>
     </listitem>
     <listitem>
      <para>
       Web 和脚本编写模块（您必须注册计算机才能选择此模块）。
      </para>
     </listitem>
    </itemizedlist>
    <note>
     <title>需要 <systemitem class="username">root</systemitem> 特权</title>
     <para>
      下面过程中的所有命令必须以 <systemitem class="username">root</systemitem> 身份来运行。
     </para>
    </note>
    <procedure>
     <title>使用匿名 FTP 进行上载的安装</title>
     <para>
      设置并运行设备后，无需任何人工交互。因此，在使用 cron 作业创建和上载 supportconfig 存档时，非常适合使用这种方法来设置设备。
     </para>
     <step>
      <para>
       在安装设备的计算机上，登录到控制台并执行以下命令：
      </para>
<screen>zypper install sca-appliance-* sca-patterns-* vsftpd
systemctl enable apache2
systemctl start apache2
systemctl enable vsftpd
systemctl start vsftpd
yast ftp-server</screen>
     </step>
     <step>
      <para>
       在 YaST FTP 服务器中，选择<menuchoice><guimenu>身份验证</guimenu> <guimenu>启用上载</guimenu> <guimenu>允许匿名用户上载</guimenu> <guimenu>完成</guimenu> <guimenu>是</guimenu></menuchoice>，以<guimenu>创建 /srv/ftp/upload</guimenu>。
      </para>
     </step>
     <step>
      <para>
       执行以下命令：
      </para>
<screen>systemctl enable mysql
systemctl start mysql
mysql_secure_installation 
setup-sca -f</screen>
      <para>
       mysql_secure_installation 将创建 MariaDB <systemitem class="username">root</systemitem> 口令。
      </para>
     </step>
    </procedure>
    <procedure>
     <title>使用 SCP/tmp 进行上载的安装</title>
     <para>
      这种设置设备的方法需要在键入 SSH 口令时进行人工交互。
     </para>
     <step>
      <para>
       在安装设备的计算机上，登录到控制台。
      </para>
     </step>
     <step>
      <para>
       执行以下命令：
      </para>
<screen>zypper install sca-appliance-* sca-patterns-* 
systemctl enable apache2 
systemctl start apache2
sudo systemctl enable mysql
systemctl start mysql
mysql_secure_installation 
setup-sca</screen>
     </step>
    </procedure>
   </sect3>
   <sect3 xml:id="sec.admsupport.sca.appliance.pre">
    <title>先决条件</title>
    <para>
     要运行 SCA 设备服务器，需要满足以下先决条件：
    </para>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <para>
       安装所有 <systemitem>sca-appliance-*</systemitem> 包。
      </para>
     </listitem>
     <listitem>
      <para>
       安装 <systemitem class="resource">sca-patterns-base</systemitem> 包。此外，需要为您想要使用设备分析的 supportconfig 存档类型安装产品特定的 <systemitem class="resource">sca-patterns-*</systemitem>。
      </para>
     </listitem>
     <listitem>
      <para>
       Apache
      </para>
     </listitem>
     <listitem>
      <para>
       PHP
      </para>
     </listitem>
     <listitem>
      <para>
       MariaDB
      </para>
     </listitem>
     <listitem>
      <para>
       匿名 FTP 服务器（可选）
      </para>
     </listitem>
    </itemizedlist>
   </sect3>
   <sect3 xml:id="sec.admsupport.sca.appliance.install">
    <title>安装和基本设置</title>
    <para>
     如<xref linkend="sec.admsupport.sca.appliance.pre"/>中所列，SCA 设备与其他包存在若干依赖性。因此，在安装和设置 SCA 设备服务器之前，需要做一些准备工作：
    </para>
    <procedure>
     <step>
      <para>
       对于 Apache 和 MariaDB，请安装 <systemitem>Web</systemitem> 和 <systemitem>LAMP</systemitem> 安装模式。
      </para>
     </step>
     <step>
      <para>
       设置 Apache 和 MariaDB，并有选择性地设置一个匿名 FTP 服务器。<phrase os="sles">有关详细信息，请参见<xref linkend="cha.apache2"/>和<xref linkend="cha.ftp"/>。</phrase>
      </para>
     </step>
     <step>
      <para>
       将 Apache 和 MariaDB 配置为在引导时启动：
      </para>
<screen>sudo systemctl enable apache2 mysql</screen>
     </step>
     <step>
      <para>
       启动这两个服务：
      </para>
<screen>sudo systemctl start apache2 mysql</screen>
     </step>
    </procedure>
    <para>
     现在，您便可以根据<xref linkend="pro.sca.appl.install"/>中所述安装和设置 SCA 设备。
    </para>
    <procedure xml:id="pro.sca.appl.install">
     <title>安装和配置 SCA 设备</title>
     <para>
      安装这些包后，可以使用 <command>setup-sca</command> 脚本来对 SCA 设备使用的 MariaDB 管理与报告数据库进行基本的配置。
     </para>
     <para>
      使用该脚本可以配置以下选项，以便将 supportconfig 存档从您的计算机上载到 SCA 设备：
     </para>
     <itemizedlist mark="bullet" spacing="normal">
      <listitem>
       <para>
        <command>scp</command>
       </para>
      </listitem>
      <listitem>
       <para>
        匿名 FTP 服务器
       </para>
      </listitem>
     </itemizedlist>
     <step>
      <para>
       安装设备和 SCA 基本模式库：
      </para>
<screen>sudo zypper install sca-appliance-* sca-patterns-base</screen>
     </step>
     <step>
      <para>
       此外，请为您要分析的 supportconfig 存档类型安装模式包。例如，如果您的环境中安装了 SUSE Linux Enterprise Server 11 和 SUSE Linux Enterprise Server 12 服务器，请安装 <systemitem>sca-patterns-sle11</systemitem> 和 <systemitem>sca-patterns-sle12</systemitem> 这两个包。
      </para>
      <para>
       安装所有可用模式：
      </para>
<screen>zypper install sca-patterns-*</screen>
     </step>
     <step>
      <para>
       要对 SCA 设备进行基本的设置，请使用 <command>setup-sca</command> 脚本。调用该命令的方式取决于您要以哪种方式将 supportconfig 存档上载到 SCA 设备服务器：
      </para>
      <itemizedlist mark="bullet" spacing="normal">
       <listitem>
        <para>
         如果您配置了使用 <filename>/srv/ftp/upload</filename> 目录的匿名 FTP 服务器，请结合 <option>-f</option> 选项执行设置脚本，并遵照屏幕上的说明操作。
        </para>
<screen>setup-sca -f</screen>
        <note>
         <title>使用其他目录的 FTP 服务器</title>
         <para>
          如果 FTP 服务器使用的目录不是 <filename>/srv/ftp/upload</filename>，请先调整以下配置文件，使其指向正确的目录：<filename>/etc/sca/sdagent.conf</filename> 和 <filename>/etc/sca/sdbroker.conf</filename>。
         </para>
        </note>
       </listitem>
       <listitem>
        <para>
         如果您想要通过 <command>scp</command> 将 supportconfig 文件上载到 SCA 设备服务器的 <filename>/tmp</filename> 目录，请不带任何参数来调用该设置脚本，然后遵照屏幕上的说明操作：
        </para>
<screen>setup-sca</screen>
       </listitem>
      </itemizedlist>
      <para>
       该设置脚本将会根据它的要求运行一些检查，并配置所需的子组件。它会提示您输入两个口令：您设置的 MariaDB 的 MySQL <systemitem class="username">root</systemitem> 口令，以及用于登录 SCA 设备 Web 界面的 Web 用户口令。
      </para>
     </step>
     <step>
      <para>
       输入现有的 MariaDB <systemitem class="username">root</systemitem> 口令。SCA 设备将使用该口令连接到 MariaDB。
      </para>
     </step>
     <step>
      <para>
       定义 Web 用户的口令。该口令将写入 <filename>/srv/www/htdocs/sca/web-config.php</filename>，并设置为用户 <systemitem class="username">scdiag</systemitem> 的口令。以后，您可随时更改用户名和口令，请参见<xref linkend="sec.admsupport.sca.appliance.config.passwd"/>。
      </para>

     </step>
    </procedure>
    <para>
     在成功完成安装和设置后，便可以开始使用 SCA 设备，请参见<xref linkend="sec.admsupport.sca.appliance.use"/>。但是，您可能需要修改某些选项，例如，更改 Web 界面的口令，更改 SCA 模式更新源，启用存档模式，或者配置电子邮件通知。有关细节，请参见<xref linkend="sec.admsupport.sca.appliance.config"/>。
    </para>
    <warning>
     <title>数据保护</title>
     <para>
      由于 SCA 设备服务器上的报告包含已分析其 supportconfig 存档的计算机的安全相关信息，因此，必须保护好 SCA 设备服务器上的数据，以防未经授权的人员访问。
     </para>
    </warning>
   </sect3>
   <sect3 xml:id="sec.admsupport.sca.appliance.use">
    <title>使用 SCA 设备</title>
    <para>
     您可以将现有的 supportconfig 存档手动上载到 SCA 设备，也可以一步即完成创建新 supportconfig 存档以及将其上载到 SCA 设备的操作。可以通过 FTP 或 SCP 来上载存档。对于这两种上载方式，您需要知道可用来访问 SCA 设备的 URL。要通过 FTP 上载，需要为 SCA 设备配置一台 FTP 服务器，请参见<xref linkend="pro.sca.appl.install"/>。
    </para>
    <sect4 xml:id="sec.admsupport.sca.appliance.use.upload">
     <title>将 Supportconfig 存档上载到 SCA 设备</title>
     <itemizedlist mark="bullet" spacing="normal">
      <listitem>
       <para>
        要创建 supportconfig 存档并通过（匿名）FTP 上载：
       </para>
<screen>sudo supportconfig -U “ftp://<replaceable>sca-appliance.company.com</replaceable>/upload”</screen>
      </listitem>
      <listitem>
       <para>
        要创建 supportconfig 存档并通过 SCP 上载：
       </para>
<screen>sudo supportconfig -U “scp://<replaceable>sca-appliance.company.com</replaceable>/tmp”</screen>
       <para>
        系统将提示您输入运行 SCA 设备的服务器的 <systemitem class="username">root</systemitem> 用户口令。
       </para>
      </listitem>
      <listitem>
       <para>
        如果要手动上载一个或多个存档，请将现有的存档文件（通常位于 <filename>/var/log/nts_*.tbz</filename>）复制到 SCA 设备中。对于目标，请使用设备服务器的 <filename>/tmp</filename> 目录，或使用 <filename>/srv/ftp/upload</filename> 目录（如果为 SCA 设备服务器配置了 FTP）。
       </para>
      </listitem>
     </itemizedlist>
    </sect4>
    <sect4 xml:id="sec.admsupport.sca.appliance.use.view">
     <title>查看 SCA 报告</title>
     <para>
      可以在装有浏览器并可以访问 SCA 设备报告索引页的任何计算机上查看 SCA 报告。
     </para>
     <procedure>
      <step>
       <para>
        启动 Web 浏览器并确保 JavaScript 和 Cookie 已启用。
       </para>
      </step>
      <step>
       <para>
        输入 SCA 设备的报告索引页作为 URL。
       </para>
<screen>https://sca-appliance.company.com/sca</screen>
       <para>
        如果有任何疑问，请咨询系统管理员。
       </para>
      </step>
      <step>
       <para>
        系统将提示您输入用于登录的用户名和口令。
       </para>
       <figure xml:id="fig.sca.appl.html">
        <title>SCA 设备生成的 HTML 报告</title>
        <mediaobject>
         <imageobject role="fo">
          <imagedata fileref="sca_appl_report_html.png" width="100%"/>
         </imageobject>
         <imageobject role="html">
          <imagedata fileref="sca_appl_report_html.png" width="100%"/>
         </imageobject>
        </mediaobject>
       </figure>
      </step>
      <step>
       <para>
        登录后，单击您想要阅读的报告的日期。
       </para>
      </step>
      <step>
       <para>
        首先单击<guimenu>基本状态</guimenu>类别将其展开。
       </para>
      </step>
      <step>
       <para>
        在<guimenu>讯息</guimenu>列中单击某一个项。SUSE 知识库中的相应文章即会打开。阅读建议的解决方案，并遵循所述的说明。
       </para>
      </step>
      <step>
       <para>
        如果 <guimenu>Supportconfig 分析报告</guimenu>的<guimenu>解决方案</guimenu>列显示了其他项，请单击这些项。阅读建议的解决方案，并遵循所述的说明。
       </para>
      </step>
      <step>
       <para>
        请查看 SUSE 知识库 (<link xlink:href="http://www.suse.com/support/kb/"/>)，以了解与 SCA 识别的问题直接相关的结果。设法解决这些问题。
       </para>
      </step>
      <step>
       <para>
        查看可前瞻性处理的结果，以免将来发生问题。
       </para>
      </step>
     </procedure>
    </sect4>
   </sect3>
   <sect3 xml:id="sec.admsupport.sca.appliance.config">
    <title>自定义 SCA 设备</title>
    <para>
     以下几节显示了如何更改 Web 界面的口令、更改 SCA 模式更新源、启用存档模式以及配置电子邮件通知。
    </para>
    <sect4 xml:id="sec.admsupport.sca.appliance.config.passwd">
     <title>Web 界面的口令</title>
     <para>
      SCA 设备 Web 界面要求使用用户名和口令登录。默认的用户名为 <literal>scdiag</literal>，默认的口令为 <literal>linux</literal>（如果未做其他的指定，请参见<xref linkend="pro.sca.appl.install"/>）。请尽早将默认口令更改为较为安全的口令。您也可以修改用户名。
     </para>
     <procedure xml:id="pro.sca.passwd.change">
      <title>更改 Web 界面的用户名或口令</title>
      <step>
       <para>
        在 SCA 设备服务器的系统控制台上以 <systemitem class="username">root</systemitem> 用户身份登录。
       </para>
      </step>
      <step>
       <para>
        在编辑器中打开 <filename>/srv/www/htdocs/sca/web-config.php</filename>。
       </para>
      </step>
      <step>
       <para>
        根据需要更改 <literal>$username</literal> 和 <literal>$password</literal> 的值。
       </para>
      </step>
      <step>
       <para>
        保存文件并退出。
       </para>
      </step>
     </procedure>
    </sect4>
    <sect4 xml:id="sec.admsupport.sca.appliance.config.upd">
     <title>SCA 模式的更新</title>
     <para>
      默认情况下，所有 <systemitem class="resource">sca-patterns-*</systemitem> 包将由一个 <systemitem class="username">root</systemitem> cron 作业来定期更新，该作业将在夜间执行 <filename>sdagent-patterns</filename> 脚本，而该脚本又会运行 <command>zypper update sca-patterns-*</command>。定期的系统更新将会更新所有 SCA 设备包和模式包。要手动更新 SCA 设备和模式，请运行：
     </para>
<screen>sudo zypper update sca-*</screen>
     <para>
      默认情况下，将从 SUSE Linux Enterprise <phrase role="productnumber"><phrase os="sles;sled;slerte">12 SP1</phrase></phrase> 更新储存库安装更新。如果需要，您可以将更新源更改为某台 SMT 服务器。当 <filename>sdagent-patterns</filename> 运行 <command>zypper update sca-patterns-*</command> 时，将从当前配置的更新通道获取更新。如果该通道在 SMT 服务器上，将从该服务器提取包。
     </para>
     <procedure>
      <title>禁用 SCA 模式的自动更新</title>
      <step>
       <para>
        在 SCA 设备服务器的系统控制台上以 <systemitem class="username">root</systemitem> 用户身份登录。
       </para>
      </step>
      <step>
       <para>

        在编辑器中打开 <filename>/etc/sca/sdagent-patterns.conf</filename>。
       </para>
      </step>
      <step>
       <para>
        将项
       </para>
<screen>UPDATE_FROM_PATTERN_REPO=1</screen>
       <para>
        更改为
       </para>
<screen>UPDATE_FROM_PATTERN_REPO=0</screen>
      </step>
      <step>
       <para>
        保存文件并退出。计算机无需重启动就能应用更改。
       </para>
      </step>
     </procedure>
    </sect4>
    <sect4 xml:id="sec.admsupport.sca.appliance.config.archive">
     <title>存档模式</title>
     <para>
      系统在分析了 supportconfig 存档并将其结果储存在 MariaDB 数据库中后，会从 SCA 设备中删除所有这些存档。但是，如果要进行查错，在计算机中保留 supportconfig 存档的副本可能会有所帮助。默认情况下，存档模式处于禁用状态。
     </para>
     <procedure>
      <title>在 SCA 设备中启用存档模式</title>
      <step>
       <para>
        在 SCA 设备服务器的系统控制台上以 <systemitem class="username">root</systemitem> 用户身份登录。
       </para>
      </step>
      <step>
       <para>
        在编辑器中打开 <filename>/etc/sca/sdagent.conf</filename>。
       </para>
      </step>
      <step>
       <para>
        将项
       </para>
<screen>ARCHIVE_MODE=0</screen>
       <para>
        更改为
       </para>
<screen>ARCHIVE_MODE=1</screen>
      </step>
      <step>
       <para>
        保存文件并退出。计算机无需重启动就能应用更改。
       </para>
      </step>
     </procedure>
     <para>
      启用存档模式后，SCA 设备会将 supportconfig 文件保存到 <filename>/var/log/archives/saved</filename> 目录，而不是将其删除。
     </para>
    </sect4>
    <sect4 xml:id="sec.admsupport.sca.appliance.config.mail">
     <title>通过电子邮件发送 SCA 报告</title>
     <para>
      SCA 设备可通过电子邮件发送所分析的每个 supportconfig 的 HTML 报告文件。在默认情况下禁用该功能。启用该功能后，您可以定义要将报告发送到的电子邮件地址列表，并定义会触发报告发送动作的状态讯息级别 (<literal>STATUS_NOTIFY_LEVEL</literal>)。
     </para>
     <variablelist xml:id="vl.sca.mails.notify.level">
      <title><literal>STATUS_NOTIFY_LEVEL</literal> 的可能值</title>
      <varlistentry>
       <term>$STATUS_OFF</term>
       <listitem>
        <para>
         停用发送 HTML 报告功能。
        </para>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term>$STATUS_CRITICAL</term>
       <listitem>
        <para>
         仅发送包含“关键”状态的 SCA 报告。
        </para>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term>$STATUS_WARNING </term>
       <listitem>
        <para>
         仅发送包含“警告”或“关键”状态的 SCA 报告。
        </para>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term>$STATUS_RECOMMEND</term>
       <listitem>
        <para>
         仅发送包含“建议”、“警告”或“关键”状态的 SCA 报告。
        </para>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term>$STATUS_SUCCESS</term>
       <listitem>
        <para>
         发送包含“成功”、“建议”、“警告”或“关键”状态的 SCA 报告。
        </para>
       </listitem>
      </varlistentry>
     </variablelist>
     <procedure>
      <title>为 SCA 报告配置电子邮件通知</title>
      <step>
       <para>
        在 SCA 设备服务器的系统控制台上以 <systemitem class="username">root</systemitem> 用户身份登录。
       </para>
      </step>
      <step>
       <para>
        在编辑器中打开 <filename>/etc/sca/sdagent.conf</filename>。
       </para>
      </step>
      <step>
       <para>
        搜索 <systemitem>STATUS_NOTIFY_LEVEL</systemitem> 项。该项默认设置为 <literal>$STATUS_OFF</literal>（禁用电子邮件通知）。
       </para>
      </step>
      <step>
       <para>
        要启用电子邮件通知，请将 <literal>$STATUS_OFF</literal> 更改为要针对其生成电子邮件报告的状态讯息级别，例如：
       </para>
<screen>STATUS_NOTIFY_LEVEL=$STATUS_SUCCESS</screen>
       <para>
        有关细节，请参见<xref linkend="vl.sca.mails.notify.level"/>。
       </para>
      </step>
      <step>
       <para>
        定义要将报告发送到的收件人列表：
       </para>
       <substeps performance="required">
        <step>
         <para>
          搜索 <literal>EMAIL_REPORT='root'</literal> 项。
         </para>
        </step>
        <step>
         <para>
          将 <literal>root</literal> 替换为要向其发送 SCA 报告的电子邮件地址列表。各电子邮件地址必须以空格分隔。例如：
         </para>
<screen>EMAIL_REPORT='tux@my.company.com wilber@your.company.com'</screen>
        </step>
       </substeps>
      </step>
      <step>
       <para>
        保存文件并退出。计算机无需重启动就能应用更改。以后生成的所有 SCA 报告都将通过电子邮件发送到指定的地址。
       </para>
      </step>
     </procedure>
    </sect4>
   </sect3>
   <sect3 xml:id="sec.admsupport.sca.appliance.backup">
    <title>备份和恢复数据库</title>
    <para>
     要备份和恢复储存 SCA 报告的 MariaDB 数据库，请按如下所述使用 <command>scadb</command> 命令。
    </para>
    <procedure>
     <title>备份数据库</title>
     <step>
      <para>
       在运行 SCA 设备的服务器的系统控制台上以 <systemitem class="username">root</systemitem> 用户身份登录。
      </para>
     </step>
     <step>
      <para>
       通过执行以下命令将设备置于维护模式：
      </para>
<screen>scadb maint</screen>
     </step>
     <step>
      <para>
       使用以下命令启动备份进程：
      </para>
<screen>scadb backup</screen>
      <para>
       数据将保存到 TAR 存档 <filename>sca-backup-*sql.gz</filename> 中。
      </para>
     </step>
     <step>
      <para>
       如果您正在使用模式创建数据库开发自己的模式（参见<xref linkend="sec.admsupport.sca.patterns"/>），则还要备份以下数据：
      </para>
<screen>sdpdb backup</screen>
      <para>
       数据将保存到 TAR 存档 <filename>sdp-backup-*sql.gz</filename> 中。
      </para>
     </step>
     <step>
      <para>
       将以下数据复制到另一台计算机或外部储存媒体：
      </para>
      <itemizedlist mark="bullet" spacing="normal">
       <listitem>
        <para>
         <filename>sca-backup-*sql.gz</filename>
        </para>
       </listitem>
       <listitem>
        <para>
         <filename>sdp-backup-*sql.gz</filename>
        </para>
       </listitem>
       <listitem>
        <para>
         <filename>/usr/lib/sca/patterns/local</filename>（仅当您已创建自定义模式时才需要复制该数据）
        </para>
       </listitem>
      </itemizedlist>
     </step>
     <step>
      <para>
       使用以下命令重新激活 SCA 设备：
      </para>
<screen>scadb reset agents</screen>
     </step>
    </procedure>
    <procedure>
     <title>恢复数据库</title>
     <para>
      要基于备份恢复数据库，请按如下所述操作：
     </para>
     <step>
      <para>
       在运行 SCA 设备的服务器的系统控制台上以 <systemitem class="username">root</systemitem> 用户身份登录。
      </para>
     </step>
     <step>
      <para>
       将最新的 <filename>sca-backup-*sql.gz</filename> 和 <filename>sdp-backup-*sql.gz</filename> TAR 存档复制到 SCA 设备服务器。
      </para>
     </step>
     <step>
      <para>
       要解压缩文件，请运行：
      </para>
<screen>gzip -d *-backup-*sql.gz</screen>
     </step>
     <step>
      <para>
       要将数据导入数据库，请执行：
      </para>
<screen>scadb import sca-backup-*sql</screen>
     </step>
     <step>
      <para>
       如果您正在使用模式创建数据库创建自己的模式，则还要通过以下命令导入以下数据：
      </para>
<screen>sdpdb import sdp-backup-*sql</screen>
     </step>
     <step>
      <para>
       如果您正在使用自定义模式，则还要基于备份数据恢复 <filename>/usr/lib/sca/patterns/local</filename>。
      </para>
     </step>
     <step>
      <para>
       使用以下命令重新激活 SCA 设备：
      </para>
<screen>scadb reset agents</screen>
     </step>
     <step>
      <para>
       使用以下命令更新数据库中的模式模块：
      </para>
<screen>sdagent-patterns -u</screen>
     </step>
    </procedure>
   </sect3>
  </sect2>

  <sect2 xml:id="sec.admsupport.sca.patterns">
   <title>开发自定义分析模式</title>
   <para>
    SCA 设备随附了一个完整的模式开发环境（SCA 模式数据库），可让您开发自己的自定义模式。模式可用任何编程语言编写。要使这些模式可用于 supportconfig 分析过程，需要将其保存到 <filename>/usr/lib/sca/patterns/local</filename> 并使其可执行。然后，SCA 设备和 SCA 工具将会针对作为分析报告一部分的新 supportconfig 存档运行这些自定义模式。有关如何创建（和测试）自己的模式的详细说明，请参见<link xlink:href="http://www.suse.com/communities/conversations/sca-pattern-development/"/>。
   </para>
  </sect2>
 </sect1>
 <sect1 xml:id="sec.admsupport.kernel">
  <title>内核模块支持</title>

  <para>
   对于任何企业操作系统，一个重要的要求就是您获得的环境方面的支持级别。内核模块是硬件（<quote>控制器</quote>）与操作系统之间关联最密切的连接器。SUSE Linux Enterprise 中的每个内核模块都有一个 <literal>supported</literal> 标志，该标志可使用以下三个值：
  </para>

  <itemizedlist mark="bullet" spacing="normal">

   <listitem>
    <para>
     <quote>yes </quote>相当于 <literal>supported</literal>
    </para>
   </listitem>
   <listitem>
    <para>
     <quote>external</quote>，相当于 <literal>supported</literal>
    </para>
   </listitem>
   <listitem>
    <para>
     <quote/>（空白，未设置），相当于 <literal>unsupported</literal>
    </para>
   </listitem>
  </itemizedlist>

  <para>
   可以使用下列规则：
  </para>

  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>
     默认情况下，自我重新编译内核的所有模块会标记为 unsupported。
    </para>
   </listitem>
   <listitem>
    <para>
     SUSE 合作伙伴支持的内核模块以及使用 <literal>SUSE SolidDriver 程序</literal>提供的内核模块会标记为 <quote>external</quote>。
    </para>
   </listitem>
   <listitem>
    <para>
     如果未设置 <literal>supported</literal> 标志，则装载此模块会污染该内核。系统不支持污染的内核。不支持的内核模块包含在一个附加的 RPM 包 (<systemitem>kernel-<replaceable>FLAVOR</replaceable>-extra</systemitem>) 中，该包只适用于 SUSE Linux Enterprise Desktop 和 SUSE Linux Enterprise Workstation Extension。默认情况 (<replaceable>FLAVOR</replaceable>=<literal>default</literal>|<literal>xen</literal>|...) 下，不会装载这些内核。此外，安装程序中不会提供这些不支持的模块，并且 <systemitem class="resource">kernel-<replaceable>FLAVOR</replaceable>-extra</systemitem> 包也不会包含在 SUSE Linux Enterprise 媒体中。
    </para>
   </listitem>
   <listitem>
    <para>
     不是根据与 Linux 内核许可证兼容的许可证提供的内核模块也会污染内核。有关细节，请参见 <filename>/usr/src/linux/Documentation/sysctl/kernel.txt</filename> 及 <filename>/proc/sys/kernel/tainted</filename> 的状态。
    </para>
   </listitem>
  </itemizedlist>

  <sect2 xml:id="sec.admsupport.kernel.background">
   <title>技术背景</title>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>
      Linux 内核：在 SUSE Linux Enterprise <filename/>12 SP1<literal/>上，<phrase role="productnumber">/proc/sys/kernel/unsupported<phrase os="sles;sled;slerte"> 的值默认设为 </phrase>2</phrase>（<literal>装载不支持的模块时，syslog 中不发出警告</literal>）。安装程序以及已安装的系统中会使用此默认值。有关更多信息，请参见 <filename>/usr/src/linux/Documentation/sysctl/kernel.txt</filename>。
     </para>
    </listitem>
    <listitem>
     <para>
      <command>modprobe</command>：用于检查模块依赖性和装载模块的 <command>modprobe</command> 实用程序会相应地检查 <literal>supported</literal> 标志的值。如果该值为 <quote>yes</quote> 或 <quote>external</quote>，则会装载该模块，否则不会。有关如何覆盖此行为的信息，请参见<xref linkend="sec.admsupport.kernel.unsupported"/>。
     </para>
     <note>
      <para>
       SUSE 一般不支持通过 <command>modprobe -r</command> 去除储存模块。
      </para>
     </note>
    </listitem>
   </itemizedlist>
  </sect2>

  <sect2 xml:id="sec.admsupport.kernel.unsupported">
   <title>使用不支持的模块</title>
   <para>
    尽管广泛可支持性非常重要，但有时会发生需要装载不支持模块的情况（例如，要进行测试或调试，或者硬件供应商提供了热修复）。
   </para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>
      要覆盖默认行为，请编辑<filename>/etc/modprobe.d/10-unsupported-modules.conf</filename>，将变量
      <varname>allow_unsupported_modules</varname> 的值更改为 <literal>1</literal>。如果 initrd 中需要一个不支持的模块，请记得运行 <command>dracut </command><option>-f</option> 来更新 initrd。
     </para>
     <para>
      如果只想尝试装载模块一次，可将 <option>--allow-unsupported-modules</option> 选项与 <command>modprobe</command> 结合使用。有关更多信息，请参见 <command>modprobe</command> 手册页。
     </para>
    </listitem>
    <listitem>
     <para>
      在安装期间，可通过驱动程序更新磁盘添加不支持的模块，这样便会装载这些模块。要在引导过程中以及引导后强制装载不支持的模块，请使用内核命令行选项 <option>oem-modules</option>。安装和初始化 <systemitem class="resource">suse-module-tools</systemitem> 包时，系统将评估内核标志 <literal>TAINT_NO_SUPPORT</literal> (<filename>/proc/sys/kernel/tainted</filename>)。如果内核已污染，将启用 <literal>allow_unsupported_modules</literal>。这可以防止不支持的模块在安装的系统中装载失败。如果安装期间没有任何不支持的模块并且未使用其他特殊的内核命令行选项 (<option>oem-modules=1</option>)，则默认行为仍是禁止不支持的模块。
     </para>
    </listitem>
   </itemizedlist>
   <para>
    请记住，装载和运行不支持的模块会导致 SUSE 不支持该内核和整个系统。
   </para>
  </sect2>
 </sect1>
 <sect1 xml:id="sec.admsupport.moreinfo">
  <title>更多信息</title>

  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>
     <command>man supportconfig</command> — <command>supportconfig</command> 手册页。
    </para>
   </listitem>
   <listitem>
    <para>
     <command>man supportconfig.conf</command> — supportconfig 配置文件的手册页。
    </para>
   </listitem>
   <listitem>
    <para>
     <command>man scatool</command> — <command>scatool</command> 手册页。
    </para>
   </listitem>
   <listitem>
    <para>
     <command>man scadb</command> — <command>scadb</command> 手册页。
    </para>
   </listitem>
   <listitem>
    <para>
     <command>man setup-sca</command> — <command>setup-sca</command> 手册页。
    </para>
   </listitem>
   <listitem>
    <para>
     <link xlink:href="https://mariadb.com/kb/en/"/> — MariaDB 文档。
    </para>
   </listitem>
   <listitem os="sles">
    <para>
     <link xlink:href="http://httpd.apache.org/docs/"/> 和 <xref linkend="cha.apache2"/> — 有关 Apache Web 服务器的文档。
    </para>
   </listitem>
   <listitem os="sles">
    <para>
     <xref linkend="cha.ftp"/> — 有关如何设置 FTP 服务器的文档。
    </para>
   </listitem>
   <listitem>
    <para>
     <link xlink:href="http://www.suse.com/communities/conversations/sca-pattern-development/"/> — 有关如何创建（和测试）您自己的 SCA 模式的说明。
    </para>
   </listitem>
   <listitem>
    <para>
     <link xlink:href="http://www.suse.com/communities/conversations/basic-server-health-check-supportconfig/"/> — 使用 Supportconfig 的基本服务器状态检查。
    </para>
   </listitem>
   <listitem>
    <para>
     <link xlink:href="https://www.novell.com/communities/coolsolutions/cool_tools/create-your-own-supportconfig-plugin/"/> — 创建自己的 Supportconfig 插件。
    </para>
   </listitem>
   <listitem>
    <para>
     <link xlink:href="http://www.suse.com/communities/conversations/creating-a-central-supportconfig-repository/"/> — 创建中心 Supportconfig 储存库。
    </para>
    <para>
     <remark>taroth 2014-04-25: jrecord, should we still refer to the three articles above? </remark>
    </para>
   </listitem>
  </itemizedlist>
 </sect1>
</chapter>
