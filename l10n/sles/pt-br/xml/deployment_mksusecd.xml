<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="deployment_mksusecd.xml" version="5.0" role="General" xml:id="cha-deployment-prep-mksusecd">
 <title>Personalizando imagens de instalação com o mksusecd</title>
 <info>
  <abstract>
   <para>
    O <command>mksusecd</command> é uma ferramenta útil para criar uma imagem de instalação personalizada. Use-o para modificar as imagens de instalação regulares do SUSE Linux Enterprise, adicionando e removendo arquivos, criando uma imagem de instalação de rede mínima, personalizando as opções de boot e de repositório e criando uma imagem de boot mínima como uma alternativa à inicialização de um sistema por meio de um servidor PXE.
   </para>
  </abstract>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:bugtracker/>
   <dm:translation>yes</dm:translation>
  </dm:docmanager>
 </info>
 <sect1 xml:id="sec-deployment-install-mksusecd">
  <title>Instalando o mksusecd</title>

  <para>
   No SLE 15, o <command>mksusecd</command> está no <literal>Módulo Development Tools</literal>. Se você não habilitou esse módulo, deve habilitá-lo. Primeiro, encontre o nome exato do módulo e o comando de ativação <command>SUSEConnect</command> com o <command>zypper</command>:
  </para>

<screen><prompt>&gt; </prompt>zypper search-packages mksusecd
Following packages were found in following modules:

Package              Module or Repository
-------------------- -------------------------------------------------------------------
---------------------- -----------------------------------------------------------------
mksusecd             Development Tools Module (sle-module-development-tools/15.4/x86_64)
                       SUSEConnect --product sle-module-development-tools/15.4/x86_64

To activate the respective module or product, use SUSEConnect --product.
Use SUSEConnect --help for more details.</screen>

  <para>
   Use o SUSEConnect para habilitá-lo:
  </para>

<screen><prompt>&gt; </prompt><command>sudo</command> SUSEConnect --product sle-module-development-tools/15.4/x86_64</screen>

  <para>
   Instale o <command>mksusecd</command>:
  </para>

<screen><prompt>&gt; </prompt><command>sudo</command> zypper se mksusecd</screen>

  <para>
   Execute o <command>mksusecd --help</command> para ver uma lista completa de comandos.
  </para>

  <para>
   Após criar sua imagem personalizada, grave-a em um meio de CD/DVD usando o programa de gravação de disco de sua preferência, como Brasero ou <command>mybashburn</command>, ou crie uma unidade flash USB inicializável usando o comando <command>dd</command>. Certifique-se de que o dispositivo não esteja montado e execute o seguinte comando:
  </para>

<screen><prompt role="root"># </prompt><command>dd</command> if=<replaceable>min-install.iso</replaceable> of=/dev/<replaceable>SDB</replaceable> bs=4M</screen>

  <para>
   Depois disso, o novo dispositivo inicializável estará pronto para uso.
  </para>
 </sect1>
 <sect1 xml:id="sec-deployment-prep-boot-mksusecd">
  <title>Criando uma imagem de boot mínima</title>

  <para>
   Use o <command>mksusecd</command> para criar uma imagem de boot mínima para iniciar máquinas cliente de um CD/DVD ou de uma unidade flash USB, em vez de iniciá-las de um servidor de boot PXE. A imagem de boot mínima inicia o kernel e o initrd, e os arquivos de instalação restantes são buscados de um servidor NFS local (consulte a <xref linkend="sec-deployment-instserver-sles9"/>).
  </para>

  <para>
   Execute o comando a seguir para criar a imagem ISO mínima:
  </para>

<screen><prompt>&gt; </prompt><command>sudo</command> <command>mksusecd</command> --create <replaceable>min-install.iso</replaceable> \
--net=nfs://<replaceable>192.168.1.1:/srv/install/</replaceable><replaceable>ARCH</replaceable>/<replaceable>OS_VERSION</replaceable>/<replaceable>SP_VERSION</replaceable>/cd1  \
/srv/tftpboot/EFI/<replaceable>ARCH</replaceable>/boot</screen>

  <para>
   Substitua o endereço do servidor NFS pelo seu próprio. Substitua <replaceable>ARCH</replaceable> pelo diretório correspondente à arquitetura do sistema de destino. Substitua também <replaceable>OS_VERSION</replaceable> e <replaceable>SP_VERSION</replaceable> (pacote de serviço) de acordo com seus caminhos na <xref linkend="sec-deployment-instserver-sles9"/>.
  </para>



  


 </sect1>
 
 <sect1 xml:id="sec-deployment-custom-image-boot">
  <title>Definir parâmetros de boot padrão do kernel</title>

  <para>
   Em vez de aguardar um prompt de boot para inserir os parâmetros de boot personalizados do kernel, configure-os em uma imagem <command>mksusecd</command> personalizada:
  </para>

<screen><prompt>&gt; </prompt><command>sudo</command> mksusecd --create <replaceable>install.iso</replaceable> \
--boot "<replaceable>textmode=1 splash=silent mitigations=auto</replaceable>"</screen>

  <para>
   Verifique se os parâmetros personalizados foram carregados corretamente após a inicialização por meio da consulta <filename>/proc</filename>:
  </para>

<screen><prompt>&gt; </prompt>cat /proc/cmdline</screen>
 </sect1>
 <sect1 xml:id="sec-deployment-custom-modules">
  <title>Personalizando módulos, extensões e repositórios</title>

  <para>
   O SUSE Linux Enterprise 15 suporta Módulos (não os confunda com os módulos do kernel) e Extensões para componentes de produtos diferentes. Trata-se de complementos ao Basesystem padrão, como Ferramentas de Desenvolvimento, Aplicativos da Área de Serviço e SUSE Linux Enterprise Live Patching. Para obter mais informações, consulte o guia <citetitle>Modules and Extensions Quick Start</citetitle> (Inicialização Rápida aos Módulos e Extensões).
  </para>

  <para>
   Com o <command>mksusecd</command>, é possível criar uma imagem de instalação com todos os Módulos e Extensões adicionais desejados. Para começar, consulte as imagens existentes, como este exemplo para o SUSE Linux Enterprise <phrase role="productnumber"><phrase os="sles;sled">15 SP4</phrase></phrase>:
  </para>

  <screen><prompt>&gt; </prompt><command>sudo</command> mksusecd --list-repos SLE-15-SP4-Full-<replaceable>ARCH</replaceable>-GM-media1.iso
Repositories:
  SLES15-SP4 [15.4-0]
  SLES15 [15.4-0]
  Basesystem-Module [15.4-0]
  SUSE-CAP-Tools-Module [15.4-0]
  Containers-Module [15.4-0]
  Desktop-Applications-Module [15.4-0]
  Development-Tools-Module [15.4-0]
</screen>

  <para>
   Crie uma nova imagem de instalação com base nos Módulos, Extensões e repositórios selecionados e habilite-os automaticamente:
  </para>

<screen><prompt>&gt; </prompt><command>sudo</command> mksusecd --create <replaceable>myinstaller.iso</replaceable>\
  --enable-repos auto --include-repos <replaceable>Basesystem-Module,Desktop-Applications-Module</replaceable> \
  SLE-15-SP4-Online-<replaceable>ARCH</replaceable>-GM-media1.iso \
  SLE-15-SP4-Full-<replaceable>ARCH</replaceable>-GM-media1.iso
  </screen>

  <para>
   Esse procedimento cria e adiciona o arquivo <filename>add_on_products.xml</filename> à nova imagem. Substitua <command>--enable-repos auto</command> por <command>--enable-repos ask</command> para que o instalador mostre uma caixa de diálogo para a seleção dos módulos.
  </para>

  <note>
   <title>Arquivo de controle do AutoYaST</title>
   <para>
    Se você usa o AutoYaST para configurar suas instalações, não é necessário listar esses módulos no arquivo de controle do AutoYaST ao usar a opção <command>--enable-repos</command>.
   </para>
  </note>
 </sect1>
 <sect1 xml:id="sec-deployment-custom-netinstall">
  <title>Criando uma ISO mínima do netinstall</title>

  <para>
   Para criar uma imagem de instalação mínima para iniciar uma instalação de rede, use a opção <command>--nano</command>:
  </para>

<screen><prompt>&gt; </prompt><command>sudo</command> mksusecd --create <replaceable>netinstall.iso</replaceable> \
--nano SLE-15-SP4-Online-<replaceable>ARCH</replaceable>-GM-media1.iso</screen>
 </sect1>
 <sect1 xml:id="sec-deployment-custom-repo">
  <title>Mudar o repositório padrão</title>

  <para>
   Para definir um repositório diferente, como seu próprio repositório local, use a opção <command>--net</command>:
  </para>

<screen><prompt>&gt; </prompt><command>sudo</command> mksusecd --create <replaceable>localinstall.iso</replaceable> \
--net "https://example.com/local" SLE-15-SP4-Online-<replaceable>ARCH</replaceable>-GM-media1.iso</screen>
 </sect1>
</chapter>
