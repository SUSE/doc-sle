<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="troubleshooting.xml" version="5.0" xml:id="cha-trouble"> <title>Problemas comuns e suas soluções</title>
 <info>
      <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
        <dm:bugtracker/>
        <dm:translation>yes</dm:translation>
      </dm:docmanager>
    </info>
    <para>
  Este capítulo descreve uma gama de problemas em potencial e suas soluções. Mesmo se a sua situação não esteja listada aqui com precisão, poderá haver alguma semelhante que ofereça dicas para a solução do seu problema.
 </para>
 <sect1 xml:id="sec-trouble-info">
  <title>Localizando e reunindo informações</title>

  <para>
   O Linux reporta os dados de forma bastante detalhada. Há vários lugares para você pesquisar caso tenha problemas com seu sistema, sendo que a maioria é padrão para sistemas Linux em geral, e alguns relevantes aos sistemas <phrase role="productname"><phrase os="sled">SUSE Linux Enterprise Desktop</phrase></phrase>. É possível ver a maioria dos arquivos de registro com o YaST (<menuchoice>
   <guimenu> Diversos</guimenu> <guimenu> Registro de Inicialização</guimenu>
   </menuchoice>).
  </para>



  <para>
   O YaST permite coletar todas as informações de sistema necessárias à equipe de suporte. Use <menuchoice>

   <guimenu> Outros</guimenu> <guimenu> Suporte</guimenu> </menuchoice>  e selecione a categoria do problema. Quando todas as informações forem reunidas, anexe-as à sua solicitação de suporte.
  </para>

  <para>
   Veja a seguir uma lista dos arquivos de registro verificados com mais frequência com a descrição de seus objetivos principais. Os caminhos contendo <filename>~</filename> referem-se ao diretório pessoal do usuário atual.
  </para>

  <table xml:id="tab-trouble-info">
   <title>Arquivos de registro</title>
   <tgroup cols="2">
    <thead>
     <row>
      <entry>
       <para>
        Arquivo de registro
       </para>
      </entry>
      <entry>
       <para>
        Descrição
       </para>
      </entry>
     </row>
    </thead>
    <tbody>
     <row>
      <entry>
       <para>
        <filename>~/.xsession-errors</filename>
       </para>
      </entry>
      <entry>
       <para>
        Mensagens de aplicativos de área de trabalho atualmente em execução.
       </para>
      </entry>
     </row>
     <row>
      <entry>
       <para>
        <filename>/var/log/apparmor/</filename>
       </para>
      </entry>
      <entry>
       <para>
        Arquivos de registro do AppArmor, consulte a <xref linkend="part-apparmor"/> para obter informações detalhadas.
       </para>
      </entry>
     </row>
     <row>
      <entry>
       <para>
        <filename>/var/log/audit/audit.log</filename>
       </para>
      </entry>
      <entry>
       <para>
        Arquivo de registro do Audit para monitorar qualquer acesso a arquivos, diretórios ou recursos do seu sistema, bem como rastrear as chamadas do sistema. Consulte o <xref linkend="part-audit"/> para obter as informações detalhadas.
       </para>
      </entry>
     </row>

     <row>
      <entry>
       <para>
        <filename>/var/log/mail.*</filename>
       </para>
      </entry>
      <entry>
       <para>
        Mensagens do sistema de correio.
       </para>
      </entry>
     </row>
     <row>
      <entry>
       <para>
        <filename>/var/log/NetworkManager</filename>
       </para>
      </entry>
      <entry>
       <para>
        Arquivo de registro do NetworkManager para coleta de problemas de conectividade da rede
       </para>
      </entry>
     </row>
     <row>
      <entry>
       <para>
        <filename>/var/log/samba/</filename>
       </para>
      </entry>
      <entry>
       <para>
        Diretório contendo mensagens do registro de cliente e servidor do Samba.
       </para>
      </entry>
     </row>
     <row>
      <entry>
       <para>
        <filename>/var/log/warn</filename>
       </para>
      </entry>
      <entry>
       <para>
        Todas as mensagens do kernel e do daemon do registro do sistema com o nível <quote>warning</quote> ou superior.
       </para>
      </entry>
     </row>
     <row>
      <entry>
       <para>
        <filename>/var/log/wtmp</filename>
       </para>
      </entry>
      <entry>
       <para>
        Arquivo binário contendo registros de login de usuário para a sessão da máquina atual. Exiba-o com <command>last</command>.
       </para>
      </entry>
     </row>
     <row>
      <entry>
       <para>
        <filename>/var/log/Xorg.*.log</filename>
       </para>
      </entry>
      <entry>
       <para>
        Vários arquivos de registro de inicialização e tempo de execução do X Window System. São úteis para depurar inicializações malsucedidas do X.
       </para>
      </entry>
     </row>
     <row>
      <entry>
       <para>
        <filename>/var/log/YaST2/</filename>
       </para>
      </entry>
      <entry>
       <para>
        Diretório contendo ações do YaST e seus resultados.
       </para>
      </entry>
     </row>
     <row>
      <entry>
       <para>
        <filename>/var/log/zypper.log</filename>
       </para>
      </entry>
      <entry>
       <para>
        Arquivo de registro do Zypper.
       </para>
      </entry>
     </row>
    </tbody>
   </tgroup>
  </table>

  <para>
   Além dos arquivos de registro, a sua máquina também lhe fornece informações sobre o sistema em execução. Consulte a <xref linkend="tab-trouble-system" xrefstyle="select:label title nopage"/>
  </para>

  <table xml:id="tab-trouble-system">
   <title>Informações do sistema com o sistema de arquivos <filename>/proc</filename></title>
   <tgroup cols="2">
    <thead>
     <row>
      <entry>
       <para>
        Arquivo
       </para>
      </entry>
      <entry>
       <para>
        Descrição
       </para>
      </entry>
     </row>
    </thead>
    <tbody>
     <row>
      <entry>
       <para>
        <filename>/proc/cpuinfo</filename>
       </para>
      </entry>
      <entry>
       <para>
        Contém informações do processador, incluindo o seu tipo, marca, modelo e desempenho.
       </para>
      </entry>
     </row>
     <row>
      <entry>
       <para>
        <filename>/proc/dma</filename>
       </para>
      </entry>
      <entry>
       <para>
        Mostra quais canais DMA estão sendo usados no momento.
       </para>
      </entry>
     </row>
     <row>
      <entry>
       <para>
        <filename>/proc/interrupts</filename>
       </para>
      </entry>
      <entry>
       <para>
        Mostra quais interrupções estão em uso e quantas de cada foram usadas.
       </para>
      </entry>
     </row>
     <row>
      <entry>
       <para>
        <filename>/proc/iomem</filename>
       </para>
      </entry>
      <entry>
       <para>
        Exibe o status da memória de E/S (entrada/saída).
       </para>
      </entry>
     </row>
     <row>
      <entry>
       <para>
        <filename>/proc/ioports</filename>
       </para>
      </entry>
      <entry>
       <para>
        Mostra quais portas de E/S estão em uso no momento.
       </para>
      </entry>
     </row>
     <row>
      <entry>
       <para>
        <filename>/proc/meminfo</filename>
       </para>
      </entry>
      <entry>
       <para>
        Exibe o status da memória.
       </para>
      </entry>
     </row>
     <row>
      <entry>
       <para>
        <filename>/proc/modules</filename>
       </para>
      </entry>
      <entry>
       <para>
        Exibe os módulos individuais.
       </para>
      </entry>
     </row>
     <row>
      <entry>
       <para>
        <filename>/proc/mounts</filename>
       </para>
      </entry>
      <entry>
       <para>
        Exibe os dispositivos montados no momento.
       </para>
      </entry>
     </row>
     <row>
      <entry>
       <para>
        <filename>/proc/partitions</filename>
       </para>
      </entry>
      <entry>
       <para>
        Mostra o particionamento de todos os discos rígidos.
       </para>
      </entry>
     </row>
     <row>
      <entry>
       <para>
        <filename>/proc/version</filename>
       </para>
      </entry>
      <entry>
       <para>
        Exibe a versão atual do Linux.
       </para>
      </entry>
     </row>
    </tbody>
   </tgroup>
  </table>

  <para>
   Além do sistema de arquivos <filename>/proc</filename>, o kernel do Linux exporta informações com o módulo <literal>sysfs</literal>, um sistema de arquivos na memória. Esse módulo representa objetos Kernel, seus atributos e relacionamentos. Para obter mais informações sobre o <literal>sysfs</literal>, consulte o contexto de udev no <xref linkend="cha-udev"/>. A <xref linkend="tab-trouble-sysfs" xrefstyle="select:label nopage"/> contém uma visão geral dos diretórios mais comuns em <filename>/sys</filename>.
  </para>

  <table xml:id="tab-trouble-sysfs">
   <title>Informações do sistema com o sistema de arquivos <filename>/sys</filename></title>
   <tgroup cols="2">
    <thead>
     <row>
      <entry>
       <para>
        Arquivo
       </para>
      </entry>
      <entry>
       <para>
        Descrição
       </para>
      </entry>
     </row>
    </thead>
    <tbody>
     <row>
      <entry>
       <para>
        <filename>/sys/block</filename>
       </para>
      </entry>
      <entry>
       <para>
        Contém subdiretórios para cada dispositivo de bloco descoberto no sistema. Geralmente, esses dispositivos são de tipo de disco.
       </para>
      </entry>
     </row>
     <row>
      <entry>
       <para>
        <filename>/sys/bus</filename>
       </para>
      </entry>
      <entry>
       <para>
        Contém subdiretórios para cada tipo de barramento físico.
       </para>
      </entry>
     </row>
     <row>
      <entry>
       <para>
        <filename>/sys/class</filename>
       </para>
      </entry>
      <entry>
       <para>
        Contém subdiretórios agrupados como tipos funcionais de dispositivos (como gráficos, de rede, de impressora etc)
       </para>
      </entry>
     </row>
     <row>
      <entry>
       <para>
        <filename>/sys/device</filename>
       </para>
      </entry>
      <entry>
       <para>
        Contém a hierarquia global de dispositivos.
       </para>
      </entry>
     </row>
    </tbody>
   </tgroup>
  </table>

  <para>
   O Linux vem com várias ferramentas para monitoramento e análise do sistema. Consulte o <xref linkend="cha-util"/> para obter uma seleção das mais importantes usadas em diagnósticos de sistema.
  </para>

  <para>
   Cada um dos seguintes cenários começa com um cabeçalho que descreve o problema, seguido de um ou dois parágrafos apresentando sugestões para solução, referências disponíveis para consultar soluções mais detalhadas e referências cruzadas para outros cenários relacionados.
  </para>
 </sect1>

 <sect1 xml:id="sec-trouble-boot">
  <title>Problemas de boot</title>

  <para>
   Problemas de boot são situações em que o sistema não é inicializado apropriadamente (não é inicializado no destino e na tela de login esperados).
  </para>

  <sect2 xml:id="sec-trouble-boot-nogrub">
   <title>Falha ao carregar o carregador de boot GRUB 2</title>
   <para>
    Se o hardware estiver funcionando de forma adequada, é possível que o carregador de boot esteja corrompido e que o Linux não possa ser iniciado na máquina. Neste caso, é necessário consertar o carregador de boot. Para isso, é necessário iniciar o Sistema de Recuperação conforme descrito na <xref linkend="sec-trouble-data-recover-rescue"/> e seguir as instruções na <xref linkend="sec-trouble-data-recover-rescue-grub"/>.
   </para>
   <para>
    Você também pode usar o Sistema de Recuperação para corrigir o carregador de boot da maneira a seguir. Inicialize a máquina da mídia de instalação. Na tela de boot, escolha <menuchoice><guimenu>Mais</guimenu> <guimenu> Inicializar Sistema Linux</guimenu></menuchoice>. Selecione o disco que contém o sistema instalado e o kernel com as opções de kernel padrão.
   </para>

   

   <para>
    Quando o sistema for inicializado, inicie o YaST e alterne para <menuchoice><guimenu>Sistema</guimenu> <guimenu> Carregador de boot</guimenu></menuchoice>. Verifique se a opção <guimenu>Gravar Código de Boot genérico no MBR</guimenu> está habilitada e clique em <guimenu>OK</guimenu>. Esse procedimento corrige o carregador de boot corrompido sobregravando-o ou instala-o, se estiver ausente.
   </para>

   <para>
    Outros motivos para a máquina não inicializar podem estar relacionadas ao BIOS:
   </para>
   <variablelist>
    <varlistentry>
     <term>Configurações do BIOS</term>
     <listitem>
      <para>
       Verifique o BIOS para obter referências sobre o disco rígido. O GRUB 2 pode não ser iniciado simplesmente porque o próprio disco rígido não foi encontrado com as configurações atuais do BIOS.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>Ordem de boot do BIOS</term>
     <listitem>
      <para>
       Verifique se a ordem de inicialização do sistema inclui o disco rígido. Se a opção do disco rígido não tiver sido habilitada, o sistema talvez seja instalado de forma adequada, mas não seja inicializado quando o acesso ao disco rígido for necessário.
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
  </sect2>

  <sect2 xml:id="sec-trouble-boot-hang" os="sled;osuse">
   <title>Não é exibido nenhum prompt nem tela de login</title>
   <para>
    Isso costuma ocorrer após uma falha de atualização do kernel e é conhecido como <emphasis>pânico do kernel</emphasis> devido ao tipo de erro do console do sistema que às vezes se verifica no estágio final do processo. Se a máquina realmente tiver sido reinicializada após uma atualização de software, o objetivo imediato é reinicializá-la usando a versão antiga e segura do kernel do Linux e os arquivos associados. Isso pode ser feito na tela do carregador de boot GRUB 2 durante o processo de boot da seguinte forma:
   </para>
   <procedure>
    <step>
     <para>
      Reinicialize o computador usando o botão de reinicialização ou desligue-o e ligue-o novamente.
     </para>
    </step>
    <step>
     <para>
      Quando a tela de boot do GRUB 2 for exibida, selecione a entrada <guimenu>Opções Avançadas</guimenu> e escolha o kernel anterior no menu. A máquina será inicializada com a versão anterior do kernel e seus arquivos associados.
     </para>
    </step>
    <step xml:id="st-trouble-boot-hang-modify-grub">
     <para>
      Após a conclusão do processo de boot, remova o kernel recém-instalado e, se necessário, defina a entrada de boot padrão como o kernel antigo usando o módulo <guimenu>Carregador de Boot</guimenu> do YaST. Para obter mais informações, consulte <xref linkend="sec-grub2-yast2-config"/>. No entanto, isso talvez não seja necessário porque as ferramentas automatizadas de atualização normalmente o modificam durante o processo de rollback.
     </para>
    </step>
    <step>
     <para>
      Reinicialize.
     </para>
    </step>
   </procedure>
   <para>
    Se isso não resolver o problema, inicialize o computador usando a mídia de instalação. Após a inicialização da máquina, prossiga com o <xref linkend="st-trouble-boot-hang-modify-grub" xrefstyle="StepOnPage"/>.
   </para>
  </sect2>

  <sect2 xml:id="sec-trouble-boot-prompt">
   <title>Não há login gráfico</title>
   <para>
    Se a máquina ligar, mas não for inicializada no gerenciador de login gráfico, evite problemas com a opção de destino do systemd padrão ou com a configuração do X Window System. Para verificar o destino padrão atual do systemd, execute o comando <command>sudo systemctl get-default</command>. Se o valor retornado <emphasis>não</emphasis>
    <literal> for graphical.target</literal>, execute o comando <command>sudo systemctl isolate graphical.target</command>. Se a tela gráfica de login for iniciada, efetue login e inicie o <menuchoice> <guimenu> YaST</guimenu>
    <guimenu> Sistema</guimenu> <guimenu> Services Manager</guimenu></menuchoice> (Gerenciador de Serviços) e defina o <guimenu>Default System Target</guimenu> (Destino do Sistema Padrão) como <guimenu>Graphical Interface</guimenu> (Interface Gráfica). De agora em diante, o sistema deverá ser inicializado na tela gráfica de login.
   </para>
   <para>
    Se a tela gráfica de login não for iniciada mesmo depois de ter sido inicializada ou alternada para o destino gráfico, a área de trabalho ou o software do X Window provavelmente foi mal configurado ou estava corrompido. Examine os arquivos de registro em <filename>/var/log/Xorg.*.log</filename> para ver as mensagens detalhadas do servidor X enquanto ele tentava iniciar. Se a área de trabalho falhar durante a inicialização, talvez ela registre mensagens de erro no diário do sistema que possam ser consultadas com o comando <command>journalctl</command> (consulte o <xref linkend="cha-journalctl"/> para obter mais informações). Se essas mensagens de erro sugerirem um problema de configuração no servidor X, tente corrigi-lo. Se o sistema gráfico ainda não aparecer, reinstale a área de trabalho gráfica.
   </para>

  </sect2>

  <sect2 xml:id="sec-trouble-boot-btrfs">
   <title>Não é possível montar a partição Btrfs raiz</title>
   <para>
    Se uma partição <systemitem class="filesystem">btrfs</systemitem> raiz for corrompida, tente as seguintes opções:
   </para>
   <itemizedlist>
    <listitem>
     <para>
      Monte a partição com a opção <option>-o recovery</option>.
     </para>
    </listitem>
    <listitem>
     <remark>toms 2014-03-12: According to FATE#315126: "this one is open to
      debate, it might do more harm than good.."</remark>
     <para>
      Se isso não funcionar, execute <command>btrfs-zero-log</command> na partição raiz.
     </para>
    </listitem>
   </itemizedlist>
  </sect2>

  <sect2 xml:id="sec-trouble-boot-forcecheck">
   <title>Forçar verificação de partições raiz</title>
   <remark>toms 2016-05-18: FATE#320126</remark>
   <para>
    Se a partição raiz for corrompida, use o parâmetro <parameter>forcefsck</parameter> no prompt de boot. Esse procedimento passa a opção <option>-f</option> (forçar) para o comando <command>fsck</command>.
   </para>
  </sect2>
  
  <sect2 xml:id="sec-trouble-boot-disable-swap">
      <title>Desabilitar a troca (swap) para habilitar a inicialização</title>
      <para>
          Quando um dispositivo de troca não está disponível e o sistema não consegue habilitá-lo durante a inicialização, pode haver falha na inicialização. Tente desabilitar todos os dispositivos de troca anexando as seguintes opções à linha de comando do kernel:
      </para>
      <screen>systemd.device_wants_unit=off systemd.mask=swap.target</screen>
      <para>
          Você também pode tentar desabilitar dispositivos de troca específicos:
      </para>
      <screen>systemd.mask=dev-sda1.swap</screen>
  </sect2>
  
  <sect2 xml:id="sec-trouble-boot-dual-boot">
   <title>O <productname>GRUB 2</productname> falha durante a reinicialização em um sistema de boot duplo</title>
   <remark>jufa 2021-06-09: bsc#1185274</remark>
   <para>
    Se o <productname>GRUB 2</productname> falhar durante a reinicialização, desabilite a configuração <option>Fast Boot</option> no BIOS.
     </para>
   
  </sect2>
 </sect1>
 
 <sect1 xml:id="sec-trouble-login">
  <title>Problemas de login</title>

  <para>
   Há problemas de login quando sua máquina é inicializada na tela de boas-vindas ou no prompt de login esperados, mas se recusa a aceitar o nome de usuário e a senha ou os aceita mas não se comporta apropriadamente (não inicia a área de trabalho gráfica, produz erros, passa para uma linha de comando, etc).
  </para>

  <sect2 xml:id="sec-trouble-login-no">
   <title>Falha nas combinações de nome de usuário e senha válidas</title>
   <para>
    Isso geralmente ocorre quando o sistema está configurado para usar autenticação de rede ou serviços de diretório e, por algum motivo, não pode recuperar os resultados de seus servidores configurados. O usuário <systemitem class="username">root</systemitem>, como o único usuário local, é o único que ainda pode efetuar login nessas máquinas. Veja a seguir alguns motivos comuns para uma máquina parecer funcional, mas não conseguir processar logins corretamente:
   </para>
   <itemizedlist>
    <listitem>
     <para>
      A rede não está funcionando. Para obter mais instruções sobre isso, consulte a <xref linkend="sec-trouble-netconfig"/>.
     </para>
    </listitem>
    <listitem>
     <para>
      O DNS não está funcionando no momento (o que impede o GNOME de trabalhar e o sistema de efetuar solicitações válidas a servidores seguros). Uma indicação de que esse é o caso é que a máquina leva muito tempo para responder a qualquer ação. Há mais informações a respeito desse tópico na <xref linkend="sec-trouble-netconfig"/>.
     </para>
    </listitem>
    <listitem>
     <para>
      Se o sistema estiver configurado para usar Kerberos, o horário local do sistema poderá ter ultrapassado a variação aceita com o horário do servidor Kerberos (geralmente 300 segundos). Se o NTP (protocolo de horário de rede) não estiver funcionando de forma adequada ou os servidores NTP locais não estiverem funcionando, a autenticação do Kerberos não funcionará pois depende da sincronização comum do relógio na rede.
     </para>
    </listitem>
    <listitem>
     <para>
      A configuração de autenticação do sistema está definida incorretamente. Verifique se há erros de digitação ou ordem incorreta de diretivas nos arquivos de configuração PAM envolvidos. Para obter informações adicionais sobre o PAM e a sintaxe dos arquivos de configuração envolvidos, consulte o <xref linkend="cha-pam"/>.
     </para>
    </listitem>
    <listitem>
     <para>
      A partição pessoal está criptografada. Há mais informações a respeito desse tópico na <xref linkend="sec-trouble-login-encrypted"/>.
     </para>
    </listitem>
   </itemizedlist>
   <para>
    Em todos os casos que não envolvem problemas de rede externos, a solução é reinicializar o sistema em um modo de usuário único e reparar a configuração antes de inicializar novamente no modo de operação e tentar efetuar login novamente. Para inicializar no modo de usuário único:
   </para>
   <procedure xml:id="proc-trouble-login-no">
    <step>
     <para>
      Reinicialize o sistema. A tela de boot é exibida e apresenta um prompt.
     </para>
    </step>

    <step>
     <para>
      Pressione <keycap function="escape"/> para sair da splash screen e entrar no menu baseado em texto do GRUB 2.
     </para>
    </step>
    <step>
     <para>
      Pressione <keycap>B</keycap> para entrar no editor do GRUB 2.
     </para>
    </step>
    <step>
     <para>
      Adicione o seguinte parâmetro à linha com os parâmetros do kernel:
     </para>
<screen>systemd.unit=rescue.target</screen>
    </step>
    <step>
     <para>
      Pressione <keycap>F10</keycap>.
     </para>
    </step>
    <step>
     <para>
      Digite o nome de usuário e a senha de <systemitem class="username">root</systemitem>.
     </para>
    </step>
    <step>
     <para>
      Faça as mudanças necessárias.
     </para>
    </step>
    <step>
     <para>
      Inicialize no modo completo multiusuário e de rede inserindo <command>systemctl isolate graphical.target</command> na linha de comando.
     </para>
    </step>
   </procedure>
  </sect2>

  <sect2 xml:id="sec-trouble-login-pw">
   <title>Nome de usuário e senha válidos que não são aceitos</title>
   <para>
    Esse é o um dos problemas mais comuns que os usuários podem encontrar, pois há vários motivos pelos quais isso pode ocorrer. Dependendo de você usar gerenciamento e autenticação de usuário local ou autenticação em rede, as falhas de login ocorrem por motivos diferentes.
   </para>
   <para>
    O gerenciamento de usuário local pode falhar pelos seguintes motivos:
   </para>
   <itemizedlist>
    <listitem>
     <para>
      O usuário pode ter digitado a senha errada.
     </para>
    </listitem>
    <listitem>
     <para>
      O diretório pessoal do usuário que contém arquivos de configuração da área de trabalho está corrompido ou protegido contra gravação.
     </para>
    </listitem>
    <listitem>
     <para>
      Talvez haja problemas com o sistema X Window ao autenticar esse usuário específico, especialmente se o diretório pessoal do usuário tiver sido usado com outra distribuição do Linux antes da instalação da atual.
     </para>
    </listitem>
   </itemizedlist>
   <para>
    Para encontrar o motivo de uma falha de login local, proceda da seguinte maneira:
   </para>
   <procedure>
    <step>
     <para>
      Verifique se o usuário memorizou a senha corretamente antes de começar a depurar todo o mecanismo de autenticação. Se o usuário não se lembrar da senha correta, use o módulo Gerenciamento de Usuário do YaST para mudar a senha dele. Fique atento à tecla <keycap>Caps Lock</keycap> e libere-a, se necessário.
     </para>
    </step>
    <step>
     <para>
      Efetue login como <systemitem class="username">root</systemitem> e consulte o diário do sistema com o comando <command>journalctl -e</command> para verificar se há mensagens de erro do processo de login e do PAM.
     </para>
    </step>
    <step>
     <para>
      Tente efetuar login de um console (usando <keycombo>
      <keycap function="control"/> <keycap function="alt"/> <keycap>   F1</keycap>
      </keycombo>). Se esse procedimento for bem-sucedido, não será responsabilidade do PAM, pois é possível autenticar o usuário nessa máquina. Tente localizar quaisquer problemas com o X Window System ou com a área de trabalho do GNOME. Para obter mais informações, consulte a <xref linkend="sec-trouble-login-dk"/>.
     </para>
    </step>
    <step>
     <para>
      Se o diretório pessoal do usuário foi usado com outra distribuição Linux, remova o arquivo <filename>Xauthority</filename> no diretório do usuário. Use um login de console por meio de <keycombo>
      <keycap function="control"/> <keycap function="alt"/> <keycap>   F1</keycap>
      </keycombo>  e execute <command>rm .Xauthority</command> como esse usuário. Isso deve eliminar problemas de autenticação X para o usuário. Tente o login gráfico novamente.
     </para>
    </step>

    <step>
     <para>
      Se não for possível iniciar a área de trabalho devido a arquivos de configuração corrompidos, continue na <xref linkend="sec-trouble-login-dk"/>.
     </para>
    </step>
   </procedure>
   <para>
    Veja a seguir a lista dos motivos comuns de possível falha na autenticação de rede de um usuário específico em determinada máquina:
   </para>
   <itemizedlist>
    <listitem>
     <para>
      O usuário pode ter digitado a senha errada.
     </para>
    </listitem>
    <listitem>
     <para>
      O nome de usuário existe nos arquivos de autenticação locais da máquina e também são fornecidos por um sistema de autenticação de rede, gerando conflitos.
     </para>
    </listitem>
    <listitem>
     <para>
      O diretório pessoal existe mas está corrompido ou não disponível. Talvez ele esteja protegido contra gravação ou está em um servidor inacessível no momento.
     </para>
    </listitem>
    <listitem>
     <para>
      O usuário não tem permissão para efetuar login neste host específico no sistema de autenticação.
     </para>
    </listitem>
    <listitem>
     <para>
      A máquina mudou os nomes de host, por algum motivo, e o usuário não tem permissão para efetuar login nesse host.
     </para>
    </listitem>
    <listitem>
     <para>
      A máquina não pode acessar o servidor de diretório ou o servidor de autenticação que contém as informações do usuário.
     </para>
    </listitem>
    <listitem>
     <para>
      Talvez haja problemas com o sistema X Window ao autenticar esse usuário específico, especialmente se o diretório pessoal do usuário tiver sido usado com outra distribuição do Linux antes da instalação da atual.
     </para>
    </listitem>
   </itemizedlist>
   <para>
    Para localizar a causa das falhas de login com a autenticação de rede, proceda da seguinte maneira:
   </para>
   <procedure xml:id="proc-trouble-login-pw">
    <step>
     <para>
      Verifique se o usuário memorizou a senha corretamente antes de começar a depurar todo o mecanismo de autenticação.
     </para>
    </step>
    <step>
     <para>
      Determine o servidor de diretórios usado pela máquina para autenticação e verifique se ele está funcionando e se comunicando corretamente com as outras máquinas.
     </para>
    </step>
    <step>
     <para>
      Determine se o nome e a senha do usuário funcionam em outras máquinas para verificar se os dados de autenticação existem e são distribuídos apropriadamente.
     </para>
    </step>
    <step>
     <para>
      Verifique se outro usuário pode efetuar login na máquina com comportamento incorreto. Se outro usuário ou o usuário <systemitem class="username">root</systemitem> puder efetuar login sem dificuldade, efetue login e examine o diário do sistema com o comando <command>journalctl -e</command>&gt; arquivo. Localize as marcações de horário que correspondem às tentativas de login e determine se o PAM produziu alguma mensagem de erro.
     </para>
    </step>
    <step>
     <para>
      Tente efetuar login de um console (usando <keycombo>
      <keycap function="control"/> <keycap function="alt"/> <keycap>   F1</keycap>
      </keycombo>). Se der certo, o problema não é do PAM ou do servidor de diretórios no qual o diretório pessoal do usuário está hospedado, pois é possível autenticar o usuário nessa máquina. Tente localizar quaisquer problemas com o X Window System ou com a área de trabalho do GNOME. Para obter mais informações, consulte a <xref linkend="sec-trouble-login-dk"/>.
     </para>
    </step>
    <step>
     <para>
      Se o diretório pessoal do usuário foi usado com outra distribuição Linux, remova o arquivo <filename>Xauthority</filename> no diretório do usuário. Use um login de console por meio de <keycombo>
      <keycap function="control"/> <keycap function="alt"/> <keycap>   F1</keycap>
      </keycombo>  e execute <command>rm .Xauthority</command> como esse usuário. Isso deve eliminar problemas de autenticação X para o usuário. Tente o login gráfico novamente.
     </para>
    </step>

    <step>
     <para>
      Se não for possível iniciar a área de trabalho devido a arquivos de configuração corrompidos, continue na <xref linkend="sec-trouble-login-dk"/>.
     </para>
    </step>
   </procedure>
  </sect2>

  <sect2 xml:id="sec-trouble-login-encrypted">
   <title>Falha de login na partição pessoal criptografada</title>
   <para>
    Recomenda-se o uso de uma partição pessoal criptografada para laptops. Se você não puder efetuar login no seu laptop, o motivo geralmente é simples: a sua partição pode não estar desbloqueada.
   </para>
   <para>
    Durante a inicialização, é necessário digitar a frase secreta para desbloquear a partição criptografada. Se você não a digitar, o processo de boot continuará, deixando a partição bloqueada.
   </para>
   <para>
    Para desbloquear a partição criptografada, faça o seguinte:
   </para>
   <procedure>
    <step>
     <para>
      Passe para o console de texto com <keycombo> <keycap function="control"/>
      <keycap function="alt"/> <keycap>   F1</keycap> </keycombo>.
     </para>
    </step>
    <step>
     <para>
      Torne-se <systemitem class="username">root</systemitem>.
     </para>
    </step>
    <step>
     <para>
      Reinicie o processo de desbloqueio novamente com:
     </para>
<screen><prompt role="root">root # </prompt>systemctl restart home.mount</screen>
    </step>
    <step>
     <para>
      Digite sua frase secreta para desbloquear a partição criptografada.
     </para>
    </step>
    <step>
     <para>
      Saia do console de texto e volte para a tela de login com <keycombo>
      <keycap function="alt"/> <keycap>  F7</keycap> </keycombo>.
     </para>
    </step>
    <step>
     <para>
      Efetue login como de costume.
     </para>
    </step>
   </procedure>
  </sect2>

  <sect2 xml:id="sec-trouble-login-dk">
   <title>A área de trabalho do GNOME tem problemas</title>
   <para>
     Se você tiver problemas com a área de trabalho do GNOME, há várias maneiras de solucioná-los no ambiente gráfico da área de trabalho. O procedimento recomendado descrito abaixo oferece a opção mais segura para corrigir uma área de trabalho do GNOME com problema.
   </para>
   <procedure>
     <title>Solucionando problemas do GNOME</title>
     <step>
       <para>
	 Inicie o YaST e alterne para <guimenu>Segurança e usuários</guimenu>.
       </para>
     </step>
     <step>
       <para>
	 Abra a caixa de diálogo <guimenu>Gerenciamento de usuários e grupos</guimenu> e clique em <guimenu>Adicionar</guimenu>.
       </para>
     </step>
     <step>
       <para>
	 Preencha os campos obrigatórios e clique em <guimenu>OK</guimenu> para criar um usuário.
       </para>
     </step>
     <step>
       <para>
	 Efetue logout e login como o novo usuário. Isso gera um novo ambiente do GNOME.
       </para>
     </step>
     <step>
       <para>
	 Copie os subdiretórios individuais dos diretórios <filename>~/.local/</filename> e <filename>~/.config/</filename> da conta do usuário antiga para os respectivos diretórios da nova conta do usuário.
       </para>
       <para>
	 Efetue logout e login novamente como o novo usuário após cada operação de cópia para verificar se o GNOME ainda funciona corretamente.
       </para>
     </step>
     <step>
       <para>
	 Repita a etapa anterior até encontrar o arquivo de configuração que provoca o erro no GNOME.
       </para>
     </step>
     <step>
       <para>
	 Efetue login como o usuário antigo e mova o arquivo de configuração inválido para um local diferente. Efetue logout e login novamente como o usuário antigo.
       </para>
     </step>
     <step>
       <para>
	 Apague o usuário criado anteriormente.
       </para>
     </step>
   </procedure>
  </sect2>

 </sect1>
 <sect1 xml:id="sec-trouble-netconfig">
  <title>Problemas de rede</title>

  <para>
   Quaisquer problemas do seu sistema podem estar relacionados à rede, mesmo que inicialmente não transmitam essa impressão. Por exemplo, o motivo para um sistema não permitir o login de usuários pode ser algum tipo de problema de rede. Esta seção apresenta uma lista de verificação simples que você pode aplicar para identificar a causa de qualquer problema de rede encontrado.
  </para>

  <procedure xml:id="proc-trouble-config-net">
   <title>Como identificar problemas de rede</title>
   <para>
    Ao verificar a conexão de rede da sua máquina, proceda da seguinte maneira:
   </para>
   <step>
    <para>
     Se você usa uma conexão Ethernet, verifique o hardware primeiro. Verifique se o cabo de rede está acoplado corretamente no computador e no roteador (ou hub etc). As luzes de controle próximas ao seu conector Ethernet normalmente estão ativas.
    </para>
    <para>
     Se a conexão falhar, verifique se o cabo de rede funciona com outra máquina. Se funcionar, a placa de rede será a causa da falha. Se houver hubs ou switches incluídos na configuração da sua rede, eles também podem estar com defeito.
    </para>
   </step>
   <step>
    <para>
     Se estiver usando uma conexão sem fio, verifique se o link sem fio pode ser estabelecido por outras máquinas. Do contrário, contate o administrador da rede wireless.
    </para>
   </step>
   <step>
    <para>
     Após verificar sua conectividade de rede básica, tente descobrir qual serviço não está respondendo. Reúna as informações de endereço de todos os servidores de rede necessários na configuração. Procure-os no módulo YaST apropriado ou consulte o administrador de sistema. A lista a seguir mostra alguns servidores de rede típicos envolvidos em uma configuração juntamente com os sintomas de uma interrupção.
    </para>
    <variablelist>
     <varlistentry>
      <term>DNS (serviço de nomes)</term>
      <listitem>
       <para>
        Um serviço de nomes inoperante ou defeituoso afeta a funcionalidade da rede de várias maneiras. Se a máquina local depender de quaisquer servidores de rede para autenticação e esses servidores não forem encontrados devido a problemas de resolução de nome, os usuários não poderão nem efetuar login. As máquinas na rede gerenciadas por um servidor de nomes com defeito não podem <quote>ver</quote> umas às outras nem se comunicar.
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>NTP (serviço de horário)</term>
      <listitem>
       <para>
        Um serviço NTP defeituoso ou totalmente inoperante pode afetar a funcionalidade do servidor X e a autenticação Kerberos.
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>NFS (serviço de arquivos)</term>
      <listitem>
       <para>
        Se qualquer aplicativo precisar de dados armazenados em um diretório NFS montado, ele não poderá ser iniciado nem funcionar apropriadamente se esse serviço estiver inoperante ou mal configurado. No pior cenário possível, a configuração da área de trabalho pessoal de um usuário não será exibida se o seu diretório pessoal que contém o subdiretório <filename>.gconf</filename> não for encontrado por causa de um servidor NFS defeituoso.
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>Samba (serviço de arquivos)</term>
      <listitem>
       <para>
        Se qualquer aplicativo precisar de dados armazenados em um diretório em um servidor Samba defeituoso, ele não poderá ser iniciado nem funcionar apropriadamente.
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>NIS (gerenciamento de usuários)</term>
      <listitem>
       <para>
        Se o sistema <phrase role="productname"><phrase os="sled">SUSE Linux Enterprise Desktop</phrase></phrase> usar um servidor NIS defeituoso para fornecer os dados dos usuários, os usuários não poderão efetuar login na máquina.
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>LDAP (gerenciamento de usuários)</term>
      <listitem>
       <para>
        Se o sistema <phrase role="productname"><phrase os="sled">SUSE Linux Enterprise Desktop</phrase></phrase> usar um servidor LDAP defeituoso para fornecer os dados dos usuários, os usuários não poderão efetuar login na máquina.
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>Kerberos (autenticação)</term>
      <listitem>
       <para>
        A autenticação não funcionará e o login em qualquer máquina falhará.
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>CUPS (impressão de rede)</term>
      <listitem>
       <para>
        Os usuários não conseguem imprimir.
       </para>
      </listitem>
     </varlistentry>
    </variablelist>
   </step>
   <step>
    <para>
     Verifique se os servidores de rede estão em execução e se a configuração de rede permite estabelecer uma conexão:
    </para>
    <important>
     <title>Limitações</title>
     <para>
      O procedimento de depuração descrito abaixo aplica-se somente a uma configuração simples de servidor/cliente de rede que não envolva roteamento interno. Supõe-se que o servidor e o cliente integrem a mesma sub-rede sem necessidade de roteamento adicional.
     </para>
    </important>
    <substeps performance="required">
     <step>
      <para>
       Use <command>ping</command>
       <replaceable>ENDEREÇO_IP/NOMEDEHOST</replaceable> (substitua pelo nome de host ou endereço IP do servidor) para verificar se cada um deles está ativo e respondendo à rede. Se esse comando for bem-sucedido, ele informará que o host que você estava procurando está em execução e o serviço de nomes da rede está configurado corretamente.
      </para>
      <para>
       Se o ping falhar com <literal>destination host unreachable</literal>, o seu sistema ou o servidor desejado não está configurado de forma adequada ou está inoperante. Verifique se o seu sistema está acessível executando <command>ping</command> <replaceable>endereço IP</replaceable> ou <replaceable>SEU_NOMEDEHOST</replaceable> de outra máquina. Se você conseguir acessar a sua máquina de outra máquina, significa que o servidor não está em execução ou não foi configurado corretamente.
      </para>
      <para>
       Se o ping falhar com <literal>unknown host</literal> (host desconhecido), o serviço de nomes não foi configurado corretamente ou o nome de host usado estava incorreto. Para obter mais verificações sobre esse assunto, consulte a <xref linkend="st-trouble-config-net-host" xrefstyle="StepOnPage"/>. Se o ping ainda falhar, significará que a placa de rede não está configurada de forma correta ou o hardware de rede está defeituoso.
      </para>
     </step>
     <step xml:id="st-trouble-config-net-host">
      <para>
       Use <command>host</command> <replaceable>NOMEDEHOST</replaceable> para verificar se o nome de host do servidor ao qual você está tentando se conectar foi apropriadamente convertido em um endereço IP e vice-versa. Se esse comando retornar o endereço IP do host, significará que o serviço de nomes está funcionando. Se houver falha nesse comando <command>host</command>, verifique todos os arquivos de configuração de rede relacionados à resolução de nomes e de endereços no seu host:
      </para>
      <variablelist>
       <varlistentry>
        <term><filename>/var/run/netconfig/resolv.conf</filename>
        </term>
        <listitem>
         <para>
          Este arquivo é usado para controlar o domínio e o servidor de nomes que você está usando no momento. Ele é um link simbólico para <filename>/run/netconfig/resolv.conf</filename> e costuma ser ajustado automaticamente pelo YaST ou DHCP. Verifique se esse arquivo tem a estrutura a seguir e se todos os endereços de rede e nomes de domínio estão corretos:
         </para>
<screen>search <replaceable>FULLY_QUALIFIED_DOMAIN_NAME</replaceable>
nameserver <replaceable>IPADDRESS_OF_NAMESERVER</replaceable></screen>
         <para>
          Este arquivo pode conter mais de um endereço de servidor de nomes, mas pelo menos um deles deve estar correto para fornecer a resolução de nomes para o seu host. Se necessário, ajuste o arquivo usando o módulo Configurações de Rede do YaST (guia Nome de host/DNS).
         </para>
         <para>
          Se sua conexão de rede é executada por DHCP, habilite o DHCP para mudar o nome de host e as informações de serviço de nomes selecionando <guimenu>Definir nome de host via DHCP</guimenu> (pode ser definido globalmente para qualquer interface ou por interface) e <guimenu>Atualizar Servidores de Nomes e Lista de Pesquisa via DHCP</guimenu> no módulo Configurações de Rede do YaST (guia Nome de host/DNS).
         </para>
        </listitem>
       </varlistentry>
       <varlistentry>
        <term><filename>/etc/nsswitch.conf</filename>
        </term>
        <listitem>
         <para>
          Este arquivo informa ao Linux onde procurar informações de serviço de nomes. Ele deve ter a seguinte aparência:
         </para>
<screen> ...
hosts: files dns
networks: files dns
...</screen>
         <para>
          A entrada <option>dns</option> é essencial. Ela informa ao Linux para usar um servidor de nomes externo. Normalmente, essas entradas são gerenciadas automaticamente pelo YaST, mas convém verificar.
         </para>
         <para>
          Se todas as entradas relevantes no host estiverem corretas, deixe o seu administrador de sistema verificar a configuração do servidor DNS para obter as informações de zona corretas. Se você verificou se a configuração DNS do seu host e o servidor DNS estão corretos, continue verificando a configuração da rede e do dispositivo de rede.
         </para>
        </listitem>
       </varlistentry>
      </variablelist>
     </step>
     <step>
      <para>
       Se o sistema não puder estabelecer uma conexão a um servidor de redes e você excluiu problemas de serviço de nomes da lista de possíveis responsáveis, verifique a configuração da placa de rede.
      </para>
      <para>
       Use o comando <command>ip addr show</command>
       <replaceable>DISPOSITIVO_DE_REDE</replaceable> para verificar se esse dispositivo foi configurado apropriadamente. Verifique se o <option>endereço inet</option> com a máscara de rede (<literal>/<replaceable>MÁSCARA</replaceable></literal>) está corretamente configurado. Um erro no endereço IP ou um bit ausente na máscara de rede inutilizam a configuração de rede. Se necessário, execute essa verificação no servidor também.
      </para>
     </step>
     <step>
      <para>
       Se o hardware de rede e o serviço de nomes estiverem configurados apropriadamente e em execução, mas algumas conexões de rede externas ainda tiverem longos tempos de espera ou falharem totalmente, use <command>traceroute</command>
       <replaceable>NOME_DE_DOMÍNIO_COMPLETO_E_QUALIFICADO</replaceable> (executado como <systemitem class="username">root</systemitem>) para controlar a rota de rede tomada pelas solicitações. Esse comando lista qualquer gateway (hop) que uma solicitação da sua máquina transmitir no caminho ao seu destino. Ele lista o tempo de resposta de cada salto e se esse salto é acessível. Use uma combinação de traceroute e ping para identificar o responsável e informar aos administradores.
      </para>
     </step>
    </substeps>
   </step>
  </procedure>

  <para>
   Após identificar a causa do problema de rede, você mesmo poderá resolvê-lo (se o problema estiver na sua máquina) ou informar os administradores do sistema da rede sobre suas descobertas para que eles possam reconfigurar os serviços ou reparar os sistemas necessários.
  </para>

  <sect2 xml:id="sec-trouble-networkmanager">
   <title>Problemas no NetworkManager</title>
   <remark>This is a bit small, needs more text.</remark>
   <para>
    Se você tiver problema com a conectividade da rede, restrinja-a conforme descrito no <xref linkend="proc-trouble-config-net"/>. Se tudo indicar que a culpa é do NetworkManager, faça o seguinte para obter os registros com dicas sobre o motivo da falha do NetworkManager:
   </para>
   <procedure>
    <step>
     <para>
      Abra um shell e efetue login como <systemitem class="username">root</systemitem>.
     </para>
    </step>
    <step>
     <para>
      Reinicie o NetworkManager:
     </para>
<screen><prompt>tux &gt; </prompt><command>sudo</command> systemctl restart NetworkManager</screen>
    </step>
    <step>
     <para>
      Abra uma página da Web, por exemplo <link xlink:href="http://www.opensuse.org"/>, como usuário normal para ver se você consegue se conectar.
     </para>
    </step>
    <step>
     <para>
      Colete as informações sobre o estado do NetworkManager em <filename>/var/log/NetworkManager</filename>.
     </para>
    </step>
   </procedure>
   <para>
    Para obter maiores informações sobre o NetworkManager, consulte o <xref linkend="cha-nm"/>.
   </para>
  </sect2>
 </sect1>
 <sect1 xml:id="sec-trouble-data">
  <title>Problemas de dados</title>

  <para>
   Problemas de dados ocorrem quando a máquina pode ou não inicializar corretamente, mas em ambos os casos, está claro que há dados corrompidos no sistema e que o sistema precisa ser recuperado. Essas situações exigem um backup dos seus dados críticos, permitindo que você recupere o estado anterior à falha do sistema.
  </para>

  <sect2 xml:id="sec-trouble-data-partitions">
   <title>Gerenciando imagens de partição</title>
   <para>
    Às vezes é necessário fazer um backup de uma partição inteira ou até do disco rígido. O Linux possui a ferramenta <command>dd</command>, capaz de criar uma cópia exata do seu disco. Combinada ao <command>gzip</command>, faz você economizar espaço.
   </para>
   <procedure>
    <title>Fazendo backup e restaurando discos rígidos</title>
    <step>
     <para>
      Inicie um Shell como usuário <systemitem class="username">root</systemitem>.
     </para>
    </step>
    <step>
     <para>
      Selecione o seu dispositivo de origem. Normalmente, ele assemelha-se a <filename>/dev/sda</filename> (com a etiqueta <replaceable>SOURCE</replaceable>).
     </para>
    </step>
    <step>
     <para>
      Indique onde deseja armazenar sua imagem (com a etiqueta <replaceable>CAMINHO_BACKUP</replaceable>). Esse local deverá ser diferente do dispositivo de origem. Em outras palavras: se você fizer backup de <filename>/dev/sda</filename>, seu arquivo de imagem poderá não ser armazenado em <filename>/dev/sda</filename>.
     </para>
    </step>
    <step>
     <para>
      Execute os comandos para criar um arquivo de imagem compactado:
     </para>
<screen><prompt role="root">root # </prompt>dd if=/dev/<replaceable>SOURCE</replaceable> | gzip &gt; /<replaceable>BACKUP_PATH</replaceable>/image.gz </screen>
    </step>
    <step>
     <para>
      Recupere o disco rígido usando os seguintes comandos:
     </para>
<screen><prompt role="root">root # </prompt>gzip -dc /<replaceable>BACKUP_PATH</replaceable>/image.gz | dd of=/dev/<replaceable>SOURCE</replaceable></screen>
    </step>
   </procedure>
   <para>
    Se você precisa fazer backup apenas de uma partição, substitua o marcador <replaceable>ORIGEM</replaceable> pela sua partição. Nesse caso, o seu arquivo de imagem pode usar o mesmo disco rígido, só que em outra partição.
   </para>
  </sect2>





  <xi:include href="system_repair.xml"/>
 </sect1>
 
</chapter>
