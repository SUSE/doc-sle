<?xml version="1.0" encoding="UTF-8"?>
<sect1 xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="rmt_rmt-cli.xml" version="5.0" xml:id="sec-rmt-tools-rmt-cli">
 <info>
  <title>RMT 命令行界面 (<command>rmt-cli</command>)</title>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:translation>yes</dm:translation>
  </dm:docmanager>
 </info>
 <para/>

 <sect2 xml:id="sec-rmt-tools-rmt-cli-overview">
  <title>概述</title>
  <para>
   用于管理 RMT 的关键命令是 <command>rmt-cli</command> (<filename>/usr/bin/rmt-cli</filename>)。<command>rmt-cli</command> 命令应与本节中所述的子命令一起使用。如果单独使用 <command>rmt-cli</command> 命令，它会输出所有可用子命令的列表。要获取单个子命令的帮助，请使用 <command>man rmt-cli</command> 或 <command>rmt-cli help
   [subcommand]</command>。
  </para>
  <para>
   可用子命令如下：
  </para>
  <variablelist>
   <varlistentry>
    <term><command>rmt-cli sync</command></term>
    <listitem>
     <para>
      将数据库与 SUSE Customer Center 同步。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><command>rmt-cli products</command></term>
    <listitem>
     <para>
      列出和修改产品。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><command>rmt-cli repos</command></term>
    <listitem>
     <para>
      列出和修改储存库。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><command>rmt-cli mirror</command></term>
    <listitem>
     <para>
      镜像储存库。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><command>rmt-cli systems</command></term>
    <listitem>
     <para>
      列出和修改系统。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><command>rmt-cli import</command></term>
    <listitem>
     <para>
      用于脱机模式的导入命令。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><command>rmt-cli export</command></term>
    <listitem>
     <para>
      用于脱机模式的导出命令。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><command>rmt-cli version</command></term>
    <listitem>
     <para>
      显示 RMT 版本。
     </para>
    </listitem>
   </varlistentry>
  </variablelist>
  <para>
   以下各节对每个子命令进行了详细说明。
  </para>
 </sect2>

 <sect2 xml:id="sec-rmt-tools-rmt-cli-sync">
  <title><command>sync</command>​</title>
  <para>
   此命令可立即触发与 SUSE Customer Center 的同步。该命令没有其他选项。<systemitem class="daemon">systemd</systemitem> 计时器 <systemitem>rmt-server-sync.timer</systemitem> 每晚也会触发同步。
  </para>
  <para>
   同步期间不会将数据上载到 SUSE Customer Center。例如，此命令可更新本地产品定义和储存库数据。
  </para>
 </sect2>

 <sect2 xml:id="sec-rmt-tools-rmt-cli-products">
  <title><command>products</command>​</title>
  <para>
   列出和修改产品。
  </para>
  <variablelist>
   <varlistentry>
    <term><command>rmt-cli products list [--all] [--csv]</command></term>
    <listitem>
     <para>
      列出已启用以便镜像的产品。使用 <option>--all</option> 标志可列出所有可用产品。使用 <option>--csv</option> 标志可以 CSV 格式输出列表。<option>ls</option> 可用作 <option>list</option> 的简写形式。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><command>rmt-cli products enable [id | string] [--all-modules]</command></term>
    <listitem>
     <para>
      按产品 ID 或字符串启用产品的强制储存库。<option>--all-modules</option> 标志可启用某个产品的所有模块，而不仅仅是建议的模块。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><command>rmt-cli products disable [id | string]</command></term>
    <listitem>
     <para>
      按产品 ID 或字符串禁用产品的所有储存库。
     </para>
    </listitem>
   </varlistentry>
  </variablelist>
 </sect2>

 <sect2 xml:id="sec-rmt-tools-rmt-cli-repos">
  <title><command>repos</command>​</title>
  <variablelist>
   <varlistentry>
    <term><command>rmt-cli repos list [--all] [--csv]</command></term>
    <listitem>
     <para>
      列出已启用以便镜像的储存库。使用 <option>--all</option> 标志可列出所有可用储存库。使用 <option>--csv</option> 标志可以 CSV 格式输出列表。<option>ls</option> 可用作 <option>list</option> 的简写形式。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><command>rmt-cli repos enable [id]</command></term>
    <listitem>
     <para>
      按储存库 ID 启用单个储存库的镜像。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><command>rmt-cli repos disable [id]</command></term>
    <listitem>
     <para>
      按储存库 ID 禁用单个储存库的镜像。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><command>rmt-cli repos clean</command></term>
    <listitem>
     <para>
      去除未标记为待镜像的储存库的本地镜像文件。
     </para>
    </listitem>
   </varlistentry>
  </variablelist>
 </sect2>

 <sect2 xml:id="sec-rmt-tools-rmt-cli-repos-custom">
  <title><command>repos custom</command>​</title>
  <variablelist>
   <varlistentry>
    <term><command>rmt-cli repos custom list [--csv]</command></term>
    <listitem>
     <para>
      列出所有自定义储存库。使用 <option>--csv</option> 标志可以 CSV 格式输出列表。<option>ls</option> 可用作 <option>list</option> 的简写形式。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><command>rmt-cli repos custom add [url] [name] [--id]</command></term>
    <listitem>
     <para>
      添加新的自定义储存库。使用 <option>--id</option> 标志可指定自定义的字母数字 ID。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><command>rmt-cli repos custom enable [id]</command></term>
    <listitem>
     <para>
      启用某个自定义储存库的镜像。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><command>rmt-cli repos custom disable [id]</command></term>
    <listitem>
     <para>
      禁用某个自定义储存库的镜像
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><command>rmt-cli repos custom remove [id]</command></term>
    <listitem>
     <para>
      去除某个自定义储存库。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><command>rmt-cli repos custom products [id]</command></term>
    <listitem>
     <para>
      列出关联到给定 ID 的自定义储存库的产品。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><command>rmt-cli repos custom attach [id] [product id]</command></term>
    <listitem>
     <para>
      将某个现有自定义储存库关联到某个产品。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><command>rmt-cli repos custom detach [id] [product id]</command></term>
    <listitem>
     <para>
      将某个现有自定义储存库与某个产品解除关联。
     </para>
    </listitem>
   </varlistentry>
  </variablelist>
 </sect2>

 <sect2 xml:id="sec-rmt-tools-rmt-cli-mirror">
  <title><command>mirror</command>​</title>
  <variablelist>
   <varlistentry>
    <term><command>rmt-cli mirror</command></term>
    <listitem>
     <para>
      手动启动镜像过程。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><command>rmt-cli mirror all</command></term>
    <listitem>
     <para>
      镜像所有启用的储存库。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><command>rmt-cli mirror repository [IDs]</command></term>
    <listitem>
     <para>
      按 ID 列表镜像启用的储存库。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><command>rmt-cli mirror product [IDs]</command></term>
    <listitem>
     <para>
      按 ID 列表镜像产品的已启用储存库。
     </para>
    </listitem>
   </varlistentry>
  </variablelist>
 </sect2>

 <sect2 xml:id="sec-rmt-tools-rmt-cli-systems">
  <title><command>systems</command>​</title>
  <variablelist>
   <varlistentry>
    <term><command>rmt-cli systems list</command></term>
    <listitem>
     <para>
      此命令会列出已注册的系统。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><command>rmt-cli systems scc-sync</command></term>
    <listitem>
     <para>
      此命令会将已注册系统的数据转发到 SCC。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><command>rmt-cli systems remove [TARGET]</command></term>
    <listitem>
     <para>
      此命令用于从 RMT 中去除 <command>rmt-cli
      systems list</command> 命令输出中的 <guimenu>Login</guimenu> 列所标识的系统。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><command>rmt-cli systems purge</command></term>
    <listitem>
     <para>
      此命令用于列出非活动系统，并具有用于删除非活动系统的选项。它的选项如下：
     </para>
     <itemizedlist>
      <listitem>
       <para>
        <option>--before <replaceable>DATE</replaceable></option> — 列出自 <replaceable>DATE</replaceable> 至今一直处于非活动状态的系统。默认值为最近 3 个月。
       </para>
      </listitem>
      <listitem>
       <para>
        <option>--no-confirmation</option> — 允许管理员直接删除匹配的系统，而无需确认。
       </para>
      </listitem>
     </itemizedlist>
<screen><prompt role="root"># </prompt>rmt-cli systems purge --before 2021-06-16
+------------+----------+---------------------+---------------------+----------+
| Login      | Hostname | Registration time   | Last seen           | Products |
+------------+----------+---------------------+---------------------+----------+
| SCC_c5b0.. | 6e485e48b| 2021-06-11 13:38:07 | 2021-06-11 13:52:01 | SLES/15..|
| SCC_5fcf.. | node52   | 2021-06-15 13:29:24 | 2021-06-15 13:31:25 | SLES/15..|
+------------+----------+---------------------+---------------------+----------+
Do you want to delete these systems? (y/n) y
Purged systems that have not contacted this RMT since 2021-06-16.
</screen>
    </listitem>
   </varlistentry>
  </variablelist>
 </sect2>

 <sect2 xml:id="sec-rmt-tools-rmt-cli-import">
  <title><command>import</command>​</title>
  <para>
   在<emphasis>离线模式</emphasis>下需要使用此命令。有关详细信息，请参见<xref linkend="sec-rmt-mirroring-export-import"/>。
  </para>
  <variablelist>
   <varlistentry>
    <term><command>rmt-cli import data [path]</command></term>
    <listitem>
     <para>
      在离线 RMT 上运行此命令可从给定路径读取 JSON 文件，并在本地数据库中填充数据。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><command>rmt-cli import repos [path]</command></term>
    <listitem>
     <para>
      在离线 RMT 上运行此命令可导入 RPM 软件包。
     </para>
    </listitem>
   </varlistentry>
  </variablelist>
 </sect2>

 <sect2 xml:id="sec-rmt-tools-rmt-cli-export">
  <title><command>export</command>​</title>
  <para>
   在<emphasis>离线模式</emphasis>下需要使用此命令。有关详细信息，请参见<xref linkend="sec-rmt-mirroring-export-import"/>。
  </para>
  <variablelist>
   <varlistentry>
    <term><command>rmt-cli export data [path]</command></term>
    <listitem>
     <para>
      在联机 RMT 上运行此命令可从 SUSE Customer Center 获取最新数据，并在指定路径将结果另存为 JSON 文件。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><command>rmt-cli export settings [path]</command></term>
    <listitem>
     <para>
      在脱机 RMT 上运行此命令可在给定路径将已启用储存库的设置另存为 <filename>repos.json</filename>。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><command>rmt-cli export repos [path]</command></term>
    <listitem>
     <para>
      在联机 RMT 上定期运行此命令可在给定路径镜像 <filename>repos.json</filename> 中指定的一组储存库。镜像的储存库文件会存储在同一路径的子目录中。
     </para>
    </listitem>
   </varlistentry>
  </variablelist>
 </sect2>

 <sect2 xml:id="sec-rmt-tools-rmt-cli-clean">
  <title><command>clean packages</command>​</title>
  <para>
    <command>rmt-cli clean packages</command> 命令会删除本地镜像的<emphasis>悬空</emphasis>文件及其数据库条目。如果文件满足以下所有特征，则会被视为悬空文件：
  </para>
  <itemizedlist>
    <listitem>
      <para>
        该文件存在于包含主文件和元数据 <filename>repomd.xml</filename> 文件的储存库目录中。
      </para>
    </listitem>
    <listitem>
      <para>
        元数据文件中不再引用该文件。
      </para>
    </listitem>
    <listitem>
      <para>
        该文件至少已存在两天。
      </para>
    </listitem>
  </itemizedlist>
  <para>
    您可以将以下选项传递给 <command>rmt-cli clean
    packages</command> 命令：
  </para>
  <variablelist>
   <varlistentry>
    <term>--dry-run</term>
    <listitem>
     <para>
       生成所有受影响文件的报告，而不实际清理它们或其数据库条目。
     </para>
    </listitem>
    </varlistentry>
    <varlistentry>
      <term>--verbose</term>
      <listitem>
        <para>
          列显有关每个已清理文件的详细信息。
        </para>
      </listitem>
    </varlistentry>
    <varlistentry>
      <term>--non-interactive</term>
      <listitem>
        <para>
          在继续进行清理过程前跳过确认。
        </para>
      </listitem>
    </varlistentry>
   </variablelist>
 </sect2>

 <sect2 xml:id="sec-rmt-tools-rmt-cli-version">
  <title><command>version</command>​</title>
  <para>
   显示 <command>rmt-cli</command> 的版本。
  </para>
 </sect2>
</sect1>
