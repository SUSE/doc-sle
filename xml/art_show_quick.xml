<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet href="urn:x-suse:xslt:profiling:docbook50-profile.xsl"
 type="text/xml"
 title="Profiling step"?>

<!DOCTYPE article
[
  <!ENTITY % entities SYSTEM "generic-entities.ent">
  %entities;
  <!ENTITY productnamex "&suse; Home Office Workplace">
]>

<article xml:id="art-openvpn" xml:lang="en" version="5.0"
  xmlns="http://docbook.org/ns/docbook"
  xmlns:xi="http://www.w3.org/2001/XInclude"
  xmlns:xlink="http://www.w3.org/1999/xlink">
 <title>Business Continuity with SUSE Home Office Workplace</title>
 <info>
  <date><?dbtimestamp format="B d, Y" ?></date>
  <abstract>
   <para>
    The Covid-19 pandemic has radically changed many things within a few
    weeks. Companies and organizations around the world now need to take action
    very quickly to keep their business running as smoothly as possible. Home
    office workplaces play a key role here. If as many users as possible carry
    out their tasks from home, the risk of infection decreases - and companies
    remain capable of acting despite the crisis.
   </para>
   <para>
    To help you work from home, &suse; offers a cost-effective business
    continuity solution that you can implement quickly and easily: the
    &productname;. It consists of three components:
   </para>
   <para>
    <emphasis role="bold">&sled;</emphasis>: The Linux desktop from &suse;
    comes with a complete LibreOffice package and more free applications,
    including software for e-mail, collaboration and instant
    messaging. Employees can also access Microsoft Office 365 applications via
    Web browser. Furthermore, they are able to connect to virtual desktops from
    Citrix, VMware, Microsoft, and other vendors. This gives employees in the
    home office access to all applications enabling them to start working
    immediately.
   </para>
   <para>
    <emphasis role="bold">&sls;</emphasis>: Powerful open source software
    solutions are also available for securely connecting home office
    workstations to the company via the Internet. SUSE recommends using the
    virtual private network (VPN) solution OpenVPN. This provides users with
    very easy, protected access to all resources in the corporate network,
    secured by 256-bit encryption and other security features. The &sls;
    product comes with all software that is required to set up an VPN server
    for your business.
   </para>
   <para>
    <emphasis role="bold">&susemgr;</emphasis>: With the &susemgr;, IT
    departments can efficiently manage even a large number of remote
    workstations. It offers automatic installation and creation of disk images
    and also provides centralized configuration management of all
    clients. Administrators also have a complete overview of all necessary
    updates and patches at all times. Should the increase in remote
    workstations require the operation of additional virtual servers, load
    balancing in the data center is possible using SUSE Linux Enterprise Server
    and the open source virtualization solution KVM.
   </para>
  </abstract>
 </info>

 <sect1 xml:id="show-requirements">
  <title>Requirements</title>
  <para>
   Recommended hardware requirements for each products can be found on the
   respective download pages mentioned in <xref linkend="show-download"/>.
  </para>
  <para>
   To set up a VPN server with &sls; you need RFC3280 TLS compliant
   certificates and keys generated by your corporate public key infrastructure
   (PKI) team (these files cannot be generated with &sls;).
  </para>
 </sect1>

 <sect1 xml:id="show-download">
  <title>Software Download</title>
  <para>
   Downloads for all three products are available from <link
   xlink:href="https://www.suse.com/download-linux/"/>. Each download comes
   with a 60-day evaluation key that you need to register the product during
   installation. Before you will be able to download, log in with your
   existing SUSE account or create a new account.
  </para>
  <para>
   Direct download links for the AMD64/Intel 64 architecture:
  </para>
  <itemizedlist>
   <listitem>
    <para>
     <link xlink:href="https://www.suse.com/products/desktop/download/OUKwANFRX3U~/?campaign_name=Eval:_SLES_Desktop_15_SP1">SUSE Linux Enterprise Desktop 15 SP1</link>
    </para>
   </listitem>
   <listitem>
    <para>
     <link xlink:href="https://www.suse.com/products/server/download/DDwcuJKeFoE~/?campaign_name=Eval:_SLES_15_SP1_for_x86-64">SUSE Linux Enterprise Server 15 SP1</link>
    </para>
   </listitem>
   <listitem>
    <para>
     <link xlink:href="https://www.suse.com/products/suse-manager/download/TFcaVx2HLe8~/?campaign_name=Eval:_SUSE_Manager_4">SUSE Manager 4 Server</link>
    </para>
   </listitem>
  </itemizedlist>
 </sect1>

 <sect1 xml:id="show-installmedia">
  <title>Creating the Installation Media</title>
  <para>
   The easiest way to install &suse; Linux is to boot the installation media
   from a USB Flash drive. To create a bootable USB drive, proceed as follows:
  </para>

  <tip>
   <title>Virtual Machine Installation</title>
   <para>
    Creating bootable installation media is only needed when installing on
    bare metal. In case you are installing on a virtual machine, you can
    directly use the ISO images you downloaded from the &suse; Web site.
   </para>
  </tip>

  <sect2 xml:id="show-installmedia-linux">
   <title>On Linux, MacOS</title>
   <para>
    Copy/download the respective product as described in <xref
    linkend="show-download"/> and run the following command:
   </para>
   <screen>&prompt.sudo;dd if=<replaceable>PATH_TO_ISO_IMAGE</replaceable> of=<replaceable>USB_STORAGE_DEVICE</replaceable> bs=4M</screen>
   <para>
    Replace <replaceable>PATH_TO_ISO_IMAGE</replaceable> with the relative or
    absolute path to the file you downloaded from the SUSE Web server. Replace
    <replaceable>USB_STORAGE_DEVICE</replaceable> with the path to the USB
    flash drive. If you are unsure about the path to the USB drive, run the
    following command as &rootuser;:
   </para>
   <screen>&prompt.root;grep -Ff &lt;(hwinfo --disk --short) &lt;(hwinfo --usb --short)</screen>
  </sect2>
  <sect2 xml:id="show-installmedia-win">
   <title>On Windows</title>
   <para>
    There is a large number of USB flashing tools for Windows. One example
    would be the open source tool called <quote>Etcher</quote> which is
    available from <link xlink:href="https://www.balena.io/etcher/"/>.
   </para>
  </sect2>
 </sect1>

 <sect1 xml:id="show-installation">
  <title>Installation Instructions</title>
  <para>
   Information on how to install each product is available in a separate guide:
  </para>
  <itemizedlist>
   <listitem>
    <para>
     <link
       xlink:href="https://documentation.suse.com/sled/15-SP1/pdf/art-sle-installquick_color_en.pdf">&sled;
     Installation Quick Start</link>
    </para>
   </listitem>
   <listitem>
    <para>
     <link
       xlink:href="https://documentation.suse.com/sles/15-SP1/pdf/art-sle-installquick_color_en.pdf">&sls;
     Installation Quick Start</link>
    </para>
   </listitem>
   <listitem>
    <para>
     <link
       xlink:href="https://documentation.suse.com/external-tree/en-us/suma/4.0/pdf/suse_manager_installation_guide.pdf">SUSE
     Manager Installation Guide</link>
    </para>
   </listitem>
  </itemizedlist>
 </sect1>

 <sect1 xml:id="show-vpn">
  <title>Setting Up the VPN Infrastructure</title>
  <para>
   Key part of the &productname; solution is the VPN infrastructure which
   consists of a central VPN server to which the home office clients can
   connect. Setting up this infrastructure requires the following steps:
  </para>
  <procedure>
   <step>
    <para>
     <!--- Provision Certificates and Keys -->
     <xref linkend="show-vpn-certs"/>
    </para>
   </step>
   <step>
    <para>
     <!-- Prepare a SUSE Linux Enterprise Server Instance -->
     <xref linkend="show-vpn-sles"/>
    </para>
   </step>
   <step>
    <para>
     <!-- Install and Configure the VPN Service -->
     <xref linkend="show-vpn-installvpn"/>
    </para>
   </step>
   <step>
    <para>
     <!-- Prepare a Home Office Client -->
     <xref linkend="show-vpn-installclient"/>
    </para>
   </step>
   <step>
    <para>
     <!-- Configure the VPN Client -->
     <xref linkend="show-vpn-vpnclient"/>
    </para>
   </step>
  </procedure>


  <sect2 xml:id="show-vpn-certs">
   <title>Provision Certificates and Keys</title>
   <para>
    The following files certificate and key files, provided by your corporate
    PKI are needed:
   </para>
   <variablelist>
    <varlistentry>
     <term>Server</term>
     <listitem>
      <itemizedlist>
       <listitem>
        <para>
         ca.crt
        </para>
       </listitem>
       <listitem>
        <para>
         server.crt
        </para>
       </listitem>
       <listitem>
        <para>
         server.key
        </para>
       </listitem>
      </itemizedlist>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>Each client</term>
     <listitem>
      <itemizedlist>
       <listitem>
        <para>
         ca.crt
        </para>
       </listitem>
       <listitem>
        <para>
         client.crt
        </para>
       </listitem>
       <listitem>
        <para>
         client.key
        </para>
       </listitem>
      </itemizedlist>
     </listitem>
    </varlistentry>
   </variablelist>
  </sect2>

  <sect2 xml:id="show-vpn-sles">
   <title>Prepare a &sls; Instance</title>
   <para>
    In this step we are setting up a server with &sls; that will provide the
    VPN service. Installation can either be done on a virtual machine (VM) or
    on bare metal.
   </para>

   <important>
    <title>Network Infrastructure</title>
    <para>
     For getting security patches and product updates this server needs to be
     able to either directly access the &scc; (external) or an internal
     &susemgr; or &rmtool; server.
    </para>
    <para>
     You also need to make sure that this machine can access your internal
     network in a secure fashion, so that VPN users can access their
     data.
    </para>
   </important>

   <procedure>
    <step>
     <para>
       <link
         xlink:href="https://www.suse.com/products/server/download/DDwcuJKeFoE~/?campaign_name=Eval:_SLES_15_SP1_for_x86-64">Download</link>
       the &sls; ISO image from the &suse; Web site and make a note of the
       evaluation key.
     </para>
    </step>
    <step>
     <para>
      If you install on bare metal, prepare a bootable USB flash drive as
      described in <xref linkend="show-installmedia"/>. If you install on a VM,
      attach the ISO image as a bootable optical device.
     </para>
    </step>
    <step>
     <para>
      Follow the installation instructions from the <link
       xlink:href="https://documentation.suse.com/sles/15-SP1/pdf/art-sle-installquick_color_en.pdf">Quick Start</link>.
     </para>
     <substeps>
      <step>
       <para>
        Make sure to register &sls; during the installation using the
        evaluation key. This ensures that the product is installed with the
        latest patch level.
       </para>
      </step>
      <step>
       <para>
        <remark>fs 2020-04-06: Verify if sufficient</remark>
        In the <guimenu>Extension and Module Selection</guimenu> step, only
        select the modules <guimenu>Basesystem</guimenu> and <guimenu>Server
        Applications</guimenu> (both should be selected by default).
       </para>
      </step>
      <step>
       <para>
        <remark>fs 2020-04-06: Verify if sufficient</remark>
        In the <guimenu>System Role</guimenu> step, choose
        <guimenu>Minimal</guimenu>.
       </para>
      </step>
     </substeps>
    </step>
   </procedure>
  </sect2>

  <sect2 xml:id="show-vpn-installvpn">
   <title>Install and Configure the VPN Service</title>
   <para>
    In this step we are setting up the VPN service.
    <remark>fs 2020-04-06:
     Network setup? How to ensure the machine gets an external IP address? How
     to ensure users can access the intranet once connected to the VPN server?
     A complete documentation is probably not feasible, but we should list
     basic facts as requirements here (two NICs?, external IP, gateway to
     intranet, user authentication, ...)</remark>
   </para>

   <procedure>
    <step>
     <para>
      Install the VPN server software package:
     </para>
     <screen>&prompt.sudo;zypper in openvpn</screen>
    </step>
    <step>
     <para>
      Copy the server certificates and keys (<filename>ca.crt</filename>,
      <filename>server.crt</filename>, <filename>server.key</filename>) to
      <filename>/etc/openvpn</filename>.
     </para>
    </step>
    <step>
     <para>
      Generate the VPN secrets:
      <remark>fs 2020-04-06:
           In which directoty is ta.key generated? ist it /etc/openvpn?
           If not, do we need to also copy it to /etc/openvpn on the server?</remark>
     </para>
     <screen>&prompt.sudo;openssl dhparam -out /etc/openvpn/dh2048.pem 2048
&prompt.sudo;openvpn --genkey --secret ta.key</screen>
    </step>
    <step>
     <para>
      Add a copy of the previously generated
      <filename>/etc/openvpn/ta.key</filename> to the set of certificates and
      keys for the clients&mdash;it will be needed on each client machine. We
      recommend to create a zip or tar file containing the four files needed on
      the clients: <filename>ca.crt</filename>,
      <filename>client.crt</filename>, <filename>client.key</filename>,
      <filename>ta.key</filename>.
     </para>
    </step>
    <step>
     <para>
      If you use a firewall, open the required ports by allowing the openvpn
      service:
     </para>
     <screen>&prompt.sudo;firewall-cmd --add-service openvpn
&prompt.sudo;firewall-cmd --permanent --add-service openvpn</screen>
    </step>
    <step>
     <para>
      Create an initial server configuration file by copying the template:
     </para>
     <screen>&prompt.sudo;cp /usr/share/doc/packages/openvpn/sample-config-files/server.conf \
/etc/openvpn</screen>
    </step>
    <step>
     <para>
      Edit <filename>/etc/openvpn/server.conf</filename> by adapting and/or
      uncommenting existing lines as follows (leave the rest unchanged):
     </para>
     <screen>dev tun0
user nobody
group nobody
log  openvpn.log
log-append  openvpn.log</screen>
    </step>
    <step>
     <para>
      Set up a <literal>tun</literal> device configuration by creating
      <filename>/etc/sysconfig/network/ifcfg-tun0</filename> with the following
      content:
      <remark>fs 2020-04-06:
           Really "manual"? Will the interface come up automatically afetr a reboot?</remark>
     </para>
     <screen>STARTMODE='manual'
BOOTPROTO='static'
TUNNEL='tun'
TUNNEL_SET_OWNER='nobody'
TUNNEL_SET_GROUP='nobody'
LINK_REQUIRED=no
PRE_UP_SCRIPT='systemd:openvpn@server'
PRE_DOWN_SCRIPT='systemd:openvpn@service'</screen>
    </step>
    <step>
     <para>
      Activate the <literal>tun0</literal> device:
     </para>
     <screen>sudo wicked ifup tun0</screen>
    </step>
    <step>
     <para>
      Start and enable the OpenVPN service:
      <remark>fs 2020-04-06:
     Added service enablement</remark>
     </para>
     <screen>&prompt.sudo;systemctl start openvpn@server.service
&prompt.sudo;systemctl enable openvpn@server.service</screen>
    </step>
    <step>
     <para>
      <remark>fs 2020-04-06:
           Restricted ip output to tun0</remark>
      Check if the <literal>tun0</literal> is assigned with an IP address by
      running <command>ip a show tun0</command>.
     </para>
     <para>
      <remark>fs 2020-04-06:
           Added minimal troubleshooting</remark>
      In case <literal>tun0</literal> does not get an IP address, validate all
      steps above. If you change <filename>/etc/openvpn/server.conf</filename>,
      make sure to restart the service with <command>systemctl restart
      openvpn@server.service</command>. To check the log messages for VPN,
      run <command>journalctl -xb -u openvpn@server</command>.
     </para>
     <para>
      Congratulations. You have successfully set up the VPN server.
     </para>
    </step>
   </procedure>
  </sect2>

  <sect2 xml:id="show-vpn-installclient">
   <title>Prepare a Home Office Client</title>
   <para>
    In this step we are setting up a home office client with &sled;.
   </para>
   <procedure>
    <step>
     <para>
       <link
         xlink:href="https://www.suse.com/products/desktop/download/OUKwANFRX3U~/?campaign_name=Eval:_SLES_Desktop_15_SP1">Download</link>
       the &sled; ISO image from the &suse; Web site and make a note of the
       evaluation key.
     </para>
    </step>
    <step>
     <para>
      Prepare a bootable USB flash drive as described in <xref
      linkend="show-installmedia"/>.
     </para>
    </step>
    <step>
     <para>
      Follow the installation instructions from the <link
       xlink:href="https://documentation.suse.com/sled/15-SP1/pdf/art-sle-installquick_color_en.pdf">Quick Start</link>.
     </para>
    </step>
    <step>
     <para>
      Make sure to register &sls; during the installation using the
      evaluation key. This ensures that the product is installed with the
      latest patch level.
     </para>
    </step>
   </procedure>
  </sect2>


  <sect2 xml:id="show-vpn-vpnclient">
   <title>Configure the VPN Client</title>
   <para>
    The &sled; installation you performed in the previous step already has the
    required OpenVPN packages already installed by default. In addition to
    that, you need the client certificates and keys (including the
    <filename>ta.key</filename> generated on the OpenVPN server machine). You
    will also need to know the external IP address of the VPN server.
   </para>

   <warning>
    <title>Ensure Secure delivery of Certificates and Keys</title>
    <para>
     <remark>fs 2020-04-06:
          Is the following correct? If so, is not the configuration insecure?</remark>
     The VPN certificates and keys for each client must always be distributed
     in a secure fashion, for example as an encrypted over a secure
     connection. These files must never be made publicly available. Also
     ensure that no home office worker passes them along to any other person.
    </para>
    <para>
     These files are the admission ticket to your intranet and everybody owning
     them can access your virtual private network.
    </para>
   </warning>

   <procedure>
    <step>
     <para>
      Import the client certificates (<filename>ca.crt</filename>,
      <filename>client.crt</filename>, <filename>client.key</filename>,
      <filename>ta.key</filename>) to <filename>/etc/openvpn</filename>.
     </para>
    </step>
    <step>
     <para>
      Create an initial client configuration file by copying the template:
     </para>
     <screen>&prompt.sudo;cp /usr/share/doc/packages/openvpn/sample-config-files/client.conf \
/etc/openvpn</screen>
    </step>
    <step>
     <para>
      Edit <filename>/etc/openvpn/client.conf</filename> by adapting and/or
      uncommenting existing lines as follows (leave the rest unchanged):
     </para>
     <screen>dev tun0
remote <replaceable>VPN_Server_IP</replaceable> 1194
user nobody
group nobody</screen>
     <para>
      <replaceable>VPN_Server_IP</replaceable> needs to be replaced by the
      external IP address of the VPN server.
     </para>
    </step>
    <step>
     <para>
      Set up a <literal>tun</literal> device configuration by creating
      <filename>/etc/sysconfig/network/ifcfg-tun0</filename> with the following
      content:
     </para>
     <screen>STARTMODE='manual'
BOOTPROTO='static'
TUNNEL='tun'
TUNNEL_SET_OWNER='nobody'
TUNNEL_SET_GROUP='nobody'
LINK_REQUIRED=no
PRE_UP_SCRIPT='systemd:openvpn@client'
PRE_DOWN_SCRIPT='systemd:openvpn@client'</screen>
    </step>
    <step>
     <para>
      Activate the <literal>tun0</literal> device:
     </para>
     <screen>sudo wicked ifup tun0</screen>
    </step>
    <step>
     <para>
      Start the OpenVPN service:
     </para>
     <screen>&prompt.sudo;systemctl start openvpn@client.service</screen>
     <para>
      This command is required every time you would like to establish a VPN
      connection from the Home office. To terminate an existing connection, run
      <command>sudo systemctl stop
      openvpn@client.service</command>. Alternatively, you can use the
      NetworkManager on &sled; to establish and terminate the VPN connection
      without requiring &rootuser; privileges.
     </para>
    </step>
    <step>
     <para>
      <remark>fs 2020-04-06:
           Restricted ip output to tun0</remark>
      Check if the <literal>tun0</literal> is assigned with an IP address by
      running <command>ip a show tun0</command>. If so, check whether you can
      reach the VPN server:
     </para>
     <screen>ping -c 5 <replaceable>VPN_Server_IP</replaceable></screen>
     <para>
      <replaceable>VPN_Server_IP</replaceable> needs to be replaced by the
      external IP address of the VPN server.
     </para>
    </step>
    <step>
     <para>
      Congratulations. You have successfully set up a VPN client.
     </para>
    </step>
   </procedure>
  </sect2>
 </sect1>


 <sect1 xml:id="show-moreinfo">
  <title>For More Information</title>
  <para>
   Apart from the quick starts, &suse; provides detailed documentation for each
   product on <link xlink:href="https://doc.suse.com/"/>:
  </para>
  <itemizedlist>
   <listitem>
    <para>
     &sled;: <link xlink:href="https://doc.suse.com/sled-15/"/>
    </para>
   </listitem>
   <listitem>
    <para>
     &sls;: <link xlink:href="https://doc.suse.com/sles-15/"/>
    </para>
   </listitem>
   <listitem>
    <para>
     &susemgr;: <link xlink:href="https://doc.suse.com/suma/"/>
    </para>
   </listitem>
  </itemizedlist>
  <para>
   Tips and troubleshooting help is available in the <link
   xlink:href="https://www.suse.com/support/#knowledgebase">SUSE
   Knowledgebase</link>. Choose the respective product and enter a search term
   to get help on certain topics.
  </para>
 </sect1>
 <xi:include href="common_gfdl1.2_i.xml"/>
</article>
