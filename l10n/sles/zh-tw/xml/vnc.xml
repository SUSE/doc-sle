<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="vnc.xml" version="5.0" xml:id="cha-vnc">
 <title>使用 VNC 的遠端圖形工作階段</title>
 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:bugtracker/>
   <dm:translation>yes</dm:translation>
  </dm:docmanager>
  <abstract>
   <para>
    您可以利用虛擬網路計算 (VNC) 透過圖形桌面存取遠端電腦，並執行遠端圖形應用程式。VNC 獨立於平台，可讓您從任何作業系統存取遠端機器。本章介紹如何使用桌面用戶端 vncviewer 和 Remmina 連接至 VNC 伺服器，以及如何操作 VNC 伺服器。
   </para>
     <para>
    <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> 支援兩種不同類型的 VNC 工作階段：一次性工作階段，只要用戶端 VNC 連接不中斷，該工作階段將一直處於<quote>作用中</quote>；永久工作階段，此工作階段將一直處於<quote>作用中</quote>，除非明確將其終止。
   </para>
  <para>
   VNC 伺服器可在不同連接埠上同時提供兩種工作階段，但開啟的工作階段不能從一種類型轉換為另一種類型。
  </para>
   </abstract>
</info>

 <sect1 xml:id="sec-vnc-viewer">
  <title><command>vncviewer</command> 用戶端</title>
 

  <para>
   若要連接到伺服器提供的 VNC 服務，需要使用一個用戶端。<phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> 中的預設用戶端是 <command>vncviewer</command> 套件提供的 <systemitem class="resource">tigervnc</systemitem>。
  </para>

  <sect2 xml:id="sec-vnc-viewer-connectcli">
   <title>使用 vncviewer CLI 進行連接</title>
   <para>
    若要啟動 VNC 查看器並發起與伺服器的工作階段，請使用以下指令：
   </para>
<screen><prompt>&gt; </prompt>vncviewer jupiter.example.com:1</screen>
   <para>
    您也可以指定含兩個冒號的連接埠號碼，而不指定 VNC 顯示埠號碼：
   </para>
<screen><prompt>&gt; </prompt>vncviewer jupiter.example.com::5901</screen>
   <note>
    <title>顯示號碼和連接埠號碼</title>
    <para>
     您在 VNC 用戶端中指定的實際顯示號碼或連接埠號碼必須與在目標機器上透過 <command>vncserver</command> 指令選取的顯示號碼或連接埠號碼相同。如需更多資訊，請參閱<xref linkend="sec-vnc-persistent"/>。
    </para>
   </note>
  </sect2>

  <sect2 xml:id="sec-vnc-viewer-connectgui">
   <title>使用 vncviewer GUI 進行連接</title>
   <para>
    執行 <command>vncviewer</command> 且不指定 <command>--listen</command> 或要連接到的主機會顯示一個視窗，要求您輸入連接詳細資料。按<xref linkend="sec-vnc-viewer-connectcli"/>中所述在 <guimenu>VNC 伺服器</guimenu>欄位中輸入主機，然後按一下<guimenu>連接</guimenu>。
   </para>
   <figure xml:id="fig-vnc-viewer-connectgui">
    <title>vncviewer</title>
    <mediaobject>
     <textobject role="description"><phrase>vncviewer asking for connection details</phrase>
     </textobject>
     <imageobject role="html">
      <imagedata fileref="vnc_connect.png"/>
     </imageobject>
     <imageobject role="fo">
      <imagedata fileref="vnc_connect.png"/>
     </imageobject>
    </mediaobject>
   </figure>
  </sect2>

  <sect2 xml:id="sec-vnc-viewer-encrypt">
   <title>未加密連接通知</title>
   <para>
    VNC 協定支援不同類型的加密連接，請不要將這些連接與密碼驗證相混淆。如果某個連接未使用 TLS，VNC 檢視器的視窗標題中可能會出現 <quote>(連接未加密！)</quote> 文字。
   </para>
  </sect2>
 </sect1>

 <sect1 xml:id="vnc-remmina">
  <title>Remmina：遠端桌面用戶端</title>

  <para>
   Remmina 是功能豐富的新式遠端桌面用戶端。它支援多種存取方法，例如 VNC、SSH、RDP 和 Spice。
  </para>

  <sect2 xml:id="vnc-remmina-install">
   <title>安裝</title>
   <para>
    若要使用 Remmina，請驗證系統上是否安裝了 <package>remmina</package> 套件，如未安裝，請加以安裝。記得還要安裝適用於 Remmina 的 VNC 外掛程式：
   </para>
<screen>
<prompt role="root"># </prompt>zypper in remmina remmina-plugin-vnc
</screen>
  </sect2>

  <sect2 xml:id="vnc-remmina-usage">
   <title>主視窗</title>
   <para>
    透過輸入 <command>remmina</command> 指令執行 Remmina。
   </para>
   <figure>
    <title>Remmina 的主視窗</title>
    <mediaobject>
     <imageobject role="fo">
      <imagedata fileref="remmina.png" width="50%"/>
     </imageobject>
     <imageobject role="html">
      <imagedata fileref="remmina.png" width="50%"/>
     </imageobject>
    </mediaobject>
   </figure>
   <para>
    該應用程式主視窗顯示儲存的遠端工作階段清單。在這裡，您可以新增和儲存新遠端工作階段、快速啟動新工作階段而不儲存、啟動先前儲存的工作階段，或設定 Remmina 的全域優先設定。
   </para>
  </sect2>

  <sect2 xml:id="vnc-remmina-addnew">
   <title>新增遠端工作階段</title>
   <para>
    若要新增和儲存新的遠端工作階段，請按一下主視窗右上方的 <inlinemediaobject><textobject role="description"><phrase>新增新工作階段</phrase></textobject><imageobject role="fo"><imagedata fileref="remmina_plus.png" width="1.2em"/></imageobject><imageobject role="html"><imagedata fileref="remmina_plus.png" width="1.2em"/></imageobject></inlinemediaobject>。<guimenu>遠端桌面優先設定</guimenu>視窗即會開啟。
   </para>
   <figure>
    <title>遠端桌面優先設定</title>
    <mediaobject>
     <imageobject role="fo">
      <imagedata fileref="remmina_session_details.png" width="80%"/>
     </imageobject>
     <imageobject role="html">
      <imagedata fileref="remmina_session_details.png" width="80%"/>
     </imageobject>
    </mediaobject>
   </figure>
   <para>
    在用於指定剛才新增的遠端工作階段設定檔的欄位中填寫資訊。最重要的技術包括：
   </para>
   <variablelist>
    <varlistentry>
     <term>名稱</term>
     <listitem>
      <para>
       設定檔的名稱，將列於主視窗中。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>通訊協定</term>
     <listitem>
      <para>
       連接到遠端工作階段時要使用的通訊協定，例如 VNC。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>伺服器</term>
     <listitem>
      <para>
       遠端伺服器的 IP 或 DNS 位址和顯示號碼。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>使用者名稱、密碼</term>
     <listitem>
      <para>
       將用於進行遠端驗證的身分證明。保留為空白表示不進行驗證。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>色彩深度、品質</term>
     <listitem>
      <para>
       根據連接速度和品質選取最佳選項。
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
   <para>
    選取<guimenu>進階</guimenu>索引標籤可輸入更具體的設定。
   </para>
   <tip>
    <title>停用加密</title>
    <para>
     如果用戶端與遠端伺服器之間的通訊不加密，請啟用<guimenu>停用加密</guimenu>，否則連接會失敗。
    </para>
   </tip>
   <para>
    選取 <guimenu>SSH</guimenu> 索引標籤可顯示進階 SSH 通道和驗證選項。
   </para>
   <para>
    請按 <guimenu>儲存</guimenu> 加以確認。新的設定檔將列在主視窗中。
   </para>
  </sect2>

  <sect2 xml:id="vnc-remmina-start">
   <title>啟動遠端工作階段</title>
   <para>
    您可以啟動先前儲存的工作階段，也可以快速啟動一個遠端工作階段而不儲存連接詳細資料。
   </para>
   <sect3 xml:id="vnc-remmina-quickstart">
    <title>快速啟動遠端工作階段</title>
    <para>
     若要快速啟動遠端工作階段而不新增和儲存連接詳細資料，請使用主視窗頂部的下拉式方塊和文字方塊。
    </para>
    <figure>
     <title>快速啟動</title>
     <mediaobject>
      <imageobject role="fo">
       <imagedata fileref="remmina_quickstart.png" width="40%"/>
      </imageobject>
      <imageobject role="html">
       <imagedata fileref="remmina_quickstart.png" width="40%"/>
      </imageobject>
     </mediaobject>
    </figure>
    <para>
     從下拉式方塊中選取通訊協定 (例如「VNC」)，然後輸入 VNC 伺服器 DNS 或 IP 位址，後跟一個冒號和顯示號碼，然後按 <keycap function="enter"/> 確認。
    </para>
   </sect3>
   <sect3>
    <title>開啟儲存的遠端工作階段</title>
    <para>
     若要開啟特定的遠端工作階段，請從工作階段清單中連按兩下該工作階段。
    </para>
   </sect3>
   <sect3>
    <title>遠端工作階段視窗</title>
    <para>
     遠端工作階段會在新視窗的索引標籤中開啟。每個索引標籤代管一個工作階段。視窗左側的工具列可協助您管理視窗/工作階段，例如切換全螢幕模式、調整視窗大小以適應工作階段的顯示大小、將特定按鍵動作傳送到工作階段、擷取工作階段的螢幕畫面，或設定影像品質。
    </para>
    <figure>
     <title>正在檢視遠端工作階段的 Remmina</title>
     <mediaobject>
      <imageobject role="fo">
       <imagedata fileref="remmina_sle15inside.png" width="80%"/>
      </imageobject>
      <imageobject role="html">
       <imagedata fileref="remmina_sle15inside.png" width="80%"/>
      </imageobject>
     </mediaobject>
    </figure>
   </sect3>
  </sect2>

  <sect2 xml:id="vnc-remmina-edit-delete-clone">
   <title>編輯、複製和刪除儲存的工作階段</title>
   <para>
    若要<emphasis>編輯</emphasis>儲存的某個遠端工作階段，請在 Remmina 主視窗中以滑鼠右鍵按一下該工作階段的名稱，然後選取<guimenu>編輯</guimenu>。如需相關欄位的描述，請參閱<xref linkend="vnc-remmina-addnew"/>。
   </para>
   <para>
    若要<emphasis>複製</emphasis>儲存的某個遠端工作階段，請在 Remmina 主視窗中以滑鼠右鍵按一下該工作階段的名稱，然後選取<guimenu>複製</guimenu>。在<guimenu>遠端桌面優先設定</guimenu>視窗中，變更設定檔的名稱，(選擇性) 調整相關選項，然後按一下<guimenu>儲存</guimenu>確認。
   </para>
   <para>
    若要<emphasis>刪除</emphasis>儲存的某個遠端工作階段，請在 Remmina 主視窗中以滑鼠右鍵按一下該工作階段的名稱，然後選取<guimenu>刪除</guimenu>。在下一個對話方塊中，按一下<guimenu>是</guimenu>確認。
   </para>
  </sect2>

  <sect2 xml:id="vnc-remmina-cmdline">
   <title>從指令行執行遠端工作階段</title>
   <para>
    如果您需要從指令行或使用批次檔案開啟遠端工作階段，而不先開啟應用程式主視窗，請使用以下語法：
   </para>
<screen>
 <prompt>&gt; </prompt>remmina -c <replaceable>profile_name</replaceable>.remmina
</screen>
   <para>
    Remmina 的設定檔儲存在您主目錄下的 <filename>.local/share/remmina/</filename> 目錄中。若要確定哪個設定檔屬於您要開啟的工作階段，請執行 Remmina，在主視窗中按一下工作階段名稱，然後在視窗底部的狀態行中查看設定檔的路徑。
   </para>
   <figure>
    <title>讀取設定檔的路徑</title>
    <mediaobject>
     <imageobject role="fo">
      <imagedata fileref="remmina_status.png" width="50%"/>
     </imageobject>
     <imageobject role="html">
      <imagedata fileref="remmina_status.png" width="50%"/>
     </imageobject>
    </mediaobject>
   </figure>
   <para>
    如果 Remmina 未在執行，您可以將設定檔重新命名為更合理的檔案名稱，例如 <filename>sle15.remmina</filename>。您甚至可以將設定檔複製到自訂目錄，並從該目錄中使用 <command>remmina -c</command> 指令來執行它。
   </para>
  </sect2>
 </sect1>
 
 <sect1 xml:id="sec-vnc-one-time">
  <title>在 VNC 伺服器上設定一次性工作階段</title>

  <para>
   一次性工作階段由遠端用戶端啟動。它會在伺服器上啟動圖形登入畫面。這樣，您就可以選擇啟動工作階段的使用者，如果登入管理員支援，還可以選擇桌面環境。終止此類 VNC 工作階段的用戶端連接時，在該工作階段內啟動的所有應用程式也會隨之終止。一次性 VNC 工作階段無法共用，不過在同一台主機上可以同時啟動多個工作階段。
  </para>

  <procedure xml:id="pro-vnc-one-time-activate">
   <title>啟用一次性 VNC 工作階段</title>
   <step>
    <para>
     啟動<menuchoice> <guimenu>YaST</guimenu> <guimenu>網路服務</guimenu> <guimenu>遠端管理 (VNC)</guimenu>
     </menuchoice>。
    </para>
   </step>
   <step>
    <para>
     核取<guimenu>允許進行遠端管理 (不含工作階段管理)</guimenu>。
    </para>
   </step>
   <step>
    <para>
     如果您打算在網頁瀏覽器視窗中存取 VNC 工作階段，請啟用<guimenu>允許使用網路瀏覽器存取</guimenu>。
    </para>
   </step>
   <step>
    <para>
     若需要，還可核取<guimenu>在防火牆中開啟埠</guimenu>(例如，當網路介面設定為位於外部區域中時)。如果您有多個網路介面，請透過<guimenu>防火牆細節</guimenu>設定在特定介面開啟防火牆埠的限制。
    </para>
   </step>
   <step>
    <para>
     以 <guimenu>下一步</guimenu> 確認您的設定值。
    </para>
   </step>
   <step>
    <para>
     如果有些需要的套件尚未提供，您需要批准安裝缺失套件。
    </para>
    <tip>
     <title>重新啟動顯示管理員</title>
     <para>
      YaST 對顯示管理員設定進行了變更。您需要登出目前的圖形工作階段並重新啟動顯示管理員，以使變更生效。
     </para>
    </tip>
   </step>
  </procedure>

  <figure>
   <title>遠端管理</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="vnc_nosession.png" width="70%"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="vnc_nosession.png" width="70%"/>
    </imageobject>
   </mediaobject>
  </figure>

  <sect2 xml:id="sec-vnc-one-time-configs">
   <title>可用的組態</title>
   <para>
    <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> 上的預設組態以 16 位元色彩深度、1024x768 像素解析度顯示工作階段。使用<quote>一般</quote>的 VNC 檢視器 (相當於 VNC 顯示埠 <literal>1</literal>) 時，可在連接埠 <systemitem class="resource">5901</systemitem> 上檢視工作階段，而使用網頁瀏覽器時，則可在連接埠 <systemitem class="resource">5801</systemitem> 上檢視工作階段。
   </para>
   <para>
    其他組態可在不同的連接埠上使用<phrase os="sles;osuse">，請參閱<xref linkend="sec-vnc-one-time-config"/></phrase>。
   </para>
   <para>
    在一次性工作階段中，VNC 顯示埠號碼和 X 顯示埠號碼是獨立的。VNC 顯示埠號碼需要手動指定給伺服器支援的每個組態 (在上例中為 :1)。每次以其中一種組態啟動 VNC 工作階段時，工作階段會自動獲得可用的 X 顯示埠號碼。
   </para>
   <para>
    依預設，VNC 用戶端與伺服器會嘗試透過安裝後產生的自行簽署 SSL 證書安全通訊。您可以使用預設的證書，也可以用自己的證書取代它。使用自行簽署的證書時，需要在首次連接之前，於 VNC 檢視器與網頁瀏覽器中確認證書的簽名。
   </para>
  </sect2>

  <sect2 xml:id="sec-vnc-one-time-connect">
   <title>啟動一次性 VNC 工作階段</title>
   <para>
    若要連接一次性 VNC 工作階段，必須安裝 VNC 檢視器，另請參閱<xref linkend="sec-vnc-viewer"/>。或者，可在支援 JavaScript 的網頁瀏覽器中輸入以下 URL 來檢視 VNC 工作階段：<literal>http://jupiter.example.com：5801</literal>
   </para>
  </sect2>

  <sect2 xml:id="sec-vnc-one-time-config">
   <title>設定一次性 VNC 工作階段</title>
   <para>
    如果您不需要或不想修改預設組態，可以跳過本小節。
   </para>
   <para>
    透過 <systemitem class="daemon">systemd</systemitem> 通訊端 <systemitem>xvnc.socket</systemitem> 啟動一次性 VNC 工作階段。該通訊端預設提供六個組態區塊：三個用於 VNC 檢視器 (<literal>vnc1</literal> 到 <literal>vnc3</literal>)，另外三個用於 JavaScript 用戶端 (<literal>vnchttpd1</literal> 到 <literal>vnchttpd3</literal>)。預設只有 <literal>vnc1</literal> 及 <literal>vnchttpd1</literal> 處於作用中狀態。
   </para>
   <para>
    若要在開機時啟動 VNC 伺服器通訊端，請執行以下指令：
   </para>
<screen><prompt>&gt; </prompt><command>sudo</command>  systemctl enable xvnc.socket</screen>
   <para>
    若要立即啟動通訊端，請執行：
   </para>
<screen><prompt>&gt; </prompt><command>sudo</command>  systemctl start xvnc.socket</screen>
   <para>
    可透過 <literal>server_args</literal> 選項設定 <command>Xvnc</command> 伺服器。如需選項清單，請參閱 <command>Xvnc --help</command>。
   </para>
   <para>
    新增自訂組態時，請確定它們沒有使用同一台主機上的其他組態、服務或現有的永久 VNC 工作階段已在使用的連接埠。
   </para>
   <para>
    輸入以下指令啟用組態變更：
   </para>
<screen><prompt>&gt; </prompt><command>sudo</command> systemctl reload xvnc.socket</screen>
   <important>
    <title>防火牆和 VNC 連接埠</title>
    <para>
     依照<xref linkend="pro-vnc-one-time-activate"/> 中所述啟用遠端管理時，會在防火牆中開啟連接埠 <systemitem class="resource">5801</systemitem> 及 <systemitem class="resource">5901</systemitem>。如果提供 VNC 工作階段的網路介面受防火牆保護，則您在為 VNC 工作階段啟用其他連接埠時，需要手動開啟相應的連接埠。如需指示，請參閱<xref linkend="cha-security-firewall"/>。
    </para>
   </important>
  </sect2>
 </sect1>
 
 <sect1 xml:id="sec-vnc-persistent">
  <title>設定永久 VNC 伺服器工作階段</title>

  <para>
   從多個用戶端可以同時存取一個永久工作階段。此特性非常適合用於在一個用戶端具有完整存取權，而所有其他用戶端具有僅檢視存取權的場合進行演示操作。另一個使用案例是：訓練員可能需要在其中存取學員桌面的訓練工作階段。
  </para>

  <tip xml:id="sec-vnc-persistent-connect">
   <title>連接至永久 VNC 工作階段</title>
   <para>
    若要連接至永久 VNC 工作階段，必須安裝 VNC 檢視器。如需更多詳細資料，請參閱<xref linkend="sec-vnc-viewer"/>。或者，可在支援 JavaScript 的網頁瀏覽器中輸入以下 URL 來檢視 VNC 工作階段：<literal>http://jupiter.example.com：5801</literal>
   </para>
  </tip>

  <para>
   持續 VNC 工作階段分為以下兩類：
  </para>

  <itemizedlist>
   <listitem>
    <para>
     <xref linkend="vnc-persistent-vncserver" xrefstyle="select:title"/>
    </para>
   </listitem>
   <listitem>
    <para>
     <xref linkend="vnc-persistent-vncmanager" xrefstyle="select:title"/>
    </para>
   </listitem>
  </itemizedlist>

  <sect2 xml:id="vnc-persistent-vncserver">
   <title>使用 <systemitem>vncserver</systemitem> 啟動的 VNC 工作階段</title>
   <para>
    此類型的持續 VNC 工作階段在伺服器上啟動。不論用戶端的連接狀態為何，此工作階段以及在此工作階段中啟動的所有應用程式會一直執行，直至工作階段被終止。對永久工作階段的存取受到密碼保護，密碼可能為以下兩種類型：
   </para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>
      授予完全存取權的一般密碼，或
     </para>
    </listitem>
    <listitem>
     <para>
      授予非互動式 (僅檢視) 存取權限的選擇性僅檢視密碼。
     </para>
    </listitem>
   </itemizedlist>
   <para>
    一個工作階段可以同時擁有這兩種類型的多個用戶端連接。
   </para>
   <procedure xml:id="pro-vnc-persistent-activate">
    <title>使用 <command>vncserver</command> 啟動永久 VNC 工作階段</title>
    <step>
     <para>
      開啟外圍程序，並確定您以應當擁有 VNC 工作階段的使用者身分登入。

     </para>
    </step>
    <step>
     <para>
      如果提供 VNC 工作階段的網路介面受防火牆保護，則您需要在防火牆中手動開啟工作階段使用的連接埠。如果要啟動多個工作階段，可以開啟一系列連接埠。如需如何設定防火牆的詳細資料，請參閱<xref linkend="cha-security-firewall"/>。
     </para>
     <para>
      <command>vncserver</command> 對顯示埠 <literal>:1</literal> 使用連接埠 <systemitem class="resource">5901</systemitem>，對顯示埠 <literal>:2</literal> 使用連接埠 <systemitem class="resource">5902</systemitem>，依此類推。對於永久工作階段，VNC 顯示埠和 X 顯示埠的號碼通常都是相同的。
     </para>
    </step>
    <step>
     <para>
      若要以 1024x768 像素的解析度及 16 位元的色彩深度啟動工作階段，請輸入以下指令：
     </para>
<screen>vncserver -alwaysshared -geometry 1024x768 -depth 16</screen>
     <para>
      <command>vncserver</command> 指令在未指定顯示埠號碼的情況下，會挑選未使用的號碼，並列印它的選擇。有關更多選項的資訊，請參閱 <command>man 1 vncserver</command>。
     </para>
    </step>
   </procedure>
   <para>
    首次執行 <command>vncserver</command> 時，它會要求您輸入擁有工作階段完整存取權限的密碼。如果需要，您也可以提供對工作階段具有僅檢視存取權限的密碼。
   </para>
   <para>
    此處提供的密碼還可供同一個使用者用來啟動以後的工作階段。使用 <command>vncpasswd</command> 指令可以變更這些密碼。
   </para>
   <important>
    <title>安全性注意事項</title>
    <para>
     請務必使用足夠長 (8 個或更多字元) 的嚴密密碼。請不要共用這些密碼。
    </para>
   </important>
   <para>
    若要終止工作階段，請從 VNC 檢視器關閉在 VNC 工作階段內部執行的桌面環境，就如同關閉一般本地 X 工作階段一樣。
   </para>
   <para>
    如果您想要手動終止工作階段，請在 VNC 伺服器上開啟一個外圍程序，並務必以擁有您要終止之 VNC 工作階段的使用者身分登入。執行以下指令以終止在顯示埠 <literal>:1</literal> 上執行的工作階段：<command>vncserver -kill :1</command>
   </para>
   <sect3 xml:id="sec-vnc-persistent-configure">
    <title>設定永久 VNC 工作階段</title>
    <para>
     永久 VNC 工作階段可透過編輯 <filename>$HOME/.vnc/xstartup</filename> 來設定。依預設，此外圍程序程序檔會啟動它啟動時所處的同一個 GUI/視窗管理員。在 <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> 中，此 GUI/視窗管理員為 GNOME 或 IceWM。如果想要使用您選擇的視窗管理員啟動工作階段，請設定變數 <envar>WINDOWMANAGER</envar>：
    </para>
<screen>WINDOWMANAGER=gnome vncserver -geometry 1024x768
WINDOWMANAGER=icewm vncserver -geometry 1024x768</screen>
    <note>
     <title>每個使用者對應一個組態</title>
     <para>
      永久 VNC 工作階段透過單個基於使用者的組態設定。由同一個使用者啟動的多個工作階段皆使用相同的啟動檔案和密碼檔案。
     </para>
    </note>
   </sect3>
  </sect2>

  <sect2 xml:id="vnc-persistent-vncmanager">
   <title>使用 <systemitem>vncmanager</systemitem> 啟動的 VNC 工作階段</title>
   <para/>
   <procedure xml:id="vnc-persistent-vncmanager-enable">
    <title>啟用永久 VNC 工作階段</title>
    <step>
     <para>
      啟動<menuchoice> <guimenu>YaST</guimenu> <guimenu> 網路服務</guimenu> <guimenu> 遠端管理 (VNC)</guimenu>
      </menuchoice>。
     </para>
    </step>
    <step>
     <para>
      啟用<guimenu>允許進行遠端管理 (含工作階段管理)</guimenu>。
     </para>
    </step>
    <step>
     <para>
      如果您打算在網頁瀏覽器視窗中存取 VNC 工作階段，請啟用<guimenu>允許使用網路瀏覽器存取</guimenu>。
     </para>
    </step>
    <step>
     <para>
      若需要，還可核取<guimenu>在防火牆中開啟埠</guimenu>(例如，當網路介面設定為位於外部區域中時)。如果您有多個網路介面，請透過<guimenu>防火牆細節</guimenu>設定在特定介面開啟防火牆埠的限制。
     </para>
    </step>
    <step>
     <para>
      以 <guimenu>下一步</guimenu> 確認您的設定值。
     </para>
    </step>
    <step>
     <para>
      如果有些需要的套件尚未提供，您需要批准安裝缺失套件。
     </para>
     <tip>
      <title>重新啟動顯示管理員</title>
      <para>
       YaST 對顯示管理員設定進行了變更。您需要登出目前的圖形工作階段並重新啟動顯示管理員，以使變更生效。
      </para>
     </tip>
    </step>
   </procedure>
   <sect3 xml:id="vnc-persistent-vncmanager-configure">
    <title>設定永久 VNC 工作階段</title>
    <para>
     依<xref linkend="vnc-persistent-vncmanager-enable"/>中所述啟用 VNC 工作階段管理後，便可以使用您喜歡的 VNC 檢視器 (例如 <command>vncviewer</command> 或 Remmina) 正常連接到遠端工作階段。此時將顯示登入畫面。當您登入後，桌面環境的系統匣中將出現「VNC」圖示。按一下該圖示可開啟 <guimenu>VNC 工作階段</guimenu>視窗。如果該圖示未出現，或者您的桌面環境不支援將圖示放在系統匣中，請手動執行 <command>vncmanager-controller</command>。
    </para>
    <figure>
     <title>VNC 工作階段設定</title>
     <mediaobject>
      <imageobject role="fo">
       <imagedata fileref="vncmanager_session.png" width="85%"/>
      </imageobject>
      <imageobject role="html">
       <imagedata fileref="vncmanager_session.png" width="85%"/>
      </imageobject>
     </mediaobject>
    </figure>
    <para>
     有幾項設定會影響 VNC 工作階段的行為：
    </para>
    <variablelist>
     <varlistentry>
      <term><guimenu>非持續，私人</guimenu>
      </term>
      <listitem>
       <para>
        這相當於一次性工作階段。其他使用者將看不見此工作階段，它在您斷開連接後即會終止。如需相關資訊，請參閱<xref linkend="sec-vnc-one-time"/>。
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term><guimenu>持續，可見</guimenu>
      </term>
      <listitem>
       <para>
        其他使用者可以看見工作階段，它在您斷開連接後仍繼續執行。
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term><guimenu>工作階段名稱</guimenu>
      </term>
      <listitem>
       <para>
        您可以在此處指定持續工作階段的名稱，以便在重新連接時可以輕鬆識別它。
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term><guimenu>不需要密碼</guimenu>
      </term>
      <listitem>
       <para>
        任何人不必提供使用者身分證明登入即可存取工作階段。
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term><guimenu>需要使用者登入</guimenu>
      </term>
      <listitem>
       <para>
        需要使用有效的使用者名稱和密碼登入後，才能存取工作階段。該選項會在<guimenu>允許的使用者</guimenu>文字方塊中列出有效的使用者名稱。
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term><guimenu>一次允許一個用戶端</guimenu>
      </term>
      <listitem>
       <para>
        防止多個使用者同時加入該工作階段。
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term><guimenu>一次允許多個用戶端</guimenu>
      </term>
      <listitem>
       <para>
        允許多個使用者同時加入持續工作階段。適合用於遠端展示或訓練工作階段。
       </para>
      </listitem>
     </varlistentry>
    </variablelist>
    <para>
     按一下<guimenu>確定</guimenu>加以確認。
    </para>
   </sect3>
   <sect3 xml:id="vnc-persistent-vncmanager-join">
    <title>加入永久 VNC 工作階段</title>
    <para>
     依<xref linkend="vnc-persistent-vncmanager-configure"/>中所述設定持續 VNC 工作階段後，可透過 VNC 檢視器加入它。當 VNC 用戶端連接到伺服器後，系統將提示您選擇是要建立新工作階段，還是加入現有工作階段：
    </para>
    <figure>
     <title>加入永久 VNC 工作階段</title>
     <mediaobject>
      <imageobject role="fo">
       <imagedata fileref="vncmanager_whether.png" width="80%"/>
      </imageobject>
      <imageobject role="html">
       <imagedata fileref="vncmanager_whether.png" width="80%"/>
      </imageobject>
     </mediaobject>
    </figure>
    <para>
     當您按一下現有工作階段的名稱後，系統可能要求您輸入登入身分證明，具體取決於持續工作階段設定。
    </para>
   </sect3>
  </sect2>
 </sect1>
 
 <sect1 xml:id="sec-vnc-encrypt">
  <title>在 VNC 伺服器上設定加密</title>

  <para>
   如果 VNC 伺服器設定正確，則 VNC 伺服器與用戶端之間的所有通訊都會加密。驗證在工作階段開始時進行，實際的資料傳輸在驗證後開始。
  </para>

  <para>
   無論是一次性還是持續 VNC 工作階段，都可透過 <literal>server_args</literal> 行中 <command>/usr/bin/Xvnc</command> 指令的 <option>-securitytypes</option> 參數設定安全性選項。<option>-securitytypes</option> 參數會選取驗證方法和加密。它的選項如下：
  </para>

  <variablelist>
   <title>驗證</title>
   <varlistentry>
    <term>None、TLSNone、X509None</term>
    <listitem>
     <para>
      沒有驗證。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>VncAuth、TLSVnc、X509Vnc</term>
    <listitem>
     <para>
      驗證使用自訂密碼。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Plain、TLSPlain、X509Plain</term>
    <listitem>
     <para>
      驗證使用 PAM 來驗證使用者的密碼。
     </para>
    </listitem>
   </varlistentry>
  </variablelist>

  <variablelist>
   <title>加密</title>
   <varlistentry>
    <term>None、vncAuth、plain</term>
    <listitem>
     <para>
      不加密。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>TLSNone、TLSVnc、TLSPlain</term>
    <listitem>
     <para>
      匿名 TLS 加密。所有內容都會加密，但不驗證遠端主機。因此，您可以防護被動攻擊者，但不能防禦中間人攻擊者。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>X509None、X509Vnc、X509Plain</term>
    <listitem>
     <para>
      使用證書進行 TLS 加密。如果使用自行簽署的證書，則在第一次連接時，系統將要求您驗證證書。在以後的連接中，僅當證書有變更時，系統才會向您發出警告。因此，在第一次連接時，您可以防禦中間人攻擊之外的所有其他攻擊 (類似於使用一般的 SSH)。如果使用由證書管理中心簽署且與機器名稱相符的證書，您的安全將得到全面保障 (類似於使用一般的 HTTPS)。
     </para>
     <tip>
      <title>證書和金鑰的路徑</title>
      <para>
       如果您使用基於 X509 的加密，需要透過 <option>-X509Cert</option> 和 <option>-X509Key</option> 選項指定 X509 證書和金鑰的路徑。
      </para>
     </tip>
    </listitem>
   </varlistentry>
  </variablelist>

  <para>
   如果您選取多種安全性類型 (以逗號分隔)，將會使用用戶端與伺服器都支援且允許的第一種安全性。如此，您便可在伺服器上設定隨機加密。如果您需要支援不支援加密的 VNC 用戶端，此功能將相當實用。
  </para>

  <para>
   在用戶端上，您也可以指定允許的安全性類型，以防在您連接到已知啟用了加密的伺服器時遭到降級攻擊 (雖然在該情況下，我們的 vncviewer 會發出「連接未加密！」訊息來警告您)。
  </para>
 </sect1>
</chapter>
