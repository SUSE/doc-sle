<?xml version="1.0" encoding="UTF-8"?>
<sect1 xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="security_ldap_modules.xml" version="5.0" xml:id="sec-security-ldap-modules">
 
 <info>
  <title>管理插件</title>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:translation>yes</dm:translation>
  </dm:docmanager>
 </info>
  <para>
    使用以下命令可列出所有已启用和已禁用的可用插件。使用服务器的主机名而不是 389 Directory Server 的实例名称，例如，以下示例使用了主机名 <replaceable>LDAPSERVER1</replaceable>：
  </para>
<screen>
<prompt>&gt; </prompt><command>sudo</command> <command>dsconf -D "cn=Directory Manager" ldap://<replaceable>LDAPSERVER1</replaceable> plugin list</command>
Enter password for cn=Directory Manager on ldap://<replaceable>LDAPSERVER1</replaceable>: <replaceable>PASSWORD</replaceable>

7-bit check
Account Policy Plugin
Account Usability Plugin
ACL Plugin
ACL preoperation
[...]</screen>
  <para>
    以下命令会启用<xref linkend="sec-security-ldap-server-sssd"/>中提到的 <literal>MemberOf</literal> 插件。<literal>MemberOf</literal> 可以简化用户搜索，使用该插件，只需运行一条命令就能返回用户及其所属的任何组。如果不使用 <literal>MemberOf</literal> 的话，客户端必须运行多次查找才能找到用户的组成员资格。
  </para>
  <screen>
<prompt>&gt; </prompt><command>sudo</command> <command>dsconf -D "cn=Directory Manager" ldap://<replaceable>LDAPSERVER1</replaceable> plugin memberof enable</command>
</screen>
  <para>
    命令中使用的插件名称是小写的，因此这些名称与您列出插件时显示的名称不同。如果错误地输入了插件名称，您将看到有用的错误消息：
  </para>
<screen>dsconf instance plugin: error: invalid choice: 'MemberOf' (choose from
'memberof', 'automember', 'referential-integrity', 'root-dn', 'usn',
'account-policy', 'attr-uniq', 'dna', 'linked-attr', 'managed-entries',
'pass-through-auth', 'retro-changelog', 'posix-winsync', 'contentsync', 'list',
'show', 'set')</screen>
    <para>
    启用插件后，需要重启动服务器：
    </para>
    <screen>
<prompt>&gt; </prompt><command>sudo</command> <command>systemctl restart dirsrv@<replaceable>LDAPSERVER1</replaceable>.service</command>
</screen>

<para>
 接下来配置插件。以下示例启用 <literal>MemberOf</literal> 来搜索所有项。请使用您的实例名称而不是服务器的主机名：
</para>
<screen><prompt>&gt; </prompt><command>sudo</command> <command>dsconf <replaceable>LDAP1 plugin memberOf set --scope dc=example,dc=com</replaceable></command>
Successfully changed the cn=MemberOf Plugin,cn=plugins,cn=config</screen>

<para>
 启用并配置 <literal>MemberOf</literal> 插件后，所有新组和用户将自动成为 <literal>MemberOf</literal> 目标。但是，在启用该插件之前存在的任何用户和组不会自动成为 MemberOf 目标。必须手动标记这些用户和组：
</para>
<screen><prompt>&gt; </prompt><command>sudo</command> <command>dsidm LDAP1 user modify suzanne add:objectclass:nsmemberof</command>
Successfully modified uid=suzanne,ou=people,dc=ldap1,dc=com</screen>

<para>
 现在，只需运行一条命令即可列出 suzanne 的信息和组成员资格：
</para>
<screen><prompt>&gt; </prompt><command>sudo</command> <command>dsidm LDAP1 user get suzanne</command>
dn: uid=suzanne,ou=people,dc=ldap1,dc=com
cn: suzanne
displayName: Suzanne Geeko
gidNumber: 102
homeDirectory: /home/suzanne
memberOf: cn=SERVER_ADMINS,ou=groups,dc=ldap1,dc=com</screen>

<para>
 修改大量用户是一个繁重的任务。以下示例显示如何使用一条 <command>fixup</command> 命令使所有旧用户成为 <literal>MemberOf</literal> 目标：
</para>
<screen><prompt>&gt; </prompt><command>sudo</command> <command>dsconf LDAP1 plugin memberof fixup -f '(objectClass=*)' dc=LDAP1,dc=COM</command></screen>
</sect1>
