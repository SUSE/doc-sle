<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="virt-crash-dump.xml" version="5.0" xml:id="virt-crash-dump">
  <title>创建 VM Guest 的崩溃转储</title>
  <info>
    <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
      <dm:bugtracker/>
      <dm:translation>yes</dm:translation>
    </dm:docmanager>
  </info>
  <sect1 xml:id="virt-crash-dump-introduction">
    <title>简介</title>

    <para>
      每当 VM 崩溃时，有用的做法是收集 VM 内存的核心转储以进行调试和分析。对于物理机，Kexec 和 Kdump 会负责收集崩溃转储。对于虚拟机，如何收集崩溃转储取决于 Guest 是全虚拟化 (FV) 还是半虚拟化 (PV) 计算机。
    </para>
  </sect1>
  <sect1 xml:id="virt-crash-dump-fv">
    <title>为全虚拟化计算机创建崩溃转储</title>

    <para>
      要查看 FV 计算机的崩溃转储，请使用适用于物理机的相同过程 — 使用 Kexec 和 Kdump。
    </para>
  </sect1>
  <sect1 xml:id="virt-crash-dump-pv">
    <title>为半虚拟化计算机创建崩溃转储</title>

    <para>
      与在 FV 中不同，Kexec/Kdump 在半虚拟化计算机中不起作用。PV Guest 的崩溃转储必须由主机工具堆栈执行。如果将 <command>xl</command> 工具堆栈用于 Xen domU，<command>xl dump-core</command> 命令将生成转储。对于基于 <systemitem class="library">libvirt</systemitem> 的 VM Guest，<command>virsh dump</command> 命令可提供相同的功能。
    </para>

    <para>
      您可以使用 VM Guest 配置中的 <option>on_crash</option> 设置来配置核心转储自动收集。此设置将告知主机工具堆栈在 VM Guest 遇到崩溃时该如何处理。<command>xl</command> 和 <systemitem class="library">libvirt</systemitem> 中的默认值均为 <option>destroy</option>。可自动收集核心转储的有用选项为 <option>coredump-destroy</option> 和 <option>coredump-restart</option>。
    </para>
  </sect1>
  <sect1 xml:id="virt-crash-dump-more-info">
    <title>附加信息</title>

    <itemizedlist>
      <listitem>
        <para>
          <xref linkend="sec-virtualization-introduction-fvpv"/>中介绍了全虚拟化与半虚拟化虚拟机之间的差别。
        </para>
      </listitem>
      <listitem>
        <para>
          <xref linkend="cha-tuning-kexec"/>中提供了有关 Kexec/Kdump 机制的详细信息。
        </para>
      </listitem>
      <listitem>
        <para>
          有关 <command>xl</command> 配置语法的详细信息，请参见 xl.cfg 手册页 (<command>man 5 xl.cfg</command>)。
        </para>
      </listitem>
      <listitem>
        <para>
          有关 <systemitem class="library">libvirt</systemitem> XML 设置的细节，请参见 https://libvirt.org/formatdomain.html#events-configuration。
        </para>
      </listitem>
    </itemizedlist>
  </sect1>
</chapter>
