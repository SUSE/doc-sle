<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="deployment_images_description.xml" version="5.0" xml:id="cha-images-description">
 <title>预构建映像的说明</title>
 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:bugtracker/>
   <dm:translation>yes</dm:translation>
  </dm:docmanager>
 </info>
 <para>
  SLE Micro 可通过预构建映像部署。目前提供两种类型的映像：raw 磁盘映像和自行安装 ISO。
 </para>
 <para>
  SLE Micro 提供适用于 AMD64/Intel 64 体系结构、IBM Z ZSeries 以及 AArch64 的 raw 映像。目前仅提供适用于 AMD64/Intel 64 体系结构的自行安装映像。这些预构建映像可在首次引导时使用 Ignition 或 Combustion 进行配置。引导加载器会检测首次引导；有关详细信息，请参见<xref linkend="sec-first-boot"/>。每个映像都有默认挂载的子卷（如<xref linkend="sec-default-partitioning"/>中所述）。<xref linkend="cha-images-procedure"/> 中介绍了这些映像的部署过程。
 </para>
 <important>
  <title>不要将防火墙与 Podman 搭配使用</title>
  <para>
   将防火墙与 Podman 搭配使用可能会导致与 Podman 相关的防火墙规则在 <literal>firewalld</literal> 服务重新装载后丢失。因此，如果您要使用 Podman，建议将防火墙保持禁用状态。
  </para>
 </important>
 <note>
  <title>SLE Micro 作为 VM 主机服务器运行</title>
  <para>
   SLE Micro 可作为 KVM 主机服务器运行 — Xen 不受支持。但将 SLE Micro 作为 VM 主机服务器运行有一些限制；有关细节，请参见 <link xlink:href="https://documentation.suse.com/sles/15-SP3/html/SLES-all/cha-virt-support.html">virtualization
   limits and support</link>。
  </para>
 </note>
 <sect1 xml:id="sec-default-partitioning">
  <title>默认分区</title>

  <para>
   预构建映像会使用默认的分区方案，您可使用 Ignition 或 Combustion 在首次引导期间进行更改。有关将系统重新分区的过程，请参见<xref linkend="sec-ignition-configuration"/>或<xref linkend="sec-combustion-script"/>。
  </para>

  <important>
   <title>根文件系统必须使用 Btrfs</title>
   <para>
    如果您要对默认分区方案进行任何更改，根文件系统必须是 btrfs。
   </para>
  </important>

  <para>
   每个映像都具有以下子卷：
  </para>

<screen>
 /home
 /root
 /opt
 /srv 
 /usr/local
 /var
 </screen>

  <para>
   映像还挂载了默认用于引导的子卷。具体挂载的子卷视体系结构而定。
  </para>

  <para>
   <literal>/etc</literal> 目录会挂载为 OverlayFS，其中上一级目录挂载到 <filename>/var/lib/overlay/1/etc/</filename>。有关细节，请参见<xref linkend="sec-etc-overlay"/>。
  </para>

  <para>
   您可以通过 <filename>/etc/fstab</filename> 中的 <literal>x-initrd.mount</literal> 选项来识别默认挂载的子卷。其他子卷或分区必须通过 Ignition 或 Combustion 进行配置。
  </para>
 </sect1>
 <sect1 xml:id="sec-first-boot">
  <title>首次引导检测</title>

  <para>
   配置仅在首次引导时运行。为了区分首次引导和后续引导，系统会在首次引导后创建标志文件 <filename>/boot/writable/firstboot_happened</filename>。如果文件系统中不存在该文件，系统会将属性 <literal>ignition.firstboot</literal> 传递到内核命令行，这样会触发 Ignition 和 Combustion 运行（在 <filename>initramfs</filename> 中）。完成首次引导后，系统便会创建 <filename>/boot/writable/firstboot_happened</filename> 标志文件。
  </para>

  <note>
   <title>系统始终会创建该标志文件</title>
   <para>
    即使由于配置文件错误或缺失导致配置失败，系统也会创建 <filename>/boot/writable/firstboot_happened</filename> 标志文件。
   </para>
   
   <para>
    您可以通过将 <literal>ignition.firstboot</literal> 属性传递给内核命令行或删除 <filename>/boot/writable/firstboot_happened</filename> 标志文件，来强制在后续引导时进行首次引导配置。
   </para>
  </note>
 </sect1>
</chapter>
