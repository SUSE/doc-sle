<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="deployment_mksusecd.xml" version="5.0" role="General" xml:id="cha-deployment-prep-mksusecd">
 <title>使用 mksusecd 自訂安裝影像</title>
 <info>
  <abstract>
   <para>
    <command>mksusecd</command> 是一個可以建立自訂安裝影像的有用工具。使用此工具可以修改一般的 SUSE Linux Enterprise 安裝影像、新增和移除檔案、建立精簡的網路安裝影像、自訂開機和儲存庫選項，以及建立一個精簡的開機影像，做為從 PXE 伺服器將系統開機的替代方式。
   </para>
  </abstract>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:bugtracker/>
   <dm:translation>yes</dm:translation>
  </dm:docmanager>
 </info>
 <sect1 xml:id="sec-deployment-install-mksusecd">
  <title>安裝 mksusecd</title>

  <para>
   在 SLE 15 中，<command>mksusecd</command> 位於 <literal>Development Tools 模組</literal>中。如果您尚未啟用此模組，則必須將其啟用。首先需使用 <command>zypper</command> 確定確切的模組名稱和 <command>SUSEConnect</command> 啟用指令：
  </para>

<screen><prompt>&gt; </prompt>zypper search-packages mksusecd
Following packages were found in following modules:

Package              Module or Repository
-------------------- -------------------------------------------------------------------
---------------------- -----------------------------------------------------------------
mksusecd             Development Tools Module (sle-module-development-tools/15.4/x86_64)
                       SUSEConnect --product sle-module-development-tools/15.4/x86_64

To activate the respective module or product, use SUSEConnect --product.
Use SUSEConnect --help for more details.</screen>

  <para>
   使用 SUSEConnect 啟用該模組：
  </para>

<screen><prompt>&gt; </prompt><command>sudo</command> SUSEConnect --product sle-module-development-tools/15.4/x86_64</screen>

  <para>
   安裝 <command>mksusecd</command>：
  </para>

<screen><prompt>&gt; </prompt><command>sudo</command> zypper se mksusecd</screen>

  <para>
   執行 <command>mksusecd --help</command> 查看完整的指令列表。
  </para>

  <para>
   建立自訂影像後，請使用您喜好的磁碟寫入程式 (例如 Brasero 或 <command>mybashburn</command>) 將此影像燒錄到 CD/DVD 媒體，或使用 <command>dd</command> 指令建立可開機的 USB 隨身碟。確定裝置未掛接，然後執行以下指令：
  </para>

<screen><prompt role="root"># </prompt><command>dd</command> if=<replaceable>min-install.iso</replaceable> of=/dev/<replaceable>SDB</replaceable> bs=4M</screen>

  <para>
   然後，新的可開機裝置可供您使用。
  </para>
 </sect1>
 <sect1 xml:id="sec-deployment-prep-boot-mksusecd">
  <title>建立精簡開機影像</title>

  <para>
   使用 <command>mksusecd</command> 建立一個精簡開機影像，以便從 CD/DVD 或 USB 隨身碟啟動用戶端機器，而無需從 PXE 開機伺服器將其啟動。精簡開機影像將啟動核心和 initrd，然後，將從本地 NFS 伺服器擷取剩餘的安裝檔案 (請參閱<xref linkend="sec-deployment-instserver-sles9"/>)。
  </para>

  <para>
   執行以下指令以建立精簡 ISO 影像：
  </para>

<screen><prompt>&gt; </prompt><command>sudo</command> <command>mksusecd</command> --create <replaceable>min-install.iso</replaceable> \
--net=nfs://<replaceable>192.168.1.1:/srv/install/</replaceable><replaceable>ARCH</replaceable>/<replaceable>OS_VERSION</replaceable>/<replaceable>SP_VERSION</replaceable>/cd1  \
/srv/tftpboot/EFI/<replaceable>ARCH</replaceable>/boot</screen>

  <para>
   以您自己的地址取代 NFS 伺服器地址。以目標系統架構對應的目錄取代 <replaceable>ARCH</replaceable>。另外，請依據<xref linkend="sec-deployment-instserver-sles9"/>中的路徑取代 <replaceable>OS_version</replaceable> 和 <replaceable>SP_VERSION</replaceable> (Service Pack)。
  </para>



  


 </sect1>
 
 <sect1 xml:id="sec-deployment-custom-image-boot">
  <title>設定預設的核心開機參數</title>

  <para>
   無需等待出現關於輸入自訂核心開機參數的開機提示，您可以在自訂的 <command>mksusecd</command> 影像中設定這些參數：
  </para>

<screen><prompt>&gt; </prompt><command>sudo</command> mksusecd --create <replaceable>install.iso</replaceable> \
--boot "<replaceable>textmode=1 splash=silent mitigations=auto</replaceable>"</screen>

  <para>
   透過查詢 <filename>/proc</filename>，驗證啟動後是否正確載入了您的自訂參數：
  </para>

<screen><prompt>&gt; </prompt>cat /proc/cmdline</screen>
 </sect1>
 <sect1 xml:id="sec-deployment-custom-modules">
  <title>自訂模組、延伸和儲存庫</title>

  <para>
   SUSE Linux Enterprise 15 支援不同產品元件的模組 (請不要與核心模組相混淆) 和延伸。它們是預設基本系統的附加產品，包括 Development Tools、Desktop Applications 和 SUSE Linux Enterprise Live Patching。如需詳細資訊，請參閱《<citetitle>Modules and Extensions Quick Start</citetitle>》(模組和延伸快速入門) 指南。
  </para>

  <para>
   使用 <command>mksusecd</command> 可以建立一個包含全部所需附加模組和延伸的安裝影像。首先，如以下範例所示查詢 SUSE Linux Enterprise <phrase role="productnumber"><phrase os="sles;sled">15 SP4</phrase></phrase> 的現有影像：
  </para>

  <screen><prompt>&gt; </prompt><command>sudo</command> mksusecd --list-repos SLE-15-SP4-Full-<replaceable>ARCH</replaceable>-GM-media1.iso
Repositories:
  SLES15-SP4 [15.4-0]
  SLES15 [15.4-0]
  Basesystem-Module [15.4-0]
  SUSE-CAP-Tools-Module [15.4-0]
  Containers-Module [15.4-0]
  Desktop-Applications-Module [15.4-0]
  Development-Tools-Module [15.4-0]
</screen>

  <para>
   建立一個新的安裝影像，該影像是從您選取並由系統自動啟用的模組、延伸和儲存庫建構的：
  </para>

<screen><prompt>&gt; </prompt><command>sudo</command> mksusecd --create <replaceable>myinstaller.iso</replaceable>\
  --enable-repos auto --include-repos <replaceable>Basesystem-Module,Desktop-Applications-Module</replaceable> \
  SLE-15-SP4-Online-<replaceable>ARCH</replaceable>-GM-media1.iso \
  SLE-15-SP4-Full-<replaceable>ARCH</replaceable>-GM-media1.iso
  </screen>

  <para>
   這會建立 <filename>add_on_products.xml</filename> 檔案並將其新增至新影像。請以 <command>--enable-repos ask</command> 取代 <command>--enable-repos auto</command>，使安裝程式顯示一個用於選擇模組的對話方塊。
  </para>

  <note>
   <title>AutoYaST 控制檔案</title>
   <para>
    如果您使用 AutoYaST 來設定安裝，則使用 <command>--enable-repos</command> 選項時，無需在 AutoYaST 控制檔案中列出這些模組。
   </para>
  </note>
 </sect1>
 <sect1 xml:id="sec-deployment-custom-netinstall">
  <title>建立精簡 netinstall ISO</title>

  <para>
   若要建立一個精簡安裝影像以啟動網路安裝，請使用 <command>--nano</command> 選項：
  </para>

<screen><prompt>&gt; </prompt><command>sudo</command> mksusecd --create <replaceable>netinstall.iso</replaceable> \
--nano SLE-15-SP4-Online-<replaceable>ARCH</replaceable>-GM-media1.iso</screen>
 </sect1>
 <sect1 xml:id="sec-deployment-custom-repo">
  <title>變更預設儲存庫</title>

  <para>
   若要設定不同的儲存庫 (例如您自己的本地儲存庫)，請使用 <command>--net</command> 選項：
  </para>

<screen><prompt>&gt; </prompt><command>sudo</command> mksusecd --create <replaceable>localinstall.iso</replaceable> \
--net "https://example.com/local" SLE-15-SP4-Online-<replaceable>ARCH</replaceable>-GM-media1.iso</screen>
 </sect1>
</chapter>
