<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="grub2.xml" version="5.0" xml:id="cha-grub2"> <title>Der Bootloader GRUB 2</title>
 <info>
      <abstract>
        <para>
    In diesem Kapitel wird die Konfiguration von GRUB 2, dem unter <phrase role="productname"><phrase os="sled">SUSE Linux Enterprise Desktop</phrase></phrase> verwendeten Bootloader, beschrieben. <phrase os="sled;sles">Diese Anwendung ist der Nachfolger des bisherigen Bootloaders GRUB (nunmehr als <quote>GRUB Legacy</quote> bezeichnet). GRUB 2 ist seit Version 12 als standardmäßiger Bootloader in <phrase role="productname"><phrase os="sled">SUSE® Linux Enterprise Desktop</phrase></phrase> eingebunden.</phrase> Für die Konfiguration der wichtigsten Einstellungen steht ein YaST-Modul bereit. Eine Übersicht über den Bootvorgang finden Sie in <xref linkend="cha-boot"/>. Weitere Informationen zur Unterstützung von Secure Boot finden Sie in <xref linkend="cha-uefi"/>.
   </para>
      </abstract>
      <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
        <dm:bugtracker/>
        <dm:translation>yes</dm:translation>
      </dm:docmanager>
    </info>
    <sect1 xml:id="sec-grub2-new-features">
  <title>Hauptunterschiede zwischen GRUB Legacy und GRUB 2</title>

  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>
     Die Konfiguration wird in unterschiedlichen Dateien gespeichert.
    </para>
   </listitem>
   <listitem>
    <para>
     Es werden mehr Dateisysteme unterstützt (z. B. Btrfs).
    </para>
   </listitem>
   <listitem>
    <para>
     Dateien auf LVM- oder RAID-Geräten können direkt gelesen werden.
    </para>
   </listitem>
   <listitem>
    <para>
     Die Benutzeroberfläche kann übersetzt und mit Themen gestaltet werden.
    </para>
   </listitem>
   <listitem>
    <para>
     Es steht ein Mechanismus zum Laden von Modulen bereit, die weitere Funktionen (z. B. Dateisysteme) unterstützen
    </para>
   </listitem>
   <listitem>
    <para>
     Es werden automatisch Boot-Einträge für andere Kernel und Betriebssysteme (z. B. Windows) gesucht und erzeugt.
    </para>
   </listitem>
   <listitem>
    <para>
     Eine minimale Konsole (ähnlich wie Bash aufgebaut) steht zur Verfügung.
    </para>
   </listitem>
  </itemizedlist>
 </sect1>
 <sect1 xml:id="sec-grub2-file-structure">
  <title>Konfigurationsdateistruktur</title>

  <para>
   Die Konfiguration von GRUB 2 umfasst die folgenden Dateien:
  </para>

  <variablelist>
   <varlistentry>
    <term><filename>/boot/grub2/grub.cfg</filename>
    </term>
    <listitem>
     <para>
      Diese Datei enthält die Konfiguration der Menüpunkte in GRUB 2. Die Datei ersetzt die Datei <filename>menu.lst</filename> in GRUB Legacy. <filename>grub.cfg</filename> sollte nicht bearbeitet werden. Die Datei wird automatisch durch das Kommando <command>grub2-mkconfig -o /boot/grub2/grub.cfg</command> generiert.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><filename>/boot/grub2/custom.cfg</filename>
    </term>
    <listitem>
     <para>
      Diese optionale Datei wird beim Booten direkt aus <filename>grub.cfg</filename> erzeugt. Hiermit können Sie benutzerdefinierte Einträge in das Bootmenü aufnehmen. Ab <phrase role="productname"><phrase os="sled">SUSE Linux Enterprise Desktop</phrase></phrase> <phrase os="sles;sled">12 SP2</phrase> werden diese Einträge auch geparst, wenn <command>grub-once</command> verwendet wird.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><filename>/etc/default/grub</filename>
    </term>
    <listitem>
     <para>
      Diese Datei steuert die Benutzereinstellungen für GRUB 2 und enthält in der Regel zusätzliche Umgebungseinstellungen, beispielsweise Hintergründe und Themen.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Skripte unter <filename>/etc/grub.d/</filename>
    </term>
    <listitem>
     <para>
      Die Skripte in diesem Verzeichnis werden bei Ausführung des Kommandos <command>grub2-mkconfig -o /boot/grub2/grub.cfg</command> gelesen. Die zugehörigen Anweisungen werden in die Hauptkonfigurationsdatei <filename>/boot/grub/grub.cfg</filename> integriert.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry xml:id="vle-grub2-sysconfig">
    <term><filename>/etc/sysconfig/bootloader</filename>
    </term>
    <listitem>
     <para>
      Diese Konfigurationsdatei enthält einige Grundeinstellungen wie den Bootloader-Typ und ob die UEFI Secure Boot-Unterstützung aktiviert werden soll.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><filename arch="x86_64">/boot/grub2/x86_64-efi</filename>, <filename arch="power">/boot/grub2/power-ieee1275</filename>
    </term>
    <listitem>
     <para>
      Diese Konfigurationsdateien enthalten architekturspezifische Optionen.
     </para>
    </listitem>
   </varlistentry>
  </variablelist>

  <para>
   GRUB 2 kann auf mehrere Weisen gesteuert werden. Booteinträge aus einer vorhandenen Konfiguration können im grafischen Menü (Eröffnungsbildschirm) ausgewählt werden. Die Konfiguration wird aus der Datei <filename>/boot/grub2/grub.cfg</filename> geladen, die aus anderen Konfigurationsdateien kompiliert wird (siehe unten). Alle GRUB 2-Konfigurationsdateien gelten als Systemdateien und Sie benötigen <systemitem class="username">root</systemitem>-Berechtigungen, um sie bearbeiten zu können.
  </para>

  <note>
   <title>Aktivieren von Konfigurationsänderungen</title>
   <para>
    Nach der manuellen Bearbeitung der GRUB 2-Konfigurationsdateien müssen Sie <command>grub2-mkconfig -o /boot/grub2/grub.cfg</command> ausführen, um die Änderungen zu aktivieren. Sollten Sie die Konfiguration jedoch mit YaST geändert haben, ist dies nicht nötig, da YaST dieses Kommando automatisch ausführt.
   </para>
  </note>

  <sect2 xml:id="sec-grub2-cfg">
   <title>Die Datei <filename>/boot/grub2/grub.cfg</filename></title>
   <para>
    Hinter dem grafischen Eröffnungsbildschirm mit dem Bootmenü steht die GRUB 2-Konfigurationsdatei <filename>/boot/grub2/grub.cfg</filename>, die alle Informationen zu allen Partitionen oder Betriebssystemen enthält, die über das Menü gebootet werden können.
   </para>
   <para>
    GRUB 2 liest bei jedem Systemstart die Menüdatei direkt vom Dateisystem neu ein. Es besteht also kein Bedarf, GRUB 2 nach jeder Änderung an der Konfigurationsdatei neu zu installieren. Beim Installieren oder Entfernen von Kernels wird <filename>grub.cfg</filename> automatisch neu aufgebaut.
   </para>
   <para>
    <filename>grub.cfg</filename> wird aus der Datei <filename>/etc/default/grub</filename> und Skripten im <filename>/etc/grub.d/</filename>-Verzeichnis kompiliert, wenn das Kommando <command>grub2-mkconfig -o /boot/grub2/grub.cfg</command> ausgeführt wird. Ändern Sie die Datei daher in keinem Fall manuell. Bearbeiten Sie stattdessen die zugehörigen Ursprungsdateien, oder bearbeiten Sie die Konfiguration mit dem YaST-<guimenu>Bootloader</guimenu>-Modul (siehe <xref linkend="sec-grub2-yast2-config"/>).
   </para>
  </sect2>

  <sect2 xml:id="sec-grub2-etc-default-grub">
   <title>Die Datei <filename>/etc/default/grub</filename></title>
   <para>
    Hier finden Sie allgemeinere Optionen für GRUB 2, beispielsweise den Zeitraum, über den das Menü angezeigt wird, oder das standardmäßig zu bootende Betriebssystem. Mit dem folgenden Kommando erhalten Sie eine Liste aller verfügbaren Optionen:
   </para>
<screen><prompt>tux &gt; </prompt>grep "export GRUB_DEFAULT" -A50 /usr/sbin/grub2-mkconfig | grep GRUB_</screen>
   <para>
    Neben den bereits definierten Variablen kann der Benutzer eigene Variablen festlegen und später in den Skripten im Verzeichnis <filename>/etc/grub.d</filename> verwenden.
   </para>
   <para>
    Aktualisieren Sie nach der Bearbeitung von <filename>/etc/default/grub</filename> die Hauptkonfigurationsdatei mit <command>grub2-mkconfig -o /boot/grub2/grub.cfg</command>.</para>
   <note>
    <title>Bereich</title>
    <remark>
     Do we really still have Xen-specific kernels? - sknorr, 2017-05-08
    </remark>
    <para>
     Alle in dieser Datei festgelegten Optionen sind allgemeine Optionen, die für alle Booteinträge gelten. Mit den Konfigurationsoptionen GRUB_*_XEN_* legen Sie besondere Optionen für Xen-Kernel oder den Xen-Hypervisor fest. Weitere Informationen finden Sie unten.
    </para>
   </note>
   <variablelist>
    <varlistentry>
     <term><literal>GRUB_DEFAULT</literal>
     </term>
     <listitem>
      <para>
       Hiermit legen Sie den Bootmenüeintrag fest, der standardmäßig gebootet werden soll. Als Wert ist eine Zahl, der vollständige Name eines Menüeintrags oder der Eintrag <quote>saved</quote> (Gespeichert) zulässig.
      </para>
      <para>
       Mit <literal>GRUB_DEFAULT=2</literal> wird der dritte Bootmenüeintrag gebootet (gezählt ab 0).
      </para>
      <para>
       Mit <literal>GRUB_DEFAULT="2&gt;0"</literal> wird der erste Untermenüeintrag im dritten übergeordneten Menüeintrag gebootet.
      </para>
      <para>
       Mit <literal>GRUB_DEFAULT="Beispiel für Bootmenüeintrag"</literal> wird der Menüeintrag mit dem Titel <quote>Beispiel für Bootmenüeintrag</quote> gebootet.
      </para>
      <para>
       Mit <literal>GRUB_DEFAULT=saved</literal> wird der Eintrag gebootet, der mit dem Kommando <command>grub2-once</command> oder <command>grub2-set-default</command> angegeben wurde. Während mit <command>grub2-reboot</command> der Standard-Booteintrag nur für das nächste Neubooten festgelegt wird, bestimmt <command>grub2-set-default</command> den Standard-Booteintrag bis zur nächsten Änderung. <command>grub2-editenv list</command> zeigt den nächsten Booteintrag an.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>GRUB_HIDDEN_TIMEOUT</literal>
     </term>
     <listitem>
      <para>
       Hiermit wird ein bestimmter Zeitraum (in Sekunden) abgewartet, bis der Benutzer eine Taste drückt. Während dieses Zeitraums wird erst dann ein Menü angezeigt, wenn der Benutzer eine Taste drückt. Wird während des angegebenen Zeitraums keine Taste gedrückt, so wird die Steuerung an <literal>GRUB_TIMEOUT</literal> übergeben. <literal>GRUB_HIDDEN_TIMEOUT=0</literal> prüft zunächst, ob <keycap function="shift"/> gedrückt wurde. Falls ja, wird das Bootmenü angezeigt; ansonsten wird sofort der Standard-Menüeintrag gebootet. Dies ist die Standardeinstellung, wenn GRUB 2 nur ein bootfähiges Betriebssystem erkennt.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>GRUB_HIDDEN_TIMEOUT_QUIET</literal>
     </term>
     <listitem>
      <para>
       Bei <literal>false</literal> wird ein Countdown-Zähler auf einem leeren Bildschirm angezeigt, wenn die Funktion <literal>GRUB_HIDDEN_TIMEOUT</literal> aktiv ist.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>GRUB_TIMEOUT</literal>
     </term>
     <listitem>
      <para>
       Dies ist der Zeitraum (in Sekunden), über den das Bootmenü angezeigt wird, bevor der Standard-Booteintrag automatisch gebootet wird. Sobald Sie eine Taste drücken, wird die Zeitbegrenzung aufgehoben und GRUB 2 wartet darauf, dass Sie manuell die gewünschte Auswahl treffen. Mit <literal>GRUB_TIMEOUT=-1</literal> wird das Menü so lange angezeigt, bis Sie den gewünschten Booteintrag manuell auswählen.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>GRUB_CMDLINE_LINUX</literal>
     </term>
     <listitem>
      <para>
       Die Einträge in dieser Zeile werden an die Booteinträge für den normalen Modus und den Wiederherstellungsmodus angehängt. Hiermit können Sie zusätzliche Kernel-Parameter im Booteintrag angeben.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>GRUB_CMDLINE_LINUX_DEFAULT</literal>
     </term>
     <listitem>
      <para>
       Dieser Eintrag entspricht <literal>GRUB_CMDLINE_LINUX</literal>, jedoch mit dem Unterschied, dass die Einträge nur im normalen Modus angehängt werden.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>GRUB_CMDLINE_LINUX_RECOVERY</literal>
     </term>
     <listitem>
      <para>
       Dieser Eintrag entspricht <literal>GRUB_CMDLINE_LINUX</literal>, jedoch mit dem Unterschied, dass die Einträge nur im Wiederherstellungsmodus angehängt werden.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>GRUB_CMDLINE_LINUX_XEN_REPLACE</literal>
     </term>
     <listitem>
      <para>
       Dieser Eintrag ersetzt sämtliche <literal>GRUB_CMDLINE_LINUX</literal>-Parameter für alle Xen-Booteinträge.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>GRUB_CMDLINE_LINUX_XEN_REPLACE_DEFAULT</literal>
     </term>
     <listitem>
      <para>
       Dieser Eintrag entspricht <literal>GRUB_CMDLINE_LINUX_XEN_REPLACE</literal>, jedoch mit dem Unterschied, dass nur Parameter für <literal>GRUB_CMDLINE_LINUX_DEFAULT</literal> ersetzt werden.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>GRUB_CMDLINE_XEN</literal>
     </term>
     <listitem>
      <para>
       Mit diesem Eintrag werden die Kernel-Parameter ausschließlich für den Xen-Gastkernel bestimmt; die Funktionsweise entspricht <literal>GRUB_CMDLINE_LINUX</literal>.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>GRUB_CMDLINE_XEN_DEFAULT</literal>
     </term>
     <listitem>
      <para>
       Dieser Eintrag entspricht <literal>GRUB_CMDLINE_XEN</literal>; die Funktionsweise entspricht <literal>GRUB_CMDLINE_LINUX_DEFAULT</literal>.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>GRUB_TERMINAL</literal>
     </term>
     <listitem>
      <para>
       Hiermit wird ein Eingabe-/Ausgabe-Terminal-Geräte angegeben und aktiviert. Mögliche Werte sind <literal>console</literal> (PC-BIOS- und EFI-Konsolen), <literal>serial</literal> (serielle Terminals), <literal>ofconsole</literal> (Open-Firmware-Konsolen) sowie der Standardwert <literal>gfxterm</literal> (Ausgabe im Grafikmodus). Sollen mehrere Geräte aktiviert werden, setzen Sie die Optionen in Anführungszeichen, beispielsweise <literal>GRUB_TERMINAL="console serial"</literal>.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>GRUB_GFXMODE</literal>
     </term>
     <listitem>
      <para>
       Dies ist die Auflösung für das grafische Terminal <literal>gfxterm</literal>. Hierbei sind ausschließlich die Modi verfügbar, die von Ihrer Grafikkarte (VBE) unterstützt werden. Die Standardeinstellung lautet „auto“; hiermit wird nach Möglichkeit eine bevorzugte Auflösung ausgewählt. Mit dem Kommando <command>videoinfo</command> in der GRUB 2-Kommandozeile werden die verfügbaren Bildschirmauflösungen für GRUB 2 angezeigt. Zum Öffnen der Kommandozeile drücken Sie <keycap>C</keycap>, wenn der GRUB 2-Bootmenübildschirm angezeigt wird.
      </para>
      <para>
       Außerdem können Sie eine Farbtiefe an die Einstellung für die Auflösung anhängen, z. B. <literal>GRUB_GFXMODE=1280x1024x24</literal>.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>GRUB_BACKGROUND</literal>
     </term>
     <listitem>
      <para>
       Hiermit legen Sie ein Hintergrundbild für das grafische Terminal <literal>gfxterm</literal> fest. Das Bild muss in einer Datei gespeichert sein, die GRUB 2 beim Booten lesen kann, und die Dateinamenerweiterung muss <literal>.png</literal>, <literal>.tga</literal>, <literal>.jpg</literal> oder <literal>.jpeg</literal> lauten. Falls erforderlich, wird das Bild auf die Bildschirmgröße skaliert.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>GRUB_DISABLE_OS_PROBER</literal>
     </term>
     <listitem>
      <para>
       Bei <literal>true</literal> wird die automatische Suche nach anderen Betriebssystemen deaktiviert. Nur die Kernel-Images in <filename>/boot/</filename> und die Optionen aus Ihren eigenen Skripten in <filename>/etc/grub.d/</filename> werden erkannt.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>SUSE_BTRFS_SNAPSHOT_BOOTING</literal>
     </term>
     <listitem>
      <para>
       Bei <literal>true</literal> kann GRUB 2 direkt in Snapper-Snapshots booten. Weitere Informationen finden Sie im <xref linkend="sec-snapper-snapshot-boot"/>.
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
   <para>
    Eine vollständige Liste der Optionen finden Sie im <link xlink:href="http://www.gnu.org/software/grub/manual/grub.html#Simple-configuration">Handbuch zu GNU GRUB</link>.
   </para>
  </sect2>

  <sect2 xml:id="sec-grub2-etc-grub-d">
   <title>Skripte in <filename>/etc/grub.d</filename></title>
   <para>
    Die Skripte in diesem Verzeichnis werden bei Ausführung des Kommandos <command>grub2-mkconfig -o /boot/grub2/grub.cfg</command> gelesen. Deren Anweisungen sind in <filename>/boot/grub2/grub.cfg</filename> integriert. Die Reihenfolge der Menüpunkte in <filename>grub.cfg</filename> ergibt sich aus der Reihenfolge, in der die Dateien in diesem Verzeichnis ausgeführt werden. Dateien mit einer Zahl am Anfang des Dateinamens werden zuerst ausgeführt, beginnend mit der niedrigsten Zahl. <filename>00_header</filename> wird beispielsweise vor <filename>10_linux</filename> ausgeführt, das wiederum vor <filename>40_custom</filename> ausgeführt wird. Dateien mit einem Buchstaben an der ersten Stelle im Dateinamen werden nach den Dateien mit Zahlen am Anfang ausgeführt. Nur ausführbare Dateien erzeugen beim Ausführen von <command>grub2-mkconfig</command> eine Ausgabe in <filename>grub.cfg</filename>. Standardmäßig sind alle Dateien im Verzeichnis <filename>/etc/grub.d</filename> ausführbar.
   </para>
   <tip>
    <title>Permanenter benutzerdefinierter Inhalt in <filename>grub.cfg</filename></title>
    <para>
     <filename>/boot/grub2/grub.cfg</filename> wird bei jedem Ausführen von <command>grub2-mkconfig</command> neu kompiliert, sodass benutzerdefinierte Inhalte verloren gehen. Wenn die Zeilen direkt in <filename>/boot/grub2/grub.cfg</filename> eingefügt werden, damit sie nach dem Ausführen von <command>grub2-mkconfig</command> nicht verloren gehen, fügen Sie sie zwischen den folgenden Stellen ein:
    </para>
    <screen>### BEGIN /etc/grub.d/90_persistent ###</screen>
    <para>
     und
    </para>
    <screen>### END /etc/grub.d/90_persistent ###</screen>
    <para>
     Das Skript <filename>90_persistent</filename> sorgt dafür, dass diese Inhalte erhalten bleiben.
    </para>
    <para>
     Hier finden Sie eine Liste der wichtigsten Skripten:
    </para>
   </tip>
   <variablelist>
    <varlistentry>
     <term><filename>00_header</filename>
     </term>
     <listitem>
      <para>
       Hiermit werden Umgebungsvariablen festgelegt, beispielsweise der Speicherort von Systemdateien, Anzeigeeinstellungen, Themen und zuvor gespeicherte Einträge. Außerdem werden die Voreinstellungen aus der Datei <filename>/etc/default/grub</filename> importiert. In der Regel sind keine Änderungen an dieser Datei notwendig.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><filename>10_linux</filename>
     </term>
     <listitem>
      <para>
       Hiermit werden Linux-Kernel im root-Gerät erkannt und relevante Menüeinträge erstellt. Hierbei wird auch die zugehörige Option für den Wiederherstellungsmodus berücksichtigt (sofern aktiviert). Auf der Hauptmenüseite wird nur der jüngste Kernel angezeigt; weitere Kernel werden in einem Untermenü aufgeführt.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><filename>30_os-prober</filename>
     </term>
     <listitem>
      <para>
       Bei diesem Skript werden Linux und andere Betriebssysteme mithilfe von <command>os-prober</command> gesucht und die Ergebnisse werden in das GRUB 2-Menü eingetragen. Das Skript bietet Abschnitte für die Erkennung bestimmter anderer Betriebssysteme (z. B. Windows oder macOS).
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><filename>40_custom</filename>
     </term>
     <listitem>
      <para>
       Mit dieser Datei können Sie schnell und einfach benutzerdefinierte Booteinträge in <filename>grub.cfg</filename> einbinden. Der Bestandteil <literal>exec tail -n +3 $0</literal> am Anfang darf dabei nicht geändert werden.
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
   <para>
    Die Verarbeitungsreihenfolge ergibt sich aus den Zahlen am Anfang des Skriptnamens, wobei das Skript mit der niedrigsten Zahl zuerst ausgeführt wird. Wenn mehrere Skripte mit derselben Zahl beginnen, entscheidet die alphabetische Sortierung des vollständigen Namens über die endgültige Reihenfolge.
   </para>
   <tip>
    <title><filename>/boot/grub2/custom.cfg</filename></title>
    <para>
     Wenn Sie <filename>/boot/grub2/custom.cfg</filename> erstellen und benutzerdefinierte Inhalte eintragen, werden diese Inhalte beim Booten automatisch gleich nach 40_custom in <filename>/boot/grub40/grub.cfg</filename> aufgenommen.
    </para>
   </tip>
  </sect2>

  <sect2 xml:id="sec-grub2-map">
   <title>Zuordnung von BIOS-Laufwerken und Linux-Geräten</title>
   <para>
    In GRUB Legacy wurden die Linux-Geräte mithilfe der Konfigurationsdatei <filename>device.map</filename>aus den Nummern der BIOS-Laufwerke abgeleitet. Die Zuordnung von BIOS-Laufwerken und Linux-Geräten ist jedoch nicht in jedem Fall fehlerfrei erkennbar. Wenn Sie beispielsweise die Reihenfolge der IDE- und SCSI-Laufwerke in der BIOS-Konfiguration vertauschen, entsteht in GRUB Legacy eine falsche Reihenfolge.
   </para>
   <para>
    In GRUB 2 werden beim Erzeugen der Datei <filename>grub.cfg</filename> dagegen Geräte-ID-Zeichenfolgen (UUIDs) oder Dateisystemkennungen erzeugt, damit dieses Problem vermieden wird. In GRUB 2 wird eine interaktive temporäre Gerätezuordnung genutzt, die in der Regel ausreicht, insbesondere bei Systemen mit nur einer Festplatte.
   </para>
   <para>
    Falls die automatische Zuordnung in GRUB 2 außer Kraft gesetzt werden soll, legen Sie eine benutzerdefinierte Zuordnungsdatei mit dem Dateinamen <filename>/boot/grub2/device.map</filename> an. Im nachfolgenden Beispiel wird die Zuordnung so geändert, dass <literal>DISK 3</literal> das Bootlaufwerk ist. Beachten Sie, dass die GRUB 2-Partitionsnummern mit <literal>1</literal> beginnen, nicht mit <literal>0</literal> wie in GRUB Legacy.
   </para>
<screen>(hd1)  /dev/disk-by-id/<replaceable>DISK3 ID</replaceable>
(hd2)  /dev/disk-by-id/<replaceable>DISK1 ID</replaceable>
(hd3)  /dev/disk-by-id/<replaceable>DISK2 ID</replaceable></screen>
  </sect2>

  <sect2 xml:id="sec-grub2-menu-change">
   <title>Ändern von Menüeinträgen während des Bootvorgangs</title>
   <para>
    Das direkte Bearbeiten von Menüeinträgen eröffnet einen Ausweg, wenn das System aufgrund einer fehlerhaften Konfiguration nicht mehr gebootet werden kann. Hiermit können Sie außerdem neue Einstellungen testen, ohne die bestehende Systemkonfiguration ändern zu müssen.
   </para>
   <procedure>
    <step>
     <para>
      Wählen Sie im grafischen Bootmenü den zu bearbeitenden Eintrag mit den Pfeiltasten aus.
     </para>
    </step>
    <step>
     <para>
      Drücken Sie <keycap>E</keycap>. Der Texteditor wird geöffnet.
     </para>
    </step>
    <step>
     <para>
      Wechseln Sie mit den Pfeiltasten zur Zeile, die bearbeitet werden soll.
     </para>
     <figure xml:id="fig-grub2-boot-editor">
      <title>Booteditor in GRUB 2</title>
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="grub2_edit_config.png" width="75%" format="PNG"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="grub2_edit_config.png" width="75%" format="PNG"/>
       </imageobject>
      </mediaobject>
     </figure>
     <para>
      Anschließend haben Sie zwei Möglichkeiten:
     </para>
     <substeps performance="required">
      <step>
       <para>
        Zum Bearbeiten der Kernel-Parameter fügen Sie die gewünschten Parameter (jeweils durch ein Leerzeichen getrennt) am Ende der Zeile an, die mit <literal>linux</literal> oder <literal>linuxefi</literal> beginnt. Unter <link xlink:href="https://en.opensuse.org/Linuxrc"/> finden Sie eine vollständige Liste der Parameter.
       </para>
      </step>
      <step>
       <para>
        Alternativ bearbeiten Sie die zu ändernden Optionen, z. B. die Kernelversion. Mit der Taste <keycap function="tab"/> erhalten Sie die möglichen Vervollständigungsoptionen.
       </para>
      </step>
     </substeps>
    </step>
    <step>
     <para>
      Mit <keycap>F10</keycap> booten Sie das System mit den vorgenommenen Änderungen, mit <keycap function="escape"/> verwerfen Sie Ihre Änderungen und kehren zum GRUB 2-Menü zurück.
     </para>
    </step>
   </procedure>
   <para>
    Auf diese Weise vorgenommene Änderungen gelten nur für den aktuellen Bootvorgang und werden nicht dauerhaft gespeichert.
   </para>
   <important>
    <title>Tastaturbelegung während des Bootvorgangs</title>
    <para>
     Beim Bootvorgang ist nur die amerikanische Tastaturbelegung verfügbar. Siehe <xref linkend="fig-trouble-install-keyboard-us"/>.
    </para>
   </important>
   <note arch="x86_64">
    <title>Bootloader auf den Installationsmedien</title>
    <para>
     Die Installationsmedien für Systeme mit herkömmlichen BIOS enthalten nach wie vor GRUB Legacy als Bootloader. Zum Hinzufügen von Bootparametern wählen Sie einen Eintrag aus und beginnen Sie mit der Eingabe. Die Ergänzungen des Installations-Booteintrags werden dauerhaft im installierten System gespeichert.
    </para>
   </note>
   
  </sect2>

  <sect2 xml:id="sec-grub2-password">
   <title>Festlegen eines Bootpassworts</title>
   <para>
    GRUB 2 unterstützt schon vor dem Booten des Betriebssystems den Zugriff auf Dateisysteme. Dies bedeutet, dass Benutzer ohne root-Berechtigungen auf Dateien des Linux-Systems zugreifen können, auf die sie nach dem Booten keinen Zugriff haben. Um diese Zugriffe oder das Booten bestimmter Menüeinträge zu verhindern, können Sie ein Bootpasswort festlegen.
   </para>
   <important>
    <title>Booten erfordert ein Passwort</title>
    <para>
     Das Bootpasswort muss dann bei jedem Booten eingegeben werden; das System wird also nicht automatisch gebootet.
    </para>
   </important>
   <para>
    Legen Sie das Bootpasswort gemäß den nachfolgenden Anweisungen fest. Alternativ verwenden Sie YaST (<xref linkend="vle-grub2-yast2-boot-password"/>).
   </para>
   <procedure>
    <step>
     <para>
      Verschlüsseln Sie das Passwort mit <command>grub2-mkpasswd-pbkdf2</command>:
     </para>
<screen><prompt>tux &gt; </prompt><command>sudo</command> grub2-mkpasswd-pbkdf2
Password: ****
Reenter password: ****
PBKDF2 hash of your password is grub.pbkdf2.sha512.10000.9CA4611006FE96BC77A...
</screen>
    </step>
    <step>
     <para>
      Fügen Sie die resultierende Zeichenfolge zusammen mit dem Kommando <command>set superusers</command> in die Datei <filename>/etc/grub.d/40_custom</filename> ein.
     </para>
<screen>set superusers="root"
password_pbkdf2 root grub.pbkdf2.sha512.10000.9CA4611006FE96BC77A...</screen>
    </step>
    <step>
     <para>
      Führen Sie zum Importieren der Änderungen in der Hauptkonfigurationsdatei Folgendes aus:
     </para>
     <screen><prompt>tux &gt; </prompt><command>sudo</command> grub2-mkconfig -o /boot/grub2/grub.cfg</screen>
    </step>
   </procedure>
   <para>
    Nach dem Neubooten werden Sie aufgefordert, einen Benutzernamen und ein Passwort einzugeben, sobald Sie versuchen, einen Menüeintrag zu booten. Geben Sie <literal>root</literal> und das Passwort ein, das Sie mit dem Kommando <command>grub2-mkpasswd-pbkdf2</command> erstellt haben. Wenn der Berechtigungsnachweis fehlerfrei ist, bootet das System den angegebenen Booteintrag.
   </para>
   <para>
    Weitere Informationen finden Sie im <link xlink:href="https://www.gnu.org/software/grub/manual/grub.html#Security"/>.
   </para>
  </sect2>
 </sect1>
 <xi:include href="grub2_yast_i.xml"/>
 
 <sect1 xml:id="sec-grub2-commands">
  <title>Nützliche Kommandos in GRUB 2</title>

  <variablelist>
   <varlistentry xml:id="vle-grub2-mkconfig">
    <term><command>grub2-mkconfig</command>
    </term>
    <listitem>
     <para>
      Hiermit wird eine neue Datei <filename>/boot/grub2/grub.cfg</filename> auf der Grundlage von <filename>/etc/default/grub</filename> und der Skripten in <filename>/etc/grub.d/</filename> erzeugt.
     </para>
     <example>
      <title>Verwendung von grub2-mkconfig</title>
<screen>grub2-mkconfig -o /boot/grub2/grub.cfg</screen>
     </example>
     <tip>
      <title>Syntaxprüfung</title>
      <para>
       Wenn Sie <command>grub2-mkconfig</command> ohne Parameter ausführen, wird die Konfiguration an STDOUT ausgegeben und kann dort abgerufen werden. Zur Syntaxprüfung führen Sie <xref linkend="vle-grub2-script-check"/> aus, sobald die Datei <filename>/boot/grub2/grub.cfg</filename> geschrieben wurde.
      </para>
     </tip>
     <important>
      <title>Mit <command>grub2-mkconfig</command> können UEFI Secure-Boottabellen nicht repariert werden</title>
      <para>
       Wenn Sie UEFI Secure Boot verwenden und Ihr System GRUB 2 nicht mehr ordnungsgemäß erreichen kann, müssen Sie möglicherweise zusätzlich Shim neu installieren und die UEFI-Boottabelle regenerieren. Verwenden Sie hierzu das folgende Kommando:
      </para>
<screen><prompt role="root">root # </prompt>shim-install --config-file=/boot/grub2/grub.cfg</screen>
     </important>
    </listitem>
   </varlistentry>
   <varlistentry xml:id="vle-grub2-mkrescue">
    <term><command>grub2-mkrescue</command></term>
    <listitem>
     <para>
      Hiermit wird ein bootfähiges Rettungs-Image der installierten GRUB 2-Konfiguration erstellt.
     </para>
     <example>
      <title>Verwendung von grub2-mkrescue</title>
<screen>grub2-mkrescue -o save_path/name.iso iso</screen>
     </example>
    </listitem>
   </varlistentry>
   <varlistentry xml:id="vle-grub2-script-check">
    <term><command>grub2-script-check</command>
    </term>
    <listitem>
     <para>
      Hiermit prüfen Sie die angegebene Datei auf Syntaxfehler.
     </para>
     <example>
      <title>Verwendung von grub2-script-check</title>
<screen>grub2-script-check /boot/grub2/grub.cfg</screen>
     </example>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><command>grub2-once</command>
    </term>
    <listitem>
     <para>
      Hiermit legen Sie den Standard-Booteintrag für den nächsten Bootvorgang fest (dies wird nicht dauerhaft gespeichert). Mit der Option <option>--list</option> erhalten Sie eine Liste der verfügbaren Booteinträge.
     </para>
     <example>
      <title>Verwendung von grub2-once</title>
<screen>grub2-once number_of_the_boot_entry</screen>
     </example>
     <tip>
      <title><command>grub2-once</command>-Hilfe</title>
      <para>
       Wenn Sie das Programm ohne Angabe von Optionen aufrufen, erhalten Sie eine vollständige Liste der zulässigen Optionen.
      </para>
     </tip>
    </listitem>
   </varlistentry>
  </variablelist>
 </sect1>
 <sect1 xml:id="sec-grub2-info">
  <title>Weitere Informationen</title>

  <para>
   Umfassende Informationen zu GRUB 2 finden Sie unter <link xlink:href="https://www.gnu.org/software/grub/"/>. Ausführliche Informationen finden Sie auch auf der Infoseite für das Kommando <command>grub</command>. <phrase os="sles;sled">Weitere Informationen zu bestimmten Themen erhalten Sie auch, wenn Sie <quote>GRUB 2</quote> in der Suchfunktion für technische Informationen unter <link xlink:href="https://www.suse.com/support"/> als Suchwort eingeben.</phrase>
  </para>
 </sect1>
</chapter>
