<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="storage_fs-resizing.xml" version="5.0" xml:id="cha.resize_fs" xml:lang="zh-cn">
 <title>调整文件系统大小</title>
 <info>
      <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
        <dm:bugtracker>
          </dm:bugtracker>
        <dm:translation>yes</dm:translation>
      </dm:docmanager>
    </info>
    <para>
  调整文件系统大小（不要与调整分区或卷大小混淆）可用于将物理卷上的空间变为可用状态，或使用物理卷上可用的其他空间。
 </para>
 <sect1 xml:id="sec.resize_fs.usecases">
  <title>使用案例</title>

  <para>
   强烈建议您使用 YaST 分区程序来调整分区或逻辑卷的大小。这样一来，文件系统将自动调整为分区或卷的新大小。不过，在某些情况下，您需要手动调整文件系统的大小，因为 YaST 不支持它们：
  </para>

  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>
     调整虚拟机 Guest 的虚拟磁盘大小之后。
    </para>
   </listitem>
   <listitem>
    <para>
     调整网络附加储存中的卷大小之后。
    </para>
   </listitem>
   <listitem>
    <para>
     手动调整分区（例如通过使用 <command>fdisk</command> 或 <command>parted</command>）或逻辑卷（例如通过使用 <command>lvresize</command>）的大小之后。
    </para>
   </listitem>
   <listitem>
    <para>
     要缩小 Btrfs 文件系统的大小时（从 <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> 12 开始，YaST 仅支持增大 Btrfs 文件系统）。
    </para>
   </listitem>
  </itemizedlist>
 </sect1>
 <sect1 xml:id="sec.resize_fs.guidelines">
  <title>调整大小指导原则</title>

  <para>
   调整任何文件系统的大小都存在一定的风险，可能会造成数据遗失。
  </para>

  <warning>
   <title>备份数据</title>
   <para>
    为了避免数据丢失，请确保在开始任何调整大小任务之前备份您的数据。
   </para>
  </warning>

  <para>
   计划调整文件系统大小时，请考虑以下指导原则。
  </para>

  <sect2 xml:id="sec.resize_fs.guidelines.support">
   <title>支持调整大小的文件系统</title>
   <para>
    文件系统必须支持调整大小才能利用卷上可用空间的增加。<phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> 中提供了适用于文件系统 Ext2、Ext3、Ext4 及 ReiserFS 的文件系统重设置大小实用程序。这些实用程序支持如下增加和减小大小：
   </para>
   <table>
    <title>文件系统对调整大小的支持</title>
    <tgroup cols="4">
     <colspec colnum="1" colname="1" colwidth="2500*"/>
     <colspec colnum="2" colname="2" colwidth="2500*"/>
     <colspec colnum="3" colname="3" colwidth="2500*"/>
     <colspec colnum="4" colname="4" colwidth="2500*"/>
     <thead>
      <row>
       <entry>
        <para>
         文件系统
        </para>
       </entry>
       <entry>
        <para>
         实用程序
        </para>
       </entry>
       <entry>
        <para>
         增大大小（增大）
        </para>
       </entry>
       <entry>
        <para>
         减小大小（收缩）
        </para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row>
       <entry>
        <para>
         Btrfs
        </para>
       </entry>
       <entry>
        <para>
         btrfs filesystem resize
        </para>
       </entry>
       <entry>
        <para>
         联机
        </para>
       </entry>
       <entry>
        <para>
         联机
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         XFS
        </para>
       </entry>
       <entry>
        <para>
         xfs_growfs
        </para>
       </entry>
       <entry>
        <para>
         联机
        </para>
       </entry>
       <entry>
        <para>
         不支持
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         Ext2
        </para>
       </entry>
       <entry>
        <para>
         resize2fs
        </para>
       </entry>
       <entry>
        <para>
         仅限脱机
        </para>
       </entry>
       <entry>
        <para>
         仅限脱机
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         Ext3
        </para>
       </entry>
       <entry>
        <para>
         resize2fs
        </para>
       </entry>
       <entry>
        <para>
         联机或脱机
        </para>
       </entry>
       <entry>
        <para>
         仅限脱机
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         Ext4
        </para>
       </entry>
       <entry>
        <para>
         resize2fs
        </para>
       </entry>
       <entry>
        <para>
         仅限脱机
        </para>
       </entry>
       <entry>
        <para>
         仅限脱机
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         ReiserFS
        </para>
       </entry>
       <entry>
        <para>
         resize_reiserfs
        </para>
       </entry>
       <entry>
        <para>
         联机或脱机
        </para>
       </entry>
       <entry>
        <para>
         仅限脱机
        </para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </table>
  </sect2>

  <sect2 xml:id="sec.resize_fs.guidelines.increase">
   <title>增加文件系统的大小</title>
   <para>
    您可以将文件系统增大到设备上的最大可用空间，或指定一个准确大小。请确保在尝试增加文件系统的大小之前先增加设备或逻辑卷的大小。
   </para>
   <para>
    为文件系统指定精确大小时，请确保新大小满足以下条件：
   </para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>
      新大小必须大于现有数据的大小；否则会发生数据丢失。
     </para>
    </listitem>
    <listitem>
     <para>
      新大小必须等于或小于当前设备大小，因为文件系统大小不能超出可用空间。
     </para>
    </listitem>
   </itemizedlist>
  </sect2>

  <sect2 xml:id="sec.resize_fs.guidelines.decrease">
   <title>减小文件系统的大小</title>
   <para>
    当减小设备上的文件系统的大小时，请确保新的大小满足以下条件：
   </para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>
      新大小必须大于现有数据的大小；否则会发生数据丢失。
     </para>
    </listitem>
    <listitem>
     <para>
      新大小必须等于或小于当前设备大小，因为文件系统大小不能超出可用空间。
     </para>
    </listitem>
   </itemizedlist>
   <para>
    如果还计划减小用于保存文件系统的逻辑卷的大小，请确保在尝试减小设备或逻辑卷的大小之前先减小文件系统的大小。
   </para>
   <important>
    <title>XFS</title>
    <para>
     XFS 格式文件系统的大小无法减少，因为 XFS 不支持此功能。
    </para>
   </important>
  </sect2>
 </sect1>
 <sect1 xml:id="sec.resize_fs.btrfs">
  <title>更改 Btrfs 文件系统的大小</title>

  <para>
   装入 Btrfs 文件系统后，您可以使用 <command>btrfs filesystem resize</command> 命令来更改该文件系统的大小。装入了文件系统时，增加和缩小大小均受支持。
  </para>

  <procedure>
   <step>
    <para>
     打开一个终端控制台。
    </para>
   </step>
   <step>
    <para>
     确定您要更改的文件系统已装入。
    </para>
   </step>
   <step>
    <para>
     使用 <command>btrfs filesystem resize</command> 命令通过下列其中一种方法更改文件系统的大小：
    </para>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <para>
       要将文件系统大小扩展为设备的最大可用大小，请输入
      </para>
<screen>sudo btrfs filesystem resize max /mnt</screen>
     </listitem>
     <listitem>
      <para>
       要将文件系统扩展为指定大小，请输入
      </para>
<screen>sudo btrfs filesystem resize <replaceable>size</replaceable> /mnt</screen>
      <para>
       将<replaceable>大小</replaceable>替换为所需大小（以字节为单位）。您还可以为值指定单位，例如 50000K (KB)、250M (MB) 或 2G (GB)。您也可以在值前面加上加号 (<literal>+</literal>) 或减号 (<literal>-</literal>)，分别指定增加或缩小至目前的大小：
      </para>
<screen>sudo btrfs filesystem resize +<replaceable>size</replaceable> /mnt
sudo btrfs filesystem resize -<replaceable>size</replaceable> /mnt</screen>
     </listitem>
    </itemizedlist>
   </step>
   <step>
    <para>
     通过输入以下命令，检查已装入文件系统的调整大小的结果
    </para>
<screen>df -h</screen>
    <para>
     磁盘可用 (<command>df</command>) 命令显示磁盘的总大小、使用的块数以及文件系统上可用的块数。-h 选项会以可辨识的格式列印大小，如 1K、234M 或 2G。
    </para>
   </step>
  </procedure>
 </sect1>
 <sect1 xml:id="sec.resize_fs.xfs">
  <title>更改 XFS 文件系统的大小</title>

  <para>
   装入 XFS 文件系统后，您可以使用 <command>xfs_growfs</command> 命令来增加该文件系统的大小。XFS 文件系统的大小无法减少。
  </para>

  <procedure>
   <step>
    <para>
     打开一个终端控制台。
    </para>
   </step>
   <step>
    <para>
     确定您要更改的文件系统已装入。
    </para>
   </step>
   <step>
    <para>
     使用 <command>xfs_growfs</command> 命令增加文件系统的大小。下面的示例会将文件系统的大小扩充为最大可用值。请参见 <command>man 8 xfs_growfs</command> 了解更多选项。
    </para>
<screen>sudo xfs_growfs -d /mnt</screen>
   </step>
   <step>
    <para>
     通过输入以下命令，检查已装入文件系统的调整大小的结果
    </para>
<screen>df -h</screen>
    <para>
     磁盘可用 (<command>df</command>) 命令显示磁盘的总大小、使用的块数以及文件系统上可用的块数。-h 选项会以可辨识的格式列印大小，如 1K、234M 或 2G。
    </para>
   </step>
  </procedure>
 </sect1>
 <sect1 xml:id="sec.resize_fs.ext">
  <title>更改 Ext2、Ext3 或 Ext4 文件系统的大小</title>

  <para>
   安装文件系统时，可以使用 <command>resize2fs</command> 命令增加 Ext2、Ext3 和 Ext4 文件系统的大小。卸载文件系统时，也可以使用 <command>resize2fs</command> 命令增加 Ext3 文件系统的大小。若要减少 Ext 文件系统的大小，需要将其卸载。
  </para>

  <procedure>
   <step>
    <para>
     打开一个终端控制台。
    </para>
   </step>
   <step>
    <para>
     如果文件系统是 Ext2，则无论在何种情况下，您都必须卸载文件系统。Ext3 和 Ext4 文件系统可在装入时增加大小；若要缩小大小，则需要将它们卸除。
    </para>
   </step>
   <step>
    <para>
     使用下列方法之一更改文件系统的大小：
    </para>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <para>
       要将文件系统大小扩展为名为 <filename>/dev/sda1</filename> 的设备的最大可用大小，请输入
      </para>
<screen>sudo resize2fs /dev/sda1</screen>
      <para>
       如果未指定大小参数，大小将默认为该分区的大小。
      </para>
     </listitem>
     <listitem>
      <para>
       若要将文件系统更改为特定大小，请输入
      </para>
<screen>sudo resize2fs /dev/sda1 <replaceable>size</replaceable></screen>
      <para>
       <replaceable>大小</replaceable>参数指定请求的文件系统新大小。如果不指定任何单位，则大小参数的单位是文件系统的块大小。也可以选择在大小参数后面加上下列其中一种单位指示项：<literal>s</literal> 表示 512 字节扇区；<literal>K</literal> 表示 KB（1 KB 为 1024 字节）；<literal>M</literal> 表示 MB；<literal>G</literal> 表示 GB。
      </para>
     </listitem>
    </itemizedlist>
    <para>
     等到调整大小完成再继续。
    </para>
   </step>
   <step>
    <para>
     如果未装入该文件系统，则现在装入它。
    </para>
   </step>
   <step>
    <para>
     通过输入以下命令，检查已装入文件系统的调整大小的结果
    </para>
<screen>df -h </screen>
    <para>
     磁盘可用 (<command>df</command>) 命令显示磁盘的总大小、使用的块数以及文件系统上可用的块数。-h 选项会以可辨识的格式列印大小，如 1K、234M 或 2G。
    </para>
   </step>
  </procedure>
 </sect1>
 <sect1 xml:id="sec.resize_fs.reiserfs">
  <title>更改 Reiser 文件系统的大小</title>

  <para>
   ReiserFS 文件系统在装入或卸载时可增加大小。若要减少其大小，则需要将其卸载。
  </para>

  <procedure>
   <step>
    <para>
     打开一个终端控制台。
    </para>
   </step>
   <step>
    <para>
     如果您要减少文件系统的大小，而文件系统已装入，请将其卸除。
    </para>
   </step>
   <step>
    <para>
     使用以下其中一种方法，更改名为 <filename>/dev/sda2</filename> 的设备上文件系统的大小：
    </para>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <para>
       要将文件系统大小扩展为设备的最大可用大小，请输入
      </para>
<screen>sudo resize_reiserfs /dev/sda2</screen>
      <para>
       不指定大小时，这会将卷增加到分区的完整大小。
      </para>
     </listitem>
     <listitem>
      <para>
       要将文件系统扩展为指定大小，请输入
      </para>
<screen>sudo resize_reiserfs -s <replaceable>size</replaceable> /dev/sda2</screen>
      <para>
       将<replaceable>大小</replaceable>替换为所需大小（以字节为单位）。您还可以为值指定单位，例如 50000K (KB)、250M (MB) 或 2G (GB)。您也可以在值前面加上加号 (<literal>+</literal>) 或减号 (<literal>-</literal>)，分别指定增加或缩小至目前的大小：
      </para>
<screen>sudo resize_reiserfs -s +<replaceable>size</replaceable> /dev/sda2
sudo resize_reiserfs -s -<replaceable>size</replaceable> /dev/sda2</screen>
     </listitem>
    </itemizedlist>
    <para>
     等到调整大小完成再继续。
    </para>
   </step>
   <step>
    <para>
     如果未装入该文件系统，则现在装入它。
    </para>
   </step>
   <step>
    <para>
     通过输入以下命令，检查已装入文件系统的调整大小的结果
    </para>
<screen>df -h</screen>
    <para>
     磁盘可用 (<command>df</command>) 命令显示磁盘的总大小、使用的块数以及文件系统上可用的块数。-h 选项会以可辨识的格式列印大小，如 1K、234M 或 2G。
    </para>
   </step>
  </procedure>
 </sect1>
</chapter>
