<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="tuning_multikernel.xml" version="5.0" xml:id="cha.tuning.multikernel">
 <title>Installation de plusieurs versions du kernel</title>
 <info>
  <abstract>
   <para>
    <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> prend en charge l'installation parallèle de plusieurs versions du kernel. Lorsque vous installez un deuxième kernel, une entrée de démarrage et un fichier initrd sont automatiquement créés. Aucune autre configuration manuelle n'est donc requise. Lorsque vous redémarrez la machine, le nouveau kernel est disponible sous la forme d'une option de démarrage supplémentaire.
   </para>

   <para>
    Cette fonctionnalité vous permet de tester les mises à jour de kernel en toute sécurité, tout en ayant la possibilité de revenir au kernel opérationnel précédent. Pour ce faire, n'utilisez pas les outils de mise à jour (tels que YaST Online Update ou l'applet de mise à jour), mais suivez la procédure décrite dans ce chapitre.
   </para>
  </abstract>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:bugtracker/>
   <dm:translation>oui</dm:translation>
  </dm:docmanager>
 </info>
 <warning>

  <title>droit au support</title>
  <para>
   Sachez que vous perdrez votre droit au support sur la machine en cas d'installation d'un kernel tiers ou auto-compilé. Seuls les kernels livrés avec <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> et ceux distribués via les canaux de mise à jour officiels pour <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> sont pris en charge.
  </para>
 </warning>
 <tip>
  <title>vérifiez le kernel de configuration de votre chargeur de démarrage</title>
  <para>
   Il est conseillé de vérifier la configuration de votre chargeur de démarrage après avoir installé un autre kernel afin de définir l'entrée de démarrage par défaut de votre choix. Pour plus d'informations, reportez-vous à la <xref linkend="sec.grub2.yast2.config"/>.
  </para>
 </tip>
 <sect1 xml:id="cha.tuning.multikernel.enable">
  <title>Activation et configuration de la prise en charge de plusieurs versions</title>



  <para>
   L'installation de plusieurs versions d'un paquetage logiciel (prise en charge multiversion) est activée par défaut sous SUSE Linux Enterprise 12. Pour vérifier ce paramètre, procédez comme suit :
  </para>

  <procedure>
   <step>
    <para>
     Ouvrez <filename>/etc/zypp/zypp.conf</filename> avec l'éditeur de votre choix en tant qu'utilisateur <systemitem class="username">root</systemitem>.
    </para>
   </step>
   <step>
    <para>
     Recherchez la chaîne <literal>multiversion</literal>. Si la prise en charge multiversion est activée pour tous les paquetages de kernels disposant de cette fonction, la ligne suivante s'affiche, sans commentaire :
    </para>
<screen>multiversion = provides:multiversion(kernel)</screen>
   </step>
   <step>
    <para>
     Pour limiter cette prise en charge à certaines versions de kernel, ajoutez les noms de paquetage sous la forme d'une liste séparée par des virgules à l'option <literal>multiversion</literal> dans <filename>/etc/zypp/zypp.conf</filename>. Par exemple :
    </para>
<screen>multiversion = kernel-default,kernel-default-base,kernel-source</screen>
   </step>
   <step>
    <para>
     Enregistrez vos modifications.
    </para>
   </step>
  </procedure>

  <warning>
   <title>paquetages de modules de kernels (KMP)</title>
   <para>
    Assurez-vous que les modules de kernels requis (KMP) proposés par les fournisseurs sont également installés pour le kernel nouvellement mis à jour. Le processus de mise à jour de kernels ne signale pas les éventuels modules de kernels manquants car les conditions liées aux paquetages sont toujours remplies par l'ancien kernel conservé sur le système.
   </para>
  </warning>

  <sect2 xml:id="cha.tuning.multikernel.enable.keep">
   <title>Suppression automatique des kernels inutilisés</title>
   <para>
    Lorsque vous testez fréquemment des nouveaux kernels sur lesquels la prise en charge de plusieurs versions est activée, il devient rapidement difficile de s'y retrouver dans le menu de démarrage. Dans la mesure où une partition <filename>/boot</filename> dispose généralement d'un espace limité, des problèmes de débordement <filename>/boot</filename> peuvent apparaître. Bien que vous puissiez supprimer manuellement les versions de kernel inutilisées à l'aide de YaST ou Zypper (comme décrit ci-dessous), vous pouvez également configurer <systemitem class="library">libzypp</systemitem> de manière à supprimer automatiquement les kernels qui ne sont plus utilisés. Par défaut, aucun kernel n'est supprimé.
   </para>
   <procedure>
    <step>
     <para>
      Ouvrez <filename>/etc/zypp/zypp.conf</filename> avec l'éditeur de votre choix en tant qu'utilisateur <systemitem class="username">root</systemitem>.
     </para>
    </step>
    <step>
     <para>
      Recherchez la chaîne <literal>multiversion.kernels</literal> et activez cette option en annulant la mise en commentaire de la ligne. Cette option adopte une liste des valeurs suivantes séparées par des virgules :
     </para>
     <formalpara>
      <title><literal><replaceable>3.12.24-7.1</replaceable></literal> :</title>
      <para>
       Conserve le kernel avec le numéro de version spécifié
      </para>
     </formalpara>
     <formalpara>
      <title><literal>latest</literal>:</title>
      <para>
       Conserve le kernel ayant le numéro de version le plus élevé
      </para>
     </formalpara>
     <formalpara>
      <title><literal>latest-N</literal> :</title>
      <para>
       Conserve le kernel ayant le Nième numéro de version le plus élevé
      </para>
     </formalpara>
     <formalpara>
      <title><literal>running</literal>:</title>
      <para>
       Conserve le kernel en cours d'exécution
      </para>
     </formalpara>
     <formalpara>
      <title><literal>oldest</literal>:</title>
      <para>
       Conserve le kernel ayant le numéro de version le plus petit (celui livré initialement avec <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase>)
      </para>
     </formalpara>
     <formalpara>
      <title><literal>oldest+N</literal></title>
      <para>
       Conserve le kernel ayant le Nième numéro de version le plus petit
      </para>
     </formalpara>
     <para>
      En voici quelques exemples
     </para>
     <variablelist>
      <varlistentry>
       <term><literal>multiversion.kernels = latest,running</literal>
       </term>
       <listitem>
        <para>
         Conserve le kernel le plus récent et celui en cours d'exécution. Cela équivaut à désactiver la fonction « multiversion », si ce n'est que l'ancien kernel est supprimé <emphasis>après le redémarrage suivant</emphasis>, et non immédiatement après l'installation.
        </para>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term><literal>multiversion.kernels = latest,latest-1,running</literal>
       </term>
       <listitem>
        <para>
         Conserve les deux derniers kernels et celui en cours d'exécution. 
        </para>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term><literal>multiversion.kernels = latest,running,<replaceable>3.12.25.rc7-test</replaceable></literal>
       </term>
       <listitem>
        <para>
         Conserve le dernier kernel, celui en cours d'exécution et <replaceable>3.12.25.rc7-test</replaceable>.
        </para>
       </listitem>
      </varlistentry>
     </variablelist>
     <tip>
      <title>conservation du kernel <literal>en cours d'exécution</literal></title>
      <para>
       Sauf utilisation de configurations spéciales, vous utiliserez généralement le kernel <literal>en cours d'exécution</literal>. Si vous ne conservez pas le kernel en cours d'exécution, il sera supprimé en cas de mise à jour du kernel. Il est alors nécessaire de redémarrer immédiatement le système après la mise à jour, dans la mesure où les modules pour le kernel en cours d'exécution ne peuvent plus être chargés car ils ont été supprimés.
      </para>
     </tip>
    </step>
   </procedure>
  </sect2>
 </sect1>
 <sect1 xml:id="cha.tuning.multikernel.yast">
  <title>Installation/suppression de plusieurs versions de kernel avec YaST</title>

  <procedure>
   <step>
    <para>
     Démarrez YaST et ouvrez le gestionnaire de logiciels via <menuchoice> <guimenu>Logiciel</guimenu> <guimenu>Gestion de logiciels</guimenu> </menuchoice>.
    </para>
   </step>
   <step>
    <para>
     Dressez la liste de tous les paquetages capables de fournir plusieurs versions en sélectionnant <menuchoice> <guimenu>Afficher</guimenu> <guimenu>Groupes de paquetages</guimenu> <guimenu>Paquetages multiversions</guimenu></menuchoice>.
    </para>
    <figure>
     <title>Gestionnaire de logiciels : affichage multiversion</title>
     <mediaobject>
      <imageobject role="fo">
       <imagedata fileref="yast2_sw_multiversion.png" width="90%" format="PNG"/>
      </imageobject>
      <imageobject role="html">
       <imagedata fileref="yast2_sw_multiversion.png" width="90%" format="PNG"/>
      </imageobject>
     </mediaobject>
    </figure>
   </step>
   <step>
    <para>
     Sélectionnez un paquetage et ouvrez l'onglet <guimenu>Version</guimenu> correspondant dans le volet situé en bas à gauche.
    </para>
   </step>
   <step>
    <para>
     Pour installer un paquetage, cliquez sur sa case à cocher. Une coche verte indique que le paquetage est sélectionné pour être installé.
    </para>
    <para>
     Pour supprimer un paquetage déjà installé (signalé par une coche blanche), cochez la case correspondante jusqu'à ce qu'un <literal>X</literal> rouge indique qu'il a été sélectionné en vue de la suppression.
    </para>
   </step>
   <step>
    <para>
     Cliquez sur <guimenu>Accepter</guimenu> pour démarrer l'installation.
    </para>
   </step>
  </procedure>
 </sect1>
 <sect1 xml:id="cha.tuning.multikernel.zypper">
  <title>Installation/suppression de plusieurs versions de kernel avec Zypper</title>

  <procedure>
   <step>
    <para>
     Utilisez la commande <command>zypper se -s 'kernel*'</command> pour afficher la liste de tous les paquetages de kernel disponibles :
    </para>
<screen><?dbsuse-fo font-size="7pt"?>

S | Name           | Type       | Version         | Arch   | Repository        
--+----------------+------------+-----------------+--------+-------------------
v | kernel-default | package    | 2.6.32.10-0.4.1 | x86_64 | Alternative Kernel
i | kernel-default | package    | 2.6.32.9-0.5.1  | x86_64 | (System Packages) 
  | kernel-default | srcpackage | 2.6.32.10-0.4.1 | noarch | Alternative Kernel
i | kernel-default | package    | 2.6.32.9-0.5.1  | x86_64 | (System Packages)
...</screen>
   </step>
   <step>
    <para>
     Indiquez la version exacte lors de l'installation :
    </para>
<screen>zypper in kernel-default-2.6.32.10-0.4.1</screen>
   </step>
   <step>
    <para>
     Lorsque vous désinstallez un kernel, utilisez les commandes <command>zypper se -si 'kernel*'</command> pour afficher la liste de tous les kernels installés et <command>zypper rm</command><replaceable>VERSION-NOM PAQUETAGE</replaceable> pour supprimer le paquetage.
    </para>
   </step>
  </procedure>
 </sect1>
</chapter>
