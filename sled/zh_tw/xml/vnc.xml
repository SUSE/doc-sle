<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="vnc.xml" version="5.0" xml:id="cha.vnc">
 <title>透過 VNC 進行遠端存取</title>
 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:bugtracker/>
   <dm:translation>yes</dm:translation>
  </dm:docmanager>
  <abstract>
   <para>
    虛擬網路計算 (VNC) 可讓您透過圖形桌面環境控制遠端電腦 (與遠端外圍程序存取相對)。VNC 獨立於平台，可讓您從任何作業系統存取遠端機器。
   </para>

   <para>
    <phrase role="productname"><phrase os="sled">SUSE Linux Enterprise Desktop</phrase></phrase> 支援兩種不同類型的 VNC 工作階段：一次性工作階段，只要用戶端 VNC 連線不中斷，該工作階段將一直處於<quote>作用中</quote>；永久工作階段，此工作階段將一直處於<quote>作用中</quote>，除非明確將其終止。
   </para>
  </abstract>
 </info>
 <note>
  <title>工作階段類型</title>
  <para>
   機器可以在不同的連接埠上同時提供這兩種工作階段，但是開啟的工作階段無法從一種類型轉換為另一種類型。
  </para>
 </note>
 
 <sect1 xml:id="sec.vnc.viewer">
  <title><command>vncviewer</command> 用戶端</title>

  <para>
   若要連接到伺服器提供的 VNC 服務，需要使用一個用戶端。<phrase role="productname"><phrase os="sled">SUSE Linux Enterprise Desktop</phrase></phrase> 中的預設用戶端是 <command>tigervnc</command> 套件提供的 <systemitem class="resource">vncviewer</systemitem>。
  </para>

  <sect2 xml:id="sec.vnc.viewer.connectcli">
   <title>使用 vncviewer CLI 進行連接</title>
   <para>
    若要啟動 VNC 查看器並發起與伺服器的工作階段，請使用以下指令：
   </para>
<screen>vncviewer jupiter.example.com:1</screen>
   <para>
    您也可以指定含兩個冒號的連接埠號碼，而不指定 VNC 顯示埠號碼︰
   </para>
<screen>vncviewer jupiter.example.com::5901</screen>
   <note>
    <title>注意︰顯示號碼和連接埠號碼</title>
    <para>
     您在 VNC 用戶端中指定的實際顯示號碼或連接埠號碼必須與在目標機器上透過 <command>vncserver</command> 指令選取的顯示號碼或連接埠號碼相同。如需更多資訊，請參閱<xref linkend="sec.vnc.persistent"/>。
    </para>
   </note>
  </sect2>

  <sect2 xml:id="sec.vnc.viewer.connectgui">
   <title>使用 vncviewer GUI 進行連接</title>
   <para>
    執行 <command>vncviewer</command> 且不指定 <command>--listen</command> 或要連接到的主機會顯示一個視窗，要求您輸入連接詳細資料。按<xref linkend="sec.vnc.viewer.connectcli"/>中所述在 <guimenu>VNC 伺服器</guimenu>欄位中輸入主機，然後按一下<guimenu>連接</guimenu>。
   </para>
   <figure xml:id="fig.vnc.viewer.connectgui">
    <title>vncviewer</title>
    <mediaobject>
     <textobject role="description"><phrase>vncviewer 要求輸入連接詳細資料</phrase>
     </textobject>
     <imageobject role="html">
      <imagedata fileref="vnc_connect.png" format="PNG"/>
     </imageobject>
     <imageobject role="fo">
      <imagedata fileref="vnc_connect.png" format="PNG"/>
     </imageobject>
    </mediaobject>
   </figure>
  </sect2>

  <sect2 xml:id="sec.vnc.viewer.encrypt">
   <title>連接未加密通知</title>
   <para>
    VNC 協定支援不同類型的加密連接，請不要將這些連接與密碼驗證相混淆。如果某個連接未使用 TLS，VNC 檢視器的視窗標題中可能會出現 <quote>(連接未加密！)</quote> 文字。
   </para>
  </sect2>
 </sect1>
 <sect1 xml:id="sec.vnc.one-time">
  <title>一次性 VNC 工作階段</title>

  <para>
   一次性工作階段由遠端用戶端啟動。它會在伺服器上啟動圖形登入畫面。這樣，您就可以選擇啟動工作階段的使用者，如果登入管理員支援，還可以選擇桌面環境。終止此類 VNC 工作階段的用戶端連接時，在該工作階段內啟動的所有應用程式也會隨之終止。一次性 VNC 工作階段無法共用，不過在同一台主機上可以同時啟動多個工作階段。
  </para>

  <procedure xml:id="pro.vnc.one-time.activate">
   <title>啟用一次性 VNC 工作階段</title>
   <step>
    <para>
     啟動<menuchoice> <guimenu>YaST</guimenu> <guimenu> 網路服務</guimenu> <guimenu> 遠端管理 (VNC)</guimenu>
     </menuchoice>。
    </para>
   </step>
   <step>
    <para>
     選取<guimenu>允許遠端管理</guimenu>。
    </para>
   </step>
   <step>
    <para>
     若需要，還可核取<guimenu>在防火牆中開啟埠</guimenu>(例如，當網路介面設定為位於外部區域中時)。如果您有多個網路介面，請透過<guimenu>防火牆細節</guimenu>設定在特定介面開啟防火牆埠的限制。
    </para>
   </step>
   <step>
    <para>
     按一下<guimenu>完成</guimenu>確認您的設定。
    </para>
   </step>
   <step>
    <para>
     如果有些需要的套件尚未提供，您需要批准安裝缺失套件。
    </para>
   </step>
  </procedure>

  <sect2 xml:id="sec.vnc.one-time.configs">
   <title>可用的組態</title>
   <para>
    <phrase role="productname"><phrase os="sled">SUSE Linux Enterprise Desktop</phrase></phrase> 上的預設組態以 16 位元色彩深度、1024x768 像素解析度顯示工作階段。使用<quote>一般</quote>的 VNC 檢視器 (相當於 VNC 顯示埠 <literal>1</literal>) 時，可在連接埠 <systemitem class="resource">5901</systemitem> 上檢視工作階段，而使用網頁瀏覽器時，則可在連接埠 <systemitem class="resource">5801</systemitem> 上檢視工作階段。
   </para>
   <para>
    其他組態可在不同的連接埠上使用，<phrase os="sled">如果您需要修改組態，請諮詢您的系統管理員以獲取詳細資料。</phrase>
   </para>
   <para>
    在一次性工作階段中，VNC 顯示埠號碼和 X 顯示埠號碼是獨立的。VNC 顯示埠號碼需要手動指定給伺服器支援的每個組態 (在上例中為 :1)。每次以其中一種組態啟動 VNC 工作階段時，工作階段會自動獲得可用的 X 顯示埠號碼。
   </para>
   <para>
    依預設，VNC 用戶端與伺服器會嘗試透過安裝後產生的自行簽署 SSL 證書安全通訊。您可以使用預設的證書，也可以用自己的證書取代它。使用自行簽署的證書時，需要在首次連接之前，於 VNC 檢視器與網頁瀏覽器中確認證書的簽名。Java 用戶端是使用與 VNC 相同的證書透過 HTTPS 提供的。
   </para>
  </sect2>

  <sect2 xml:id="sec.vnc.one-time.connect">
   <title>啟動一次性 VNC 工作階段</title>
   <para>
    若要連接至永久 VNC 工作階段，必須安裝 VNC 檢視器。另請參閱<xref linkend="sec.vnc.viewer"/>。或者，可以在支援 Java 的網頁瀏覽器中，輸入 URL <literal>http://jupiter.example.com:5801</literal> 來檢視 VNC 工作階段
   </para>
  </sect2>

  <sect2 xml:id="sec.vnc.one-time.config">
   <title>設定一次性 VNC 工作階段</title>
   <para>
    如果您不需要或不想修改預設組態，可以跳過本小節。
   </para>
   <para>
    一次性 VNC 工作階段透過 <systemitem class="daemon">xinetd</systemitem> 精靈啟動。<filename>/etc/xinetd.d/vnc</filename> 中有一個組態檔。其中預設會提供六個組態區塊︰三個用於 VNC 檢視器 (<literal>vnc1</literal> 到 <literal>vnc3</literal>)，另外三個提供 Java Applet (<literal>vnchttpd1</literal> 到 <literal>vnchttpd3</literal>)。預設只有 <literal>vnc1</literal> 及 <literal>vnchttpd1</literal> 處於作用中狀態。
   </para>
   <para>
    若要啟用某個組態，請在第一欄中以 <literal>#</literal> 字元將 <literal>disable = yes</literal> 這一行設定成註解，或者乾脆移除該行。若要取消啟用某個組態，請取消註解或新增該行。
   </para>
   <para>
    <command>Xvnc</command> 伺服器可透過 <literal>server_args</literal> 選項設定。如需選項清單，請參閱 <command>Xnvc --help</command>。
   </para>
   <para>
    新增自訂組態時，請確定它們沒有使用同一台主機上的其他組態、服務或現有的永久 VNC 工作階段已在使用的連接埠。
   </para>
   <para>
    輸入以下指令啟用組態變更：
   </para>
<screen>sudo systemctl reload xinetd</screen>
   <important>
    <title>防火牆與 VNC 埠</title>
    <para>
     依照<xref linkend="pro.vnc.one-time.activate"/> 中所述啟用遠端管理時，會在防火牆中開啟連接埠 <systemitem class="resource">5801</systemitem> 及 <systemitem class="resource">5901</systemitem>。如果提供 VNC 工作階段的網路介面受防火牆保護，則您在為 VNC 工作階段啟用其他連接埠時，需要手動開啟相應的連接埠。如需指示，請參閱<xref linkend="cha.security.firewall"/>。
    </para>
   </important>
  </sect2>
 </sect1>
 <sect1 xml:id="sec.vnc.persistent">
  <title>永久 VNC 工作階段</title>

  <para>
   永久 VNC 工作階段在伺服器上啟動。不論用戶端的連接狀態為何，此工作階段以及在此工作階段中啟動的所有應用程式會一直執行，直至工作階段被終止。
  </para>

  <para>
   從多個用戶端可以同時存取一個永久工作階段。此特性非常適合用於在一個用戶端具有完整存取權，而所有其他用戶端具有僅檢視存取權的場合進行演示操作。在訓練中，訓練員可能需要存取學員桌面的情況則是另一個使用案例。不過，大多數情況下您可能並不想共用 VNC 工作階段。
  </para>

  <para>
   與會啟動顯示管理員的一次性工作階段不同，永久工作階段會啟動準備就緒的作業桌面，該桌面以啟動 VNC 工作階段之使用者的身分執行。對永久工作階段的存取受密碼保護。
  </para>

  <para>
   對永久工作階段的存取受到密碼保護，密碼可能為以下兩種類型：
  </para>

  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>
     授予完全存取權的一般密碼，或
    </para>
   </listitem>
   <listitem>
    <para>
     授予非互動式 (僅檢視) 存取權限的選擇性僅檢視密碼。
    </para>
   </listitem>
  </itemizedlist>

  <para>
   一個工作階段可以同時擁有這兩種類型的多個用戶端連接。
  </para>

  <procedure xml:id="pro.vnc.persistent.activate">
   <title>啟動永久 VNC 工作階段</title>
   <step>
    <para>
     開啟外圍程序，並確定您以應當擁有 VNC 工作階段的使用者身分登入。

    </para>
   </step>
   <step>
    <para>
     如果提供 VNC 工作階段的網路介面受防火牆保護，則您需要在防火牆中手動開啟工作階段使用的連接埠。如果要啟動多個工作階段，可以開啟一系列連接埠。如需如何設定防火牆的詳細資料，請參閱<xref linkend="cha.security.firewall"/>。
    </para>
    <para>
     <command>vncserver</command> 對顯示埠 <literal>:1</literal> 使用連接埠 <systemitem class="resource">5901</systemitem>，對顯示埠 <literal>:2</literal> 使用連接埠 <systemitem class="resource">5902</systemitem>，依此類推。對於永久工作階段，VNC 顯示埠和 X 顯示埠的號碼通常都是相同的。
    </para>
   </step>
   <step>
    <para>
     若要以 1024x769 像素的解析度及 16 位元的色彩深度啟動工作階段，請輸入以下指令：
    </para>
<screen>vncserver -geometry 1024x768 -depth 16</screen>
    <para>
     <command>vncserver</command> 指令在未指定顯示埠號碼的情況下，會挑選未使用的號碼，並列印它的選擇。有關更多選項的資訊，請參閱 <command>man 1 vncserver</command>。
    </para>
   </step>
  </procedure>

  <para>
   首次執行 <command>vncserver</command> 時，它會要求您輸入擁有工作階段完整存取權限的密碼。如果需要，您也可以提供對工作階段具有僅檢視存取權限的密碼。
  </para>

  <para>
   此處提供的密碼還可供同一個使用者用來啟動以後的工作階段。使用 <command>vncpasswd</command> 指令可以變更這些密碼。
  </para>

  <important>
   <title>安全性考量</title>
   <para>
    請務必使用足夠長 (8 個或更多字元) 的嚴密密碼。請不要共用這些密碼。
   </para>
  </important>

  <para>
   若要終止工作階段，請從 VNC 檢視器關閉在 VNC 工作階段內部執行的桌面環境，就如同關閉一般本地 X 工作階段一樣。
  </para>

  <para>
   如果您想要手動終止工作階段，請在 VNC 伺服器上開啟一個外圍程序，並務必以擁有您要終止之 VNC 工作階段的使用者身分登入。執行以下指令以終止在顯示埠 <literal>:1</literal> 上執行的工作階段︰<command>vncserver -kill :1</command>
  </para>

  <sect2 xml:id="sec.vnc.persistent.connect">
   <title>連接至永久 VNC 工作階段</title>
   <para>
    若要連接至永久 VNC 工作階段，必須安裝 VNC 檢視器。另請參閱<xref linkend="sec.vnc.viewer"/>。或者，可以在支援 Java 的網頁瀏覽器中，輸入 URL <literal>http://jupiter.example.com:5801</literal> 來檢視 VNC 工作階段
   </para>
  </sect2>

  <sect2 xml:id="sec.vnc.persistent.configure">
   <title>設定永久 VNC 工作階段</title>
   <para>
    永久 VNC 工作階段可透過編輯 <filename>$HOME/.vnc/xstartup</filename> 來設定。依預設，此外圍程序程序檔會啟動它啟動時所處的同一個 GUI/視窗管理員。在 <phrase role="productname"><phrase os="sled">SUSE Linux Enterprise Desktop</phrase></phrase> 中，此 GUI/視窗管理員為 GNOME 或 IceWM。如果想要使用您選擇的視窗管理員啟動工作階段，請設定變數 <envar>WINDOWMANAGER</envar>：
   </para>
<screen>WINDOWMANAGER=gnome vncserver -geometry 1024x768
WINDOWMANAGER=icewm vncserver -geometry 1024x768</screen>
   <note>
    <title>每個使用者對應一個組態</title>
    <para>
     永久 VNC 工作階段透過單個基於使用者的組態設定。由同一個使用者啟動的多個工作階段皆使用相同的啟動檔案和密碼檔案。
    </para>
   </note>
  </sect2>
 </sect1>
 <sect1 xml:id="vnc.encrypted">
  <title>加密 VNC 通訊</title>

  <para>
   如果 VNC 伺服器設定正確，則 VNC 伺服器與用戶端之間的所有通訊都會被加密。這包括開始時的驗證及後來的所有資料傳輸。
  </para>

  <para>
   無論您要啟動哪類 VNC 工作階段 (一次性或永久性)，都可透過 <literal>server_args</literal> 行中 <command>/usr/bin/Xvnc</command> 指令的 <option>-securitytypes</option> 參數設定安全性選項。<option>-securitytypes</option> 參數會選取驗證方法和加密。它的選項如下︰
  </para>

  <variablelist>
   <title>驗證</title>
   <varlistentry>
    <term>None、TLSNone、X509None</term>
    <listitem>
     <para>
      沒有驗證。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>VncAuth、TLSVnc、X509Vnc</term>
    <listitem>
     <para>
      驗證使用自訂密碼。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Plain、TLSPlain、X509Plain</term>
    <listitem>
     <para>
      驗證使用 PAM 來驗證使用者的密碼。
     </para>
    </listitem>
   </varlistentry>
  </variablelist>

  <variablelist>
   <title>加密</title>
   <varlistentry>
    <term>None、VncAuth、Plain</term>
    <listitem>
     <para>
      不加密。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>TLSNone、TLSVnc、TLSPlain</term>
    <listitem>
     <para>
      匿名 TLS 加密。所有內容都會加密，但不驗證遠端主機。因此，您可以防護被動攻擊者，但不能防禦中間人攻擊者。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>X509None、X509Vnc、X509Plain</term>
    <listitem>
     <para>
      使用證書進行 TLS 加密。如果使用自行簽署的證書，則在第一次連接時，系統將要求您驗證證書。在以後的連接中，僅當證書有變更時，系統才會向您發出警告。因此，在第一次連接時，您可以防禦中間人攻擊之外的所有其他攻擊 (類似於使用一般的 SSH)。如果使用由證書管理中心簽署且與機器名稱相符的證書，將可獲得完整的安全性 (類似於使用一般的 HTTPS)。
     </para>
     <tip>
      <title>證書和金鑰的路徑</title>
      <para>
       對於基於 X509 的加密，需要透過 <option>-X509Cert</option> 和 <option>-X509Key</option> 選項指定 X509 證書和金鑰的路徑。
      </para>
     </tip>
    </listitem>
   </varlistentry>
  </variablelist>

  <para>
   如果您選取多種安全性類型 (以逗號分隔)，將會使用用戶端與伺服器都支援且允許的第一種安全性。如此，您便可在伺服器上設定隨機加密。如果您需要支援不支援加密的 VNC 用戶端，此功能將相當實用。
  </para>

  <para>
   在用戶端上，您也可以指定允許的安全性類型，以防在您連接到已知啟用了加密的伺服器時遭到降級攻擊 (雖然在該情況下，我們的 vncviewer 會發出「連接未加密！」訊息來警告您)。
  </para>
 </sect1>
</chapter>
