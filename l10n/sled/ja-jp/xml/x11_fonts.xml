<?xml version="1.0" encoding="UTF-8"?>
<sect1 xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="x11_fonts.xml" version="5.0" xml:id="sec-x11-fontsys"> <title>フォントのインストールと設定</title>

 <info>
      <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
        <dm:bugtracker/>
        <dm:translation>yes</dm:translation>
      </dm:docmanager>
    </info>
    <para>
  Linuxのフォントは次の2つに分類できます。
 </para>

 <variablelist>
  <varlistentry>
   <term>アウトラインフォントまたはベクトルフォント</term>
   <listitem>
    <para>
     グリフの形状に関する描画命令として数学的記述が含まれています。このため、品質を損なうことなく各グリフを任意のサイズに拡大縮小できます。このようなフォント(グリフ)を使用するには、数学的記述をラスタ(グリッド)に変換する必要があります。このプロセスを<emphasis/>「フォントのラスタライズ」と呼びます。<emphasis/>「フォントヒンティング」 (フォント内に組み込まれている)は、特定のサイズのレンダリング結果を向上および最適化します。ラスタライズとヒンティングは、FreeTypeライブラリによって行われます。
    </para>
    <para>
     Linuxで一般的な形式は、PostScript Type 1とType 2、TrueType、およびOpenTypeです。
    </para>
   </listitem>
  </varlistentry>
  <varlistentry>
   <term>ビットマップフォントまたはラスタフォント</term>
   <listitem>
    <para>
     特定のフォントサイズ用にデザインされたピクセルの配列で構成されます。ビットマップフォントは非常に高速でレンダリングも容易です。ただし、ベクトルフォントと比較した場合、ビットマップフォントは品質を損なわずに拡大縮小することはできません。そのため、これらのフォントは通常、複数のサイズで配布されます。現在でも、Linuxコンソールや一部の端末ではビットマップフォントが使用されています。
    </para>
    <para>
     Linuxでは、PCF (Portable Compiled Format)またはBDF (Glyph Bitmap Distribution Format)が最も一般的な形式です。
    </para>
   </listitem>
  </varlistentry>
 </variablelist>

 <para>
  これらのフォントの外観は、主に次の2つの側面による影響を受けます。
 </para>

 <itemizedlist mark="bullet" spacing="normal">
  <listitem>
   <para>
    適切なフォントファミリを選択する
   </para>
  </listitem>
  <listitem>
   <para>
    ユーザが読みやすい結果を実現するアルゴリズムでフォントをレンダリングする
   </para>
  </listitem>
 </itemizedlist>

 <para>
  最後の点は、ベクトルフォントにのみ関係があります。上述の2つの点は主観に大きく左右されますが、何らかのデフォルト値を作成する必要があります。
 </para>

 <para>
  Linuxのフォントレンダリングシステムは、異なる関係を持つ複数のライブラリで構成されます。基本のフォントレンダリングライブラリは<link xlink:href="http://www.freetype.org/">FreeType</link>で、サポートされている形式のフォントグリフを最適化されたビットマップグリフに変換します。レンダリングプロセスはアルゴリズムとそのパラメータによって制御されます(特許の問題が絡む場合があります)。
 </para>

 <para>
  FreeTypeを使用するすべてのプログラムまたはライブラリは、<link xlink:href="http://www.fontconfig.org/">Fontconfig</link>ライブラリを参照する必要があります。このライブラリは、ユーザとシステムからフォント設定を収集します。ユーザが自分のFontconfig設定を修正した場合、このような変更によってアプリケーションはFontconfig対応になります。
 </para>

 <para>
  アラビア語、ハン語、またはパスパなどのスクリプトおよびその他の高レベルのテキスト処理に必要な、より洗練されたOpenType形成は、<link xlink:href="http://www.harfbuzz.org/">Harfbuzz</link>または<link xlink:href="http://www.pango.org/">Pango</link>を使用して行われます。
 </para>

 <sect2 xml:id="sec-x11-fontsys-showing-fonts">
  <title>インストール済みフォントの表示</title>
  <para>
   システムにインストールされているフォントの概要を表示するには、<command>rpm</command>コマンドまたは<command>fc-list</command>コマンドを使用します。どちらのコマンドでも適切な回答が得られますが、システムおよびユーザの設定によっては異なるリストが返されることがあります。
  </para>
  <variablelist>
   <varlistentry>
    <term><command>rpm</command>
    </term>
    <listitem>
     <para>
      システムにインストールされている、フォントが格納されたソフトウェアパッケージを参照するには、<command>rpm</command>を起動します。
     </para>
<screen><prompt>tux &gt; </prompt>rpm -qa '*fonts*'</screen>
     <para>
      すべてのフォントパッケージがこの式を満たす必要があります。ただし、このコマンドは、<literal>fonts-config</literal>のような誤検知を返す場合があります(これはフォントではなく、フォントも含みません)。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><command>fc-list</command>
    </term>
    <listitem>
     <para>
      アクセスできるフォントファミリ、およびそれらのフォントがシステムまたはホームのどちらにインストールされているかに関する概要を参照するには、<command>fc-list</command>を起動します。
     </para>
<screen><prompt>tux &gt; </prompt>fc-list ':' family</screen>
     <note>
      <title><command>fc-list</command>コマンド</title>
      <para>
       <command>fc-list</command>コマンドは、Fontconfigライブラリのラッパーです。Fontconfig (正確にはそのキャッシュ)に対して、多くの有用な情報を問い合わせることができます。詳細については、<command>man 1 fc-list</command>を参照してください。
      </para>
     </note>
    </listitem>
   </varlistentry>
  </variablelist>
 </sect2>

 <sect2 xml:id="sec-x11-fontsys-viewing">
  <title>フォントの表示</title>
  <para>
   インストールされているフォントファミリのデザインを知りたい場合は、<command>ftview</command>コマンド(<systemitem>ft2demos</systemitem>パッケージ)を使用するか、<link xlink:href="http://fontinfo.opensuse.org/"/>にアクセスします。たとえば、FreeMonoフォントを14ポイントで表示するには、<command>ftview</command>を次のように使用します。
  </para>
<screen><prompt>tux &gt; </prompt>ftview 14 /usr/share/fonts/truetype/FreeMono.ttf</screen>
  <para>
   さらに詳しい情報が必要な場合は、<link xlink:href="http://fontinfo.opensuse.org/"/>にアクセスして、サポートされているスタイル(通常のフォント、太字、斜体など)と言語を参照します。
  </para>
 </sect2>

 <sect2 xml:id="sec-x11-fontsys-querying">
  <title>フォントの問い合わせ</title>
  <para>
   パターンを指定した場合にどのフォントが使用されるかを問い合わせるには、<command>fc-match</command>コマンドを使用します。
  </para>
  <para>
   たとえば、インストール済みのフォントをパターンに含めると、<command>fc-match</command>は、ファイル名、フォントファミリ、およびスタイルを返します。
  </para>
<screen><prompt>tux &gt; </prompt>fc-match 'Liberation Serif'
LiberationSerif-Regular.ttf: "Liberation Serif" "Regular"</screen>
  <para>
   目的のフォントがシステムに存在しない場合は、Fontconfigの照合ルールが実行され、利用可能なフォントの中で最もそのフォントに似ているフォントを見つけようとします。つまり、要求は次のように置換されます。
  </para>
<screen><prompt>tux &gt; </prompt>fc-match 'Foo Family'
DejaVuSans.ttf: "DejaVu Sans" "Book"</screen>
  <para>
   Fontconfigは<emphasis/>「エイリアス」をサポートしており、名前は別のファミリ名に置換されます。代表的な例は、<quote>sans-serif</quote>、<quote>serif</quote>、<quote>monospace</quote>などの汎用名です。これらのエイリアスは、実際のファミリ名で置換することも、ファミリ名の優先リストで置換することもできます。
  </para>
<screen><prompt>tux &gt; </prompt>for font in serif sans mono; do fc-match "$font" ; done
DejaVuSerif.ttf: "DejaVu Serif" "Book"
DejaVuSans.ttf: "DejaVu Sans" "Book"
DejaVuSansMono.ttf: "DejaVu Sans Mono" "Book"</screen>
  <para>
   現在インストールされているフォントによっては、使用中のシステムでの結果は異なる場合があります。
  </para>
  <note>
   <title>Fontconfigに従った類似性ルール</title>
   <para>
    Fontconfigは、指定された要求に従って<emphasis/>「常に」、できる限り類似性の高い実際のファミリを返します(少なくともファミリが1つインストールされている場合)。<quote>類似性</quote>は、Fontconfigの内部メトリクスと、ユーザまたは管理者のFontconfig設定に依存します。
   </para>
  </note>
 </sect2>

 <sect2 xml:id="sec-x11-fontsys-install">
  <title>フォントのインストール</title>
  <para>
   新しいフォントをインストールする主な方法は次のとおりです。
  </para>
  <orderedlist spacing="normal">
   <listitem>
    <para>
     <filename>*.ttf</filename>や<filename>*.otf</filename>などのフォントファイルを既知のフォントディレクトリに手動でインストールする。システム全体で使用できるようにする場合は、標準のディレクトリ<filename>/usr/share/fonts</filename>を使用します。自分のホームディレクトリにインストールする場合は、<filename>~/.config/fonts</filename>を使用します。
    </para>
    <para>
     標準のディレクトリ以外を使用する場合は、Fontconfigで別のディレクトリを選択できます。Fontconfigにディレクトリを認識させるには、<literal>&lt;dir&gt;</literal>要素を使用します。詳細については、<xref linkend="sec-x11-fontsys-config-fontconfig"/>を参照してください。
    </para>
   </listitem>
   <listitem>
    <para>
     <command>zypper</command>を使用してフォントをインストールする。SUSEディストリビューションであっても、<link xlink:href="http://download.opensuse.org/repositories/M17N:/fonts/">M17N:fonts</link>リポジトリであっても、多くのフォントはすでにパッケージとして利用可能です。次のコマンドを使用して、リポジトリをリストに追加します。たとえば、<phrase role="productname"><phrase os="sled">SUSE Linux Enterprise Desktop</phrase></phrase> <phrase role="productnumber"><phrase os="sles;sled">15 SP3</phrase></phrase>のリポジトリを追加するには次のようにします。
    </para>
<screen><prompt>tux &gt; </prompt><command>sudo</command> zypper ar
     <phrase os="sles;sled">https://download.opensuse.org/repositories/M17N:/fonts/SLE_15/</phrase></screen>
    <para>
     <replaceable>FONT_FAMILY_NAME</replaceable>を検索するには、次のコマンドを使用します。
    </para>
<screen><prompt>tux &gt; </prompt>zypper se '<replaceable>FONT_FAMILY_NAME</replaceable>*fonts'</screen>
   </listitem>


  </orderedlist>
 </sect2>

 <sect2 xml:id="sec-x11-fontsys-config">
  <title>フォントの外観の設定</title>
  <para>
   レンダリングメディアおよびフォントサイズによっては、満足できる結果が得られないことがあります。たとえば、近年の平均的なモニタの解像度は100dpiであるため、ピクセルが大きくなりすぎ、グリフが綺麗に表示されません。
  </para>
  <para>
   アンチエイリアス(グレースケールスムージング)、ヒンティング(グリッドフィッティング)、またはサブピクセルレンダリング(1方向の解像度を3倍にする)など、低解像度に対応するアルゴリズムはいくつもあります。これらのアルゴリズムはフォントの形式によっても異なることがあります。
  </para>
  <important>
   <title>サブピクセルレンダリングの特許の問題</title>
   <para>
    サブピクセルレンダリングは、SUSEディストリビューションでは使用されません。FreeType2はこのアルゴリズムをサポートしていますが、このアルゴリズムは、2019年末に有効期限が切れる複数の特許で保護されています。したがって、サブピクセルレンダリングがコンパイルされたFreeType2ライブラリがシステムにない限り、Fontconfigのサブピクセルレンダリングオプションを設定しても効果はありません。
   </para>
  </important>
  <para>
   Fontconfigでは、レンダリングアルゴリズムをすべてのフォントに対して個別に選択することも、フォントのセットに対して選択することもできます。
  </para>
  <sect3 xml:id="sec-x11-fontsys-config-sysconfig">
   <title><literal>sysconfig</literal>によるフォントの設定</title>
   <para>
    <phrase role="productname"><phrase os="sled">SUSE Linux Enterprise Desktop</phrase></phrase>には、Fontconfig上に<literal>sysconfig</literal>層があります。これは、フォント設定を試してみる場合の開始点として便利です。デフォルト設定を変更するには、設定ファイル<filename>/etc/sysconfig/fonts-config</filename>を編集します(またはYaST sysconfigモジュールを使用します)。ファイルの編集後、<command>fonts-config</command>を実行します。
   </para>
<screen><prompt>tux &gt; </prompt><command>sudo</command> /usr/sbin/fonts-config</screen>
   <para>
    アプリケーションを再起動して結果を表示します。次の点に注意してください。
   </para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>
      一部のアプリケーションでは再起動は必要ありません。たとえば、Firefoxは随時Fontconfig設定を再読み込みします。新たに作成したタブや再ロードしたタブには、新しいフォント設定が後で適用されます。
     </para>
    </listitem>
    <listitem>
     <para>
      パッケージをインストールまたは削除するたびに<command>fonts-config</command>スクリプトが自動的に呼び出されます(呼び出されない場合は、フォントソフトウェアパッケージのバグです)。
     </para>
    </listitem>
    <listitem>
     <para>
      <command>fonts-config</command>コマンドラインオプションで、すべてのsysconfig変数を一時的に上書きできます。詳細については、<command>fonts-config --help</command>を参照してください。
     </para>
    </listitem>
   </itemizedlist>
   <para>
    いくつかのsysconfig変数は変更することができます。<command>man 1 fonts-config</command>またはYaST sysconfigモジュールのヘルプを参照してください。次に、変数の例を示します。
   </para>
   <variablelist>
    <varlistentry>
     <term>レンダリングアルゴリズムの使用方法</term>
     <listitem>
      <para>
       <varname>FORCE_HINTSTYLE</varname>、<varname>FORCE_AUTOHINT</varname>、<varname>FORCE_BW</varname>、<varname>FORCE_BW_MONOSPACE</varname>、<varname>USE_EMBEDDED_BITMAPS</varname>、および<varname>EMBEDDED_BITMAP_LANGAGES</varname>を検討してください
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>汎用エイリアスの優先リスト</term>
     <listitem>
      <para>
       <varname>PREFER_SANS_FAMILIES</varname>、<varname>PREFER_SERIF_FAMILIES</varname>、<varname>PREFER_MONO_FAMILIES</varname>、および<varname>SEARCH_METRIC_COMPATIBLE</varname>を使用します
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
   <para>
    次のリストは設定例を示しています。これは<quote>最も読みやすい</quote>フォント(コントラストが高い)から<quote>最も美しい</quote>フォント(スムージングが強い)の順にソートされています。
   </para>
   <variablelist>
    <varlistentry xml:id="vle-x11-fontsys-sysconfig-bitmap">
     <term>ビットマップフォント</term>
     <listitem>
      <para>
       <varname>PREFER_*_FAMILIES</varname>変数を介してビットマップフォントを優先します。これらの変数については、ヘルプセクションの例に従ってください。これらのフォントは白黒でレンダリングされスムージングされない点、およびビットマップフォントはいくつかのサイズしか用意されていない点に注意してください。次の設定
      </para>
<screen>SEARCH_METRIC_COMPATIBLE="no"</screen>
      <para>
       を使用して、メトリック互換性主導型のファミリ名の置換を無効にすることを検討します。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry xml:id="vle-x11-fontsys-sysconfig-bw">
     <term>白黒にレンダリングされるスケーラブルフォント</term>
     <listitem>
      <para>
       アンチエイリアスなしでレンダリングされるスケーラブルフォントは、ビットマップフォントと同様の結果になる可能性がありますが、フォントの拡大縮小機能は維持されます。Liberationファミリのような適切にヒンティングされたフォントを使用します。ただし、残念ながら、適切にヒンティングされたフォントは多くありません。この方法を強制するには、次の変数を設定します。
      </para>
<screen>FORCE_BW="yes"</screen>
     </listitem>
    </varlistentry>
    <varlistentry xml:id="vle-x11-fontsys-sysconfig-bw-monospace">
     <term>白黒にレンダリングされる等幅フォント</term>
     <listitem>
      <para>
       等幅フォントは、アンチエイリアスのみを使用せずにレンダリングします。そうでない場合は、デフォルト設定を使用します。
      </para>
<screen>FORCE_BW_MONOSPACE="yes"</screen>
     </listitem>
    </varlistentry>
    <varlistentry xml:id="vle-x11-fontsys-sysconfig-default">
     <term>デフォルト設定</term>
     <listitem>
      <para>
       すべてのフォントはアンチエイリアスを使用してレンダリングされます。適切にヒンティングされたフォントは<emphasis/>「バイトコードインタープリタ」 (BCI)でレンダリングされ、それ以外はautohinter (<literal>hintstyle=hintslight</literal>)でレンダリングされます。関連するsysconfig変数はすべてデフォルト設定のままにします。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry xml:id="vle-x11-fontsys-sysconfig-cff">
     <term>CFFフォント</term>
     <listitem>
      <para>
       CFF形式のフォントを使用します。現在、FreeType2には数々の点で改良が重ねられており、このフォントは、デフォルトのTrueTypeフォントよりも可読性が高いと考えることができます。<literal>PREFER_*_FAMILIES</literal>の例に従って、このフォントを試してみてください。場合によっては、次の設定を使用して、より濃く太いフォントにできます。
      </para>
<screen>SEARCH_METRIC_COMPATIBLE="no"</screen>
      <para>
       その理由は、このフォントは、デフォルトでは<literal>hintstyle=hintslight</literal>でレンダリングされているためです。次の設定の使用も検討してください。
      </para>
<screen>SEARCH_METRIC_COMPATIBLE="no"</screen>
     </listitem>
    </varlistentry>
    <varlistentry xml:id="ex-x11-fontsys-sysconfig-autohint">
     <term>Autohinterの排他的使用</term>
     <listitem>
      <para>
       適切にヒンティングされたフォントに対しても、FreeType2のautohinterを使用します。これにより、太く(場合によっては不鮮明な)、コントラスの低い文字形状になります。これを有効にするには、次の変数を設定します。
      </para>
<screen>FORCE_AUTOHINTER="yes"</screen>
      <para>
       ヒンティングのレベルを制御するには、<literal>FORCE_HINTSTYLE</literal>を使用します。
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
  </sect3>
  <sect3 xml:id="sec-x11-fontsys-config-fontconfig">
   <title>Fontconfig XMLの詳細</title>
   <para>
    Fontconfigの環境設定のフォーマットは、<emphasis>eXtensible Markup Language</emphasis> (XML)です。ここで取り上げるいくつかの例は、完全なリファレンスではなく概要です。詳しい情報とその他の例については、<command>man 5 fonts-conf</command>または<filename>/etc/fonts/conf.d/</filename>を参照してください。
   </para>
   <para>
    中央のFontconfig設定ファイルは<filename>/etc/fonts/fonts.conf</filename>で、他の例と<filename>/etc/fonts/conf.d/</filename>ディレクトリ全体が含まれます。Fontconfigをカスタマイズする場合、変更を挿入できる場所は2つあります。
   </para>
   <orderedlist xml:id="ol-x11-fontsys-configfiles" spacing="normal">
    <title>Fontconfig設定ファイル</title>
    <listitem>
     <formalpara>
      <title>システム全体の変更</title>
      <para>
       <filename>/etc/fonts/local.conf</filename>ファイルを編集します(デフォルトで空の<literal>fontconfig</literal>要素が含まれています)。
      </para>
     </formalpara>
    </listitem>
    <listitem>
     <formalpara>
      <title>ユーザ固有の変更</title>
      <para>
       <filename>~/.config/fontconfig/fonts.conf</filename>ファイルを編集します。Fontconfig設定ファイルは、<filename>~/.config/fontconfig/conf.d/</filename>ディレクトリに保存します。
      </para>
     </formalpara>
    </listitem>
   </orderedlist>
   <para>
    ユーザ固有の変更は、システム全体の設定よりも優先されます。
   </para>
   <note>
    <title>非推奨のユーザ設定ファイル</title>
    <para>
     <filename>~/.fonts.conf</filename>ファイルには非推奨のマークが付いているため、今後は使用しないことをお勧めします。代わりに<filename>~/.config/fontconfig/fonts.conf</filename>を使用してください。
    </para>
   </note>
   <para>
    すべての設定ファイルには<literal>fontconfig</literal>要素が必要です。そのため、最小限のファイルは次のようになります。
   </para>
<screen>&lt;?xml version="1.0"?&gt;
   &lt;!DOCTYPE fontconfig SYSTEM "fonts.dtd"&gt;
   &lt;fontconfig&gt;
   &lt;!-- Insert your changes here --&gt;
   &lt;/fontconfig&gt;</screen>
   <para>
    デフォルトのディレクトリでは不十分な場合は、各ディレクトリを指定した<literal>dir</literal>要素を挿入します。
   </para>
<screen>&lt;dir&gt;/usr/share/fonts2&lt;/dir&gt;</screen>
   <para>
    Fontconfigは、<emphasis/>「再帰的」にフォントを検索します。
   </para>
   <para>
    次のFontconfigスニペットでフォントレンダリングアルゴリズムを選択できます(<xref linkend="ex-x11-fontsys-fontconfig-rendering-algorithms"/>を参照)。
   </para>
   <example xml:id="ex-x11-fontsys-fontconfig-rendering-algorithms">
    <title>レンダリングアルゴリズムを指定する</title>
<screen>&lt;match target="font"&gt;
 &lt;test name="family"&gt;
  &lt;string&gt;<replaceable>FAMILY_NAME</replaceable>&lt;/string&gt;
 &lt;/test&gt;
 &lt;edit name="antialias" mode="assign"&gt;
  &lt;bool&gt;true&lt;/bool&gt;
 &lt;/edit&gt;
 &lt;edit name="hinting" mode="assign"&gt;
  &lt;bool&gt;true&lt;/bool&gt;
 &lt;/edit&gt;
 &lt;edit name="autohint" mode="assign"&gt;
  &lt;bool&gt;false&lt;/bool&gt;
 &lt;/edit&gt;
 &lt;edit name="hintstyle" mode="assign"&gt;
  &lt;const&gt;hintfull&lt;/const&gt;
 &lt;/edit&gt;
&lt;/match&gt;</screen>
   </example>
   <para>
    さまざまなフォントプロパティをテストできます。たとえば、フォントファミリ(例を参照)、サイズの間隔、スペーシング、フォント形式などについて、<literal>&lt;test&gt;</literal>要素をテストできます。<literal>&lt;test&gt;</literal>を完全に破棄した場合、すべての<literal>&lt;edit&gt;</literal>要素が各フォントに適用されます(グローバルな変更)。
   </para>
   <example xml:id="ex-x11-fontsys-fontconfig-aliases1">
    <title>エイリアスとファミリ名の置換</title>
    <variablelist>
     <varlistentry xml:id="vle-x11-fontsys-example-alias-default">
      <term>ルール1</term>
      <listitem>
<screen>&lt;alias&gt;
 &lt;family&gt;Alegreya SC&lt;/family&gt;
 &lt;default&gt;
  &lt;family&gt;serif&lt;/family&gt;
 &lt;/default&gt;
&lt;/alias&gt;</screen>
      </listitem>
     </varlistentry>
     <varlistentry xml:id="vle-x11-fontsys-example-alias-prefer">
      <term>ルール2</term>
      <listitem>
<screen>&lt;alias&gt;
 &lt;family&gt;serif&lt;/family&gt;
 &lt;prefer&gt;
  &lt;family&gt;Droid Serif&lt;/family&gt;
 &lt;/prefer&gt;
&lt;/alias&gt;</screen>
      </listitem>
     </varlistentry>
     <varlistentry xml:id="vle-x11-fontsys-example-alias-accept">
      <term>ルール3</term>
      <listitem>
<screen>&lt;alias&gt;
 &lt;family&gt;serif&lt;/family&gt;
 &lt;accept&gt;
  &lt;family&gt;STIXGeneral&lt;/family&gt;
 &lt;/accept&gt;
&lt;/alias&gt;</screen>
      </listitem>
     </varlistentry>
    </variablelist>
   </example>
   <para>
    <xref linkend="ex-x11-fontsys-fontconfig-aliases1"/>のルールは、<emphasis/>「優先ファミリリスト」 (PFL)を作成します。要素に応じて異なるアクションが実行されます。
   </para>
   <variablelist>
    <varlistentry>
     <term><xref linkend="vle-x11-fontsys-example-alias-default"/>の<literal>&lt;default&gt;</literal>の場合
     </term>
     <listitem>
      <para>
       このルールは、<literal>serif</literal>ファミリ名を<emphasis/>PFLの「末尾」に追加します。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><xref linkend="vle-x11-fontsys-example-alias-prefer"/>の<literal>&lt;prefer&gt;</literal>の場合
     </term>
     <listitem>
      <para>
       このルールは、PFLに<literal>Alegreya SC</literal>が存在する場合、PFLで<literal>serif</literal>が最初に出現する箇所の「直前」に<quote>Droid Serif</quote> <emphasis/>を追加します。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><xref linkend="vle-x11-fontsys-example-alias-accept"/>の<literal>&lt;accept&gt;</literal>の場合
     </term>
     <listitem>
      <para>
       このルールは、PFLで<literal>serif</literal>ファミリ名が最初に出現する箇所の<emphasis/><quote>直後</quote>に「STIXGeneral」ファミリ名を追加します。
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
   <para>
    まとめると、スニペットが<xref linkend="vle-x11-fontsys-example-alias-default"/> - <xref linkend="vle-x11-fontsys-example-alias-prefer"/> - <xref linkend="vle-x11-fontsys-example-alias-accept"/>という順序で記述されている場合、ユーザが<quote>Alegreya SC</quote>を要求すると、<xref linkend="tab-x11-fontsys-example-alias"/>で説明されているようにPFLが作成されます。
   </para>
   <table xml:id="tab-x11-fontsys-example-alias">
    <title>fontconfigルールからのPFLの作成</title>
    <tgroup cols="2">
     <colspec colwidth="1*"/>
     <colspec colwidth="3*"/>
     <thead>
      <row>
       <entry>
        <para>
         順序
        </para>
       </entry>
       <entry>
        <para>
         現在のPFL
        </para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row>
       <entry>
        <para>
         要求
        </para>
       </entry>
       <entry>
        <para>
         <literal>Alegreya SC</literal>
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <xref linkend="vle-x11-fontsys-example-alias-default"/>
        </para>
       </entry>
       <entry>
        <para>
         <literal>Alegreya SC</literal>、<literal>serif</literal>
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <xref linkend="vle-x11-fontsys-example-alias-prefer"/>
        </para>
       </entry>
       <entry>
        <para>
         <literal>Alegreya SC</literal>、<literal>Droid Serif</literal>、<literal>serif</literal>
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <xref linkend="vle-x11-fontsys-example-alias-accept"/>
        </para>
       </entry>
       <entry>
        <para>
         <literal>Alegreya SC</literal>、<literal>Droid Serif</literal>、<literal>serif</literal>、<literal>STIXGeneral</literal>
        </para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </table>
   <para>
    Fontconfigのメトリクスでは、ファミリ名は、他のパターン(スタイルやサイズなど)に比べて最も高い優先度を持ちます。Fontconfigは、システムに現在インストールされているファミリを確認します。<quote>Alegreya SC</quote>がインストールされている場合、Fontconfigはそれを返します。インストールされていない場合、<quote>Droid Serif</quote>などを要求します。
   </para>
   <para>
    注意してください。Fontconfigスニペットの順序を変更すると、Fontconfigが異なる結果を返す可能性があります。<xref linkend="tab-x11-fontsys-example-alias2"/>を参照してください。
   </para>
   <table xml:id="tab-x11-fontsys-example-alias2">
    <title>順序を変更したFontconfigルールからのPFL生成結果</title>
    <tgroup cols="3">
     <thead>
      <row>
       <entry>
        <para>
         順序
        </para>
       </entry>
       <entry>
        <para>
         現在のPFL
        </para>
       </entry>
       <entry>
        <para>
         注意
        </para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row>
       <entry>
        <para>
         要求
        </para>
       </entry>
       <entry>
        <para>
         <literal>Alegreya SC</literal>
        </para>
       </entry>
       <entry>
        <para>
         同じ要求が実行されます。
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <xref linkend="vle-x11-fontsys-example-alias-prefer"/>
        </para>
       </entry>
       <entry>
        <para>
         <literal>Alegreya SC</literal>
        </para>
       </entry>
       <entry>
        <para>
         <literal>serif</literal>がPFLに存在しないため、何も置換されません。
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <xref linkend="vle-x11-fontsys-example-alias-accept"/>
        </para>
       </entry>
       <entry>
        <para>
         <literal>Alegreya SC</literal>
        </para>
       </entry>
       <entry>
        <para>
         <literal>serif</literal>がPFLに存在しないため、何も置換されません。
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <xref linkend="vle-x11-fontsys-example-alias-default"/>
        </para>
       </entry>
       <entry>
        <para>
         <literal>Alegreya SC</literal>、<literal>serif</literal>
        </para>
       </entry>
       <entry>
        <para>
         <literal>Alegreya SC</literal>がPFLに存在するため、置換が実行されます。
        </para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </table>
   <note>
    <title>意味</title>
    <para>
     <literal>&lt;default&gt;</literal>のエイリアスは、このグループ(インストールされていない場合)の分類または組み込みであると考えてください。この例が示すように、<literal>&lt;default&gt;</literal>は常にこのグループの<literal>&lt;prefer&gt;</literal>および<literal>&lt;accept&gt;</literal>のエイリアスより前に配置する必要があります。
    </para>
    <para>
     <literal>&lt;default&gt;</literal>の分類は、汎用のエイリアスのserif、sans-serif、および等幅に限定されません。複雑な例については、<filename>/usr/share/fontconfig/conf.avail/30-metric-aliases.conf</filename>を参照してください。
    </para>


   </note>
   <para>
    <xref linkend="ex-x11-fontsys-fontconfig-aliases2"/>に示す次のFontconfigスニペットは、<literal>serif</literal>グループを作成します。このグループのすべてのファミリは、前のフォントがインストールされていない場合、他のフォントを置換できます。
   </para>
   <example xml:id="ex-x11-fontsys-fontconfig-aliases2">
    <title>エイリアスとファミリ名の置換</title>
<screen>&lt;alias&gt;
 &lt;family&gt;Alegreya SC&lt;/family&gt;
 &lt;default&gt;
  &lt;family&gt;serif&lt;/family&gt;
 &lt;/default&gt;
&lt;/alias&gt;
&lt;alias&gt;
 &lt;family&gt;Droid Serif&lt;/family&gt;
 &lt;default&gt;
  &lt;family&gt;serif&lt;/family&gt;
 &lt;/default&gt;
&lt;/alias&gt;
&lt;alias&gt;
 &lt;family&gt;STIXGeneral&lt;/family&gt;
 &lt;default&gt;
  &lt;family&gt;serif&lt;/family&gt;
 &lt;/default&gt;
&lt;/alias&gt;
&lt;alias&gt;
 &lt;family&gt;serif&lt;/family&gt;
 &lt;accept&gt;
  &lt;family&gt;Droid Serif&lt;/family&gt;
  &lt;family&gt;STIXGeneral&lt;/family&gt;
  &lt;family&gt;Alegreya SC&lt;/family&gt;
 &lt;/accept&gt;
&lt;/alias&gt;</screen>
   </example>
   <para>
    優先度は、<literal>&lt;accept&gt;</literal>エイリアス内の順序によって決まります。同様に、それよりも強い<literal>&lt;prefer&gt;</literal>エイリアスを使用できます。
   </para>
   <para>
    <xref linkend="ex-x11-fontsys-fontconfig-aliases1"/>を<xref linkend="ex-x11-fontsys-fontconfig-aliases3"/>で拡張します。
   </para>
   <example xml:id="ex-x11-fontsys-fontconfig-aliases3">
    <title>エイリアスとファミリ名の置換</title>
    <variablelist>
     <varlistentry xml:id="vle-x11-fontsys-example-alias-accept2">
      <term>ルール4</term>
      <listitem>
<screen>&lt;alias&gt;
 &lt;family&gt;serif&lt;/family&gt;
 &lt;accept&gt;
  &lt;family&gt;Liberation Serif&lt;/family&gt;
 &lt;/accept&gt;
&lt;/alias&gt;</screen>
      </listitem>
     </varlistentry>
     <varlistentry xml:id="vle-x11-fontsys-example-alias-prefer2">
      <term>ルール5</term>
      <listitem>
<screen>&lt;alias&gt;
 &lt;family&gt;serif&lt;/family&gt;
 &lt;prefer&gt;
  &lt;family&gt;DejaVu Serif&lt;/family&gt;
 &lt;/prefer&gt;
&lt;/alias&gt;</screen>
      </listitem>
     </varlistentry>
    </variablelist>
   </example>
   <para>
    <xref linkend="ex-x11-fontsys-fontconfig-aliases3"/>の拡張された設定では、PFLは次のように展開されます。
   </para>
   <table xml:id="tab-x11-fontsys-example-alias3">
    <title>FontconfigルールからのPFL生成結果</title>
    <tgroup cols="2">
     <colspec colwidth="1*"/>
     <colspec colwidth="3*"/>
     <thead>
      <row>
       <entry>
        <para>
         順序
        </para>
       </entry>
       <entry>
        <para>
         現在のPFL
        </para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row>
       <entry>
        <para>
         要求
        </para>
       </entry>
       <entry>
        <para>
         <literal>Alegreya SC</literal>
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <xref linkend="vle-x11-fontsys-example-alias-default"/>
        </para>
       </entry>
       <entry>
        <para>
         <literal>Alegreya SC</literal>、<literal>serif</literal>
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <xref linkend="vle-x11-fontsys-example-alias-prefer"/>
        </para>
       </entry>
       <entry>
        <para>
         <literal>Alegreya SC</literal>、<literal>Droid Serif</literal>、<literal>serif</literal>
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <xref linkend="vle-x11-fontsys-example-alias-accept"/>
        </para>
       </entry>
       <entry>
        <para>
         <literal>Alegreya SC</literal>、<literal>Droid Serif</literal>、<literal>serif</literal>、<literal>STIXGeneral</literal>
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <xref linkend="vle-x11-fontsys-example-alias-accept2"/>
        </para>
       </entry>
       <entry>
        <para>
         <literal>Alegreya SC</literal>、<literal>Droid Serif</literal>、<literal>serif</literal>、<literal>Liberation Serif</literal>、<literal>STIXGeneral</literal>
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <xref linkend="vle-x11-fontsys-example-alias-prefer2"/>
        </para>
       </entry>
       <entry>
        <para>
         <literal>Alegreya SC</literal>、<literal>Droid Serif</literal>、<literal>DejaVu Serif</literal>、<literal>serif</literal>、<literal>Liberation Serif</literal>、<literal>STIXGeneral</literal>
        </para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </table>
   <note>
    <title>意味</title>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <para>
       同じ汎用名に対して複数の<literal>&lt;accept&gt;</literal>宣言が存在する場合、最後に解析された宣言が<quote>優先</quote>されます。システム全体の設定を作成する場合、可能であれば、ユーザ(<literal>/etc/fonts/conf.d/*-user.conf</literal> <emphasis role="bold"/>)の「後」に<filename>&lt;accept&gt;</filename>を使用しないでください。
      </para>
     </listitem>
     <listitem>
      <para>
       同じ汎用名に対して複数の<literal>&lt;prefer&gt;</literal>宣言が存在する場合、最後に解析された宣言が<quote>優先</quote>されます。可能であれば、システム全体の設定では、ユーザの「前」に<literal>&lt;prefer&gt;</literal>
       <emphasis role="bold"/>を使用しないでください。
      </para>
     </listitem>
     <listitem>
      <para>
       同じ汎用名に対しては、すべての<literal>&lt;prefer&gt;</literal>宣言が<literal>&lt;accept&gt;</literal>宣言よりも優先されます。ユーザが<literal>&lt;prefer&gt;</literal>だけでなく<literal>&lt;accept&gt;</literal>も使用できるようにする場合、管理者はシステム全体の設定で<literal>&lt;prefer&gt;</literal>を使用しないようにする必要があります。一方、ユーザは通常<literal>&lt;prefer&gt;</literal>を使用するため、これが悪影響を及ぼさないようにする必要があります。また、システム全体の設定の<literal>&lt;prefer&gt;</literal>の使用も確認します。
      </para>
     </listitem>
    </itemizedlist>
   </note>
  </sect3>
 </sect2>
</sect1>
