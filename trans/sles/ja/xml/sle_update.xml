<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE chapter PUBLIC "-//Novell//DTD NovDoc XML V1.0//EN" "novdocx.dtd">
<!--
*********************************
Please see LICENSE.txt for this document's license.
*********************************
-->
<chapter xml:base="sle_update.xml" id="cha.update.sle">
 <title>SUSE Linux Enterpriseのアップデート</title>
 <abstract>
  <para>
   SUSE® Linux Enterprise (SLE)では、既存のシステムを新しいバージョンにアップデートできます。たとえば、SLE 11 SP3をSLE 12にアップデートできます。新たにインストールする必要はありません。ホームディレクトリ、データディレクトリ、システム設定などの既存のデータは、そのまま保持されます。CD/DVDドライブから、またはネットワーク上にある中央のインストールソースからアップデートできます。
  </para>

  <para>
   SUSE Linux Enterpriseのアップデート、アップグレード、およびサービスパック全般について十分に理解している場合は、「用語集」のセクションで新しい情報を確認したら、すぐにアップデートの概要セクションに進んで構いません。ここでは、利用できる可能性があるアップデートを示し、アップデート全体の計画立案を支援します。また、これ以降のセクションでは、現行リリースである<phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> <phrase role="productname"><phrase os="sles;sled;slerte">12</phrase></phrase>へのステップバイステップのアップデート手順を説明します。
  </para>

  <para>
   この章の残りの部分では、SUSEの製品ライフサイクルとサービスパックリリースに関する背景情報、推奨するアップグレードポリシー、バージョン番号が最新でなくてもSUSE Linux Enterpriseソフトウェアを最新に保つ方法(「バックポート」)、およびステップバイステップのアップデート手順で参照されている追加資料について示します。
  </para>

 </abstract>
 <sect1 id="sec.update.terminology">
  <title>背景情報: 用語集</title>

  <para>
   この章では、いくつかの用語を使用します。それらの情報を理解するには、以下の定義をお読みください。
  </para>

  <variablelist>
   <varlistentry>
    <term>バックポート</term>
    <listitem>
     <para>
      バックポートとは、新しいバージョンのソフトウェアによる特定の変更内容を採用し、それを古いバージョンに適用することを意味します。最も一般的な使用事例は、古いソフトウェアコンポーネントのセキュリティホールの修正です。通常は、拡張機能や(頻度は低いものの)新機能を提供するための保守モデルの一部にもなります。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>

    <term>デルタRPM</term>
    <listitem>
     <para>
      デルタRPMは、パッケージに定義された2つのバージョンどうしのバイナリ差分のみで構成されているので、ダウンロードサイズが最小限ですみます。インストールの前に、RPMのフルパッケージがローカルコンピュータ上で再構築されます。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>ダウンストリーム</term>
    <listitem>
     <para>
      オープンソースワールドにおけるソフトウェア開発方法のメタファーです(<emphasis>アップストリーム</emphasis>と対比)。<emphasis/>「ダウンストリーム」という用語は、アップストリームからのソースコードを他のソフトウェアと統合し、エンドユーザが使用するためのディストリビューションを構築する、SUSEのような人や組織を指しています。つまり、ソフトウェアは開発者からインテグレータを介して、エンドユーザーまで、ダウンストリーム(下向き)に流れていきます。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>［Extensions (アドイン)］</term>
    <term>アドオン製品</term>
    <listitem>
     <para>
      
      拡張機能(「アドオン製品」とも呼びます)は、<phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase>製品に付加価値機能を提供します。これらはSUSEおよびSUSEパートナーによって提供され、基本製品である<phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase>にインストールして登録します。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>モジュール</term>
    <listitem>
     
     
       <para>
        モジュールは、<phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase>で全面的にサポートされている構成要素であり、アドオン製品とは異なるライフサイクルを備えています。モジュールは、明確に定義された適用範囲を持ち、オンラインチャネルでのみ配布されています。これらのチャネルに登録できるためには、SUSEのカスタマセンターへの登録が前提となっています。
      </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>オンラインマイグレーション</term>
    <listitem>
     <para>
      それぞれのパッチをインストールするために、(インストールメディアではなく)オンラインアップデートツールを使用して、サービスパック(SP)への更新を行うことです。インストールシステムのすべてのパッケージを最新状態にアップデートします(SP3およびSP2アップデートを含む)。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>

    <term>パッケージ</term>
    <listitem>
     <para>
      パッケージは、<literal>rpm</literal>形式で圧縮されたファイルで、特定のプログラムのすべてのファイルが格納されています。環境設定、サンプル、ドキュメントなどのオプションコンポーネントも含まれます。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>

    <term>パッチ</term>
    <listitem>
     <para>
      パッチは、１つ以上のパッケージから成り、デルタRPMで適用できます。また、まだインストールされていないパッケージへの依存関係を導入することもあります。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>メジャーリリース</term>
    <term>一般出荷(GA)バージョン</term>
    <listitem>
     <para>
      SUSE Linux Enterprise (または任意のソフトウェア製品)のメジャーリリースとは、新しい機能やツールを導入する、非推奨になっていたコンポーネントを使用停止にする、後方互換性のない変更が付属するといった特徴を持つ新バージョンです。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>サービスパック(SP)</term>
    <listitem>
     <para>
      複数のパッチを組み合わせて、インストールまたは展開しやすい形式にします。サービスパックには番号が付けられ、通常、プログラムのセキュリティ修正、更新、アップグレード、または拡張機能が含まれます。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>アップストリーム</term>
    <listitem>
     <para>
      オープンソースワールドにおけるソフトウェア開発方法のメタファーです(<emphasis>ダウンストリーム</emphasis>と対比)。<emphasis>アップストリーム</emphasis>という用語は、ソースコードとして配布されるソフトウェアの元のプロジェクト、作者、またはメンテナンス者を指しています。フィードバック、パッチ、拡張機能、その他の改良機能は、エンドユーザまたはコントリビュータからアップストリーム(上流)の開発者に流れていきます。開発者は、リクエストを組み込むのか却下するのか決定します。
     </para>
     <para>
      プロジェクトメンバーがリクエストを組み込むように決定すると、それが新しいバージョンのソフトウェアに出現します。受け入れられたリクエストは、すべての関係者にメリットをもたらします。
     </para>
     <para>
      リクエストが受け入れられない場合は、別の理由が考えられます。プロジェクトのガイドラインに準拠していない、無効である、すでに組み込まれている、プロジェクトに関係ないかロードマップ上に存在しないなどの中のいずれかの理由です。リクエストが受け入れられない場合、アップストリームの開発者にとっては、自分のパッチをアップストリームのコードと同期させる必要があるために困難が生じます。この操作は一般的には回避されますが、まだ必要な場合もあります。
     </para>
    </listitem>
   </varlistentry>

   <varlistentry>
    <term>アップデート</term>
    <listitem>
     <para>
      パッケージの新しい<emphasis>マイナー</emphasis>バージョンのインストール。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>アップグレード</term>
    <listitem>
     <para>
      パッケージまたは配布の新しい<emphasis>主要</emphasis>バージョンのインストール。これにより<emphasis>新機能</emphasis>がもたらされます。
     </para>
    </listitem>
   </varlistentry>
  </variablelist>
 </sect1>


 <sect1 id="sec.update.proc.prep.paths">
  <title>サポートされているSLEへのアップグレードパス</title>

  <abstract>
   <para>
    SUSE Linux Enterpriseは、特定のリリースからその次のリリースへ直接アップグレードできます。たとえば、現在SUSE Linux Enterprise 11 SP2が稼働している場合は、まずSUSE Linux Enterprise 11 SP3へアップグレードし、そこからSUSE Linux Enterprise 12へアップグレードするという2段階でアップグレードします。
   </para>

   <para>
    アップデート時に中間リリースをスキップすることはできません。そのため、数バージョン前のバージョン(SUSE Linux Enterprise 10やSUSE Linux Enterprise 11 SP1など)が稼働している場合は、長時間かけて何度もアップグレードを繰り返す代わりに、フレッシュインストールを検討することをお勧めします。
   </para>

  </abstract>
  <important>
   <title>クロスアーキテクチャアップグレードはサポートされない</title>
   <para>
    クロスアーキテクチャアップグレードは「サポートされません」。<emphasis/>たとえば、32ビットバージョンの<phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase>から64ビットバージョンへのアップグレードや、ビッグエンディアンからリトルエンディアンへのアップグレードなどがこれに該当します。
   </para>
   <para>
    具体的には、POWER版のSLE 11 SP3 (ビッグエンディアン)からPOWER版のSLE 12 (新規: リトルエンディアン)は「サポートされません」。<emphasis/>
   </para>
   <para>
    同様に、SUSE Linux Enterprise 12は64ビット専用であるため、32ビットのSUSE Linux Enterprise 11システムからSUSE Linux Enterprise 12へのアップグレードも「サポートされません」。<emphasis/>
   </para>
  </important>

  <variablelist>
   <varlistentry>
    <term>SUSE Linux Enterprise 10 (任意のサービスパック)からのアップグレード</term>
    <listitem>
     <para>
      SUSE Linux Enterprise 12への直接的なマイグレーションパスはサポートされていません。代わりにフレッシュインストールをお勧めします。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>SUSE Linux Enterprise 11 GAまたはSUSE Linux Enterprise 11 SP1からのアップグレード</term>
    <listitem>
     <para>
      SUSE Linux Enterprise 12への直接的なマイグレーションパスはサポートされていません。
     </para>
     <para>
      フレッシュインストールを行うことができない場合、アップグレードを続行するには、まずSUSE Linux Enterprise 11 GAをSP1にアップデートし、続いてSUSE Linux Enterprise 11 SP1をSP2にアップデートする必要があります。最初のステップについては、『<ulink url="https://www.suse.com/documentation/sles11/">SUSE Linux Enterprise 11導入ガイド</ulink>』でオンラインで説明されています。
     </para>
     <para>
      その後、次のステップに進みます。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>SUSE Linux Enterprise 11 SP2からのアップグレード</term>
    <listitem>
     <para>
      まず、システムをSUSE Linux Enterprise 11 SP3にアップグレードします。詳細については、<xref linkend="sec.update.sle11sp2"/>を参照してください。
     </para>
     <para>
      その後、次のステップに進みます。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>SUSE Linux Enterprise 11 SP3からSUSE Linux Enterprise 12へのアップグレード</term>
    <listitem>
     <para>
      詳細については、<xref linkend="sec.update.sle12"/>を参照してください。
     </para>
    </listitem>
   </varlistentry>
  </variablelist>
 </sect1>
 <sect1 id="sec.update.prep">
  <title>アップデートのための一般的な準備</title>

  <para>
   アップデート手順を開始する前に、システムが正しく準備されていることを確認します。準備内容には、データのバックアップとリリースノートの確認などがあります。
  </para>

  <sect2 id="sec.update.prep.relnotes">
   <title>リリースノートの確認</title>
   <para>
    リリースノートには、旧リリースのSUSE Linux Enterpriseからの変更点に関する追加情報が記載されています。特定のハードウェアやセットアップについて特別な考慮が必要かどうか、使用している特定のソフトウェアパッケージのどれに大幅な変更があったか、およびこのセクションに示す一般的な推奨事項のほかにどのような予防措置を講じる必要があるかについて、リリースノートで確認してください。リリースノートには、リリース直前になって判明したためマニュアルに記載できなかった情報と既知の問題も記載されています。
   </para>
   <para>
    <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase>の最新情報を含むリリースノートの最新バージョンのドキュメントは、<ulink url="http://www.suse.com/doc/sles12/#start"/>でオンラインで読むことができます。
   </para>
  </sect2>

  <sect2 id="sec.update.prep.backup">
   <title>バックアップの作成</title>
   <para>
    更新の前に、既存の設定ファイルを別個のメディア(テープデバイス、リムーバブルハードディスクなど)にコピーして、データをバックアップします。主に、<filename>/etc</filename>の下に格納されているファイル、また、<filename>/var</filename>と<filename>/opt</filename>の下にあるディレクトリとファイルの一部に当てはまります。さらに、<filename>/home</filename> (<envar>HOME</envar>ディレクトリ)下のユーザデータをバックアップメディアに書き込むようにします。このデータは、<systemitem class="username">root</systemitem>ユーザでバックアップします。<systemitem class="username">root</systemitem>のみに、すべてのローカルファイルに関する読み込みパーミッションがあります。
   </para>
   <para>
    YaSTのインストールモードとして<guimenu>既存システムの更新</guimenu>を選択している場合は、もっと後の時点で(システム)バックアップを実行することができます。変更されたすべてのファイルと<filename>/etc/sysconfig</filename>ディレクトリにあるファイルを含めることができます。ただし、これは完全なバックアップではありません。前述したその他の重要なディレクトリがすべて含まれていないからです。<filename>/var/adm/backup</filename>ディレクトリでバックアップを見つけます。
   </para>
  </sect2>

  <sect2 id="sec.update.prep.disks">
   <title>パーティションとディスク容量</title>
   <para>
    更新を開始する前に、ルートパーティションの記録をとります。<command>df /</command>コマンドは、ルートパーティションのデバイス名リストを表示します。たとえば、<xref linkend="aus.update.df"/>に示すように、書き留めておくルートパーティションは、<filename>/dev/hda3</filename>です(<filename>/</filename>としてマウントされています)。
   </para>
   <example id="aus.update.df">
    <title><command>df -h</command>の出力例</title>

<screen os="sles">Filesystem     Size  Used Avail Use% Mounted on
/dev/sda3       74G   22G   53G  29% /
tmpfs          506M     0  506M   0% /dev/shm
/dev/sda5      116G  5.8G  111G   5% /home
/dev/sda1       44G    4G   40G   9% /data</screen>
   </example>
   <para>
    ソフトウェアは、バージョンが上がるたびに<quote>増加する</quote>傾向があります。そのため、更新する前に、はじめに<command>df</command>コマンドで、利用できるパーティションの容量を調べてください。ディスク容量が不足していると思われる場合は、システムの更新とパーティション再設定を行う前に、データをバックアップしておきます。各パーティションに必要な容量を決定する一般的なルールはありません。必要な容量は、特定のパーティションプロファイルおよび選択したソフトウェアによって異なります。
   </para>
  </sect2>

  <sect2 id="sec.update.prep.vms">
   <title>仮想マシンゲストのシャットダウン</title>
   <para>
    お使いのマシンがKVMまたはXenのVMホストサーバとして機能している場合、アップデートの前には、実行中のすべてのVMゲストを正しくシャットダウンするようにします。そうでないと、更新後にゲストにアクセスできなくなる可能性があります。
   </para>
  </sect2>

 </sect1>
 <sect1 id="sec.update.sle11sp2">
  <title>中間ステップ: SLE 11 SP2からSLE 11 SP3へのアップデート</title>
  <para>
   オンラインマイグレーションは、次のツールによってサポートされています。
  </para>

  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>
     <guimenu>YaST Wagon</guimenu> (グラフィカルユーザインタフェース)
    </para>
   </listitem>
   <listitem>
    <para>
     <command>zypper</command> (コマンドライン)
    </para>
   </listitem>
  </itemizedlist>

  <para>
   オンラインマイグレーションを介してシステムをアップデートする場合、アップデートはシステムの稼働中に実行されます。アップデートの完了後、1度だけ再起動の必要があります。次に示す代替方法によってアップデートを行うこともできます。
  </para>

  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>
     <xref linkend="sec.update.sle11spx.medium"/>
    </para>
   </listitem>
   <listitem>
    <para>
     <xref linkend="sec.update.sle11spx.smt"/>
    </para>
   </listitem>
   <listitem>
    <para>
     <xref linkend="sec.update.sle11spx.manager"/>
    </para>
   </listitem>
  </itemizedlist>

  <sect2 id="sec.update.sle11sp3.online.requirements">
   <title>要件</title>
   <para>
    オンラインアップデートを実行するには、次の要件を満たす必要があります。必ず、<xref linkend="sec.update.prep"/>も読んでください。
   </para>
   <variablelist>
    <varlistentry>
     <term>製品登録</term>
     <listitem>
      <para>
       アップデートリポジトリに接続できるようにするには、製品を登録する必要があります。まだ登録していない場合は、YaSTの<guimenu>SUSEカスタマーセンターの環境設定</guimenu>モジュール、または<command>suse_register</command>コマンドラインツールを実行して、登録を開始します。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>オンラインアップデートの実行</term>
     <listitem>
      <para>
       現在インストールされているバージョンに最新のパッチがインストールされていることを確認します。オンラインマイグレーションの前に、オンラインアップデートを実行します。グラフィカルインタフェースを使用して、YaSTオンラインアップデートまたはアップデータアプレットを起動します。コマンドラインで、次のコマンドを実行します(最後のコマンドは2回実行する必要があります)。
      </para>
<screen>zypper ref -s
zypper update -t patch
zypper update -t patch</screen>
      <para>
       必要に応じて、システムを再起動します。
      </para>
      <para>
       オンラインアップデートツールの詳細については、<xref linkend="cha.onlineupdate.you"/>または<xref linkend="sec.zypper.softup"/>を参照してください。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>サードパーティのソフトウェア</term>
     <listitem>
      <para>
       セットアップにサードパーティのソフトウェアまたはアドオンソフトウェアが含まれている場合は、別のコンピュータでこのプロシージャをテストして、依存関係が更新によって破損していないかどうか確認してください。
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
   <important>
    <title>完全なオンラインマイグレーションを常に実行</title>
    <para>
     オンラインマイグレーションは常に、最初から最後まで完全に実行する必要があります。オンラインマイグレーションが中断された場合、システムは破損され回復不能な状態になります。
    </para>
   </important>
  </sect2>

  <sect2 id="sec.update.sle11sp3.online.wagon">
   <title>YaST <guimenu>Wagon</guimenu>によるオンラインマイグレーション</title>
   <procedure>
    <step performance="required">
     <para>
      すべての要件が満たされている場合(<xref linkend="sec.update.sle11spx.online.requirements"/>を参照)、トレイのアップデートアプレットには、配布アップグレードが使用可能であることを示すメッセージが表示されます。これをクリックして、YaST <guimenu>Wagon</guimenu>を起動します。または、コマンドラインから<systemitem class="username">root</systemitem>として<command>/usr/sbin/wagon</command>を実行します。
     </para>
    </step>
    <step performance="required">
     <para>
      <guimenu>ようこそ</guimenu>ダイアログの<guimenu>次へ</guimenu>を選択して確定します。
     </para>
    </step>
    <step performance="required">
     <para>
      <guimenu>Wagon</guimenu>では、要件が満たされていない(必要な保守アップデートが使用可能なのに、まだインストールされていない)ことが見つかったら、自動的なセルフアップデートが実行されます。この場合再起動が必要になります。画面の指示に従って操作します。
     </para>
    </step>
    <step performance="required">
     <para>
      次のダイアログで、アップデート方法を選択します。デフォルトの設定を使用するには、<guimenu>Customer Center</guimenu>を選択します(推奨)。
     </para>
     <para>
      オンラインマイグレーションに使用するソフトウェアリポジトリを手動で選択するには、<guimenu>Custom URL (カスタムURL)</guimenu>をクリックします。リポジトリのリストが表示され、リポジトリを手動で有効化、無効化、追加、または削除できるようになります。SP3アップデートソースを追加します。これは、SP3インストールメディアか、<literal>SP3-Pool</literal>および<literal>SP3-Updates</literal>リポジトリのいずれかの可能性があります。<guimenu>OK</guimenu>をクリックして、<guimenu>Update Method (アップデート方法)</guimenu>ダイアログに戻ります。
     </para>
     <para>
      アップデートプロセスによって発生したリポジトリ設定に対する変更を確認する必要がある場合は、<guimenu>自動リポジトリ変更の確認</guimenu>を選択します。
     </para>
     <para>
      <guimenu>次へ</guimenu>で続行します。
     </para>
    </step>
    <step performance="required">
     <para>
      システムが再登録されます。このプロセスの実行中に、<literal>SP3-Pool</literal>および<literal>SP3-Updates</literal>リポジトリがシステムに追加されます(詳細については、<xref linkend="sec.update.nmm.repositories"/>を参照してください)。リポジトリが追加されたことを確認します。
     </para>
    </step>
    <step performance="required">
     <para>
      <guimenu>Update Method (アップデート方法)</guimenu>ダイアログで<guimenu>自動リポジトリ変更の確認</guimenu>を選択した場合、リポジトリのリストが表示され、リポジトリを手動で有効化、無効化、追加、または削除できるようになります。終了したら、<guimenu>OK</guimenu>で続行します。
     </para>
    </step>
    <step performance="required">
     <para>
      <guimenu>Distribution Upgrade Settings</guimenu>画面が開き、アップデート設定の概要が表示されます。次のセクションを使用できます。
     </para>
     <variablelist>
      <varlistentry>
       <term><guimenu>アドオン製品</guimenu>
       </term>
       <listitem>
        <para>
         ここでは、SUSE Linux Enterprise Serverのアドオン製品か、サードパーティの製品を追加できます。
        </para>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term><guimenu>アップデートオプション</guimenu>
       </term>
       <listitem>
        <para>
         アップデート中に実行されるアクションがリストされます。インストールの前にすべてのパッケージをダウンロードするのか(デフォルト、推奨)、パッケージを1つずつダウンロードしてインストールするのかを選択できます。
        </para>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term><guimenu>パッケージ</guimenu>
       </term>
       <listitem>
        <para>
         アップデートの統計概要。
        </para>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term>バックアップ</term>
       <listitem>
        <para>
         バックアップオプションを設定します。
        </para>
       </listitem>
      </varlistentry>
     </variablelist>
     <para>
      <guimenu>次へ</guimenu>および<guimenu>Start The Update</guimenu>をクリックして続行します。
     </para>
     <important>
      <title>オンラインマイグレーションを中止する</title>
      <para>
       この画面で<guimenu>Start The Update</guimenu>をクリックする<emphasis>前</emphasis>と、それ以前のすべての画面では、オンラインマイグレーションを安全に中止することができます。<guimenu>Abort (中止)</guimenu>をクリックしてアップデート手順を中止し、YaST Wagonを開始する前の状態にシステムを戻します。画面の指示に従って、Wagonを中止する前に再登録を実行し、SP2リポジトリをシステムから削除します。
      </para>
     </important>
    </step>
    <step performance="required">
     <para>
      アップデート手順の過程では、次のステップが実行されます。
     </para>
     <substeps performance="required">
      <step performance="required">
       <para>
        パッケージが更新されます。
       </para>
      </step>
      <step performance="required">
       <para>
        システムが再起動されます(<guimenu>OK</guimenu>を選択します)。
       </para>
      </step>
      <step performance="required">
       <para>
        新しく更新されたシステムが再登録されます。
       </para>
      </step>
     </substeps>
    </step>
    <step performance="required">
     <para>
      システムがサービスパック3に正しく更新されます。
     </para>
    </step>
   </procedure>
  </sect2>

  <sect2 id="sec.update.sle11sp3.online.zypper">
   <title><command>zypper</command>によるオンラインマイグレーション</title>
   <procedure>
    <step performance="required">
     <para>
      すべての要件が満たされている場合(<xref linkend="sec.update.sle11spx.online.requirements"/>を参照)、オンラインマイグレーションに必要な<quote>製品</quote>が<filename>/etc/products.d</filename>に追加されます。次のコマンドを実行することで、これらの製品のリストを取得します。
     </para>

<screen>zypper se -t product | grep -h -- "-migration" | cut -d'|' -f2</screen>
     <para>
      このコマンドでは、少なくとも<literal os="sles">SUSE_SLES-SP3-migration</literal>が返されます。インストールの範囲によっては、もっと多くの製品がリストされている場合があります。
     </para>
    </step>
    <step performance="required">
     <para>
      <command>zypper in -t product <replaceable>LIST_OF_PRODUCTS</replaceable></command>というコマンドを使用して、前のステップで取得したマイグレーション製品をインストールします。たとえば次のようになります。
     </para>
<screen os="sles">zypper in -t product SUSE_SLES-SP3-migration</screen>

    </step>
    <step performance="required">
     <para>
      それぞれのアップデートリポジトリを取得するために、前のステップでインストールした製品を登録します。
     </para>
<screen>suse_register -d 2 -L /root/.suse_register.log</screen>
    </step>
    <step performance="required">
     <para>
      リポジトリとサービスをリフレッシュします。
     </para>
<screen>zypper ref -s</screen>
    </step>
    <step performance="required">
     <para>
      <command>zypper lr</command>で取得可能なリポジトリのリストを確認します。
     </para>
     <para>
      これらのリポジトリのいずれかが有効でない場合(このワークフローに従うと、<literal>SP3</literal>のリポジトリはデフォルトでは有効化されません)、<command>zypper modifyrepo --enable <replaceable>REPOSITORY ALIAS</replaceable></command>を使用して有効化します。たとえば次のようになります。
     </para>
<screen os="sles">zypper modifyrepo --enable SLES11-SP3-Core SLES11-SP3-Updates</screen>

     <para>
      セットアップにSP3と互換性がない可能性があるサードパーティのリポジトリが含まれている場合は、<command>zypper modifyrepo --disable <replaceable>REPOSITORY ALIAS</replaceable></command>を使用してそれらを無効にします。
     </para>
    </step>
    <step performance="required">
     <para>
      これで、<command>zypper dup --from <replaceable>REPO 1</replaceable> --from <replaceable>REPO 2</replaceable> <replaceable>...</replaceable></command>を使用して配布アップグレードを実行するための準備がすべて整いました。 必ず<option>--from</option>を使用して必要なリポジトリをすべてリストするようにしてください。たとえば次のようになります。
     </para>
<screen os="sles">zypper dup --from SLES11-SP3-Pool --from SLES11-SP3-Updates</screen>

     <para>
      <guimenu>y</guimenu>を入力して、アップグレードを開始します。
     </para>
    </step>
    <step performance="required">
     <para>
      前のステップからの配布アップグレードが完了したら、次のコマンドを実行します。
     </para>
<screen>zypper update -t patch</screen>
    </step>
    <step performance="required">
     <para>
      これでSP3へのアップグレードは完了したので、製品を再登録する必要があります。
     </para>
<screen>suse_register -d 2 -L /root/.suse_register.log</screen>
    </step>
    <step performance="required">
     <para>
      最後に、システムを再起動します。
     </para>
    </step>
    <step performance="required">
     <para>
      システムがサービスパック3に正しく更新されます。
     </para>
    </step>
   </procedure>
  </sect2>

  <sect2 id="sec.update.sle11spx.online">
   <title>オンラインマイグレーション</title>
   <para>
    オンラインマイグレーションによるシステムのアップデートは、稼働中のシステム内から実行されます。アップデートの完了後、1度だけ再起動の必要があります。
   </para>
   <sect3 id="sec.update.sle11spx.online.requirements">
    <title>要件</title>
    <para>
     オンラインアップデートを実行するには、次の要件を満たす必要があります。必ず、<xref linkend="sec.update.prep"/>も読んでください。
    </para>
    <variablelist>
     <varlistentry>
      <term>製品登録</term>
      <listitem>
       <para>
        アップデートリポジトリに接続できるようにするには、製品を登録する必要があります。まだ登録していない場合は、YaSTの<guimenu>SUSEカスタマーセンターの環境設定</guimenu>モジュール、または<command>suse_register</command>コマンドラインツールを実行して、登録を開始します。
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>オンラインアップデートの実行</term>
      <listitem>
       <para>
        現在インストールされているバージョンに最新のパッチがインストールされていることを確認します。オンラインマイグレーションの前に、オンラインアップデートを実行します。グラフィカルインタフェースを使用して、YaSTオンラインアップデートまたはアップデータアプレットを起動します。コマンドラインで、次のコマンドを実行します(最後のコマンドは2回実行する必要があります)。
       </para>
<screen>zypper ref -s
zypper update -t patch
zypper update -t patch</screen>
       <para>
        必要に応じて、システムを再起動します。
       </para>
       <para>
        詳細については、<xref linkend="cha.onlineupdate.you"/>または<xref linkend="sec.zypper.softup"/>を参照してください。オンラインアップデートツールの
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>サードパーティのソフトウェア</term>
      <listitem>
       <para>
        セットアップにサードパーティのソフトウェアまたはアドオンソフトウェアが含まれている場合は、別のコンピュータでこのプロシージャをテストして、依存関係が更新によって破損していないかどうか確認してください。
       </para>
      </listitem>
     </varlistentry>
    </variablelist>
    <important>
     <title>完全なオンラインマイグレーションを常に実行</title>
     <para>
      オンラインマイグレーションは常に、最初から最後まで完全に実行する必要があります。オンラインマイグレーションが中断された場合、システムは破損され回復不能な状態になります。
     </para>
    </important>
   </sect3>
   <sect3 id="sec.update.sle11spx.online.wagon">
    <title>YaST <guimenu>Wagon</guimenu>によるオンラインマイグレーション</title>
    <note>
     <para>
      YaST Wagonによるオンラインマイグレーションは、SUSE Linux Enterprise Server 12より前のバージョンでのみ利用可能です。
     </para>
    </note>
    <procedure>
     <step performance="required">
      <para>
       すべての要件が満たされている場合(<xref linkend="sec.update.sle11spx.online.requirements"/>を参照)、トレイのアップデートアプレットには、配布アップグレードが使用可能であることを示すメッセージが表示されます。これをクリックして、YaST <guimenu>Wagon</guimenu>を起動します。または、コマンドラインから<systemitem class="username">root</systemitem>として<command>/usr/sbin/wagon</command>を実行します。
      </para>
     </step>
     <step performance="required">
      <para>
       <guimenu>ようこそ</guimenu>ダイアログの<guimenu>次へ</guimenu>を選択して確定します。
      </para>
     </step>
     <step performance="required">
      <para>
       <guimenu>Wagon</guimenu>では、要件が満たされていない(必要な保守アップデートが使用可能なのに、まだインストールされていない)ことが見つかったら、自動的なセルフアップデートが実行されます。この場合再起動が必要になります。画面の指示に従って操作します。
      </para>
     </step>
     <step performance="required">
      <para>
       次のダイアログで、アップデート方法を選択します。デフォルトの設定を使用するには、<guimenu>Customer Center</guimenu>を選択します(推奨)。
      </para>
      <para>
       オンラインマイグレーションに使用するソフトウェアリポジトリを手動で選択するには、<guimenu>Custom URL (カスタムURL)</guimenu>をクリックします。リポジトリのリストが表示され、リポジトリを手動で有効化、無効化、追加、または削除できるようになります。SP2アップデートソースを追加します。これは、SP2インストールメディアか、<literal>SP2-Core</literal>および<literal>SP2-Updates</literal>リポジトリのいずれかの可能性があります。<guimenu>OK</guimenu>をクリックして、<guimenu>Update Method (アップデート方法)</guimenu>ダイアログに戻ります。
      </para>
      <para>
       アップデートプロセスによって発生したリポジトリ設定に対する変更を確認する必要がある場合は、<guimenu>自動リポジトリ変更の確認</guimenu>を選択します。
      </para>
      <para>
       <guimenu>次へ</guimenu>で続行します。
      </para>
     </step>
     <step performance="required">
      <para>
       システムが再登録されます。このプロセスの実行中に、<literal>SP2-Core</literal>および<literal>SP2-Updates</literal>リポジトリがシステムに追加されます(詳細については、<xref linkend="sec.update.nmm.repositories"/>を参照してください)。リポジトリが追加されたことを確認します。
      </para>
     </step>
     <step performance="required">
      <para>
       <guimenu>Update Method (アップデート方法)</guimenu>ダイアログで<guimenu>自動リポジトリ変更の確認</guimenu>を選択した場合、リポジトリのリストが表示され、リポジトリを手動で有効化、無効化、追加、または削除できるようになります。終了したら、<guimenu>OK</guimenu>で続行します。
      </para>
     </step>
     <step performance="required">
      <para>
       マイグレーションタイプを選択します。
      </para>
      <variablelist>
       <varlistentry>
        <term><guimenu>完全マイグレーション</guimenu>
        </term>
        <listitem>
         <para>
          すべてのパッケージを最新のSP2レベルに更新します。
         </para>
        </listitem>
       </varlistentry>
       <varlistentry>
        <term><guimenu>最小マイグレーション</guimenu>
        </term>
        <listitem>
         <para>
          パッケージの最小限のセットを最新のSP2レベルに更新します。
         </para>
        </listitem>
       </varlistentry>
      </variablelist>
      <para>
       <guimenu>詳細</guimenu>をクリックして、アップグレードに使用するリポジトリを手動で選択します。
      </para>
      <para>
       選択内容を確認します。
      </para>
     </step>
     <step performance="required">
      <para>
       <guimenu>配布アップグレード設定</guimenu>画面が開き、アップデート設定の概要が表示されます。次のセクションを使用できます。
      </para>
      <variablelist>
       <varlistentry>
        <term><guimenu>アドオン製品</guimenu>
        </term>
        <listitem>
         <para>
          ここでは、SUSE Linux Enterprise Serverのアドオン製品か、サードパーティの製品を追加できます。
         </para>
        </listitem>
       </varlistentry>
       <varlistentry>
        <term><guimenu>アップデートオプション</guimenu>
        </term>
        <listitem>
         <para>
          アップデート中に実行されるアクションがリストされます。インストールの前にすべてのパッケージをダウンロードするのか(デフォルト、推奨)、パッケージを1つずつダウンロードしてインストールするのかを選択できます。
         </para>
        </listitem>
       </varlistentry>
       <varlistentry>
        <term><guimenu>パッケージ</guimenu>
        </term>
        <listitem>
         <para>
          アップデートの統計概要。
         </para>
        </listitem>
       </varlistentry>
       <varlistentry>
        <term>バックアップ</term>
        <listitem>
         <para>
          バックアップオプションを設定します。
         </para>
        </listitem>
       </varlistentry>
      </variablelist>
      <para>
       <guimenu>次へ</guimenu>および<guimenu>Start The Update</guimenu>をクリックして続行します。
      </para>
      <important>
       <title>オンラインマイグレーションを中止する</title>
       <para>
        この画面で<guimenu>Start The Update</guimenu>をクリックする<emphasis>前</emphasis>と、それ以前のすべての画面では、オンラインマイグレーションを安全に中止することができます。<guimenu>Abort (中止)</guimenu>をクリックしてアップデート手順を中止し、YaST Wagonを開始する前の状態にシステムを戻します。画面の指示に従って、Wagonを中止する前に再登録を実行し、SP2リポジトリをシステムから削除します。
       </para>
      </important>
     </step>
     <step performance="required">
      <para>
       アップデート手順の過程では、次のステップが実行されます。
      </para>
      <substeps performance="required">
       <step performance="required">
        <para>
         パッケージが更新されます。
        </para>
       </step>
       <step performance="required">
        <para>
         システムが再起動されます(<guimenu>OK</guimenu>を選択します)。
        </para>
       </step>
       <step performance="required">
        <para>
         新しく更新されたシステムが再登録されます。
        </para>
       </step>
      </substeps>
     </step>
     <step performance="required">
      <para>
       システムがサービスパック2に正しく更新されます。
      </para>
     </step>
    </procedure>
   </sect3>
   <sect3 id="sec.update.sle11spx.online.zypper">
    <title><command>zypper</command>によるオンラインマイグレーション</title>
    <procedure>
     <step performance="required">
      <para>
       すべての要件が満たされている場合(<xref linkend="sec.update.sle11spx.online.requirements"/>を参照)、オンラインマイグレーションに必要な<quote>製品</quote>が<filename>/etc/products.d</filename>に追加されます。次のコマンドを実行することで、これらの製品のリストを取得します。
      </para>

<screen>zypper se -t product | grep -h -- "-migration" | cut -d'|' -f2</screen>
      <para>
       このコマンドでは、少なくとも<literal os="sles">SUSE_SLES-SP2-migration</literal>が返されます。インストールの範囲によっては、もっと多くの製品がリストされている場合があります。
      </para>
     </step>
     <step performance="required">
      <para>
       <command>zypper in -t product <replaceable>LIST_OF_PRODUCTS</replaceable></command>というコマンドを使用して、前のステップで取得したマイグレーション製品をインストールします。たとえば次のようになります。
      </para>
<screen os="sles">zypper in -t product SUSE_SLES-SP2-migration</screen>

     </step>
     <step performance="required">
      <para>
       それぞれのアップデートリポジトリを取得するために、前のステップでインストールした製品を登録します。
      </para>
<screen>suse_register -d 2 -L /root/.suse_register.log'</screen>
     </step>
     <step performance="required">
      <para>
       リポジトリとサービスを再度リフレッシュします。
      </para>
<screen>zypper ref -s</screen>
     </step>
     <step performance="required">
      <para>
       <command>zypper lr</command>で取得可能なリポジトリのリストを確認します。<emphasis>少なくとも</emphasis>次のリポジトリを<guimenu>有効化</guimenu>する必要があります。
      </para>
      <itemizedlist os="sles" mark="bullet" spacing="normal">
       <listitem>
        <para>
         <literal>SLES11-SP1-Pool</literal>
        </para>
       </listitem>
       <listitem>
        <para>
         <literal>SLES11-SP1-Updates</literal>
        </para>
       </listitem>
       <listitem>
        <para>
         <literal>SLES11-SP2-Core</literal>
        </para>
       </listitem>
       <listitem>
        <para>
         <literal>SLES11-SP2-Updates</literal>
        </para>
       </listitem>
      </itemizedlist>
      
      <para>
       インストールの範囲によっては、アドオン製品や拡張機能用のリポジトリをさらに有効化する必要があります。
      </para>
      <para>
       これらのリポジトリのいずれかが有効でない場合(このワークフローに従うと、<literal>SP2</literal>のリポジトリはデフォルトでは有効化されません)、<command>zypper modifyrepo --enable <replaceable>REPOSITORY ALIAS</replaceable></command>を使用して有効化します。たとえば次のようになります。
      </para>
<screen os="sles">zypper modifyrepo --enable SLES11-SP2-Core SLES11-SP2-Updates</screen>

      <para>
       セットアップにSP2と互換性がない可能性があるサードパーティのリポジトリが含まれている場合は、<command>zypper modifyrepo --disable <replaceable>REPOSITORY ALIAS</replaceable></command>を使用してそれらを無効にします。
      </para>
     </step>
     <step performance="required">
      <para>
       これで、<command>zypper dup --from <replaceable>REPO 1</replaceable> --from <replaceable>REPO 2</replaceable> <replaceable>...</replaceable></command>を使用して配布アップグレードを実行するための準備がすべて整いました。 必ず<option>--from</option>を使用して必要なリポジトリをすべてリストするようにしてください。たとえば次のようになります。
      </para>
<screen os="sles">zypper dup --from SLES11-SP2-Core --from SLES11-SP2-Updates</screen>

      <para>
       <guimenu>y</guimenu>を入力して、アップグレードを開始します。
      </para>
     </step>
     <step performance="required">
      <para>
       前のステップからの配布アップグレードが完了したら、［Minimal Migration］が実行されたことになります(パッケージの最小限のセットが最新のSP2レベルに更新されたということです)。［Full Migration］を実行しない場合は、このステップをスキップします。
      </para>
      <para>
       ［Full Migration］を実行する(すべてのパッケージを最新のSP2レベルに更新する)には、次のコマンドを実行します。
      </para>
<screen>zypper update -t patch</screen>
     </step>
     <step performance="required">
      <para>
       これでSP2へのアップグレードは完了したので、製品を再登録する必要があります。
      </para>
<screen>suse_register -d 2 -L /root/.suse_register.log</screen>
     </step>
     <step performance="required">
      <para>
       最後に、システムを再起動します。
      </para>
     </step>
     <step performance="required">
      <para>
       システムがサービスパック2に正しく更新されます。
      </para>
     </step>
    </procedure>
   </sect3>
  </sect2>

  <sect2 id="sec.update.sle11spx.medium">
   <title>インストールソースからブートすることでアップデート</title>
   <para>
    オンラインマイグレーション(詳細については<xref linkend="sec.update.sle11spx.online"/>を参照)の代わりとして、インストールソース(DVDまたはネットワークインストールソース)からブートすることでシステムをアップデートできます。アップデートは、通常のインストールと同じように開始されます。
   </para>
   <para>
    サービスパック2 ISOイメージは、<ulink url="http://download.suse.com/"/>から取得できます。これをDVDに書き込むか、<xref linkend="sec.deployment.remoteinst.instserver"/>の説明に従ってネットワークインストールソースを準備します。
   </para>
   <sect3 id="sec.upgrade.install-from-dvd">
    <title>ローカルDVDドライブからのアップデート</title>
    <para>
     SUSE Linux Enterprise SPの新規インストールを開始する前に、サービスパックのインストールメディア(DVD)が全部揃っていることを確認してください。
    </para>
    <procedure id="upgrade.sp.instsp.fromsp">
     <title>サービスパックメディアからのブート</title>
     <step performance="required">
      <para>
       1枚目のSUSE Linux Enterprise SPメディアを挿入し、マシンをブートします。元のSUSE Linux Enterprise 11のインストール時と同様のブート画面が表示されます。
      </para>
     </step>
     <step performance="required">
      <para>
       <guimenu>インストール</guimenu>を選択し、<xref linkend="cha.inst"/>のYaSTインストールに関する説明に従って作業を続行してください。
      </para>
     </step>
    </procedure>
   </sect3>
   <sect3 id="sec.upgrade.install-from-network">
    <title>ネットワークインストールソースからのアップデート</title>
    <para>
     SUSE Linux Enterprise SPのネットワークインストールソースからのアップデートを開始する前に、次の要件を満たしていることを確認します。
    </para>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <para>
       ネットワークインストールソースが<xref linkend="sec.deployment.remoteinst.instserver"/>の記述どおりにセットアップされていること。
      </para>
     </listitem>
     <listitem>
      <para>
       インストールサーバと、ネームサービス、DHCP (オプションですが、PXEブートには必要)、およびOpenSLP (オプション)が含まれているターゲットコンピュータの両方で機能しているネットワーク接続が存在すること。
      </para>
     </listitem>
     <listitem>
      <para>
       ターゲットシステムのブート用のSUSE Linux EnterpriseサービスパックのDVD 1か、<emphasis/><xref linkend="sec.deployment.remoteinst.boot.pxeprep" xrefstyle="HeadingOnPage"/>の説明に従ってPXEブート用にセットアップされたターゲットシステムが存在すること。
      </para>
     </listitem>
    </itemizedlist>
    <para>
     リモートサーバからのアップグレードの詳細については、<xref linkend="cha.deployment.remoteinst"/>を参照してください。
    </para>
    <sect4 id="sec.upgrade.install-from-network.dvdboot">
     <title>ネットワークインストール - DVDからのブート</title>
     <para>
      ブートメディアとしてSPのDVDを使ってネットワークインストールを実行するには、次の手順に従います。
     </para>
     <procedure>
      <step performance="required">
       <para>
        SUSE Linux Enterprise SP DVD 1を挿入し、マシンをブートします。元のSUSE Linux Enterprise 11のインストール時と同様のブート画面が表示されます。
       </para>
      </step>
      <step performance="required">
       <para>
        <guimenu>インストール</guimenu>を選択してサービスパックカーネルをブートし、 <keycap>F4</keycap>キーを押してネットワークインストールソースの種類(FTP、HTTP、NFS、またはSMB)を選択します。
       </para>
      </step>
      <step performance="required">
       <para>
        適切なパス情報を入力するか、<guimenu>SLP</guimenu>をインストールソースとして選択します。
       </para>
      </step>
      <step performance="required">
       <para>
        表示されるものから適切なインストールサーバを選択するか、<xref linkend="sec.i.yast2.source.net"/>に説明しているとおり、ブートオプションプロンプトを使用してインストールソースの種類とその実際の場所を指定します。YaSTが起動します。
       </para>
       <para>
        <xref linkend="sec.update.sle11spx.medium.update"/>の説明に従って、インストールを完了します。
       </para>
      </step>
     </procedure>
    </sect4>
    <sect4 id="sec.upgrade.install-from-network.pxeboot">
     <title>ネットワークインストール - PXEブート</title>
     <para>
      ネットワークからSUSE Linux Enterpriseサービスパックのネットワークインストールを実行するには、次の手順に従います。
     </para>
     <procedure>
      <step performance="required">
       <para>
        <xref linkend="sec.deployment.remoteinst.boot.pxeprep"/>に従って、DHCPサーバのセットアップを調整してPXEブートに必要なアドレス情報を取得します。
       </para>
      </step>
      <step performance="required">
       <para>
        PXEブートに必要なブートイメージが保管されるTFTPサーバをセットアップします。
       </para>
       <para>
        このセットアップを実行するには、SUSE Linux EnterpriseサービスパックのCDまたはDVDの1枚目を使用するか、または<xref linkend="sec.deployment.remoteinst.boot.tftp"/>の手順に従います。
       </para>
      </step>
      <step performance="required">
       <para>
        ターゲットコンピュータにPXEブートとWake-on-LANを準備します。
       </para>
      </step>
      <step performance="required">
       <para>
        ターゲットシステムのブートを開始し、VNCを使用してこのコンピュータで実行中のインストールルーチンにリモートで接続します。詳細については、<xref linkend="sec.deployment.remoteinst.monitor.vnc"/>を参照してください。
       </para>
      </step>
      <step performance="required">
       <para>
        <xref linkend="sec.update.sle11spx.medium.update"/>の説明に従って、インストールを完了します。
       </para>
      </step>
     </procedure>
    </sect4>
   </sect3>
   <sect3 id="sec.update.sle11spx.medium.update">
    <title>アップデート手順</title>
    <para>
     インストールメディアまたはネットワークから正しくブートしたら、次の手順を実行してアップデートを開始します。
    </para>
    <procedure>
     <step performance="required">
      <para>
       <guimenu>ようこそ</guimenu>画面で、<guimenu>言語</guimenu>および<guimenu>キーボード</guimenu>を選択し、ライセンス契約に同意します。<guimenu>次へ</guimenu>で続行します。
      </para>
     </step>
     <step performance="required">
      <para>
       物理メディアからブートした場合は、<guimenu>メディアチェック</guimenu>を実行して、メディアの整合性を確認します。すでにメディアをチェック済みの場合は、このステップをスキップします。
      </para>
     </step>
     <step performance="required">
      <para>
       <guimenu>Installation Mode</guimenu>画面で、<guimenu>アップデート</guimenu>を選択します。<guimenu>次へ</guimenu>をクリックすると、アップデート手順が開始されます。
      </para>
     </step>
    </procedure>
   </sect3>
  </sect2>

  <sect2 id="sec.update.sle11spx.smt">
   <title>サブスクリプション管理ツール(SMT)によるアップデート</title>
   <para>
    SUSEアップデートサーバからクライアントシステムごとにアップデートをダウンロードする代わりに、SUSE Linux Enterprise用のサブスクリプション管理ツール(SMT)を使用して、アップデートをローカルサーバにミラーリングすることもできます。
   </para>
   <para>
    このツールはクライアント登録用のSUSEカスタマーセンタープロキシ、およびソフトウェアアップデートリポジトリとして機能します。<ulink url="http://www.suse.com/doc/smt11/"/>にあるSMTのマニュアルに、機能の概要と実装方法の説明が記載されています。
   </para>
  </sect2>

  <sect2 id="sec.update.sle11spx.manager">
   <title>SUSE Managerによるアップデート</title>
   <para>
    SUSE Managerは、SUSE Linux Enterpriseクライアントに対するアップデート、パッチ、およびセキュリティ修正を提供するためのサーバソリューションです。これには、一連のツールと、管理タスク用のWebベースのユーザインタフェースが付属しています。
   </para>
   <para>
    <ulink url="http://www.suse.com/doc/suse_manager/"/>にあるSUSE Managerのマニュアルに、機能の概要とサーバおよびクライアントのセットアップ方法の説明が記載されています。
   </para>
  </sect2>
 </sect1>

 <sect1 id="sec.update.sle12">
  <title>SLE 12へのアップグレード</title>

  

  <para>
   SUSE Linux Enterprise 11 SP3 (またはそれ以上)からSUSE Linux Enterprise 12へのアップグレードは、次のツールでサポートされています。
  </para>

  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>
     手動アップグレード、ISOからブート(<xref linkend="sec.update.sle12.iso"/>を参照)
    </para>
   </listitem>
   <listitem>
    <para>
     半自動マイグレーション、SSH経由で可能<phrase os="sles">(<xref linkend="sec.update.sle12.automated"/>を参照)</phrase>
    </para>
   </listitem>
  </itemizedlist>

  <sect2 id="sec.update.sle12.iso">
   <title>
    SUSE Linux Enterprise 11 SP3以上からの手動アップグレード(インストールソースを使用)
   </title>
   <para>
    インストールソース(ローカルDVDまたはネットワークインストールソースのいずれか)からブートして、フレッシュインストールを実行する場合と同じようにシステムをアップグレードできます。ブート画面で［Install (インストール)］の代わりに［Upgrade (アップグレード)］を選択してシステムをアップグレードします。
   </para>

   <procedure id="pro.update.sle12.iso">
    <title>
     SUSE Linux Enterprise 11 SP3以上からの手動アップグレード(SUSE Linux Enterprise 12 ISOを使用)
   </title>
    <step performance="required">
     <para>
      システムをISOから起動するブート方法を選択します(<xref linkend="sec.i.yast2.method"/>を参照してください)。
     </para>
    </step>
    <step performance="required">
     <para>
      システムをISOから起動します(<xref linkend="sec.i.yast2.startup"/>を参照してください)。
     </para>
     <para>
      ブート画面で［Upgrade (アップグレード)］を選択して、システムのアップグレードを開始します。
     </para>
     <warning>
      <para>
       ［Install (インストール)］を選択すると、後でデータが失われる可能性があります。フレッシュインストールの際にはデータパーティションを壊さないよう十分に注意してください。たとえば、ディスクの再パーティション化したり(既存のパーティションが破壊されるおそれがあります)、データパーティションを再フォーマットしたり(パーティション上のすべてのデータが消去されます)すると、データパーティションが破壊されます。ここでは［Upgrade (アップグレード)］を選択することをお勧めします。
      </para>
     </warning>
    </step>
    <step performance="required">
     <para>
      通常のアップグレードプロセスを実行します(<xref linkend="sec.update.sle11spx.medium.update"/>を参照してください)。
     </para>
    </step>
   </procedure>
  </sect2>

  <sect2 id="sec.update.sle12.automated">
   <title>SUSE Linux Enterprise 11 SP3からSUSE Linux Enterprise 12への自動マイグレーション</title>
   <para>
    自動マイグレーションを実行するには、次の手順に従います。
   </para>
   <procedure id="pro.update.sle12">
    <title>SUSE Linux Enterprise 11 SP3からSUSE Linux Enterprise 12への自動マイグレーション</title>
    
    
    <step performance="required">
     <para>
      1枚目のインストールDVDの<filename>/boot/x86_64/loader/</filename>からインストールカーネル<filename>linux</filename>およびファイル<filename>initrd</filename>をシステムの<filename>/boot</filename>ディレクトリにコピーします。
     </para>
     <screen><command>cp</command> -vi <replaceable>DVDROOT</replaceable>/boot/x86_64/loader/linux /boot/linux.upgrade
<command>cp</command> -vi <replaceable>DVDROOT</replaceable>/boot/x86_64/loader/initrd /boot/initrd.upgrade</screen>
     <para>
      <replaceable>DVDROOT</replaceable>はシステムがDVDをマウントするパスを示します。通常は、<filename>/run/media/$USER/$DVDNAME</filename>です。
     </para>
    </step>
    <step performance="required">
     <para>
      既存のGRUB環境設定ファイル<filename>/boot/grub/menu.lst</filename>を開き、別のセクションを追加します。他のブートローダについて、対応する環境設定ファイルを編集します。デバイス名は適宜調整してください。次に例を示します。
     </para>
     <screen>title Linux Upgrade Kernel
kernel (hd0,0)/boot/linux.upgrade root=/dev/sda1 upgrade <replaceable>OPTIONAL_PARAMETERS</replaceable>
initrd (hd0,0)/boot/initrd.upgrade</screen>
     <para>
      <replaceable>OPTIONAL_PARAMETERS</replaceable>は、システムをブートしてアップグレードを実行するために必要な追加のブートパラメータを示します。ここに、ご使用のシステムで必要なカーネルパラメータを指定できます。カーネルパラメータを確認して既存のGRUBエントリからコピーしなければならない場合があります。SUSEの<ulink url="http://en.opensuse.org/Linuxrc">linuxrcパラメータ(オンラインで説明されています)</ulink>を指定することもできます。
     </para>
    </step>
    <step performance="required">
     <para>
      アップグレードを自動で実行する場合<phrase os="sles">(<xref linkend="sec.update.auto.run"/>を参照)</phrase>、GRUB環境設定の<literal>kernel</literal>という行の末尾に<option>autoupgrade=1</option>を追加します。
     </para>
    </step>
    <step performance="required">
     <para>
      マシンを再起動し、ブートメニューから、新しく追加したセクションを選択します(ここでは、［<emphasis>Linux Upgrade Kernel (Linuxアップグレードカーネル)</emphasis>］)。<command>grubonce</command>を使用すると、新しく作成したGRUBエントリを事前に選択し、新しく作成したエントリで自動的に無人で再起動できます。<command>reboot</command>を使用してコマンドラインから再起動を実行することもできます。
     </para>
    </step>
    <step performance="required">
     <para>
      通常のアップグレードプロセスを実行します(<xref linkend="sec.update.sle11spx.medium.update"/>を参照してください)。
     </para>
    </step>
    <step performance="required">
     <para>
      アップグレードプロセスが正常に完了したら、インストールカーネルおよびinitrdファイル(<filename>/boot/linux.upgrade</filename>および<filename>/boot/initrd.upgrade</filename>)を削除します。これらはもう必要ありません。
     </para>
    </step>
   </procedure>
  </sect2>
 </sect1>
 <xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="update_split_brain.xml" parse="xml"/>

 <sect1 id="sec.update.nmm">
  <title>背景情報: SUSE Linux Enterpriseの製品ライフサイクル</title>

  <para>
   
   SUSE Linux Enterprise Serverのライフサイクルは13年です。そのうち10年間は一般サポート、3年間は拡張サポートが適用されます。
  </para>

  <para>
   SUSE Linux Enterprise Desktopのライフサイクルは10年です。そのうち7年間は一般サポート、3年間は拡張サポートが適用されます。
  </para>

  <para>
   メジャーリリースは4年ごとに提供されます。サービスパックは18カ月ごとに提供されます。
  </para>

  <para>
   古いサービスパックは、新しいサービスパックのリリース後6カ月間サポートされます。ここに示した一部の側面は、<xref linkend="fig.update.releases.service.packs"/>で説明されています。
  </para>

  <figure id="fig.update.releases.service.packs">
   <title>メジャーリリースとサービスパック</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="new-maintenance-model.svg" width="75%"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="new-maintenance-model.png" width="75%"/>
    </imageobject>
   </mediaobject>
  </figure>

  <para>
   アップグレード計画を設計、検証、およびテストするためにさらに時間が必要な場合、長期サービスパックサポートを利用してサポートを延長することにより、12～36カ月間、追加サポートを受けることができます。これは12カ月単位で延長でき、特定のサービスパックに対して合計3～5年のサポートを利用できます(<xref linkend="fig.update.maintenance.long-term-service-pack"/>を参照してください)。
  </para>

  <figure id="fig.update.maintenance.long-term-service-pack">
   <title>長期サービスパックサポート</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="new-maintenance-model+ltss.svg" width="75%"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="new-maintenance-model+ltss.png" width="75%"/>
    </imageobject>
   </mediaobject>
  </figure>

  <sect2 id="sec.update.supportlevel-lifecycle">
   <title>サポートレベル</title>
   <para>
    拡張サポートレベルの範囲は、10年目から13年目までになります。これらのサポートレベルには、継続されるL3エンジニアリングレベルの診断とリアクティブな重大なバク修正が含まれます。これらのサポートレベルでは、重要でないカーネルでのローカルルートエクスプロイトなどのルートエクスプロイトに対しては、ユーザ介入なしで直接実行可能な更新をプロアクティブにサポートします。さらに、限られたパッケージ除外リストを使用して、既存のワークロード、ソフトウェアスタック、およびハードウェアをサポートします。概要については、<xref linkend="tab.security-and-bug-fixes"/>を参照してください。
   </para>
   <table id="tab.security-and-bug-fixes">
    <title>セキュリティ更新とバグの修正</title>
    <tgroup cols="6">
     <colspec colname="c1"/>
     <colspec colname="c2"/>
     <colspec colname="c3"/>
     <colspec colname="c4"/>
     <colspec colname="c5"/>
     <colspec colname="c6"/>
     <thead>
      <row>
       <entry/>
       <entry namest="c2" nameend="c4" align="center">
        <para>
         最新のサービスパック(SP)の一般サポート
        </para>
       </entry>
       <entry>
        <para>
         古いSPの一般サポート(LTSS利用時)
        </para>
       </entry>
       <entry>
        <para>
         LTSS利用時の拡張サポート
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         機能
        </para>
       </entry>
       <entry>
        <para>
         1～5年目
        </para>
       </entry>
       <entry>
        <para>
         6～7年目
        </para>
       </entry>
       <entry>
        <para>
         8～10年目
        </para>
       </entry>
       <entry>
        <para>
         4～10年目
        </para>
       </entry>
       <entry>
        <para>
         10～13年目
        </para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row>
       <entry>
        <para>
         テクニカルサービス
        </para>
       </entry>
       <entry>
        <para>
         対応
        </para>
       </entry>
       <entry>
        <para>
         対応
        </para>
       </entry>
       <entry>
        <para>
         対応
        </para>
       </entry>
       <entry>
        <para>
         対応
        </para>
       </entry>
       <entry>
        <para>
         対応
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         パッチおよび修正の利用
        </para>
       </entry>
       <entry>
        <para>
         対応
        </para>
       </entry>
       <entry>
        <para>
         対応
        </para>
       </entry>
       <entry>
        <para>
         対応
        </para>
       </entry>
       <entry>
        <para>
         対応
        </para>
       </entry>
       <entry>
        <para>
         対応
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         マニュアルおよびナレッジベースの利用
        </para>
       </entry>
       <entry>
        <para>
         対応
        </para>
       </entry>
       <entry>
        <para>
         対応
        </para>
       </entry>
       <entry>
        <para>
         対応
        </para>
       </entry>
       <entry>
        <para>
         対応
        </para>
       </entry>
       <entry>
        <para>
         対応
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         既存のスタックおよびワークロードのサポート
        </para>
       </entry>
       <entry>
        <para>
         対応
        </para>
       </entry>
       <entry>
        <para>
         対応
        </para>
       </entry>
       <entry>
        <para>
         対応
        </para>
       </entry>
       <entry>
        <para>
         対応
        </para>
       </entry>
       <entry>
        <para>
         対応
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         新規展開のサポート
        </para>
       </entry>
       <entry>
        <para>
         対応
        </para>
       </entry>
       <entry>
        <para>
         ○
        </para>
       </entry>
       <entry>
        <para>
         制限あり(パートナーおよび顧客の要求に基づく)
        </para>
       </entry>
       <entry>
        <para>
         制限あり(パートナーおよび顧客の要求に基づく)
        </para>
       </entry>
       <entry>
        <para>
         いいえ
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         拡張リクエスト
        </para>
       </entry>
       <entry>
        <para>
         ○
        </para>
       </entry>
       <entry>
        <para>
         制限あり(パートナーおよび顧客の要求に基づく)
        </para>
       </entry>
       <entry>
        <para>
         制限あり(パートナーおよび顧客の要求に基づく)
        </para>
       </entry>
       <entry>
        <para>
         いいえ
        </para>
       </entry>
       <entry>
        <para>
         非対応
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         ハードウェアの有効化および最適化
        </para>
       </entry>
       <entry>
        <para>
         ○
        </para>
       </entry>
       <entry>
        <para>
         制限あり(パートナーおよび顧客の要求に基づく)
        </para>
       </entry>
       <entry>
        <para>
         制限あり(パートナーおよび顧客の要求に基づく)
        </para>
       </entry>
       <entry>
        <para>
         いいえ
        </para>
       </entry>
       <entry>
        <para>
         非対応
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         SUSE SolidDriverプログラム(旧名称はPLDP)によるドライバのアップデート
        </para>
       </entry>
       <entry>
        <para>
         対応
        </para>
       </entry>
       <entry>
        <para>
         ○
        </para>
       </entry>
       <entry>
        <para>
         制限あり(パートナーおよび顧客の要求に基づく)
        </para>
       </entry>
       <entry>
        <para>
         制限あり(パートナーおよび顧客の要求に基づく)
        </para>
       </entry>
       <entry>
        <para>
         いいえ
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         最新のSPからの修正のバックポート
        </para>
       </entry>
       <entry>
        <para>
         対応
        </para>
       </entry>
       <entry>
        <para>
         ○
        </para>
       </entry>
       <entry>
        <para>
         制限あり(パートナーおよび顧客の要求に基づく)
        </para>
       </entry>
       <entry>
        <para>
         該当なし
        </para>
       </entry>
       <entry>
        <para>
         該当なし
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         重大なセキュリティアップデート
        </para>
       </entry>
       <entry>
        <para>
         対応
        </para>
       </entry>
       <entry>
        <para>
         対応
        </para>
       </entry>
       <entry>
        <para>
         対応
        </para>
       </entry>
       <entry>
        <para>
         対応
        </para>
       </entry>
       <entry>
        <para>
         対応
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         欠陥の解決
        </para>
       </entry>
       <entry>
        <para>
         対応
        </para>
       </entry>
       <entry>
        <para>
         対応
        </para>
       </entry>
       <entry>
        <para>
         制限あり(セキュリティレベル1および2の欠陥のみ)
        </para>
       </entry>
       <entry>
        <para>
         制限あり(セキュリティレベル1および2の欠陥のみ)
        </para>
       </entry>
       <entry>
        <para>
         制限あり(セキュリティレベル1および2の欠陥のみ)
        </para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </table>
  </sect2>

  <sect2 id="sec.update.nmm.repositories">
   <title>リポジトリモデル</title>

   <para>
    リポジトリレイアウトは製品ライフサイクルに対応しています。<xref linkend="tab.update.nmm.repositories.sp2"/>に、SUSE Linux Enterprise 11 SP2～SUSE Linux Enterprise 12のすべてのリポジトリのリストを示します。
   </para>
   <table id="tab.update.nmm.repositories.sp2">
    <title>SUSE Linux Enterprise 11 SP2とSP3、およびSUSE Linux Enterprise 12のリポジトリレイアウト</title>

    <tgroup cols="3">
     <colspec colnum="1" colname="c1" colwidth="1.2*"/>
     <colspec colnum="2" colname="c2" colwidth="3*"/>
     <colspec colnum="3" colname="c3" colwidth="3*"/>
     <thead>
      <row>
       <entry>
        <para>
         タイプ
        </para>
       </entry>
       <entry>
        <para>
         SLES
        </para>
       </entry>
       <entry>
        <para>
         SLED
        </para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row>
       <entry>
        <para>
         必須のリポジトリ
        </para>
       </entry>
       <entry>
        <para>
         11 SP2
        </para>
        <simplelist>
         <member><literal>SLES11-SP1-Pool</literal> </member> <member><literal>SLES11-SP1-Updates</literal> </member> <member><literal>SLES11-SP2-Core</literal> </member> <member><literal>SLES11-SP2-Updates</literal> </member>
        </simplelist>
        <para>
         11 SP3
        </para>
        <simplelist>
         <member><literal>SLES11-SP3-Pool</literal> </member> <member><literal>SLES11-SP3-Updates</literal> </member>
        </simplelist>
        <para>
         12
        </para>
        <simplelist>
         <member><literal>SLES12-GA-Pool</literal> </member> <member><literal>SLES12-GA-Updates</literal> </member>
        </simplelist>
       </entry>
       <entry>
        <para>
         11 SP2
        </para>
        <simplelist>
         <member><literal>SLED11-SP1-Pool</literal> </member> <member><literal>SLED11-SP1-Updates</literal> </member> <member><literal>SLED11-SP2-Core</literal> </member> <member><literal>SLED11-SP2-Updates</literal> </member>
        </simplelist>
        <para>
         11 SP3
        </para>
        <simplelist>
         <member><literal>SLED11-SP3-Pool</literal> </member> <member><literal>SLED11-SP3-Updates</literal> </member>
        </simplelist>
        <para>
         12
        </para>
        <simplelist>
         <member><literal>SLED12-GA-Pool</literal> </member> <member><literal>SLED12-GA-Updates</literal> </member>
        </simplelist>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         任意選択のリポジトリ
        </para>
       </entry>
       <entry>
        <para>
         11 SP2
        </para>
        <simplelist>
         <member><literal>SLES11-SP2-Debuginfo-Core</literal> </member> <member><literal>SLES11-SP2-Debuginfo-Updates</literal> </member> <member><literal>SLES11-Extras</literal> </member> <member><literal>SLES11-SP2-Extension-Store</literal> </member>
        </simplelist>
        <para>
         11 SP3
        </para>
        <simplelist>
         <member><literal>SLES11-SP3-Debuginfo-Core</literal> </member> <member><literal>SLES11-SP3-Debuginfo-Updates</literal> </member> <member><literal>SLES11-SP3-Extension-Store</literal> </member> <member><literal>SLES11-Extra</literal> </member>
        </simplelist>
        <para>
         12
        </para>
        <simplelist>
         <member><literal>SLES12-GA-Debuginfo-Core</literal> </member> <member><literal>SLES12-GA-Debuginfo-Updates</literal> </member>
        </simplelist>
       </entry>
       <entry>
        <para>
         11 SP2
        </para>
        <simplelist>
         <member><literal>SLED11-SP2-Debuginfo-Core</literal> </member> <member><literal>SLED11-SP2-Debuginfo-Updates</literal> </member> <member><literal>SLED11-Extras</literal> </member> <member><literal>SLED11-SP2-Extension-Store</literal> </member>
        </simplelist>
        <para>
         11 SP3
        </para>
        <simplelist>
         <member><literal>SLED11-SP3-Debuginfo-Core</literal> </member> <member><literal>SLED11-SP3-Debuginfo-Updates</literal> </member> <member><literal>SLED11-SP3-Extension-Store</literal> </member> <member><literal>SLED11-Extra</literal> </member>
        </simplelist>
        <para>
         12
        </para>
        <simplelist>
         <member><literal>SLED12-GA-Debuginfo-Core</literal> </member> <member><literal>SLED12-GA-Debuginfo-Updates</literal> </member>
        </simplelist>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         新規: <emphasis/>「モジュール」に固有のリポジトリ
        </para>
       </entry>
       <entry>
        <para>
         12
        </para>
        <simplelist>
         <member><literal>sle-module-web-scripting</literal> </member> <member><literal>sle-module-adv-systems-management</literal> </member> <member><literal>sle-module-public-cloud</literal> </member> <member><literal>sle-module-legacy</literal> </member>
        </simplelist>
       </entry>
       <entry>
        <para>
         12
        </para>
	
       </entry>
      </row>
     </tbody>
    </tgroup>
   </table>
   <variablelist>
    <title>必須のリポジトリの説明</title>
    <varlistentry>
     <term>更新内容</term>
     <listitem>
      <para>
       保守によって更新されるのは、対応する<literal>Core</literal>または<literal>Pool</literal>リポジトリ内のパッケージのみです。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>Pool</term>
     <listitem>
      <para>
       インストールメディアからのすべてのバイナリRPMとパターン情報が格納され、ステータスメタデータをサポートします。
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
   <variablelist>
    <title>任意選択のリポジトリの説明</title>
    <varlistentry>
     <term>Debuginfo-Pool</term>
     <term>Debuginfo-Updates</term>
     <listitem>
      <para>
       これらのリポジトリには、静的なコンテンツが格納されます。これら2つのうち、アップデートを受け取るのは<literal>Debuginfo-Updates</literal>リポジトリのみです。問題の発生時にデバッグ情報を含むライブラリをインストールする必要がある場合は、これらのリポジトリを有効にします。
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
   <sect3 id="sec.update.nmm.repositories.origin">
    <title>パッケージの起源</title>
    <formalpara>
     <title>SUSE Linux Enterprise 11 SP3</title>
     <para>
      SP3へのアップデートでは、<literal os="sles">SLES11-SP3-Pool</literal>と<literal os="sles">SLES11-SP3-Updates</literal>の2つのリポジトリのみが使用可能です。SP2からの古いリポジトリは表示されますが、有効にはなりません。これらの無効なリポジトリが必要になるのは、特定のニーズを持つユーザのみです。
     </para>
    </formalpara>
    <formalpara>
     <title>SUSE Linux Enterprise 12</title>
     <para>
      SUSE Linux Enterprise 12へのアップデートでは、<literal os="sles">SLES12-GA-Pool</literal>と<literal os="sles">SLES12-GA-Updates</literal>の2つのリポジトリのみが使用可能です。SUSE Linux Enterprise 11 SP3からの古いリポジトリは無効になっています。
     </para>
    </formalpara>
   </sect3>
   <sect3 id="sec.update.nmm.repositories.working">
    <title>リポジトリの操作</title>
    <para>
     登録を行うと、システムがSUSEカスタマーセンターからリポジトリを受信します。リポジトリ名はカスタマセンター内の特定のURIにマップされています(<ulink url="https://scc.suse.com/"/>を参照)。ご使用のシステムで使用可能なすべてのリポジトリを一覧にするには、次のように<command>zypper</command>を使用します。
    </para>
<screen>zypper repos -u</screen>

    <para>
     これにより、ご使用のシステムで使用可能なすべてのリポジトリのリストが表示されます。リポジトリごとに、別名、名前、有効かどうか、リフレッシュされるかどうかといった情報がリストされます。オプション<option>-u</option>を使用すると、元となるURIも表示されます。
    </para>
    <para>
     古いリポジトリ(SP1にあるものなど)を削除する場合は、<command>zypper removerepo</command>と、リポジトリの名前を使用します。たとえば、SP1およびSP2の古いリポジトリを削除するには、次のコマンドを使用します。
    </para>
<screen>zypper removerepo SLES11-SP1-Pool SLES11-SP1-Updates \
    SLE11-SP1-Debuginfo-Pool SLE11-SP1-Debuginfo-Updates \
    SLES11-SP2-Core SLES11-SP2-Updates \
    SLE11-SP2-Debuginfo-Core SLES11-SP2-Extension-Store\
    SLE11-SP2-Debuginfo-Updates</screen>
    <para>
     リポジトリを再度追加する場合は、<ulink url="https://scc.suse.com/"/>にログインして、<menuchoice><guimenu>マイプロダクト</guimenu><guimenu>資格情報のミラー</guimenu></menuchoice>の順に選択します。URIのリストが表示され、この製品リストにあるリポジトリのみを追加することができます。たとえば、SP2 Extension Storeを追加する場合は、次のコマンドを使用します(1行で、バックスラッシュなし)。
    </para>
<screen>zypper addrepo -n SLES11-SP2-Extension-Store \
    https://nu.novell.com/repo/\$RCE/SLES11-SP2-Extension-Store/nu_novell_com:SLES11-SP2-Extension-Store</screen>
   </sect3>
  </sect2>
 </sect1>
 <sect1 id="sec.update.backports">
  <title>背景情報: ソースコードのバックポート</title>

  <para>
   SUSEはバックポートを広い範囲で使用しています。バックポートとは、ソフトウェアの最新の修正や機能をリリース済みのSUSE Linux Enterpriseパッケージにマイグレートすることです。このセクションでは、SUSE Linux Enterpriseソフトウェアパッケージの機能とセキュリティを判断するためにバージョン番号を比較しても当てにならない可能性がある理由について説明します。この説明を読むと、SUSEがどのようにしてシステムソフトウェアを安全で最新の状態に保ちつつ、SUSE Linux Enterprise製品上でアプリケーションソフトウェアの互換性を維持しているかを理解できます。さらに、公表されているセキュリティ上の問題のうち、ご使用のSUSE Linux Enterpriseシステムソフトウェアでどれが実際に対応済みかを確認する方法、およびご使用のソフトウェアが本当にどの程度最新かを確認する方法を学ぶこともできます。

  </para>

  <sect2 id="sec.update.backports.why">
   <title>バックポートの理由</title>
   <para>
    アップストリームの開発者は、自分が開発するソフトウェアを前進させることを念頭に置いています。多くの場合、バグの修正と新機能の導入が組み合わせられますが、その新機能は詳細なテストをまだ受けていないために、新しいバグを生み出す可能性があります。
   </para>
   <para>
    配布物の開発者としては、次のものを見分けることが重要です。
   </para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>
      バグ修正(機能を中断する限定的な可能性がある)。
     </para>
    </listitem>
    <listitem>
     <para>
      変更(既存の機能を中断する可能性がある)。
     </para>
    </listitem>
   </itemizedlist>
   <para>
    多くの場合、パッケージがリリースされた配布物の一部になったら、配布物の開発者はアップストリームでのすべての変更を追うことはしません。通常は、最初にリリースされたアップストリームバージョンから離れずに、アップストリームの変更に基づいてパッチを作成してバグを修正します。こうした一連の処理は<emphasis>バックポート</emphasis>と呼ばれています。
   </para>
   <para>
    一般的に、配布物の開発者が新しいバージョンのソフトウェアを導入するのは、次の2つの場合のみです。
   </para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>
      パッケージとアップストリームバージョンの変更内容の差があまりに大きくなり、バックポートが不可能になってしまった場合。
     </para>
    </listitem>
    <listitem>
     <para>
      本質的に経年劣化するソフトウェア(マルウェア対策ソフトウェアなど)。
     </para>
    </listitem>
   </itemizedlist>
  </sect2>

  <sect2 id="sec.update.backports.reasons-for">
   <title>バックポートを行う理由</title>
   <para>
    SUSEでは、エンタープライズソフトウェアに対する数多くの考慮事項のバランスをうまく取るために、広い範囲でバックポートを使用しています。こうした考慮事項のうち最も重要なものは次のとおりです。
   </para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>
      SUSEのエンタープライズ製品上で使用する製品を構築する際にソフトウェアベンダーが信頼することのできる安定したインタフェース(API)を提供すること。
     </para>
    </listitem>
    <listitem>
     <para>
      SUSEのエンタープライズ製品のリリースで使用するパッケージが、単体としてもエンタープライズ製品全体の一部としても、最高品質であり、完全にテスト済みであることを確認すること。
     </para>
    </listitem>
    <listitem>
     <para>
      SUSEのエンタープライズ製品に対するその他のベンダーによるさまざまな証明書を維持すること(OracleまたはSAP製品の証明書など)。
     </para>
    </listitem>
    <listitem>
     <para>
      SUSEの開発者が、リリース全体に薄く広く注意を拡散させる必要なく、できるだけ優れた次のバージョンの製品の開発に集中できるようにすること。
     </para>
    </listitem>
    <listitem>
     <para>
      特定のエンタープライズ向けリリースの内容の明確性を保ち、サポートがそのリリースについて正確かつタイムリーな情報を提供できるようにすること。
     </para>
    </listitem>
   </itemizedlist>
  </sect2>

  <sect2 id="sec.update.backports.reasons-against">
   <title>バックポートを行わない理由</title>
   <para>
    一般的なポリシールールとしては、当社のエンタープライズ製品に、パッケージの新しいアップストリームバージョンは導入されないことになっています。ただしこのルールは絶対的なものではありません。限られたクラスのパッケージ(特定のウィルス対策ソフトウェア内)では、品質確保の観点から選ばれた保守的なアプローチよりも、セキュリティに関する考慮事項の方が重視されます。こうしたクラスのパッケージでは、時として、エンタープライズ製品ラインのリリース済みバージョンに、新しいバージョンが導入されることがあります。
   </para>
   <para>
    その他のタイプのパッケージについても、バックポートではなく新しいバージョンの導入が選択される場合があります。バックポートの作成が経済的に不可能な場合や、新しいバージョンの導入に対する非常に妥当な技術的な理由が存在する場合などがこれに該当します。
   </para>
  </sect2>

  <sect2 id="sec.update.backports.">
   <title>バージョン番号の解釈に対するバックポートの意味</title>
   <para>
    バックポートが実行されているために、SUSEパッケージに特定の問題の修正が含まれているのか、または特定の機能が追加されているのかを、バージョン番号を単純に比較して判断することはできません。バックポートでは、SUSEパッケージのバージョン番号のアップストリーム部分は、単にSUSEパッケージの基となっているアップストリームバージョンを示しているだけです。ここには、対応するアップストリームリリースには存在しないけれどもSUSEパッケージにはバックポートされている修正や機能が含まれている可能性があります。
   </para>
   <para>
    バックポートが関係する場合にバージョン番号のこの限られた値が問題を引き起こす可能性がある、1つの特定の領域として、セキュリティスキャンツールの使用が挙げられます。セキュリティの脆弱性スキャンツール(または、それらのツールによる特定のテスト)の中には、単にバージョン情報のみに基づいて機能するものがあります。したがって、これらのツール/テストでは、バックポートが関係している場合に<quote>false positive</quote> (実際は脆弱ではないのに、ソフトウェアに脆弱な部分が見つかったというクレーム)が生成される傾向があります。セキュリティスキャンツールによるレポートを評価する場合は、エントリがバージョン番号に基づくものなのか、脆弱性が本当に存在するかどうかに関する実際のテストに基づくものかを、常に調査する必要があります。
   </para>
  </sect2>
  <sect2>
   <title>
    修正済みのバグ、およびバックポートされて利用可能な機能を確認する方法
   </title>
   <para>
    バックポートされたバグ修正や機能に関する情報が保存されている場所は数多くあります。
   </para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>
      パッケージの変更ログ:
     </para>
<screen>rpm -q --changelog name-of-installed-package
rpm -qp --changelog packagefile.rpm</screen>
     <para>
      パッケージの変更履歴を簡単にドキュメント化した出力です。
     </para>
    </listitem>
    <listitem>
     <para>
      パッケージの変更ログには、NovellのBugzillaトラッキングシステム内でバグを示す<literal>bnc#1234</literal>のようなエントリや、その他のバグトラッキングシステムへのリンクなどが含まれます(機密保護ポリシーにより、ユーザがこうした情報のすべてにアクセスできるわけではありません)。
     </para>
    </listitem>
    <listitem>
     <para>
      パッケージには、SUSEパッケージに固有の一般的な概要情報を含む<filename>/usr/share/doc/<replaceable>packagename</replaceable>/README.SUSE</filename>または<filename>README.SuSE</filename>ファイルが格納されている場合もあります。
     </para>
    </listitem>
    <listitem>
     <para>
      RPMソースパッケージには、通常のバイナリRPMを個別のファイルとして構築するときに適用されたパッチが含まれます。これらのファイルは、ソースコードの解読に精通していれば解釈することができます。SUSE Linux Enterpriseソフトウェアのソースのインストールについては、<xref linkend="sec.zypper.softman.sources"/>を参照してください。SUSE Linux Enterpriseでのパッケージの構築については、<xref linkend="sec.rpm.sources"/>を参照してください。SUSE Linux Enterpriseソフトウェアパッケージの構築に関する内部処理については、『<ulink url="http://www.rpm.org/max-rpm/">Maximum RPM</ulink>』のブックを参照してください。
     </para>
    </listitem>
    <listitem>
     <para>
      セキュリティ上のバグ修正については、<ulink url="http://www.suse.com/support/security/#1">SUSEのセキュリティ告知</ulink>を参照してください。バグは、<literal>CAN-2005-2495</literal>などの標準名で示されることがよくあります。こうした名前は、<ulink url="http://cve.mitre.org">Common Vulnerabilities and Exposures (CVE)</ulink>によって維持されています。
     </para>
    </listitem>
   </itemizedlist>

  </sect2>
 </sect1>
 <sect1 id="sec.update.wagonhooks">
  <title>背景情報: YaST Wagonのマイグレーションフック</title>



  <para>
   マイグレーションフックによって、マイグレーションプロセスの過程のどこかの時点で、カスタムの外部スクリプトを実行できます。これらのスクリプトを使用して、通常のRPMスクリプトでは処理できない特定の問題を処理したり、マイグレーション中に必要とされるような(通常のパッケージアップデートでは必要とされない)追加のアクションを実行することができます。
  </para>

  <para>
   マイグレーションフックはルート権限で実行されるので、スクリプト内では任意の保守タスクを実行できます(サービスの開始/停止、データのバックアップ、データマイグレーションなど)。これらのスクリプトは対話型にはできません。YaSTでの実行中にSTDINおよびSTDOUTがパイプにリダイレクトされます。Xセッションは使用できません。すべてのケースで使用できるとは限らないからです(テキストモードで実行中の場合など)。フックスクリプトについては、実行可能パーミッションを設定することを忘れないでください。
  </para>

  <para>
   マイグレーションフックは、<systemitem class="resource">yast2-wagon</systemitem>パッケージのバージョン2.17.32.1 (SLES11-SP2に対するアップデートとして提供)または2.17.34 (SLES11-SP3に含まれる)以上でサポートされています。
  </para>

  <sect2>
   <title>フックスクリプトの場所と命名規則</title>
   <para>
    これらのスクリプトは、<filename>/var/lib/YaST2/wagon/hooks/</filename>ディレクトリで見つけることができます。想定されるスクリプト名の形式は、<replaceable>step_seq_prefix_name</replaceable>です。各文字列は次のような意味になります。
   </para>
   <variablelist>
    <varlistentry>
     <term><replaceable>step</replaceable>
     </term>
     <listitem>
      <para>
       事前定義されたマイグレーションステップ名で、現在のマイグレーションステップを説明します。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><replaceable>seq</replaceable>
     </term>
     <listitem>
      <para>
       00～99までのシーケンス番号で、これによりスクリプトの実行順序を設定することができます(正しくソートできるようにするためには、必ず00から開始することが重要です)。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><replaceable>prefix</replaceable>
     </term>
     <listitem>
      <para>
       競合を避けるために一意にする必要があります(ネームスペースのように)。(パッケージの一部であれば)パッケージ名、またはベンダー名やインターネットドメイン名などを使用します。一意であると十分に考えられるものであれば何でも使用できます。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><replaceable>name</replaceable>
     </term>
     <listitem>
      <para>
       任意の文字列にできます(スクリプトを区別するために使用されます)。わかりやすい名前にすることをお勧めします。
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
   <example>
    <title>完全パスのフックスクリプト</title>
<screen>/var/lib/YaST2/wagon/hooks/before_package_migration_00_postgresql_backup</screen>
   </example>
  </sect2>

  <sect2>
   <title>フックスクリプトの終了値</title>
   <para>
    スクリプトは終了値0を返す必要があります。失敗した(終了値がゼロ以外の)場合は、Wagonにエラーメッセージが表示され、スクリプトを再起動するか、失敗を無視(別のスクリプトで続行)するか、現在のステップおよびステージのフックを完全にキャンセルすることができます。
   </para>
  </sect2>

  <sect2>
   <title>等羃のスクリプト</title>
   <para>
    フックスクリプトは<emphasis>何度も実行される可能性がある</emphasis>(Wagonのダイアログを行き来しているうちに、Wagonそのものが再起動したり、マイグレーションワークフロー内で一部のステップが複数回実行される可能性もある)ので、スクリプトはその事実に対処する必要があります(アクションを実行する必要があるのか、アクションはすでに実行済みなのか、単純な一時的なスタンプファイルを作成できるのか、そうでなければ複数回の実行を正しく解決できるのかを、最初に確認することができます)。
   </para>
  </sect2>

  <sect2>
   <title>サポートされているフックのリスト</title>
   
   <para>
    一部のフックはオプションです(以前の結果またはユーザ選択の値に依存しているため)。一部のフックは複数回呼び出されるので注意が必要です(たとえば、登録はマイグレーションの前後に呼び出されます)。次に、サポートされているフック(ステップ名)を実行順に並べたリストを示します。
   </para>
   <variablelist>
    <varlistentry>
     <term><command>before_init</command>
     </term>
     <listitem>
      <para>
       最初に開始されます(注意: Wagonの再起動後にもう一度呼び出されます)。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><command>before_welcome</command>
     </term>
     <term><command>after_welcome</command>
     </term>
     <listitem>
      <para>
       ［ようこそ］ダイアログが表示される前後に開始されます。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><command>before_registration_check</command>
     </term>
     <term><command>after_registration_check</command>
     </term>
     <listitem>
      <para>
       Wagonが登録状態をチェックします(一部の製品の登録の期限が切れていると、マイグレーションに失敗する場合があります)。すべてがOKの場合は何もダイアログが表示されず、Wagonによって自動的に次のステップに進みます。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><command>before_custom_url</command>
     </term>
     <term><command>after_custom_url</command>
     </term>
     <listitem>
      <para>
       リポジトリマネージャが開始されます(オプション、パッチCDモードのみ)。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><command>before_self_update</command>
     </term>
     <term><command>after_self_update</command>
     </term>
     <listitem>
      <para>
       Wagonのアップデートそのものの前後に呼び出されます(最新バージョンがマイグレーションに使用されていることを確認します)。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><command>before_installing_migration_products</command>
     </term>
     <term><command>after_installing_migration_products</command>
     </term>
     <listitem>
      <para>
       マイグレーション製品のインストールの前後に呼び出されます。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><command>before_selecting_migration_source</command>
     </term>
     <term><command>after_selecting_migration_source</command>
     </term>
     <listitem>
      <para>
       SUSEカスタマーセンターリポジトリ経由でマイグレートするのか、カスタムリポジトリを使用してマイグレートするのか、Wagonがユーザに尋ねます。次のステップはこのユーザ選択によって決まります。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><command>before_registration</command>
     </term>
     <term><command>after_registration</command>
     </term>
     <listitem>
      <para>
       SUSEレジスタが実行されます(マイグレーションリポジトリを追加するため)。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><command>before_repo_selection</command>
     </term>
     <term><command>after_repo_selection</command>
     </term>
     <listitem>
      <para>
       手動のリポジトリ管理。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><command>before_set_migration_repo</command>
     </term>
     <term><command>after_set_migration_repo</command>
     </term>
     <listitem>
      <para>
       マイグレーションリポジトリ(SUSEカスタマーセンターの使用時は完全/最小マイグレーション)を選択するか、リポジトリ選択を更新します(カスタムリポジトリマイグレーション)。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><command>before_package_migration</command>
     </term>
     <listitem>
      <para>
       パッケージのアップデートが開始される前、このステップの後に実際のマイグレーションが開始され、前の状態に自動的に戻ることはできなくなります(このフェーズで中止すると、システムに矛盾が発生し(半分アップグレードされた状態)、手動のロールバックが必要になります)。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><command>before_registration</command>
     </term>
     <term><command>after_registration</command>
     </term>
     <listitem>
      <para>
       SUSEレジスタが実行されます(アップデートされた製品を登録するため)。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><command>before_congratulate</command>
     </term>
     <term><command>after_congratulate</command>
     </term>
     <listitem>
      <para>
       マイグレーションが成功した結果、Wagonによって成功を示すダイアログが表示される前後。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><command>before_exit</command>
     </term>
     <listitem>
      <para>
       Wagonが終了する直前に呼び出されます(中止後や再起動時も含め、マイグレーションの結果に関係なく常に呼び出されます)。
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
  </sect2>

  <sect2>
   <title>中止のフック</title>
   <para>
    ユーザがマイグレーションを中止したときに呼び出される、特別な中止のフックがあります。これらのフックはマイグレーションワークフロー内の任意のステップで呼び出すことができるので、実行順序は保証できません。他のフックの結果に依存している場合、スクリプトで現在の状態をチェックする必要があります。
   </para>
   <variablelist>
    <varlistentry>
     <term><command>before_abort</command>
     </term>
     <listitem>
      <para>
       ユーザがマイグレーションの中止を確定しました。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><command>before_abort_rollback</command>
     </term>
     <term><command>after_abort_rollback</command>
     </term>
     <listitem>
      <para>
       ユーザが中止後にロールバックを確定しました(マイグレーション開始前にインストールされていた古い製品に戻ります)。これらのフックはbefore_abortの後に呼び出され、ユーザがロールバックを確定しない場合はスキップされます。
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
  </sect2>

  <sect2>
   <title>再起動のフック</title>
   <para>
    これらのフックは、Wagonそのものが再起動されると常に呼び出されます。
   </para>
   <variablelist>
    <varlistentry>
     <term><command>before_restart</command>
     </term>
     <listitem>
      <para>
       Wagonは終了し、もう一度開始されます。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><command>after_restart</command>
     </term>
     <listitem>
      <para>
       Wagonは再起動されており、マイグレーションワークフローの次のステップが実行されます。
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
  </sect2>

  <sect2>
   <title>通常使用するフック</title>
   <para>
    フックのリストはかなり大きなものですが、その多くは特別な事例で意味をなすものです。通常の使用例では、次のようなフックが優先的に使用されます。
   </para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>
      システムをマイグレートする前(まだ前のバージョンを実行しているとき)に何らかのアクションを実行するには、<command>before_package_migration</command>フックを使用します。
     </para>
     <para>
      この時点では、マイグレーションの準備ができていて開始寸前であることは明確ですが、それ以前のすべてのステップで、マイグレーションを中止することが可能でした。

     </para>
    </listitem>
    <listitem>
     <para>
      システムのマイグレート後(システムはマイグレート後の新しいバージョンを実行しているが、何かまだアクティブになっていない機能があるとき(カーネルのアップデート後に再起動が必要な場合や、サービスのアップデート後に再起動が必要な場合など))に何らかのアクションを実行するには、<command>before_congratulate</command>または<command>after_congratulate</command>フックを使用します。
     </para>
     <para>
      これは、<command>before_package_migration</command>フックによる一時的な結果を消去する場合にも使用できます。この時点で、マイグレーションは正常に終了しています。
     </para>
    </listitem>
    <listitem>
     <para>
      マイグレーションが中止された場合に変更を元に戻すには、事例に応じて、中止のフックのいずれかを使用します。中止のフックはいつでも呼び出すことができるので、元に戻す必要はないかもしれません(変更を実行するフックがまだ呼び出されていない可能性があります)。中止のフックでは、現在の状態をチェックする必要があります。
     </para>
    </listitem>
   </itemizedlist>
  </sect2>

  <sect2>
   <title>廃止されたフック</title>
   <para>
    古いバージョンのWagonでは、2つのフックスクリプトのみがサポートされていました。<filename>/usr/lib/YaST2/bin/wagon_hook_init</filename>と<filename>/usr/lib/YaST2/bin/wagon_hook_finish</filename>です。問題は、フックとして実行できるスクリプトは1つだけで、フックを直接PRMパッケージに配置できないことでした。
   </para>
   <para>
    これらの古いフックスクリプトは、後方互換性のために新しいバージョンのWagonでもサポートされていますが、廃止されたフックの変わりに、新しいフックの<command>before_init</command>と<command>before_exit</command>を使用する必要があります。
   </para>
  </sect2>
 </sect1>
</chapter>
