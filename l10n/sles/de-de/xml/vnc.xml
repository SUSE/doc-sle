<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="vnc.xml" version="5.0" xml:id="cha-vnc">
 <title>Remote-Grafiksitzungen mit VNC</title>
 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:bugtracker/>
   <dm:translation>yes</dm:translation>
  </dm:docmanager>
  <abstract>
   <para>
    Über VNC (Virtual Network Computing) haben Sie über einen Grafik-Desktop Zugriff auf einen Remote-Rechner und können Remote-Grafikanwendungen ausführen. VNC ist plattformunabhängig und greift auf den Remote-Rechner über ein beliebiges Betriebssystem zu. In diesem Kapitel wird beschrieben, wie mit den Desktop-Clients vncviewer und Remmina eine Verbindung zu einem VNC-Server hergestellt und wie ein VNC-Server betrieben wird.
   </para>
     <para>
    <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> unterstützt zwei verschiedene Arten von VNC-Sitzungen: einmalige Sitzungen, die so lange <quote>aktiv</quote> sind, wie die VNC-Verbindung zum Client besteht, und permanente Sitzungen, die so lange <quote>aktiv</quote> sind, bis sie explizit beendet werden.
   </para>
  <para>
   Ein VNC-Server kann beide Sitzungen gleichzeitig auf verschiedenen Ports bieten, eine geöffnete Sitzung kann jedoch nicht von einem Typ in den anderen konvertiert werden.
  </para>
   </abstract>
</info>

 <sect1 xml:id="sec-vnc-viewer">
  <title>Der <command>vncviewer</command>-Client</title>
 

  <para>
   Um eine Verbindung zu einem VNC-Dienst herzustellen, der von einem Server bereitgestellt wird, ist ein Client erforderlich. Der Standard-Client in <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> ist <command>vncviewer</command>, der im Paket <systemitem class="resource">tigervnc</systemitem> bereitgestellt wird.
  </para>

  <sect2 xml:id="sec-vnc-viewer-connectcli">
   <title>Verbinden mithilfe der vncviewer-CLI</title>
   <para>
    Mit folgendem Kommando können Sie den VNC-Viewer starten und eine Sitzung mit dem Server initiieren:
   </para>
<screen><prompt>&gt; </prompt>vncviewer jupiter.example.com:1</screen>
   <para>
    Anstelle der VNC-Anmeldenummer können Sie auch die Portnummer mit zwei Doppelpunkten angeben:
   </para>
<screen><prompt>&gt; </prompt>vncviewer jupiter.example.com::5901</screen>
   <note>
    <title>Anzeige- und Portnummer</title>
    <para>
     Die im VNC-Client angegebene Anzeige- oder Portnummer muss mit der Anzeige- oder Portnummer übereinstimmen, die durch den Befehl <command>vncserver</command> auf dem Zielcomputer ausgewählt wird. Weitere Informationen finden Sie unter <xref linkend="sec-vnc-persistent"/>.
    </para>
   </note>
  </sect2>

  <sect2 xml:id="sec-vnc-viewer-connectgui">
   <title>Verbinden mithilfe der vncviewer-GUI</title>
   <para>
    Wenn <command>vncviewer</command> ausgeführt wird, ohne <command>--listen</command> oder einen Host für die Verbindung anzugeben, wird ein Fenster zur Eingabe von Verbindungsinformationen angezeigt. Geben Sie den Host in das Feld <guimenu>VNC server</guimenu> (VNC-Server) wie in <xref linkend="sec-vnc-viewer-connectcli"/> ein und klicken Sie auf <guimenu>Connect</guimenu> (Verbinden).
   </para>
   <figure xml:id="fig-vnc-viewer-connectgui">
    <title>vncviewer</title>
    <mediaobject>
     <textobject role="description"><phrase>vncviewer asking for connection details</phrase>
     </textobject>
     <imageobject role="html">
      <imagedata fileref="vnc_connect.png"/>
     </imageobject>
     <imageobject role="fo">
      <imagedata fileref="vnc_connect.png"/>
     </imageobject>
    </mediaobject>
   </figure>
  </sect2>

  <sect2 xml:id="sec-vnc-viewer-encrypt">
   <title>Benachrichtigungen zu unverschlüsselten Verbindungen</title>
   <para>
    Das VNC-Protokoll unterstützt verschiedene Arten von verschlüsselten Verbindungen, nicht zu verwechseln mit Passwortauthentifizierung. Wenn eine Verbindung kein TLS verwendet, wird der Text <quote>(Connection not encrypted!)</quote> (Verbindung nicht verschlüsselt!) im Fenstertitel des VNC-Viewers angezeigt.
   </para>
  </sect2>
 </sect1>

 <sect1 xml:id="vnc-remmina">
  <title>Remmina: Remote-Desktop-Client</title>

  <para>
   Der moderne Remote-Desktop-Client Remmina bietet einen großen Funktionsumfang. Es werden mehrere Zugriffsmethoden unterstützt, z. B. VNC, SSH, RDP oder Spice.
  </para>

  <sect2 xml:id="vnc-remmina-install">
   <title>Installation</title>
   <para>
    Überprüfen Sie zur Verwendung von Remmina, ob das <package>remmina</package>-Paket auf Ihrem System installiert ist, und installieren Sie es gegebenenfalls. Denken Sie daran, auch das VNC-Plugin für Remmina zu installieren:
   </para>
<screen>
<prompt role="root"># </prompt>zypper in remmina remmina-plugin-vnc
</screen>
  </sect2>

  <sect2 xml:id="vnc-remmina-usage">
   <title>Hauptfenster</title>
   <para>
    Starten Sie Remmina mit dem Befehl <command>remmina</command>.
   </para>
   <figure>
    <title>Hauptfenster von Remmina</title>
    <mediaobject>
     <imageobject role="fo">
      <imagedata fileref="remmina.png" width="50%"/>
     </imageobject>
     <imageobject role="html">
      <imagedata fileref="remmina.png" width="50%"/>
     </imageobject>
    </mediaobject>
   </figure>
   <para>
    Das Hauptanwendungsfenster enthält eine Liste der gespeicherten Remote-Sitzungen. Hier können Sie eine neue Remote-Sitzung hinzufügen und speichern, eine neue Sitzung per Schnellstart beginnen (also ohne zu speichern), eine zuvor gespeicherte Sitzung starten oder die globalen Einstellungen für Remmina festlegen.
   </para>
  </sect2>

  <sect2 xml:id="vnc-remmina-addnew">
   <title>Hinzufügen von Remote-Sitzungen</title>
   <para>
    Um eine neue Remote-Sitzung hinzuzufügen und zu speichern, klicken Sie auf <inlinemediaobject><textobject role="description"><phrase>Neue Sitzung hinzufügen</phrase></textobject><imageobject role="fo"><imagedata fileref="remmina_plus.png" width="1.2em"/></imageobject><imageobject role="html"><imagedata fileref="remmina_plus.png" width="1.2em"/></imageobject></inlinemediaobject> oben links im Hauptfenster. Das Fenster <guimenu>Remote Desktop Preference</guimenu> wird geöffnet.
   </para>
   <figure>
    <title>Remote Desktop Preference</title>
    <mediaobject>
     <imageobject role="fo">
      <imagedata fileref="remmina_session_details.png" width="80%"/>
     </imageobject>
     <imageobject role="html">
      <imagedata fileref="remmina_session_details.png" width="80%"/>
     </imageobject>
    </mediaobject>
   </figure>
   <para>
    Füllen Sie die Felder für das soeben hinzugefügte Remote-Sitzungsprofil aus. Die wichtigsten sind:
   </para>
   <variablelist>
    <varlistentry>
     <term>Name</term>
     <listitem>
      <para>
       Name des Profils. Wird im Hauptfenster angezeigt.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>Protokoll</term>
     <listitem>
      <para>
       Protokoll für die Verbindung zur Remote-Sitzung, z. B. VNC.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>Server</term>
     <listitem>
      <para>
       IP- oder DNS-Adresse und Anzeigenummer des Remote-Servers.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>Benutzername, Benutzerpasswort</term>
     <listitem>
      <para>
       Berechtigungsnachweis für die Remote-Authentifizierung. Soll keine Authentifizierung erfolgen, geben Sie hier nichts ein.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>Farbtiefe, Qualität</term>
     <listitem>
      <para>
       Wählen Sie die optimalen Optionen für Ihre Verbindungsgeschwindigkeit und -qualität.
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
   <para>
    Auf der Registerkarte <guimenu>Advanced</guimenu> finden Sie weitere Einstellungen.
   </para>
   <tip>
    <title>Verschlüsselung deaktivieren</title>
    <para>
     Wenn die Kommunikation zwischen dem Client und dem Remote-Server nicht verschlüsselt ist, aktivieren Sie die Option <guimenu>Disable encryption</guimenu>. Ansonsten kommt es zu Verbindungsfehlern.
    </para>
   </tip>
   <para>
    Auf der Registerkarte <guimenu>SSH</guimenu> finden Sie erweiterte Optionen für SSH-Tunneling und Authentifizierung.
   </para>
   <para>
    Bestätigen Sie die Eingabe mit <guimenu>Speichern</guimenu>. Das neue Profil wird im Hauptfenster angezeigt.
   </para>
  </sect2>

  <sect2 xml:id="vnc-remmina-start">
   <title>Starten von Remote-Sitzungen</title>
   <para>
    Sie können entweder eine zuvor gespeicherte Sitzung starten oder eine Remote-Sitzung per Schnellstart beginnen (also ohne die Verbindungsdetails zu speichern).
   </para>
   <sect3 xml:id="vnc-remmina-quickstart">
    <title>Schnellstart von Remote-Sitzungen</title>
    <para>
     Mit dem Drop-down-Feld und dem Textfeld oben im Hauptfenster können Sie eine Remote-Sitzung per Schnellstart beginnen, ohne die Verbindungsdetails anzugeben und zu speichern.
    </para>
    <figure>
     <title>Schnellstart</title>
     <mediaobject>
      <imageobject role="fo">
       <imagedata fileref="remmina_quickstart.png" width="40%"/>
      </imageobject>
      <imageobject role="html">
       <imagedata fileref="remmina_quickstart.png" width="40%"/>
      </imageobject>
     </mediaobject>
    </figure>
    <para>
     Wählen Sie das Kommunikationsprotokoll im Drop-down-Feld aus (z. B. „VNC“). Geben Sie dann die DNS-oder IP-Adresse des VNC-Servers ein, gefolgt von einem Doppelpunkt und einer Anzeigenummer, und bestätigen Sie mit <keycap function="enter"/>.
    </para>
   </sect3>
   <sect3>
    <title>Öffnen von gespeicherten Remote-Sitzungen</title>
    <para>
     Zum Öffnen einer bestimmten Remote-Sitzung doppelklicken Sie in der Sitzungsliste auf diese Sitzung.
    </para>
   </sect3>
   <sect3>
    <title>Fenster der Remote-Sitzungen</title>
    <para>
     Die Remote-Sitzungen werden in Registerkarten eines separaten Fensters geöffnet. Jede Registerkarte enthält eine Sitzung. Über die Symbolleiste links im Fenster können Sie die Fenster/Sitzungen verwalten, zum Beispiel den Vollbildmodus aktivieren/deaktivieren, die Fenstergröße an die Anzeigegröße der Sitzung anpassen, bestimmte Tastatureingaben an die Sitzung senden, Bildschirmfotos der Sitzung aufnehmen oder die Bildqualität festlegen.
    </para>
    <figure>
     <title>Remmina-Remote-Sitzung mit Anzeige</title>
     <mediaobject>
      <imageobject role="fo">
       <imagedata fileref="remmina_sle15inside.png" width="80%"/>
      </imageobject>
      <imageobject role="html">
       <imagedata fileref="remmina_sle15inside.png" width="80%"/>
      </imageobject>
     </mediaobject>
    </figure>
   </sect3>
  </sect2>

  <sect2 xml:id="vnc-remmina-edit-delete-clone">
   <title>Bearbeiten, Kopieren und Löschen gespeicherter Sitzungen</title>
   <para>
    Zum <emphasis>Bearbeiten</emphasis> einer gespeicherten Remote-Sitzung klicken Sie mit der rechten Maustaste im Hauptfenster von Remmina auf den Namen der Sitzung und wählen Sie <guimenu>Edit</guimenu>. Eine Beschreibung der relevanten Felder finden Sie unter <xref linkend="vnc-remmina-addnew"/>.
   </para>
   <para>
    Zum <emphasis>Kopieren</emphasis> einer gespeicherten Remote-Sitzung klicken Sie mit der rechten Maustaste im Hauptfenster von Remmina auf den Namen der Sitzung und wählen Sie <guimenu>Copy</guimenu>. Ändern Sie im Fenster <guimenu>Remote Desktop Preference</guimenu> den Name des Profils, passen Sie optional die relevanten Optionen an und bestätigen Sie mit <guimenu>Save</guimenu>.
   </para>
   <para>
    Zum <emphasis>Löschen</emphasis> einer gespeicherten Remote-Sitzung klicken Sie mit der rechten Maustaste im Hauptfenster von Remmina auf den Namen der Sitzung und wählen Sie <guimenu>Delete</guimenu>. Bestätigen Sie das nächste Dialogfeld mit <guimenu>Yes</guimenu>.
   </para>
  </sect2>

  <sect2 xml:id="vnc-remmina-cmdline">
   <title>Ausführen von Remote-Sitzungen über die Befehlszeile</title>
   <para>
    Mit der folgenden Syntax öffnen Sie eine Remote-Sitzung über die Befehlszeile oder aus einer Stapeldatei heraus, ohne zunächst das Hauptanwendungsfenster zu öffnen:
   </para>
<screen>
 <prompt>&gt; </prompt>remmina -c <replaceable>profile_name</replaceable>.remmina
</screen>
   <para>
    Die Profildateien von Remmina werden im Verzeichnis <filename>.local/share/remmina/</filename> in Ihrem Benutzerverzeichnis gespeichert. Zum Ermitteln der Profildatei für die zu öffnende Sitzung starten Sie Remmina und klicken Sie im Hauptfenster auf den Sitzungsnamen. Der Pfad zur Profildatei wird in der Statuszeile unten im Fenster angezeigt.
   </para>
   <figure>
    <title>Pfad zur Profildatei</title>
    <mediaobject>
     <imageobject role="fo">
      <imagedata fileref="remmina_status.png" width="50%"/>
     </imageobject>
     <imageobject role="html">
      <imagedata fileref="remmina_status.png" width="50%"/>
     </imageobject>
    </mediaobject>
   </figure>
   <para>
    Wenn Remmina nicht ausgeführt wird, können Sie den Namen der Profildatei durch einen aussagekräftigeren Dateinamen ersetzen (z. B. <filename>sle15.remmina</filename>). Sie können sogar die Profildatei in Ihr Benutzerverzeichnis kopieren und mit dem Befehl <command>remmina -c</command> direkt aus diesem Verzeichnis heraus ausführen.
   </para>
  </sect2>
 </sect1>
 
 <sect1 xml:id="sec-vnc-one-time">
  <title>Konfigurieren von einmaligen Sitzungen am VNC-Server</title>

  <para>
   Eine einmalige Sitzung wird vom Remote-Client initiiert. Sie startet einen grafischen Anmeldebildschirm auf dem Server. Auf diese Weise können Sie den Benutzer auswählen, der die Sitzung starten soll sowie, sofern vom Anmeldungsmanager unterstützt, die Desktop-Umgebung. Wenn Sie die Client-Verbindung, beispielsweise eine VNC-Sitzung, beenden, werden auch alle während der Sitzung gestarteten Anwendungen beendet. Einmalige VNC-Sitzungen können nicht freigegeben werden, Sie können jedoch mehrere Sitzungen gleichzeitig auf demselben Host ausführen.
  </para>

  <procedure xml:id="pro-vnc-one-time-activate">
   <title>Aktivieren von einmaligen VNC-Sitzungen</title>
   <step>
    <para>
     Starten Sie <menuchoice> <guimenu>YaST</guimenu> <guimenu>Netzwerkdienste</guimenu> <guimenu>Verwaltung von entfernten Rechnern aus (remote) (VNC)</guimenu>
     </menuchoice>.
    </para>
   </step>
   <step>
    <para>
     Aktivieren Sie die Option <guimenu>Allow Remote Administration Without Session Management</guimenu> (Verwaltung von entfernten Rechnern aus (remote) ohne Sitzungsverwaltung zulassen).
    </para>
   </step>
   <step>
    <para>
     Aktivieren Sie die Option <guimenu>Enable access using a web browser</guimenu> (Zugriff über Webbrowser aktivieren), wenn der Zugriff auf die VNC-Sitzung über einen Webbrowser-Fenster erfolgen soll.
    </para>
   </step>
   <step>
    <para>
     Aktivieren Sie bei Bedarf <guimenu>Firewall-Port öffnen</guimenu> (wenn Ihre Netzwerkschnittstelle z. B. so konfiguriert ist, dass sie in der externen Zone liegt). Wenn Sie mehrere Netzwerkschnittstellen haben, beschränken Sie das Öffnen der Firewall-Ports über <guimenu>Firewall-Details</guimenu> auf eine bestimmte Schnittstelle.
    </para>
   </step>
   <step>
    <para>
     Bestätigen Sie die Einstellungen mit <guimenu>Weiter</guimenu>.
    </para>
   </step>
   <step>
    <para>
     Falls zu dem Zeitpunkt noch nicht alle erforderlichen Pakete verfügbar sind, müssen Sie der Installation der fehlenden Pakete zustimmen.
    </para>
    <tip>
     <title>Neustart des Anzeigemanagers</title>
     <para>
      YaST nimmt Änderungen an den Einstellungen des Anzeigemanagers vor. Diese Änderungen treten erst dann in Kraft, wenn Sie sich aus der aktuellen grafischen Sitzung abmelden und den Anzeigemanager neu starten.
     </para>
    </tip>
   </step>
  </procedure>

  <figure>
   <title>Fernverwaltung</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="vnc_nosession.png" width="70%"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="vnc_nosession.png" width="70%"/>
    </imageobject>
   </mediaobject>
  </figure>

  <sect2 xml:id="sec-vnc-one-time-configs">
   <title>Verfügbare Konfigurationen</title>
   <para>
    Die Standardkonfiguration von <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> stellt Sitzungen mit einer Auflösung von 1024 x 768 Pixeln und einer Farbtiefe von 16 Bit bereit. Die Sitzungen sind an Port <systemitem class="resource">5901</systemitem> für <quote>reguläre</quote> VNC-Viewer (entspricht VNC-Display <literal>1</literal>) und an Port <systemitem class="resource">5801</systemitem> für Webbrowser verfügbar.
   </para>
   <para>
    Weitere Konfigurationen können an anderen Ports verfügbar gemacht werden<phrase os="sles;osuse">, siehe <xref linkend="sec-vnc-one-time-config"/></phrase>
   </para>
   <para>
    VNC-Anzeigenummern und X-Anzeigenummern sind bei einmaligen Sitzungen unabhängig. Eine VNC-Anzeigenummer wird manuell jeder Konfiguration zugewiesen, die vom Server unterstützt wird (:1 im obigen Beispiel). Immer, wenn eine VNC-Sitzung mit einer der Konfigurationen initiiert wird, erhält sie automatisch eine freie X-Display-Nummer.
   </para>
   <para>
    Standardmäßig versuchen sowohl der VNC-Client als auch der Server, über ein selbstsigniertes SSL-Zertifikat sicher zu kommunizieren, das nach der Installation erzeugt wird. Verwenden Sie wahlweise das Standardzertifikat oder ersetzen Sie es durch Ihr eigenes Zertifikat. Wenn Sie das selbstsignierte Zertifikat verwenden, müssen Sie vor dem ersten Herstellen einer Verbindung die Signatur bestätigen – sowohl im VNC-Viewer als auch im Webbrowser.
   </para>
  </sect2>

  <sect2 xml:id="sec-vnc-one-time-connect">
   <title>Initiieren einer einmaligen VNC-Sitzung</title>
   <para>
    Um eine Verbindung zu einer einmaligen VNC-Sitzung herzustellen, muss ein VNC-Viewer installiert sein, lesen Sie hierzu auch <xref linkend="sec-vnc-viewer"/>. Alternativ können Sie einen JavaScript-fähigen Webbrowser verwenden, um die VNC-Sitzung anzuzeigen. Geben Sie hierzu folgende URL ein: <literal>http://jupiter.example.com:5801</literal>.
   </para>
  </sect2>

  <sect2 xml:id="sec-vnc-one-time-config">
   <title>Konfigurieren einmaliger VNC-Sitzungen</title>
   <para>
    Sie können diesen Abschnitt überspringen, wenn Sie die Standardkonfiguration nicht ändern müssen bzw. möchten.
   </para>
   <para>
    Einmalige VNC-Sitzungen werden über den <systemitem class="daemon">systemd</systemitem>-Socket <systemitem>xvnc.socket</systemitem> gestartet. Standardmäßig bietet sie sechs Konfigurationsblöcke: drei für VNC-Viewer (<literal>vnc1</literal> bis <literal>vnc3</literal>) und drei für einen JavaScript-Client (<literal>vnchttpd1</literal> bis <literal>vnchttpd3</literal>). Standardmäßig sind nur <literal>vnc1</literal> und <literal>vnchttpd1</literal> aktiv.
   </para>
   <para>
    Mit dem folgenden Befehl aktivieren Sie den VNC-Server-Socket beim Booten:
   </para>
<screen><prompt>&gt; </prompt><command>sudo</command>  systemctl enable xvnc.socket</screen>
   <para>
    Mit dem folgenden Befehl starten Sie den Socket sofort:
   </para>
<screen><prompt>&gt; </prompt><command>sudo</command>  systemctl start xvnc.socket</screen>
   <para>
    Der <command>Xvnc</command>-Server kann mit der Option <literal>server_args</literal> konfiguriert werden. Eine Liste der Optionen finden Sie unter <command>Xvnc --help</command>.
   </para>
   <para>
    Achten Sie beim Hinzufügen benutzerdefinierter Konfigurationen darauf, keine Ports zu verwenden, die bereits von anderen Konfigurationen, anderen Services oder bestehenden permanenten VNC-Sitzungen auf demselben Host verwendet werden.
   </para>
   <para>
    Aktivieren Sie Konfigurationsänderungen mit folgendem Kommando:
   </para>
<screen><prompt>&gt; </prompt><command>sudo</command> systemctl reload xvnc.socket</screen>
   <important>
    <title>Firewall und VNC-Ports</title>
    <para>
     Wenn Sie die entfernte Verwaltung wie in <xref linkend="pro-vnc-one-time-activate"/> beschrieben aktivieren, werden die Ports <systemitem class="resource">5801</systemitem> und <systemitem class="resource">5901</systemitem> in der Firewall geöffnet. Wenn die Netzwerkschnittstelle, über die die VNC-Sitzung bereitgestellt wird, durch eine Firewall geschützt wird, müssen Sie die entsprechenden Ports manuell öffnen, wenn Sie zusätzliche Ports für VNC-Sitzungen aktivieren. Eine Anleitung dazu finden Sie unter <xref linkend="cha-security-firewall"/>.
    </para>
   </important>
  </sect2>
 </sect1>
 
 <sect1 xml:id="sec-vnc-persistent">
  <title>Konfigurieren von permanenten VNC-Serversitzungen</title>

  <para>
   Auf eine permanente Sitzung kann gleichzeitig von mehreren Clients zugegriffen werden. Dies eignet sich ideal für Demozwecke, bei denen ein Client den vollen Zugriff und alle anderen einen reinen Anzeigezugriff haben. Weiter eignet sich dies für Schulungssitzungen, bei denen der Schulungsleiter einen Zugriff auf den Desktop des Teilnehmers benötigt.
  </para>

  <tip xml:id="sec-vnc-persistent-connect">
   <title>Verbindung zu einer permanenten VNC-Sitzung herstellen</title>
   <para>
    Um eine Verbindung zu einer permanenten VNC-Sitzung herzustellen, muss ein VNC-Viewer installiert sein. Weitere Informationen finden Sie im <xref linkend="sec-vnc-viewer"/>. Alternativ können Sie einen JavaScript-fähigen Webbrowser verwenden, um die VNC-Sitzung anzuzeigen. Geben Sie hierzu folgende URL ein: <literal>http://jupiter.example.com:5801</literal>.
   </para>
  </tip>

  <para>
   Es gibt zwei Arten von permanenten VNC-Sitzungen:
  </para>

  <itemizedlist>
   <listitem>
    <para>
     <xref linkend="vnc-persistent-vncserver" xrefstyle="select:title"/>
    </para>
   </listitem>
   <listitem>
    <para>
     <xref linkend="vnc-persistent-vncmanager" xrefstyle="select:title"/>
    </para>
   </listitem>
  </itemizedlist>

  <sect2 xml:id="vnc-persistent-vncserver">
   <title>Mit <systemitem>vncserver</systemitem> initiierte VNC-Sitzung</title>
   <para>
    Diese Art einer permanenten VNC-Sitzung wird auf dem Server initiiert. Die Sitzung und sämtliche in dieser Sitzungsausführung gestarteten Anwendungen werden ungeachtet der Client-Verbindungen so lange ausgeführt, bis die Sitzung beendet wird. Der Zugriff auf permanente Sitzungen wird durch zwei mögliche Arten von Passwörtern geschützt:
   </para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>
      ein reguläres Passwort, das den vollen Zugriff ermöglicht, oder
     </para>
    </listitem>
    <listitem>
     <para>
      ein optionales Passwort, das keinen interaktiven Zugriff ermöglicht und nur eine Anzeige liefert.
     </para>
    </listitem>
   </itemizedlist>
   <para>
    Eine Sitzung kann mehrere Client-Verbindungen beider Arten gleichzeitig haben.
   </para>
   <procedure xml:id="pro-vnc-persistent-activate">
    <title>Starten einer permanenten VNC-Sitzung mit <command>vncserver</command></title>
    <step>
     <para>
      Öffnen Sie eine Shell uns stellen Sie sicher, dass Sie als der Benutzer angemeldet sind, der Eigentümer der VNC-Sitzung sein soll.

     </para>
    </step>
    <step>
     <para>
      Wenn die Netzwerkschnittstelle, über die die VNC-Sitzung bereitgestellt wird, durch eine Firewall geschützt wird, müssen Sie die von Ihrer Sitzung verwendeten Ports manuell in der Firewall öffnen. Wenn Sie mehrere Sitzungen starten, können Sie alternativ einen Portbereich öffnen. Details zur Konfiguration der Firewall finden Sie im <xref linkend="cha-security-firewall"/>.
     </para>
     <para>
      <command>vncserver</command> verwendet die Port <systemitem class="resource">5901</systemitem> für Display <literal>:1</literal>, <systemitem class="resource">5902</systemitem> für Display <literal>:2</literal> usw. Bei permanenten Sitzungen haben das VNC-Display und das X-Display normalerweise dieselbe Nummer.
     </para>
    </step>
    <step>
     <para>
      Geben Sie folgendes Kommando ein, um eine Sitzung mit einer Auflösung von 1024x768 Pixel und einer Farbtiefe von 16 Bit zu starten:
     </para>
<screen>vncserver -alwaysshared -geometry 1024x768 -depth 16</screen>
     <para>
      Das Kommando <command>vncserver</command> verwendet, sofern keine Display-Nummer angegeben ist, eine freie Display-Nummer und gibt seine Auswahl aus. Weitere Optionen finden Sie mit <command>man 1 vncserver</command>.
     </para>
    </step>
   </procedure>
   <para>
    Bei der erstmaligen Ausführung von <command>vncserver</command> wird nach einem Passwort für den vollständigen Zugriff auf die Sitzung gefragt. Geben Sie gegebenenfalls auch ein Passwort für den reinen Anzeigezugriff auf die Sitzung ein.
   </para>
   <para>
    Die hier angegebenen Passwörter werden auch für zukünftige Sitzungen verwendet, die durch denselben Benutzer gestartet werden. Sie können mit dem Kommando <command>vncpasswd</command> geändert werden.
   </para>
   <important>
    <title>Sicherheitsüberlegungen</title>
    <para>
     Achten Sie darauf, dass Ihre Passwörter sicher und ausreichend lang sind (mindestens acht Zeichen). Teilen Sie diese Passwörter niemandem mit. 
    </para>
   </important>
   <para>
    Beenden Sie, um die Sitzung zu beenden, die Desktopumgebung, die innerhalb der VNC-Sitzung ausgeführt wird über den VNC-Viewer so, wie Sie eine normale lokale X-Sitzung beenden würden. 
   </para>
   <para>
    Wenn Sie eine Sitzung lieber manuell beenden, öffnen Sie eine Shell auf dem VNC-Server und vergewissern Sie sich, dass Sie als der Benutzer angemeldet ist, der der Eigentümer der zu beendenden VNC-Sitzung ist. Führen Sie das folgende Kommando aus, um die Sitzung zu beenden, die auf Display <literal>:1</literal>: <command>vncserver -kill :1</command> ausgeführt wird.
   </para>
   <sect3 xml:id="sec-vnc-persistent-configure">
    <title>Konfigurieren von permanenten VNC-Sitzungen</title>
    <para>
     Permanente VNC-Sitzungen können durch Bearbeiten von <filename>$HOME/.vnc/xstartup</filename> konfiguriert werden. Standardmäßig startet dieses Shell-Skript dieselbe GUI bzw. denselben Fenstermanager, aus dem es gestartet wurde. In <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> ist dies entweder GNOME oder IceWM. Wenn Sie beim Starten Ihrer Sitzung einen bestimmten Fenstermanager verwenden möchten, legen Sie die Variable <envar>WINDOWMANAGER</envar> fest:
    </para>
<screen>WINDOWMANAGER=gnome vncserver -geometry 1024x768
WINDOWMANAGER=icewm vncserver -geometry 1024x768</screen>
    <note>
     <title>Eine Konfiguration pro Benutzer</title>
     <para>
      Permanente VNC-Sitzungen werden jeweils nur einmal pro Benutzer konfiguriert. Mehrere von demselben Benutzer gestartete Sitzungen verwenden alle dieselben Start- und Passwortdateien.
     </para>
    </note>
   </sect3>
  </sect2>

  <sect2 xml:id="vnc-persistent-vncmanager">
   <title>Mit <systemitem>vncmanager</systemitem> initiierte VNC-Sitzung</title>
   <para/>
   <procedure xml:id="vnc-persistent-vncmanager-enable">
    <title>Aktivieren von permanenten VNC-Sitzungen</title>
    <step>
     <para>
      Starten Sie <menuchoice> <guimenu>YaST</guimenu> <guimenu>Netzwerkdienste</guimenu> <guimenu>Verwaltung von entfernten Rechnern aus (remote) (VNC)</guimenu>
      </menuchoice>.
     </para>
    </step>
    <step>
     <para>
      Aktivieren Sie die Option <guimenu>Allow Remote Administration With Session Management</guimenu> (Verwaltung von entfernten Rechnern aus (remote) mit Sitzungsverwaltung zulassen).
     </para>
    </step>
    <step>
     <para>
      Aktivieren Sie die Option <guimenu>Enable access using a web browser</guimenu> (Zugriff über Webbrowser aktivieren), wenn der Zugriff auf die VNC-Sitzung über ein Webbrowser-Fenster erfolgen soll.
     </para>
    </step>
    <step>
     <para>
      Aktivieren Sie bei Bedarf <guimenu>Firewall-Port öffnen</guimenu> (wenn Ihre Netzwerkschnittstelle z. B. so konfiguriert ist, dass sie in der externen Zone liegt). Wenn Sie mehrere Netzwerkschnittstellen haben, beschränken Sie das Öffnen der Firewall-Ports über <guimenu>Firewall-Details</guimenu> auf eine bestimmte Schnittstelle.
     </para>
    </step>
    <step>
     <para>
      Bestätigen Sie die Einstellungen mit <guimenu>Weiter</guimenu>.
     </para>
    </step>
    <step>
     <para>
      Falls zu dem Zeitpunkt noch nicht alle erforderlichen Pakete verfügbar sind, müssen Sie der Installation der fehlenden Pakete zustimmen.
     </para>
     <tip>
      <title>Neustart des Anzeigemanagers</title>
      <para>
       YaST nimmt Änderungen an den Einstellungen des Anzeigemanagers vor. Diese Änderungen treten erst dann in Kraft, wenn Sie sich aus der aktuellen grafischen Sitzung abmelden und den Anzeigemanager neu starten.
      </para>
     </tip>
    </step>
   </procedure>
   <sect3 xml:id="vnc-persistent-vncmanager-configure">
    <title>Konfigurieren von permanenten VNC-Sitzungen</title>
    <para>
     Sobald Sie die VNC-Sitzungsverwaltung gemäß <xref linkend="vnc-persistent-vncmanager-enable"/> aktiviert haben, können Sie wie gewohnt eine Verbindung zur Remote-Sitzung über den VNC-Viewer herstellen, z. B. <command>vncviewer</command> oder Remmina. Der Anmeldebildschirm wird geöffnet. Nach erfolgter Anmeldung wird das VNC-Symbol in der Taskleiste der Desktop-Umgebung angezeigt. Zum Öffnen des Fensters <guimenu>VNC-Sitzung</guimenu> klicken Sie auf das Symbol. Falls das Fenster nicht geöffnet wird oder Ihre Desktop-Umgebung keine Symbole in der Task-Leiste unterstützt, führen Sie <command>vncmanager-controller</command> manuell aus.
    </para>
    <figure>
     <title>VNC-Sitzungseinstellungen</title>
     <mediaobject>
      <imageobject role="fo">
       <imagedata fileref="vncmanager_session.png" width="85%"/>
      </imageobject>
      <imageobject role="html">
       <imagedata fileref="vncmanager_session.png" width="85%"/>
      </imageobject>
     </mediaobject>
    </figure>
    <para>
     Verschiedene Einstellungen beeinflussen das Verhalten der VNC-Sitzung:
    </para>
    <variablelist>
     <varlistentry>
      <term><guimenu>Nicht persistent, privat</guimenu>
      </term>
      <listitem>
       <para>
        Dies entspricht einer einmaligen Sitzung. Diese ist für andere nicht sichtbar und wird beendet, sobald Sie die Verbindung zur Sitzung trennen. Weitere Informationen finden Sie unter <xref linkend="sec-vnc-one-time"/>.
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term><guimenu>Permanent, sichtbar</guimenu>
      </term>
      <listitem>
       <para>
        Die Sitzung ist für andere Benutzer sichtbar und wird weiter ausgeführt, auch wenn Sie die Verbindung zur Sitzung trennen.
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term><guimenu>Name der Sitzung</guimenu>
      </term>
      <listitem>
       <para>
        Geben Sie den Namen der permanenten Sitzung an, sodass sie beim Wiederherstellen der Verbindung eindeutig erkennbar ist.
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term><guimenu>Kein Passwort erforderlich</guimenu>
      </term>
      <listitem>
       <para>
        Die Sitzung ist frei zugänglich, ohne dass die Benutzer sich mit ihrem Berechtigungsnachweis anmelden müssen.
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term><guimenu>Benutzeranmeldung erforderlich</guimenu>
      </term>
      <listitem>
       <para>
        Zum Zugriff auf die Sitzung müssen Sie sich mit einem gültigen Benutzernamen und Passwort anmelden. Die gültigen Benutzernamen werden im Textfeld <guimenu>Zulässige Benutzer</guimenu> angezeigt.
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term><guimenu>Nur jeweils einen Client zulassen</guimenu>
      </term>
      <listitem>
       <para>
        Mehrere Benutzer können nicht gleichzeitig der permanenten Sitzung beitreten.
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term><guimenu>Mehrere Clients gleichzeitig zulassen</guimenu>
      </term>
      <listitem>
       <para>
        Mehrere Benutzer können gleichzeitig der permanenten Sitzung beitreten. Nützlich für Remote-Präsentationen oder Schulungssitzungen.
       </para>
      </listitem>
     </varlistentry>
    </variablelist>
    <para>
     Bestätigen Sie Ihre Auswahl mit <guimenu>OK</guimenu>.
    </para>
   </sect3>
   <sect3 xml:id="vnc-persistent-vncmanager-join">
    <title>Beitreten zu permanenten VNC-Sitzungen</title>
    <para>
     Sobald Sie eine permanente VPC-Sitzung gemäß <xref linkend="vnc-persistent-vncmanager-configure"/> eingerichtet haben, können Sie dieser Sitzung über den VNC-Viewer beitreten. Nachdem der VNC-Client eine Verbindung zum Server aufgebaut hat, werden Sie gefragt, ob Sie eine neue Sitzung erstellen oder der bestehenden Sitzung beitreten möchten:
    </para>
    <figure>
     <title>Beitreten zu einer permanenten VNC-Sitzung</title>
     <mediaobject>
      <imageobject role="fo">
       <imagedata fileref="vncmanager_whether.png" width="80%"/>
      </imageobject>
      <imageobject role="html">
       <imagedata fileref="vncmanager_whether.png" width="80%"/>
      </imageobject>
     </mediaobject>
    </figure>
    <para>
     Wenn Sie auf den Namen der bestehenden Sitzung klicken, werden Sie ggf. aufgefordert, Ihren Berechtigungsnachweis anzugeben, abhängig von den Einstellungen für die dauerhafte Sitzung.
    </para>
   </sect3>
  </sect2>
 </sect1>
 
 <sect1 xml:id="sec-vnc-encrypt">
  <title>Konfigurieren der Verschlüsselung am VNC-Server</title>

  <para>
   Wenn der VNC-Server ordnungsgemäß eingerichtet ist, wird die gesamte Kommunikation zwischen dem VNC-Server und dem Client verschlüsselt. Die Authentifizierung wird zu Beginn der Sitzung vorgenommen. Die eigentliche Datenübertragung beginnt erst danach.
  </para>

  <para>
   Die Sicherheitsoptionen für einmalige und für permanente VNC-Sitzungen werden mit dem Parameter <option>-securitytypes</option> des Befehls <command>/usr/bin/Xvnc</command> in der Zeile <literal>server_args</literal> konfiguriert. Der Parameter <option>-securitytypes</option> bestimmt sowohl die Authentifizierungsmethode als auch die Verschlüsselung. Hier stehen die folgenden Optionen zur Auswahl:
  </para>

  <variablelist>
   <title>Authentifizierungen</title>
   <varlistentry>
    <term>None, TLSNone, x509None</term>
    <listitem>
     <para>
      Keine Authentifizierung.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>VncAuth, TLSVnc, x509Vnc</term>
    <listitem>
     <para>
      Authentifizierung mit benutzerdefiniertem Passwort.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Plain, TLSPlain, x509Plain</term>
    <listitem>
     <para>
      Authentifizierung mit Überprüfung des Benutzerpassworts mit PAM.
     </para>
    </listitem>
   </varlistentry>
  </variablelist>

  <variablelist>
   <title>Verschlüsselungen</title>
   <varlistentry>
    <term>None, vncAuth, Plain</term>
    <listitem>
     <para>
      Keine Verschlüsselung.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>TLSNone, TLSVnc, TLSPlain</term>
    <listitem>
     <para>
      Anonyme TLS-Verschlüsselung. Alle Angaben werden verschlüsselt; auf dem Remote-Host erfolgt jedoch keine Überprüfung. Damit sind Sie gegen passive Angreifer geschützt, nicht jedoch gegen Man-in-the-Middle-Angreifer.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>x509None, x509Vnc, x509Plain</term>
    <listitem>
     <para>
      TLS-Verschlüsselung mit Zertifikat. Wenn Sie ein selbstsigniertes Zertifikat heranziehen, werden Sie bei der ersten Verbindung aufgefordert, dieses Zertifikat zu bestätigen. Bei weiteren Verbindungen erhalten Sie nur dann eine Warnung, wenn das Zertifikat geändert wurde. So sind Sie gegen alle Angreifer geschützt, ausgenommen Man-in-the-Middle-Angreifer bei der ersten Verbindung (ähnlich wie bei der typischen SSH-Verwendung). Wenn Sie ein Zertifikat heranziehen, das von einer Zertifizierungsstelle signiert wurde und das mit dem Computernamen übereinstimmt, erzielen Sie praktisch uneingeschränkte Sicherheit (ähnlich wie bei der typischen HTTPS-Verwendung).
     </para>
     <tip>
      <title>Pfad zum Zertifikat und zum Schlüssel</title>
      <para>
       Bei der X509-gestützten Verschlüsselung müssen Sie den Pfad zum X509-Zertifikat/-Schlüssel mit den Optionen <option>-X509Cert</option> und <option>-X509Key</option> angeben.
      </para>
     </tip>
    </listitem>
   </varlistentry>
  </variablelist>

  <para>
   Wenn Sie mehrere Sicherheitstypen angeben (jeweils durch Komma getrennt), wird der erste Typ herangezogen, der sowohl vom Client als auch vom Server unterstützt wird. So können Sie die opportunistische Verschlüsselung auf dem Server konfigurieren. Dies ist von Nutzen, wenn VNC-Clients unterstützt werden sollen, die ihrerseits keine Verschlüsselung unterstützen.
  </para>

  <para>
   Auf dem Client können Sie außerdem die zulässigen Sicherheitstypen angeben, sodass ein Downgrade-Angriff vermieden wird, wenn Sie eine Verbindung zu einem Server herstellen, auf dem bekanntermaßen die Verschlüsselung aktiviert ist. (Der VNC-Viewer zeigt in diesem Fall allerdings die Meldung „Verbindung nicht verschlüsselt!“ ).
  </para>
 </sect1>
</chapter>
