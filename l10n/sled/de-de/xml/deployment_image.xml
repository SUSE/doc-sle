<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="deployment_image.xml" version="5.0" role="General" xml:id="cha-deployment-clone-image">
 <title>Klonen von Festplatten-Images</title>
 <info>
  <abstract>
   <para>
    In diesem Kapitel wird beschrieben, wie Sie <phrase role="productname"><phrase os="sled">SUSE Linux Enterprise Desktop</phrase></phrase> anhand von geklonten Images installieren. Diese Vorgehensweise wird meist in virtualisierten Umgebungen herangezogen.
   </para>
  </abstract>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:bugtracker/>
   <dm:translation>yes</dm:translation>
  </dm:docmanager>
 </info>
 <sect1 xml:id="sec-deployment-clone-image-overview">
  <title>Übersicht</title>
  <para>
   <phrase role="productname"><phrase os="sled">SUSE Linux Enterprise Desktop</phrase></phrase> bietet für jede Installation ein individuelles Skript zum Bereinigen der Konfiguration. Seit der Einführung von <systemitem class="daemon">systemd</systemitem> werden eindeutige Systemkennungen herangezogen und in verschiedenen Bereichen und Dateien festgelegt. Es wird daher nicht mehr empfohlen, System-Images durch Klonen anzulegen. Die Images können mit KIWI erstellt werden (siehe <link xlink:href="https://doc.suse.com/kiwi/"/>).
  </para>
  <para>
   Weitere Informationen zum Klonen von Computer-Festplatten finden Sie in der Dokumentation zur Virtualisierungsumgebung.
  </para>
 </sect1>
 <sect1 xml:id="sec-deployment-clone-image-clean">
  <title>Bereinigen von eindeutigen Systemkennungen</title>
  <warning>
   <title>Verlust wichtiger Konfigurationen</title>
   <para>
    Mit dem nachfolgenden Verfahren werden wichtige Systemkonfigurationsdaten dauerhaft gelöscht. Falls das Quellsystem für den Klon in der Produktionsumgebung eingesetzt wird, führen Sie das Bereinigungsskript für das geklonte Image aus.
   </para>
  </warning>
  <para>
   Mit dem nachfolgenden Verfahren können Sie alle eindeutigen Systemkennungen bereinigen, wahlweise vor oder nach dem Klonen eines Festplatten-Images. Wenn dieses Verfahren auf dem Klon ausgeführt werden soll, muss es auf allen Klonen ausgeführt werden. Es wird daher empfohlen, ein <literal>Gold-Image</literal> zu erstellen, das nicht in der Produktion verwendet wird und lediglich als Quelle für neue Klone fungiert. Das Gold-Image ist bereits bereinigt und die Klone können sofort verwendet werden.
  </para>
  <para>
   Beispielsweise wird mit dem Kommando <command>clone-master-clean-up</command> Folgendes entfernt:
  </para>
  <itemizedlist>
   <listitem>
    <para>Swap-Dateien</para>
   </listitem>
   <listitem>
    <para>Zypper-Repositorys</para>
   </listitem>
   <listitem>
    <para>SSH-Host- und Client-Schlüssel</para>
   </listitem>
   <listitem>
    <para>Temporäre Verzeichnisse wie <filename>/tmp/*</filename></para>
   </listitem>
   <listitem>
    <para>Postfix-Daten</para>
   </listitem>
   <listitem>
    <para>HANA-Firewall-Skript</para>
   </listitem>
   <listitem>
    <para>systemd-Journal</para>
   </listitem>
  </itemizedlist>
  <procedure>
   <step>
    <para>
     Starten Sie <command>zypper</command> und installieren Sie <package>clone-master-clean-up</package>:
    </para>
    <screen><prompt>&gt; </prompt><command>sudo</command> <command>zypper</command> install clone-master-clean-up</screen>
   </step>
   <step>
    <para>
     Konfigurieren Sie das Verhalten von <command>clone-master-clean-up</command> in der Datei <filename>/etc/sysconfig/clone-master-clean-up</filename>. Diese Konfigurationsdatei gibt an, ob Benutzer mit einer UID größer 1.000, die Datei <filename>/etc/sudoers</filename>, die Software-Repositorys für die Paketinstallation sowie die Btrfs-Snapshots entfernt werden sollen.
    </para>
   </step>
   <step>
    <para>
     Entfernen Sie die vorhandene Konfiguration und die eindeutigen Kennungen mit dem folgenden Skript:
    </para>
    <screen><prompt>&gt; </prompt><command>sudo</command> <command>clone-master-clean-up</command></screen>
   </step>
  </procedure>
 </sect1>
</chapter>
