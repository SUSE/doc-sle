<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="deployment_auto.xml" version="5.0" xml:id="cha.deployment.autoinst">
 <title>自动安装</title>
 <info>
      <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
        <dm:bugtracker>
        </dm:bugtracker>
        <dm:translation>yes</dm:translation>
      </dm:docmanager>
    </info>
    <para>
  AutoYaST 使您可以在许多计算机上并行安装 SUSE® Linux Enterprise。AutoYaST 在使部署适应异构硬件方面具有很大灵活性。本章讲述如何准备简单的自动安装并勾勒出包含不同硬件类型和安装目的的高级方案。
 </para>
 <sect1 xml:id="sec.deployment.autoinst.simple">
  <title>简单的大规模安装</title>

  <important>
   <title>相同硬件</title>
   <para>
    此方案假设您要将 SUSE Linux Enterprise 部署到一组具有完全相同硬件配置的计算机上。
   </para>
  </important>

  <para>
   要准备 AutoYaST 大规模安装，请执行以下操作：
  </para>

  <procedure>
   <step>
    <para>
     如<xref linkend="sec.deployment.autoinst.simple.profile"/>中所述创建 AutoYaST 配置文件，该配置文件包含您的部署所需的安装细节。
    </para>
   </step>
   <step>
    <para>
     如<xref linkend="sec.deployment.autoinst.simple.dist"/>中所述，确定 AutoYaST 配置文件的来源以及要传递到安装例程的参数。
    </para>
   </step>
   <step>
    <para>
     如<xref linkend="sec.deployment.autoinst.simple.source"/>所述确定 SUSE Linux Enterprise 安装数据源。
    </para>
   </step>
   <step>
    <para>
     如<xref linkend="sec.deployment.autoinst.simple.boot"/>中所述确定并设置自动安装引导方案。
    </para>
   </step>
   <step>
    <para>
     如<xref linkend="sec.deployment.autoinst.simple.info"/>所述，通过手动添加参数或创建 <filename>info</filename> 文件，将命令行传递到安装例程。
    </para>
   </step>
   <step>
    <para>
     如<xref linkend="sec.deployment.autoinst.simple.install"/>中所述，启动自动安装进程。
    </para>
   </step>
  </procedure>

  <sect2 xml:id="sec.deployment.autoinst.simple.profile">
   <title>创建 AutoYaST 配置文件</title>
   <para>
    AutoYaST 配置文件告诉 AutoYaST 安装什么以及如何配置已安装系统以最终获得完整的现成系统。可以用几种不同方式创建：
   </para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>
      从参考计算机将新安装复制到一组相同的计算机
     </para>
    </listitem>
    <listitem>
     <para>
      使用 AutoYaST GUI 创建并修改配置文件，使其符合您的要求
     </para>
    </listitem>
    <listitem>
     <para>
      使用 XML 编辑器，从头开始创建配置文件
     </para>
    </listitem>
   </itemizedlist>
   <para>
    要复制新的参考安装，请执行以下操作：
   </para>
   <procedure>
    <step>
     <para>
      按<xref linkend="cha.inst"/>中所述启动常规安装，并根据您的需求配置系统。在<guimenu>安装设置</guimenu>屏幕中（<xref linkend="sec.i.yast2.proposal"/>），选择<guimenu>克隆系统配置</guimenu>并激活<guimenu>将 AutoYaST 配置文件写入 /root/autoinst.xml</guimenu>。
     </para>
    </step>
    <step>
     <para>
      <filename>/root/autoinst.xml</filename> 中将会创建一个即时可用的配置文件。该配置文件可用于创建此特定安装的克隆。
     </para>
    </step>
   </procedure>
   <para>
    要使用 AutoYaST GUI 从现有的系统配置创建配置文件并对其进行符合您的需要的修改，请执行以下操作：
   </para>
   <procedure>
    <step>
     <para>
      作为 <systemitem class="username">root</systemitem>，启动 YaST。
     </para>
    </step>
    <step>
     <para>
      选择<menuchoice><guimenu>其他</guimenu><guimenu>自动安装</guimenu></menuchoice>来启动图形 AutoYaST 前端。
     </para>
    </step>
    <step>
     <para>
      选择<menuchoice><guimenu>工具</guimenu> <guimenu>创建参考配置文件</guimenu></menuchoice>，让 AutoYaST 准备为当前的系统配置创建 AutoYaST 配置文件镜像。
     </para>
    </step>
    <step>
     <para>
      除了默认资源（如引导加载程序、分区和软件选择）之外，可以通过选中<guimenu>创建参考控制文件</guimenu>列表内的项目，将系统的各种其他方面添加到配置文件。
     </para>
    </step>
    <step>
     <para>
      单击<guimenu>创建</guimenu>使 YaST 收集所有系统信息并将其写到新配置文件。
     </para>
    </step>
    <step>
     <para>
      要继续，请选择下列操作之一：
     </para>
     <itemizedlist mark="bullet" spacing="normal">
      <listitem>
       <para>
        如果配置文件已完成且符合您的要求，请选择<menuchoice><guimenu>文件</guimenu> <guimenu>另存为</guimenu></menuchoice>，然后为配置文件输入文件名，例如 <filename>autoinst.xml</filename>。
       </para>
      </listitem>
      <listitem>
       <para>
        从树视图向左选择适当的配置内容（如<quote>硬件/打印机</quote>）并单击<guimenu>配置</guimenu>来修改参考配置文件。相应的 YaST 模块启动，但您的设置被写入 AutoYaST 配置文件而不是应用到系统。完成之后，选择<menuchoice><guimenu>文件</guimenu><guimenu>另存为</guimenu></menuchoice>并输入适当的配置文件名。
       </para>
      </listitem>
     </itemizedlist>
    </step>
    <step>
     <para>
      选择<menuchoice><guimenu>文件</guimenu> <guimenu>退出</guimenu></menuchoice>退出 AutoYaST 模块。
     </para>
    </step>
   </procedure>
   <figure>
    <title>用 AutoYaST 前端编辑 AutoYaST 配置文件</title>
    <mediaobject>
     <imageobject role="fo">
      <imagedata fileref="autoyast_gui.png" width="75%" format="PNG"/>
     </imageobject>
     <imageobject role="html">
      <imagedata fileref="autoyast_gui.png" width="75%" format="PNG"/>
     </imageobject>
    </mediaobject>
   </figure>
  </sect2>

  <sect2 xml:id="sec.deployment.autoinst.simple.dist">
   <title>分发配置文件和确定 AutoYaST 参数</title>
   <para>
    AutoYaST 配置文件可以以几种不同的方式分发。根据分发配置文件数据所用的协议，不同的 AutoYaST 参数用来将配置文件的位置告知客户端上的安装例程。配置文件的位置可以通过引导提示或引导后装载的 <filename>info</filename> 文件传递到安装例程。下列选项可用：
   </para>
   <informaltable>
    <tgroup cols="3">
     <thead>
      <row>
       <entry>
        <para>
         配置文件位置
        </para>
       </entry>
       <entry>
        <para>
         参数
        </para>
       </entry>
       <entry>
        <para>
         描述
        </para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row>
       <entry>
        <para>
         文件
        </para>
       </entry>
       <entry>
        <para>
         <filename>autoyast=file://<replaceable>路径</replaceable></filename>
        </para>
       </entry>
       <entry>
        <para>
         使安装例程在指定路径（相对于来源根目录，如果是在 CD-ROM 顶层目录中，则为 <filename>file:///autoinst.xml</filename>）中查找控制文件。
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         设备
        </para>
       </entry>
       <entry>
        <para>
         <filename>autoyast=device://<replaceable>路径</replaceable></filename>
        </para>
       </entry>
       <entry>
        <para>
         使安装例程在储存设备上查找该控制文件。只需要设备名 — 如果 <filename>/dev/sda1</filename> 是错误的，则使用 <filename>sda1</filename>。
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         NFS
        </para>
       </entry>
       <entry>
        <para>

         <filename>autoyast=nfs://<replaceable>服务器</replaceable>/<replaceable>路径</replaceable></filename>
        </para>
       </entry>
       <entry>
        <para>
         使安装路由从 NFS 服务器上检索控制文件。
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         HTTP
        </para>
       </entry>
       <entry>
        <para>

         <filename>autoyast=http://<replaceable>服务器</replaceable>/<replaceable>路径</replaceable></filename>
        </para>
       </entry>
       <entry>
        <para>
         使安装例程从 HTTP 服务器上检索控制文件。
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         HTTPS
        </para>
       </entry>
       <entry>
        <para>

         <filename>autoyast=https://<replaceable>服务器</replaceable>/<replaceable>路径</replaceable></filename>
        </para>
       </entry>
       <entry>
        <para>
         使安装例程从 HTTPS 服务器上检索控制文件。
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         TFTP
        </para>
       </entry>
       <entry>
        <para>

         <filename>autoyast=tftp://<replaceable>服务器</replaceable>/<replaceable>路径</replaceable></filename>
        </para>
       </entry>
       <entry>
        <para>
         使安装例程从 TFTP 服务器上检索控制文件。
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         FTP
        </para>
       </entry>
       <entry>
        <para>

         <filename>autoyast=ftp://<replaceable>服务器</replaceable>/<replaceable>路径</replaceable></filename>
        </para>
       </entry>
       <entry>
        <para>
         使安装例程从 FTP 服务器上检索控制文件。
        </para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
   <para>
    用与实际安装匹配的值来替代<replaceable>服务器</replaceable>和<replaceable>路径</replaceable>。
   </para>
   <para>
    AutoYaST 包含一项功能，可以使某些配置文件绑定到客户端的 MAC 地址。无需改变 <option>autoyast=</option> 参数就可以同一安装过程使用不同配置文件安装不同的实例。
   </para>
   <para>
    要使用此功能，请执行以下操作：
   </para>
   <procedure>
    <step>
     <para>
      使用客户端的 MAC 地址作为文件名来创建不同配置文件，并将其放置到存放您的 AutoYaST 配置文件的 HTTP 服务器上。
     </para>
    </step>
    <step>
     <para>
      在创建 <option>autoyast=</option> 参数时应省略包含文件名的确切路径，例如：
     </para>
<screen>autoyast=tftp://192.168.1.115/</screen>
    </step>
    <step>
     <para>
      启动自动安装。
     </para>
    </step>
   </procedure>
   <para>
    YaST 尝试以下列方式确定配置文件位置：
   </para>
   <orderedlist spacing="normal">
    <listitem>
     <para>
      YaST 使用自身的 IP 地址（以大写十六进制的方式）搜索配置文件，例如，<literal>192.0.2.91</literal> 是 <literal>C000025B</literal>。
     </para>
    </listitem>
    <listitem>
     <para>
      如果该文件没有找到，YaST 将删除一个十六进制数字并重新进行尝试。这种做法将重复 8 次，直至找到具有正确文件名的文件。
     </para>
    </listitem>
    <listitem>
     <para>
      如果仍然不成功，它将尝试用客户端的 MAC 地址作为文件名来查找文件。例如，客户端的 MAC 地址是 <literal>0080C8F6484C</literal>。
     </para>
    </listitem>
    <listitem>
     <para>
      如果以 MAC 地址命名的文件没有找到，YaST 将搜索名为 <filename>default</filename> （小写）的文件。YaST 用以搜索 AutoYaST 配置文件的示例地址顺序如下：
     </para>
<screen>
C000025B 
C000025 
C00002 
C0000 
C000 
C00 
C0 
C 
0080C8F6484C 
default
     </screen>
    </listitem>
   </orderedlist>
  </sect2>

  <sect2 xml:id="sec.deployment.autoinst.simple.source">
   <title>提供安装数据</title>
   <para>
    安装数据以产品 CD 或 DVD 方式提供或使用网络安装源提供。如果将产品 CD 用作安装源，则需要对客户端进行物理访问来完成安装，因为引导进程需要手动启动，CD 需要更换。
   </para>
   <para>
    要提供网络上的安装源，请如<xref linkend="sec.deployment.remoteinst.instserver.sles9"/>所述设置网络安装服务器（HTTP、NFS、FTP）。使用 <filename>info</filename> 文件将服务器位置传递到安装例程。
   </para>
  </sect2>

  <sect2 xml:id="sec.deployment.autoinst.simple.boot">
   <title>设置引导方案</title>
   <para>
    客户端可以用以下几种不同的方式引导：
   </para>
   <variablelist>
    <varlistentry>
     <term>网络引导</term>
     <listitem>
      <para>
       关于常规远程安装，可以使用“网络唤醒”和 PXE 启动自动安装，通过 TFTP 导入引导映像和控制文件并从任意网络安装服务器选择安装源。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>可引导 CD-ROM</term>
     <listitem>
      <para>
       您可以使用原始 SUSE Linux Enterprise 媒体引导系统以进行自动安装，再从网络位置或可卸磁盘导入控制文件。或者，创建自定义 CD-ROM，存放安装源和 AutoYaST 配置文件。
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
   <para>
    以下几节简要叙述网络引导或 CD-ROM 引导的基本程序。
   </para>
   <sect3 xml:id="sec.deployment.autoinst.simple.boot.pxe">
    <title>准备网络引导</title>
    <para>
     中讨论了如何使用“网络唤醒”、PXE 和 TFTP 进行网络引导。<xref linkend="sec.deployment.remoteinst.scenario.vncpxe"/> 要使用已介绍的步骤进行自动安装，请修改起重要作用的 PXE Linux 配置文件 (<filename>/srv/tftp/pxelinux.cfg/default</filename>)，以使其包含指向 AutoYaST 配置文件位置的 <literal>autoyast</literal> 参数。标准安装的示例项如下：
    </para>
<screen>
default linux 

# default label linux 
    kernel linux
    append initrd=initrd install=http://192.168.1.115/install/suse-enterprise/ 
	  
	</screen>
    <para>
     自动安装的相同示例如下：
    </para>
<screen>
default linux 

# default label linux 
    kernel linux
    append initrd=initrd install=http://192.168.1.115/install/suse-enterprise/ \
           autoyast=nfs://192.168.1.110/profiles/autoinst.xml
	</screen>
    <para>
     用安装中使用的数据替代示例 IP 地址和路径。
    </para>
   </sect3>
   <sect3 xml:id="sec.deployment.autoinst.simple.boot.cd">
    <title>准备从 CD-ROM 引导</title>
    <para>
     AutoYaST 安装中可以使用几种从 CD-ROM 引导的方法。请从下列方案中选择：
    </para>
    <variablelist>
     <varlistentry>
      <term>从 SUSE Linux Enterprise 媒体引导，通过网络获取配置文件</term>
      <listitem>
       <para>
        如果完全基于网络的方案不可能执行（例如，如果硬件不支持 PXE），则使用此方法，您可以对在几乎整个过程中安装的系统进行物理访问。
       </para>
       <para>
        需要对包含每：
       </para>
       <itemizedlist mark="bullet" spacing="normal">
        <listitem>
         <para>
          SUSE Linux Enterprise 媒体
         </para>
        </listitem>
        <listitem>
         <para>
          提供配置文件数据的网络服务器（详见<xref linkend="sec.deployment.autoinst.simple.dist"/>）
         </para>
        </listitem>
        <listitem>
         <para>
          包含 <filename>info</filename> 文件的可卸媒体，用于告知安装例程在哪里找到配置文件
         </para>
         <para>
          <emphasis>或</emphasis>
         </para>
         <para>
          访问系统引导提示，以便在手动输入 <literal>autoyast=</literal> 参数的地方进行安装
         </para>
        </listitem>
       </itemizedlist>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term> 从 SUSE Linux Enterprise 媒体引导并安装，从可卸媒体获取配置文件</term>
      <listitem>
       <para>
        如果完全基于网络的安装方案不起作用，则使用此方法。它要求对要安装的系统进行物理访问以打开目标计算机，或者，在第二种情况下，按照引导提示输入配置文件位置。无论哪种情况都可能需要根据安装范围更改媒体。
       </para>
       <para>
        需要对包含每：
       </para>
       <itemizedlist mark="bullet" spacing="normal">
        <listitem>
         <para>
          SUSE Linux Enterprise 媒体
         </para>
        </listitem>
        <listitem>
         <para>
          存放配置文件和 <filename>info</filename> 文件的可卸媒体
         </para>
         <para>
          <emphasis>或</emphasis>
         </para>
         <para>
          访问目标的引导提示以输入 <option>autoyast=</option> 参数
         </para>
        </listitem>
       </itemizedlist>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>从自定义媒体引导并安装，从媒体获取配置文件</term>
      <listitem>
       <para>
        如果需要安装的软件包数量有限且目标数量相对较低，理想的做法是创建您自己的自定义 CD，以存放安装数据和配置文件，尤其是在您的环境中无法使用网络的情况下。
       </para>
      </listitem>
     </varlistentry>
    </variablelist>
   </sect3>
  </sect2>

  <sect2 xml:id="sec.deployment.autoinst.simple.info">
   <title>创建 <filename>info</filename> 文件</title>
   <para>
    针对目标的安装例程需要清楚 AutoYaST 框架的不同组件。这要通过创建命令行来完成，命令行包含查找 AutoYaST 组件、安装源所需要的所有参数以及控制安装进程所需要的参数。
   </para>
   <para>
    这要通过根据安装引导提示手动传递这些参数来进行，或者通过提供由安装例程 (linuxrc) 读取的名为 <filename>info</filename> 的文件来进行。前者要求对任何要安装的客户端进行物理访问，这便使得这种方法不适合于大规模部署。后者使您能够提供一些媒体上的 <filename>info</filename> 文件，该文件要在自动安装前准备好并插入客户端驱动器。或者，如<xref linkend="sec.deployment.autoinst.simple.boot.pxe"/>所示使用 PXE 引导并将 linuxrc 参数包括在 <filename>pxelinux.cfg/default</filename> 文件中。
   </para>
   <para>
    下列参数一般用于 linuxrc。如果需要更多信息，请参阅 <filename>/usr/share/doc/packages/autoyast</filename> 下的 AutoYaST 包文档。
   </para>
   <important>
    <title>分隔参数和值</title>
    <para>
     当根据引导提示向 linuxrc 传递参数时，请使用 <literal>=</literal> 分隔参数和值。当使用 <filename>info</filename> 文件时，请使用 <literal>:</literal> 分隔参数和值。
    </para>
   </important>
   <informaltable>
    <tgroup cols="2">
     <thead>
      <row>
       <entry>
        <para>
         关键字
        </para>
       </entry>
       <entry>
        <para>
         值
        </para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row>
       <entry>
        <para>
         <literal>netdevice</literal>
        </para>
       </entry>
       <entry>
        <para>
         网络安装所使用的网络设备（根据 BOOTP/DHCP 的请求）。仅在几个网络设备可用的条件下需要。
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <literal>hostip</literal>
        </para>
       </entry>
       <entry>
        <para>
         如果是空的，客户端将发送 BOOTP 请求。否则，客户端将使用指定数据进行配置。
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <literal>netmask</literal>
        </para>
       </entry>
       <entry>
        <para>
         选定网络的网络掩码。
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <literal>gateway</literal>
        </para>
       </entry>
       <entry>
        <para>
         默认网关。
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <literal>nameserver</literal>
        </para>
       </entry>
       <entry>
        <para>
         名称服务器。
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <literal>autoyast</literal>
        </para>
       </entry>
       <entry>
        <para>
         用于自动安装的控制文件的位置，如 <literal>autoyast=nfs//192.168.1.110/profiles/</literal>。
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <literal>install</literal>
        </para>
       </entry>
       <entry>
        <para>
         安装源的位置，如 <literal>install=nfs://192.168.1.110/CDs/</literal>。
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <literal>vnc</literal>
        </para>
       </entry>
       <entry>
        <para>
         如果设置为 <literal>1</literal>，则启用 VNC 远程控制安装。
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <literal>vncpassword</literal>
        </para>
       </entry>
       <entry>
        <para>
         VNC 口令。
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <literal>usessh</literal>
        </para>
       </entry>
       <entry>
        <para>
         如果设置为 <literal>1</literal>，则启用 SSH 远程控制安装。
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <literal>netsetup</literal>
        </para>
       </entry>
       <entry>
        <para>
         如果设置为 <literal>1</literal>，请设置网络。一般而言，此操作是自动完成的，但当安装储存库为本地提供（例如通过 DVD 或本地 ISO 映像），且 <literal>info</literal> 文件从网络装载时，则需要设置 <filename>netsetup=1</filename>。
        </para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
   <para>
    如果自动安装方案包含 DHCP 客户端配置和网络安装源，而且您想使用 VNC 监视安装过程，则 <filename>info</filename> 如下所示：
   </para>
<screen>autoyast:<replaceable>profile_source</replaceable> install:<replaceable>install_source</replaceable> vnc:1 vncpassword:<replaceable>some_password</replaceable></screen>
   <para>
    如果要在安装时间使用静态网络安装，则 <filename>info</filename> 文件将如下所示：
   </para>
<screen>
autoyast:<replaceable>profile_source</replaceable> \
install:<replaceable>install_source</replaceable> \ 
hostip:<replaceable>some_ip</replaceable> \ 
netmask:<replaceable>some_netmask</replaceable> \ 
gateway:<replaceable>some_gateway</replaceable></screen>
   <para>
    <literal>\</literal> 表示添加换行符是为了保证可读性。所有的选项必须作为一个连续的字符串输入。
   </para>
   <para>
    <filename>info</filename> 数据可以几种不同的方式用于 linuxrc：
   </para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>
      作为一个文件在可卸媒体中提供，安装时，可以在客户端上使用该媒体。添加类似于 <systemitem>info=cd:/info</systemitem> 的 info 参数。
     </para>
    </listitem>
    <listitem>
     <para>
      作为初始 RAM 磁盘的 root 目录内的文件，该磁盘用于引导来自自定义安装媒体的系统或通过 PXE 引导的系统。
     </para>
    </listitem>
    <listitem>
     <para>
      作为 AutoYaST 配置文件的组成部分在这种情况下，AutoYaST 文件需要被命名为 <filename>info</filename> 来使 linuxrc 对其进行语法分析。以下是该方法的示例。
     </para>
    </listitem>
    <listitem>
     <para>
      通过指向 info 文件的位置的 URL。这种方式的语法类似于 <systemitem>info=http://www.example.com/info</systemitem>。
     </para>
    </listitem>
   </itemizedlist>
   <para>
    linuxrc 在配置文件中寻找字符串 (<option>start_linuxrc_conf</option>)，该字符串表示文件的开始。如果找到，它将从该字符串开始对该内容进行语法分析并在找到字符串 <option>end_linuxrc_conf</option> 时完成。这些选项以如下方式储存在配置文件中：
   </para>
<screen>....
  &lt;install&gt;
....
    &lt;init&gt;
      &lt;info_file&gt;
&lt;![CDATA[
#
# Don't remove the following line:
# start_linuxrc_conf
#
install: nfs:<replaceable>server</replaceable>/<replaceable>path</replaceable>
vnc: 1
vncpassword: test
autoyast: file:///info

# end_linuxrc_conf
# Do not remove the above comment
#
]]&gt;

      &lt;/info_file&gt;
    &lt;/init&gt;
......
  &lt;/install&gt;
....
</screen>
   <para>
    linuxrc 装载包含引导参数的配置文件而非传统的 <filename>info</filename> 文件。<option>install:</option> 参数指向安装源的位置。<option>vnc</option> 和 <option>vncpassword</option> 指示将 VNC 用于安装监视。<option>autoyast</option> 参数告诉 linuxrc 将 <filename>info</filename> 当作 AutoYaST 配置文件对待。
   </para>
  </sect2>

  <sect2 xml:id="sec.deployment.autoinst.simple.install">
   <title>启动并监视自动安装</title>
   <para>
    在提供了上述所有基础设施（配置文件、安装源和 <filename>info</filename> 文件）之后，可以继续启动自动安装。根据引导和监视进程的所选方案，可能需要与客户端进行物理交互：
   </para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>
      如果客户端系统从任何一种物理媒体（产品媒体或自定义 CD）进行引导，需要将这些媒体插入客户端驱动器内。
     </para>
    </listitem>
    <listitem>
     <para>
      如果客户端不是通过“网络唤醒”打开的，至少需要打开客户端。
     </para>
    </listitem>
    <listitem>
     <para>
      如果没有选择远程控制自动安装，来自 AutoYaST 的图形反馈则要发送到客户端附带监视器，或者，如果使用无外设客户端，则发送到串行控制台。
     </para>
    </listitem>
   </itemizedlist>
   <para>
    要启用远程控制自动安装，请如<xref linkend="sec.deployment.autoinst.simple.info"/>中所述使用 VNC 或 SSH 参数，并如<xref linkend="sec.deployment.remoteinst.monitor"/>所述，从另一台计算机连接到客户端。
   </para>
  </sect2>
 </sect1>
 <sect1 xml:id="sec.deployment.autoinst.advanced">
  <title>基于规则的自动安装</title>

  <para>
   以下几节讲述使用 AutoYaST 的基于规则安装的基本概念并提供示例方案，使您能够创建自定义自动安装。
  </para>

  <sect2 xml:id="sec.deployment.autoinst.advanced.expl">
   <title>了解基于规则的自动安装</title>
   <para>
    基于规则的 AutoYaST 安装使您能够处理异构硬件环境：
   </para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>
      您的站点包含不同供应商的硬件吗？
     </para>
    </listitem>
    <listitem>
     <para>
      计算机是在您不同硬件配置的站点上吗（例如，使用不同设备或使用大小不同的内存和磁盘）？
     </para>
    </listitem>
    <listitem>
     <para>
      您要通过横跨不同的域进行安装并需要区分这些域吗？
     </para>
    </listitem>
   </itemizedlist>
   <para>
    基于规则的自动安装一开始会通过将多个配置文件合并成一个，来生成符合异构方案的自定义配置文件。每个规则描述一个特定的安装功能（例如磁盘大小）并告诉 AutoYaST 当规则匹配时使用哪个配置文件。描述不同安装功能的几个规则都组合到一个 AutoYaST <filename>rules.xml</filename> 文件。然后规则堆栈将被处理，AutoYaST 通过把可以匹配 AutoYaST 规则的不同配置文件合成为一个来生成最后的配置文件。有关该过程的示例，请参见<xref linkend="sec.deployment.autoinst.advanced.example"/>。
   </para>
   <para>
    在计划和执行 SUSE Linux Enterprise 部署时，基于规则的 AutoYaST 可为您提供很大的灵活性。您可以执行以下操作：
   </para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>
      创建规则来匹配任何 AutoYaST 中的预定义系统特性
     </para>
    </listitem>
    <listitem>
     <para>
      使用逻辑操作器将多个系统属性（如磁盘大小和内核体系结构）组合成一个规则
     </para>
    </listitem>
    <listitem>
     <para>
      通过运行 shell 脚本并将其输出传递到 AutoYaST 框架来创建自定义规则。自定义规则的数量限于 5 个。
     </para>
    </listitem>
   </itemizedlist>
   <note>
    <para>
     有关 AutoYaST 规则创建和使用方法的更多信息，请参阅<guimenu>规则和类别</guimenu>一章 <filename>/usr/share/doc/packages/autoyast2/html/index.html</filename> 下的包文档。
    </para>
   </note>
   <para>
    要准备基于规则的 AutoYaST 大规模安装，请执行以下操作：
   </para>
   <procedure>
    <step>
     <para>
      创建几个 AutoYaST 配置文件，这些配置文件包含<xref linkend="sec.deployment.autoinst.simple.profile"/>中描述的异构安装所需的安装细节。
     </para>
    </step>
    <step>
     <para>
      定义规则以匹配<xref linkend="sec.deployment.autoinst.advanced.example"/>中所显示的硬件安装的系统属性。
     </para>
    </step>
    <step>
     <para>
      如<xref linkend="sec.deployment.autoinst.simple.dist"/>中所述，确定 AutoYaST 配置文件的来源以及要传递到安装例程的参数。
     </para>
    </step>
    <step>
     <para>
      如<xref linkend="sec.deployment.autoinst.simple.source"/>所述确定 SUSE Linux Enterprise 安装数据源。
     </para>
    </step>
    <step>
     <para>
      如<xref linkend="sec.deployment.autoinst.simple.info"/>所述，通过手动添加参数或创建 <filename>info</filename> 文件，将命令行传递到安装例程。
     </para>
    </step>
    <step>
     <para>
      如<xref linkend="sec.deployment.autoinst.simple.boot"/>中所述确定并设置自动安装引导方案。
     </para>
    </step>
    <step>
     <para>
      如<xref linkend="sec.deployment.autoinst.simple.install"/>中所述，启动自动安装进程。
     </para>
    </step>
   </procedure>
  </sect2>

  <sect2 xml:id="sec.deployment.autoinst.advanced.example">
   <title>基于规则自动安装的示例方案</title>
   <para>
    要基本了解如何创建规则，请考虑<xref linkend="fig.autoyast.rules"/>中描述的如下示例。一次性 AutoYaST 安装下列设置：
   </para>
   <variablelist>
    <varlistentry>
     <term>打印服务器</term>
     <listitem>
      <para>
       此计算机不需要桌面环境，只需要最基本的安装和有限的一组软件包。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>工程设计部的工作站</term>
     <listitem>
      <para>
       这些计算机需要桌面环境和一整套开发软件。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>销售部的笔记本电脑</term>
     <listitem>
      <para>
       这些计算机需要桌面环境和一套有限的专用应用程序（如办公和日历软件）。
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
   <figure xml:id="fig.autoyast.rules">
    <title>AutoYaST 规则</title>
    <mediaobject>
     <imageobject role="fo">
      <imagedata fileref="autoyast_rules.svg" width="90%" format="SVG"/>
     </imageobject>
     <imageobject role="html">
      <imagedata fileref="autoyast_rules.png" width="80%" format="PNG"/>
     </imageobject>
    </mediaobject>
   </figure>
   <para>
    在第一步中，请使用<xref linkend="sec.deployment.autoinst.simple.profile"/>中所述的方法之一来为每次使用情况创建配置文件。在本例中，您将创建 <filename>print.xml</filename>、<filename>engineering.xml</filename> 和 <filename>sales.xml</filename>。
   </para>
   <para>
    在第二步中，请创建规则来区分三种硬件类型并且告诉 AutoYaST 使用哪个配置文件。使用类似于下列方法的算法来设置规则：
   </para>
   <orderedlist spacing="normal">
    <listitem>
     <para>
      该计算机有 <guimenu>192.168.2.253</guimenu> 的 IP 地址吗？ 然后将其设为打印服务器。
     </para>
    </listitem>
    <listitem>
     <para>
      该计算机拥有 PCMCIA 硬件和 Intel 芯片组吗？ 然后将其视为 Intel 笔记本电脑并安装销售部软件选择。
     </para>
    </listitem>
    <listitem>
     <para>
      如果以上均不正确，则将该计算机视为开发人员工作站并进行相应的安装。
     </para>
    </listitem>
   </orderedlist>
   <para>
    大致上，这可以转换为具有下列内容的 <filename>rules.xml</filename> 文件：
   </para>
<screen>
&lt;?xml version="1.0"?&gt;
&lt;!DOCTYPE autoinstall SYSTEM "/usr/share/autoinstall/dtd/rules.dtd"&gt; 
&lt;autoinstall xmlns="http://www.suse.com/1.0/yast2ns" xmlns:config="http://www.suse.com/1.0/configns"&gt;
  &lt;rules config:type="list"&gt;
    &lt;rule&gt;
       &lt;hostaddress&gt;
	    &lt;match&gt;192.168.2.253&lt;/match&gt;
            &lt;match_type&gt;exact&lt;/match_type&gt;
       &lt;/hostaddress&gt;
       &lt;result&gt;
            &lt;profile&gt;print.xml&lt;/profile&gt;
            &lt;continue config:type="boolean"&gt;false&lt;/continue&gt;
        &lt;/result&gt;
    &lt;/rule&gt;
    &lt;rule&gt;
       &lt;haspcmcia&gt;
            &lt;match&gt;1&lt;/match&gt;
            &lt;match_type&gt;exact&lt;/match_type&gt;
       &lt;/haspcmcia&gt;
       &lt;custom1&gt;
           &lt;script&gt;
if grep -i intel /proc/cpuinfo &gt; /dev/null; then
echo -n "intel"
else
echo -n "non_intel"
fi;
           &lt;/script&gt;
           &lt;match&gt;*&lt;/match&gt;
           &lt;match_type&gt;exact&lt;/match_type&gt;
       &lt;/custom1&gt;
       &lt;result&gt;
            &lt;profile&gt;sales.xml&lt;/profile&gt;
            &lt;continue config:type="boolean"&gt;false&lt;/continue&gt;
        &lt;/result&gt;
        &lt;operator&gt;and&lt;/operator&gt;
    &lt;/rule&gt;
    &lt;rule&gt;
        &lt;haspcmcia&gt;
            &lt;match&gt;0&lt;/match&gt;
            &lt;match_type&gt;exact&lt;/match_type&gt;
        &lt;/haspcmcia&gt;
 	&lt;result&gt;
            &lt;profile&gt;engineering.xml&lt;/profile&gt;
            &lt;continue config:type="boolean"&gt;false&lt;/continue&gt;
        &lt;/result&gt;
    &lt;/rule&gt;
  &lt;/rules&gt;
&lt;/autoinstall&gt;
</screen>
   <para>
    分发规则文件时，确保 <filename>rules</filename> 目录位于 <filename>profiles</filename> 目录下（在 <filename>autoyast=<replaceable>protocol</replaceable>:<replaceable>serverip</replaceable>/profiles/</filename> URL 中指定）。AutoYaST 首先寻找包含文件名为 <filename>rules.xml</filename> 的 <filename>rules</filename> 子目录，然后装载并合并规则文件中指定的配置文件。
   </para>
   <para>
    剩余的自动安装程序像往常一样进行。
   </para>
  </sect2>
 </sect1>
 <sect1 xml:id="sec.deployment.autoinst.moreinfo">
  <title>更多信息</title>

  <para>

   有关 AutoYaST 技术的详细信息，请参见<phrase os="sles"><xref linkend="book.autoyast"/>或</phrase>随软件一同安装的文档 (<filename>/usr/share/doc/packages/autoyast2</filename>)。
  </para>
 </sect1>
</chapter>
