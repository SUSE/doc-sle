<?xml version="1.0" encoding="UTF-8"?>
<sect1 xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="yast2_manpart.xml" version="5.0" xml:id="sec.yast2.i_y2_part_expert">
 <title>Utilisation de l'outil de partitionnement de YaST</title>

 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:bugtracker/>
   <dm:translation>oui</dm:translation>
  </dm:docmanager>
 </info><indexterm> <primary>YaST</primary><secondary>partitionnement</secondary></indexterm><indexterm><primary>création </primary><secondary>partitions</secondary></indexterm>

 <para>
  Le partitionneur en mode expert, illustré à la <xref linkend="fig.yast2.i_y2_disk_part"/>, permet de modifier manuellement le partitionnement d'un ou de plusieurs disques durs. Vous pouvez ajouter, supprimer, redimensionner et modifier les partitions ou accéder à la configuration logicielle RAID et LVM.
 </para>

 <warning>
  <title>repartitionnement du système en cours d'exécution</title>
  <para>
   S'il est possible de repartitionner un système en cours d'exécution, le risque de commettre une erreur qui engendrerait une perte de données est très important. Évitez de repartitionner un système installé et si vous devez vraiment le faire, sauvegardez par avance toutes vos données.
  </para>
 </warning>

 <figure xml:id="fig.yast2.i_y2_disk_part">
  <title>Outil de partitionnement de YaST</title>
  <mediaobject>
   <imageobject role="fo">
    <imagedata fileref="install_partitioner_expert.png" width="75%" format="PNG"/>
   </imageobject>
   <imageobject role="html">
    <imagedata fileref="install_partitioner_expert.png" width="75%" format="PNG"/>
   </imageobject>
  </mediaobject>
 </figure>

 <tip arch="zseries" os="sles">
  <title>IBM z Systems : noms de périphérique</title>
  <para>
   IBM z Systems reconnaît uniquement les disques durs DASD et SCSI. Les disques durs IDE ne sont pas pris en charge. Pour cette raison, ces périphériques apparaissent dans la table de partition au format de fichier <filename>dasda</filename> ou <filename>sda</filename> pour le premier périphérique reconnu.
  </para>
 </tip>

 <para>
  Toutes les partitions existantes ou proposées de tous les disques durs connectés sont affichées dans la liste de l'<guimenu>Espace de stockage disponible</guimenu> de la boîte de dialogue <guimenu>Partitionnement en mode expert</guimenu> de YaST. Les disques durs complets sont répertoriés sous forme de périphériques sans numéros, tels que <filename>/dev/sda</filename><phrase arch="zseries" os="sles"> (ou <filename>/dev/dasda</filename>)</phrase>. Les partitions sont répertoriées comme des parties de ces périphériques, par exemple <filename>/dev/sda1</filename><phrase arch="zseries" os="sles"> (ou <filename>/dev/dasda1</filename>, respectivement)</phrase>. La taille, le type, l'état de codage, le système de fichiers et le point de montage des disques durs et de leurs partitions sont également affichés. Le point de montage indique l'emplacement où la partition apparaît dans l'arborescence du système de fichiers Linux.
 </para>

 <para>
  La <guimenu>vue système</guimenu> sur la gauche propose plusieurs vues fonctionnelles. Utilisez ces vues pour collecter des informations sur les configurations de stockage existantes, pour configurer des fonctions comme <literal>RAID</literal>, <literal>Gestion du volume</literal>, <literal>Fichiers de codage</literal> ou pour afficher des systèmes de fichiers avec des fonctionnalités supplémentaires comme BTRFS, NFS ou <literal>TMPFS</literal>.
 </para>

 <para>
  Si vous ouvrez cette boîte de dialogue au cours de l'installation, l'espace disque libre est également répertorié et automatiquement sélectionné. Pour fournir plus d'espace disque à <phrase role="productname"><phrase os="sles">SUSE® Linux Enterprise Server</phrase></phrase>, libérez l'espace requis en commençant au bas de la liste et en remontant progressivement (c'est à dire de la dernière partition d'un disque vers la première).
 </para>

 <sect2 xml:id="sec.IB.part.typen">
  <title>Types de partitions</title><indexterm> <primary>partitions</primary><secondary>types</secondary> </indexterm>
  <tip arch="zseries" os="sles">
   <title>IBM z Systems : disques durs</title>
   <para>
    Sur les plates-formes IBM z Systems, SUSE Linux Enterprise Server prend en charge tant les disques durs SCSI que les périphériques de stockage à accès direct (DASD). Si les disques SCSI peuvent être partitionnés comme indiqué ci-dessous, les DASD ne peuvent pas avoir plus de trois entrées de partition dans leurs tables de partition.
   </para>
  </tip>
  <para>
   Chaque disque dur possède une table de partition pouvant accepter quatre entrées. Chaque entrée d'une table de partition correspond à une partition principale ou à une partition étendue. Une seule entrée de partition étendue est cependant autorisée.
  </para>
  <para>
   Une partition principale se compose simplement d'une plage de cylindres continue (zones de disque physiques) affectée à un système d'exploitation en particulier. Si vous n'utilisez que des partitions principales, vous serez limité à quatre partitions par disque dur. En effet, la table de partition ne permet pas d'en définir davantage. On utilise donc également des partitions étendues. Ces dernières constituent également des plages de cylindres de disques continues, mais elles ont la particularité de pouvoir être subdivisées en <emphasis>partitions logiques</emphasis>. Les partitions logiques ne nécessitent pas d'entrées dans la table de partition. En d'autres termes, une partition étendue est un conteneur de partitions logiques.
  </para>
  <para>
   Si vous avez besoin de plus de quatre partitions, créez une partition étendue en guise de quatrième partition (ou avant). Cette partition étendue doit couvrir l'intégralité de la plage restante de cylindres libres. Vous pouvez ensuite créer plusieurs partitions logiques au sein de cette partition étendue. Le nombre maximum de partitions logiques est 63, quel que soit le type de disque. Le type de partition utilisé pour Linux n'a aucune importance. Les partitions principale et logique fonctionnent normalement.
  </para>
  <tip os="sles;osuse">
   <title>table de partitions GPT</title>
   <para>
    Si vous devez créer plus de 4 partitions principales sur un disque dur, vous devrez utiliser le type de partition GPT. Ce type de partition supprime la restriction du nombre de partitions principales et prend également en charge les partitions supérieures à 2 To.
   </para>
   <para>
    Pour utiliser GPT, exécutez l'outil de partitionnement YaST, cliquez sur le nom du disque approprié dans la <guimenu>Vue système</guimenu>, puis sélectionnez <menuchoice><guimenu>Expert</guimenu> <guimenu>Créer une nouvelle table de partition</guimenu> <guimenu>GPT</guimenu></menuchoice>.
   </para>
  </tip>
 </sect2>



 <sect2 xml:id="sec.yast2.i_y2_part_expert.newpart">
  <title>Création d'une partition</title><indexterm> <primary>partitions</primary><secondary>création</secondary> </indexterm>
  <para>
   Pour créer une partition, sélectionnez <guimenu>Disques durs</guimenu>, puis un disque dur avec de l'espace disponible. La modification peut être effectuée dans l'onglet <guimenu>Partitions</guimenu> :
  </para>
  <procedure>
   <step>
    <para>
     Sélectionnez <guimenu>Ajouter</guimenu> et spécifiez le type de partition (principale ou étendue). Créez jusqu'à quatre partitions principales ou jusqu'à trois partitions principales et une partition étendue. Vous pouvez créer plusieurs partitions logiques au sein de la partition étendue (reportez-vous à la <xref linkend="sec.IB.part.typen"/>).
    </para>
   </step>
   <step>
    <para>
     Spécifiez la taille de la nouvelle partition. Vous pouvez choisir d'occuper tout l'espace disque non partitionné ou de spécifier une taille personnalisée.
    </para>
   </step>
   <step>
    <para>
     Sélectionnez le système de fichiers à utiliser et un point de montage. YaST propose un point de montage pour chaque partition créée. Pour utiliser une méthode de montage différente, comme le montage par étiquette, sélectionnez <guimenu>Options Fstab</guimenu>. Pour plus d'informations sur les systèmes de fichiers pris en charge, consultez la section <systemitem class="username">root</systemitem>.
    </para>
   </step>
   <step>
    <para>
     Indiquez des options de système de fichiers supplémentaires si votre configuration l'exige. Cette étape est nécessaire si vous avez besoin de noms de périphériques permanents, par exemple. Pour plus de détails sur les options disponibles, reportez-vous à la <xref linkend="sec.yast2.i_y2_part_expert.options"/>.
    </para>
   </step>
   <step>
    <para>
     Cliquez sur <guimenu>Terminer</guimenu> pour appliquer la configuration du partitionnement et quitter le module.
    </para>
    <para>
     Si vous avez créé la partition lors de l'installation, vous revenez à l'écran de présentation de l'installation.
    </para>
   </step>
  </procedure>
  <sect3 xml:id="yast2.btrfs">
   <title>Partitionnement Btrfs</title>
   <para>
    Le système de fichiers par défaut pour la partition racine est Btrfs (pour plus d'informations sur Btrfs, voir <xref linkend="cha.snapper"/><phrase os="sles"> et <xref linkend="cha.filesystems"/></phrase>). Le système de fichiers racine est le sous-volume par défaut et il n'est pas répertorié dans la liste des sous-volumes créés. En tant que sous-volume Btrfs par défaut, il peut être monté comme système de fichiers normal.
   </para>
   <important>
    <title>Btrfs sur une partition racine chiffrée</title>
    <para>
     La configuration par défaut du partitionnement suggère une partition racine de type Btrfs et <filename>/boot</filename> comme répertoire. Si la partition racine doit être chiffrée avec cette configuration, veillez à utiliser une partition GPT comme type de table au lieu du type MSDOS par défaut. Dans le cas contraire, le chargeur d'amorçage GRUB2 risque de ne pas disposer de suffisamment d'espace pour celui nécessaire à la deuxième étape.
    </para>
   </important>
   <para>
    Il est possible de créer des instantanés de sous-volumes Btrfs, manuellement ou automatiquement, selon les événements système. Par exemple, lorsque vous modifiez le système de fichiers, <command>zypper</command> appelle la commande <command>snapper</command> afin de créer des instantanés avant et après le changement. Cela se révèle particulièrement utile si la modification effectuée par <command>zypper</command> ne vous convient pas et si vous souhaitez revenir à l'état précédent. Étant donné que la commande <command>snapper</command> appelée par <command>zypper</command> réalise, par défaut, un instantané du système de fichiers <emphasis>root</emphasis>, il est raisonnable d'exclure des répertoires spécifiques de la prise d'instantanés en fonction de la nature des données qu'ils contiennent. C'est également la raison pour laquelle YaST propose de créer les sous-volumes distincts suivants.
   </para>
   <xi:include href="snapshot_excludes_i.xml"/>
   <tip>
    <title>taille de la partition Btrfs</title>
    <para>
     Les instantanés enregistrés nécessitent davantage d'espace disque. Il est donc conseillé de réserver plus d'espace à la partition Btrfs qu'à une partition n'effectuant pas d'instantanés (Ext3, par exemple). La taille recommandée pour une partition Btrfs racine avec les sous-volumes proposés est de 20 Go.
    </para>
   </tip>
   <sect4 xml:id="yast2.btrfs.yast">
    <title>Gestion de sous-volumes Btrfs à l'aide de YaST</title>
    <para>
     Les sous-volumes d'une partition Btrfs peuvent désormais être gérés avec le module <guimenu>Partitionnement en mode expert</guimenu> de YaST. Vous pouvez ajouter de nouveaux sous-volumes ou des sous-volumes existants.
    </para>
    <procedure>
     <title>Sous-volumes Btrfs avec YaST</title>
     <step>
      <para>
       Démarrez le module <guimenu>Partitionnement en mode expert</guimenu> de YaST à l'aide de <menuchoice><guimenu>Système</guimenu><guimenu>Partitionneur</guimenu></menuchoice>.
      </para>
     </step>
     <step>
      <para>
       Sélectionnez <guimenu>Btrfs</guimenu> dans le volet <guimenu>Vue système</guimenu> de gauche.
      </para>
     </step>
     <step>
      <para>
       Sélectionnez la partition Btrfs dont vous souhaitez gérer les sous-volumes et cliquez ensuite sur <guimenu>Modifier</guimenu>.
      </para>
     </step>
     <step>
      <para>
       Cliquez sur <guimenu>Traitement du sous-volume</guimenu>. La liste de tous les sous-volumes existants de la partition Btrfs sélectionnée est alors affichée. Vous remarquerez plusieurs entrées <literal>@/.snapshots/xyz/snapshot</literal> ; chacun de ces sous-volumes appartient à un seul instantané existant.
      </para>
     </step>
     <step>
      <para>
       Procédez comme suit selon que vous souhaitez ajouter ou supprimer des sous-volumes :
      </para>
      <substeps performance="required">
       <step>
        <para>
         Pour supprimer un sous-volume, sélectionnez-le dans la liste des <guimenu>Sous-volumes existants</guimenu>, puis cliquez sur <guimenu>Supprimer</guimenu>.
        </para>
       </step>
       <step>
        <para>
         Pour ajouter un nouveau sous-volume, entrez son nom dans la zone de texte <guimenu>Nouveau sous-volume</guimenu>, puis cliquez sur <guimenu>Ajouter un nouvel élément</guimenu>.
        </para>
        <figure xml:id="fig.yast2.btrfs.subvolumes">
         <title>Sous-volumes Btrfs dans le partitionneur YaST</title>
         <mediaobject>

          <imageobject role="fo">
           <imagedata fileref="yast2_btrfs_subvolumes.png" width="75%" format="PNG"/>
          </imageobject>
          <imageobject role="html">
           <imagedata fileref="yast2_btrfs_subvolumes.png" width="75%" format="PNG"/>
          </imageobject>
         </mediaobject>
        </figure>
       </step>
      </substeps>
     </step>
     <step>
      <para>
       Confirmez en sélectionnant <guimenu>OK</guimenu> et <guimenu>Terminer</guimenu>.
      </para>
     </step>
     <step>
      <para>
       Pour quitter le partitionneur, cliquez sur <guimenu>Terminer</guimenu>.
      </para>
     </step>
    </procedure>
   </sect4>
  </sect3>
 </sect2>

 <sect2 xml:id="sec.yast2.i_y2_part_expert.options">
  <title>Modification d'une partition</title><indexterm> <primary>partitions</primary><secondary>paramètres</secondary> </indexterm>
  <para>
   Lorsque vous créez une nouvelle partition ou que vous modifiez une partition existante, vous pouvez définir différents paramètres. Pour les nouvelles partitions, les paramètres par défaut définis par YaST sont généralement suffisants et ne nécessitent aucune modification. Pour modifier manuellement la configuration de votre partition, procédez de la façon suivante :
  </para>
  <procedure>
   <step>
    <para>
     Sélectionnez la partition.
    </para>
   </step>
   <step>
    <para>
     Cliquez sur <guimenu>Éditer</guimenu> pour modifier la partition et fixer les paramètres :
    </para>
    <variablelist>
     <varlistentry>
      <term>ID du système de fichiers</term>
      <listitem>
       <para>
        <indexterm> <primary>partitions</primary> <secondary>LVM</secondary> </indexterm> <phrase os="sles"> </phrase> <indexterm> <primary>partitions</primary> <secondary>RAID</secondary> </indexterm> Même si vous ne souhaitez pas formater la partition à ce stade, affectez-lui un ID de système de fichiers pour vous assurer qu'elle est correctement enregistrée. Les valeurs types sont <guimenu>Linux</guimenu>, <guimenu>Linux swap</guimenu>, <guimenu>Linux LVM</guimenu> et <guimenu>Linux RAID</guimenu>.
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>
       Système de fichiers
      </term>
      <listitem>
       <para>
        <indexterm> <primary>systèmes de fichiers</primary> <secondary>modification</secondary> </indexterm> <indexterm> <primary>partitions</primary> <secondary>reformatage</secondary> </indexterm> Pour modifier le système de fichiers de la partition, cliquez sur <guimenu>Formater la partition</guimenu> et sélectionnez le type de système de fichiers dans la liste <guimenu>Système de fichiers</guimenu>.
       </para>
       <para>
        <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> prend en charge plusieurs types de systèmes de fichiers. Btrfs est le système de fichiers Linux privilégié pour la partition racine en raison de ses fonctionnalités avancées. Il prend en charge la fonctionnalité de copie sur écriture, la création d'instantanés, la distribution multi-périphérique, les sous-volumes et autres techniques utiles. XFS, Ext3 et JFS sont des systèmes de fichiers de journalisation. Ces systèmes de fichiers peuvent restaurer le système très rapidement après un crash système en utilisant les processus d'écriture consignés en cours de fonctionnement. Ext2 n'est pas un système de fichiers de journalisation, mais convient pour les partitions plus petites car il requiert peu d'espace disque pour la gestion.
       </para>
       <para>
        Le système de fichiers par défaut pour la partition racine est Btrfs. Ce système est XFS pour les partitions supplémentaires.
       </para>
       <para>
        Swap est un format spécial permettant d'utiliser la partition comme mémoire virtuelle. Créez une partition Swap d'au moins 256 Mo. Toutefois, si vous utilisez tout votre espace d'échange, pensez à ajouter plus de mémoire sur votre système plutôt que davantage d'espace d'échange.
       </para>
       <warning>
        <title>changement du système de fichiers</title>
        <para>
         Le changement de système de fichiers et le reformatage de partitions effacent irrémédiablement toutes les données de la partition.
        </para>
       </warning>
       <para>
        Pour plus de détails sur les différents systèmes de fichiers, reportez-vous au <citetitle>Storage Administration Guide</citetitle> (Guide d'administration du stockage).
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>
       Codage du périphérique
      </term>
      <listitem>
       <para>
        Si vous activez le codage, toutes les données seront écrites sur le disque dur sous forme codée. Cela accroît la sécurité des données sensibles, mais ralentit le système en raison du temps requis par le codage. Pour plus d'informations sur le codage des systèmes de fichiers, reportez-vous au <xref linkend="cha.security.cryptofs"/>.
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>
       Point de montage
      </term>
      <listitem>
       <para>
        Définissez le répertoire au niveau duquel la partition doit être montée dans l'arborescence du système de fichiers. Sélectionnez l'une des propositions de YaST ou entrez un autre nom.
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>
       Options Fstab
      </term>
      <listitem>
       <para>
        Définissez les divers paramètres compris dans le fichier d'administration du système de fichiers global (<filename>/etc/fstab</filename>). Les paramètres par défaut doivent convenir à la plupart des configurations. Vous pouvez, par exemple, modifier l'identification du système de fichiers et passer d'un nom de périphérique à une étiquette de volume. Pour l'étiquette de volume, vous pouvez utiliser tous les caractères à l'exception de la barre oblique (<literal>/</literal>) et de l'espace.
       </para>
       <para>
        Pour obtenir des noms de périphériques permanents, utilisez l'option de montage <guimenu>Device ID </guimenu>, <guimenu>UUID</guimenu> (Identifiant unique universel) ou <guimenu>LABEL</guimenu>. Dans <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase>, les noms de périphérique permanents sont activés par défaut.
       </para>
       <note os="sles" arch="zseries">
        <title>IBM z Systems : montage par chemin</title>
        <para>
         Sur les plates-formes IBM z Systems, le montage par ID est problématique en cas de copie disque à disque à des fins de clonage. Pour ces plates-formes, les périphériques sont donc, par défaut, montés par chemin à l'emplacement <filename>/etc/fstab</filename>.
        </para>
       </note>
       <para>
        Si vous préférez monter la partition par son étiquette, vous devez en définir une dans l'entrée de texte <guimenu>Étiquette de volume</guimenu>. Vous pouvez, par exemple, utiliser l'étiquette de partition <literal>HOME</literal> pour une partition à monter sur <filename>/home</filename>.
       </para>
       <para>
        Si vous prévoyez d'utiliser des quotas sur le système de fichiers, utilisez l'option de montage <guimenu>Activer la prise en charge des quotas</guimenu>. Vous devez activer cette option pour pouvoir définir des quotas utilisateur dans le module YaST <guimenu>Gestion des utilisateurs</guimenu>. Pour plus d'informations sur la configuration des quotas utilisateurs, reportez-vous à la <xref linkend="sec.y2.userman.adv.quota"/>.
       </para>
      </listitem>
     </varlistentry>
    </variablelist>
   </step>
   <step>
    <para>
     Sélectionnez <guimenu>Terminer</guimenu> pour enregistrer les modifications.
    </para>
   </step>
  </procedure>
  <note>
   <title>redimensionnement des systèmes de fichiers</title>
   <para>
    Pour redimensionner un système de fichiers existant, sélectionnez la partition et cliquez sur <guimenu>Redimensionner</guimenu>. Souvenez-vous qu'il est impossible de redimensionner une partition déjà montée. Pour redimensionner une partition, vous devez la démonter avant d'exécuter l'outil de partitionnement.
   </para>
  </note>
 </sect2>

 <sect2 xml:id="sec.yast2.i_y2_part_expert.options2">
  <title>Options avancées</title>
  <para>
   Après avoir sélectionné un disque dur (comme <guimenu>sda</guimenu>) dans le volet <guimenu>Vue système</guimenu>, vous pouvez accéder au menu <guimenu>Expert</guimenu> en bas à droite de la fenêtre <guimenu>Partitionnement en mode expert</guimenu>. Le menu contient les options suivantes :
  </para>
  <variablelist>
   <varlistentry>
    <term>Créer une nouvelle table de partition</term>
    <listitem>
     <para>
      Cette option permet de créer une nouvelle table de partition sur le périphérique sélectionné.
     </para>
     <warning>
      <title>création d'une nouvelle table de partition</title>
      <para>
       La création d'une nouvelle table de partition sur un périphérique supprime définitivement toutes les partitions et leurs données du périphérique.
      </para>
     </warning>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Cloner ce disque</term>
    <listitem>
     <para>
      Cette option vous permet de cloner la disposition de la partition du périphérique (et non les données) sur d'autres disques disponibles.
     </para>
    </listitem>
   </varlistentry>
  </variablelist>
 </sect2>

 <sect2 xml:id="sec.yast2.i_y2_part_expert.configure_options">
  <title>Options avancées</title>
  <para>
   Après avoir sélectionné le nom d'hôte de l'ordinateur (niveau supérieur de l'arborescence dans le volet <guimenu>Vue Système</guimenu>), vous pouvez accéder au menu <guimenu>Configurer</guimenu> situé dans la partie inférieure droite de la fenêtre <guimenu>Partitionneur en mode expert</guimenu>. Le menu contient les options suivantes :
  </para>
  <variablelist>
   <varlistentry>
    <term>Configurer iSCSI</term>
    <listitem>
     <para>
      Pour accéder à SCSI sur les périphériques de bloc IP, vous devez d'abord configurer iSCSI. Cela entraîne l'affichage de périphériques disponibles supplémentaires dans la liste de la partition principale.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Configurer multipath</term>
    <listitem>
     <para>
      Cette option permet de configurer l'amélioration multipath vers les périphériques de stockage de masse pris en charge.
     </para>
    </listitem>
   </varlistentry>
  </variablelist>
 </sect2>

 <sect2 xml:id="sec.yast2.i_y2_part_expert.info">
  <title>Autres conseils de partitionnement</title>
  <para>
   Cette section présente quelques conseils et astuces sur le partitionnement qui vous aideront à prendre les bonnes décisions lors de la configuration de votre système.
  </para>
  <tip>
   <title>nombre de cylindres</title>
   <para>
    Des outils de partition différents peuvent compter les cylindres d'une partition en commençant par <literal>0</literal> ou par <literal>1</literal>. Pour calculer le nombre de cylindres, calculez la différence entre le dernier et le premier numéros de cylindre, puis ajoutez 1. 
   </para>
  </tip>
  <sect3 xml:id="sec.yast2.i_y2_part_expert.info.swap">
   <title>Utilisation d'espace d'échange (<literal>swap</literal>)</title>
   <para>
    L'espace d'échange (swap) est utilisé pour augmenter la mémoire physique disponible. Ainsi, il est possible d'utiliser davantage de mémoire que la mémoire physique RAM disponible. Jusqu'à la version 2.4.10, le système de gestion de la mémoire des kernels exigeait de l'espace d'échange pour des raisons de sécurité. Si vous n'aviez pas deux fois plus d'espace d'échange que de RAM, les performances du système en pâtissaient. Ces limitations ne sont plus d'actualité.
   </para>
   <para>
    Linux utilise une page appelée <quote>La moins récemment utilisée</quote> (LRU) pour sélectionner les pages à déplacer de la mémoire vers le disque. Par conséquent, les applications en cours d'exécution disposent de plus de mémoire disponible et la mise en cache fonctionne mieux.
   </para>
   <para>
    Si une application tente d'allouer autant de mémoire qu'elle peut en obtenir, des problèmes d'espace d'échange surviendront. Il existe trois cas principaux :
   </para>
   <variablelist>
    <varlistentry>
     <term>Système sans espace d'échange</term>
     <listitem>
      <para>
       L'application se dote de toute la mémoire qui peut être libérée. Tous les caches sont libérés, donc toutes les autres applications en cours d'exécution sont ralenties. Après quelques minutes, le mécanisme OOM Killer (qui supprime les processus utilisant trop de mémoire) du kernel s'active et supprime le processus.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>Système avec espace d'échange moyen (128 à 512 Mo)</term>
     <listitem>
      <para>
       Le système est d'abord ralenti, comme un système sans espace d'échange. Une fois que toute la RAM physique a été utilisée, il passe sur l'espace d'échange. À ce moment, le système est très lent et il est impossible d'exécuter des commandes à distance. Il reste dans cet état pendant 10 à 15 minutes (selon la vitesse des disques durs qui exécutent l'espace mémoire d'échange) jusqu'à ce que l'outil OOM Killer du kernel résolve le problème. Vous aurez besoin d'une quantité relativement importante d'espace d'échange si l'ordinateur doit effectuer une <quote>Hibernation</quote> (sauvegarde du contenu de la mémoire vive sur le disque dur). Dans ce cas, l'espace d'échange doit être assez important pour contenir les données de la mémoire (512 Mo à 1 Go).
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>Système avec grand espace de swap (plusieurs gigaoctets)</term>
     <listitem>
      <para>
       Dans ce cas, il est préférable de ne pas avoir d'application non contrôlée qui effectue frénétiquement des échanges. Si ce problème survient, le système mettra plusieurs heures à retrouver son état normal. D'autres processus risquent de subir des défaillances et délais d'attente importants, donc de quitter le système dans un état non défini, même si le processus défectueux est arrêté. Dans ce cas, éteignez, puis rallumez la machine et essayez de la faire fonctionner à nouveau. Un grand volume d'espace d'échange est inutile, sauf si une application nécessite cette configuration. Les applications concernées (notamment les bases de données ou les programmes de manipulation d'images) bénéficient souvent d'une option qui permet d'utiliser directement l'espace de disque dur dont elles ont besoin. Il est recommandé de tirer parti de cette option plutôt que d'utiliser beaucoup d'espace d'échange.
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
   <para>
    Si votre système est sous contrôle mais s'il a besoin de plus d'espace d'échange après quelque temps, vous pouvez augmenter l'espace d'échange en ligne. Si vous avez préparé une partition pour l'espace d'échange, ajoutez-la à l'aide de YaST. Si vous ne disposez d'aucune partition disponible, vous pouvez également utiliser un fichier d'échange pour augmenter l'espace d'échange. Ces fichiers sont généralement plus lents que les partitions, mais par rapport à la mémoire RAM physique, ces deux types d'éléments sont lents et la différence est négligeable.
   </para>
   <procedure>
    <title>Ajout manuel d'un fichier d'échange</title>
    <para>
     Pour ajouter un fichier d'échange sur un système en cours d'exécution, procédez de la façon suivante :
    </para>
    <step>
     <para>
      Créez un fichier vide sur votre système. Par exemple, si vous souhaitez ajouter à <filename>/var/lib/swap/swapfile</filename> un fichier d'échange de 128 Mo, utilisez les commandes suivantes :
     </para>
<screen>mkdir -p /var/lib/swap
dd if=/dev/zero of=/var/lib/swap/swapfile bs=1M count=128</screen>
    </step>
    <step>
     <para>
      Initialisez ce fichier d'échange grâce à la commande suivante :
     </para>
<screen>mkswap /var/lib/swap/swapfile</screen>
      <note>
  <title>UUID modifié pour les partitions d'échange lors de leur mise en forme à l'aide de <command>mkswap</command></title>
  <para>Si possible, évitez de reformater les partitions d'échange existantes avec <command>mkswap</command>. Le reformatage avec <command>mkswap</command> modifie la valeur UUID de la partition d'échange. Vous pouvez reformater via YaST (mettra à jour <filename>/etc/fstab</filename>) ou ajuster l'emplacement <filename>/etc/fstab</filename> manuellement.
  </para>
</note>
    </step>
    <step>
     <para>
      Activez le fichier d'échange grâce à la commande :
     </para>
<screen>swapon /var/lib/swap/swapfile</screen>
     <para>
      Pour désactiver ce fichier d'échange, utilisez la commande suivante :
     </para>
<screen>swapoff /var/lib/swap/swapfile</screen>
    </step>
    <step>
     <para>
      Vérifiez les espaces d'échange disponibles actuellement grâce à la commande :
     </para>
<screen>cat /proc/swaps</screen>
     <para>
      À ce stade, il ne s'agit que d'espace d'échange temporaire. Après le prochain redémarrage, il ne sera plus utilisé.
     </para>
    </step>
    <step>
     <para>
      Pour activer ce fichier d'échange de façon permanente, ajoutez à <filename>/etc/fstab</filename> la ligne suivante :
     </para>
<screen>/var/lib/swap/swapfile swap swap defaults 0 0</screen>
    </step>
   </procedure>
  </sect3>
 </sect2>

 <sect2 xml:id="sec.yast2.i_y2_part_expert.lvm">
  <title>Partitionnement et LVM</title>
  <para>
   Depuis le <guimenu>partitionneur expert</guimenu>, accédez à la configuration LVM en cliquant sur l'option <guimenu>Gestion du volume</guimenu> dans le volet <guimenu>Vue Système</guimenu>. Cependant, si une configuration LVM fonctionnelle existe déjà sur votre système, celle-ci s'active automatiquement dès que vous entrez pour la première fois en mode de configuration LVM au cours d'une session. Dans ce cas, aucun disque contenant une partition (appartenant à un groupe de volumes activé) ne peut être repartitionné. En effet, le kernel Linux ne peut pas lire la table de partition modifiée d'un disque dur si une partition du disque est en cours d'utilisation. Si vous disposez déjà d'une configuration LVM fonctionnelle sur votre système, aucun repartitionnement physique ne devrait être nécessaire. Modifiez plutôt la configuration des volumes logiques.
  </para>
  <para>
   Au début de chaque volume physique, des informations sur le volume sont écrites dans la partition. Pour réutiliser une partition de ce type avec un gestionnaire différent de LVM, il est conseillé de supprimer le début de ce volume. Par exemple, avec le groupe de volumes <literal>system</literal> et le volume physique <filename>/dev/sda2</filename>, utilisez la commande <command>dd</command> <option>if=/dev/zero of=/dev/sda2 bs=512 count=1</option>.
  </para>
  <warning>
   <title>système de fichiers pour le démarrage</title>
   <para>
    Le système de fichiers utilisé pour le démarrage (système de fichiers root ou <filename>/boot</filename>) ne doit pas être stocké sur un volume logique LVM. Stockez-le plutôt sur une partition physique normale.
   </para>
  </warning>
  <para>
   Si vous souhaitez modifier votre emplacement <filename>/usr</filename> ou <systemitem>swap</systemitem>, reportez-vous à la section <xref linkend="pro.boot.linuxrc.lvm"/>.
  </para>
  <para os="sles">
   Pour plus de détails sur LVM, reportez-vous au <xref linkend="stor_admin"/>.
  </para>
 </sect2>
</sect1>
