<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="vnc.xml" version="5.0" xml:id="cha.vnc">
 <title>使用 VNC 远程访问</title>
 <info>
      <abstract>
        <para>
    利用虚拟网络计算（Virtual Network Computing，VNC）可以通过图形桌面控制远程计算机（与远程外壳访问相对）。VNC 是独立于平台的并允许您从任何操作系统访问远程计算机。
   </para>
        <para>
    <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> 支持两种不同种类的 VNC 会话：自客户端启动起在 VNC 连接期间<quote>在线</quote>的一次性会话和始终<quote>在线</quote>直到被明确终止的永久会话。
   </para>
      </abstract>
      <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
        <dm:bugtracker/>
        <dm:translation>yes</dm:translation>
      </dm:docmanager>
    </info>
    <note>
  <title>会话类型</title>
  <para>
   一台计算机可在不同端口上同时提供两种会话，但当会话打开后不能从一种类型转换为另一种类型。
  </para>
 </note>
 <sect1 xml:id="sec.vnc.one-time">
  <title>一次性 VNC 会话</title>

  <para>
   一次性会话由远程客户端启动。它在服务器上启动图形登录屏幕。这样您可以选择启动会话的用户，并且如果登录管理器支持，还可以选择桌面环境。一旦终止与此类 VNC 会话的客户端连接，则此会话中启动的所有应用程序也将终止。一次性 VNC 会话不能共享，但可以在一台主机上同时存在多个会话。
  </para>

  <procedure xml:id="pro.vnc.one-time.activate">
   <title>启用一次性 VNC 会话</title>
   <step>
    <para>
     启动 <menuchoice><guimenu>YaST</guimenu> <guimenu>网络服务</guimenu> <guimenu>远程管理 (VNC)</guimenu></menuchoice>。
    </para>
   </step>
   <step>
    <para>
     选中<guimenu>允许远程管理</guimenu>。
    </para>
   </step>
   <step>
    <para>
     如果需要，还可以选中<guimenu>打开防火墙中的端口</guimenu>（例如，当网络接口配置为在外部区域中时）。如果有多个网络接口，请通过<guimenu>防火墙细节</guimenu>将打开防火墙端口限制为特定的接口。
    </para>
   </step>
   <step>
    <para>
     单击<guimenu>完成</guimenu>确认您的设置。
    </para>
   </step>
   <step>
    <para>
     如果不是所有需要的包都可使用，则需要批准安装缺少的包。
    </para>
   </step>
  </procedure>

  <sect2 xml:id="sec.vnc.one-time.configs">
   <title>可用配置</title>
   <para>
    <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> 上的默认配置对会话使用 1024x768 像素（颜色深度 16 位）。会话在端口 <systemitem class="resource">5901</systemitem>（对于<quote>普通</quote>VNC 查看器，等同于 VNC 显示器 <literal>1</literal>）和端口 <systemitem class="resource">5801</systemitem> 上可用（对于 Web 浏览器）。
   </para>
   <para>
    其他配置可在不同端口上使用<phrase os="sles">，请参见<xref linkend="sec.vnc.one-time.config"/></phrase>。
   </para>
   <para>
    VNC 显示器编号和 X 显示器编号是独立于一次性会话的。VNC 显示器编号手动指派给服务器支持的每个配置（如上例中的 :1）。只要 VNC 会话启动时带任一配置，就会自动获取可用 X 显示器编号。
   </para>
   <para>
    默认情况下，VNC 客户端与服务器将尝试通过安装后生成的自我签名 SSL 证书安全通讯。您可以使用默认的证书，也可以将它替换为您自己的证书。使用自我签名证书时，需要在首次连接之前，在 VNC 查看器和 Web 浏览器中确认证书的签名。Java 客户端是使用与 VNC 相同的证书通过 HTTPS 提供的。
   </para>
  </sect2>

  <sect2 xml:id="sec.vnc.one-time.connect">
   <title>启动一次性 VNC 会话</title>
   <para>
    要启动一次性 VNC 会话，必须在客户端计算机上安装 VNC 查看器。SUSE Linux 产品上的标准查看器是 <systemitem class="resource">tigervnc</systemitem> 包提供的 <command>vncviewer</command>。您也可以使用 Web 浏览器和 Java 小程序查看 VNC 会话。
   </para>
   <para>
    要启动 VNC 查看器并启动带服务器默认配置的会话，请使用以下命令：
   </para>
<screen>vncviewer jupiter.example.com:1</screen>
   <para>
    若不使用 VNC 显示器编号，您也可以指定带两个冒号的端口号：
   </para>
<screen>vncviewer jupiter.example.com::5901</screen>
   <para>
    或者通过在支持 Java 的 Web 浏览器中输入以下 URL 查看 VNC 会话：<literal>http://jupiter.example.com:5801</literal>
   </para>
  </sect2>

  <sect2 xml:id="sec.vnc.one-time.config">
   <title>配置一次性 VNC 会话</title>
   <para>
    如果不需要或想修改默认配置，则可以跳过此部分。
   </para>
   <para>
    一次性 VNC 会话通过 <systemitem class="daemon">xinetd</systemitem> 守护程序启动。配置文件位于 <filename>/etc/xinetd.d/vnc</filename>。默认情况下提供六个配置块：三个用于 VNC 查看器（<literal>vnc1</literal> 到 <literal>vnc3</literal>），另外三个用于 Java 小程序（<literal>vnchttpd1</literal> 到 <literal>vnchttpd3</literal>）。默认情况下，只有 <literal>vnc1</literal> 和 <literal>vnchttpd1</literal> 是活动的。
   </para>
   <para>
    要激活配置，请在第一列用 <literal>#</literal> 字符注释掉 <literal>disable = yes</literal> 行，或者完全删除该行。要停用配置，请取消注释或添加该行。
   </para>
   <para>
    <command>Xvnc</command> 服务器可以通过 <literal>server_args</literal> 选项来配置；有关选项列表，请参见 <command>Xnvc --help</command>。
   </para>
   <para>
    当添加自定义配置时，请确保它们未使用已由其他配置、其他服务或同一主机上的现有永久 VNC 会话使用的端口。
   </para>
   <para>
    通过输入以下命令激活配置更改：
   </para>
<screen>sudo rcxinetd reload</screen>

   <important>
    <title>防火墙和 VNC 端口</title>
    <para>
     按照<xref linkend="pro.vnc.one-time.activate"/> 中的描述激活远程管理时，端口 <systemitem class="resource">5801</systemitem> 和 <systemitem class="resource">5901</systemitem> 将在防火墙中打开。如果用于 VNC 会话的网络接口受防火墙保护，则为 VNC 会话激活更多端口时，需要手动打开各个端口。有关指导，请参见<xref linkend="cha.security.firewall"/>。
    </para>
   </important>
  </sect2>
 </sect1>
 <sect1 xml:id="sec.vnc.persistent">
  <title>持续 VNC 会话</title>

  
  
  <para>
   永久 VNC 会话在服务器上启动。该会话和其上启动的所有应用程序运行时不考虑客户端连接，直到会话被终止。
  </para>

  <para>
   可以从多个客户端同时访问持续 会话。此功能非常适合用于演示，或者教员可能需要访问学员桌面的培训场合。但是，大多数时间，您可能不希望共享您的 VNC 会话。
  </para>

  <para>
   与启动显示管理器的一次性会话不同，永久会话启动的是一个随时可运行的桌面，该桌面以启动 VNC 会话的用户身份运行。对持续会话的访问受口令的保护。
  </para>


  <procedure xml:id="pro.vnc.persistent.activate">
   <title>启动持续 VNC 会话</title>
   <step>
    <para>
     打开外壳，确保以拥有 VNC 会话的用户身份登录。

    </para>
   </step>
   <step>
    <para>
     如果用于 VNC 会话的网络接口受防火墙保护，则需要手动打开防火墙中您的会话所使用的端口。如果启动多个会话，还可以选择打开一个端口范围。有关如何配置防火墙的细节，请参见<xref linkend="cha.security.firewall"/>。
    </para>
    <para>
     <command>vncserver</command> 对显示器 <literal>:1</literal> 使用端口 <systemitem class="resource">5901</systemitem>，对显示器 <literal>:2</literal> 使用端口 <systemitem class="resource">5902</systemitem>，依次类推。对于永久会话，VNC 显示器和 X 显示器通常具有相同编号。
    </para>
   </step>
   <step>
    <para>
     要其他具有 1024x769 像素和颜色深度为 16 的会话，请输入以下命令：
    </para>
<screen>vncserver -geometry 1024x768 -depth 16</screen>
    <para>
     <command>vncserver</command> 命令会在您未指定时选取一个未使用的显示编号，并打印输出它的选择。有关更多选项，请参见 <command>man 1 vncserver</command>。
    </para>
   </step>
  </procedure>

  <para>
   当首次运行 <command>vncviewer</command> 时，它请求完全访问会话的口令。
   
  </para>

  <para>
   这里提供的口令还用于保护同一用户将来启动的会话。可以使用 <command>vncpasswd</command> 命令来更改该口令。
  </para>

  <important>
   <title>安全考虑因素</title>
   <para>
    确保使用长度够长的高强度口令（八个或更多字符）。不要共享这些口令。
   </para>
   <para>
    由于 VNC 连接未加密，可窃听两台计算机间网络的人员可以在会话刚开始时传输口令期间读取口令。
   </para>
  </important>

  <para>
   要终止会话，请从 VNC 查看器中关闭运行于 VNC 会话内的桌面环境，像您关闭普通本地 X 会话那样关闭它。
  </para>

  <para>
   如果希望手动终止会话，请在 VNC 服务器上打开外壳并确保您已作为拥有要终止的 VNC 会话的用户登录。运行以下命令来终止在显示器 <literal>:1</literal> 上运行的会话：<command>vncserver -kill :1</command>
  </para>

  <sect2 xml:id="sec.vnc.persistent.connect">
   <title>连接持续 VNC 会话</title>
   <para>
    要连接持续 VNC 会话，必须安装 VNC 查看器。SUSE Linux 产品上的标准查看器是 <systemitem class="resource">tigervnc</systemitem> 包提供的 <command>vncviewer</command>（默认）。您也可以使用 Web 浏览器和 Java 小程序查看 VNC 会话。
   </para>
   <para>
    要启动 VNC 查看器并连接 VNC 服务器的显示器 <literal>:1</literal>，请使用命令
   </para>
<screen>vncviewer jupiter.example.com:1</screen>
   <para>
    若不使用 VNC 显示器编号，您也可以指定带两个冒号的端口号：
   </para>
<screen>vncviewer jupiter.example.com::5901</screen>
   <para>
    或者通过在支持 Java 的 Web 浏览器中输入以下 URL 查看 VNC 会话：<literal>http://jupiter.example.com:5801</literal>
   </para>
  </sect2>

  <sect2 xml:id="sec.vnc.persistent.configure">
   <title>配置持续 VNC 会话</title>
   <para>
    通过编辑 <filename>$HOME/.vnc/xstartup</filename> 可以配置持续 VNC 会话。默认情况下，此外壳脚本会启动它启动时所处的同一个 GUI/窗口管理器。在 <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> 中，此 GUI/窗口管理器为 GNOME 或 IceWM。如果要使用您选择的窗口管理器启动会话，请设置变量 <envar>WINDOWMANAGER</envar>：
   </para>
<screen>WINDOWMANAGER=gnome vncserver -geometry 1024x768
WINDOWMANAGER=icewm vncserver -geometry 1024x768</screen>
   <note>
    <title>每个用户一种配置</title>
    <para>
     持续 VNC 会话在单个按用户配置中进行配置。由同一个用户启动的多个会话都使用相同的启动文件和口令文件。
    </para>
   </note>
  </sect2>
 </sect1>
</chapter>
