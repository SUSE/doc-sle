<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="sle_update_upgrading.xml" version="5.0" xml:id="cha-update-sle">
 <title>Upgrade di SUSE Linux Enterprise</title>
 <info>
  <abstract>
   <para>
    SUSE® Linux Enterprise (SLE) consente di eseguire l'upgrade di un sistema esistente alla nuova versione. Non è necessaria una nuova installazione. I dati esistenti, quali home directory, directory dei dati e configurazione di sistema, restano invariati. È possibile eseguire l'aggiornamento da un'unità CD o DVD locale o da un'origine dell'installazione di rete centrale.
   </para>

   <para>
    In questo capitolo viene illustrato come eseguire l'upgrade manuale del sistema SUSE Linux Enterprise mediante DVD, la rete, un processo automatico o SUSE Manager.
   </para>
  </abstract>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:translation>sì</dm:translation>
  </dm:docmanager>
 </info>
 <sect1 xml:id="sec-update-sle-paths">
  <title>Percorsi di upgrade a SLE 12 SP5 supportati</title>

<figure xml:id="fig-update-sle-paths-overview">
   <title>Panoramica dei percorsi di upgrade supportati</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata os="sles" fileref="upgrade-paths.svg" width="100%" format="SVG"/>
     
    </imageobject>
    <imageobject role="html">
     <imagedata os="sles" fileref="upgrade-paths.png" width="80%" format="PNG"/>
     
    </imageobject>
   </mediaobject>
  </figure>

  <important>
   <title>gli upgrade tra architetture non sono supportati</title>
   <para>
    Gli upgrade tra architetture, come l'upgrade da una versione a 32 bit di <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> a una versione a 64 bit, oppure l'upgrade da un big endian a un little endian <emphasis>non</emphasis> sono supportati.
   </para>
   <para>
    Nello specifico, <emphasis>non</emphasis> è supportato l'upgrade da SLE 11 su POWER (big endian) a SLE 12 SP2 su POWER (nuovo: little endian).
   </para>
   <para>
    Inoltre, poiché SUSE Linux Enterprise 12 è disponibile solo nella versione a 64 bit, gli upgrade da qualsiasi sistema SUSE Linux Enterprise 11 a 32 bit a SUSE Linux Enterprise 12 e versioni successive <emphasis>non</emphasis> sono supportati.
   </para>
   <para>
    Per eseguire un upgrade tra architetture, è necessario eseguire una nuova installazione.
   </para>
  </important>

  <note>
   <title>Service Pack ignorati</title>
   <para os="sles">
    Il percorso di upgrade più sicuro consiste nel procedere passo passo e installare consecutivamente tutti i Service Pack. In alcuni casi è possibile ignorare 1 o 2 Service Pack quando si esegue l'upgrade. Per ulteriori dettagli, consultare <xref linkend="vl-update-paths-sle-supported"/> e <xref linkend="fig-update-sle-paths-overview"/>. Tuttavia, si consiglia di <emphasis>non</emphasis> ignorare alcun Service Pack.
   </para>
   
  </note>

  <note>
   <title>upgrade alle release principali</title>
   <para>
    Si consiglia di eseguire una nuova installazione per l'upgrade di una nuova release principale.
   </para>
  </note>

  <variablelist xml:id="vl-update-paths-sle-supported">
   <title>Percorsi di upgrade supportati in base alla versione</title>
   <varlistentry>
    <term>Upgrade da SUSE Linux Enterprise 10 (qualsiasi Service Pack)</term>
    <listitem>
     <para>
      Non esistono percorsi di migrazione diretta a SUSE Linux Enterprise 12 supportati. In questo caso si consiglia di eseguire una nuova installazione.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Upgrade da SUSE Linux Enterprise 11 GA / SP1 / SP2 / SP3</term>
    <listitem>
     <para>
      Non esistono percorsi di migrazione diretta a SUSE Linux Enterprise 12 supportati. Per poter passare a SLE 12 SP5, è necessario almeno SLE 11 SP4.
     </para>
     <para>
      Se non è possibile eseguire una nuova installazione, eseguire prima l'upgrade del Service Pack SLE 11 a SLE 11 SP4. Questa procedura è descritta nella <citetitle><citetitle>Guida alla distribuzione</citetitle></citetitle> di SUSE Linux Enterprise 11: <link os="sles" xlink:href="https://documentation.suse.com/sles-11/"/>.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Upgrade da SUSE Linux Enterprise 11 SP4</term>
    <listitem>
     <para>
      L'upgrade da SLE 11 SP5 a SLE 12 SP4 è supportato solo offline. Per ulteriori dettagli, vedere <xref linkend="cha-update-offline"/>.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Upgrade da SUSE Linux Enterprise 12 GA/SP1/SP2 a SP5</term>
    <listitem>
     <para>
      Gli upgrade diretti da SLE 12 GA, SP1 o SP2 a SP5 non sono supportati. Eseguire prima l'upgrade a SLE 12 <phrase os="sles">SP3 o</phrase> SP4.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Upgrade da SUSE Linux Enterprise 12 SP3/SP4 a SP5</term>
    <listitem>
     <para>
      L'upgrade da SUSE Linux Enterprise 12 SP3 o SP4 a SP5 è supportato.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry os="sles">
    <term>Upgrade da SUSE Linux Enterprise 12 LTSS GA/SP1 a SP5</term>
    <listitem>
     <para>
      Gli upgrade diretti da SUSE Linux Enterprise 12 LTSS GA o SP1 a SP5 non sono supportati. Prima è necessario eseguire l'upgrade a SLE 12 LTSS SP2.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry os="sles">
    <term>Upgrade da SUSE Linux Enterprise 12 LTSS SP2/SP3/SP4 a SP5</term>
    <listitem>
     <para>
      L'upgrade da SUSE Linux Enterprise 12 LTSS SP2, SP3 o SP4 a SP5 è supportato.
     </para>
    </listitem>
   </varlistentry>
  </variablelist>
 </sect1>
 <sect1 xml:id="sec-update-sle-methods">
  <title>Upgrade online e offline</title>
  <para>
   SUSE supporta due metodi di upgrade e migrazione diversi. Per ulteriori informazioni sulla terminologia, vedere <xref linkend="sec-update-sle-terminology"/>. Tali metodi sono:
  </para>

  <variablelist>
   <varlistentry>
    <term>Online</term>
    <listitem>
     <para>
      Tutti gli upgrade eseguiti dal sistema in esecuzione sono considerati online. Esempi: connessione tramite SUSE Customer Center, Subscription Management Tool (SMT), SUSE Manager tramite Zypper o YaST.
     </para>
     <para>
      Quando si esegue la migrazione tra Service Pack della stessa release principale, si consiglia la seguente <xref linkend="sec-update-migr-yast-onlinemigr"/> o <xref linkend="sec-update-migr-zypper-onlinemigr"/>.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Offline</term>
    <listitem>
     <para>
      In genere i metodi offline vengono avviati da un sistema operativo diverso da quello di cui viene eseguito l'upgrade della versione SLE installata. Esempi: DVD, disco flash, immagine ISO, AutoYaST, <quote> RPM semplice</quote> o avvio PXE.
     </para>
    </listitem>
   </varlistentry>
  </variablelist>
  <important>
   <title>Client SUSE Manager</title>
   <para>
    Se il computer è gestito da SUSE Manager, è necessario avviare la procedura di upgrade nell'interfaccia di gestione. Per informazioni, vedere <xref linkend="sec-update-sle-manager"/>.
   </para>
  </important>
 </sect1>

 <sect1 xml:id="sec-update-prep">
  <title>Preparazione del sistema</title>
  <para>
   Prima di iniziare la procedura di upgrade, assicurarsi che il sistema sia preparato correttamente. Tra le varie operazioni, la preparazione prevede il backup dei dati e il controllo delle note di rilascio.
  </para>

  <sect2 xml:id="sec-update-prep-update">
   <title>Assicurarsi che il sistema attuale sia aggiornato</title>
   <para>
    L'upgrade del sistema è supportato solo dal livello di patch più recente. Assicurarsi che siano installati gli ultimi aggiornamenti del sistema eseguendo <command>zypper patch</command> o avviando il modulo YaST <guimenu>Online-Update</guimenu>.
   </para>
  </sect2>

  <sect2 xml:id="sec-update-prep-relnotes">
   <title>Lettura delle note di rilascio</title>
   <para>
    Nelle note di rilascio è possibile trovare informazioni aggiuntive sulle modifiche apportate rispetto alla release precedente di <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase>. Controllare le note di rilascio per vedere se:
   </para>
   <itemizedlist>
    <listitem>
     <para>
      l'hardware necessita di considerazioni speciali;
     </para>
    </listitem>
    <listitem>
     <para>
      i pacchetti software utilizzati hanno subito modifiche significative;
     </para>
    </listitem>
    <listitem>
     <para>
      è necessario adottare precauzioni speciali per l'installazione.
     </para>
    </listitem>
   </itemizedlist>
   <para>
    Le note di rilascio forniscono inoltre informazioni che non si è fatto in tempo a riportare nel manuale. Contengono anche alcune note su problemi noti.
   </para>
   <para os="sles">
    Se si ignora uno o più Service Pack, controllare anche nelle note di rilascio le informazioni relative al Service Pack ignorato. In genere le note di rilascio contengono solo le differenze tra due release consecutive. Se si leggono solo le note di rilascio attuali, si potrebbero perdere importanti modifiche apportate rispetto alla release precedente.
   </para>
   <para>
    Individuare localmente le note di rilascio nella directory <filename>/usr/share/doc/release-notes</filename> o online all'indirizzo <link xlink:href="https://www.suse.com/releasenotes/"/>.
   </para>
  </sect2>
  <sect2 xml:id="sec-update-prep-backup">
   <title>Esecuzione del backup</title>
   <para>
    Prima di eseguire l'aggiornamento, copiare i file di configurazione esistenti su un supporto separato (ad esempio un dispositivo a nastro, un disco rigido rimovibile e così via) per eseguire il backup dei dati. Questo vale soprattutto per i file memorizzati in <filename>/etc</filename> e per alcuni file e directory in <filename>/var</filename> e <filename>/opt</filename>. Può anche essere opportuno salvare i dati dell'utente contenuti <filename>/home</filename> (ovvero le directory <envar>HOME</envar>) su un supporto di backup. Eseguire il backup di questi dati come <systemitem class="username">root</systemitem>. Infatti solo gli utenti <systemitem class="username">root</systemitem> dispongono delle autorizzazioni di lettura per tutti i file locali.
   </para>
   <para>
    Se in YaST si è selezionata la modalità di installazione <guimenu>Aggiornamento di un sistema esistente</guimenu>, è possibile scegliere di eseguire un backup (del sistema) in un momento successivo. È possibile includere tutti i file modificati e i file della directory <filename>/etc/sysconfig</filename>. Si tratta tuttavia di un backup parziale in quanto mancano tutte le altre directory importanti indicate sopra. Trovare il backup nella directory <filename>/var/adm/backup</filename>.
   </para>
   <sect3 xml:id="sec-update-prep-backup-packagelist">
    <title>Elenco dei pacchetti installati e degli archivi</title>
    <para>
     Spesso è utile disporre di un elenco dei pacchetti installati, ad esempio quando si esegue una nuova installazione di una release principale di SLE o si ripristina la versione precedente.
    </para>
    <para>
     È opportuno sapere che nelle release più recenti di SUSE Linux Enterprise, non tutti i pacchetti installati o gli archivi utilizzati sono disponibili. Alcuni potrebbero essere stati rinominati e altri sostituiti. È inoltre possibile che alcuni pacchetti siano ancora disponibili per poter essere utilizzati quando per default è in uso un altro pacchetto. Pertanto, potrebbe essere necessario apportare manualmente alcune modifiche ai file. A tal fine, è possibile utilizzare un editor di testo.
    </para>
    <para>
     Creare un file denominato <filename>repositories.bak</filename> contenente un elenco di tutti gli archivi utilizzati:
    </para>
    <screen><prompt role="root">root # </prompt><command>zypper</command> lr -e repositories.bak</screen>
    <para>
     Creare anche un file denominato <filename>installed-software.bak</filename> contenente un elenco di tutti i pacchetti installati:
    </para>
    <screen><prompt role="root">root # </prompt><command>rpm</command> -qa --queryformat '%{NAME}\n' &gt; installed-software.bak</screen>
    <para>
     Eseguire il backup di entrambi i file. È possibile ripristinare gli archivi e i pacchetti installati con i seguenti comandi:
    </para>
    <screen><prompt role="root">root # </prompt><command>zypper</command> ar repositories.bak
<prompt role="root">root # </prompt><command>zypper</command> install $(cat installed-software.bak)</screen>

    <note xml:id="note-update-prep-backup-package-amount">
     <title>
      la quantità di pacchetti aumenta con l'aggiornamento a una nuova release principale
     </title>
     <para>
      Un sistema di cui si è eseguito l'upgrade a una nuova versione principale (SLE <replaceable>X+1</replaceable>) può contenere più pacchetti rispetto al sistema iniziale (SLE <replaceable>X</replaceable>). Contiene anche più pacchetti rispetto a una nuova installazione di SLE <replaceable>X+1</replaceable> con la stessa selezione di modelli. I motivi di questo comportamento sono i seguenti:
     </para>
     <itemizedlist>
      <listitem>
       <para>
        I pacchetti sono stati suddivisi per consentire una selezione più granulare degli stessi. Ad esempio, 37 <package>pacchetti texlive</package> su SLE 11 sono stati suddivisi in 422 pacchetti su SLE 12.
       </para>
      </listitem>
      <listitem>
       <para>
        Quando un pacchetto è suddiviso in altri pacchetti, tutti i nuovi pacchetti vengono installati nell'upgrade in modo che mantengano le stesse funzionalità della versione precedente. Per una nuova installazione di SLE <replaceable>X+1</replaceable> è tuttavia possibile che il nuovo default sia di non installare tutti i pacchetti.
       </para>
      </listitem>
      <listitem>
       <para>
        È possibile che i pacchetti esistenti in SLE <replaceable>X</replaceable> siano stati mantenuti ai fini della compatibilità.
       </para>
      </listitem>
      <listitem>
       <para>
        Le dipendenze dei pacchetti e l'ambito dei modelli potrebbero essere stati modificati.
       </para>
      </listitem>
     </itemizedlist>
    </note>
   </sect3>
  </sect2>

  <sect2 xml:id="sec-update-prep-mariadb">
   <title>Migrazione del database MySQL</title>
   <remark>toms 2015-09-03: already reviewed by Ondrej and Kristýna.</remark>
   <para>
    A partire da SUSE Linux Enterprise 12, SUSE è passato da MySQL a MariaDB. Prima di iniziare un upgrade, si consiglia vivamente di eseguire il backup del database.
   </para>

   <para>
    Per eseguire la migrazione del database, procedere come segue:
   </para>
   <procedure>
    <step>
     <para>
      Eseguire il login al computer con SUSE Linux Enterprise 11.
     </para>
    </step>
    <step>
     <para>
      Creare un file di dump:
     </para>
<screen><prompt role="root">root # </prompt><command>mysqldump</command> -u root -p --all-databases &gt; mysql_backup.sql</screen>
     <para>
      Per default, <command>mysqldump</command> non effettua il dump del database <literal>INFORMATION_SCHEMA</literal> o <literal>performance_schema</literal>. Per ulteriori informazioni, fare riferimento a <link xlink:href="https://dev.mysql.com/doc/refman/5.5/en/mysqldump.html"/>.
     </para>
    </step>
    <step>
     <para>
      Memorizzare in un luogo sicuro il file di dump, il file di configurazione <filename>/etc/my.cnf</filename> e la directory <filename>/etc/mysql/</filename> per analizzarli in seguito (<emphasis>NON</emphasis> per l'installazione!).
     </para>
    </step>
    <step>
     <para>
      Eseguire l'upgrade. Dopo l'upgrade, il file di configurazione precedente <filename>/etc/my.cnf</filename> resta inalterato. È possibile trovare la nuova configurazione nel file <filename>/etc/my.cnf.rpmnew</filename>.
     </para>
    </step>
    <step>
     <para>
      Configurare il database MariaDB in base alle proprie esigenze. <emphasis>NON</emphasis> utilizzare il file di configurazione e la directory precedenti se non come promemoria da adeguare alla situazione specifica.
     </para>
    </step>
    <step>
     <para>
      Avviare il server MariaDB:
     </para>
<screen><prompt role="root">root # </prompt><command>systemctl</command> start mysql</screen>
     <para>
      Se si desidera avviare il server MariaDB a ogni avvio, attivare il servizio:
     </para>
<screen><prompt role="root">root # </prompt><command>systemctl</command> enable mysql</screen>

    </step>
    <step>
     <para>
      Verificare che MariaDB sia in esecuzione connettendolo al database:
     </para>
<screen><prompt role="root">root # </prompt><command>mysql</command> -u root -p</screen>
    </step>
   </procedure>
  </sect2>

  <sect2 xml:id="sec-update-prep-postgresql">
   <title>Migrazione del database PostgreSQL</title>
   <para>
    Una versione più recente del database PostgreSQL viene fornita come aggiornamento di manutenzione. A causa del lavoro richiesto per la migrazione del database, non è disponibile alcun processo di upgrade automatico. Il passaggio da una versione all'altra deve essere pertanto effettuato manualmente.
   </para>
   <para>
    Il processo di migrazione viene eseguito mediante il comando <command>pg_upgrade</command>, un metodo alternativo al classico dump e ricaricamento. Rispetto al metodo <quote>dump e ricaricamento</quote>, <command>pg_upgrade</command>, rende più rapida la migrazione.
   </para>
   <para>
    I file di programma per ciascuna versione di PostgreSQL vengono memorizzati in directory diverse in base alla versione. Ad esempio, in <filename>/usr/lib/postgresql96/</filename> per la versione 9.6 e in <filename>/usr/lib/postgresql10/</filename> per la versione 10. Tenere presente che la policy del controllo versioni di PostgreSQL è stata modificata dalla versione principale 9.6 alla versione principale 10. Per informazioni, vedere <link xlink:href="https://www.postgresql.org/support/versioning/"/>.
   </para>
   <important>
    <title>upgrade da SLE 11</title>
     <para>
      Quando si esegue l'upgrade da SLE 11, <systemitem>postgresql94</systemitem> verrà disinstallato e non sarà possibile utilizzarlo per la migrazione del database a una versione successiva di PostgreSQL. Pertanto, in questo caso assicurarsi di eseguire la migrazione del database PostgreSQL <emphasis>prima</emphasis> di eseguire l'upgrade del sistema.
    </para>
   </important>
   <para>
    Nella procedura riportata di seguito è descritta la migrazione del database dalla versione 9.6 alla 10. Quando si utilizza una versione diversa come avvio o destinazione, sostituire i numeri di versione di conseguenza.
   </para>
   <para>
    Per eseguire la migrazione del database, procedere come segue:
   </para>
   <procedure>
    <step>
     <para>
      Verificare che siano soddisfatte le seguenti condizioni preliminari:
     </para>
     <itemizedlist>
      <listitem>
       <para>
        Eseguire l'upgrade di tutti i pacchetti della versione precedente di PostgreSQL all'ultima release mediante un aggiornamento di manutenzione.
       </para>
      </listitem>
      <listitem>
       <para>
        Creare una copia di backup del database esistente.
       </para>
      </listitem>
      <listitem>
       <para>
        Installare i pacchetti della nuova versione principale di PostgreSQL. Per SLE12 SP5 questo prevede l'installazione di
        <package>postgresql10-server</package>
        e di tutti i pacchetti da cui dipende.
       </para>
      </listitem>
      <listitem>
       <para>
        Installare il pacchetto
        <package>postgresql10-contrib</package>
        contenente il comando <command>pg_upgrade</command>.
       </para>
      </listitem>
      <listitem>
       <para>
        Verificare che sia disponibile spazio sufficiente nell'area dati di PostgreSQL, che per default è <filename>/var/lib/pgsql/data</filename>. Se lo spazio è limitato, provare a ridurre le dimensioni con il comando SQL seguente su ciascun database. Questa operazione può richiedere molto tempo:
       </para>
<screen>VACUUM FULL</screen>
      </listitem>
     </itemizedlist>
    </step>
    <step>
     <para>
      Interrompere il server PostgreSQL in uno dei seguenti modi:
     </para>
<screen><prompt role="root">root # </prompt><command>/usr/sbin/rcpostgresql</command> stop</screen>
    <para>oppure</para>
<screen><prompt role="root">root # </prompt>systemctl stop postgresql.service</screen>
    <para>(a seconda della versione SLE utilizzata come versione iniziale per l'upgrade).</para>
    </step>
    <step>
     <para>
      Ridenominare la directory dei dati precedente:
     </para>
<screen><prompt role="root">root # </prompt><command>mv</command> /var/lib/pgsql/data /var/lib/pgsql/data.old</screen>
    </step>
    
    <step>
     <para>
      Inizializzare la nuova istanza di database manualmente con il comando <command>initdb</command> o in modo automatico avviando e arrestando il server PostgreSQL:
     </para>
<screen><prompt role="root">root # </prompt><command>/usr/sbin/rcpostgresql</command> start
<prompt role="root">root # </prompt><command>/usr/sbin/rcpostgresql</command> stop</screen>
     <para>oppure</para>
<screen><prompt role="root">root # </prompt>systemctl start postgresql.service
<prompt role="root">root # </prompt>systemctl stop postgresql.service</screen>
     <para>(a seconda della versione SLE utilizzata come versione iniziale per l'upgrade).</para>
    </step>
    <step>
     <para>
      Se i file di configurazione nella versione precedente sono stati modificati, si consiglia di riportare tali modifiche nei nuovi file di configurazione. Ciò potrebbe avere un impatto sui file <filename>postgresql.auto.conf</filename>, <filename>postgresql.conf</filename>, <filename>pg_hba.conf</filename> e <filename>pg_ident.conf</filename>. Le versioni precedenti di questi file si trovano in <filename>/var/lib/pgsql/data.old/</filename>, mentre le nuove versioni sono disponibili in <filename>/var/lib/pgsql/data</filename>.
     </para>
     <para>
      Non è consigliabile limitarsi a copiare i file di configurazione precedenti, in quanto tale operazione può comportare la sovrascrittura delle nuove opzioni, delle nuove impostazioni di default e dei commenti modificati.
     </para>
    </step>
    <step>
     <para>
      Avviare il processo di migrazione come utente <systemitem class="username">postgres</systemitem>:
     </para>
<screen><prompt role="root">root # </prompt>su - postgres
postgres &gt; <command>pg_upgrade</command> \
   --old-datadir "/var/lib/pgsql/data.old" \
   --new-datadir "/var/lib/pgsql/data" \
   --old-bindir "/usr/lib/postgresql96/bin/" \
   --new-bindir "/usr/lib/postgresql10/bin/"</screen>
    </step>
    <step>
     <para>
      Avviare la nuova istanza del database in uno dei seguenti modi:
     </para>
<screen><prompt role="root">root # </prompt><command>/usr/sbin/rcpostgresql</command> start</screen>
     <para>oppure</para>
<screen><prompt role="root">root # </prompt>systemctl start postgresql.service</screen>
     <para>(a seconda della versione SLE utilizzata come versione iniziale per l'upgrade).</para>
    </step>
    <step>
     <para>
      Controllare che la migrazione sia stata eseguita correttamente. L'ambito del test dipende da ogni singolo caso di utilizzo: Non esiste uno strumento generico che possa automatizzare questo passaggio.
     </para>
    </step>
    <step>
     <para>
      Rimuovere tutti i pacchetti di PostgreSQL e la directory dei dati precedenti:
     </para>
<screen><prompt role="root">root # </prompt><command>zypper</command> search -s postgresql96 | xargs zypper rm -u
<prompt role="root">root # </prompt><command>rm</command> -rf /var/lib/pgsql/data.old</screen>
    </step>
   </procedure>
  </sect2>

  <sect2 xml:id="sec-update-prep-ssl">
   <title>Creare certificati server non MD5 per applicazioni Java</title>
   <remark>toms 2016-07-27: from bsc#970153, c#24</remark>
   <para>
    Durante l'aggiornamento da SP1 a SP2, i certificati basati su MD5 sono stati disabilitati all'interno di una correzione di sicurezza. Se sono presenti certificati creati come MD5, ricrearli seguendo la procedura indicata:
   </para>

   <procedure>
    <step>
     <para>
      Aprire un terminale ed eseguire il login come <systemitem class="username">root</systemitem>.
     </para>
    </step>
    <step>
     <para>
      Creare una chiave privata:
     </para>
     <screen><prompt role="root">root # </prompt><command>openssl</command> genrsa -out server.key 1024</screen>
     <para>
      Se si desidera una chiave più sicura, sostituire <literal>1024</literal> con un numero più alto, ad esempio, <literal>4096</literal>.
     </para>
    </step>
    <step>
     <para>
      Creare una richiesta di firma del certificato (CSR):
     </para>
     <screen><prompt role="root">root # </prompt><command>openssl</command> req -new -key server.key -out server.csr</screen>
    </step>
    <step>
     <para>
      Firmare il certificato:
     </para>
     <screen><prompt role="root">root # </prompt><command>openssl</command> x509 -req -days 365 -in server.csr -signkey server.key -out server.crt</screen>
    </step>
    <step>
     <para>
      Creare il file PEM:
     </para>
     <screen><prompt role="root">root # </prompt><command>cat</command> server.key server.crt &gt; server.pem</screen>
    </step>
    <step>
     <para>Spostare i file <filename>server.crt</filename>, <filename>server.csr</filename>, <filename>server.key</filename> e <filename>server.pem</filename> nelle directory rispettive dove si trovano le chiavi. Per Tomcat, ad esempio, la directory è <filename>/etc/tomcat/ssl/</filename>.
     </para>
    </step>
   </procedure>
  </sect2>

  <sect2 xml:id="sec-update-prep-vms">
   <title>Chiusura dei guest delle macchine virtuali</title>
   <para>
    Se il computer funge da server host per macchine virtuali per KVM o Xen, assicurarsi di spegnere correttamente tutti i guest delle macchine virtuali prima dell'aggiornamento. altrimenti l'accesso ai guest dopo l'aggiornamento potrebbe risultare impossibile.
   </para>
  </sect2>

  <sect2 xml:id="sec-update-prep-smt">
   <title>Regolazione della configurazione del client SMT</title>
   <para>
    Se il computer di cui si desidera effettuare l'upgrade è registrato come client di un server SMT, eseguire le seguenti operazioni:
   </para>
   <para>
    Verificare che la versione dello script <command>clientSetup4SMT.sh</command> sull'host sia aggiornata. <command>clientSetup4SMT.sh</command> dalle versioni precedenti di SMT non è in grado di gestire i client SMT 12. Se si applicano regolarmente patch software sul server SMT, è sempre possibile trovare la versione più recente di <command>clientSetup4SMT.sh</command> in <filename>&lt;SMT_HOSTNAME&gt;/repo/tools/clientSetup4SMT.sh</filename>.
   </para>

   <para>
    Qualora l'upgrade del computer a una versione successiva di <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> risultasse impossibile, annullare la registrazione del computer dal server SMT come descritto in <xref linkend="pro-sec-update-prep-smt-de-register" xrefstyle="select:label"/>. Riavviare quindi il processo di upgrade.</para>
   <procedure xml:id="pro-sec-update-prep-smt-de-register">
    <title>Annullamento della registrazione di un client SUSE Linux Enterprise da un server SMT</title>
     <step>
      <para>
       Eseguire il login sul computer client.
      </para>
     </step>
     <step>
     <para>Il passaggio seguente dipende dal sistema operativo del client:</para>
     <itemizedlist>
      <listitem>
       <para>
        Per SUSE Linux Enterprise 11, eseguire i seguenti comandi:
       </para>
<screen><prompt>tux &gt; </prompt><command>sudo</command> suse_register -E
<prompt>tux &gt; </prompt><command>sudo</command> rm -f /etc/SUSEConnect
<prompt>tux &gt; </prompt><command>sudo</command> rm -rf /etc/zypp/credentials.d/*
<prompt>tux &gt; </prompt><command>sudo</command> rm -rf /etc/zypp/repos.d/*
<prompt>tux &gt; </prompt><command>sudo</command> rm -f /etc/zypp/services.d/*
<prompt>tux &gt; </prompt><command>sudo</command> rm -f /var/cache/SuseRegister/*
<prompt>tux &gt; </prompt><command>sudo</command> rm -f /etc/suseRegister*
<prompt>tux &gt; </prompt><command>sudo</command> rm -f /var/cache/SuseRegister/lastzmdconfig.cache
<prompt>tux &gt; </prompt><command>sudo</command> rm -f /etc/zmd/deviceid
<prompt>tux &gt; </prompt><command>sudo</command> rm -f /etc/zmd/secret</screen>
      </listitem>
      <listitem>
       <para>
        Per SUSE Linux Enterprise 12, eseguire i seguenti comandi:
       </para>
<screen><prompt>tux &gt; </prompt><command>sudo</command> SUSEConnect --de-register
<prompt>tux &gt; </prompt><command>sudo</command> SUSEConnect --cleanup
<prompt>tux &gt; </prompt><command>sudo</command> rm -f /etc/SUSEConnect
<prompt>tux &gt; </prompt><command>sudo</command> rm -rf /etc/zypp/credentials.d/*
<prompt>tux &gt; </prompt><command>sudo</command> rm -rf /etc/zypp/repos.d/*
<prompt>tux &gt; </prompt><command>sudo</command> rm -f /etc/zypp/services.d/*</screen>
      </listitem>
     </itemizedlist>
    </step>
    <step>
     <para>
      Eseguire il login al server SMT.
     </para>
    </step>
    <step>
     <para>
      Verificare che l'annullamento della registrazione del client sia stato completato visualizzando l'elenco di tutte le registrazioni client:
     </para>
<screen><prompt>tux &gt; </prompt><command>sudo</command> smt-list-registrations</screen>
    </step>
    <step>
     <para>
      Se il nome host del client risulta ancora nell'output del comando, ottenere l'<literal>ID univoco</literal> dalla prima colonna (nell'elenco potrebbero essere presenti più ID per il client).
     </para>
    </step>
    <step>
     <para>
      Eliminare la registrazione per il client specificato:
     </para>
<screen><prompt>tux &gt; </prompt><command>sudo</command> smt-delete-registration -g <replaceable>UNIQUE_ID</replaceable></screen>
    </step>
     <step>
     <para>
      Se nell'elenco risultano più ID per il client, ripetere il passaggio indicato sopra per ciascun ID univoco.
     </para>
    </step>
    <step>
     <para>
      Verificare che l'annullamento della registrazione del client sia completato eseguendo:
     </para>
<screen><prompt>tux &gt; </prompt><command>sudo</command> smt-list-registrations</screen>
    </step>
   </procedure>
  </sect2>

  <sect2 xml:id="sec-update-disk">
   <title>Spazio su disco</title>

   <para>
    I programmi tendono a crescere da una versione all'altra. Quindi, prima di effettuare un aggiornamento, controllare lo spazio disponibile nella partizione. Se si teme di esaurire lo spazio su disco, eseguire il backup dei dati prima di incrementare lo spazio disponibile, ad esempio ridimensionando le partizioni. Non esiste una regola generale in merito allo spazio che deve essere disponibile in ogni partizione. I requisiti di spazio dipendono dal particolare profilo di partizionamento e dal software selezionato.
   </para>

   <note>
    <title>verifica automatica della disponibilità di spazio sufficiente in YaST</title>
    <para>
     Durante la procedura di aggiornamento YaST controlla la quantità di spazio su disco disponibile su disco e visualizza un avviso se vi è la possibilità che l'installazione superi tale valore. In questo caso, l'aggiornamento potrebbe <emphasis>rendere inutilizzabile il sistema</emphasis>. È possibile ignorare l'avviso e continuare con l'aggiornamento solo se si sa esattamente cosa si sta facendo (sulla base dei test eseguiti in precedenza).
    </para>
   </note>

   <sect3 xml:id="sec-update-disk-space">
    <title>Verifica dello spazio su disco nei file system diversi da Btrfs</title>
    <para>
     Per visualizzare lo spazio disponibile su disco, utilizzare il comando <command>df</command>. Come nell'<xref linkend="aus-update-df"/>, la partizione radice è <filename>/dev/sda3</filename> (montata come <filename>/</filename>).
    </para>
    <example xml:id="aus-update-df">
     <title>Visualizzare l'elenco con il comando <command>df -h</command></title>

<screen os="sles">Filesystem     Size  Used Avail Use% Mounted on
/dev/sda3       74G   22G   53G  29% /
tmpfs          506M     0  506M   0% /dev/shm
/dev/sda5      116G  5.8G  111G   5% /home
/dev/sda1       44G    4G   40G   9% /data</screen>
    </example>
   </sect3>

   <sect3 xml:id="sec-update-disk-btrfs-on-root">
    <title>Verifica dello spazio su disco nei file system Btrfs</title>
    <para>
     Se si utilizza Btrfs come file system radice nel computer in uso, assicurarsi di disporre di spazio sufficiente. Nel caso peggiore, per un upgrade è necessaria la stessa quantità di spazio su disco del file system radice attuale (senza <filename>/.snapshot</filename>) per un nuovo snapshot. Per visualizzare lo spazio su disco disponibile, usare il comando:
    </para>
<screen><prompt role="root">root # </prompt><command>df</command> -h /</screen>
    <para>
     Verificare lo spazio disponibile anche su tutte le altre partizioni montate. Sono stati comprovati i seguenti consigli:
    </para>
    <itemizedlist>
     <listitem>
      <para>
       Per tutti i file system, incluso Btrfs, è necessario spazio su disco sufficiente a effettuare il download e installare RPM di grandi dimensioni. Lo spazio degli RPM precedenti viene liberato solo dopo l'installazione di nuovi RPM.
      </para>
     </listitem>
     <listitem>
      <para>
       Per il file system Btrfs con snapshot, è necessaria almeno la stessa quantità di spazio su disco richiesta per l'installazione corrente. È consigliabile avere a disposizione il doppio dello spazio occupato dall'installazione corrente.
      </para>
      <para>
       Se lo spazio libero non è sufficiente, provare a eliminare gli snapshot precedenti con il comando <command>snapper</command>:
      </para>
<screen><prompt role="root">root # </prompt><command>snapper</command> list
<prompt role="root">root # </prompt><command>snapper</command> delete NUMBER</screen>
      <para>
       Questa soluzione tuttavia potrebbe non funzionare in tutti i casi. Prima della migrazione, la maggior parte degli snapshot occupa una quantità ridotta di spazio.
      </para>
     </listitem>
    </itemizedlist>
   </sect3>
  </sect2>
  <sect2 xml:id="sec-update-prep-multiversion">
   <title>Disabilitazione temporanea del supporto di più versioni del kernel</title>
   <para>
    <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> consente l'installazione di più versioni del kernel, abilitando le impostazioni corrispondenti in <filename>/etc/zypp/zypp.conf</filename>. Per eseguire l'upgrade di un Service Pack, il supporto di tale funzione deve essere temporaneamente disabilitato e può essere nuovamente abilitato al termine dell'aggiornamento. Per disabilitare il supporto di più versioni, trasformare in commento le righe corrispondenti in <filename>/etc/zypp/zypp.conf</filename>. Il risultato deve assomigliare a quello riportato di seguito:
   </para>
<screen>#multiversion = provides:multiversion(kernel)
#multiversion.kernels = latest,running</screen>
   <para>
    Per riattivare la funzione al termine dell'aggiornamento, rimuovere i segni di commento. Per ulteriori informazioni sul supporto di più versioni, vedere <xref linkend="cha-tuning-multikernel-enable"/>.
   </para>
  </sect2>
 </sect1>
 <sect1 xml:id="sec-update-sle-sle12zseries" os="sles">
  <title>Upgrade su IBM Z</title>
  <para>Per l'upgrade di un'installazione SUSE Linux Enterprise su IBM Z è necessario il parametro del kernel <command>Upgrade=1</command>, ad esempio tramite parmfile. Vedere <xref linkend="sec-appdendix-parm" xrefstyle="HeadingOnPage"/>.
  </para>
 </sect1>
 <sect1 xml:id="sec-update-prep-ppc-x" os="sles" arch="power">
  <title>IBM POWER: avvio di un server X</title>
  <para>
   In SLES 12 per IBM POWER, per default il display manager è configurato in modo che non venga avviato un server X locale. In SLES 12 SP1 tale impostazione è stata invertita e ora il display manager avvia un server X.
  </para>
  <para>
   Per evitare problemi durante l'upgrade, l'impostazione di <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> non viene modificata automaticamente. Affinché il display manager avvii un server X dopo l'upgrade, modificare come segue l'impostazione <envar>DISPLAYMANAGER_STARTS_XSERVER</envar> in <filename>/etc/sysconfig/displaymanager</filename>:
  </para>
  <screen>DISPLAYMANAGER_STARTS_XSERVER="yes"</screen>
 </sect1>
</chapter>
