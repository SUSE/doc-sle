<?xml version="1.0" encoding="UTF-8"?>
<sect1 xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="security_ldap_ca.xml" version="5.0" xml:id="sec-security-ldap-server-ca">
 <info>
  <title>导入 TLS 服务器证书和密钥</title>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:translation>yes</dm:translation>
  </dm:docmanager>
 </info>
 <para>
  可以使用以下命令行工具管理 389 Directory Server 的 CA 证书和密钥：<command>certutil</command>、<command>openssl</command> 和 <command>pk12util</command>。
 </para>
 <para>
  可以使用在您创建新的 389 DS 实例时由 <command>dscreate</command> 创建的自我签名证书进行测试。在 <filename>/etc/dirsrv/slapd-<replaceable>INSTANCE-NAME</replaceable>/ca.crt</filename> 中可以找到该证书。
  </para>
  <para>
    对于生产环境，最佳实践是使用第三方证书颁发机构，例如 Let&apos;s Encrypt、CAcert.org、SSL.com 或您选择的任何 CA。请求服务器证书、客户端证书和根证书。
  </para>
 <procedure>
  <important>
  <para>
  Mozilla NSS（网络安全服务）工具包会使用证书存储区中所含证书的昵称。服务器证书使用昵称 <emphasis>Server-Cert</emphasis>。
  </para>
  </important>
 <step>
  <para>
   使用以下命令从实例中去除 Self-Signed-CA 和 Server-Cert：
  </para>
<screen><prompt>&gt; </prompt><command>sudo</command> <command>dsctl <replaceable>INSTANCE_NAME</replaceable> tls remove-cert Self-Signed-CA</command>
<prompt>&gt; </prompt><command>sudo</command> <command>dsctl <replaceable>INSTANCE_NAME</replaceable> tls remove-cert Server-Cert
</command>
</screen>

  <para>
   将 <replaceable>INSTANCE_NAME</replaceable> 替换为目录服务器的实例名称。在前几节中，该名称就是 LDAP1。
  </para>
 </step>
 <step>
   <para>
    导入为您的证书签名的 CA。
   </para>
   <screen><prompt>&gt; </prompt><command>sudo</command> <command>sudo dsctl <replaceable>INSTANCE_NAME</replaceable> tls import-ca
   /path/to/CA/in/PEM/format/CA.pem  <replaceable>NICKNAME_FOR_CA</replaceable>
</command>
</screen>
<para>将 <literal>INSTANCE_NAME</literal> 替换为目录服务器的实例名称。将 <literal>/path/to/CA/in/PEM/format/CA.pem</literal> 替换为 PEM 格式的 CA 证书文件的完整路径。将 <literal>NICKNAME_FOR_CA </literal> 替换为 CA 的昵称。 </para>
 </step>
 <step>
  <para>
   导入服务器证书和证书的密钥。
  </para>
  <screen><prompt>&gt; </prompt><command>sudo</command> <command>dsctl <replaceable>INSTANCE_NAME</replaceable> tls import-server-key-cert
  <replaceable>/path/to/SERVER.pem</replaceable> <replaceable>/path/to/SERVER.key</replaceable></command>
  </screen>
  <para> 将 <literal>INSTANCE_NAME</literal> 替换为目录服务器的实例名称。将 <literal>/path/to/SERVER.pem</literal> 替换为 PEM 格式的服务器证书的完整路径。将 <literal>/path/to/SERVER.key</literal> 替换为 PEM 格式的服务器证书密钥文件的完整路径。
</para>
</step>
<step>
  <para>
   重启动实例，以使用新证书。
  </para>
  <screen><prompt>&gt; </prompt><command>sudo</command> <command>systemctl restart dirsrv@<replaceable>INSTANCE-NAME.</replaceable>.service
</command> </screen>
<para>将 <literal>INSTANCE_NAME</literal> 替换为目录服务器的实例名称。</para>
</step>
 </procedure>
 </sect1>
