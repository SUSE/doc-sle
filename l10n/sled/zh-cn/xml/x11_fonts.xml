<?xml version="1.0" encoding="UTF-8"?>
<sect1 xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="x11_fonts.xml" version="5.0" xml:id="sec-x11-fontsys">
 <title>安装和配置字体</title>

 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:bugtracker/>
   <dm:translation>yes</dm:translation>
  </dm:docmanager>
 </info>

 <para>
  Linux 中的字体可分为两大类：
 </para>

 <variablelist>
  <varlistentry>
   <term>轮廓或矢量字体</term>
   <listitem>
    <para>
     包含作为字形组成相关绘图指导的数学描述。因此，每个字形都可以缩放为任意大小而无损质量。在可以使用此类字体（或字形）之前，需要将数学描述转换为光栅（网格）。此过程称为<emphasis>字体光栅化</emphasis>。<emphasis>字体微调</emphasis>（嵌入在字体中）可改进和优化特定大小的渲染效果。光栅化和微调通过 FreeType 库实现。
    </para>
    <para>
     Linux 下的常用格式为 PostScript Type 1 和 Type 2、TrueType 及 OpenType。
    </para>
   </listitem>
  </varlistentry>
  <varlistentry>
   <term>位图或光栅字体</term>
   <listitem>
    <para>
     包含一个为特定字号设计的像素阵列。位图字体渲染速度极快，而且非常简单。然而，与矢量字体相比，位图字体无法在不损质量的情况下进行缩放。因此，这些字体通常以不同的大小发布。现在，Linux 控制台中仍然使用位图字体，有时终端中也会使用这些字体。
    </para>
    <para>
     在 Linux 下，便携式编译格式 (PCF) 或字形位图分布格式 (BDF) 是最常用的格式。
    </para>
   </listitem>
  </varlistentry>
 </variablelist>

 <para>
  这些字体的外观主要会受两个方面的影响：
 </para>

 <itemizedlist mark="bullet" spacing="normal">
  <listitem>
   <para>
    选择合适的字体系列，
   </para>
  </listitem>
  <listitem>
   <para>
    采用某种算法渲染字体，达到接收者眼睛最舒服的效果。
   </para>
  </listitem>
 </itemizedlist>

 <para>
  最后一点只与矢量字体相关。虽然上面两点都需要根据个人情况而定，但仍有一些默认值需要创建。
 </para>

 <para>
  Linux 字体渲染系统由具有不同关系的几个库组成。基本字体渲染库是 <link xlink:href="http://www.freetype.org/">FreeType</link>，它会将支持的格式的字体字形转换为优化的位图字形。渲染过程由算法及其参数（可能受专利问题影响）控制。
 </para>

 <para>
  使用 FreeType 的每个程序或库都应该参考 <link xlink:href="http://www.fontconfig.org/">Fontconfig</link> 库。此库会从用户及系统那里收集字体配置。用户修改其 Fontconfig 设置后，此更改将导致发生 Fontconfig 感知的应用。
 </para>

 <para>
  Arabic、Han 或 Phags-Pa 等脚本所需的更复杂的 OpenType 成型以及其他更高级别的文本处理使用 <link xlink:href="http://www.harfbuzz.org/">Harfbuzz</link> 或 <link xlink:href="http://www.pango.org/">Pango</link> 进行。
 </para>

 <sect2 xml:id="sec-x11-fontsys-showing-fonts">
  <title>显示安装的字体</title>
  <para>
   要获得系统上安装了哪些字体的概观，请运行 <command>rpm</command> 或 <command>fc-list</command> 命令。这两个命令都可为您提供不错的答案，但有可能会因系统和用户配置不同而返回不同的列表。
  </para>
  <variablelist>
   <varlistentry>
    <term><command>rpm</command>
    </term>
    <listitem>
     <para>
      调用 <command>rpm</command> 可查看系统上安装了哪些包含字体的软件包：
     </para>
<screen><prompt>&gt; </prompt>rpm -qa '*fonts*'</screen>
     <para>
      每个字体软件包都应该满足此表达式。不过，命令可能会返回误报，例如 <literal>fonts-config</literal>（它即不是字体，也不包含字体）。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><command>fc-list</command>
    </term>
    <listitem>
     <para>
      调用 <command>fc-list</command> 可获得哪些字体系列可以访问、系统上或主目录中是否已安装这些字体的概观：
     </para>
<screen><prompt>&gt; </prompt>fc-list ':' family</screen>
     <note>
      <title>命令 <command>fc-list</command></title>
      <para>
       命令 <command>fc-list</command> 是 Fontconfig 库的封装程序。从 Fontconfig（更确切地说，从它的缓存）可以查询许多有趣的信息。有关更多细节，请参见 <command>man 1 fc-list</command>。
      </para>
     </note>
    </listitem>
   </varlistentry>
  </variablelist>
 </sect2>

 <sect2 xml:id="sec-x11-fontsys-viewing">
  <title>查看字体</title>
  <para>
   如果想了解已安装字体系列的外观，请使用命令 <command>ftview</command>（<systemitem>ft2demos</systemitem> 软件包）或访问 <link xlink:href="http://fontinfo.opensuse.org/"/>。例如，要以 14 号字显示 FreeMono 字体，请按如下所示使用 <command>ftview</command>：
  </para>
<screen><prompt>&gt; </prompt>ftview 14 /usr/share/fonts/truetype/FreeMono.ttf</screen>
  <para>
   如果需要更多信息，请访问 <link xlink:href="http://fontinfo.opensuse.org/"/> 了解支持的样式（标准、粗体、斜体等）和语言。
  </para>
 </sect2>

 <sect2 xml:id="sec-x11-fontsys-querying">
  <title>查询字体</title>
  <para>
   要查询指定了某种模式时使用哪种字体，请使用 <command>fc-match</command> 命令。
  </para>
  <para>
   例如，如果您的模式包含已安装字体，<command>fc-match</command> 会返回文件名、字体系列和样式：
  </para>
<screen><prompt>&gt; </prompt>fc-match 'Liberation Serif'
LiberationSerif-Regular.ttf: "Liberation Serif" "Regular"</screen>
  <para>
   如果所需字体在您的系统上不存在，Fontconfig 的匹配规则将会生效，并尝试找到最接近的可用字体。这意味着用另一种字体来替代了您要求的字体。
  </para>
<screen><prompt>&gt; </prompt>fc-match 'Foo Family'
DejaVuSans.ttf: "DejaVu Sans" "Book"</screen>
  <para>
   Fontconfig 支持<emphasis>别名</emphasis>：用另一个系列名称替代某个名称。通用名称就是一个典型的例子，例如 <quote>sans-serif</quote>、<quote>serif</quote> 和 <quote>monospace</quote>。这些别名可由实际的系列名称，甚至是系列名称的首选设置列表替代：
  </para>
<screen><prompt>&gt; </prompt>for font in serif sans mono; do fc-match "$font" ; done
DejaVuSerif.ttf: "DejaVu Serif" "Book"
DejaVuSans.ttf: "DejaVu Sans" "Book"
DejaVuSansMono.ttf: "DejaVu Sans Mono" "Book"</screen>
  <para>
   结果可能因系统而异，具体视当前安装的字体而定。
  </para>
  <note>
   <title>根据 fontconfig 而定的相似度规则</title>
   <para>
    Fontconfig <emphasis>总是</emphasis>根据具体请求返回最相似的实际系列（如果至少安装了一个系列）。<quote>相似度</quote>根据 Fontconfig 的内部度量以及用户或管理员的 Fontconfig 设置而定。
   </para>
  </note>
 </sect2>

 <sect2 xml:id="sec-x11-fontsys-install">
  <title>安装字体</title>
  <para>
   安装新字体的方法主要有以下几种：
  </para>
  <orderedlist spacing="normal">
   <listitem>
    <para>
     将 <filename>*.ttf</filename> 或 <filename>*.otf</filename> 等字体文件手动安装到知道的一个字体目录。如果字体要用于整个系统，请使用标准目录 <filename>/usr/share/fonts</filename>。如果要安装在主目录中，请使用 <filename>~/.config/fonts</filename>。
    </para>
    <para>
     如果不想使用标准目录，Fontconfig 允许您选择其他目录。使用 <literal>&lt;dir&gt;</literal> 元素告知 Fontconfig 所用目录，有关细节，请参见<xref linkend="sec-x11-fontsys-config-fontconfig"/>。
    </para>
   </listitem>
   <listitem>
    <para>
     使用 <command>zypper</command> 安装字体。大量字体已通过软件包提供，随附在 SUSE 分发包中或包含在 <link xlink:href="http://download.opensuse.org/repositories/M17N:/fonts/">M17N:fonts</link> 软件源中。请使用以下命令将软件源添加到您的列表中。例如，要为 <phrase role="productname"><phrase os="sled">SUSE Linux Enterprise Desktop</phrase></phrase> <phrase role="productnumber"><phrase os="sles;sled">15 SP4</phrase></phrase> 添加软件源，请使用以下命令：
    </para>
<screen><prompt>&gt; </prompt><command>sudo</command> zypper ar
     <phrase os="sles;sled">https://download.opensuse.org/repositories/M17N:/fonts/SLE_15/</phrase></screen>
    <para>
     要搜索您的 <replaceable>FONT_FAMILY_NAME</replaceable>，请使用以下命令：
    </para>
<screen><prompt>&gt; </prompt>zypper se '<replaceable>FONT_FAMILY_NAME</replaceable>*fonts'</screen>
   </listitem>


  </orderedlist>
 </sect2>

 <sect2 xml:id="sec-x11-fontsys-config">
  <title>配置字体的外观</title>
  <para>
   根据渲染媒体和字号的不同，结果可能并不令人满意。例如，现在的显示器分辨率一般为 100dpi，这导致像素太大，字形显得粗陋难看。
  </para>
  <para>
   有几种算法可用来处理低分辨率，例如消除锯齿（灰度平滑）、微调（适合网格）或子像素渲染（在一个方向将分辨率增至三倍）。这些算法还可能因字体格式而异。
  </para>
  <important>
   <title>子像素渲染的专利问题</title>
   <para>
    SUSE 发行套件中不使用子像素渲染。虽然 FreeType2 支持此算法，但有几项将于 2019 年底到期的专利涉及到了此算法。因此，除非系统中有 FreeType2 库并且该库中已编译子像素渲染，否则在 Fontconfig 中设置子像素渲染选项没有任何效果。
   </para>
  </important>
  <para>
   通过 Fontconfig，可单独为每种字体选择渲染算法，也可为一组字体选择渲染算法。
  </para>
  <sect3 xml:id="sec-x11-fontsys-config-sysconfig">
   <title>通过 <literal>sysconfig</literal> 配置字体</title>
   <para>
    <phrase role="productname"><phrase os="sled">SUSE Linux Enterprise Desktop</phrase></phrase> 在 Fontconfig 上提供了一个 <literal>sysconfig</literal> 层。要尝试进行字体配置，这是一个不错的着手点。要更改默认设置，请编辑配置文件 <filename>/etc/sysconfig/fonts-config</filename>。（或使用 YaST sysconfig 模块）。编辑该文件之后，请运行 <command>fonts-config</command>。
   </para>
<screen><prompt>&gt; </prompt><command>sudo</command> /usr/sbin/fonts-config</screen>
   <para>
    重启动该应用程序以显示成效。请牢记以下要点：
   </para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>
      一些应用程序不需要重启动。例如，Firefox 会不时重新读取 Fontconfig 配置。新创建或重新装载的标签可在稍后获得新的字体配置。
     </para>
    </listitem>
    <listitem>
     <para>
      每次发生包安装或去除操作之后，系统会自动调用 <command>fonts-config</command> 脚本（如未调用，则表示字体软件包有错误）。
     </para>
    </listitem>
    <listitem>
     <para>
      使用 <command>fonts-config</command> 命令行选项可以暂时覆盖每个 sysconfig 变量。有关细节，请参见 <command>fonts-config --help</command>。
     </para>
    </listitem>
   </itemizedlist>
   <para>
    有几个 sysconfig 变量可以更改。请参见 <command>man 1 fonts-config</command> 或 YaST sysconfig 模块的帮助页。以下是一些变量示例：
   </para>
   <variablelist>
    <varlistentry>
     <term>渲染算法的使用</term>
     <listitem>
      <para>
       请考虑 <varname>FORCE_HINTSTYLE</varname>、<varname>FORCE_AUTOHINT</varname>、<varname>FORCE_BW</varname>、<varname>FORCE_BW_MONOSPACE</varname>、&#x200b;<varname>USE_EMBEDDED_BITMAPS</varname> 和 <varname>EMBEDDED_BITMAP_LANGAGES</varname>
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>通用别名的首选项列表</term>
     <listitem>
      <para>
       使用 <varname>PREFER_SANS_FAMILIES</varname>、<varname>PREFER_SERIF_FAMILIES</varname>、<varname>PREFER_MONO_FAMILIES</varname> 和 <varname>SEARCH_METRIC_COMPATIBLE</varname>
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
   <para>
    下面的列表提供了一些配置示例，按从<quote>最清晰</quote>字体（对比度较高）到<quote>最漂亮</quote>（较平滑）的顺序显示。
   </para>
   <variablelist>
    <varlistentry xml:id="vle-x11-fontsys-sysconfig-bitmap">
     <term>位图字体</term>
     <listitem>
      <para>
       通过 <varname>PREFER_*_FAMILIES</varname> 变量设置首选位图字体。请按照帮助部分的示例使用这些变量。请注意，这些字体渲染为黑白色，不进行平滑处理，并且位图字体只有几种字号。考虑使用
      </para>
<screen>SEARCH_METRIC_COMPATIBLE="no"</screen>
      <para>
       来禁用基于度量兼容性的系列名称替代。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry xml:id="vle-x11-fontsys-sysconfig-bw">
     <term>渲染为黑白色的可缩放字体</term>
     <listitem>
      <para>
       渲染时未消除锯齿的可缩放字体与位图字体的显示效果相似，同时又可保持字体可缩放性。请使用经过精细微调的字体，如 Liberation 系列。遗憾的是，系统中经过精细微调的字体并不充足。设置下面的变量可强制采用此方法：
      </para>
<screen>FORCE_BW="yes"</screen>
     </listitem>
    </varlistentry>
    <varlistentry xml:id="vle-x11-fontsys-sysconfig-bw-monospace">
     <term>渲染为黑白色的等宽字体</term>
     <listitem>
      <para>
       仅采用不消除锯齿的方式渲染等宽字体，否则，请使用默认设置：
      </para>
<screen>FORCE_BW_MONOSPACE="yes"</screen>
     </listitem>
    </varlistentry>
    <varlistentry xml:id="vle-x11-fontsys-sysconfig-default">
     <term>默认设置</term>
     <listitem>
      <para>
       渲染所有字体时都消除锯齿。经过精细微调的字体将通过<emphasis>字节码解释器</emphasis> (BCI) 渲染，其余字体将使用自动微调器 (<literal>hintstyle=hintslight</literal>) 渲染。让所有相关的 sysconfig 变量保持默认设置。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry xml:id="vle-x11-fontsys-sysconfig-cff">
     <term>CFF 字体</term>
     <listitem>
      <para>
       以 CFF 格式使用字体。FreeType2 中有了当前的改进后，该字体应该也会比默认的 TrueType 字体更清晰。请按照 <literal>PREFER_*_FAMILIES</literal> 的示例尝试一下。可以使用以下选项将字体调得更黑更粗：
      </para>
<screen>SEARCH_METRIC_COMPATIBLE="no"</screen>
      <para>
       因为它们默认是通过 <literal>hintstyle=hintslight</literal> 来渲染的。还可以考虑使用：
      </para>
<screen>SEARCH_METRIC_COMPATIBLE="no"</screen>
     </listitem>
    </varlistentry>
    <varlistentry xml:id="ex-x11-fontsys-sysconfig-autohint">
     <term>专用自动微调器</term>
     <listitem>
      <para>
       即使对于精细微调的字体，也可以使用 FreeType2 的自动微调器。这可能会导致字形变得更粗，有时还会变得更模糊、对比度更低。设置下面的变量可激活此功能：
      </para>
<screen>FORCE_AUTOHINTER="yes"</screen>
      <para>
       使用 <literal>FORCE_HINTSTYLE</literal> 可控制微调级别。
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
  </sect3>
  <sect3 xml:id="sec-x11-fontsys-config-fontconfig">
   <title>深入了解 fontconfig XML</title>
   <para>
    Fontconfig 的配置格式是<emphasis>可扩展标记语言</emphasis> (XML)。下面的几个示例不是完整参考，只是简要概述。细节及其他启示可在 <command>man 5 fonts-conf</command> 或 <filename>/etc/fonts/conf.d/</filename> 中找到。
   </para>
   <para>
    中心 Fontconfig 配置文件是 <filename>/etc/fonts/fonts.conf</filename>，它及其他作品包括整个 <filename>/etc/fonts/conf.d/</filename> 目录。要自定义 Fontconfig，可在两个位置插入您的更改：
   </para>
   <orderedlist xml:id="ol-x11-fontsys-configfiles" spacing="normal">
    <title>Fontconfig 配置文件</title>
    <listitem>
     <formalpara>
      <title>系统范围的更改</title>
      <para>
       编辑文件 <filename>/etc/fonts/local.conf</filename>（默认情况下，它包含空的 <literal>fontconfig</literal> 元素）。
      </para>
     </formalpara>
    </listitem>
    <listitem>
     <formalpara>
      <title>用户特定的更改</title>
      <para>
       编辑文件 <filename>~/.config/fontconfig/fonts.conf</filename>。将 Fontconfig 配置文件放在 <filename>~/.config/fontconfig/conf.d/</filename> 目录中。
      </para>
     </formalpara>
    </listitem>
   </orderedlist>
   <para>
    用户特定的更改会覆盖任何系统范围的设置。
   </para>
   <note>
    <title>弃用的用户配置文件</title>
    <para>
     文件 <filename>~/.fonts.conf</filename> 标记为已弃用，不应该再使用。请改为使用 <filename>~/.config/fontconfig/fonts.conf</filename>。
    </para>
   </note>
   <para>
    每个配置文件都需要有一个 <literal>fontconfig</literal> 元素。因此，最精简的文件应如下所示：
   </para>
<screen>&lt;?xml version="1.0"?&gt;
   &lt;!DOCTYPE fontconfig SYSTEM "fonts.dtd"&gt;
   &lt;fontconfig&gt;
   &lt;!-- Insert your changes here --&gt;
   &lt;/fontconfig&gt;</screen>
   <para>
    如果默认目录不够用，请插入 <literal>dir</literal> 元素及相应的目录：
   </para>
<screen>&lt;dir&gt;/usr/share/fonts2&lt;/dir&gt;</screen>
   <para>
    Fontconfig 会<emphasis>以递归方式</emphasis>搜索字体。
   </para>
   <para>
    使用下面的 Fontconfig 代码段可以选择字体渲染算法（请参见<xref linkend="ex-x11-fontsys-fontconfig-rendering-algorithms"/>）：
   </para>
   <example xml:id="ex-x11-fontsys-fontconfig-rendering-algorithms">
    <title>指定渲染算法</title>
<screen>&lt;match target="font"&gt;
 &lt;test name="family"&gt;
  &lt;string&gt;<replaceable>FAMILY_NAME</replaceable>&lt;/string&gt;
 &lt;/test&gt;
 &lt;edit name="antialias" mode="assign"&gt;
  &lt;bool&gt;true&lt;/bool&gt;
 &lt;/edit&gt;
 &lt;edit name="hinting" mode="assign"&gt;
  &lt;bool&gt;true&lt;/bool&gt;
 &lt;/edit&gt;
 &lt;edit name="autohint" mode="assign"&gt;
  &lt;bool&gt;false&lt;/bool&gt;
 &lt;/edit&gt;
 &lt;edit name="hintstyle" mode="assign"&gt;
  &lt;const&gt;hintfull&lt;/const&gt;
 &lt;/edit&gt;
&lt;/match&gt;</screen>
   </example>
   <para>
    字体的各种属性都可以测试。例如，<literal>&lt;test&gt;</literal> 元素可测试字体系列（如该例中所示）、字体间隔、间距、字体格式以及其他。如果完全不使用 <literal>&lt;test&gt;</literal>，所有 <literal>&lt;edit&gt;</literal> 元素都会应用于每个字体（全局更改）。
   </para>
   <example xml:id="ex-x11-fontsys-fontconfig-aliases1">
    <title>别名和系列名称替换项</title>
    <variablelist>
     <varlistentry xml:id="vle-x11-fontsys-example-alias-default">
      <term>规则 1</term>
      <listitem>
<screen>&lt;alias&gt;
 &lt;family&gt;Alegreya SC&lt;/family&gt;
 &lt;default&gt;
  &lt;family&gt;serif&lt;/family&gt;
 &lt;/default&gt;
&lt;/alias&gt;</screen>
      </listitem>
     </varlistentry>
     <varlistentry xml:id="vle-x11-fontsys-example-alias-prefer">
      <term>规则 2</term>
      <listitem>
<screen>&lt;alias&gt;
 &lt;family&gt;serif&lt;/family&gt;
 &lt;prefer&gt;
  &lt;family&gt;Droid Serif&lt;/family&gt;
 &lt;/prefer&gt;
&lt;/alias&gt;</screen>
      </listitem>
     </varlistentry>
     <varlistentry xml:id="vle-x11-fontsys-example-alias-accept">
      <term>规则 3</term>
      <listitem>
<screen>&lt;alias&gt;
 &lt;family&gt;serif&lt;/family&gt;
 &lt;accept&gt;
  &lt;family&gt;STIXGeneral&lt;/family&gt;
 &lt;/accept&gt;
&lt;/alias&gt;</screen>
      </listitem>
     </varlistentry>
    </variablelist>
   </example>
   <para>
    <xref linkend="ex-x11-fontsys-fontconfig-aliases1"/>中的规则会创建一份<emphasis>排定了优先级的系列列表</emphasis> (PFL)。根据元素的不同，执行的操作也不同：
   </para>
   <variablelist>
    <varlistentry>
     <term><xref linkend="vle-x11-fontsys-example-alias-default"/> 中的 <literal>&lt;default&gt;</literal>
     </term>
     <listitem>
      <para>
       此规则会在 PFL <emphasis>末尾</emphasis>添加一个 <literal>serif</literal> 系列名称。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><xref linkend="vle-x11-fontsys-example-alias-prefer"/> 中的 <literal>&lt;prefer&gt;</literal>
     </term>
     <listitem>
      <para>
       只要 PFL 中存在 <literal>Alegreya SC</literal>，此规则就会在 PFL 中的第一个 <literal>serif</literal> <emphasis>之前</emphasis>添加<quote>Droid Serif</quote>。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><xref linkend="vle-x11-fontsys-example-alias-accept"/> 中的 <literal>&lt;accept&gt;</literal>
     </term>
     <listitem>
      <para>
       此规则会在 PFL 中第一个 <literal>serif</literal> 系列名称<emphasis>之后</emphasis>添加 <quote>STIXGeneral</quote> 系列名称。
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
   <para>
    如果将这些代码段按<xref linkend="vle-x11-fontsys-example-alias-default"/> - <xref linkend="vle-x11-fontsys-example-alias-prefer"/> - <xref linkend="vle-x11-fontsys-example-alias-accept"/> 的顺序组合起来，当用户请求 <quote>Alegreya SC</quote> 时，系统便会如创建如<xref linkend="tab-x11-fontsys-example-alias"/>中所述的 PFL。
   </para>
   <table xml:id="tab-x11-fontsys-example-alias">
    <title>基于 fontconfig 规则生成 PFL</title>
    <tgroup cols="2">
     <colspec colwidth="1*"/>
     <colspec colwidth="3*"/>
     <thead>
      <row>
       <entry>
        <para>
         顺序
        </para>
       </entry>
       <entry>
        <para>
         当前的 PFL
        </para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row>
       <entry>
        <para>
         请求
        </para>
       </entry>
       <entry>
        <para>
         <literal>Alegreya SC</literal>
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <xref linkend="vle-x11-fontsys-example-alias-default"/>
        </para>
       </entry>
       <entry>
        <para>
         <literal>Alegreya SC</literal>、<literal>serif</literal>
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <xref linkend="vle-x11-fontsys-example-alias-prefer"/>
        </para>
       </entry>
       <entry>
        <para>
         <literal>Alegreya SC</literal>、<literal>Droid Serif</literal>、<literal>serif</literal>
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <xref linkend="vle-x11-fontsys-example-alias-accept"/>
        </para>
       </entry>
       <entry>
        <para>
         <literal>Alegreya SC</literal>、<literal>Droid Serif</literal>、<literal>serif</literal>、<literal>STIXGeneral</literal>
        </para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </table>
   <para>
    在 Fontconfig 的度量中，系列名称具有最高优先级，高于样式、大小等其他模式。Fontconfig 会检查系统上当前安装了哪个系列。如果安装了 <quote>Alegreya SC</quote>，Fontconfig 将会返回它。如果未安装，则会查找 <quote>Droid Serif</quote>，以此类推。
   </para>
   <para>
    请小心。如果 Fontconfig 代码段的顺序发生变化，Fontconfig 可能会返回不同的结果，如<xref linkend="tab-x11-fontsys-example-alias2"/>中所述。
   </para>
   <table xml:id="tab-x11-fontsys-example-alias2">
    <title>基于更改了顺序的 fontconfig 规则生成 PFL 的结果</title>
    <tgroup cols="3">
     <thead>
      <row>
       <entry>
        <para>
         顺序
        </para>
       </entry>
       <entry>
        <para>
         当前的 PFL
        </para>
       </entry>
       <entry>
        <para>
         注释
        </para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row>
       <entry>
        <para>
         请求
        </para>
       </entry>
       <entry>
        <para>
         <literal>Alegreya SC</literal>
        </para>
       </entry>
       <entry>
        <para>
         执行相同的请求。
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <xref linkend="vle-x11-fontsys-example-alias-prefer"/>
        </para>
       </entry>
       <entry>
        <para>
         <literal>Alegreya SC</literal>
        </para>
       </entry>
       <entry>
        <para>
         PFL 中没有 <literal>serif</literal>，未替代任何内容
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <xref linkend="vle-x11-fontsys-example-alias-accept"/>
        </para>
       </entry>
       <entry>
        <para>
         <literal>Alegreya SC</literal>
        </para>
       </entry>
       <entry>
        <para>
         PFL 中没有 <literal>serif</literal>，未替代任何内容
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <xref linkend="vle-x11-fontsys-example-alias-default"/>
        </para>
       </entry>
       <entry>
        <para>
         <literal>Alegreya SC</literal>, <literal>serif</literal>
        </para>
       </entry>
       <entry>
        <para>
         PFL 中存在 <literal>Alegreya SC</literal>，执行替代
        </para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </table>
   <note>
    <title>隐含意义</title>
    <para>
     将 <literal>&lt;default&gt;</literal> 别名视为此组的分类或内含项（如果未安装）。如该例所示，<literal>&lt;default&gt;</literal> 应该一律优先于该组的 <literal>&lt;prefer&gt;</literal> 和 <literal>&lt;accept&gt;</literal> 别名。
    </para>
    <para>
     <literal>&lt;default&gt;</literal> 分类不限于通用别名 serif、sans-serif 和 monospace。有关复杂示例，请参见 <filename>/usr/share/fontconfig/conf.avail/30-metric-aliases.conf</filename>。
    </para>


   </note>
   <para>
    <xref linkend="ex-x11-fontsys-fontconfig-aliases2"/>中的以下 Fontconfig 代码段会创建一个 <literal>serif</literal> 组。如果前一种字体未安装，此组中的每个系列可替代其他系列。
   </para>
   <example xml:id="ex-x11-fontsys-fontconfig-aliases2">
    <title>别名和系列名称替换项</title>
<screen>&lt;alias&gt;
 &lt;family&gt;Alegreya SC&lt;/family&gt;
 &lt;default&gt;
  &lt;family&gt;serif&lt;/family&gt;
 &lt;/default&gt;
&lt;/alias&gt;
&lt;alias&gt;
 &lt;family&gt;Droid Serif&lt;/family&gt;
 &lt;default&gt;
  &lt;family&gt;serif&lt;/family&gt;
 &lt;/default&gt;
&lt;/alias&gt;
&lt;alias&gt;
 &lt;family&gt;STIXGeneral&lt;/family&gt;
 &lt;default&gt;
  &lt;family&gt;serif&lt;/family&gt;
 &lt;/default&gt;
&lt;/alias&gt;
&lt;alias&gt;
 &lt;family&gt;serif&lt;/family&gt;
 &lt;accept&gt;
  &lt;family&gt;Droid Serif&lt;/family&gt;
  &lt;family&gt;STIXGeneral&lt;/family&gt;
  &lt;family&gt;Alegreya SC&lt;/family&gt;
 &lt;/accept&gt;
&lt;/alias&gt;</screen>
   </example>
   <para>
    优先级由 <literal>&lt;accept&gt;</literal> 别名中的顺序指定。类似地，可以使用更强的 <literal>&lt;prefer&gt;</literal> 别名。
   </para>
   <para>
    <xref linkend="ex-x11-fontsys-fontconfig-aliases3"/>扩展了<xref linkend="ex-x11-fontsys-fontconfig-aliases1"/>。
   </para>
   <example xml:id="ex-x11-fontsys-fontconfig-aliases3">
    <title>别名和系列名称替换项</title>
    <variablelist>
     <varlistentry xml:id="vle-x11-fontsys-example-alias-accept2">
      <term>规则 4</term>
      <listitem>
<screen>&lt;alias&gt;
 &lt;family&gt;serif&lt;/family&gt;
 &lt;accept&gt;
  &lt;family&gt;Liberation Serif&lt;/family&gt;
 &lt;/accept&gt;
&lt;/alias&gt;</screen>
      </listitem>
     </varlistentry>
     <varlistentry xml:id="vle-x11-fontsys-example-alias-prefer2">
      <term>规则 5</term>
      <listitem>
<screen>&lt;alias&gt;
 &lt;family&gt;serif&lt;/family&gt;
 &lt;prefer&gt;
  &lt;family&gt;DejaVu Serif&lt;/family&gt;
 &lt;/prefer&gt;
&lt;/alias&gt;</screen>
      </listitem>
     </varlistentry>
    </variablelist>
   </example>
   <para>
    <xref linkend="ex-x11-fontsys-fontconfig-aliases3"/>中的扩展配置将导致下列 PFL 变化：
   </para>
   <table xml:id="tab-x11-fontsys-example-alias3">
    <title>基于 fontconfig 规则生成 PFL 的结果</title>
    <tgroup cols="2">
     <colspec colwidth="1*"/>
     <colspec colwidth="3*"/>
     <thead>
      <row>
       <entry>
        <para>
         顺序
        </para>
       </entry>
       <entry>
        <para>
         当前的 PFL
        </para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row>
       <entry>
        <para>
         请求
        </para>
       </entry>
       <entry>
        <para>
         <literal>Alegreya SC</literal>
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <xref linkend="vle-x11-fontsys-example-alias-default"/>
        </para>
       </entry>
       <entry>
        <para>
         <literal>Alegreya SC</literal>、<literal>serif</literal>
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <xref linkend="vle-x11-fontsys-example-alias-prefer"/>
        </para>
       </entry>
       <entry>
        <para>
         <literal>Alegreya SC</literal>、<literal>Droid Serif</literal>、<literal>serif</literal>
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <xref linkend="vle-x11-fontsys-example-alias-accept"/>
        </para>
       </entry>
       <entry>
        <para>
         <literal>Alegreya SC</literal>、<literal>Droid Serif</literal>、<literal>serif</literal>、<literal>STIXGeneral</literal>
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <xref linkend="vle-x11-fontsys-example-alias-accept2"/>
        </para>
       </entry>
       <entry>
        <para>
         <literal>Alegreya SC</literal>、<literal>Droid Serif</literal>、<literal>serif</literal>、<literal>Liberation Serif</literal>、<literal>STIXGeneral</literal>
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <xref linkend="vle-x11-fontsys-example-alias-prefer2"/>
        </para>
       </entry>
       <entry>
        <para>
         <literal>Alegreya SC</literal>、<literal>Droid Serif</literal>、<literal>DejaVu Serif</literal>、<literal>serif</literal>、<literal>Liberation Serif</literal>、<literal>STIXGeneral</literal>
        </para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </table>
   <note>
    <title>隐含意义。</title>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <para>
       如果同一个通用名称存在多个 <literal>&lt;accept&gt;</literal> 声明，则最后分析的声明<quote>胜出</quote>。如有可能，创建系统范围的配置时，不要在用户 (<literal>/etc/fonts/conf.d/*-user.conf</literal> <emphasis role="bold">) 之后</emphasis>使用 <filename>&lt;accept&gt;</filename>。
      </para>
     </listitem>
     <listitem>
      <para>
       如果同一个通用名称存在多个 <literal>&lt;prefer&gt;</literal> 声明，则最后分析的声明<quote>胜出</quote>。如有可能，在系统范围的配置中，不要在用户之前<literal>使用 </literal>
       <emphasis role="bold">&lt;prefer&gt;</emphasis>。
      </para>
     </listitem>
     <listitem>
      <para>
       同一个通用名称的每个 <literal>&lt;prefer&gt;</literal> 声明都会覆盖 <literal>&lt;accept&gt;</literal> 声明。如果管理员不仅希望用户可使用 <literal>&lt;accept&gt;</literal>，而且还想允许其使用 <literal>&lt;prefer&gt;</literal>，就不应该在系统范围的配置中使用 <literal>&lt;prefer&gt;</literal>。另一方面，因为用户通常都是使用 <literal>&lt;prefer&gt;</literal>，这种做法应该不会产生任何不利影响。我们还发现存在在统范围的配置中使用 <literal>&lt;prefer&gt;</literal> 的情况。
      </para>
     </listitem>
    </itemizedlist>
   </note>
  </sect3>
 </sect2>
</sect1>
