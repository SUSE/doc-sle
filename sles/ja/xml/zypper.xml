<?xml version="1.0" encoding="UTF-8"?>
<sect1 xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="zypper.xml" version="5.0" xml:id="sec.zypper">
 <title>Zypperの使用</title>

 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:bugtracker/>
   <dm:translation>yes</dm:translation>
  </dm:docmanager>
 </info>

 <para>
  Zypperは、パッケージのインストール、更新、削除、およびリポジトリの管理を行うためのコマンドラインパッケージマネージャです。これは特に、リモートソフトウェア管理タスクの実行、またはシェルスクリプトからのソフトウェアの管理で役立ちます。
 </para>

 <sect2 xml:id="sec.zypper.usage">
  <title>一般的な使用方法</title>
  <para>
   Zypperの一般的な構文は次のとおりです。
  </para>
<screen><prompt>tux &gt; </prompt>zypper <option>[--global-options]</option> <replaceable>command</replaceable> <option> [--command-options]</option> <option>[arguments]</option></screen>

  <para>
   ブラケットで囲まれたコンポーネントは必須ではありません。一般的なオプションおよびすべてのコマンドのリストについては、<command>zypper help</command>を参照してください。特定のコマンドのヘルプを参照するには、<command>zypper help </command><replaceable>コマンド</replaceable>を入力します。
  </para>
  <variablelist>
   <varlistentry>
    <term>Zypperのコマンド</term>
    <listitem>
     <para>
      Zypperを実行する最も簡単な方法は、その名前の後にコマンドを入力することです。たとえば、システムに必要なすべてのパッチを適用するには、次のコマンドを使用します。
     </para>
<screen><prompt>tux &gt; </prompt>sudo zypper patch</screen>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>グローバルオプション</term>
    <listitem>
     <para>
      さらに、グローバルオプションをコマンドの直前に入力することによって、1つ以上のグローバルオプションを選択することもできます。
     </para>
<screen><prompt>tux &gt; </prompt>sudo zypper --non-interactive patch</screen>
     <para>
      上の例では、オプション<option>--non-interactive</option>は、確認を一切表示せずにコマンドを実行することを意味します(自動的にデフォルトの回答を適用します)。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>コマンド固有のオプション</term>
    <listitem>
     <para>
      特定のコマンドに固有のオプションを使用する場合は、コマンドの直後にそのオプションを入力します。
     </para>
<screen><prompt>tux &gt; </prompt>sudo zypper patch --auto-agree-with-licenses</screen>
     <para>
      上の例では、<option>--auto-agree-with-licenses</option>を使用して、ライセンスの確認を表示せずに、必要なすべてのパッチをシステムに適用します。その代わりに、自動的にライセンスに同意します。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>引数</term>
    <listitem>
     <para>
      一部のコマンドでは、1つ以上の引数が必要です。たとえば、コマンド<command>install</command>を使用する場合、「インストール」<emphasis/>するパッケージを1つまたは複数指定する必要があります。
     </para>
<screen><prompt>tux &gt; </prompt>sudo zypper install mplayer</screen>
     <para>
      一部のオプションでは、1つの引数が必要です。次のコマンドでは、すべての既知のパターンが表示されます。
     </para>
<screen><prompt>tux &gt; </prompt>zypper search -t pattern</screen>
    </listitem>
   </varlistentry>
  </variablelist>
  <para>
   上記のすべてを結合できます。たとえば、次のコマンドは
   <package>aspell-deパッケージおよび</package>
   および
   <package>aspell-fr </package>
   パッケージを<literal>factory</literal>リポジトリからインストールしますが、これは冗長です。
  </para>
<screen><prompt>tux &gt; </prompt>sudo zypper -v install --from factory aspell-de aspell-fr</screen>
  <para>
   <option>--from</option>オプションは、指定されたリポジトリからパッケージを要求する際に、すべてのリポジトリを(依存関係の解決のため)有効に保ちます。
  </para>
  <para>
   ほとんどのZypperコマンドには、指定のコマンドのシミュレーションを行う<literal>dry-run</literal>オプションがあります。このオプションは、テストの目的で使用できます。
  </para>
<screen><prompt>tux &gt; </prompt>sudo zypper remove --dry-run MozillaFirefox</screen>
  <para>
   Zypperは、グローバルオプション<option>--userdata <replaceable>string</replaceable></option>をサポートします。このオプションを使用して文字列を指定することができます。指定した文字列は、Zypperのログファイルとプラグイン(Btrfsプラグインなど)に書き込まれます。これを使用して、ログファイルでトランザクションにマークを付けたり、トランザクションを特定したりできます。
  </para>
<screen><prompt>tux &gt; </prompt>sudo zypper --userdata <replaceable>string</replaceable> patch</screen>
 </sect2>

 <sect2 xml:id="sec.zypper.softman">
  <title>Zypperを使ったソフトウェアのインストールと削除</title>
  <para>
   パッケージをインストールまたは削除するには、次のコマンドを使用します。
  </para>
<screen><prompt>tux &gt; </prompt>sudo zypper install <replaceable>package_name</replaceable>
<prompt>tux &gt; </prompt>sudo zypper remove <replaceable>package_name</replaceable></screen>

  <warning>
   <title>必須システムパッケージは削除しない</title>
   <para>
    必須システムパッケージは削除しないでください。たとえば、
    <package>glibc</package>
    、
    <package>zypper</package>
    、
    <package>kernel</package>
    などです。これらを削除すると、システムが不安定になったり、まったく動作しなくなったりする可能性があります。
   </para>
  </warning>
  <sect3 xml:id="sec.zypper.selectpackage">
   <title>インストールまたは削除するパッケージの選択</title>
   <para>
    コマンド<command>zypper install</command>および<command>zypper remove</command>でパッケージを指定するには、さまざまな方法があります。
   </para>
   <variablelist>
    <varlistentry>
     <term>正確なパッケージ名を指定する</term>
     <listitem>
<screen><prompt>tux &gt; </prompt>sudo zypper install MozillaFirefox</screen>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>正確なパッケージ名およびバージョン番号を指定する</term>
     <listitem>
<screen><prompt>tux &gt; </prompt>sudo zypper install MozillaFirefox-3.5.3</screen>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>リポジトリエイリアスおよびパッケージ名を指定する</term>
     <listitem>
<screen><prompt>tux &gt; </prompt>sudo zypper install mozilla:MozillaFirefox</screen>
      <para>
       ここで<literal>mozilla</literal>は、インストールするリポジトリのエイリアスです。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>ワイルドカードを使用してパッケージ名を指定する</term>
     <listitem>
      <para>
       名前が特定の文字列で始まるか、特定の文字列で終わるパッケージをすべて選択できます。特にパッケージを削除する場合は、ワイルドカードの使用には注意が必要です。次のコマンドでは、名前の先頭に<quote>Moz</quote>が付くすべてのパッケージがインストールされます。
      </para>
<screen><prompt>tux &gt; </prompt>sudo zypper install 'Moz*'</screen>
      <tip>
       <title>すべての<filename>-debuginfo</filename>パッケージを削除</title>
       <para>
        問題をデバッグする際、実行中のプロセスに関する情報を多く得るために、一時的に多数の<filename>-debuginfo</filename>パッケージをインストールする場合があります。デバッグセッションが終了したら、この環境を消去する必要があります。それには以下を実行します。
       </para>
<screen><prompt>tux &gt; </prompt>sudo zypper remove '*-debuginfo'</screen>
      </tip>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>機能によって指定する</term>
     <listitem>
      <para>
       たとえば、パッケージ名がわからないPerlモジュールをインストールする場合は、機能による指定が便利です。
      </para>
<screen><prompt>tux &gt; </prompt>sudo zypper install firefox</screen>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>機能、ハードウェアアーキテクチャ、またはバージョンによって指定する</term>
     <listitem>
      <para>
       機能とともに、ハードウェアアーキテクチャとバージョンを指定できます。
      </para>
      <itemizedlist>
       <listitem>
        <para>
         機能の後にピリオドを付けて、その後に目的のハードウェアアーキテクチャの名前を追加します。たとえば、AMD64/Intel 64アーキテクチャ(Zypperでの名前は<literal>x86_64</literal>)を指定するには、次のコマンドを使用します。
        </para>
<screen><prompt>tux &gt; </prompt>sudo zypper install 'firefox.x86_64'</screen>
       </listitem>
       <listitem>
        <para>
         バージョンは文字列の最後に追加し、バージョンの前に演算子を付ける必要があります。使用できる演算子は、<literal>&lt;</literal>(より小さい)、<literal>&lt;=</literal>(以下)、<literal>=</literal>(等しい)、<literal>&gt;=</literal>(以上)、<literal>&gt;</literal>(より大きい)です。
        </para>
<screen><prompt>tux &gt; </prompt>sudo zypper install 'firefox&gt;=3.5.3'</screen>
       </listitem>
       <listitem>
        <para>
         必要なハードウェアアーキテクチャとバージョンを組み合わせて指定することもできます。
        </para>
<screen><prompt>tux &gt; </prompt>sudo zypper install 'firefox.x86_64&gt;=3.5.3'</screen>
       </listitem>
      </itemizedlist>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>RPMファイルのパスによって指定する</term>
     <listitem>
      <para>
       また、パッケージに対するローカルパスまたはリモートパスを指定できます。
      </para>
<screen><prompt>tux &gt; </prompt>sudo zypper install /tmp/install/MozillaFirefox.rpm
<prompt>tux &gt; </prompt>sudo zypper install http://download.opensuse.org/repositories/mozilla/SLE_12/x86_64/MozillaFirefox-45.0.2-1.1.x86_64.rpm</screen>
     </listitem>
    </varlistentry>
   </variablelist>
  </sect3>
  <sect3 xml:id="sec.zypper.combineinstall">
   <title>パッケージのインストールと削除の結合</title>
   <para>
    パッケージのインストールと削除を同時に行うには、<literal>+/-</literal>修飾子を使用します。同時に
    <package>emacs</package>
    のインストールと、
    <package>vim</package>
    の削除を行うには、次のコマンドを使用します。
   </para>
<screen><prompt>tux &gt; </prompt>sudo zypper install emacs -vim</screen>
   <para>
    同時に
    <package>emacs</package>
    の削除と、
    <package>vim</package>
    のインストールを行うには、次のコマンドを使用します。
   </para>
<screen><prompt>tux &gt; </prompt>sudo zypper remove emacs +vim</screen>
   <para>
    名前の先頭に<literal>-</literal>が付くパッケージ名がコマンドオプションとして解釈されないようにするには、常に第2引数としてその名前を使用します。これが可能でない場合は、名前の前に<literal>--</literal>を付けます。
   </para>
<screen><prompt>tux &gt; </prompt>sudo zypper install -emacs +vim       # Wrong
<prompt>tux &gt; </prompt>sudo zypper install vim -emacs        # Correct
<prompt>tux &gt; </prompt>sudo zypper install -- -emacs +vim    # same as above
<prompt>tux &gt; </prompt>sudo zypper remove emacs +vim         # same as above</screen>
  </sect3>
  <sect3 xml:id="sec.zypper.clean">
   <title>削除されたパッケージの依存関係のクリーンアップ</title>
   <para>
    指定したパッケージの削除後に、不要になったパッケージも自動的に削除されるようにしたい場合は、<option>--clean-deps</option>オプションを使用します。
   </para>
<screen><prompt>tux &gt; </prompt>sudo zypper rm <replaceable>package_name</replaceable> --clean-deps</screen>
  </sect3>
  <sect3 xml:id="sec.zypper.script">
   <title>スクリプトでのZypperの使用</title>
   <para>
    Zypperではデフォルトで、選択したパッケージのインストールまたは削除の前に、あるいは問題が発生した際には、確認が求められます。この動作は、<option>--non-interactive</option>オプションを使用することで上書きされます。このオプションは、次のように、実際のコマンド(<command>install</command>、<command>remove</command>、<command>patch</command>)の前に指定する必要があります。
   </para>
<screen><prompt>tux &gt; </prompt>sudo zypper <option>--non-interactive</option> install <replaceable>package_name</replaceable></screen>
   <para>
    このオプションは、スクリプトおよびcronジョブでZypperを使用できます。
   </para>
  </sect3>
  <sect3 xml:id="sec.zypper.softman.sources">
   <title>ソースパッケージのインストールまたはダウンロード</title>
   <para>
    パッケージの対応するソースパッケージをインストールする場合は、次のコマンドを使用します。
   </para>
<screen><prompt>tux &gt; </prompt>zypper source-install <replaceable>package_name</replaceable></screen>
   <para>
    ソースパッケージをインストールするデフォルトの場所は、<systemitem class="username">root</systemitem>として実行する場合は<filename>/usr/src/packages/</filename>、ユーザとして実行する場合は<filename>~/rpmbuild</filename>になります。これらの値はローカルの<command>rpm</command>設定で変更できます。
   </para>
   <para>
    このコマンドにより、指定したパッケージのビルド依存関係もインストールされます。この処理が必要でない場合は、次のようにスイッチ<literal>-D</literal>を追加します。ビルドの依存関係のみをインストールするには、<literal>-d</literal>を使用します。
   </para>
<screen><prompt>tux &gt; </prompt>sudo zypper source-install -D <replaceable>package_name</replaceable> # source package only
<prompt>tux &gt; </prompt>sudo zypper source-install -d <replaceable>package_name</replaceable> # build dependencies only</screen>
   <para>
    もちろん、リポジトリリストで有効にしたソースパッケージを含むリポジトリが存在する場合にのみ動作します(ソースパッケージはデフォルトで追加されますが、有効にはなりません)。リポジトリの管理の詳細については、<xref linkend="sec.zypper.instrepo"/>を参照してください。
   </para>
   <para>
    リポジトリで使用可能なすべてのソースパッケージのリストは、次のコマンドで参照できます。
   </para>
<screen><prompt>tux &gt; </prompt>zypper search -t srcpackage</screen>
   <para>
    また、すべてのインストール済みパッケージのソースパッケージをローカルディレクトリにダウンロードすることもできます。ソースパッケージをダウンロードするには、以下を使用します。
   </para>
<screen><prompt>tux &gt; </prompt>zypper source-download</screen>
   <para>
    デフォルトのダウンロードディレクトリは<filename>/var/cache/zypper/source-download</filename>です。これは、<option>--directory</option>オプションを使って変更できます。ダウンロードや削除を行わず、不足パッケージや不要パッケージの表示のみを行う場合は、<option>--status</option>オプションを使用します。不要なソースパッケージを削除するには、<option>--delete</option>オプションを使用します。削除を無効にするには、<option>--no-delete</option>オプションを使用します。
   </para>
  </sect3>
  <sect3 xml:id="sec.zypper.softman.pluscontent">
   <title>無効にされたリポジトリからのパッケージのインストール</title>
   <para>
    通常、パッケージのインストールは、有効化されたリポジトリからしかできません。<option>--plus-content <replaceable>tag</replaceable></option>オプションを使用すると、リポジトリをリフレッシュし、現在のZypperセッション中のみ一時的に有効にして、終了したら無効にすることができます。
   </para>
   <para>
    たとえば、追加の<filename>-debuginfo</filename>パッケージまたは<filename>-debugsource</filename>パッケージを提供するリポジトリを有効にするには、<option>--plus-content debug</option>を使用します。このオプションは複数回指定できます。 
   </para>
   <para>
    そうした「デバッグ」リポジトリを一時的に有効にして、特定の<filename>-debuginfo</filename>パッケージをインストールするには、次のオプションを使用します。
   </para>
<screen><prompt>tux &gt; </prompt>sudo zypper --plus-content debug install "debuginfo(build-id)=eb844a5c20c70a59fc693cd1061f851fb7d046f4"</screen>
   <para>
    debuginfoパッケージがないと、<literal>build-id</literal>文字列が、<command>gdb</command>によって報告されます。
   </para>
  </sect3>
  <sect3 xml:id="sec.zypper.softman.util">
   <title>ユーティリティ</title>
   <para>
    すべての依存関係が依然として満たされていることを確認し、欠如する依存関係を修復するには、次のコマンドを使用します。
   </para>
<screen><prompt>tux &gt; </prompt>zypper verify</screen>
   <para>
    必要とされる依存関係に加えて、一部のパッケージでは他のパッケージが<quote>推奨されます</quote>。これらの推奨対象パッケージは、実際に使用可能でインストール可能な場合のみインストールされます。推奨側のパッケージがインストールされた後で、(パッケージまたはハードウェアの追加により)推奨対象パッケージが使用可能になった場合は、次のコマンドを使用します。
   </para>
<screen><prompt>tux &gt; </prompt>sudo zypper install-new-recommends</screen>
   <para>
    このコマンドは、WebカメラまたはWi-Fiデバイスを接続した後で非常に役に立ちます。このコマンドは、デバイスのドライバと関連ソフトウェアが利用できる場合には、それらをインストールします。ドライバと関連ソフトウェアは、一定のハードウェア依存関係が満たされている場合のみインストールできます。
   </para>
  </sect3>
 </sect2>

 <sect2 xml:id="sec.zypper.softup">
  <title>Zypperによるソフトウェアの更新</title>
  <para>
   Zypperを使用してソフトウェアを更新するには3つの方法があります。パッチをインストールする、パッケージの新しいバージョンをインストールする、または配布全体を更新する方法です。最後の方法は、<command>zypper dist-upgrade</command>で行うことができます。<phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase>のアップグレードについては、<phrase os="sles;sled"><xref linkend="cha.update.sle"/></phrase>を参照してください。
  </para>
  <sect3 xml:id="sec.zypper.softup.patch">
   <title>必要なすべてのパッチのインストール</title>
   <para>
    システムに適用される、正式にリリースされたすべてのパッチをインストールするには、次のコマンドを実行します。
   </para>
<screen><prompt>tux &gt; </prompt>sudo zypper patch</screen>
   <para>
    コンピュータに設定されているリポジトリから使用可能なすべてのパッチが、インストール環境に関係があるかどうかが確認されます。関係がある場合(および<literal>optional</literal>または<literal>feature</literal>として分類されていない場合)、パッチはただちにインストールされます。<phrase os="sles;sled">正式な更新リポジトリは<phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase>のインストールを登録した後でのみ使用可能であることに注意してください。</phrase>
   </para>
   <para>
    インストールするパッチにシステムの再起動が必要な変更が含まれる場合、事前に警告が表示されます。
   </para>

   <para>
    オプションのパッチもインストールするには、次のコマンドを使用します。
   </para>
<screen><prompt>tux &gt; </prompt>sudo zypper patch --with-optional</screen>
   <remark>
    The structure here is a bit unfortunate: We explain how to use the
    --cve/--bugzilla options in more detail below ("Listing Patches").
    However, the first bit people get is the very brief intro immediately below.
    Not sure whether to replicate all the information from "Listing Patches"
    here.
    - sknorr, 2016-04-25
   </remark>
   <para>
    Bugzillaの特定の問題に関連するすべてのパッチをインストールするには、次のコマンドを使用します。
   </para>
<screen><prompt>tux &gt; </prompt>sudo zypper patch --bugzilla=<replaceable>number</replaceable></screen>
   <para>
    特定のCVEデータベースエントリに関連するすべてのパッチをインストールするには、次のコマンドを使用します。
   </para>
<screen><prompt>tux &gt; </prompt>sudo zypper patch --cve=<replaceable>number</replaceable></screen>
   <para>
    たとえば、CVE番号が<literal>CVE-2010-2713</literal>のセキュリティパッチをインストールするには、次のコマンドを実行します。
   </para>
<screen><prompt>tux &gt; </prompt>sudo zypper patch --cve=CVE-2010-2713</screen>
   <para>
    Zypperおよびパッケージ管理自体に影響するパッチのみをインストールするには、次のコマンドを使用します。
   </para>
<screen><prompt>tux &gt; </prompt>sudo zypper patch --updatestack-only</screen>
  </sect3>
  <sect3 xml:id="sec.zypper.softup.listpatch">
   <title>パッチのリストの表示</title>
   <para>
    パッチが使用可能かどうかを確認するため、Zypperでは次の情報を参照できます。
   </para>
   <variablelist>
    <varlistentry>
     <term>必要なパッチの数</term>
     <listitem>
      <para>
       必要なパッチ(システムに適用されるパッチであってもまだインストールされていないもの)の数のリストを表示するには、<command>patch-check</command>を使用します。
      </para>
<screen><prompt>tux &gt; </prompt>zypper patch-check
Loading repository data...
Reading installed packages...
5 patches needed (1 security patch)</screen>
      <para>
       このコマンドを<option>--updatestack-only</option>オプションと組み合わせて使用すると、Zypperおよびパッケージ管理自体に影響するパッチのみのリストを表示できます。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>必要なパッチのリスト</term>
     <listitem>
      <para>
       必要なすべてのパッチ(システムに適用されるパッチであってもまだインストールされていないもの)のリストを表示するには、<command>list-patches</command>を使用します。
      </para>
<screen><?dbsuse-fo font-size="0.70em"?>

<prompt>tux &gt; </prompt>zypper list-patches
Loading repository data...
Reading installed packages...

Repository     | Name        | Version | Category | Status  | Summary
---------------+-------------+---------+----------+---------+---------
SLES12-Updates | SUSE-2014-8 | 1       | security | needed  | openssl: Update for OpenSSL
</screen>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>すべてのパッチのリスト</term>
     <listitem>
      <para>
       インストール済みかどうか、およびインストール環境に適用されるかどうかに関係なく、<phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase>で使用可能なすべてのパッチのリストを表示するには、<command>zypper patches</command>を使用します。
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
   <para>
    また、特定の問題に関連するパッチを表示およびインストールすることもできます。特定のパッチを表示するには、次のオプションで<command>zypper list-patches</command>コマンドを使用します。
   </para>
   <variablelist>
    <varlistentry>
     <term>Bugzillaの問題によって指定する</term>
     <listitem>
      <para>
       Bugzillaの問題に関連する、必要なすべてのパッチのリストを表示するには、オプション<option>--bugzilla</option>を使用します。
      </para>
      <para>
       特定のバグに対応するパッチのリストを表示するには、<option>--bugzilla=<replaceable>number</replaceable></option>のようにバグ番号を指定することもできます。Bugzillaの複数の問題に関連するパッチを検索するには、次の例のように、バグ番号の間にカンマを追加します。
      </para>
<screen><prompt>tux &gt; </prompt>zypper list-patches --bugzilla=972197,956917</screen>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>CVE番号によって指定する</term>
     <listitem>
      <para>
       CVE(Common Vulnerabilities and Exposures)データベースのエントリに関連する、必要なすべてのパッチのリストを表示するには、オプション<option>--cve</option>を使用します。
      </para>
      <para>
       特定のCVEデータベースエントリに対応するパッチのリストを表示するには、<option>--cve=<replaceable>number</replaceable></option>のようにCVE番号を指定することもできます。複数のCVEデータベースエントリに関連するパッチを検索するには、次の例のように、CVE番号の間にカンマを追加します。
      </para>
<screen><prompt>tux &gt; </prompt>zypper list-patches --bugzilla=CVE-2016-2315,CVE-2016-2324</screen>
     </listitem>
    </varlistentry>
   </variablelist>
   <para>
    必要かどうかに関係なくすべてのパッチのリストを表示するには、追加でオプション<option>--all</option>を使用します。たとえば、CVE番号が割り当てられたすべてのパッチのリストを表示するには、次のコマンドを使用します。
   </para>
<screen><?dbsuse-fo font-size="0.70em"?>

<prompt>tux &gt; </prompt>zypper list-patches --all --cve
Issue | No.           | Patch             | Category    | Severity  | Status
------+---------------+-------------------+-------------+-----------+----------
cve   | CVE-2015-0287 | SUSE-SLE-Module.. | recommended | moderate  | needed
cve   | CVE-2014-3566 | SUSE-SLE-SERVER.. | recommended | moderate  | not needed
[...]</screen>
  </sect3>
  <sect3 xml:id="sec.zypper.softup.update">
   <title>新規パッケージパージョンのインストール</title>
   <para>
    リポジトリに新しいパッケージのみが存在し、パッチが提供されていない場合は、<command>zypper patch</command>は無効です。インストールされているパッケージをすべて(システムの整合性を維持しながら)新しく入手可能なバージョンでアップデートするには、次を使用します。
   </para>
<screen><prompt>tux &gt; </prompt>sudo zypper update</screen>
   <para>
    個別のパッケージをアップデートするには、updateコマンドまたはinstallコマンドのいずれかでパッケージを指定します。
   </para>
<screen><prompt>tux &gt; </prompt>sudo zypper update <replaceable>package_name</replaceable>
<prompt>tux &gt; </prompt>sudo zypper install <replaceable>package_name</replaceable></screen>
   <para>
    インストール可能なすべての新しいパッケージのリストを、次のコマンドで取得できます。
   </para>
<screen><prompt>tux &gt; </prompt>zypper list-updates</screen>
   <para>
    ただし、このコマンドで表示されるのは、次の条件に一致するパッケージのみです。
   </para>
   <itemizedlist>
    <listitem>
     <para>
      すでにインストール済みのパッケージと同じベンダである
     </para>
    </listitem>
    <listitem>
     <para>
      すでにインストール済みのパッケージと同等以上の優先度をもつリポジトリによって提供される
     </para>
    </listitem>
    <listitem>
     <para>
      インストール可能である(すべての依存関係が満たされている)
     </para>
    </listitem>
   </itemizedlist>
   <para>
    次のコマンドを使用すると、(インストール可能かどうかに関わらず)<emphasis>すべての</emphasis>新しい使用可能なパッケージのリストを取得できます。
   </para>
<screen><prompt>tux &gt; </prompt>sudo zypper list-updates --all</screen>
   <para>
    新しいパッケージをインストールできない理由を見つけるには、上で説明されているように、<command>zypper install</command>コマンドまたは<command>zypper update</command>コマンドを使用します。
   </para>
  </sect3>
  <sect3 xml:id="sec.zypper.softup.orphaned">
   <title>孤立パッケージの特定</title>
   <para>
    Zypperからリポジトリを削除する場合や、システムをアップグレードする場合には、いくつかのパッケージが<quote>孤立</quote>状態になる可能性があります。これらの<emphasis>孤立</emphasis>パッケージは、どのアクティブなリポジトリにも属していません。次のコマンドで、これらのリストを表示できます。
   </para>
<screen><prompt>tux &gt; </prompt>sudo zypper packages --orphaned</screen>
   <para>
    このリストを使用して、パッケージが引き続き必要か、それとも削除しても安全かを判断できます。
   </para>
  </sect3>

 </sect2>

 <sect2 xml:id="sec.zypper.ps">
  <title>削除されたファイルを使用しているプロセスとサービスの特定</title>
  <para>
   パッケージにパッチを適用したり、パッケージを更新または削除したりした場合、更新または削除によって削除されたファイルを引き続き使用している実行中のプロセスがシステムに存在することがあります。削除されたファイルを使用しているプロセスのリストを表示するには、<command>zypper ps</command>を使用します。プロセスが既知のサービスに属している場合は、サービス名のリストが表示され、そのサービスを容易に再起動できます。デフォルトでは、<command>zypper ps</command>は次のような表を表示します。
  </para>
<screen>PID   | PPID | UID | User  | Command      | Service      | Files
------+------+-----+-------+--------------+--------------+-------------------
814   | 1    | 481 | avahi | avahi-daemon | avahi-daemon | /lib64/ld-2.19.s-&gt;
      |      |     |       |              |              | /lib64/libdl-2.1-&gt;
      |      |     |       |              |              | /lib64/libpthrea-&gt;
      |      |     |       |              |              | /lib64/libc-2.19-&gt;
[...]</screen>
  <simplelist>
   <member><emphasis role="bold">PID</emphasis>: プロセスのID </member> <member><emphasis role="bold">PPID</emphasis>: 親プロセスのID </member> <member><emphasis role="bold">UID</emphasis>: プロセスを実行しているユーザのID </member> <member><emphasis role="bold">Login</emphasis>: プロセスを実行しているユーザのログイン名 </member> <member><emphasis role="bold">Command</emphasis>: プロセスの実行に使用されたコマンド </member> <member><emphasis role="bold">Service</emphasis>: サービス名(コマンドがシステムサービスに関連付けられている場合のみ) </member> <member><emphasis role="bold">Files</emphasis>: 削除されたファイルのリスト </member>
  </simplelist>
  <para>
   次のように指定することで、<command>zypper ps</command>の出力フォーマットを制御できます。
  </para>
  <variablelist>
   <varlistentry>
    <term><command>zypper ps</command><option>-s</option>
    </term>
    <listitem>
     <para>
      削除されたファイルを表示しない短い表を作成します。
     </para>
<screen>PID   | PPID | UID  | User    | Command      | Service
------+------+------+---------+--------------+--------------
814   | 1    | 481  | avahi   | avahi-daemon | avahi-daemon
817   | 1    | 0    | root    | irqbalance   | irqbalance
1567  | 1    | 0    | root    | sshd         | sshd
1761  | 1    | 0    | root    | master       | postfix
1764  | 1761 | 51   | postfix | pickup       | postfix
1765  | 1761 | 51   | postfix | qmgr         | postfix
2031  | 2027 | 1000 | tux     | bash         |</screen>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><command>zypper ps</command><option>-ss</option>
    </term>
    <listitem>
     <para>
      システムサービスに関連付けられているプロセスのみを表示します。
     </para>
<screen>PID   | PPID | UID  | User    | Command      | Service
------+------+------+---------+--------------+--------------
814   | 1    | 481  | avahi   | avahi-daemon | avahi-daemon
817   | 1    | 0    | root    | irqbalance   | irqbalance
1567  | 1    | 0    | root    | sshd         | sshd
1761  | 1    | 0    | root    | master       | postfix
1764  | 1761 | 51   | postfix | pickup       | postfix
1765  | 1761 | 51   | postfix | qmgr         | postfix</screen>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><command>zypper ps</command><option>-sss</option>
    </term>
    <listitem>
     <para>
      削除されたファイルを使用しているシステムサービスのみを表示します。
     </para>
<screen>avahi-daemon
irqbalance
postfix
sshd</screen>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><command>zypper ps</command><option>--print "systemctl status %s"</option>
    </term>
    <listitem>
     <para>
      再起動が必要な可能性があるサービスのステータス情報を取得するコマンドを表示します。
     </para>
<screen>systemctl status avahi-daemon
systemctl status irqbalance
systemctl status postfix
systemctl status sshd</screen>
    </listitem>
   </varlistentry>
  </variablelist>
  <para>
   サービスの処理の詳細については、<xref linkend="cha.systemd"/>を参照してください。
  </para>
 </sect2>





 <sect2 xml:id="sec.zypper.instrepo">
  <title>Zypperによるリポジトリの管理</title>
  <para>
   Zypperのすべてのインストールまたはパッチのコマンドは、既知のリポジトリのリストに応じて異なります。システムで既知のすべてのリポジトリのリストを表示するには、次のコマンドを使用します。
  </para>
<screen><prompt>tux &gt; </prompt>zypper repos</screen>
  <para>
   結果は、次の出力のようになります。
  </para>
  <example xml:id="ex.zypper.repos">
   <title>Zypper—既知のリポジトリのリスト</title>
<screen><?dbsuse-fo font-size="0.60em"
?>


# | Alias        | Name          | Enabled | Refresh
--+--------------+---------------+---------+--------
1 | SLEHA-12-GEO | SLEHA-12-GEO  | Yes     | No
2 | SLEHA-12     | SLEHA-12      | Yes     | No
3 | SLES12       | SLES12        | Yes     | No
  </screen>
  </example>
  <para>
   各種コマンドのリポジトリを指定するには、エイリアス、URI、またはリポジトリ番号を<command>zypper repos</command>コマンド出力から使用できます。リポジトリの別名は、リポジトリ操作コマンド用の短いリポジトリ名です。ただし、リポジトリリストの変更後に、リポジトリ番号が変わる可能性があります。エイリアスは変更されることはありません。
  </para>
  <para>
   デフォルトでは、URIやリポジトリの優先度など、詳細情報は表示されません。すべての詳細を表示するには、次のコマンドを使用します。
  </para>
<screen><prompt>tux &gt; </prompt>zypper repos -d</screen>
  <sect3 xml:id="sec.zypper.instrepo.add">
   <title>リポジトリの追加</title>
   <para>
    リポジトリを追加するには、次を実行します。
   </para>
<screen><prompt>tux &gt; </prompt>sudo zypper addrepo <replaceable>URI</replaceable> <replaceable>alias</replaceable></screen>
   <para>
    <replaceable>URI</replaceable>は、インターネットリポジトリ、ネットワークリソース、ディレクトリ、CDまたはDVDのいずれかです(詳細については、<link xlink:href="http://en.opensuse.org/openSUSE:Libzypp_URIs"/>を参照してください)。<replaceable>別名</replaceable>は、リポジトリの短い固有のIDです。このIDは、固有である必要があること以外は自由に選択できます。すでに使用されているエイリアスを指定した場合、Zypperでは警告が発行されます。
   </para>
  </sect3>
  <sect3 xml:id="sec.zypper.instrepo.rm">
   <title>リポジトリの削除</title>
   <para>
    リストからリポジトリを削除する場合は、コマンド<command>zypper removerepo</command>を使用し、削除するリポジトリのエイリアスまたは番号を指定します。たとえば、<xref linkend="ex.zypper.repos"/>から<literal>SLEHA-12-GEO</literal>リポジトリを削除するには、次のコマンドのいずれかを使用します。
   </para>
<screen><prompt>tux &gt; </prompt>sudo zypper removerepo 1
<prompt>tux &gt; </prompt>sudo zypper removerepo "SLEHA-12-GEO"</screen>
  </sect3>
  <sect3 xml:id="sec.zypper.instrepo.mofify">
   <title>リポジトリの変更</title>
   <para>
    <command>zypper modifyrepo</command>によりリポジトリを有効または無効にします。また、このコマンドにより、リポジトリのプロパティ(動作、名前、優先度の更新など)を変更できます。次のコマンドは、<literal>updates</literal>という名前のリポジトリを有効にし、自動更新をオンにし、リポジトリの優先度を 20に設定します。
   </para>
<screen><prompt>tux &gt; </prompt>sudo zypper modifyrepo -er -p 20 'updates'</screen>
   <para>
    リポジトリを変更する場合、1つのリポジトリだけなく、リポジトリのグループも操作できます。
   </para>
   <simplelist>
    <member><option>-a</option>: すべてのリポジトリ</member> <member><option>-l</option>: ローカルリポジトリ</member> <member><option>-t</option>: リモートリポジトリ</member> <member><option>-m</option> <replaceable>タイプ</replaceable>:特定のタイプのリポジトリ(ここで、<replaceable>タイプ</replaceable>には、次のいずれかを指定できます:  <literal>http</literal>、<literal>https</literal>、<literal>ftp</literal>、<literal>cd</literal>、<literal>dvd</literal>、<literal>dir</literal>、<literal>file</literal>、<literal>cifs</literal>、<literal>smb</literal>、<literal>nfs</literal>、<literal>hd</literal>、<literal>iso</literal>) 。</member>
   </simplelist>
   <para>
    リポジトリエイリアスの名前を変更するには、<literal>renamerepo</literal>コマンドを使用します。次の例では、エイリアスを<literal>Mozilla Firefox</literal>から<literal>firefox</literal>に変更しています。
   </para>
<screen><prompt>tux &gt; </prompt>sudo zypper renamerepo 'Mozilla Firefox' firefox</screen>
  </sect3>
 </sect2>

 <sect2 xml:id="sec.zypper.query">
  <title>Zypperによるリポジトリおよびパッケージのクエリ</title>
  <para>
   Zypperでは、リポジトリまたはパッケージをクエリするためのさまざまな方法が提供されています。使用可能なすべての製品、パターン、パッケージ、またはパッチのリストを取得するには、次のコマンドを使用します。
  </para>
<screen><prompt>tux &gt; </prompt>zypper products
<prompt>tux &gt; </prompt>zypper patterns
<prompt>tux &gt; </prompt>zypper packages
<prompt>tux &gt; </prompt>zypper patches</screen>
  <para>
   特定のパッケージについてすべてのリポジトリをクエリするには、<literal>search</literal>を使用します。searchは、パッケージの名前、またはパッケージの概要と説明(オプション)に関して機能します。<literal>/</literal>でラップされた文字列は、正規表現として解釈されます。デフォルトでは、検索で大文字と小文字は区別されません。
  </para>
  <variablelist>
   <varlistentry>
    <term><literal>fire</literal>を含むパッケージ名の単純な検索
    </term>
    <listitem>
<screen><prompt>tux &gt; </prompt>zypper search "fire"</screen>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>正確なパッケージ<literal>MozillaFirefox</literal>の単純な検索
    </term>
    <listitem>
<screen><prompt>tux &gt; </prompt>zypper search --match-exact "MozillaFirefox"</screen>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>パッケージの説明とサマリも検索</term>
    <listitem>
<screen><prompt>tux &gt; </prompt>zypper search -d fire</screen>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>まだインストールしていないパッケージのみ表示</term>
    <listitem>
<screen><prompt>tux &gt; </prompt>zypper search -u fire</screen>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>文字列<literal>fir</literal>を含み、この後に<literal>e</literal>が続かないパッケージの表示
    </term>
    <listitem>
<screen><prompt>tux &gt; </prompt>zypper se "/fir[^e]/"</screen>
    </listitem>
   </varlistentry>
  </variablelist>
  <para>
   特定の機能を提供するパッケージを検索するには、コマンド<literal>what-provides</literal>を使用します。たとえば、どのパッケージがPerlモジュール<literal>SVN::Core</literal>を提供するか確認したい場合は、次のコマンドを使用します。
  </para>
<screen><prompt>tux &gt; </prompt>zypper what-provides 'perl(SVN::Core)'</screen>
  <para>
   単一のパッケージをクエリするには、<command>info</command>を使用し、引数として正確なパッケージ名を指定します。パッケージに関する詳細情報を表示します。パッケージの要求や推奨も表示するには、<option>--requires</option>オプションや<option>--recommends</option>オプションを使用します。
  </para>
<screen><prompt>tux &gt; </prompt>zypper info --requires MozillaFirefox</screen>
  <para>
   <literal>what-provides<replaceable>パッケージ</replaceable></literal>は<command>rpm -q --whatprovides</command><replaceable>パッケージ</replaceable>に似ていますが、RPMではRPMデータベース(つまり、すべてのインストール済みパッケージのデータベース)のみを問い合わせることができます。それに対してZypperは、インストール済みのパッケージだけでなく、すべてのリポジトリから機能のプロバイダに関する情報を表示します。
  </para>
 </sect2>

 <sect2 xml:id="sec.zypper.configure">
  <title>Zypperの設定</title>
  <para>
   Zypperには、現在、設定ファイルが付属しています。この設定ファイルを使用すれば、Zypperの動作を(システム全体またはユーザ固有のでどちらかで)永続的に変更できます。システム全体に渡って変更する場合は、<filename>/etc/zypp/zypper.conf</filename>を編集します。ユーザ固有に変更する場合は、<filename>~/.zypper.conf</filename>を編集します。<filename>~/.zypper.conf</filename>がまだ存在していない場合は、テンプレートとして<filename>/etc/zypp/zypper.conf</filename>を使用できます。このテンプレートを<filename>~/.zypper.conf</filename>にコピーして、好みに合わせて調整してください。利用できるオプションのヘルプについては、ファイル内のコメントを参照してください。
  </para>
 </sect2>

 <sect2 xml:id="sec.zypper.trouble">
  <title>トラブルシューティング</title>
  <para>
   設定済みのリポジトリからのパッケージへのアクセスに問題がある場合(たとえば、一定のパッケージがリポジトリの1つに存在することを知っていても、Zypperでそのリポジトリを見つけられない場合など)は、次のコマンドでリポジトリを更新すると有効なことがあります。
  </para>
<screen><prompt>tux &gt; </prompt>sudo zypper refresh</screen>
  <para>
   それも役に立たない場合は、次のコマンドを試してください。
  </para>
<screen><prompt>tux &gt; </prompt>sudo zypper refresh -fdb</screen>
  <para>
   このコマンドは、生メタデータの強制ダウンロードを含むデータベースの完全な更新と再構築を強制します。
  </para>
 </sect2>

 <sect2 xml:id="sec.zypper.rollback">
  <title>BtrfsファイルシステムでのZypperロールバック機能</title>
  <para>
   ルートパーティションでBtrfsファイルシステムが使用され、<command>snapper</command>がインストールされている場合に、ファイルシステムに対する変更をコミットして適切なファイルシステムスナップショットを作成すると、Zypperは(<command>snapper</command>によってインストールされるスクリプト経由で)自動的に<command>snapper</command>を呼び出します。これらのスナップショットは、Zypperによって行われた変更を元に戻す場合に使用できます。詳細については、<xref linkend="cha.snapper"/>を参照してください。
  </para>
 </sect2>

 <sect2 xml:id="sec.zypper.more">
  <title>その他の情報</title>
  <para>
   コマンドラインからのソフトウェア管理の詳細については、「<command>zypper help</command>」、「<command>zypper help </command><replaceable/>」と入力するか、<command>zypper(8)</command>のマニュアルページを参照してください。最も重要なコマンドの<literal>早見表</literal>を含む詳しいコマンドリファレンス、およびスクリプトやアプリケーションにおけるZypperの詳しい使い方については、<link xlink:href="http://en.opensuse.org/SDB:Zypper_usage"/>を参照してください。<phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase>の最新バージョンにおけるソフトウェアの変更点のリストについては、<link xlink:href="http://en.opensuse.org/openSUSE:Zypper versions"/>を参照してください。
  </para>
 </sect2>
</sect1>
