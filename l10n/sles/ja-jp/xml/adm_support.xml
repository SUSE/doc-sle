<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="adm_support.xml" version="5.0" xml:id="cha-adm-support">


 <title>サポート用システム情報の収集</title>
 <info>
  <abstract>
   <para>
    マシンに関連するすべてのシステム情報の概要をすばやく参照できるよう、<phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase>では<systemitem class="systemname">hostinfo</systemitem>パッケージが提供されています。このパッケージは、システム管理者が汚染カーネル(サポートされていません)やサードパーティパッケージがマシンにインストールされていないかどうかを確認する場合にも役立ちます。
   </para>

   <para>
    問題がある場合は、<command>supportconfig</command>コマンドラインツールまたはYaST<guimenu>サポート</guimenu>モジュールで詳細なシステムレポートを作成できます。どちらも、現在のカーネルのバージョン、ハードウェア、インストールされているパッケージ、パーティションセットアップなどのシステム情報を収集します。結果は、複数のファイルのTARアーカイブになります。サービス要求(SR)を開いた後、そのTARアーカイブをグローバルテクニカルサポートにアップロードできます。これは、レポートされた問題を特定したり、問題解決を支援したりするのに役立ちます。
   </para>

   <para>
    また、既知の問題がないかどうか<command>supportconfig</command>の出力を分析することで、問題解決を迅速化できます。このために、<phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase>では、<literal>Supportconfig Analysis</literal> (SCA)用のアプライアンスとコマンドラインツールの両方が提供されています。
   </para>
  </abstract>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:bugtracker/>
   <dm:translation>yes</dm:translation>
  </dm:docmanager>
 </info>
<indexterm>
 <primary>サポート</primary></indexterm><indexterm>
 <primary>システム情報</primary></indexterm>
 <sect1 xml:id="sec-admsupport-hostinfo">
  <title>現在のシステム情報の表示</title>



  <para>
   サーバへのログイン時に関連するすべてのシステム情報をすばやく簡単に参照するには、パッケージ<systemitem class="systemname">hostinfo</systemitem>を使用します。このパッケージをマシンにインストールすると、そのマシンにログインしたすべての<systemitem class="username">root</systemitem>ユーザに対して、コンソールに次の情報が表示されます。
  </para>

  <example xml:id="ex-support-hostinfo">
   <title><systemitem class="username">root</systemitem>としてログインしたときの<command>hostinfo</command>の出力</title>
<screen>Hostname:                 earth
Current As Of:            Wed 12 Mar 2014 03:57:05 PM CET
Distribution:             SUSE Linux Enterprise Server 12
 -Service Pack:           0
Architecture:             x86_64
Kernel Version:           3.12.12-3-default
 -Installed:              Mon 10 Mar 2014 03:15:05 PM CET
 -Status:                 Not Tainted
Last Updated Package:     Wed 12 Mar 2014 03:56:43 PM CET
 -Patches Needed:         0
 -Security:               0
 -3rd Party Packages:     0
IPv4 Address:             ens3 192.168.1.1
Total/Free/+Cache Memory: 983/95/383 MB (38% Free)
Hard Disk:                /dev/sda 10 GB</screen>
  </example>

  <para>
   この出力でカーネルのステータスが<literal>tainted</literal>と表示される場合、詳細については、<xref linkend="sec-admsupport-kernel"/>を参照してください。
  </para>
 </sect1>
 <sect1 xml:id="sec-admsupport-supportconfig">
  <title>Supportconfigによるシステム情報の収集</title>

  <para>
   グローバルテクニカルサポートに提出できる詳細なシステム情報のTARアーカイブを作成するには、<command>supportconfig</command>コマンドラインツールまたはYaST<guimenu>サポート</guimenu>モジュールを使用します。このコマンドラインツールは、デフォルトでインストールされるパッケージ<systemitem>supportutils</systemitem>によって提供されます。YaST<guimenu>サポート</guimenu>モジュールも、このコマンドラインツールが基になっています。
  </para>

  <sect2 xml:id="sec-admsupport-supportconfig-sr">
   <title>サービス要求番号の作成</title>
   <para>
    Supportconfigアーカイブはいつでも生成できます。ただし、supportconfigデータをグローバルテクニカルサポートに提出するには、まずサービス要求番号を生成する必要があります。サービス要求番号はアーカイブをサポートにアップロードするために必要です。
   </para>
   <para>
    サービス要求を作成するには、<link xlink:href="https://scc.suse.com/support/requests"/>にアクセスして、画面の指示に従います。12桁のサービス要求番号を記録します。
   </para>
   <note>
    <title>プライバシーポリシー</title>
    <para>
     SUSEおよびMicro Focusは、システムレポートを機密データとして扱います。プライバシーに関する取り組みの詳細については、<link xlink:href="https://www.suse.com/company/policies/privacy/"/>を参照してください。
    </para>
   </note>
  </sect2>

  <sect2 xml:id="sec-admsupport-supportconfig-upload">
   <title>アップロード先</title>
   <para>
    サービス要求番号を作成したら、supportconfigアーカイブをグローバルテクニカルサポートにアップロードできます。<xref linkend="pro-admsupport-submit-yast"/>または<xref linkend="pro-admsupport-submit-cli"/>を参照してください。次のいずれかのアップロードターゲットを使用します。
   </para>


   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>
      米国内のお客様: <link xlink:href="ftp://ftp.novell.com/incoming"/>
     </para>
    </listitem>
    <listitem>
     <para>
      EMEA (ヨーロッパ、中東、およびアフリカ): <link xlink:href="ftp://support-ftp.suse.com/in"/>
     </para>
    </listitem>
   </itemizedlist>
   <para>
    または、サービス要求URL<link xlink:href="https://scc.suse.com/support/requests"/>を使用してTARアーカイブを手動でサービス要求に添付することもできます。
   </para>
  </sect2>

  <sect2 xml:id="sec-admsupport-yast">
   <title>YaSTでのSupportconfigアーカイブの作成</title>
   <para>
    YaSTでシステム情報を収集するには、次の手順に従います。 <remark>2008-11-20 toms: YaST asks the user to open a URL as
     root(!). This happens when the users clicks on "Open" (Open
     Support Center/ This will start a browser with
     Support Center Portal). I do not think we should describe this
     and only *use* the above URL as a normal user for security
     reasons.</remark>
   </para>
   <procedure>
    <step>
     <para>
      YaSTを起動して、<guimenu>サポート</guimenu>モジュールを開きます。
     </para>
     <informalfigure>
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="yast2-support-main.png" width="70%" format="PNG"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="yast2-support-main.png" width="60%" format="PNG"/>
       </imageobject>
      </mediaobject>
     </informalfigure>
    </step>
    <step>
     <para>
      <guimenu>Create report tarball (レポートtarballを作成)</guimenu>をクリックします。
     </para>
    </step>
    <step>
     <para>
      次のウィンドウで、ラジオボタンリストからsupportconfigオプションを1つ選択します。デフォルトでは、<guimenu>Use Custom (Expert) Settings (カスタム(エキスパート)設定を使用します)</guimenu>があらかじめ選択されています。最初にレポート機能をテストしたい場合は、<guimenu>Only gather a minimum amount of info (最小限度の情報のみを収集する)</guimenu>を使用します。その他のオプションに関する背景情報については、<command>supportconfig</command>のマニュアルページを参照してください。
     </para>
     <para>
      <guimenu>次へ</guimenu>で続行します。
     </para>
    </step>
    <step xml:id="step-supportconfig-contact">
     <para>
      連絡先情報を入力します。情報は<filename>basic-environment.txt</filename>という名前のファイルに書き込まれ、作成するアーカイブに組み込まれます。
     </para>
    </step>
    <step xml:id="step-supportconfig-upload-target">
     <para>
      情報収集プロセスの終了時にアーカイブをグローバルテクニカルサポートに送信する場合、<guimenu>Upload Information (情報のアップロード)</guimenu>に入力する必要があります。YaSTによって自動的にアップロードサーバが提案されます。サーバを変更する場合、利用可能なアップロードサーバの詳細については、<xref linkend="sec-admsupport-supportconfig-upload"/>を参照してください。
     </para>
     <para>
      アーカイブを後で送信する場合、<guimenu>Upload Information (情報のアップロード)</guimenu>は空白のままで構いません。
     </para>
    </step>
    <step>
     <para>
      <guimenu>次へ</guimenu>で続行します。
     </para>
    </step>
    <step>
     <para>
      情報の収集が開始します。
     </para>
     <informalfigure>
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="yast2-support-conf.png" width="90%" format="PNG"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="yast2-support-conf.png" width="80%" format="PNG"/>
       </imageobject>
      </mediaobject>
     </informalfigure>
     <para>
      プロセスが完了したら、<guimenu>次へ</guimenu>で続行します。
     </para>
    </step>
    <step>
     <para>
      データ収集を確認します。ログファイルのファイル名を<guimenu>File Name (ファイル名)</guimenu>で選択して、YaSTで内容を表示します。サポートへの送信前にTARアーカイブから除外したいファイルを削除するには、<guimenu>Remove from Data (データから削除)</guimenu>を使用します。<guimenu>次へ</guimenu>で続行します。
     </para>
    </step>
    <step>
     <para>
      TARアーカイブを保存します。YaSTモジュールを<systemitem class="username">root</systemitem>ユーザとして起動した場合、デフォルトではアーカイブを<filename>/var/log</filename>に保存するよう提案されます(そうでない場合はホームディレクトリ)。ファイル名の形式は、<filename>nts_<replaceable>HOST</replaceable>_<replaceable>DATE</replaceable>_<replaceable>TIME</replaceable>.tbz</filename>です。
     </para>
    </step>
    <step>
     <para>
      アーカイブをサポートに直接アップロードする場合は、<guimenu>Upload log files tarball to URL (ログファイルtarballをURLへアップロード)</guimenu>が有効になっていることを確認してください。ここに表示される<guimenu>Upload Target (アップロードターゲット)</guimenu>は、<xref linkend="step-supportconfig-upload-target"/>でYaSTによって提案されたものです。アップロードターゲットを変更する場合は、<xref linkend="sec-admsupport-supportconfig-upload"/>で、利用可能なアップロードサーバの詳細情報を参照します。
     </para>
    </step>
    <step>
     <para>
      アップロードをスキップする場合は、<guimenu>Upload log files tarball to URL (ログファイルtarballをURLへアップロード)</guimenu>を無効にします。
     </para>
    </step>
    <step>
     <para>
      変更内容を確認し、YaSTモジュールを閉じます。
     </para>
    </step>
   </procedure>
  </sect2>

  <sect2 xml:id="sec-admsupport-cli">
   <title>コマンドラインからのsupportconfigアーカイブの作成</title>
   <para>
    次の手順は、supportconfigアーカイブをサポートに直接送信せずにアーカイブを作成する方法を示しています。アーカイブをアップロードするには、特定のオプションを指定してコマンドを実行する必要があります。<xref linkend="pro-admsupport-submit-cli"/>を参照してください。
   </para>
   <procedure>
    <step>
     <para>
      シェルを開き<systemitem class="username">root</systemitem>になります。
     </para>
    </step>
    <step>
     <para>
      オプションなしで<command>supportconfig</command>を実行します。デフォルトのシステム情報が収集されます。
     </para>
    </step>
    <step>
     <para>
      ツールが操作を完了するまで待機します。
     </para>
    </step>
    <step>
     <para>
      デフォルトのアーカイブ場所は<filename>/var/log</filename>で、ファイル名の形式は<filename>nts_<replaceable>HOST</replaceable>_<replaceable>DATE</replaceable>_<replaceable>TIME</replaceable>.tbz</filename>です。
     </para>
    </step>
   </procedure>
  </sect2>

  <sect2 xml:id="sec-admsupport-options">
   <title>Supportconfigの一般的なオプション</title>
   <para>
    <command>supportconfig</command>ユーティリティは、通常、オプションなしで呼び出されます。<command>supportconfig</command> <option> -h</option>で、すべてのオプションを一覧表示するか、マニュアルページを参照してください。よくある使用事例については、次のリストで簡単に説明します。
   </para>
   <variablelist>
    <varlistentry>
     <term>収集する情報のサイズを削減する</term>
     <listitem>
      <para>
       最小オプション(<option>-m</option>)を使用します。
      </para>
<screen>supportconfig -m</screen>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>情報を特定のトピックに限定する</term>
     <listitem>
      <para>
       すでにデフォルトの<command>supportconfig</command>出力で問題を特定し、その問題が特定の領域または機能セットにのみ関係することが判明している場合は、<command>supportconfig</command>の次回実行時に収集する情報を特定の領域に限定する必要があります。たとえば、LVMに問題があることを検出した場合に、最近変更したLVMの設定をテストしたいときは、LVMに関連する最小限のsupportconfig情報のみを収集するのが適切です。
      </para>
<screen>supportconfig -i LVM</screen>
      <para>
       収集する情報を特定の領域に限定する場合に使用できる機能のキーワードを網羅したリストについては、次のコマンドを実行します。
      </para>
<screen>supportconfig -F</screen>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>追加の連絡先情報を出力に含める</term>
     <listitem>
<screen>supportconfig -E tux@example.org -N "Tux Penguin" -O "Penguin Inc." ...</screen>
      <para>
       (すべてを1行に記述)
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>ローテーション済みログファイルの収集</term>
     <listitem>
<screen>supportconfig -l</screen>
      <para>
       これは、大規模なログを行う環境や、再起動後のsyslogによるログファイルのローテーション時にカーネルクラッシュが発生した場合に特に有効です。
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
  </sect2>
 </sect1>
 <sect1 xml:id="sec-admsupport-submit">
  <title>グローバルテクニカルサポートへの情報の送信</title>

  <para>
   システム情報をグローバルテクニカルサポートへ送信するには、YaST<guimenu>サポート</guimenu>モジュールまたは<command>supportconfig</command>コマンドラインユーティリティを使用します。サーバに問題がありサポートの支援が必要な場合、まずサービス要求を開く必要があります。詳細については、<xref linkend="sec-admsupport-supportconfig-sr"/>を参照してください。
  </para>

  <para>
   次の例では、実際のサービス要求番号のプレースホルダとして<replaceable>12345678901</replaceable>を使用しています。<replaceable>12345678901</replaceable>は、<xref linkend="sec-admsupport-supportconfig-sr"/>で作成したサービス要求番号に置き換えてください。
  </para>

  <procedure xml:id="pro-admsupport-submit-yast">
   <title>YaSTを使用したサポートへの情報の送信</title>
   <para>
    次の手順は、supportconfigアーカイブを作成済みであるものの、まだアップロードしていないことを想定しています。<xref linkend="sec-admsupport-yast"/>の<xref linkend="step-supportconfig-contact" xrefstyle="select:label nopage"/>で説明されているように、アーカイブに連絡先情報が含まれていることを確認してください。supportconfigアーカイブの生成と送信を一度に行う方法については、<xref linkend="sec-admsupport-yast"/>を参照してください。
   </para>
   <step>
    <para>
     YaSTを起動して、<guimenu>サポート</guimenu>モジュールを開きます。
    </para>
   </step>
   <step>
    <para>
     <guimenu>アップロード</guimenu>をクリックします。
    </para>
   </step>
   <step>
    <para>
     既存のsupportconfigアーカイブのパスを<guimenu>Package with log files (ログファイルのあるパッケージ)</guimenu>に指定するか、<guimenu>参照</guimenu>をクリックしてアーカイブを参照します。
    </para>
   </step>
   <step xml:id="step-supportcfg-submit-upltarget">
    <para>
     YaSTによって自動的にアップロードサーバが提案されます。サーバを変更する場合、利用可能なアップロードサーバの詳細については、<xref linkend="sec-admsupport-supportconfig-upload"/>を参照してください。
    </para>
    <informalfigure>
     <mediaobject>
      <imageobject role="fo">
       <imagedata fileref="yast2-support-conf-upload.png" width="70%" format="PNG"/>
      </imageobject>
      <imageobject role="html">
       <imagedata fileref="yast2-support-conf-upload.png" width="60%" format="PNG"/>
      </imageobject>
     </mediaobject>
    </informalfigure>
    <para>
     <remark>taroth 2014-04-11: this does not make sense to me - why does the
      YaST module *not* ask for the SR number now? and lets you continue after
      specifying an upload target (but no RC or customer info)? I would
      expect it to *check* if an SR has been entered and otherwise show an error
      message - filed http://bugzilla.suse.com/show_bug.cgi?id=880943 for this, unfortunately it
      was rejected for technical reasons</remark><guimenu>次へ</guimenu>で続行します。
    </para>
   </step>
   <step>
    <para>
     <guimenu>完了</guimenu>をクリックします。
    </para>
   </step>
  </procedure>

  <procedure xml:id="pro-admsupport-submit-cli">
   <title>コマンドラインからのサポートへの情報の送信</title>
   <para>
    次の手順は、supportconfigアーカイブを作成済みであるものの、まだアップロードしていないことを想定しています。supportconfigアーカイブの生成と送信を一度に行う方法については、<xref linkend="sec-admsupport-yast"/>を参照してください。
   </para>
   <step>
    <para>
     インターネット接続のあるサーバの場合
    </para>
    <substeps performance="required">
     <step>
      <para>
       デフォルトのアップロードターゲットを使用するには、次を実行します。
      </para>
<screen>supportconfig -ur <replaceable>12345678901</replaceable></screen>
     </step>
     <step>
      <para>
       安全なアップロードターゲットには、次を使用します。
      </para>

<screen>supportconfig -ar <replaceable>12345678901</replaceable></screen>
     </step>
    </substeps>
   </step>
   <step>
    <para>
     インターネット接続の<emphasis>ない</emphasis>サーバの場合
    </para>
    <substeps performance="required">
     <step>
      <para>
       次を実行します。
      </para>
<screen>supportconfig -r <replaceable>12345678901</replaceable></screen>
     </step>
     <step>
      <para>
       <filename>/var/log/nts_SR12345678901</filename><replaceable>*tbz</replaceable>アーカイブをいずれかのFTPサーバに手動でアップロードします。使用するサーバは世界のどの地域にいるかに応じて異なります。概要については、<xref linkend="sec-admsupport-supportconfig-upload"/>を参照してください。
      </para>
     </step>
    </substeps>
   </step>
   <step>
    <para>
     FTPサーバの着信ディレクトリにTARアーカイブが届くと、お客様のサービス要求に自動的に添付されます。
    </para>
   </step>
  </procedure>
 </sect1>

 <sect1 xml:id="sec-admsupport-sca">
  <title>システム情報の分析</title>

  <para>
   <command>supportconfig</command>で作成したシステムレポートで既知の問題がないかどうかを分析すると、問題の早期解決に役立ちます。このために、<phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase>では、<literal>Supportconfig Analysis</literal> (SCA)用のアプライアンスとコマンドラインツールの両方が提供されています。SCAアプライアンスは非対話型のサーバサイドツールです。SCAツール(<command>scatool</command>)はクライアント側で動作し、コマンドラインから実行します。どちらのツールも、関係するサーバからのsupportconfigアーカイブを分析します。サーバでの初回の分析は、SCAアプライアンス、またはscatoolが実行されているワークステーションで行われます。分析サイクルは運用サーバ上では実行されません。
  </para>

  <para>
   アプライアンスとコマンドラインツールのどちらにも、関連する製品のsupportconfig出力を分析できるようにする製品固有のパターンが追加で必要になります。各パターンは、特定の既知の問題がないかどうかsupportconfigアーカイブを解析して評価するスクリプトです。パターンはRPMパッケージとして提供されます。
  </para>

  <para>
   たとえば、SUSE Linux Enterprise 11マシン上で生成されたsupportconfigアーカイブを分析する場合は、SCAツールとともに(またはSCAアプライアンスサーバとして使用するマシン上に)パッケージ<systemitem class="resource">sca-patterns-sle11</systemitem>をインストールする必要があります。SUSE Linux Enterprise 10マシン上で生成されたsupportconfigアーカイブを分析するには、パッケージ<systemitem class="resource">sca-patterns-sle10</systemitem>が必要です。
  </para>

  <para>
   独自のパターンを開発することもできます。これについては、<xref linkend="sec-admsupport-sca-patterns"/>で簡単に説明されています。
  </para>

  <sect2 xml:id="sec-admsupport-sca-tool">
   <title>SCAコマンドラインツール</title>
   <para>
    SCAコマンドラインツールでは、<command>supportconfig</command>と、ローカルマシンにインストールされている特定の製品用の分析パターンの両方を使用してローカルマシンを分析できます。分析結果を示すHTMLレポートが作成されます。例については、<xref linkend="fig-scatool-html"/>を参照してください。
   </para>
   <figure xml:id="fig-scatool-html">
    <title>SCAツールによって生成されるHTMLレポート</title>
    <mediaobject>
     <imageobject role="fo">
      <imagedata fileref="sca_tool_report_html.png" width="100%"/>
     </imageobject>
     <imageobject role="html">
      <imagedata fileref="sca_tool_report_html.png" width="100%"/>
     </imageobject>
    </mediaobject>
   </figure>
   <para>
    <command>scatool</command>コマンドは<systemitem class="resource">sca-server-report</systemitem>パッケージで提供されます。デフォルトではインストールされません。さらに、<systemitem class="resource">sca-patterns-base</systemitem>パッケージ、および<command>scatool</command>コマンドを実行するマシンにインストールされている製品に一致する製品固有の<systemitem class="resource">sca-patterns-*</systemitem>パッケージも必要です。
   </para>
   <para>
    <command>scatool</command>コマンドは、<systemitem class="username">root</systemitem>ユーザとして実行するか、<command>sudo</command>を使用して実行します。SCAツールを呼び出すときに、既存の<command>supportconfig</command> TARアーカイブを分析するか、新しいアーカイブの生成と分析を同時に行うことができます。このツールは対話型コンソール(タブ補完機能を使用)も備えており、<command>supportconfig</command>を外部マシンで実行したり、それ以降の分析をローカルマシンで実行したりできます。
   </para>
   <para>
    次に、コマンドの例をいくつか示します。
   </para>
   <variablelist>
    <varlistentry>
     <term><command>sudo scatool </command><option>-s</option>
     </term>
     <listitem>
      <para>
       <command>supportconfig</command>を呼び出し、ローカルマシン上に新しいsupportconfigアーカイブを生成します。インストール済み製品に一致するSCA分析パターンを適用して、既知の問題がないかどうかアーカイブを分析します。分析結果から生成されたHTMLレポートのパスが表示されます。レポートは通常、supportconfigアーカイブのあるディレクトリと同じディレクトリに書き込まれます。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><command>sudo scatool </command><option>-s</option> <option>-o</option> <replaceable>/opt/sca/reports/</replaceable> 
     </term>
     <listitem>
      <para>
       <command>sudo scatool </command> <option>-s</option>と同じですが、HTMLレポートは<option>-o</option>で指定したパスに書き込まれる点が異なります。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><command>sudo scatool </command><option>-a</option> <replaceable>PATH_TO_TARBALL_OR_DIR</replaceable> 
     </term>
     <listitem>
      <para>
       指定したsupportconfigアーカイブファイル(またはsupportconfigアーカイブの展開先の指定ディレクトリ)を分析します。生成されたHTMLレポートは、supportconfigアーカイブまたはディレクトリと同じ場所に保存されます。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><command>sudo scatool </command><option>-a</option> <replaceable>SLES_SERVER.COMPANY.COM</replaceable> 
     </term>
     <listitem>
      <para>
       外部サーバ<replaceable>SLES_SERVER.COMPANY.COM</replaceable>とのSSH接続を確立し、そのサーバ上で<command>supportconfig</command>を実行します。その後、supportconfigアーカイブをローカルマシンにコピーし、そこで分析を行います。生成されたHTMLレポートは、デフォルトの<filename>/var/log</filename>ディレクトリに保存されます(<replaceable>SLES_SERVER.COMPANY.COM</replaceable>にはsupportconfigアーカイブのみが作成されます)。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><command>sudo scatool </command><option>-c</option>
     </term>
     <listitem>
      <para>
       <command>scatool</command>の対話型コンソールを起動します。利用可能なコマンドを参照するには、<keycap function="tab"/>を2回押します。
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
   <para>
    他のオプションおよび詳細については、<command>sudo scatool -h</command>を実行するか、<command>scatool</command>のマニュアルページを参照してください。
   </para>
  </sect2>

  <sect2 xml:id="sec-admsupport-sca-appliance">
   <title>SCAアプライアンス</title>
   <para>
    supportconfigアーカイブの分析にSCAアプライアンスを使用する場合は、専用のサーバ(または仮想マシン)をSCAアプライアンスサーバとして設定する必要があります。このSCAアプライアンスサーバを使用して、エンタープライズ内にある、SUSE Linux Enterprise ServerまたはSUSE Linux Enterprise Desktopが稼働するすべてのマシンからのsupportconfigアーカイブを分析できます。supportconfigアーカイブをアプライアンスサーバにアップロードするだけで分析を行うことができます。対話操作は必要ありません。MariaDBデータベースでは、SCAアプライアンスは、解析済みのsupportconfigアーカイブをすべて追跡します。アプライアンスのWebインタフェースからSCAレポートを直接参照できます。アプライアンスから管理者ユーザに電子メールでHTMLレポートを送信することもできます。詳細については、<xref linkend="sec-admsupport-sca-appliance-config-mail"/>を参照してください。
   </para>
   <sect3 xml:id="sec-admsupport-sca-appliance-installquick">
    <title>インストールのクイックスタート</title>
    <para>
     コマンドラインから短時間でSCAアプライアンスをインストールしてセットアップするには、この手順に従います。この手順は上級者向けで、ベアインストールとセットアップコマンドに焦点を当てています。詳しい説明については、<xref linkend="sec-admsupport-sca-appliance-pre"/>～<xref linkend="sec-admsupport-sca-appliance-install"/>を参照してください。
    </para>
    <itemizedlist mark="bullet" spacing="normal">
     <title>前提条件</title>
     <listitem>
      <para>
       WebおよびLAMPパターン
      </para>
     </listitem>
     <listitem>
      <para>
       Webおよびスクリプティングモジュール(このモジュールを選択できるようにするにはマシンを登録する必要があります)
      </para>
     </listitem>
    </itemizedlist>
    <note>
     <title><systemitem class="username">root</systemitem>特権が必要</title>
     <para>
      次のプロシージャのコマンドはすべて<systemitem class="username">root</systemitem>として実行される必要があります。
     </para>
    </note>
    <procedure>
     <title>アップロードに匿名FTPを使用するインストール</title>
     <para>
      アプライアンスをセットアップして稼働させた後は、手動での対話操作は必要ありません。したがって、cronジョブを使用してsupportconfigアーカイブを作成およびアップロードするには、この方法でアプライアンスをセットアップするのが理想的です。
     </para>
     <step>
      <para>
       アプライアンスをインストールするマシンでコンソールにログインし、次のコマンドを実行します。
      </para>
<screen>zypper install sca-appliance-* sca-patterns-* vsftpd
systemctl enable apache2
systemctl start apache2
systemctl enable vsftpd
systemctl start vsftpd
yast ftp-server</screen>
     </step>
     <step>
      <para>
       YaST FTPサーバで、<menuchoice>
       <guimenu>Authentication (認証)</guimenu> <guimenu>Enable Upload (アップロードの有効化)</guimenu>
       <guimenu>Anonymous Can Upload (匿名ユーザのアップロード許可)</guimenu> <guimenu>完了</guimenu>
       <guimenu>はい</guimenu> </menuchoice>の順に選択し、<guimenu>/srv/ftp/upload</guimenu>を作成します。
      </para>
     </step>
     <step>
      <para>
       次のコマンドを実行します。
      </para>
<screen>systemctl enable mysql
systemctl start mysql
mysql_secure_installation
setup-sca -f</screen>
      <para>
       このmysql_secure_installationにより、MariaDBの<systemitem class="username">root</systemitem>パスワードが作成されます。
      </para>
     </step>
    </procedure>
    <procedure>
     <title>アップロードにSCP/tmpを使用するインストール</title>
     <para>
      この方法でアプライアンスをセットアップするには、SSHパスワードを入力する際に手動での対話操作が必要になります。
     </para>
     <step>
      <para>
       アプライアンスをインストールするマシンでコンソールにログインします。
      </para>
     </step>
     <step>
      <para>
       次のコマンドを実行します。
      </para>
<screen>zypper install sca-appliance-* sca-patterns-*
systemctl enable apache2
systemctl start apache2
sudo systemctl enable mysql
systemctl start mysql
mysql_secure_installation
setup-sca</screen>
     </step>
    </procedure>
   </sect3>
   <sect3 xml:id="sec-admsupport-sca-appliance-pre">
    <title>前提条件</title>
    <para>
     SCAアプライアンスサーバを実行するには、次の前提条件が必要です。
    </para>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <para>
       すべての<systemitem>sca-appliance-*</systemitem>パッケージ。
      </para>
     </listitem>
     <listitem>
      <para>
       <systemitem class="resource">sca-patterns-base</systemitem>パッケージ。さらに、アプライアンスで分析するsupportconfigアーカイブのタイプに合った、製品固有の<systemitem class="resource">sca-patterns-*</systemitem>。
      </para>
     </listitem>
     <listitem>
      <para>
       Apache
      </para>
     </listitem>
     <listitem>
      <para>
       PHP
      </para>
     </listitem>
     <listitem>
      <para>
       MariaDB
      </para>
     </listitem>
     <listitem>
      <para>
       匿名FTPサーバ(オプション)
      </para>
     </listitem>
    </itemizedlist>
   </sect3>
   <sect3 xml:id="sec-admsupport-sca-appliance-install">
    <title>インストールと基本セットアップ</title>
    <para>
     <xref linkend="sec-admsupport-sca-appliance-pre"/>に記載されているように、SCAアプライアンスには他のパッケージに対する依存関係がいくつかあります。そのため、SCAアプライアンスサーバをインストールしてセットアップする前に、次の手順で準備を行う必要があります。
    </para>
    <procedure>
     <step>
      <para>
       ApacheおよびMariaDBに対して、<systemitem>Web</systemitem>および<systemitem>LAMP</systemitem>インストールパターンをインストールします。
      </para>
     </step>
     <step>
      <para>
       Apache、MariaDB、および匿名FTPサーバ(オプション)をセットアップします。<phrase os="sles">詳細については、<xref linkend="cha-apache2"/>と<xref linkend="cha-ftp"/>を参照してください。</phrase>
      </para>
     </step>
     <step>
      <para>
       ApacheおよびMariaDBをブート時に起動するように設定します。
      </para>
<screen>sudo systemctl enable apache2 mysql</screen>
     </step>
     <step>
      <para>
       両方のサービスを開始します。
      </para>
<screen>sudo systemctl start apache2 mysql</screen>
     </step>
    </procedure>
    <para>
     これで、<xref linkend="pro-sca-appl-install"/>の説明に従ってSCAアプライアンスをインストールしてセットアップできます。
    </para>
    <procedure xml:id="pro-sca-appl-install">
     <title>SCAアプライアンスのインストールと設定</title>
     <para>
      パッケージをインストールしたら、<command>setup-sca</command>スクリプトを使用して、SCAアプライアンスが使用するMariaDBの管理およびレポートデータベースの基本設定を行います。
     </para>
     <para>
      このスクリプトを使用して、マシンからSCAアプライアンスにsupportconfigアーカイブをアップロードするための次のオプションを設定できます。
     </para>
     <itemizedlist mark="bullet" spacing="normal">
      <listitem>
       <para>
        <command>scp</command>
       </para>
      </listitem>
      <listitem>
       <para>
        匿名FTPサーバ
       </para>
      </listitem>
     </itemizedlist>
     <step>
      <para>
       アプライアンスとSCA基本パターンライブラリをインストールします。
      </para>
<screen>sudo zypper install sca-appliance-* sca-patterns-base</screen>
     </step>
     <step>
      <para>
       さらに、分析するsupportconfigアーカイブのタイプに合ったパターンパッケージをインストールします。たとえば、現在の環境にSUSE Linux Enterprise Server 11のサーバとSUSE Linux Enterprise Server 12のサーバがある場合、<systemitem>sca-patterns-sle11</systemitem>パッケージと<systemitem>sca-patterns-sle12</systemitem>パッケージの両方をインストールします。
      </para>
      <para>
       利用可能なすべてのパターンをインストールする
      </para>
<screen>zypper install sca-patterns-*</screen>
     </step>
     <step>
      <para>
       SCAアプライアンスの基本セットアップには、<command>setup-sca</command>スクリプトを使用します。スクリプトの呼び出し方法は、supportconfigアーカイブをどのようにSCAアプライアンスサーバにアップロードするかによって異なります。
      </para>
      <itemizedlist mark="bullet" spacing="normal">
       <listitem>
        <para>
         <filename>/srv/ftp/upload</filename>ディレクトリを使用する匿名FTPサーバを設定済みの場合は、<option>-f</option>オプションを指定してセットアップスクリプトを実行し、画面の指示に従います。
        </para>
<screen>setup-sca -f</screen>
        <note>
         <title>別のディレクトリを使用するFTPサーバ</title>
         <para>
          FTPサーバで<filename>/srv/ftp/upload</filename>以外のディレクトリを使用する場合は、まず、正しいディレクトリを指すように環境設定ファイル<filename>/etc/sca/sdagent.conf</filename>および<filename>/etc/sca/sdbroker.conf</filename>を調整します。
         </para>
        </note>
       </listitem>
       <listitem>
        <para>
         <command>scp</command>を使用してsupportconfigファイルをSCAアプライアンスサーバの<filename>/tmp</filename>ディレクトリにアップロードする場合は、パラメータを指定せずにセットアップスクリプトを呼び出して、画面の指示に従います。
        </para>
<screen>setup-sca</screen>
       </listitem>
      </itemizedlist>
      <para>
       セットアップスクリプトは要件チェックをいくつか実行し、必要なコンポーネントを設定します。2つのパスワードを入力するようプロンプトが表示されます。1つは、セットアップ済みのMariaDBのMySQL <systemitem class="username">root</systemitem>パスワードで、もう1つは、SCAアプライアンスのWebインタフェースにログインするために使用するWebユーザのパスワードです。
      </para>
     </step>
     <step>
      <para>
       既存のMariaDBの<systemitem class="username">root</systemitem>パスワードを入力します。これにより、SCAアプライアンスがMariaDBに接続できるようになります。
      </para>
     </step>
     <step>
      <para>
       Webユーザのパスワードを定義します。パスワードは<filename>/srv/www/htdocs/sca/web-config.php</filename>に書き込まれ、ユーザ<systemitem class="username">scdiag</systemitem>のパスワードとして設定されます。ユーザ名とパスワードは後で随時変更できます。<xref linkend="sec-admsupport-sca-appliance-config-passwd"/>を参照してください。
      </para>

     </step>
    </procedure>
    <para>
     インストールとセットアップが正常に完了したら、すぐにSCAアプライアンスを使用できます。<xref linkend="sec-admsupport-sca-appliance-use"/>を参照してください。ただし、Webインタフェースのパスワードの変更、SCAパターンのアップデートのソースの変更、アーカイブモードの有効化、電子メール通知の設定など、一部のオプションを変更する必要があります。詳細については、<xref linkend="sec-admsupport-sca-appliance-config"/>を参照してください。
    </para>
    <warning>
     <title>データの保護</title>
     <para>
      SCAアプライアンスサーバ上のレポートには、分析済みのsupportconfigアーカイブが存在するマシンに関するセキュリティ関連情報が含まれているため、SCAアプライアンスサーバ上のデータを不正アクセスから保護してください。
     </para>
    </warning>
   </sect3>
   <sect3 xml:id="sec-admsupport-sca-appliance-use">
    <title>SCAアプライアンスの使用</title>
    <para>
     既存のsupportconfigアーカイブをSCAアプライアンスに手動でアップロードすることも、1つのステップで新しいsupportconfigアーカイブを作成してSCAアプライアンスにアップロードすることもできます。アップロードはFTPまたはSCP経由で行うことができます。どちらの場合も、SCAアプライアンスに接続できるURLが分かっている必要があります。FTP経由でのアップロードの場合、FTPサーバをSCAアプライアンス用に設定する必要があります。<xref linkend="pro-sca-appl-install"/>を参照してください。
    </para>
    <sect4 xml:id="sec-admsupport-sca-appliance-use-upload">
     <title>SCAアプライアンスへのSupportconfigアーカイブのアップロード</title>
     <para/>
     <itemizedlist mark="bullet" spacing="normal">
      <listitem>
       <para>
        supportconfigアーカイブを作成して(匿名) FTP経由でアップロードするには、次の手順に従います。
       </para>
<screen>sudo supportconfig -U “ftp://<replaceable>SCA-APPLIANCE.COMPANY.COM</replaceable>/upload”</screen>
      </listitem>
      <listitem>
       <para>
        supportconfigアーカイブを作成してSCP経由でアップロードするには、次の手順に従います。
       </para>
<screen>sudo supportconfig -U “scp://<replaceable>SCA-APPLIANCE.COMPANY.COM</replaceable>/tmp”</screen>
       <para>
        SCAアプライアンスが動作しているサーバの<systemitem class="username">root</systemitem>ユーザのパスワードを入力するようプロンプトが表示されます。
       </para>
      </listitem>
      <listitem>
       <para>
        1つまたは複数のアーカイブを手動でアップロードする場合は、既存のアーカイブファイル(通常は<filename>/var/log/nts_*.tbz</filename>にあります)をSCAアプライアンスにコピーします。アップロード先には、アプライアンスサーバの<filename>/tmp</filename>ディレクトリまたは<filename>/srv/ftp/upload</filename>ディレクトリ(FTPがSCAアプライアンスサーバ用に設定されている場合)を使用します。
       </para>
      </listitem>
     </itemizedlist>
    </sect4>
    <sect4 xml:id="sec-admsupport-sca-appliance-use-view">
     <title>SCAレポートの表示</title>
     <para>
      SCAレポートは、ブラウザがインストールされていて、SCAアプライアンスのレポートインデックスページにアクセス可能な任意のマシンから表示できます。
     </para>
     <procedure>
      <step>
       <para>
        Webブラウザを起動し、JavaScriptとCookieが有効なことを確認します。
       </para>
      </step>
      <step>
       <para>
        URLとして、SCAアプライアンスのレポートインデックスページを入力します。
       </para>
<screen>https://sca-appliance.company.com/sca</screen>
       <para>
        不確かな場合は、システム管理者に問い合わせてください。
       </para>
      </step>
      <step>
       <para>
        ログインするためのユーザ名とパスワードを入力するようプロンプトが表示されます。
       </para>
       <figure xml:id="fig-sca-appl-html">
        <title>SCAアプライアンスによって生成されるHTMLレポート</title>
        <mediaobject>
         <imageobject role="fo">
          <imagedata fileref="sca_appl_report_html.png" width="100%"/>
         </imageobject>
         <imageobject role="html">
          <imagedata fileref="sca_appl_report_html.png" width="100%"/>
         </imageobject>
        </mediaobject>
       </figure>
      </step>
      <step>
       <para>
        ログイン後、参照するレポートの日付をクリックします。
       </para>
      </step>
      <step>
       <para>
        最初に<guimenu>Basic Health (基本的なヘルス)</guimenu>カテゴリをクリックして展開します。
       </para>
      </step>
      <step>
       <para>
        <guimenu>Message (メッセージ)</guimenu>列で、個々のエントリをクリックします。SUSE Knowledgebaseの対応する記事が開きます。提案された解決方法を読み、指示に従います。
       </para>
      </step>
      <step>
       <para>
        <guimenu>Supportconfig Analysis Report (Supportconfig分析レポート)</guimenu>の<guimenu>Solutions (解決方法)</guimenu>列に追加エントリが表示されている場合は、それらをクリックします。提案された解決方法を読み、指示に従います。
       </para>
      </step>
      <step>
       <para>
        SCAによって特定された問題に直接関係する結果については、SUSE Knowledgebase (<link xlink:href="http://www.suse.com/support/kb/"/>)を確認してください。問題解決に取り組みます。
       </para>
      </step>
      <step>
       <para>
        問題の再発防止のために事前に対処できる結果がないかどうかを確認します。
       </para>
      </step>
     </procedure>
    </sect4>
   </sect3>
   <sect3 xml:id="sec-admsupport-sca-appliance-config">
    <title>SCAアプライアンスのカスタマイズ</title>
    <para>
     次の項では、Webインタフェースのパスワードを変更する方法、SCAパターンアップデートのソースを変更する方法、アーカイブモードを有効にする方法、および電子メール通知を設定する方法について説明します。
    </para>
    <sect4 xml:id="sec-admsupport-sca-appliance-config-passwd">
     <title>Webインタフェースのパスワード</title>
     <para>
      SCAアプライアンスのWebインタフェースにログインするには、ユーザ名とパスワードが必要です。デフォルトのユーザ名は<literal>scdiag</literal>で、デフォルトのパスワードは<literal>linux</literal>です(特に指定されていない場合。<xref linkend="pro-sca-appl-install"/>を参照してください)。パスワードを保護するため、デフォルトのパスワードはできる限り速やかに変更してください。ユーザ名を変更することもできます。
     </para>
     <procedure xml:id="pro-sca-passwd-change">
      <title>Webインタフェースのユーザ名またはパスワードの変更</title>
      <step>
       <para>
        SCAアプライアンスサーバのシステムコンソールで<systemitem class="username">root</systemitem>ユーザとしてログインします。
       </para>
      </step>
      <step>
       <para>
        エディタで<filename>/srv/www/htdocs/sca/web-config.php</filename>を開きます。
       </para>
      </step>
      <step>
       <para>
        必要に応じて、<literal>$username</literal>および<literal>$password</literal>の値を変更します。
       </para>
      </step>
      <step>
       <para>
        ファイルを保存して終了します。
       </para>
      </step>
     </procedure>
    </sect4>
    <sect4 xml:id="sec-admsupport-sca-appliance-config-upd">
     <title>SCAパターンのアップデート</title>
     <para>
      デフォルトでは、すべての<systemitem class="resource">sca-patterns-*</systemitem>パッケージは<systemitem class="username">root</systemitem> cronジョブによって定期的にアップデートされます。このジョブは夜間に<filename>sdagent-patterns</filename>スクリプトを実行し、このスクリプトが<command>zypper update sca-patterns-*</command>を実行します。定期的なシステムアップデートにより、SCAアプライアンスおよびパターンのすべてのパッケージがアップデートされます。SCAアプライアンスとパターンを手動でアップデートするには、以下を実行します。
     </para>
<screen>sudo zypper update sca-*</screen>
     <para>
      デフォルトでは、アップデートはSUSE Linux Enterprise <phrase role="productnumber"><phrase os="sles;sled;slerte">12 SP4</phrase></phrase>のアップデートリポジトリからインストールされます。必要に応じて、アップデートのソースをSMTサーバに変更できます。<filename>sdagent-patterns</filename>は、<command>zypper update sca-patterns-*</command>を実行する際に、現在設定されているアップデートチャネルからアップデートを取得します。このチャネルがSMTサーバにある場合、パッケージはそこから取得されます。
     </para>
     <procedure>
      <title>SCAパターンの自動アップデートの無効化</title>
      <step>
       <para>
        SCAアプライアンスサーバのシステムコンソールで<systemitem class="username">root</systemitem>ユーザとしてログインします。
       </para>
      </step>
      <step>
       <para>

        エディタで<filename>/etc/sca/sdagent-patterns.conf</filename>を開きます。
       </para>
      </step>
      <step>
       <para>
        次のエントリを変更します。
       </para>
<screen>UPDATE_FROM_PATTERN_REPO=1</screen>
       <para>
        変更後:
       </para>
<screen>UPDATE_FROM_PATTERN_REPO=0</screen>
      </step>
      <step>
       <para>
        ファイルを保存して終了します。変更を適用するためにマシンを再起動する必要はありません。
       </para>
      </step>
     </procedure>
    </sect4>
    <sect4 xml:id="sec-admsupport-sca-appliance-config-archive">
     <title>アーカイブモード</title>
     <para>
      supportconfigアーカイブの分析が終了し、その結果がMariaDBデータベースに保存されると、アーカイブはすべてSCAアプライアンスから削除されます。ただし、トラブルシューティングのために、マシンからのsupportconfigアーカイブのコピーを保持しておくと便利です。デフォルトでは、アーカイブモードは無効になっています。
     </para>
     <procedure>
      <title>SCAアプライアンスのアーカイブモードの有効化</title>
      <step>
       <para>
        SCAアプライアンスサーバのシステムコンソールで<systemitem class="username">root</systemitem>ユーザとしてログインします。
       </para>
      </step>
      <step>
       <para>
        エディタで<filename>/etc/sca/sdagent.conf</filename>を開きます。
       </para>
      </step>
      <step>
       <para>
        次のエントリを変更します。
       </para>
<screen>ARCHIVE_MODE=0</screen>
       <para>
        変更後:
       </para>
<screen>ARCHIVE_MODE=1</screen>
      </step>
      <step>
       <para>
        ファイルを保存して終了します。変更を適用するためにマシンを再起動する必要はありません。
       </para>
      </step>
     </procedure>
     <para>
      アーカイブモードを有効にすると、SCAアプライアンスはsupportconfigファイルを削除せずに、<filename>/var/log/archives/saved</filename>ディレクトリに保存します。
     </para>
    </sect4>
    <sect4 xml:id="sec-admsupport-sca-appliance-config-mail">
     <title>電子メールでのSCAレポートの送信</title>
     <para>
      分析された各supportconfigのレポートHTMLファイルを、SCAアプライアンスから電子メールで送信できます。デフォルトでは、この機能は無効になっています。これを有効にすると、レポートの送信先電子メールアドレスのリストを定義したり、レポートの送信をトリガするステータスメッセージのレベル(<literal>STATUS_NOTIFY_LEVEL</literal>)を定義したりできます。
     </para>
     <variablelist xml:id="vl-sca-mails-notify-level">
      <title><literal>STATUS_NOTIFY_LEVEL</literal>に指定可能な値</title>
      <varlistentry>
       <term>$STATUS_OFF</term>
       <listitem>
        <para>
         HTMLレポートの送信を無効にします。
        </para>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term>$STATUS_CRITICAL</term>
       <listitem>
        <para>
         CRITICALが含まれるSCAレポートのみを送信します。
        </para>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term>$STATUS_WARNING </term>
       <listitem>
        <para>
         WARNINGまたはCRITICALが含まれるSCAレポートのみを送信します。
        </para>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term>$STATUS_RECOMMEND</term>
       <listitem>
        <para>
         RECOMMEND、WARNING、またはCRITICALが含まれるSCAレポートのみを送信します。
        </para>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term>$STATUS_SUCCESS</term>
       <listitem>
        <para>
         SUCCESS、RECOMMEND、WARNING、またはCRITICALが含まれるSCAレポートを送信します。
        </para>
       </listitem>
      </varlistentry>
     </variablelist>
     <procedure>
      <title>SCAレポートの電子メール通知の設定</title>
      <step>
       <para>
        SCAアプライアンスサーバのシステムコンソールで<systemitem class="username">root</systemitem>ユーザとしてログインします。
       </para>
      </step>
      <step>
       <para>
        エディタで<filename>/etc/sca/sdagent.conf</filename>を開きます。
       </para>
      </step>
      <step>
       <para>
        <systemitem>STATUS_NOTIFY_LEVEL</systemitem>というエントリを探します。デフォルトでは、これは<literal>$STATUS_OFF</literal>に設定されています(電子メール通知は無効です)。
       </para>
      </step>
      <step>
       <para>
        電子メール通知を有効にするには、<literal>$STATUS_OFF</literal>を、電子メールレポートを要求するステータスメッセージのレベルに変更します。次に例を示します。
       </para>
<screen>STATUS_NOTIFY_LEVEL=$STATUS_SUCCESS</screen>
       <para>
        詳細については、<xref linkend="vl-sca-mails-notify-level"/>を参照してください。
       </para>
      </step>
      <step>
       <para>
        レポートの送信先の受信者リストを定義する
       </para>
       <substeps performance="required">
        <step>
         <para>
          <literal>EMAIL_REPORT='root'</literal>というエントリを探します。
         </para>
        </step>
        <step>
         <para>
          <literal>root</literal>を、SCAレポートの送信先電子メールアドレスのリストに置き換えます。複数の電子メールアドレスはそれぞれスペースで区切る必要があります。次に例を示します。
         </para>
<screen>EMAIL_REPORT='tux@my.company.com wilber@your.company.com'</screen>
        </step>
       </substeps>
      </step>
      <step>
       <para>
        ファイルを保存して終了します。変更を適用するためにマシンを再起動する必要はありません。今後、すべてのSCAレポートは指定したアドレスに電子メールで送信されます。
       </para>
      </step>
     </procedure>
    </sect4>
   </sect3>
   <sect3 xml:id="sec-admsupport-sca-appliance-backup">
    <title>データベースのバックアップと復元</title>
    <para>
     SCAレポートが保存されているMariaDBデータベースをバックアップおよび復元するには、次の説明に従って<command>scadb</command>コマンドを使用します。
    </para>
    <procedure>
     <title>データベースのバックアップ</title>
     <step>
      <para>
       SCAアプライアンスが動作しているサーバのシステムコンソールで、<systemitem class="username">root</systemitem>ユーザとしてログインします。
      </para>
     </step>
     <step>
      <para>
       次のコマンドを実行してアプライアンスを保守モードにします。
      </para>
<screen>scadb maint</screen>
     </step>
     <step>
      <para>
       次のコマンドを実行してバックアップを開始します。
      </para>
<screen>scadb backup</screen>
      <para>
       データはTARアーカイブ<filename>sca-backup-*sql.gz</filename>に保存されます。
      </para>
     </step>
     <step>
      <para>
       パターン作成データベースを使用して独自のパターンを開発している場合は(<xref linkend="sec-admsupport-sca-patterns"/>を参照)、そのデータもバックアップします。
      </para>
<screen>sdpdb backup</screen>
      <para>
       データはTARアーカイブ<filename>sdp-backup-*sql.gz</filename>に保存されます。
      </para>
     </step>
     <step>
      <para>
       次のデータを別のマシンまたは外部ストレージメディアにコピーします。
      </para>
      <itemizedlist mark="bullet" spacing="normal">
       <listitem>
        <para>
         <filename>sca-backup-*sql.gz</filename>
        </para>
       </listitem>
       <listitem>
        <para>
         <filename>sdp-backup-*sql.gz</filename>
        </para>
       </listitem>
       <listitem>
        <para>
         <filename>/usr/lib/sca/patterns/local</filename> (カスタムパターンを作成している場合にのみ必要)
        </para>
       </listitem>
      </itemizedlist>
     </step>
     <step>
      <para>
       次のコマンドを実行してSCAアプライアンスを再び有効にします。
      </para>
<screen>scadb reset agents</screen>
     </step>
    </procedure>
    <procedure>
     <title>データベースの復元</title>
     <para>
      バックアップからデータベースを復元するには、次の手順に従います。
     </para>
     <step>
      <para>
       SCAアプライアンスが動作しているサーバのシステムコンソールで、<systemitem class="username">root</systemitem>ユーザとしてログインします。
      </para>
     </step>
     <step>
      <para>
       最も新しい<filename>sca-backup-*sql.gz</filename>および<filename>sdp-backup-*sql.gz</filename> TARアーカイブをSCAアプライアンスサーバにコピーします。
      </para>
     </step>
     <step>
      <para>
       ファイルを圧縮解除するため、次のコマンドを実行します。
      </para>
<screen>gzip -d *-backup-*sql.gz</screen>
     </step>
     <step>
      <para>
       データをデータベースにインポートするため、次のコマンドを実行します。
      </para>
<screen>scadb import sca-backup-*sql</screen>
     </step>
     <step>
      <para>
       パターン作成データベースを使用して独自のパターンを開発している場合、次のデータもインポートします。
      </para>
<screen>sdpdb import sdp-backup-*sql</screen>
     </step>
     <step>
      <para>
       カスタムパターンを使用している場合は、<filename>/usr/lib/sca/patterns/local</filename>もバックアップデータから復元します。
      </para>
     </step>
     <step>
      <para>
       次のコマンドを実行してSCAアプライアンスを再び有効にします。
      </para>
<screen>scadb reset agents</screen>
     </step>
     <step>
      <para>
       データベース内のパターンモジュールを更新します。
      </para>
<screen>sdagent-patterns -u</screen>
     </step>
    </procedure>
   </sect3>
  </sect2>

  <sect2 xml:id="sec-admsupport-sca-patterns">
   <title>カスタム分析パターンの開発</title>
   <para>
    SCAアプライアンスには、独自のカスタムパターンの開発を可能にする、充実したパターン開発環境(SCA Pattern Database)が付属しています。パターンは、どのプログラム言語でも作成できます。パターンをsupportconfig分析プロセスで利用できるようにするには、<filename>/usr/lib/sca/patterns/local</filename>に保存し、実行可能にする必要があります。SCAアプライアンスとSCAツールのどちらも、分析レポートの一部として、新しいsupportconfigアーカイブに照らしてカスタムパターンを実行します。独自のパターンを作成(およびテスト)する方法の詳細については、<link xlink:href="http://www.suse.com/communities/conversations/sca-pattern-development/"/>を参照してください。
   </para>
  </sect2>
 </sect1>

 <sect1 xml:id="sec-admsupport-install">
  <title>インストール時の情報収集</title>
  <para>
   インストール時には、<command>supportconfig</command>を使用できません。ただし、<command>save_y2logs</command>を使用してYaSTからログファイルを収集することができます。このコマンドにより、<filename>/tmp</filename>ディレクトリに<filename>.tar.xz</filename>アーカイブが作成されます。
  </para>
  
  <para>
   インストールの開始直後に問題が発生したときは、<command>linuxrc</command>で作成したログファイルから情報を収集できる場合があります。<command>linuxrc</command>は、YaSTが起動する前に実行される小さなコマンドです。このログファイルは、<filename>/var/log/linuxrc.log</filename>にあります。
  </para>
  <important>
   <title>インストールログファイルがインストールしたシステムにない</title>
   <para>
    インストール時に使用可能だったログファイルが、インストールしたシステムでは使用できなくなってしまいました。インストーラの実行中に、インストールログファイルを正しく保存してください。
   </para>
  </important>
 </sect1>

 <sect1 xml:id="sec-admsupport-kernel">
  <title>カーネルモジュールのサポート</title>

  <para>
   あらゆるエンタープライズ向けオペレーティングシステムにとって重要な要件は、利用環境に対して受けられるサポートのレベルです。カーネルモジュールは、ハードウェア(<quote>コントローラ</quote>)とオペレーティングシステムを結ぶものの中で最も重要です。SUSE Linux Enterpriseのカーネルモジュールにはすべて<literal>supported</literal>フラグが付いており、これは次の3つの値を取ります。
  </para>

  <itemizedlist mark="bullet" spacing="normal">

   <listitem>
    <para>
     <quote>yes</quote>、したがって<literal>supported</literal>
    </para>
   </listitem>
   <listitem>
    <para>
     <quote>external</quote>、したがって<literal>supported</literal>
    </para>
   </listitem>
   <listitem>
    <para>
     <quote/> (空、未設定)、したがって<literal>unsupported</literal>
    </para>
   </listitem>
  </itemizedlist>

  <para>
   次のルールが適用されます。
  </para>

  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>
     自己再コンパイルしたカーネルのすべてのモジュールには、デフォルトで「unsupported」のマークが付きます。
    </para>
   </listitem>
   <listitem>
    <para>
     SUSEパートナーによってサポートされていて、<literal>SUSE SolidDriverプログラム</literal>を使用して配信されているカーネルモジュールには、<quote>external</quote>のマークが付きます。
    </para>
   </listitem>
   <listitem>
    <para>
     <literal>supported</literal>フラグが設定されていない場合、そのモジュールをロードすると、カーネルが汚染されます。汚染カーネルはサポートされません。SUSE Linux Enterprise DesktopとSUSE Linux Enterprise Workstation Extensionのみで使用可能な追加のRPMパッケージ(<systemitem>kernel-<replaceable>FLAVOR</replaceable>-extra</systemitem>)には、サポートされていないカーネルモジュールが含まれています。デフォルト(<replaceable>FLAVOR</replaceable>=<literal>default</literal>|<literal>xen</literal>|...)では、これらのカーネルはロードされません。さらに、これらのサポート対象外のモジュールはインストーラで利用できず、<systemitem class="resource">kernel-<replaceable>FLAVOR</replaceable>-extra</systemitem>パッケージはSUSE Linux Enterpriseのメディアに含まれていません。
    </para>
   </listitem>
   <listitem>
    <para>
     Linuxカーネルのライセンスと互換性があるライセンスに従って提供されていないカーネルモジュールを使用しても、カーネルが汚染されます。詳細については、<filename>/usr/src/linux/Documentation/sysctl/kernel.txt</filename>、および<filename>/proc/sys/kernel/tainted</filename>の状態を参照してください。
    </para>
   </listitem>
  </itemizedlist>

  <sect2 xml:id="sec-admsupport-kernel-background">
   <title>技術的背景</title>
   <para/>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>
      Linuxカーネル: SUSE Linux Enterprise <filename>12 SP4</filename>では、<literal>/proc/sys/kernel/unsupported</literal>の値はデフォルトで<phrase role="productnumber"><phrase os="sles;sled;slerte">2</phrase></phrase>に設定されています(<literal>do not warn in syslog when loading unsupported modules (サポート対象外のカーネルのロード時にsyslogで警告しない)</literal>)。このデフォルト値は、インストーラと、インストールしたシステムで使用されます。詳細については、<filename>/usr/src/linux/Documentation/sysctl/kernel.txt</filename>を参照してください。
     </para>
    </listitem>
    <listitem>
     <para>
      <command>modprobe</command>: モジュールの依存関係を確認して適切にモジュールをロードするための<command>modprobe</command>ユーティリティは、<literal>supported</literal>フラグの値を確認します。この値が<quote>yes</quote>または<quote>external</quote>であればモジュールはロードされ、他の値の場合はロードされません。この動作を無効にする方法については、<xref linkend="sec-admsupport-kernel-unsupported"/>を参照してください。
     </para>
     <note>
      <title>サポート</title>
      <para>
       SUSEは一般的に、<command>modprobe -r</command>によるストレージモジュールの削除をサポートしていません。
      </para>
     </note>
    </listitem>
   </itemizedlist>
  </sect2>

  <sect2 xml:id="sec-admsupport-kernel-unsupported">
   <title>サポート対象外のモジュールの使用</title>
   <para>
    一般的なサポート可能性は重要ですが、サポート対象外のモジュールをロードしなければならないこともあります(たとえば、テストやデバッグを行う場合や、ハードウェアベンダーがホットフィックスを提供している場合など)。
   </para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>
      デフォルト値を無効にするには、<filename>/etc/modprobe.d/10-unsupported-modules.conf</filename>を編集して、変数
      <varname>allow_unsupported_modules</varname> の値を<literal>1</literal>に変更します。initrdでサポート対象外のモジュールが必要な場合は、必ず<command>dracut </command> <option>-f</option>を実行してinitrdをアップデートしてください。
     </para>
     <para>
      モジュールを一度だけロードする場合は、<command>modprobe</command>で<option>--allow-unsupported-modules</option>オプションを使用できます。詳細については、<command>modprobe</command>のマニュアルページを参照してください。
     </para>
    </listitem>
    <listitem>
     <para>
      インストール時に、ドライバアップデートディスクを使用してサポート対象外のモジュールを追加できます。この場合、これらのモジュールはロードされます。ブート時およびそれ以降にサポート対象外のモジュールを強制的にロードするには、カーネルコマンドラインオプション<option>oem-modules</option>を使用します。<systemitem class="resource">suse-module-tools</systemitem>パッケージのインストールおよび初期化時に、カーネルフラグ<literal>TAINT_NO_SUPPORT</literal> (<filename>/proc/sys/kernel/tainted</filename>)が評価されます。カーネルがすでに汚染されている場合は、<literal>allow_unsupported_modules</literal>が有効になります。これにより、インストール中のシステムでサポート対象外のモジュールが失敗しないようにします。インストール時にサポート対象外のモジュールが存在しておらず、もう1つの特殊なカーネルコマンドラインオプション(<option>oem-modules=1</option>)を使用していない場合は、引き続きデフォルトで、サポート対象外のモジュールは許可されません。
     </para>
    </listitem>
   </itemizedlist>
   <para>
    サポート対象外のモジュールをロードおよび実行すると、カーネルとシステム全体がSUSEのサポート対象外になる点に注意してください。
   </para>
  </sect2>
 </sect1>
 <sect1 xml:id="sec-admsupport-moreinfo">
  <title>その他の情報</title>

  <para/>

  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>
     <command>man supportconfig</command>—<command>supportconfig</command>のマニュアルページ
    </para>
   </listitem>
   <listitem>
    <para>
     <command>man supportconfig.conf</command>—supportconfig環境設定ファイルのマニュアルページ
    </para>
   </listitem>
   <listitem>
    <para>
     <command>man scatool</command>—<command>scatool</command>のマニュアルページ
    </para>
   </listitem>
   <listitem>
    <para>
     <command>man scadb</command>—<command>scadb</command>のマニュアルページ
    </para>
   </listitem>
   <listitem>
    <para>
     <command>man setup-sca</command>—<command>setup-sca</command>のマニュアルページ
    </para>
   </listitem>
   <listitem>
    <para>
     <link xlink:href="https://mariadb.com/kb/en/"/>—MariaDBのマニュアル
    </para>
   </listitem>
   <listitem os="sles">
    <para>
     <link xlink:href="http://httpd.apache.org/docs/"/>および<xref linkend="cha-apache2"/>—Apache Webサーバのマニュアル
    </para>
   </listitem>
   <listitem os="sles">
    <para>
     <xref linkend="cha-ftp"/>—FTPサーバのセットアップ方法のマニュアル
    </para>
   </listitem>
   <listitem>
    <para>
     <link xlink:href="http://www.suse.com/communities/conversations/sca-pattern-development/"/>—独自のSCAパターンを作成(およびテスト)する方法
    </para>
   </listitem>
   <listitem>
    <para>
     <link xlink:href="http://www.suse.com/communities/conversations/basic-server-health-check-supportconfig/"/>—「A Basic Server Health Check with Supportconfig」
    </para>
   </listitem>
   <listitem>
    <para>
     <link xlink:href="https://www.novell.com/communities/coolsolutions/cool_tools/create-your-own-supportconfig-plugin/"/>—「Create Your Own Supportconfig Plugin」
    </para>
   </listitem>
   </itemizedlist>
 </sect1>
</chapter>
