<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet href="urn:x-suse:xslt:profiling:docbook51-profile.xsl"
                 type="text/xml"
                 title="Profiling step"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="update-alternatives.xml" version="5.1" xml:id="cha-update-alternative">
 <title><command>update-alternatives</command>: Verwalten mehrerer Befehls- und Dateiversionen</title>
 <info>
  <abstract>
   <para>
    Häufig sind gleich mehrere Versionen eines Werkzeugs auf einem System installiert. Mit dem Alternativen-System lassen sich diese Versionen konsistent verwalten. So können die Administratoren eine Auswahl treffen und es ist möglich, verschiedene Versionen nebeneinander zu installieren und zu nutzen.
   </para>
  </abstract>
 <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:bugtracker/>
   <dm:translation>Ja</dm:translation>
  </dm:docmanager>
 </info>

  <sect1 xml:id="sec-ua-concept">
   <title>Überblick</title>
   <para>
    Auf <phrase role="productname"><phrase os="sled">SUSE Linux Enterprise Desktop</phrase></phrase> übernehmen einige Programme identische oder ähnliche Aufgaben. Wenn beispielsweise sowohl Java 1.7 als auch Java 1.8 auf einem System installiert sind, wird das Skript des Alternativen-Systems (<command>update-alternatives</command>) aus dem RPM-Paket heraus aufgerufen. Standardmäßig verweist das Alternativen-System auf Version 1.8: Höhere Versionen besitzen auch eine höhere Priorität. Der Administrator kann jedoch die Standardeinstellung ändern, sodass der generische Name auf Version 1.7 verweist.
   </para>
   <para>
    In diesem Kapitel gilt die folgende Terminologie:
   </para>
   <variablelist>
    <title>Terminologie</title>
    <varlistentry>
     <term>Administrationsverzeichnis</term>
     <listitem>
      <para>
       Das Standardverzeichnis <filename class="directory">/var/lib/rpm/alternatives</filename> enthält Informationen zum aktuellen Status der Alternativen.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>Alternative</term>
     <listitem>
      <para>
       Name einer bestimmten Datei im Dateisystem. Der Zugriff auf diese Datei erfolgt anhand eines generischen Namens über das Alternativen-System.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>Alternativen-Verzeichnis</term>
     <listitem>
      <para>
       Standardverzeichnis <filename class="directory">/etc/alternatives</filename> mit symbolischen Links.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>Generischer Name</term>
     <listitem>
      <para>
       Name (z. B. <command>/usr/bin/edit</command>), der auf eine von mehreren über das Alternativen-System verfügbaren Dateien verweist.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>Link-Gruppe</term>
     <listitem>
      <para>
       Gruppe zusammengehöriger symbolischer Links, die als Gruppe aktualisiert werden können.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>Master-Link</term>
     <listitem>
      <para>
       Link in Link-Gruppe, der bestimmt, wie die anderen Links in der Gruppe konfiguriert werden.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>Slave-Link</term>
     <listitem>
      <para>
       Link in einer Link-Gruppe, der durch den Master-Link gesteuert wird.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>Symbolischer Link (Symlink)</term>
     <listitem>
      <para>
       Datei, die auf eine andere Datei in demselben Dateisystem verweist. Das Alternativen-System schaltet über symbolische Links im Alternativen-Verzeichnis zwischen den verschiedenen Versionen einer Datei um.
      </para>
      <para>
       Der Administrator kann die symbolischen Links im Alternativen-Verzeichnis mit dem Befehl <command>update-alternatives</command> bearbeiten.
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
   <para>
    Mit dem Befehl <command>update-alternatives</command> im Alternativen-System lassen sich symbolische Links erstellen, entfernen und pflegen sowie Informationen zu diesen Links abrufen. Diese symbolischen Links verweisen in der Regel auf Befehle, können allerdings auch auf JAR-Archive, man-Seiten und andere Dateien verweisen. Die Beispiele in diesem Kapitel zeigen Befehle und man-Seiten, gelten jedoch auch für andere Dateitypen.
   </para>
   <para>
    Im Alternativen-Verzeichnis legt das Alternativen-System die Links zu möglichen Alternativen ab. Wenn ein neues Paket mit einer Alternative installiert wird, wird die neue Alternative in das System aufgenommen. Die Entscheidung, ob die Alternative des neuen Pakets als Standard festgelegt werden soll, ist abhängig von der Priorität des Pakets und vom ausgewählten Modus. In der Regel besitzen Pakete mit einer höheren Version auch eine höhere Priorität. Das Alternativen-System bietet zwei Modi:
   </para>
   <itemizedlist>
    <listitem>
     <formalpara>
      <title>Automatischer Modus</title>
      <para>
       In diesem Modus sorgt das Alternativen-System dafür, dass die Links in der Gruppe auf die geeigneten Alternativen mit der höchsten Priorität für die Gruppe verweisen.
      </para>
     </formalpara>
    </listitem>
    <listitem>
     <formalpara>
      <title>Manueller Modus</title>
      <para>
       In diesem Modus nimmt das Alternativen-System keine Änderungen an den Einstellungen des Systemadministrators vor.
      </para>
     </formalpara>
    </listitem>
   </itemizedlist>
   <para>
    Für den Befehl <command>java</command> gilt beispielsweise die folgende Link-Hierarchie im Alternativen-System:
   </para>
   <example>
    <title>Alternativen-System für den Befehl <command>java</command></title>
    <screen>/usr/bin/java <co xml:id="co-ua-java-name"/>
 -&gt; /etc/alternatives/java <co xml:id="co-ua-java-symbolic-link"/>
     -&gt; /usr/lib64/jvm/jre-10-openjdk/bin/java <co xml:id="co-ua-java-alternatives"/></screen>
    
    <calloutlist>
     <callout arearefs="co-ua-java-name">
      <para>
       Generischer Name.
      </para>
     </callout>
     <callout arearefs="co-ua-java-symbolic-link">
      <para>
       Symbolischer Link im Alternativen-Verzeichnis.
      </para>
     </callout>
     <callout arearefs="co-ua-java-alternatives">
      <para>
       Eine der Alternativen.
      </para>
     </callout>
    </calloutlist>
   </example>
  </sect1>

  <sect1 xml:id="sec-ua-use-cases">
   <title>Anwendungsfälle</title>
   <para>
    Standardmäßig wird das Skript <command>update-alternatives</command> aus einem RPM-Paket heraus aufgerufen. Wenn ein Paket installiert oder entfernt wird, bearbeitet das Skript alle zugehörigen symbolischen Links. Sie können das Skript jedoch auch manuell über die Befehlszeile ausführen und so:
   </para>
   <itemizedlist>
    <listitem>
     <para>
      die aktuellen Alternativen für einen generischen Namen abrufen.
     </para>
    </listitem>
    <listitem>
     <para>
      die Standardeinstellungen für eine Alternative ändern.
     </para>
    </listitem>
    <listitem>
     <para>
     eine Gruppe zusammengehöriger Dateien für eine Alternative erstellen.
     </para>
    </listitem>
   </itemizedlist>
  </sect1>

  <sect1 xml:id="sec-ua-view-all">
   <title>Überblick über Alternativen</title>
   <para>
    Die Namen aller konfigurierten Alternativen erhalten Sie mit:
   </para>
 <screen><prompt>tux &gt; </prompt><command>ls /var/lib/alternatives</command></screen>
   <para>
    Einen Überblick über alle konfigurierten Alternativen und deren Werte erhalten Sie mit
   </para>
   <screen><prompt>tux &gt; </prompt><command>sudo</command> <command>update-alternatives --get-selections</command>
asadmin                        auto     /usr/bin/asadmin-2.7
awk                            auto     /usr/bin/gawk
chardetect                     auto     /usr/bin/chardetect-3.6
dbus-launch                    auto     /usr/bin/dbus-launch.x11
default-displaymanager         auto     /usr/lib/X11/displaymanagers/gdm
[...]</screen>
  </sect1>

  <sect1 xml:id="sec-ua-view">
   <title>Anzeigen von Details zu spezifischen Alternativen</title>
   <para>
    Am einfachsten überprüfen Sie die Alternativen, wenn Sie den symbolischen Links des Befehls folgen. Wenn Sie beispielsweise erfahren möchten, worauf der Befehl <command>java</command> verweist, geben Sie den folgenden Befehl ein:
   </para>
   <screen><prompt>tux &gt; </prompt><command>readlink --canonicalize /usr/bin/java</command>
/usr/lib64/jvm/jre-10-openjdk/bin/java</screen>
   <para>
    Falls jeweils derselbe Pfad angezeigt wird (in diesem Beispiel <filename>/usr/bin/java</filename>), stehen keine Alternativen für diesen Befehl zur Auswahl.
   </para>
   
   <para>
    Mit der Option <option>--display</option> rufen Sie sämtliche Alternativen (mit Slaves) ab:
   </para>
   <screen><prompt>tux &gt; </prompt><command>sudo</command> <command>update-alternatives --display java</command>
java - auto mode
  link best version is /usr/lib64/jvm/jre-1.8.0-openjdk/bin/java
  link currently points to /usr/lib64/jvm/jre-1.8.0-openjdk/bin/java
  link java is /usr/bin/java
  slave java.1.gz is /usr/share/man/man1/java.1.gz
  slave jre is /usr/lib64/jvm/jre
  slave jre_exports is /usr/lib64/jvm-exports/jre
  slave keytool is /usr/bin/keytool
  slave keytool.1.gz is /usr/share/man/man1/keytool.1.gz
  slave orbd is /usr/bin/orbd
  slave orbd.1.gz is /usr/share/man/man1/orbd.1.gz
[...]</screen>
  </sect1>

  <sect1 xml:id="sec-ua-set">
   <title>Festlegen der Standardversion von Alternativen</title>
   <para>
    Standardmäßig verweisen die Befehle unter <filename>/usr/bin</filename> auf das Alternativen-Verzeichnis mit der höchsten Priorität. Der Befehl <command>java</command> gibt beispielsweise standardmäßig die folgende Versionsnummer zurück:
   </para>
   <screen><prompt>tux &gt; </prompt><command>java -version</command>
openjdk version "10.0.1" 2018-04-17
OpenJDK Runtime Environment (build 10.0.1+10-suse-lp150.1.11-x8664)
OpenJDK 64-Bit Server VM (build 10.0.1+10-suse-lp150.1.11-x8664, mixed mode)</screen>
   <para>
    Ändern Sie die Standardeinstellung, sodass der Befehl <command>java</command> auf eine frühere Version verweist, mit dem folgenden Befehl:
   </para>
   <screen><prompt>tux &gt; </prompt><command>sudo</command> <command>update-alternatives --config java</command>
root's password:
There are 2 choices for the alternative java (providing /usr/bin/java).

  Selection    Path                                       Priority   Status
------------------------------------------------------------
* 0            /usr/lib64/jvm/jre-10-openjdk/bin/java      2005      auto mode
  1            /usr/lib64/jvm/jre-1.8.0-openjdk/bin/java   1805      manual mode
  2            /usr/lib64/jvm/jre-10-openjdk/bin/java      2005      manual mode
  3            /usr/lib64/jvm/jre-11-openjdk/bin/java      0         manual mode

Press &lt;enter&gt; to keep the current choice[*], or type selection number:</screen>
   <para>
    Die genaue Java-Versionsnummer ist dabei abhängig von Ihrem System und von den installierten Versionen. Wenn Sie <literal>1</literal> auswählen, zeigt <command>java</command> die folgende Versionsnummer an:
   </para>
   <screen><prompt>tux &gt; </prompt><command>java -version</command>
java version "1.8.0_171"
OpenJDK Runtime Environment (IcedTea 3.8.0) (build 1.8.0_171-b11 suse-lp150.2.3.1-x86_64)
OpenJDK 64-Bit Server VM (build 25.171-b11, mixed mode)</screen>
   <para>
    Beachten Sie auch die folgenden Punkte:
   </para>
   <itemizedlist>
    <listitem>
     <para>
      Wenn Sie im manuellen Modus arbeiten und eine andere Java-Version installieren, behält das Alternativen-System sowohl die Links als auch den generischen Namen unverändert bei.
     </para>
    </listitem>
    <listitem>
     <para>
      Wenn Sie im automatischen Modus arbeiten und eine andere Java-Version installieren, ändert das Alternativen-System den Java-Master-Link und alle Slave-Links (siehe <xref linkend="sec-ua-view"/>). Prüfen Sie die Master-Slave-Beziehungen mit dem folgenden Befehl:
     </para>
     <screen><prompt>tux &gt; </prompt><command>sudo</command> <command>update-alternatives --display java</command></screen>
    </listitem>
   </itemizedlist>
  </sect1>

  <sect1 xml:id="sec-ua-install">
   <title>Installieren von benutzerdefinierten Alternativen</title>
   <para>
    In diesem Abschnitt erfahren Sie, wie Sie benutzerdefinierte Alternativen in einem System einrichten. Für das Beispiel gelten die folgenden Annahmen:
   </para>
   <itemizedlist>
    <listitem>
     <para>
      Es gibt zwei Skripte (<command>foo-2</command> und <command>foo-3</command>) mit einem ähnlichen Funktionsumfang.
     </para>
    </listitem>
    <listitem>
     <para>
      Die Skripte sind im Verzeichnis <filename>/usr/local/bin</filename> gespeichert, sodass keine Konflikte mit den System-Tools unter <filename>/usr/bin</filename> entstehen.
     </para>
    </listitem>
    <listitem>
     <para>
      Der Master-Link <command>foo</command> verweist entweder auf <command>foo-2</command> oder auf <command>foo-3</command>.
     </para>
    </listitem>
   </itemizedlist>
   <para>
    So richten Sie Alternativen im System ein:
   </para>
   <procedure>
    <step>
     <para>
      Kopieren Sie die Skripte in das Verzeichnis <filename>/usr/local/bin</filename>.
     </para>
    </step>
    <step>
     <para>
      Machen Sie die Skripte ausführbar:
     </para>
     <screen><prompt>tux &gt; </prompt><command>sudo</command> <command>chmod +x /usr/local/bin/foo-{2,3}</command></screen>
    </step>
    <step>
     <para>
      Führen Sie <command>update-alternatives</command> für beide Skripte aus:
     </para>
     <screen><prompt>tux &gt; </prompt><command>sudo</command> update-alternatives --install \
   /usr/local/bin/foo <co xml:id="co-ua-ua-install-usr-local-bin-foo"/>\
   foo <co xml:id="co-ua-ua-install-foo"/>\
   /usr/local/bin/foo-2 <co xml:id="co-ua-ua-install-usr-local-bin-foo-path"/>\
   200 <co xml:id="co-ua-ua-install-prio"/>
<prompt>tux &gt; </prompt><command>sudo</command> update-alternatives --install \
   /usr/local/bin/foo <xref linkend="co-ua-ua-install-usr-local-bin-foo"/>\
   foo <xref linkend="co-ua-ua-install-foo"/>\
   /usr/local/bin/foo-3 <xref linkend="co-ua-ua-install-usr-local-bin-foo-path"/>\
   300 <xref linkend="co-ua-ua-install-prio"/></screen>
     <para>
      Die Optionen nach <option>--install</option> bedeuten:
     </para>
     <calloutlist>
      <callout arearefs="co-ua-ua-install-usr-local-bin-foo">
       <para>
        Generischer Name. Zur Bedeutung: Dies ist in der Regel der Skriptname ohne Versionsnummern.
       </para>
      </callout>
      <callout arearefs="co-ua-ua-install-foo">
       <para>
        Name des Master-Links. Muss identisch sein.
       </para>
      </callout>
      <callout arearefs="co-ua-ua-install-usr-local-bin-foo-path">
       <para>
        Pfad zu dem oder den Originalskripten unter <filename>/usr/local/bin</filename>.
       </para>
      </callout>
      <callout arearefs="co-ua-ua-install-prio">
       <para>
        Die Priorität. <command>foo-2</command> erhält eine niedrigere Priorität als <command>foo-3</command>. Die Prioritäten sollten nach Möglichkeit deutlich unterschiedliche Zahlen erhalten. Beispiel: Priorität 200 für <command>foo-2</command> und 300 für <command>foo-3</command>.
       </para>
      </callout>
     </calloutlist>
    </step>
    <step>
     <para>
      Prüfen Sie den Master-Link:
     </para>
     <screen><prompt>tux &gt; </prompt><command>sudo</command> <command>update-alternatives --display foo</command>
foo - auto mode
  link best version is /usr/local/bin/foo-3
  link currently points to /usr/local/bin/foo-3
  link foo is /usr/local/bin/foo
/usr/local/bin/foo-2 - priority 200
/usr/local/bin/foo-3 - priority 300</screen>
    </step>
   </procedure>
   <para>
    Sobald Sie die angegebenen Schritte erledigt haben, können Sie den Master-Link <command>/usr/local/bin/foo</command> verwenden.
   </para>
   <para>
    Bei Bedarf können Sie weitere Alternativen installieren. Mit dem folgenden Befehl entfernen Sie eine Alternative:
   </para>
   <screen><prompt>tux &gt; </prompt><command>sudo</command> <command>update-alternatives --remove foo /usr/local/bin/foo-2</command></screen>
   <para>
    Sobald dieses Skript entfernt wurde, sieht das Alternativen-System für die foo-Gruppe wie folgt aus:
   </para>
   <screen><prompt>tux &gt; </prompt><command>sudo</command> <command>update-alternatives --display foo</command>
foo - auto mode
  link best version is /usr/local/bin/foo-3
  link currently points to /usr/local/bin/foo-3
  link foo is /usr/local/bin/foo
/usr/local/bin/foo-3 - priority 300</screen>
  </sect1>

  <sect1 xml:id="sec-ua-slave">
   <title>Definieren von abhängigen Alternativen</title>
   <para>
    Wenn Sie mit Alternativen arbeiten, reicht das Skript allein nicht aus. Die meisten Befehle sind nicht völlig eigenständig, sondern umfassen in der Regel zusätzliche Dateien wie Erweiterungen, Konfigurationen oder man-Seiten. Mit <emphasis>Slave-Alternativen</emphasis> erstellen Sie Alternativen, die von einem Master-Link abhängig sind.
   </para>
   <para>
    Angenommen, das Beispiel in <xref linkend="sec-ua-install"/> soll mit man-Seiten und Konfigurationsdateien erweitert werden:
   </para>
   <itemizedlist>
    <listitem>
     <para>
      Zwei man-Seiten (<filename>foo-2.1.gz</filename> und <filename>foo-3.1.gz</filename>) im Verzeichnis <filename>/usr/local/man/man1</filename>.
     </para>
    </listitem>
    <listitem>
     <para>
      Zwei Konfigurationsdateien (<filename>foo-2.conf</filename> und <filename>foo-3.conf</filename>) unter <filename>/etc</filename>.
     </para>
    </listitem>
   </itemizedlist>
   <para>
    So nehmen Sie die zusätzlichen Dateien in Ihre Alternativen auf:
   </para>
   <procedure>
    <step>
     <para>
      Kopieren Sie die Konfigurationsdateien in <filename>/etc</filename>:
     </para>
     <screen><prompt>tux &gt; </prompt><command>sudo</command> <command>cp foo-{2,3}.conf /etc</command></screen>
    </step>
    <step>
     <para>
      Kopieren Sie die man-Seiten in das Verzeichnis <filename>/usr/local/man/man1</filename>:
     </para>
     <screen><prompt>tux &gt; </prompt><command>sudo</command> <command>cp foo-{2,3}.1.gz /usr/local/man/man1/</command></screen>
    </step>
    <step>
     <para>
      Tragen Sie die Slave-Links mit der Option <option>--slave</option> in die Hauptskripte ein:
     </para>
     <screen><prompt>tux &gt; </prompt><command>sudo</command> <command>update-alternatives --install \
   /usr/local/bin/foo foo /usr/local/bin/foo-2 200 \
   --slave /usr/local/man/man1/foo.1.gz \
   foo.1.gz \
   /usr/local/man/man1/foo-2.1.gz \
   --slave /etc/foo.conf \
   foo.conf \
   /etc/foo-2.conf</command>
<prompt>tux &gt; </prompt><command>sudo</command> <command>update-alternatives --install \
   /usr/local/bin/foo foo /usr/local/bin/foo-3 300 \
   --slave /usr/local/man/man1/foo.1.gz \
   foo.1.gz \
   /usr/local/man/man1/foo-3.1.gz \
   --slave /etc/foo.conf \
   foo.conf \
   /etc/foo-3.conf</command></screen>
    </step>
    <step>
     <para>Prüfen Sie den Master-Link:</para>
     <screen>foo - auto mode
  link best version is /usr/local/bin/foo-3
  link currently points to /usr/local/bin/foo-3
  link foo is /usr/local/bin/foo
  slave foo.1.gz is /usr/local/man/man1/foo.1.gz
  slave foo.conf is /etc/foo.conf
/usr/local/bin/foo-2 - priority 200
  slave foo.1.gz: /usr/local/man/man1/foo-2.1.gz
  slave foo.conf: /etc/foo-2.conf
/usr/local/bin/foo-3 - priority 300
  slave foo.1.gz: /usr/local/man/man1/foo-3.1.gz
  slave foo.conf: /etc/foo-3.conf</screen>
    </step>
   </procedure>
   <para>
    Wenn Sie die Links mit <command>update-alternatives --config foo</command> in <command>foo-2</command>ändern, werden auch alle Slave-Links geändert.
   </para>
  </sect1>

  
</chapter>
