<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="storage_raid-leds.xml" version="5.0" xml:id="cha-raid-leds" xml:lang="zh-tw"> <title>適用於 MD 軟體 RAID 的儲存機殼指示燈公用程式</title>
 <info>
      <abstract>
        <para>
          <remark>Fate #313626 Update Enclosure LED Utilities</remark>儲存機殼指示燈監控公用程式 (<command>ledmon</command>) 和指示燈控制 (<command>ledctl</command>) 公用程式都是 Linux 使用者空間應用程式，可以使用多種介面和通訊協定來控制儲存機殼指示燈。主要用途是視覺化顯示透過 mdadm 公用程式建立之 Linux MD 軟體 RAID 裝置的狀態。<systemitem class="daemon">ledmon</systemitem> 精靈會監控磁碟機陣列的狀態並更新磁碟機指示燈的狀態。<command>ledctl</command> 公用程式可讓您設定所指定裝置的指示燈模式。
   </para>
      </abstract>
      <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
        <dm:bugtracker/>
        <dm:translation>yes</dm:translation>
      </dm:docmanager>
    </info>
    <para>
  這些指示燈公用程式使用 SGPIO (序列一般用途輸入/輸出) 規格 (小型機機殼 (SFF) 8485) 及 SCSI 機殼服務 (SES) 2 通訊協定來控制指示燈。它們實作 SGPIO 之 SFF-8489 規格的 International Blinking Pattern Interpretation (IBPI) 模式。IBPI 定義如何將 SGPIO 標準解譯為後擋板上磁碟機和插槽的狀態，以及後擋板應該如何透過指示燈視覺化顯示狀態。
 </para>
 <para>
  某些儲存機殼未嚴格遵守 SFF-8489 規格。機殼處理器可能會接受 IBPI 模式，但不會根據 SFF-8489 規格讓指示燈閃爍，或者該處理器可能僅支援數量有限的 IBPI 模式。
 </para>
 <para>
  <command>ledmon</command> 和 <command>ledctl</command> 公用程式都不支援指示燈管理 (AHCI) 和 SAF-TE 通訊協定。
 </para>
 <para>
  <systemitem class="daemon">ledmon</systemitem> 和 <command>ledctl</command> 應用程式經驗證可以與 Intel 儲存控制器 (例如 Intel AHCI 控制器和 Intel SAS 控制器) 配合使用。它們還支援 PCIe-SSD (固態磁碟) 機殼指示燈，用以控制屬於 MD 軟體 RAID 磁碟區一部分之 PCIe-SSD 裝置的儲存機殼狀態 (正常、失敗、正在重建) 指示燈。這些應用程式還可以與其他廠商推出之符合 IBPI 的儲存控制器 (尤其是 SAS/SCSI 控制器) 配合使用；不過，其他廠商的控制器尚未經過測試。
 </para>
 <para>
  <systemitem class="daemon">ledmon</systemitem> 和 <command>ledctl</command> 是 <systemitem class="resource">ledmon</systemitem> 套件的一部分，系統預設不會安裝該套件。執行 <command>sudo zypper in ledmon</command> 可安裝它。
 </para>
 <sect1 xml:id="sec-raid-leds-ledmon">
  <title>儲存機殼指示燈監控服務</title>

  <para>
   <systemitem class="daemon">ledmon</systemitem> 應用程式是一個精靈程序，可以不斷地監控 MD 軟體 RAID 裝置的狀態，或者儲存機殼或磁碟機槽中區塊裝置的狀態。一次只能執行一個該精靈的例項。<systemitem class="daemon">ledmon</systemitem> 精靈是 Intel 機殼指示燈公用程式的一部分。
  </para>

  <para>
   狀態會在與儲存陣列機殼或磁碟機槽中的每個插槽相關聯的指示燈上視覺化顯示。該應用程式會監控所有軟體 RAID 裝置並將其狀態視覺化顯示。它無法僅監控所選軟體 RAID 磁碟區。
  </para>

  <para>
   <systemitem class="daemon">ledmon</systemitem> 精靈支援兩種類型的指示燈系統：雙指示燈系統 (活動指示燈和狀態指示燈) 與三指示燈系統 (活動指示燈、定位指示燈和失敗指示燈)。存取指示燈時，此工具的優先程度最高。
  </para>

  <para>
   若要啟動 <systemitem class="daemon">ledmon</systemitem>，請輸入
  </para>

<screen><prompt>tux &gt; </prompt><command>sudo</command> ledmon [options]</screen>

  <para>
   其中，[options] 是下面的一或多個選項：
  </para>

  <variablelist>
   <title><systemitem class="daemon">ledmon</systemitem> 的選項</title>
   <varlistentry>
    <term><option>-c <replaceable>路徑</replaceable></option>
    </term>
    <term><option>--confg=<replaceable>路徑</replaceable></option>
    </term>
    <listitem>
     <para>
      系統從 <filename>~/.ledctl</filename> 或 <filename>/etc/ledcfg.conf</filename> (如果存在) 中讀取組態。使用此選項可指定替代組態檔案。
     </para>
     <para>
      目前，此選項不起作用，因為尚未實作組態檔案的支援。如需詳細資料，請參閱 <command>man 5 ledctl.conf</command>。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>-l <replaceable>路徑</replaceable>
    </term>
    <term>--log=<replaceable>路徑</replaceable>
    </term>
    <listitem>
     <para>
      設定本地記錄檔案的路徑。如果指定了此使用者定義的檔案，則不會使用全域記錄檔案 <filename>/var/log/ledmon.log</filename>。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><option>-t <replaceable>秒數</replaceable></option>
    </term>
    <term><option>--interval=<replaceable>秒數</replaceable></option>
    </term>
    <listitem>
     <para>
      設定掃描 <filename>sysfs</filename> 之間的時間間隔。該值以秒為單位。最短為 5 秒。最大值未指定。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><option>--quiet</option>、<option>--error</option>、<option>--warning</option>、<option>--info</option>、<option>--debug</option>、<option>--all</option>
    </term>
    <listitem>
     <para>
      指定詳細度層級。層級選項按從無資訊到最詳細資訊的順序指定。使用 <option>--quiet</option> 選項不會記錄任何內容。使用 <option>--all</option> 選項則可記錄所有內容。如果指定多個詳細選項，將會套用指令中的最後一個選項。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><option>-h</option>
    </term>
    <term><option>--help</option>
    </term>
    <listitem>
     <para>
      將指令資訊列印至主控台，然後結束。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><option>-v</option>
    </term>
    <term><option>--version</option>
    </term>
    <listitem>
     <para>
      顯示 <command>ledmon</command> 的版本以及授權的相關資訊，然後結束。
     </para>
    </listitem>
   </varlistentry>
  </variablelist>

  <note>
   <title>已知問題</title>
   <para>
    <command>ledmon</command> 精靈無法依照 SFF-8489 規格識別 PFA (故障預警分析) 狀態。因此，無法視覺化顯示 PFA 模式。
   </para>
  </note>
 </sect1>
 <sect1 xml:id="sec-raid-leds-ledctl">
  <title>儲存機殼指示燈控制應用程式</title>

  <para>
   機殼指示燈應用程式 (<command>ledctl</command>) 是一個使用者空間應用程式，可以控制與儲存機殼或磁碟機槽相關聯的指示燈。<command>ledctl</command> 應用程式是 Intel 機殼指示燈公用程式的一部分。
  </para>

  <para>
   當您發出該指令時，系統會將指定裝置的指示燈設為指定的模式，並會關閉所有其他指示燈。執行此應用程式需要有 <systemitem class="username">root</systemitem> 權限。由於 <systemitem class="daemon">ledmon</systemitem><command/> 應用程式在存取指示燈時具有最高優先程度，因此如果 <systemitem class="daemon">ledmon</systemitem> 精靈正在執行，ledctl 設定的某些模式可能將不起作用 (Locate 模式除外)。
  </para>

  <para>
   <command>ledctl</command> 應用程式支援兩種類型的指示燈系統：雙指示燈系統 (活動指示燈和狀態指示燈) 與三指示燈系統 (活動指示燈、失敗指示燈和定位指示燈)。
  </para>

  <para>
   若要啟動 <command>ledctl</command>，請輸入
  </para>

<screen><prompt>tux &gt; </prompt><command>sudo</command> [options] <replaceable>PATTERN_NAME</replaceable>=list_of_devices</screen>

  <para>
   其中，[options] 是下面的一或多個選項：
  </para>

  <variablelist>
   <varlistentry>
    <term><option>-c <replaceable>路徑</replaceable></option>
    </term>
    <term><option>--confg=<replaceable>路徑</replaceable></option>
    </term>
    <listitem>
     <para>
      設定本地組態檔案的路徑。如果指定了此選項，則全域組態檔案與使用者組態檔案都將無效。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>-l <replaceable>路徑</replaceable>
    </term>
    <term>--log=<replaceable>路徑</replaceable>
    </term>
    <listitem>
     <para>
      設定本地記錄檔案的路徑。如果指定了此使用者定義的檔案，則不會使用全域記錄檔案 <filename>/var/log/ledmon.log</filename>。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><option>--quiet</option>
    </term>
    <listitem>
     <para>
      關閉傳送至 <filename>stdout</filename> 或從 <filename>stderr</filename> 傳出的所有訊息。但這些訊息仍會記錄到本地檔案和 <filename>syslog</filename> 工具中。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><option>-h</option>
    </term>
    <term><option>--help</option>
    </term>
    <listitem>
     <para>
      將指令資訊列印至主控台，然後結束。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><option>-v</option>
    </term>
    <term><option>--version</option>
    </term>
    <listitem>
     <para>
      显示 <command>ledctl</command> 的版本以及许可证的相关信息，然後退出。
     </para>
    </listitem>
   </varlistentry>
  </variablelist>

  <sect2 xml:id="sec-raid-leds-ledctl-patterns">
   <title>模式名稱</title>
   <para>
    根據 SFF-8489 規格，<command>ledctl</command> 應用程式接受下列 <guimenu>pattern_name</guimenu> 引數名稱。
   </para>
   <variablelist>
    <varlistentry>
     <term><literal>locate</literal>
     </term>
     <listitem>
      <para>
       開啟與指定裝置或空插槽相關聯的定位指示燈。此狀態用於識別插槽或磁碟機。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>locate_off</literal>
     </term>
     <listitem>
      <para>
       關閉與指定裝置或空插槽相關聯的定位指示燈。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>normal</literal>
     </term>
     <listitem>
      <para>
       關閉與指定裝置相關聯的狀態指示燈、失敗指示燈和定位指示燈。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>off</literal>
     </term>
     <listitem>
      <para>
       僅關閉與指定裝置相關聯的狀態指示燈和失敗指示燈。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>ica</literal>
     </term>
     <term><literal>degraded</literal>
     </term>
     <listitem>
      <para>
       視覺化顯示 <literal>In a Critical Array</literal> 模式。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>rebuild</literal>
     </term>
     <term><literal>rebuild_p</literal>
     </term>
     <listitem>
      <para>
       視覺化顯示 <literal>Rebuild</literal> 模式。出於相容性和舊版原因，支援這兩種重建狀態。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>ifa</literal>
     </term>
     <term><literal>failed_array</literal>
     </term>
     <listitem>
      <para>
       視覺化顯示 <literal>In a Failed Array</literal> 模式。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>hotspare</literal>
     </term>
     <listitem>
      <para>
       視覺化顯示 <literal>Hotspare</literal> 模式。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>pfa</literal>
     </term>
     <listitem>
      <para>
       視覺化顯示 <literal>Predicted Failure Analysis</literal> 模式。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>failure</literal>
     </term>
     <term><literal>disk_failed</literal>
     </term>
     <listitem>
      <para>
       視覺化顯示 <literal>Failure</literal> 模式。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>ses_abort</term>
     <listitem>
      <para>
       SES-2 R/R ABORT
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>ses_rebuild</literal>
     </term>
     <listitem>
      <para>
       SES-2 REBUILD/REMAP
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>ses_ifa</literal>
     </term>
     <listitem>
      <para>
       SES-2 IN FAILED ARRAY
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>ses_ica</literal>
     </term>
     <listitem>
      <para>
       SES-2 IN CRITICAL ARRAY
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>ses_cons_check</literal>
     </term>
     <listitem>
      <para>
       SES-2 CONS CHECK
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>ses_hotspare</literal>
     </term>
     <listitem>
      <para>
       SES-2 HOTSPARE
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>ses_rsvd_dev</literal>
     </term>
     <listitem>
      <para>
       SES-2 RSVD DEVICE
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>ses_ok</literal>
     </term>
     <listitem>
      <para>
       SES-2 OK
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>ses_ident</literal>
     </term>
     <listitem>
      <para>
       SES-2 IDENT
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>ses_rm</literal>
     </term>
     <listitem>
      <para>
       SES-2 REMOVE
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>ses_insert</literal>
     </term>
     <listitem>
      <para>
       SES-2 INSERT
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>ses_missing</literal>
     </term>
     <listitem>
      <para>
       SES-2 MISSING
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>ses_dnr</literal>
     </term>
     <listitem>
      <para>
       SES-2 DO NOT REMOVE
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>ses_active</literal>
     </term>
     <listitem>
      <para>
       SES-2 ACTIVE
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>ses_enable_bb</literal>
     </term>
     <listitem>
      <para>
       SES-2 ENABLE BYP B
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>ses_enable_ba</literal>
     </term>
     <listitem>
      <para>
       SES-2 ENABLE BYP A
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>ses_devoff</literal>
     </term>
     <listitem>
      <para>
       SES-2 DEVICE OFF
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>ses_fault</literal>
     </term>
     <listitem>
      <para>
       SES-2 FAULT
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
   <para>
    將非 SES-2 模式傳送至機殼中的裝置時，該模式會自動轉換為 SCSI 機殼服務 (SES) 2 模式，如下所示。
   </para>
   <table>
    <title>非 SES-2 模式與 SES-2 模式之間的轉換</title>
    <tgroup cols="2">
     <colspec colnum="1" colname="1" colwidth="5001*"/>
     <colspec colnum="2" colname="2" colwidth="5001*"/>
     <thead>
      <row>
       <entry>
        <para>
         非 SES-2 模式
        </para>
       </entry>
       <entry>
        <para>
         SES-2 模式
        </para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row>
       <entry>
        <para>
         locate
        </para>
       </entry>
       <entry>
        <para>
         ses_ident
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         locate_off
        </para>
       </entry>
       <entry>
        <para>
         ses_ident
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         normal
        </para>
       </entry>
       <entry>
        <para>
         ses_ok
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         off
        </para>
       </entry>
       <entry>
        <para>
         ses_ok
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         ica
        </para>
       </entry>
       <entry>
        <para>
         ses_ica
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         degraded
        </para>
       </entry>
       <entry>
        <para>
         ses_ica
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         rebuild
        </para>
       </entry>
       <entry>
        <para>
         ses_rebuild
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         rebuild_p
        </para>
       </entry>
       <entry>
        <para>
         ses_rebuild
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         ifa
        </para>
       </entry>
       <entry>
        <para>
         ses_ifa
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         failed_array
        </para>
       </entry>
       <entry>
        <para>
         ses_ifa
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         hotspare
        </para>
       </entry>
       <entry>
        <para>
         ses_hotspare
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         pfa
        </para>
       </entry>
       <entry>
        <para>
         ses_rsvd_dev
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         failure
        </para>
       </entry>
       <entry>
        <para>
         ses_fault
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         disk_failed
        </para>
       </entry>
       <entry>
        <para>
         ses_fault
        </para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </table>
  </sect2>

  <sect2 xml:id="sec-raid-leds-ledctl-devices">
   <title>裝置清單</title>
   <para>
    當您發出 <command>ledctl</command> 指令時，系統會將指定裝置的指示燈設為指定的模式，並會關閉所有其他指示燈。裝置清單可採用下列兩種格式之一來提供：
   </para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>
      以逗號分隔且無空格的裝置清單
     </para>
    </listitem>
    <listitem>
     <para>
      以空格分隔並用大括號括住的裝置清單
     </para>
    </listitem>
   </itemizedlist>
   <para>
    如果在同一個指令中指定多個模式，則每個模式的裝置清單可以使用相同的格式，也可以使用不同的格式。如需顯示兩種清單格式的範例，請參閱<xref linkend="sec-raid-leds-ledctl-examples" xrefstyle="SectTitleOnPage"/>。
   </para>
   <para>
    裝置是指向 <filename>/dev</filename> 目錄或 <filename>/sys/block</filename> 目錄中檔案的路徑。路徑可以識別區塊裝置、MD 軟體 RAID 裝置或容器裝置。對於軟體 RAID 裝置或容器裝置，將會為所有相關聯的區塊裝置設定所報告的指示燈狀態。
   </para>
   <para>
    list_of_devices 中列出之裝置的指示燈將設為指定的模式 pattern_name，且所有其他指示燈都將關閉。
   </para>
  </sect2>

  <sect2 xml:id="sec-raid-leds-ledctl-examples">
   <title>範例</title>
   <para>
    尋找單個區塊裝置：
   </para>
<screen><prompt>tux &gt; </prompt><command>sudo</command> ledctl locate=/dev/sda</screen>
   <para>
    若要關閉單個區塊裝置的定位指示燈：
   </para>
<screen><prompt>tux &gt; </prompt><command>sudo</command> ledctl locate_off=/dev/sda</screen>
   <para>
    尋找 MD 軟體 RAID 裝置的磁碟，並同時為其兩個區塊裝置設定重建模式：
   </para>
<screen><prompt>tux &gt; </prompt><command>sudo</command> ledctl locate=/dev/md127 rebuild={ /sys/block/sd[a-b] }</screen>
   <para>
    關閉指定裝置的狀態指示燈和失敗指示燈：
   </para>
<screen><prompt>tux &gt; </prompt><command>sudo</command> ledctl off={ /dev/sda /dev/sdb }</screen>
   <para>
    若要找到三個區塊裝置，請執行以下指令之一 (兩個指令是等效的)：
   </para>
<screen><prompt>tux &gt; </prompt><command>sudo</command> ledctl locate=/dev/sda,/dev/sdb,/dev/sdc
<prompt>tux &gt; </prompt><command>sudo</command> ledctl locate={ /dev/sda /dev/sdb /dev/sdc }</screen>
  </sect2>
 </sect1>
 <sect1 xml:id="sec-raid-leds-info">
  <title>更多資訊</title>

  <para>
   如需指示燈模式和監控工具的詳細資料，請參閱下列資源：
  </para>

  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>
     <link xlink:href="https://github.com/intel/ledmon.git">GitHub.com 上的 LEDMON 開放原始碼專案</link>
    </para>
   </listitem>
   <listitem>
    <para>
     <link xlink:href="https://ftp.seagate.com/sff/SFF-8485.PDF">SGPIO 規格 SFF-8485</link>
    </para>
   </listitem>
   <listitem>
    <para>
     <link xlink:href="https://ftp.seagate.com/sff/SFF-8489.PDF">IBPI 規格 SFF-8489</link>
    </para>
   </listitem>
  </itemizedlist>
 </sect1>
</chapter>
