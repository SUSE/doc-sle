<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE chapter PUBLIC "-//Novell//DTD NovDoc XML V1.0//EN" "novdocx.dtd">
<!--
*********************************
Please see LICENSE.txt for this document's license.
*********************************
-->
<chapter xml:base="net_slp.xml" id="cha.slp">
 <title>SLP</title><indexterm> <primary>网络</primary> <secondary>SLP</secondary> </indexterm> <indexterm> <primary>服务位置协议</primary> <see>SLP</see> </indexterm> <indexterm> <primary>SLP</primary> </indexterm> <indexterm> <primary>协议</primary> <secondary>SLP</secondary> </indexterm>
 <abstract>
  <para>
   要配置网络客户端，需要了解关于通过网络提供的服务（例如打印或 LDAP）的详细知识。为了简化在网络客户端上配置此类服务的工作，<quote>服务定位协议</quote> (SLP） 应运而生。SLP 可向本地网络中的所有客户端告知所选服务的可用性和配置数据。支持 SLP 的应用程序可以利用这一信息来进行自动配置。
  </para>
 </abstract>
 <para>
  <phrase role="productname"><phrase os="sles">SUSE® Linux Enterprise Server</phrase></phrase> 支持使用 SLP 提供的安装源进行安装，并且包含许多集成了 SLP 支持的系统服务。您可以使用 SLP 为联网客户端（如系统上的安装服务器、文件服务器或打印服务器）提供核心功能。提供 SLP 支持的服务包括 cupsd、login、ntp、openldap2、postfix、rpasswd、rsyncd、saned、sshd（通过 fish）、vnc 和 ypserv。
 </para>
 <para>
  默认情况下，系统会安装在网络客户端上使用 SLP 服务所需的所有包。但如果您要通过 SLP <emphasis>提供</emphasis>服务，请检查 <systemitem>openslp-server</systemitem> 包是否已安装。
 </para>
 <sect1 id="sec.slp.sl.fend">
  <title>SLP 前端 <command>slptool</command></title>

  <para>
   <command>slptool</command> 是一个命令行工具，用于查询和注册 SLP 服务。在进行诊断时，查询功能非常有用。下面列出了最重要的 <command>slptool</command> 子命令。<command>slptool</command> <option>--help</option> 列出所有可用的选项和函数。
  </para>

  <variablelist>
   <varlistentry>
    <term>findsrvtypes</term>
    <listitem>
     <para>
      列出网络上可用的所有服务类型。
     </para>
<screen><prompt role="user">tux &gt; </prompt> slptool findsrvtypes
service:install.suse:nfs
service:install.suse:ftp
service:install.suse:http
service:install.suse:smb
service:ssh
service:fish
service:YaST.installation.suse:vnc
service:smtp
service:domain
service:management-software.IBM:hardware-management-console
service:rsync
service:ntp
service:ypserv</screen>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>findsrvs <replaceable>服务类型</replaceable>
    </term>
    <listitem>
     <para>
      列出提供<replaceable>服务类型</replaceable>的所有服务器。
     </para>
<screen><prompt role="user">tux &gt; </prompt> slptool findsrvs service:ntp
service:ntp://ntp.example.com:123,57810
service:ntp://ntp2.example.com:123,57810</screen>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>
     findattrs <replaceable>服务类型</replaceable>//<replaceable>主机</replaceable>
    </term>
    <listitem>
     <para>
      列出<replaceable>主机</replaceable>上<replaceable>服务类型</replaceable>的属性
     </para>
<screen><prompt role="user">tux &gt; </prompt> slptool findattrs service:ntp://ntp.example.com
(owner=tux),(email=tux@example.com)</screen>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>
     register <replaceable>服务类型</replaceable>//<replaceable>主机</replaceable>:<replaceable>端口</replaceable> "(<replaceable>属性=值</replaceable>),(<replaceable>属性=值</replaceable>)"
    </term>
    <listitem>
     <para>
      在<replaceable>主机</replaceable>上使用选用的属性列表注册<replaceable>服务类型</replaceable>
     </para>
<screen>slptool register service:ntp://ntp.example.com:57810 \
"(owner=tux),(email=tux@example.com)"</screen>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>
     deregister <replaceable>服务类型</replaceable>//<replaceable>主机</replaceable>
    </term>
    <listitem>
     <para>
      在<replaceable>主机</replaceable>上取消注册<replaceable>服务类型</replaceable>
     </para>
<screen>slptool deregister service:ntp://ntp.example.com</screen>
    </listitem>
   </varlistentry>
  </variablelist>

  <para>
   有关更多信息，请运行 <command>slptool --help</command>。
  </para>
 </sect1>
 <sect1 id="sec.slp.sl.reg">
  <title>通过 SLP 提供服务</title>

  <para>
   要提供 SLP 服务，SLP 守护程序 (<systemitem class="daemon">slpd</systemitem>) 必须处于运行状态。与 <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> 中的大多数系统服务类似，<systemitem class="daemon">slpd</systemitem> 通过单独的启动脚本来控制。安装后，默认情况下停用守护程序。要为当前的会话激活它，请运行 <command>sudo systemctl start slpd.service</command>。如果 <systemitem class="daemon">slpd</systemitem> 应该在系统启动时激活，请运行 <command>sudo systemctl enable slpd.service</command>。
  </para>

  <para>
   <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> 中的许多应用程序都已通过使用 <literal>libslp</literal> 库集成了 SLP 支持。如果服务未符合 SLP 支持，请使用以下方法之一使其可通过 SLP 发布。
  </para>

  <variablelist>
   <varlistentry>
    <term>通过 <filename>/etc/slp.reg.d</filename> 进行的静态注册
    </term>
    <listitem>
     <para>
      为每个新服务创建单独的注册文件。下面的示例会注册一个扫描仪服务：
     </para>
<screen>## Register a saned service on this system
## en means english language
## 65535 disables the timeout, so the service registration does
## not need refreshes
service:scanner.sane://$HOSTNAME:6566,en,65535
watch-port-tcp=6566
description=SANE scanner daemon</screen>
     <para>
      此文件中最重要的一行是以 <emphasis>service:</emphasis> 开头的<literal>服务 URL</literal>。其中包含服务类型 (<literal>scanner.sane</literal>) 以及该服务在服务器上的地址。<replaceable>$HOSTNAME</replaceable> 会自动替换为完整主机名。随后是可以找到相关服务的 TCP 端口的名称，端口与主机名之间用冒号分隔。然后输入服务的显示语言及以秒计的注册持续时间。应该用逗号分隔服务 URL 之后的各项内容。将注册持续时间设置为 <literal>0</literal> 到 <literal>65535</literal> 之间的值。<literal>0</literal> 表示禁止注册。<literal>65535</literal> 表示取消所有限制。
     </para>
     <para>
      该注册文件还包含 <systemitem>watch-port-tcp</systemitem> 和 <systemitem>description</systemitem> 这两个变量。<systemitem>watch-port-tcp</systemitem><systemitem class="daemon"> 通过使 slpd 检查相关服务的状态，链接 SLP 服务对该服务是否活动的发布。</systemitem>第二个变量为显示在适合的浏览器中的服务提供了更为准确的描述。
     </para>
     <tip>
      <title>YaST 和 SLP</title>
      <para>
       在模块对话框中激活 SLP 后，由 YaST 代理的某些服务（如安装服务器或 YOU 服务器）会为您自动执行此注册。然后，YaST 为这些服务创建注册文件。
      </para>
     </tip>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>通过 <filename>/etc/slp.reg</filename> 进行的静态注册
    </term>
    <listitem>
     <para>
      此方法与使用 <filename>/etc/slp.reg.d</filename> 的步骤之间唯一的区别在于，所有服务在中心文件中分组。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>使用 <command>slptool</command> 进行的动态注册
    </term>
    <listitem>
     <para>
      如果某个服务须动态注册，而无需配置文件，请使用 slptool 命令行实用程序。该实用程序还可用于取消注册某个现有服务产品，而无需重启动 <systemitem class="daemon">slpd</systemitem>。有关详细信息，请参见<xref linkend="sec.slp.sl.fend"/>。
     </para>
    </listitem>
   </varlistentry>
  </variablelist>

  <sect2 id="sec.slp.sl.reg.install">
   <title>设置 SLP 安装服务器</title>
   <para>
    在网络中通过 SLP 公告安装数据可简化网络安装过程，因为系统会通过 SLP 查询自动请求服务器 IP 地址或安装媒体路径等安装数据。有关指导，请参见<xref linkend="sec.deployment.remoteinst.instserver"/>。
   </para>
  </sect2>
 </sect1>
 <sect1 id="sec.slp.info">
  <title>更多信息</title>

  <variablelist>
   <varlistentry>
    <term>RFC 2608、2609、2610</term>
    <listitem>
     <para>
      RFC 2608 主要描述了 SLP 的定义。RFC 2609 更详细地描述了所用服务 URL 的语法；RFC 2610 则对通过 SLP 的 DHCP 进行了描述。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><ulink url="http://www.openslp.org"/>
    </term>
    <listitem>
     <para>
      OpenSLP 项目的主页。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><filename>/usr/share/doc/packages/openslp</filename>
    </term>
    <listitem>
     <para>
      此目录包含 <systemitem>openslp-server</systemitem> 包随附的 SLP 文档，其中的 <filename>README.SuSE</filename> 文件包含 <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> 细节、RFC 和两个介绍性的 HTML 文档。想要使用 SLP 功能的程序员可在 SUSE 软件开发包附带的 <emphasis>openslp-devel</emphasis> 包中找到《<systemitem class="resource">Programmers Guide</systemitem>》（编程指南），了解更多信息。
     </para>
    </listitem>
   </varlistentry>
  </variablelist>
 </sect1>
</chapter>
