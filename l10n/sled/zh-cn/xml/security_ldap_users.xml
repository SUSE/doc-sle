<?xml version="1.0" encoding="UTF-8"?>
<sect1 xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="security_ldap_users.xml" version="5.0" xml:id="sec-security-ldap-server-users">  <title>管理 LDAP 用户和组</title>
   <info>
      <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
        <dm:translation>yes</dm:translation>
      </dm:docmanager>
    </info>
    <para>
    通过 <command>dsidm</command> 命令来创建并管理用户和组。该命令以交互方式运行，或者，您也可以在命令行上运行，并在一条命令中输入所有选项。 
   </para>
   <para>
     列出现有的用户和组：
   </para>
   <screen><prompt>tux &gt; </prompt><command>sudo</command> dsidm <replaceable>ldap1</replaceable> user list
<prompt>tux &gt; </prompt><command>sudo</command> dsidm <replaceable>ldap1</replaceable> group list</screen>
   <para>
       列出有关单个用户的所有信息：
   </para>
   <screen><prompt>tux &gt; </prompt><command>sudo</command> dsidm <replaceable>ldap1</replaceable> user get <replaceable>username</replaceable></screen>
   <para>
       列出有关单个组的所有信息：
   </para>
      <screen><prompt>tux &gt; </prompt><command>sudo</command> dsidm <replaceable>ldap1</replaceable> group get <replaceable>groupname</replaceable></screen>
   <para>
     列出组的成员：
   </para>
   <screen><prompt>tux &gt; </prompt><command>sudo</command> dsidm <replaceable>ldap1</replaceable> group members <replaceable>demo_group</replaceable></screen>
   <para>
   在下面的示例中，我们通过命令行参数指定相应数据来添加两个用户：<systemitem class="username">wilber</systemitem> 和 <systemitem class="username">geeko</systemitem>。示例服务器实例名为 <replaceable>ldap1</replaceable>，该实例的后缀为 <replaceable>dc=ldap1,dc=com</replaceable>。
   </para>
  <procedure xml:id="pro-security-ldap-server-users">
   <title>创建 LDAP 用户</title>
   <para>
     LDAP 用户是已经存在的用户。他们应具有 Linux 系统帐户、Linux 登录名和主目录。将这些用户添加到您的 LDAP 服务器可集中管理您网络中的用户。您需要输入准确的用户数据，这些信息可通过以下方式来获取：访问存放这些用户帐户的计算机，然后运行 <command>id</command> 命令，如以下针对 Wilber Fox 的命令示例所示：
   </para>
   <screen><prompt>tux &gt; </prompt>id geeko
uid=1001(wilber) gid=101(users) groups=101(users)</screen>   
   <step>
    <para>
    创建 LDAP 用户 <systemitem class="username">wilber</systemitem>：
    </para>
    <screen><prompt>tux &gt; </prompt><command>sudo</command> <command>dsidm</command> <replaceable>ldap1</replaceable> user create --uid wilber \
  --cn wilber --displayName 'Wilber Fox' --uidNumber 1001 --gidNumber 101 \
  --homeDirectory /home/wilber</screen>
   </step>
   <step>
    <para>
     通过查询新用户的<literal>判别名</literal>（目录对象的完全限定名称，能够确保唯一）进行校验：
    </para>
    <screen><prompt>tux &gt; </prompt><command>sudo</command> dsidm <replaceable>ldap1</replaceable> user get wilber
dn: uid=wilber,ou=people,dc=ldap1,dc=com
[...]</screen>
    <para>
     执行更改用户口令等操作时需要用到判别名。
    </para>
   </step>
   <step>
    <para>
     为新用户 <systemitem class="username">wilber</systemitem> 创建口令：
    </para>
    <substeps>
      <step>
       <screen><prompt>tux &gt; </prompt><command>sudo</command> dsidm <replaceable>ldap1</replaceable> account reset_password \
  uid=wilber,ou=people,dc=ldap1,dc=com</screen>
      </step>
      <step>
       <para>
        输入 <systemitem class="username">wilber</systemitem> 的新口令两次。
       </para>
       <para>
        如果操作成功，您将看到以下消息：
       </para>
       <screen>reset password for uid=wilber,ou=people,dc=ldap1,dc=com</screen>
       <para>
         使用相同的命令更改现有口令。
       </para>
      </step>
    </substeps>
   </step>
   <step>
    <para>创建用户 <systemitem class="username">geeko</systemitem>：</para>
    <screen><prompt>tux &gt; </prompt><command>sudo</command> <command>dsidm</command> <replaceable>ldap1</replaceable> user create --uid geeko\
  --cn geeko --displayName 'Suzanne Geeko' \
  --uidNumber 1002 --gidNumber 102 --homeDirectory /home/<systemitem class="username">geeko</systemitem>
  
<prompt>tux &gt; </prompt><command>sudo</command> dsidm <replaceable>ldap1</replaceable> account reset_password \
  uid=<systemitem class="username">geeko</systemitem>,ou=people,dc=ldap1,dc=com</screen>
   </step>
      <step>
    <para>
     校验用户的口令是否有效：
    </para>
   <screen><prompt>tux &gt; </prompt>ldapwhoami -D uid=geeko,ou=people,dc=ldap1,dc=com -W
Enter LDAP Password: 
dn: uid=geeko,ou=people,dc=ldap1,dc=com    
     </screen>
   </step>
  </procedure>

   <para>
     以下示例会删除用户 <systemitem class="username">wilber</systemitem>：
   </para>
   <screen><prompt>tux &gt; </prompt><command>sudo</command> <command>dsidm</command> <replaceable>ldap1</replaceable> user delete 
   Enter dn to delete : <replaceable>uid=wilber,ou=people,dc=ldap1,dc=com</replaceable>
   Deleting nsUserAccount uid=wilber,ou=people,dc=ldap1,dc=com :
   Type 'Yes I am sure' to continue: Yes I am sure
   Successfully deleted uid=wilber,ou=people,dc=ldap1,dc=com</screen>
  
  <procedure xml:id="pro-security-ldap-server-groups">
   <title>创建 LDAP 组并将用户指派到其中</title>
   <para>
    在以下示例中，我们将创建 <replaceable>server_admins</replaceable> 组，并将 <systemitem class="username">wilber</systemitem> 用户指派到此组。示例服务器实例名为 <literal>ldap1</literal>，该实例的后缀为 <literal>dc=ldap1,dc=com</literal>。
    </para>
   <step>
    <para>
     创建组：
    </para>
    <screen><prompt>tux &gt; </prompt><command>sudo</command> dsidm <replaceable>ldap1</replaceable> group create</screen>
    <para>
     系统会提示您输入组名。输入所选的组名：
    </para>
    <screen>Enter value for cn : <replaceable>server_admins</replaceable></screen>
   </step>
   <step>
    <para>
     将用户 <systemitem class="username">wilber</systemitem> 添加到该组：
    </para>
    <screen><prompt>tux &gt; </prompt><command>sudo</command> dsidm <replaceable>ldap1</replaceable> group add_member <replaceable>server_admins</replaceable> uid=wilber,ou=people,<replaceable>dc=ldap1,dc=com</replaceable>
added member: uid=wilber,ou=people,<replaceable>dc=ldap1,dc=com</replaceable></screen>
   </step>
  </procedure>
 </sect1>
