<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="sle_update_online.xml" version="5.0" xml:id="cha-upgrade-online">
 <title os="sles;sled">線上升級</title>
 
 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:bugtracker/>
   <dm:translation>yes</dm:translation>
  </dm:docmanager>
  <abstract>
   <para os="sles;sled">
    SUSE 提供了直觀的圖形工具和簡單的指令行工具，供您將執行中系統升級至新 Service Pack。兩個工具都提供 Service Pack<quote>復原</quote>支援及其他功能。本章提供有關如何使用這些工具執行 Service Pack 升級的分步說明。
   </para>

   
  </abstract>
 </info>
 <sect1 xml:id="sec-upgrade-online-conceptual-overview">
  <title>概念綜覽</title>

  <para os="sles;sled">
   SUSE 會定期發佈 SUSE Linux Enterprise 系列的新 Service Pack。為了方便客戶移轉至新的 Service Pack，並最大程度減少停機時間，SUSE 支援在系統執行時進行線上移轉。
  </para>

  

  <para os="sles;sled">
   從 SLE 12 開始，YaST 移轉 (GUI) 與 Zypper 移轉 (指令行) 取代了 YaST Wagon。此項變更的優點在於：
  </para>

  

  

  <itemizedlist>
   <listitem>
    <para>
     在首個 RPM 更新之前，系統將永遠處於已定義的狀態。
    </para>
   </listitem>
   <listitem>
    <para>
     在首個 RPM 更新之前，可以取消操作。
    </para>
   </listitem>
   <listitem>
    <para>
     如果出現錯誤，可以輕鬆復原。
    </para>
   </listitem>
   <listitem>
    <para>
     您可以透過系統工具執行<quote>復原</quote> - 無需進行備份或還原。
    </para>
   </listitem>
   <listitem>
    <para>
     使用所有有效儲存庫。
    </para>
   </listitem>
   <listitem os="sles;sled">
    <para>
     能夠跳過 Service Pack。
    </para>
   </listitem>
  </itemizedlist>

  <warning os="sles;sled">
   <title>不支援對主要版本進行線上移轉</title>
   <para>
    <emphasis>僅</emphasis>支援在 Service Pack 之間進行線上移轉。<emphasis>不支援</emphasis>透過線上移轉升級至新的主要版本。如需詳細資料，請參閱<xref linkend="cha-upgrade-paths"/>。
   </para>
   <para>
    請透過離線移轉升級至新的主要版本。如需詳細資料，請參閱<xref linkend="cha-upgrade-offline"/>。
   </para>
  </warning>

  <important os="sles;sled">
   <title>升級 SUSE Manager 用戶端</title>
   <para>
    如果要升級的系統是 SUSE Manager 用戶端，則無法透過 YaST 線上移轉或 <command>zypper migration</command> 進行升級。請改為使用<citetitle>用戶端移轉</citetitle>程序。<link xlink:href="https://documentation.suse.com/suma/">
    <citetitle>《SUSE Manager Upgrade Guide》(SUSE Manager 升級指南)</citetitle></link>對此進行了說明。
   </para>
  </important>
 </sect1>
 <sect1 os="sles;sled" xml:id="sec-upgrade-online-workflow">
  <title>Service Pack 移轉工作流程</title>

  <para>
   Service Pack 移轉可透過 YaST、<command>zypper</command> 或 AutoYaST 執行。
  </para>

  <para>
   開始 Service Pack 移轉之前，必須在 SUSE Customer Center 或本地 RMT 伺服器中註冊您的系統。也可以使用 SUSE Manager。
  </para>

  <para>
   不論使用哪種方式，Service Pack 移轉都包含以下步驟：
  </para>

  <orderedlist>
   <listitem>
    <para>
     在您的註冊系統上尋找可能的移轉目標。
    </para>
   </listitem>
   <listitem>
    <para>
     選取一個移轉目標。
    </para>
   </listitem>
   <listitem>
    <para>
     申請並啟用新的儲存庫。
    </para>
   </listitem>
   <listitem>
    <para>
     執行移轉。
    </para>
   </listitem>
  </orderedlist>

  <para>
   移轉目標清單取決於您已安裝和註冊的產品。如果您安裝的延伸沒有新的 SP 可用，則無法向您提供移轉目標。
  </para>

  <para>
   您的主機可用的移轉目標清單將始終可從 SUSE Customer Center 取回，並取決於所安裝的產品或延伸。
  </para>
 </sect1>
 
 <sect1 os="sles;sled" xml:id="sec-upgrade-online-cancel">
  <title>取消 Service Pack 移轉</title>

  <para>
   在移轉程序中，只能在特定階段取消 Service Pack 移轉：
  </para>

  <orderedlist>
   <listitem>
    <para>
     在套件升級開始之前，僅對系統進行極少量的變更，例如對服務和儲存庫的變更。還原 <filename>/etc/zypp/repos.d/*</filename>，以便回復到先前的狀態。
    </para>
   </listitem>
   <listitem>
    <para>
     在套件升級開始之後，可以使用 Snapper 快照回復到先前的狀態 (請參閱<xref linkend="cha-snapper"/>)。
    </para>
   </listitem>
   <listitem>
    <para>
     選取移轉目標後，SUSE Customer Center 會變更儲存庫資料。若要手動回復此狀態，請使用 <command>SUSEConnect</command>
     <option> --rollback</option>。
    </para>
   </listitem>
  </orderedlist>
 </sect1>
 
 <sect1 os="sles;sled" xml:id="sec-upgrade-online-yast">
  <title>使用線上移轉工具 (YaST) 升級</title>

  <para>
   若要透過 Yast 執行 Service Pack 移轉，請使用<guimenu>線上移轉</guimenu>工具。依預設，YaST 不會從協力廠商儲存庫安裝任何套件。如果某套件是從協力廠商儲存庫安裝的，YaST 會阻止該套件取代為來自 SUSE 的相同套件。
  </para>

  <note>
   <title>減小安裝大小</title>
   <para>
    執行 Service Pack 移轉時，YaST 會安裝所有推薦的套件。特別是在自訂精簡安裝的情況下，這樣會顯著增加系統的安裝大小。
   </para>
   <para>
    若要變更此預設行為並只允許必要的套件，請調整 <filename>/etc/zypp/zypp.conf</filename> 中的 <option>solver.onlyRequires</option> 選項。
   </para>
<screen>solver.onlyRequires = true</screen>
   <para>
    另外，請編輯檔案 <filename>/etc/zypp/zypper.conf</filename> 並變更 <option>installRecommends</option> 選項。
   </para>
   <screen>installRecommends=false</screen>
   <para>
    這會變更所有套件操作的行為，例如安裝修補程式或新套件。若要變更某次調用的 Zypper 行為，請使用 <option>--no-recommends</option> 參數。
  </para>
</note>

  <para>
   若要啟動 Service Pack 移轉，請執行以下操作：
  </para>

  <procedure xml:id="pro-upgrade-online-yast">
   <step>
    <para>
     停用註冊伺服器上所有未使用的延伸，以免將來發生相依性衝突。如果您忘記了某個延伸，YaST 稍後會偵測未使用的延伸儲存庫，並將其停用。
    </para>
   </step>
   <step>
    <para>
     如果您已登入要更新的機器上的某個執行中 GNOME 工作階段，請切換到文字主控台。建議不要從 GNOME 工作階段執行更新。請注意，這並不適用於從遠端機器登入的情況 (除非您正在使用 GNOME 執行 VNC 工作階段)。
    </para>
   </step>
   
   <step>
    <para>
     執行 YaST 線上更新以取得系統的最新套件更新。
    </para>
   </step>
   <step>
    <para>
     安裝 <package>yast2-migration</package> 套件及其相依項 (在 YaST 的<menuchoice> <guimenu>軟體</guimenu>
     <guimenu>軟體管理</guimenu> </menuchoice>下)。
    </para>
   </step>
   <step>
    <para>
     重新啟動 YaST；如果不重新啟動，新安裝的模組將不會顯示在控制中心中。
    </para>
   </step>
   <step>
    <para>
     在 YaST 中，選擇<guimenu>線上移轉</guimenu> (根據所升級的 <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> 版本，此模組會列於<guimenu>系統</guimenu>或<guimenu>軟體</guimenu>類別下)。YaST 將顯示可能的移轉目標和摘要。如果您的系統有多個可用的移轉目標，請從清單中選取一個。
    </para>
   </step>
   <step>
    <para>
     從清單中選取一個移轉目標，然後按一下<guimenu>下一步</guimenu>繼續操作。
    </para>
   </step>
   <step>
    <para>
     如果移轉工具提供更新儲存庫，建議按一下<guimenu>是</guimenu>繼續。
    </para>
   </step>
   <step>
    <para>
     <remark>toms 2015-09-09: FATE#319140</remark>
     如果「線上移轉」工具找到來自 DVD 或本地伺服器的過時儲存庫，強烈建議您將其停用。過時的儲存庫來自先前的 SP。系統會自動移除來自 SUSE Customer Center 或 RMT 的所有舊儲存庫。
    </para>
   </step>
   <step>
    <para>
     按<guimenu>下一步</guimenu>，查看摘要並繼續移轉過程。確認<guimenu>開始更新</guimenu>。
    </para>
    <remark>toms 2016-07-13: What to do in case of problems?</remark>
   </step>
   <step>
    <para>
     成功移轉後，請重新啟動系統。
    </para>
   </step>
  </procedure>
 </sect1>
 <sect1 os="sles;sled" xml:id="sec-upgrade-online-zypper">
  <title>使用 Zypper 升級</title>

  <para>
   若要使用 Zypper 執行 Service Pack 移轉，請使用指令行工具 <command>zypper</command> <option>migration</option> (來自套件 <package>zypper-migration-plugin</package>.
  </para>

  <note>
   <title>減小安裝大小</title>
   <para>
    執行 Service Pack 移轉時，YaST 會安裝所有推薦的套件。特別是在自訂精簡安裝的情況下，這樣會顯著增加系統的安裝大小。
   </para>
   <para>
    若要變更此預設行為並只允許必要的套件，請調整 <filename>/etc/zypp/zypp.conf</filename> 中的 <option>solver.onlyRequires</option> 選項。
   </para>
<screen>solver.onlyRequires = true</screen>
   <para>
    另外，請編輯檔案 <filename>/etc/zypp/zypper.conf</filename> 並變更 <option>installRecommends</option> 選項。
   </para>
   <screen>installRecommends=false</screen>
   <para>
    這會變更所有套件操作的行為，例如安裝修補程式或新套件。若要變更某次調用的 Zypper 行為，請使用 <option>--no-recommends</option> 參數。
  </para>
</note>

  <para>
   若要啟動 Service Pack 移轉，請執行以下操作：
  </para>

  <procedure xml:id="pro-upgrade-online-zypper">
   <step>
    <para>
     如果您已登入要更新的機器上的某個執行中 GNOME 工作階段，請切換到文字主控台。建議不要從 GNOME 工作階段執行更新。請注意，這並不適用於從遠端機器登入的情況 (除非您正在使用 GNOME 執行 VNC 工作階段)。
    </para>
   </step>
   <step>
    <para>
     若尚未註冊 SUSE Linux Enterprise 機器，請先進行註冊：
    </para>
<screen><prompt>&gt; </prompt><command>sudo</command> <command>SUSEConnect</command> --regcode <replaceable>YOUR_REGISTRATION_CODE</replaceable></screen>
   </step>
   
   <step>
    <para>
     開始移轉：
    </para>
<screen><prompt>&gt; </prompt><command>sudo</command> <command>zypper migration</command></screen>
    <para>
     有關移除過程的一些說明：
    </para>
    <itemizedlist>
     <listitem>
      <para>
       如果您的系統有多個可用的移轉目標，Zypper 允許您從清單中選取一個 SP。這與跳過一個或多個 SP 相同。請記住，基本產品 (SLES、SLED) 的線上移轉僅在主要版本的 SP 之間才仍然可用。
      </para>
     </listitem>
     <listitem>
      <para>
       依預設，Zypper 會使用 <option>--no-allow-vendor-change</option> 選項，以傳送到 <command>zypper</command> <option>dup</option>。如果某套件是從協力廠商儲存庫安裝的，此選項會阻止該套件取代為來自 SUSE 的相同套件。
      </para>
     </listitem>
     <listitem>
      <para>
       <remark>toms 2015-09-09: FATE#319140</remark>
       如果 Zypper 找到來自 DVD 或本地伺服器的過時儲存庫，強烈建議您將其停用。系統會自動移除舊的 SUSE Customer Center 或 RMT 儲存庫。
      </para>
     </listitem>
    </itemizedlist>
   </step>
   <step>
    <para>
     檢閱所有變更，特別是即將移除的套件。輸入 <literal>y</literal> (要升級之套件的確切數量因系統而異) 繼續：
    </para>
<screen>266 packages to upgrade, 54 to downgrade, 17 new, 8 to reinstall, 5 to remove, 1 to change arch.
Overall download size: 285.1 MiB. Already cached: 0 B  After the operation, additional 139.8 MiB will be used.
Continue? [y/n/? shows all options] (y):</screen>
    <para>
     使用 <keycombo> <keycap function="shift"/> <keycap function="pageup"/>
     </keycombo> 或 <keycombo> <keycap function="shift"/>
     <keycap function="pagedown"/> </keycombo> 鍵在外圍程序中捲動。
    </para>
   </step>
   <step>
    <para>
     成功移轉後，請重新啟動系統。
    </para>
   </step>
  </procedure>
 </sect1>
 <sect1 os="sles;sled" xml:id="sec-upgrade-online-zypper-plain">
  <title>使用 Plain Zypper 升級</title>

  <para>
   如果因無法存取網際網路或註冊伺服器而未能註冊您的系統，則無法使用 YaST 移轉或 <command>zypper migration</command> 移轉至新 Service Pack。在這種情況下，您仍可以透過普通 Zypper 和一些手動互動來移轉至新 Service Pack。
  </para>

  <important>
   <title>僅適用於未註冊的系統</title>
   <para>
    <emphasis>只有</emphasis>因無法存取網際網路或註冊伺服器而未能註冊的系統才支援透過此路徑移轉至新 Service Pack。例如，位於受特殊保護網路中的機器。如果已註冊您的系統，請使用 YaST 或 Zypper 移轉。
   </para>
  </important>

  <important>
   <title>安裝來源</title>
   <para>
    此移轉路徑要求您要移轉的系統有權存取安裝來源。例如，可以設定 RMT 伺服器或 SLP 伺服器來實現此目的。
   </para>
   <para>
    此外，系統還必須能夠存取所安裝產品版本的最新更新儲存庫。
   </para>
  </important>

  <procedure>
   <step>
    <para>
     如果您已登入要移轉機器上正在執行的圖形工作階段，請登出該工作階段，並切換到文字主控台。建議不要從圖形工作階段內執行更新。請注意，這並不適用於從遠端機器登入的情況 (除非您正在使用 X 執行 VNC 工作階段)。
    </para>
   </step>
   <step>
    <para>
     更新套件管理工具和 SUSE Linux Enterprise 舊儲存庫：
    </para>
<screen><prompt>&gt; </prompt><command>sudo</command> <command>zypper</command> patch --updatestack-only</screen>
   </step>
   <step>
    <para>
     獲取目前未指定儲存庫的套件 (孤立的套件) 清單。將不會移轉這些套件，且不保證移轉後它們可正常運作 (因為這些套件相依的其他套件可能發生了變更，與這些套件不再相容)。若要獲取該清單，請執行:
    </para>
<screen><prompt>&gt; </prompt><command>sudo</command> zypper packages --orphaned</screen>
    <para>
     仔細檢查該清單，移除所有不再需要的孤立套件。記下所有剩餘的孤立套件，稍後需要進行比較。
    </para>
   </step>
   <step>
    <para>
     執行以下指令，獲取系統目前已訂閱的所有儲存庫的清單：
    </para>
<screen><prompt>&gt; </prompt><command>sudo</command> zypper repos -u</screen>
    <para>
     更新每個儲存庫 URL，以使其產品版本號碼變為 <literal>15-SP4</literal>。例如，如果某個儲存庫的 URL 為
    </para>
<screen>http://rmt.example.com/repo/SUSE/Products/SLE-15-SP2-Product-SLES/x86_64/product/</screen>
    <para>
     請將其變為
    </para>
<screen>http://rmt.example.com/repo/SUSE/Products/SLE-15-SP3-Product-SLES/x86_64/product/</screen>
    <para>
     需要對已啟用的所有儲存庫執行此操作。同時請考慮對目前已停用的儲存庫執行此操作，以避免未來在啟用這些儲存庫時，系統中包含錯誤的安裝來源。
    </para>
    <para>
     若要變更儲存庫 URL，請採取以下做法：
    </para>
    <substeps>
     <step>
      <para>
       使用 <menuchoice> <guimenu>YaST</guimenu> <guimenu>軟體</guimenu>
       <guimenu>軟體儲存庫</guimenu></menuchoice>。選取一個儲存庫，然後按一下<guimenu>編輯</guimenu>以進行必要變更。針對所有儲存庫重複此程序。
      </para>
     </step>
     <step>
      <para>
       使用 Zypper.執行以下指令以移除舊儲存庫
      </para>
<screen><prompt>&gt; </prompt><command>sudo</command> zypper removerepo <replaceable>OLD_REPO_ID</replaceable></screen>
      <para>
       然後執行以下指令以新增相應的新儲存庫
      </para>
<screen> <prompt>&gt; </prompt><command>sudo</command> zypper addrepo -f <replaceable>URL</replaceable> <replaceable>NAME</replaceable>-15-SP4</screen>
     </step>
     <step>
      <para>
       編輯 <filename>/etc/zypp/repos.d</filename> 中的儲存庫組態檔案。每個儲存庫由一個組態檔案表示。必須在每個檔案中變更 <literal>baseurl</literal> 參數的值。
      </para>
     </step>
    </substeps>
   </step>
   <step>
    <para>
     執行 <command>zypper repos -u</command> 來檢查變更，然後執行以下指令來更新儲存庫：
    </para>
<screen><prompt>&gt; </prompt><command>sudo</command> zypper refresh -f -s</screen>
    <para>
     如果更新儲存庫失敗，請再次檢查是否輸入了錯誤的 URL。如果無法修復問題，建議停用失敗的儲存庫。
    </para>
    <para>
     如果正確設定了所有儲存庫，請再次執行
    </para>
<screen><prompt>&gt; </prompt><command>sudo</command> zypper refresh -f -s</screen>
    <para>
     ，以確定<emphasis>所有</emphasis>儲存庫都是最新的。
    </para>
   </step>
   <step>
    <para>
     在開始移轉之前，建議先執行測試執行：
    </para>
<screen><prompt>&gt; </prompt><command>sudo</command> zypper dup -D --no-allow-vendor-change --no-recommends</screen>
    <para>
     參數 <option>-D</option> 將進行試執行，即模擬移轉而不實際變更系統。如果出現問題，請先解決問題，然後再繼續。如果測試執行成功，請執行以下指令來執行實際移轉:
    </para>
<screen><prompt>&gt; </prompt><command>sudo</command> zypper dup --no-allow-vendor-change --no-recommends</screen>
    <para>
     <option>-no-allow-vendor-change</option> 確定協力廠商 RPM 不會覆寫基礎系統中的 RPM。<option>--no-recommends</option> 選項可確保在起始安裝期間取消選取的套件不會再次新增。
    </para>
   </step>
   <step>
    <para>
     移轉完成且系統已開機進入新的 Service Pack 版本後，請再次執行孤立套件檢查：
    </para>
<screen><prompt>&gt; </prompt><command>sudo</command> zypper packages --orphaned</screen>
    <para>
     將新清單與開始移轉之前產生的清單進行比較。如果清單中出現新套件，原因可能是這些套件已移到新 Service Pack 中的其他模組。如果之前的安裝中不包含該模組，則不會更新該套件。
    </para>
    <para>
     您可以在 <link xlink:href="https://scc.suse.com/packages"/> 上檢查套件所屬的模組。使用 <command>zypper addrepo</command> 或 YaST 軟體儲存庫模組新增缺失的模組，然後執行以下指令來更新孤立的套件：
    </para>
<screen><prompt>&gt; </prompt><command>sudo</command> zypper install --no-recommends <replaceable>LIST OF PACKAGES</replaceable></screen>
   </step>
   <step>
    <para>
     現已成功移轉至新 Service Pack！
    </para>
   </step>
  </procedure>
 </sect1>
 <sect1 os="sles;sled" xml:id="sec-upgrade-online-rollback">
  <title>復原 Service Pack</title>

  <para>
   如果 Service Pack 不適用於您，SUSE Linux Enterprise 支援將系統回復到開始 Service Pack 移轉之前的狀態。前提是對 Btrfs 根分割區啟用了快照 (從 SLES 12 開始，這是預設設定)。如需詳細資料，請參閱<xref linkend="cha-snapper"/>。
  </para>

  <procedure xml:id="pro-upgrade-online-rollback">
   <step>
    <para>
     取得所有 Snapper 快照的清單：
    </para>
<screen><prompt>&gt; </prompt><command>sudo</command> snapper list</screen>
    <para>
     檢閱輸出以找到在開始 Service Pack 移轉之前剛建立的快照。<guimenu>Description</guimenu> 欄包含相應的說明，<guimenu>Userdata</guimenu> 欄中會將該快照標示為 <literal>important</literal>。記住 <guimenu>#</guimenu> 欄中的快照編號，以及 <guimenu>Date</guimenu> 欄中該快照的日期。
    </para>
   </step>
   <step>
    <para>
     重新啟動系統。從開機功能表中選取<guimenu>從唯讀快照啟動開機載入程式</guimenu>，然後選擇上一步中記下的日期和編號所對應的快照。此時會載入第二個開機功能表 (快照中的那個)。選取以 SLES <phrase role="productnumber"><phrase os="sles;sled">15 SP4</phrase></phrase> 開頭的項目並將其開機。
    </para>
   </step>
   <step>
    <para>
     系統會開機進入先前的狀態，並且系統磁碟分割區會以唯讀方式掛接。以 <systemitem class="username">root</systemitem> 身分登入，並檢查您是否選擇了正確的快照。此外，請確認一切如常。請注意，由於根檔案系統以唯讀方式掛接，因此功能可能受限。
    </para>
    <para>
     如果出現問題，或者開機的快照不正確，請重新開機並選擇從另一個快照開機 — 到此為止，系統尚未進行任何永久變更。如果快照正確並且依預期運作，請執行以下指令使變更永久生效：
    </para>
<screen><prompt>&gt; </prompt><command>sudo</command> snapper rollback</screen>
    <para>
     將機器重新開機。在開機螢幕上，選擇預設開機項目以重新開機到已恢復的系統。
    </para>
   </step>
   <step>
    <para>
     檢查是否已正確重設儲存庫組態。此外，檢查是否所有產品均已正確註冊。如果以上任何一項不正確，則稍後可能無法再有效地執行系統更新，或者可能會使用錯誤的套件儲存庫更新系統。
    </para>
    <para>
     請先確認系統可以存取網際網路，再開始此程序。
    </para>
    <substeps>
     <step>
      <para>
       執行以下指令以重新整理服務和儲存庫：
      </para>
<screen><prompt>&gt; </prompt><command>sudo</command> zypper ref -fs</screen>
     </step>
     <step>
      <para>
       執行以下指令以獲得使用中儲存庫的清單：
      </para>
<screen><prompt>&gt; </prompt><command>sudo</command> zypper lr</screen>
      <para>
       仔細檢查此指令的輸出。為該次更新新增的服務和儲存庫不應包含在清單中。例如，如果您是從 SLES <phrase role="productnumber"><phrase os="sles;sled">15 SP4</phrase></phrase> 復原到 SLES15 GA，則清單中必須包含 <literal>SLES15-GA</literal> 儲存庫，而不包含 <literal>SLES15-SP4</literal> 儲存庫。
      </para>
      <para>
       如有錯誤的儲存庫列出，請將其刪除，必要時，請用與您的產品或 Service Pack 版本相符的版本取代它們。如需受支援移轉路徑的儲存庫清單，請參閱<xref linkend="sec-upgrade-background-modules"/>。(請注意，沒有必要手動介入，因為儲存庫會自動更新，但最好進行驗證並完成所有必要的修正。)
      </para>
     </step>
     <step>
      <para>
       最後，透過執行以下指令檢查所有已安裝產品的註冊狀態：
      </para>
<screen><prompt>&gt; </prompt><command>sudo</command> SUSEConnect --status</screen>
      <para>
       所有產品都應該報告為<literal>已註冊</literal>。若非如此，請執行以下指令以修復註冊：
      </para>
<screen><prompt>&gt; </prompt><command>sudo</command> SUSEConnect --rollback</screen>
     </step>
    </substeps>
   </step>
  </procedure>

  <para>
   現在，您已成功將系統回復到就在開始 Service Pack 移轉之前擷取的狀態。
  </para>
 </sect1>
 <sect1 os="sles;sled" xml:id="sec-upgrade-online-manager">
  <title>使用 SUSE Manager 升級</title>

  <para>
   SUSE Manager 是一個伺服器解決方案，用於提供適用於 SUSE Linux Enterprise 用戶端的更新、修補程式和安全性修正程式。它隨附一組工具和一個 Web 式使用者介面，用於執行管理任務。如需 SUSE Manager 的詳細資訊，請參閱<link xlink:href="https://www.suse.com/products/suse-manager/"/>。
  </para>

  <para>
   SP 移轉允許從某個 Service Pack (SP) 移轉至同一主要版本中的另一個 Service Pack (例如，從 SLES 15 GA 移轉至 SLES 15 SP4)。
  </para>

  
  <para>
  如果您的機器由 SUSE Manager 管理，請依據 SUSE Manager 文件所述更新機器。<link xlink:href="https://documentation.suse.com/suma/"/> 上的《<citetitle>SUSE Manager Upgrade Guide</citetitle>》(SUSE Manager 升級指南) 中介紹了<citetitle>用戶端移轉</citetitle>程序。
 </para>
 </sect1>
 <sect1 xml:id="sec-upgrade-online-leap-to-sle" os="sles">
  <title>從 openSUSE Leap 升級至 <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase></title>

  <para>
   您可以將 openSUSE Leap 安裝升級至 <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase>。升級程序與<xref linkend="sec-upgrade-online-yast"/>類似，但需要執行一些額外的步驟。在生產系統上執行此程序之前，建議您先在複製了生產系統設定的測試系統上執行此程序。
  </para>

  <para>
   若要瞭解哪些 openSUSE Leap 版本支援移轉，請參閱<xref linkend="sec-upgrade-paths-supported"/>。
  </para>

  <remark>cwickert 2012-02-25: For openSUSE Leap 15.3 and SLE 15 SP3, removing
   packages should not be necessary. Everything should be provided through
   Package Hub. For SP2 and earlier however, orphaned packages should be
   removed.</remark>

  <warning>
   <title>並非所有 openSUSE 套件都可移轉</title>
   <para>
    openSUSE 提供的套件比 <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> 的要多。大多數額外的套件都可透過 SUSE Package Hub 獲得並且將會移轉。任何無法透過 SUSE Package Hub 獲得的額外套件在移轉後都不會再接收更新，因此應在移轉後將其移除。
   </para>
   <para>
    請確定 <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> 和 SUSE Package Hub 儲存庫中提供了運作系統所需的全部套件。如需 SUSE Package Hub 的詳細資訊，請參閱<link xlink:href="https://packagehub.suse.com/"/>。
   </para>
  </warning>

  <procedure xml:id="pro-upgrade-online-leap-to-sle">
   <title>將 openSUSE Leap 升級至 <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase></title>
   <para>
    若要從 openSUSE Leap 移轉至 <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase>，請執行以下步驟：
   </para>
   <step>
    <para>
     切換到 TTY，例如，按 <keycombo><keycap function="control"/>
     <keycap function="alt"/><keycap>F1</keycap></keycombo> 鍵切換。然後以 <systemitem class="username">root</systemitem> 身分登入。
    </para>
   </step>
   <step>
    <para>
     安裝 <package>yast2-registration</package> 和 <package>rollback-helper</package> 套件。
    </para>
<screen><prompt role="root"># </prompt><command>zypper in yast2-registration rollback-helper</command></screen>
   </step>
   
   <step>
    <para>
     啟用 <systemitem class="service">rollback-helper</systemitem> 服務：
    </para>
<screen><prompt role="root"># </prompt><command>systemctl enable rollback</command></screen>
   </step>
   <step>
    <para>
     在 SUSE Customer Center 中註冊系統：
    </para>
<screen><prompt role="root"># </prompt><command>yast2 registration</command></screen>
   </step>
   <step>
    <para>
     執行移轉：
    </para>
<screen><prompt role="root"># </prompt><command>yast2 migration</command></screen>
    <para>
     如果發生套件衝突，YaST 提供了一個可供選擇的解決方案清單。
    </para>
   </step>
   <step>
    <para>
     移除孤立的套件：
    </para>
<screen><prompt role="root"># </prompt><command>zypper rm $(zypper --no-refresh packages --orphaned | gawk '{print $5}' | tail -n +5)</command></screen>
   </step>
   <step>
    <para>
     將系統重新開機。
    </para>
<screen><prompt role="root"># </prompt><command>reboot</command></screen>
   </step>
  </procedure>

  <para>
   現在，您已成功將系統移轉至 <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase>。
  </para>

  <para>
   如果您在移轉後遇到問題，可以如同升級 Service Pack 一樣回復移轉。如需指示，請參閱<xref linkend="sec-upgrade-online-rollback"/>。
  </para>
 </sect1>
</chapter>
