<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE chapter PUBLIC "-//Novell//DTD NovDoc XML V1.0//EN" "novdocx.dtd"
[
  <!ENTITY % NOVDOC.DEACTIVATE.IDREF "INCLUDE">
  <!ENTITY % entities SYSTEM "entity-decl.ent">
  %entities;
]>
<chapter id="cha.deployment.autoinst" os="sled;sles">
 <title>Automated Installation</title>
 <para>
  &ay; allows you to install &slereg; on a large number of machines in
  parallel. The &ay; technology offers great flexibility to adjust
  deployments to heterogeneous hardware. This chapter tells you how to
  prepare a simple automated installation and lay out an advanced scenario
  involving different hardware types and installation purposes.
 </para>
 <sect1 id="sec.deployment.autoinst.simple">
  <title>Simple Mass Installation</title>

  <important>
   <title>Identical Hardware</title>
   <para>
    This scenario assumes you are rolling out &sle; to a set of machines
    with exactly the same hardware configuration.
   </para>
  </important>

  <para>
   To prepare for an &ay; mass installation, proceed as follows:
  </para>

  <procedure>
   <step>
    <para>
     Create an &ay; profile that contains the installation details needed
     for your deployment as described in
     <xref linkend="sec.deployment.autoinst.simple.profile"/>.
    </para>
   </step>
   <step>
    <para>
     Determine the source of the &ay; profile and the parameter to pass to
     the installation routines as described in
     <xref linkend="sec.deployment.autoinst.simple.dist"/>.
    </para>
   </step>
   <step>
    <para>
     Determine the source of the &sle; installation data as described in
     <xref
      linkend="sec.deployment.autoinst.simple.source"/>.
    </para>
   </step>
   <step>
    <para>
     Determine and set up the boot scenario for autoinstallation as
     described in
     <xref
      linkend="sec.deployment.autoinst.simple.boot"/>.
    </para>
   </step>
   <step>
    <para>
     Pass the command line to the installation routines by adding the
     parameters manually or by creating an <filename>info</filename> file as
     described in
     <xref
      linkend="sec.deployment.autoinst.simple.info"/>.
    </para>
   </step>
   <step>
    <para>
     Start the autoinstallation process as described in
     <xref
      linkend="sec.deployment.autoinst.simple.install"/>.
    </para>
   </step>
  </procedure>

  <sect2 id="sec.deployment.autoinst.simple.profile">
   <title>Creating an &ay; Profile</title>
   <para>
    An &ay; profile tells &ay; what to install and how to configure the
    installed system to get a completely ready-to-use system in the end. It
    can be created in several different ways:
   </para>
   <itemizedlist>
    <listitem>
     <para>
      Clone a fresh installation from a reference machine to a set of
      identical machines
     </para>
    </listitem>
    <listitem>
     <para>
      Use the &ay; GUI to create and modify a profile to meet your
      requirements
     </para>
    </listitem>
    <listitem>
     <para>
      Use an XML editor and create a profile from scratch
     </para>
    </listitem>
   </itemizedlist>
   <para>
    To clone a fresh reference installation, proceed as follows:
   </para>
   <procedure>
    <step>
     <para>
      Perform a normal installation.
     </para>
    </step>
    <step>
     <para>
      After you complete the hardware configuration and read the release
      notes, check <guimenu>Clone This System for &ay;</guimenu>, if it is
      not yet checked by default. This creates a ready-to-use profile as
      <filename>/root/autoyast.xml</filename> that can be used to create
      clones of this particular installation.
     </para>
    </step>
   </procedure>
   <para>
    To use the &ay; GUI to create a profile from an existing system
    configuration and modify it to your needs, proceed as follows:
   </para>
   <procedure>
    <step>
     <para>
      As &rootuser;, start &yast;.
     </para>
    </step>
    <step>
     <para>
      Select <menuchoice> <guimenu>Miscellaneous</guimenu>
      <guimenu>Autoinstallation</guimenu> </menuchoice> to start the
      graphical &ay; front-end.
     </para>
    </step>
    <step>
     <para>
      Select <menuchoice> <guimenu>Tools</guimenu> <guimenu>Create Reference
      Profile</guimenu> </menuchoice> to prepare &ay; to mirror the current
      system configuration into an &ay; profile.
     </para>
    </step>
    <step>
     <para>
      As well as the default resources (like boot loader, partitioning, and
      software selection), you can add various other aspects of your system
      to the profile by checking the items in the list in <guimenu>Create a
      Reference Control File</guimenu>.
     </para>
    </step>
    <step>
     <para>
      Click <guimenu>Create</guimenu> to have &yast; gather all the system
      information and write it to a new profile.
     </para>
    </step>
    <step>
     <para>
      To proceed, choose one of the following:
     </para>
     <itemizedlist>
      <listitem>
       <para>
        If the profile is complete and matches your requirements, select
        <menuchoice> <guimenu>File</guimenu> <guimenu>Save as</guimenu>
        </menuchoice> and enter a filename for the profile, such as
        <filename>autoyast.xml</filename>.
       </para>
      </listitem>
      <listitem>
       <para>
        Modify the reference profile by selecting the appropriate
        configuration aspects (such as <quote>Hardware/Printer</quote>) from
        the tree view to the left and clicking <guimenu>Configure</guimenu>.
        The respective &yast; module starts but your settings are written to
        the &ay; profile instead of applied to your system. When done,
        select <menuchoice> <guimenu>File</guimenu> <guimenu>Save
        as</guimenu> </menuchoice> and enter a suitable name for the
        profile.
       </para>
      </listitem>
     </itemizedlist>
    </step>
    <step>
     <para>
      Leave the &ay; module with <menuchoice> <guimenu>File</guimenu>
      <guimenu>Exit</guimenu> </menuchoice>.
     </para>
    </step>
   </procedure>
   <figure>
    <title>Editing an &ay; Profile with the &ay; Front-End</title>
    <mediaobject>
     <imageobject role="fo">
      <imagedata fileref="autoyast_gui.png" width="75%" format="PNG"/>
     </imageobject>
     <imageobject role="html">
      <imagedata fileref="autoyast_gui.png" width="75%" format="PNG"/>
     </imageobject>
    </mediaobject>
   </figure>
  </sect2>

  <sect2 id="sec.deployment.autoinst.simple.dist">
   <title>Distributing the Profile and Determining the autoyast Parameter</title>
   <para>
    The &ay; profile can be distributed in several different ways. Depending
    on the protocol used to distribute the profile data, different &ay;
    parameters are used to make the profile location known to the
    installation routines on the client. The location of the profile is
    passed to the installation routines by means of the boot prompt or an
    <filename>info</filename> file that is loaded upon boot. The following
    options are available:
   </para>
   <informaltable>
    <tgroup cols="3">
     <thead>
      <row>
       <entry>
        <para>
         Profile Location
        </para>
       </entry>
       <entry>
        <para>
         Parameter
        </para>
       </entry>
       <entry>
        <para>
         Description
        </para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row>
       <entry>
        <para>
         File
        </para>
       </entry>
       <entry>
        <para>
         <filename>autoyast=file://<replaceable>path</replaceable></filename>
        </para>
       </entry>
       <entry>
        <para>
         Makes the installation routines look for the control file in the
         specified path (relative to source root
         directory&mdash;<filename>file:///autoyast.xml</filename> if in the
         top directory of a CD-ROM).
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         Device
        </para>
       </entry>
       <entry>
        <para>
         <filename>autoyast=device://<replaceable>path</replaceable></filename>
        </para>
       </entry>
       <entry>
        <para>
         Makes the installation routines look for the control file on a
         storage device. Only the device name is
         needed&mdash;<filename>/dev/sda1</filename> is wrong, use
         <filename>sda1</filename> instead.
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         NFS
        </para>
       </entry>
       <entry>
        <para>
<!--adjust to standard network example-->
         <filename>autoyast=nfs://<replaceable>server</replaceable>/<replaceable>path</replaceable></filename>
        </para>
       </entry>
       <entry>
        <para>
         Has the installation routines retrieve the control file from an NFS
         server.
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         HTTP
        </para>
       </entry>
       <entry>
        <para>
<!--adjust to standard network example-->
         <filename>autoyast=http://<replaceable>server</replaceable>/<replaceable>path</replaceable></filename>
        </para>
       </entry>
       <entry>
        <para>
         Has the installation routines retrieve the control file from an
         HTTP server.
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         HTTPS
        </para>
       </entry>
       <entry>
        <para>
<!--adjust to standard network example-->
         <filename>autoyast=https://<replaceable>server</replaceable>/<replaceable>path</replaceable></filename>
        </para>
       </entry>
       <entry>
        <para>
         Has the installation routines retrieve the control file from an
         HTTPS server.
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         TFTP
        </para>
       </entry>
       <entry>
        <para>
<!--adjust to standard network example-->
         <filename>autoyast=tftp://<replaceable>server</replaceable>/<replaceable>path</replaceable></filename>
        </para>
       </entry>
       <entry>
        <para>
         Has the installation routines retrieve the control file from a TFTP
         server.
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         FTP
        </para>
       </entry>
       <entry>
        <para>
<!--adjust to standard network example-->
         <filename>autoyast=ftp://<replaceable>server</replaceable>/<replaceable>path</replaceable></filename>
        </para>
       </entry>
       <entry>
        <para>
         Has the installation routines retrieve the control file from an FTP
         server.
        </para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
   <para>
    Replace the <replaceable>server</replaceable> and
    <replaceable>path</replaceable> placeholders with values matching your
    actual setup.
   </para>
   <para>
    &ay; includes a feature that allows the binding of certain profiles to
    the client's MAC address. Without having to alter the
    <option>autoyast=</option> parameter, you can have the same setup
    install several different instances using different profiles.
   </para>
   <para>
    To use this, proceed as follows:
   </para>
   <procedure>
    <step>
     <para>
      Create separate profiles with the MAC address of the client as the
      filename and put them on the HTTP server that holds your &ay;
      profiles.
     </para>
    </step>
    <step>
     <para>
      Omit the exact path including the filename when creating the
      <option>autoyast=</option> parameter, for example:
     </para>
<screen>autoyast=tftp://192.168.1.115/</screen>
    </step>
    <step>
     <para>
      Start the autoinstallation.
     </para>
    </step>
   </procedure>
   <para>
    &yast; tries to determine the location of the profile in the following
    way:
   </para>
   <orderedlist>
    <listitem>
     <para>
      &yast; searches for the profile using its own IP address in uppercase
      hexadecimal, for example, <literal>192.0.2.91</literal> is
      <literal>C000025B</literal>.
     </para>
    </listitem>
    <listitem>
     <para>
      If this file is not found, &yast; removes one hex digit and tries
      again. This action is repeated eight times until the file with the
      correct name is found.
     </para>
    </listitem>
    <listitem>
     <para>
      If that still fails, it tries locating a file with the MAC address of
      the clients as the filename. The MAC address of the example client is
      <literal>0080C8F6484C</literal>.
     </para>
    </listitem>
    <listitem>
     <para>
      If the MAC address&ndash;named file cannot be found, &yast; searches
      for a file named <filename>default</filename> (in lowercase). An
      example sequence of addresses where &yast; searches for the &ay;
      profile looks as follows:
     </para>
<screen>
C000025B 
C000025 
C00002 
C0000 
C000 
C00 
C0 
C 
0080C8F6484C 
default
     </screen>
    </listitem>
   </orderedlist>
  </sect2>

  <sect2 id="sec.deployment.autoinst.simple.source">
   <title>Providing the Installation Data</title>
   <para>
    The installation data can be provided by means of the product CDs or
    DVDs or using a network installation source. If the product CDs are used
    as the installation source, physical access to the client to be
    installed is needed, because the boot process needs to be initiated
    manually and the CDs need to be changed.
   </para>
   <para>
    To provide the installation sources over the network, set up a network
    installation server (HTTP, NFS, FTP) as described in
    <xref linkend="sec.deployment.remoteinst.instserver.sles9"/>. Use an
    <filename>info</filename> file to pass the server's location to the
    installation routines.
   </para>
  </sect2>

  <sect2 id="sec.deployment.autoinst.simple.boot">
   <title>Setting Up the Boot Scenario</title>
   <para>
    The client can be booted in several different ways:
   </para>
   <variablelist>
    <varlistentry>
     <term>Network Boot</term>
     <listitem>
      <para>
       As with a normal remote installation, autoinstallation can be
       initiated with Wake on LAN and PXE, the boot image and control file
       can be pulled in via TFTP, and the installation sources from any
       network installation server.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>Bootable CD-ROM</term>
     <listitem>
      <para>
       You can use the original &sle; media to boot the system for
       autoinstallation and pull in the control file from a network location
       or a removable media. Alternately, create your own custom CD-ROM
       holding both the installation sources and the &ay; profile.
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
   <para>
    The following sections provide a basic outline of the procedures for
    network boot or boot from CD-ROM.
   </para>
   <sect3 id="sec.deployment.autoinst.simple.boot.pxe">
    <title>Preparing for Network Boot</title>
    <para>
     Network booting with Wake on LAN, PXE, and TFTP is discussed in
     <xref
      linkend="sec.deployment.remoteinst.scenario.vncpxe"/>. To
     make the setup introduced there work for autoinstallation, modify the
     featured PXE Linux configuration file
     (<filename>/srv/tftp/pxelinux.cfg/default</filename>) to contain the
     <literal>autoyast</literal> parameter pointing to the location of the
     &ay; profile. An example entry for a standard installation looks like
     this:
    </para>
<screen>
default linux 

# default label linux 
    kernel linux
    append initrd=initrd install=http://192.168.1.115/install/suse-enterprise/ 
	  
	</screen>
    <para>
     The same example for autoinstallation looks like this:
    </para>
<screen>
default linux 

# default label linux 
    kernel linux
    append initrd=initrd install=http://192.168.1.115/install/suse-enterprise/ \
           autoyast=nfs://192.168.1.110/profiles/autoyast.xml
	</screen>
    <para>
     Replace the example IP addresses and paths with the data used in your
     setup.
    </para>
   </sect3>
   <sect3 id="sec.deployment.autoinst.simple.boot.cd">
    <title>Preparing to Boot from CD-ROM</title>
    <para>
     There are several ways in which booting from CD-ROM can come into play
     in &ay; installations. Choose from the following scenarios:
    </para>
    <variablelist>
     <varlistentry>
      <term>Boot from &sle; Media, Get the Profile over the Network</term>
      <listitem>
       <para>
        Use this approach if a totally network-based scenario is not
        possible (for example, if your hardware does not support PXE) and
        you have physical access to system to install during most of the
        process.
       </para>
       <para>
        You need:
       </para>
       <itemizedlist>
        <listitem>
         <para>
          The &sle; media
         </para>
        </listitem>
        <listitem>
         <para>
          A network server providing the profile data (see
          <xref
           linkend="sec.deployment.autoinst.simple.dist"/>
          for details)
         </para>
        </listitem>
        <listitem>
         <para>
          A removable media containing the <filename>info</filename> file that
          tells the installation routines where to find the profile
         </para>
         <para>
          <emphasis>or</emphasis>
         </para>
         <para>
          Access to the boot prompt of the system to install where you
          manually enter the <literal>autoyast=</literal> parameter
         </para>
        </listitem>
       </itemizedlist>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term> Boot and Install from &sle; Media, Get the Profile from a
      Removable Media</term>
      <listitem>
       <para>
        Use this approach if an entirely network-based installation scenario
        would not work. It requires physical access to the system to be
        installed for turning on the target machine, or, in the second case,
        to enter the profile's location at the boot prompt. In both cases,
        you may also need to change media depending on the scope of
        installation.
       </para>
       <para>
        You need:
       </para>
       <itemizedlist>
        <listitem>
         <para>
          The &sle; media
         </para>
        </listitem>
        <listitem>
         <para>
          A removable media holding both the profile and the
          <filename>info</filename> file
         </para>
         <para>
          <emphasis>or</emphasis>
         </para>
         <para>
          Access to the boot prompt of the target to enter the
          <option>autoyast=</option> parameter
         </para>
        </listitem>
       </itemizedlist>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>Boot and Install from Custom Media, Get the Profile from the Media</term>
      <listitem>
       <para>
        If you need to install a limited number of software packages
        and the number of targets is relatively low, creating your own
        custom CD holding both the installation data and the profile itself
        might prove a good idea, especially if no network is available in
        your setup.
       </para>
      </listitem>
     </varlistentry>
    </variablelist>
   </sect3>
  </sect2>

  <sect2 id="sec.deployment.autoinst.simple.info">
   <title>Creating the <filename>info</filename> File</title>
   <para>
    The installation routines at the target need to be made aware of all the
    different components of the &ay; framework. This is done by creating a
    command line containing all the parameters needed to locate the &ay;
    components, installation sources, and the parameters needed to control
    the installation process.
   </para>
   <para>
    Do this by manually passing these parameters at the boot prompt of the
    installation or by providing a file called <filename>info</filename>
    that is read by the installation routines (linuxrc). The former requires
    physical access to any client to install, which makes this approach
    unsuitable for large deployments. The latter enables you to provide the
    <filename>info</filename> file on some media that is prepared and
    inserted into the clients' drives prior to the autoinstallation.
    Alternatively, use PXE boot and include the linuxrc parameters in the
    <filename>pxelinux.cfg/default</filename> file as shown in
    <xref
     linkend="sec.deployment.autoinst.simple.boot.pxe"/>.
   </para>
   <para>
    The following parameters are commonly used for linuxrc. For more
    information, refer to the &ay; package documentation under
    <filename>/usr/share/doc/packages/autoyast</filename>.
   </para>
   <important>
    <title>Separating Parameters and Values</title>
    <para>
     When passing parameters to linuxrc at the boot prompt, use
     <literal>=</literal> to separate parameter and value. When using an
     <filename>info</filename> file, separate parameter and value with
     <literal>:</literal>.
    </para>
   </important>
   <informaltable>
    <tgroup cols="2">
     <thead>
      <row>
       <entry>
        <para>
         Keyword
        </para>
       </entry>
       <entry>
        <para>
         Value
        </para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row>
       <entry>
        <para>
         <literal>netdevice</literal>
        </para>
       </entry>
       <entry>
        <para>
         The network device to use for network setup (for BOOTP/DHCP
         requests). Only needed if several network devices are available.
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <literal>hostip</literal>
        </para>
       </entry>
       <entry>
        <para>
         When empty, the client sends a BOOTP request. Otherwise the client
         is configured using the specified data.
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <literal>netmask</literal>
        </para>
       </entry>
       <entry>
        <para>
         Netmask for the selected network.
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <literal>gateway</literal>
        </para>
       </entry>
       <entry>
        <para>
         Default gateway.
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <literal>nameserver</literal>
        </para>
       </entry>
       <entry>
        <para>
         Name server.
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <literal>autoyast</literal>
        </para>
       </entry>
       <entry>
        <para>
         Location of the the control file to use for the automatic
         installation, such as
         <literal>autoyast=nfs//&nfsip;/profiles/</literal>.
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <literal>install</literal>
        </para>
       </entry>
       <entry>
        <para>
         Location of the installation source, such as
         <literal>install=nfs://&nfsip;/CDs/</literal>.
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <literal>vnc</literal>
        </para>
       </entry>
       <entry>
        <para>
         If set to <literal>1</literal>, enables VNC remote controlled
         installation.
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <literal>vncpassword</literal>
        </para>
       </entry>
       <entry>
        <para>
         The password for VNC.
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <literal>usessh</literal>
        </para>
       </entry>
       <entry>
        <para>
         If set to <literal>1</literal>, enables SSH remote controlled
         installation.
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <literal>netsetup</literal>
        </para>
       </entry>
       <entry>
        <para>
         If set to <literal>1</literal>, sets up the network. Normally this
         is done automatically, but you need to set
         <literal>netsetup=1</literal> in case the installation repository
         is provided locally (e.g. via DVD or local iso image) and the
         <filename>info</filename> file is loaded from the network.
        </para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
   <para>
    If your autoinstallation scenario involves client configuration via DHCP
    and a network installation source, and you want to monitor the
    installation process using VNC, your <filename>info</filename> would
    look like this:
   </para>
<screen>autoyast:<replaceable>profile_source</replaceable> install:<replaceable>install_source</replaceable> vnc:1 vncpassword:<replaceable>some_password</replaceable></screen>
   <para>
    If you prefer a static network setup at installation time, your
    <filename>info</filename> file would look like the following:
   </para>
<screen>
autoyast:<replaceable>profile_source</replaceable> \
install:<replaceable>install_source</replaceable> \ 
hostip:<replaceable>some_ip</replaceable> \ 
netmask:<replaceable>some_netmask</replaceable> \ 
gateway:<replaceable>some_gateway</replaceable></screen>
   <para>
    The <literal>\</literal> indicates that the line breaks have only been
    added for the sake of readability. All options must be entered as one
    continuous string.
   </para>
   <para>
    The <filename>info</filename> data can be made available to linuxrc in
    various different ways:
   </para>
   <itemizedlist>
    <listitem>
     <para>
      As a file on a removable media that is available on the client at
      installation time. Add the info parameter similar to
      <systemitem>info=cd:/info</systemitem>.
     </para>
    </listitem>
    <listitem>
     <para>
      As a file in the root directory of the initial RAM disk used for
      booting the system provided either from custom installation media or
      via PXE boot.
     </para>
    </listitem>
    <listitem>
     <para>
      As part of the &ay; profile. In this case, the &ay; file needs to be
      called <filename>info</filename> to enable linuxrc to parse it. An
      example for this approach is given below.
     </para>
    </listitem>
    <listitem>
     <para>
      By means of an URL that points to the location of the info file. The
      syntax for this looks like
      <systemitem>info=http://&wwwname;/info</systemitem>.
     </para>
    </listitem>
   </itemizedlist>
   <para>
    linuxrc looks for a string (<option>start_linuxrc_conf</option>) in the
    profile that represents the beginning of the file. If it is found, it
    parses the content starting from that string and finishes when the
    string <option>end_linuxrc_conf</option> is found. The options are
    stored in the profile as follows:
   </para>
<screen>....
  &lt;install>
....
    &lt;init>
      &lt;info_file>
&lt;![CDATA[
#
# Don't remove the following line:
# start_linuxrc_conf
#
install: nfs:<replaceable>server</replaceable>/<replaceable>path</replaceable>
vnc: 1
vncpassword: test
autoyast: file:///info

# end_linuxrc_conf
# Do not remove the above comment
#
&rsqb;]&gt;

      &lt;/info_file>
    &lt;/init>
......
  &lt;/install>
....
</screen>
   <para>
    linuxrc loads the profile containing the boot parameters instead of the
    traditional <filename>info</filename> file. The
    <option>install:</option> parameter points to the location of the
    installation sources. <option>vnc</option> and
    <option>vncpassword</option> indicate the use of VNC for installation
    monitoring. The <option>autoyast</option> parameter tells linuxrc to
    treat <filename>info</filename> as an &ay; profile.
   </para>
  </sect2>

  <sect2 id="sec.deployment.autoinst.simple.install">
   <title>Initiating and Monitoring the Autoinstallation</title>
   <para>
    After you have provided all the infrastructure mentioned above (profile,
    installation source, and <filename>info</filename> file), you can go
    ahead and start the autoinstallation. Depending on the scenario chosen
    for booting and monitoring the process, physical interaction with the
    client may be needed:
   </para>
   <itemizedlist>
    <listitem>
     <para>
      If the client system boots from any kind of physical media, either
      product media or custom CDs, you need to insert these into the
      client's drives.
     </para>
    </listitem>
    <listitem>
     <para>
      If the client is not switched on via Wake on LAN, you need to at least
      switch on the client machine.
     </para>
    </listitem>
    <listitem>
     <para>
      If you have not opted for remote controlled autoinstallation, the
      graphical feedback from &ay; is sent to the client's attached monitor
      or, if you use a headless client, to a serial console.
     </para>
    </listitem>
   </itemizedlist>
   <para>
    To enable remote controlled autoinstallation, use the VNC or SSH
    parameters described in
    <xref linkend="sec.deployment.autoinst.simple.info"/> and connect to the
    client from another machine as described in
    <xref linkend="sec.deployment.remoteinst.monitor"/>.
   </para>
  </sect2>
 </sect1>
 <sect1 id="sec.deployment.autoinst.advanced">
  <title>Rule-Based Autoinstallation</title>

  <para>
   The following sections introduce the basic concept of rule-based
   installation using &ay; and provide an example scenario that enables you
   to create your own custom autoinstallation setup.
  </para>

  <sect2 id="sec.deployment.autoinst.advanced.expl">
   <title>Understanding Rule-Based Autoinstallation</title>
   <para>
    Rule-based &ay; installation allows you to cope with heterogeneous
    hardware environments:
   </para>
   <itemizedlist>
    <listitem>
     <para>
      Does your site contain hardware of different vendors?
     </para>
    </listitem>
    <listitem>
     <para>
      Are the machines on your site of different hardware configuration (for
      example, using different devices or using different memory and disk
      sizes)?
     </para>
    </listitem>
    <listitem>
     <para>
      Do you intend to install across different domains and need to
      distinguish between them?
     </para>
    </listitem>
   </itemizedlist>
   <para>
    Rule-based autoinstallation starts with generating a custom
    profile to match a heterogeneous scenario by merging several profiles
    into one. Each rule describes one particular distinctive feature of your
    setup (such as disk size) and tells &ay; which profile to use when the
    rule matches. Several rules describing different features of your setup
    are combined in an &ay; <filename>rules.xml</filename> file. The rule
    stack is then processed and &ay; generates the final profile by merging
    the different profiles matching the &ay; rules into one. To illustrate
    this procedure, refer to
    <xref linkend="sec.deployment.autoinst.advanced.example"/>.
   </para>
   <para>
    Rule-based &ay; offers you great flexibility in planning and executing
    your &sle; deployment. You can:
   </para>
   <itemizedlist>
    <listitem>
     <para>
      Create rules for matching any of the predefined system attributes in
      &ay;
     </para>
    </listitem>
    <listitem>
     <para>
      Combine multiple system attributes (such as disk size and kernel
      architecture) into one rule by using logical operators
     </para>
    </listitem>
    <listitem>
     <para>
      Create custom rules by running shell scripts and passing their output
      to the &ay; framework. The number of custom rules is limited to five.
     </para>
    </listitem>
   </itemizedlist>
   <note>
    <para>
     For more information about rule creation and usage with &ay;, refer to
     the package's documentation under
     <filename>/usr/share/doc/packages/autoyast2/html/index.html</filename>,
     Chapter <guimenu>Rules and Classes</guimenu>.
    </para>
   </note>
   <para>
    To prepare for a rule-based &ay; mass installation, proceed as follows:
   </para>
   <procedure>
    <step>
     <para>
      Create several &ay; profiles that contain the installation details
      needed for your heterogeneous setup as described in
      <xref linkend="sec.deployment.autoinst.simple.profile"/>.
     </para>
    </step>
    <step>
     <para>
      Define rules to match the system attributes of your hardware setup as
      shown in
      <xref
       linkend="sec.deployment.autoinst.advanced.example"/>.
     </para>
    </step>
    <step>
     <para>
      Determine the source of the &ay; profile and the parameter to pass to
      the installation routines as described in
      <xref linkend="sec.deployment.autoinst.simple.dist"/>.
     </para>
    </step>
    <step>
     <para>
      Determine the source of the &sle; installation data as described in
      <xref
       linkend="sec.deployment.autoinst.simple.source"/>.
     </para>
    </step>
    <step>
     <para>
      Pass the command line to the installation routines by adding the
      parameters manually or by creating an <filename>info</filename> file
      as described in
      <xref
       linkend="sec.deployment.autoinst.simple.info"/>.
     </para>
    </step>
    <step>
     <para>
      Determine and set up the boot scenario for autoinstallation as
      described in
      <xref
       linkend="sec.deployment.autoinst.simple.boot"/>.
     </para>
    </step>
    <step>
     <para>
      Start the autoinstallation process as described in
      <xref
       linkend="sec.deployment.autoinst.simple.install"/>.
     </para>
    </step>
   </procedure>
  </sect2>

  <sect2 id="sec.deployment.autoinst.advanced.example">
   <title>Example Scenario for Rule-Based Autoinstallation</title>
   <para>
    To get a basic understanding of how rules are created, think of the
    following example, depicted in <xref linkend="fig.autoyast.rules"/>. One
    run of &ay; installs the following setup:
   </para>
   <variablelist>
    <varlistentry>
     <term>A Print Server</term>
     <listitem>
      <para>
       This machine just needs a minimal installation without a desktop
       environment and a limited set of software packages.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>Workstations in the Engineering Department</term>
     <listitem>
      <para>
       These machines need a desktop environment and a broad set of
       development software.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>Laptops in the Sales Department</term>
     <listitem>
      <para>
       These machines need a desktop environment and a limited set of
       specialized applications, such as office and calendaring software.
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
   <figure id="fig.autoyast.rules">
    <title>&ay; Rules</title>
    <mediaobject>
     <imageobject role="fo">
      <imagedata fileref="autoyast_rules.svg" width="90%" format="SVG"/>
     </imageobject>
     <imageobject role="html">
      <imagedata fileref="autoyast_rules.png" width="80%" format="PNG"/>
     </imageobject>
    </mediaobject>
   </figure>
   <para>
    In a first step, use one of the methods outlined in
    <xref
     linkend="sec.deployment.autoinst.simple.profile"/> to create
    profiles for each use case. In this example, you would create
    <filename>print.xml</filename>, <filename>engineering.xml</filename>,
    and <filename>sales.xml</filename>.
   </para>
   <para>
    In the second step, create rules to distinguish the three hardware types
    from one another and to tell &ay; which profile to use. Use an algorithm
    similar to the following to set up the rules:
   </para>
   <orderedlist>
    <listitem>
     <para>
      Does the machine have an IP of <guimenu>192.168.2.253</guimenu>? Then
      make it the print server.
     </para>
    </listitem>
    <listitem>
     <para>
      Does the machine have PCMCIA hardware and feature an Intel chipset?
      Then consider it an Intel laptop and install the sales department
      software selection.
     </para>
    </listitem>
    <listitem>
     <para>
      If none of the above is true, consider the machine a developer
      workstation and install accordingly.
     </para>
    </listitem>
   </orderedlist>
   <para>
    Roughly sketched, this translates into a <filename>rules.xml</filename>
    file with the following content:
   </para>
<screen>
&lt;?xml version="1.0"?>
&lt;!DOCTYPE autoinstall SYSTEM "/usr/share/autoinstall/dtd/rules.dtd"> 
&lt;autoinstall xmlns="http://www.suse.com/1.0/yast2ns" xmlns:config="http://www.suse.com/1.0/configns">
  &lt;rules config:type="list">
    &lt;rule>
       &lt;hostaddress>
	    &lt;match>192.168.2.253&lt;/match>
            &lt;match_type>exact&lt;/match_type>
       &lt;/hostaddress>
       &lt;result>
            &lt;profile>print.xml&lt;/profile>
            &lt;continue config:type="boolean">false&lt;/continue>
        &lt;/result>
    &lt;/rule>
    &lt;rule>
       &lt;haspcmcia>
            &lt;match>1&lt;/match>
            &lt;match_type>exact&lt;/match_type>
       &lt;/haspcmcia>
       &lt;custom1>
           &lt;script>
if grep -i intel /proc/cpuinfo > /dev/null; then
echo -n "intel"
else
echo -n "non_intel"
fi;
           &lt;/script>
           &lt;match>*&lt;/match>
           &lt;match_type>exact&lt;/match_type>
       &lt;/custom1>
       &lt;result>
            &lt;profile>sales.xml&lt;/profile>
            &lt;continue config:type="boolean">false&lt;/continue>
        &lt;/result>
        &lt;operator>and&lt;/operator>
    &lt;/rule>
    &lt;rule>
        &lt;haspcmcia>
            &lt;match>0&lt;/match>
            &lt;match_type>exact&lt;/match_type>
        &lt;/haspcmcia>
 	&lt;result>
            &lt;profile>engineering.xml&lt;/profile>
            &lt;continue config:type="boolean">false&lt;/continue>
        &lt;/result>
    &lt;/rule>
  &lt;/rules>
&lt;/autoinstall>
</screen>
   <para>
    When distributing the rules file, make sure that the
    <filename>rules</filename> directory resides under the
    <filename>profiles</filename> directory, specified in the
    <filename>autoyast=<replaceable>protocol</replaceable>:<replaceable>serverip</replaceable>/profiles/</filename>
    URL. &ay; looks for a <filename>rules</filename> subdirectory containing
    a file named <filename>rules.xml</filename> first then loads and merges
    the profiles specified in the rules file.
   </para>
   <para>
    The rest of the autoinstallation procedure is carried out as usual.
   </para>
  </sect2>
 </sect1>
 <sect1 id="sec.deployment.autoinst.moreinfo">
  <title>For More Information</title>

  <para>
<!-- ke, 2012-11-13: We do not seem to ship the ay docs with sled -->
   For in-depth information about the &ay; technology, refer to
   <phrase os="sles"><xref
   linkend="book.autoyast"/> or </phrase> the
   documentation installed along with the software
   (<filename>/usr/share/doc/packages/autoyast2</filename>).
  </para>
 </sect1>
</chapter>
