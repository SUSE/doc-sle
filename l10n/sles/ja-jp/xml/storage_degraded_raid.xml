<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="storage_degraded_raid.xml" version="5.0" xml:id="cha-raid-degraded" xml:lang="ja">
 <title>ディグレードRAIDアレイの作成</title>
 <info>
  <abstract>
   <para>
    ディグレードアレイは、一部のデバイスが欠けたアレイです。ディグレードアレイは、RAID 1、RAID 4、RAID 5、およびRAID 6に対してのみサポートされています。これらのRAIDタイプは、その耐障害性機能として、一部のデバイスの欠落に耐えるように設計されています。通常、デバイスに障害が発生すると、ディグレードアレイが生成されます。ディグレードアレイは、意図的に作成するすることもできます。
   </para>
  </abstract>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:bugtracker/>
   <dm:translation>yes</dm:translation>
  </dm:docmanager>
 </info>
 <informaltable>
  <tgroup cols="2">
   <colspec colnum="1" colname="1" colwidth="30*"/>
   <colspec colnum="2" colname="2" colwidth="70*"/>
   <thead>
    <row>
     <entry>
      <para>
       RAIDの種類
      </para>
     </entry>
     <entry>
      <para>
       許容可能な欠落スロット数
      </para>
     </entry>
    </row>
   </thead>
   <tbody>
    <row>
     <entry>
      <para>
       RAID 1
      </para>
     </entry>
     <entry>
      <para>
       1つ以外の全スロット
      </para>
     </entry>
    </row>
    <row>
     <entry>
      <para>
       RAID 4
      </para>
     </entry>
     <entry>
      <para>
       1スロット
      </para>
     </entry>
    </row>
    <row>
     <entry>
      <para>
       RAID 5
      </para>
     </entry>
     <entry>
      <para>
       1スロット
      </para>
     </entry>
    </row>
    <row>
     <entry>
      <para>
       RAID 6
      </para>
     </entry>
     <entry>
      <para>
       1個または2個のスロット
      </para>
     </entry>
    </row>
   </tbody>
  </tgroup>
 </informaltable>
 <para>
  一部のデバイスが欠落したディグレードアレイを作成するには、単に、デバイス名の代わりに<literal>missing</literal>というワードを指定します。この指定により、<command>mdadm</command>は、アレイ内の対応するスロットを空のまま残します。
 </para>
 <para>
  RAID 5アレイの作成時に、<command>mdadm</command>によって、余分なスペアドライブをもつディグレードアレイが自動的に作成されます。これは、一般に、ディグレードアレイ内にスペアを構築した方が、ディグレードアレイではないが正常でないアレイ上でパリティを再同期するより高速なためです。この機能は、<literal>--force</literal>オプションで無効にできます。
 </para>
 <para>
  RAIDを作成したいが、使用するデバイスの1つに既にデータが入っている場合は、ディグレードアレイを作成すると便利なことがあります。その場合は、他のデバイスでディグレードアレイを作成し、その使用中のデバイスからのデータをディグレードモードで実行中のRAIDにコピーし、デバイスをRAIDに追加して、RAIDの再構築まで待機すると、データがすべてのデバイスに行き渡ります。このプロセスの例を、次のプロシージャで示します。
 </para>
 <procedure>
  <step>
   <para>
    単一ドライブ<filename>/dev/sd1</filename>を使用してディグレードRAID 1デバイス<filename>/dev/md0</filename>を作成するには、コマンドプロンプトで、次のように入力します。
   </para>
<screen><prompt>&gt; </prompt><command>sudo</command> mdadm --create /dev/md0 -l 1 -n 2 /dev/sda1 missing</screen>
   <para>
    追加先のデバイスは、追加するデバイスと同じか、またはそれ以上のサイズをもつ必要があります。
   </para>
  </step>
  <step>
   <para>
    ミラーに追加したいデバイスに、RAIDアレイに移動したいデータが含まれている場合は、この時点で、そのデータを、ディグレードモードで実行中のRAIDアレイにコピーします。
   </para>
  </step>
  <step>
   <para>
    データのコピー元のデバイスをミラーに追加します。たとえば、<filename>/dev/sdb1</filename>をRAIDに追加するには、コマンドプロンプトで、次のように入力します。
   </para>
<screen><prompt>&gt; </prompt><command>sudo</command> mdadm /dev/md0 -a /dev/sdb1</screen>
   <para>
    一度に1つのデバイスのみ追加できます。カーネルがミラーを構築し、完全にオンラインにした後、別のミラーを追加できます。
   </para>
  </step>
  <step>
   <para>
    構築の進捗状況を監視するには、コマンドプロンプトで、次のように入力します。
   </para>
<screen><prompt>&gt; </prompt><command>sudo</command> cat /proc/mdstat</screen>
   <para>
    毎秒更新されている間に再構築の進捗を確認するには、次のように入力します。
   </para>
<screen><prompt>&gt; </prompt><command>sudo</command> watch -n 1 cat /proc/mdstat </screen>
  </step>
 </procedure>
</chapter>
