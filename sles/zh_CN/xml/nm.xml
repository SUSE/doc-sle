<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="nm.xml" version="5.0" xml:id="cha.nm">
 <title>使用 NetworkManager</title>
 <info>
      <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
        <dm:bugtracker>
        </dm:bugtracker>
        <dm:translation>yes</dm:translation>
      </dm:docmanager>
    </info>
    <indexterm> <primary>因特网</primary> <secondary>连接至</secondary></indexterm><indexterm> <primary>NetworkManager</primary></indexterm>
 <para>
  NetworkManager 是用于便携式计算机和其他可移动计算机的理想解决方案。它支持网络连接的顶级加密类型和标准，包括 802.1x 保护的网络的连接。802.1X 是<quote>基于端口的网络访问控制的本地和城域网 IEEE 标准</quote>。使用 NetworkManager，在外出时，您就无需担心配置网络接口以及在有线或无线网络之间切换的问题。NetworkManager 可自动连接到已知无线网络或并行管理多个网络连接 － 然后将最快的连接用作默认连接。而且，您还可手动在可用网络之间切换，并使用系统盘中的小程序管理网络连接。

 </para>
 <para>
  不只可激活一个连接，也可同时激活多个。这样您可以将便携式计算机从以太网连接拔出后仍通过无线连接保持连接状态。
 </para>
 <sect1 xml:id="sec.nm.usecase">
  <title>NetworkManager 的用例</title>

  <para>
   NetworkManager 提供了完善且直观的用户界面，可使用户轻松地切换其网络环境。但是，在以下情况下，NetworkManager 解决方案不适用：
  </para>

  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>
     您的计算机将为网络中的其他计算机（例如，DHCP 或 DNS 服务器）提供网络服务。
    </para>
   </listitem>
   <listitem>
    <para>
     您的计算机为 Xen 服务器或您的系统是 Xen 内的虚拟系统。
    </para>
   </listitem>
  </itemizedlist>
 </sect1>
 <sect1 xml:id="sec.nm.activate">
  <title>启用或禁用 NetworkManager</title><indexterm> <primary>NetworkManager</primary> <secondary>启用</secondary></indexterm>

  <para>
   在便携式计算机上，默认情况下 NetworkManager 处于启用状态。但是，任何时候都可以在 YaST 网络设置模块中启用或禁用它。
  </para>

  <procedure>
   <step>
    <para>
     运行 YaST，然后转到<menuchoice><guimenu>网络设备</guimenu> <guimenu>网络设置</guimenu></menuchoice>。
    </para>
   </step>
   <step>
    <para>
     将打开<guimenu>网络设置</guimenu>对话框。转到<guimenu>全局选项</guimenu>选项卡。
    </para>
   </step>
   <step>
    <para>
     要通过 NetworkManager 配置和管理您的网络连接，请执行以下操作：
    </para>
    <substeps performance="required">
     <step>
      <para>
       在<guimenu>网络设置方法</guimenu>字段中选择<guimenu>通过 NetworkManager 的用户控制方法</guimenu>。
      </para>
     </step>
     <step>
      <para>
       单击<guimenu>确定</guimenu>并关闭 YaST。
      </para>
     </step>
     <step>
      <para>
       按照<xref linkend="sec.nm.configure"/>中所述通过 NetworkManager 配置您的网络连接。
      </para>
     </step>
    </substeps>
   </step>
   <step>
    <para>
     停用 NetworkManager 并使用您自己的配置控制网络
    </para>
    <substeps performance="required">
     <step>
      <para>
       在<guimenu>网络设置方法</guimenu>字段中选择<guimenu>通过 wicked 进行控制</guimenu>。
      </para>
     </step>
     <step>
      <para>
       单击<guimenu>确定</guimenu>。
      </para>
     </step>
     <step>
      <para>
       通过 YaST 设置您的网卡，即通过 DHCP 或静态 IP 地址进行自动配置。
      </para>
      <para>
       <xref linkend="sec.basicnet.yast"/>中提供了使用 YaST 进行网络配置的详细说明。
      </para>
     </step>
    </substeps>
   </step>
  </procedure>
 </sect1>
 <sect1 xml:id="sec.nm.configure">
  <title>配置网络连接</title><indexterm> <primary>NetworkManager</primary> <secondary>配置</secondary></indexterm>

  <para>
   在 YaST 中启用 NetworkManager 后，使用 GNOME 中提供的 NetworkManager 前端配置网络连接。它会显示所有网络连接类型对应的选项卡，例如有线、无线、移动宽带、DSL 和 VPN 连接。
  </para>

  <para>
   要在 GNOME 中打开网络配置对话框，请通过状态菜单打开设置菜单，然后单击<guimenu>网络</guimenu>项。
  </para>

  <note>
   <title>选项的可用性</title>
   <para>
    根据您的系统设置，可能不允许您配置连接。在安全环境中，某些选项可能会被锁定或需要 <systemitem class="username">root</systemitem> 权限。请咨询系统管理员以了解细节。
   </para>
  </note>

  <figure>
   <title>GNOME 网络连接对话框</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="nm_gnome_tabs.png" width="70%"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="nm_gnome_tabs.png" width="50%"/>
    </imageobject>
   </mediaobject>
  </figure>

  <procedure xml:id="pro.nm.configure.add">
   <title>添加和编辑连接</title>
   <step>
    <para>
     打开 NetworkManager 配置对话框。
    </para>
   </step>
   <step>
    <para>
     添加连接：
    </para>
    <substeps performance="required">
     <step>
      <para>
       单击左下角的 <guimenu>+</guimenu> 图标。
      </para>
     </step>
     <step>
      <para>
       选择首选连接类型并按照指示操作。
      </para>
     </step>
     <step>
      <para>
       完成后，单击<guimenu>添加</guimenu>。
      </para>
     </step>
     <step>
      <para>
       确认您的更改后，打开“状态菜单”，便会在显示的可用网络列表中看到新配置的网络连接。
      </para>
     </step>
    </substeps>
   </step>
   <step>
    <para>
     编辑连接：
    </para>
    <substeps performance="required">
     <step>
      <para>
       选择要编辑的项目。
      </para>
     </step>
     <step>
      <para>
       单击齿轮图标打开<guimenu>连接设置</guimenu>对话框。
      </para>
     </step>
     <step>
      <para>
       插入您的更改，然后单击<guimenu>应用</guimenu>保存更改。
      </para>
     </step>
     <step>
      <para>
       要让您的连接可用作系统连接，请转到<guimenu>身份</guimenu>选项卡，选中复选框<guimenu>可用于其他用户</guimenu>。有关用户和系统连接的详细信息，请参见<xref linkend="sec.nm.sec.types"/>。
      </para>
     </step>
    </substeps>
   </step>
  </procedure>

  <sect2 xml:id="sec.nm.gome.applet.wired">
   <title>管理有线网络连接</title>
   <para>
    如果您的计算机连接的是有线网络，请使用 NetworkManager 小程序管理连接。
   </para>
   <procedure>
    <step>
     <para>
      打开“状态菜单”，然后单击<guimenu>有线</guimenu>更改连接细节或将其关闭。
     </para>
    </step>
    <step>
     <para>
      要更改设置，请单击<guimenu>有线设置</guimenu>，然后单击齿轮图标。
     </para>
    </step>
    <step>
     <para>
      要关闭所有网络连接，请激活<guimenu>飞行模式</guimenu>设置。
     </para>
    </step>
   </procedure>
  </sect2>

  <sect2 xml:id="sec.nm.gnome.applet.wireless">
   <title>管理无线网络连接</title>
   <para>
    可见的无线网络在<guimenu>无线网络</guimenu>下的 GNOME NetworkManager 小程序菜单中列出。每个网络的信号强度也会显示在菜单中。加密无线网络是用保护物图标标记的。
   </para>
   <procedure>
    <title>连接到可见无线网络</title>
    <step>
     <para>
      要连接可见无线网络，请打开“状态菜单”然后单击 <guimenu>Wi-Fi</guimenu>。
     </para>
    </step>
    <step>
     <para>
      单击<guimenu>开启</guimenu>将其启用。
     </para>
    </step>
    <step>
     <para>
      单击<guimenu>选择网络</guimenu>，选择 Wi-Fi 网络然后单击<guimenu>连接</guimenu>。
     </para>
    </step>
    <step>
     <para>
      如果网络已加密，一个配置对话框将会打开。其中会显示网络使用的加密类型以及用于输入登录凭证的文本框。
     </para>
    </step>
   </procedure>
   <procedure>
    <title>连接到不可见无线网络</title>
    <step>
     <para>
      要连接到未广播其服务集标识符（SSID 或 ESSID）因而无法自动检测到的网络，请打开“状态菜单”，然后单击 <guimenu>Wi-Fi</guimenu>。
     </para>
    </step>
    <step>
     <para>
      单击 <guimenu>Wi-Fi 设置</guimenu>打开详细设置菜单。
     </para>
    </step>
    <step>
     <para>
      确保 Wi-Fi 处于启用状态，然后单击<guimenu>连接隐藏网络...</guimenu>。
     </para>
    </step>
    <step>
     <para>
      在打开的对话框中的<guimenu>网络名称</guimenu>中输入 SSID 或 ESSID，并视需要设置加密参数。
     </para>
    </step>
   </procedure>
   <para>
    显式选中的无线网络将尽可能始终保持连接。如果在此期间插入网线，则会连接任何设置为<guimenu>尽可能保持连接</guimenu>的连接，而无线连接也会保持连接状态。
   </para>
  </sect2>

  <sect2 xml:id="sec.nm.gnome.applet.accesspoint">
   <title>将 Wi-Fi/蓝牙网卡配置为接入点</title>
   <para>
    如果您的 Wi-Fi/蓝牙网卡支持接入点模式，则可以使用 NetworkManager 进行配置。
   </para>
   <procedure>
    <step>
     <para>
      打开“状态菜单”，然后单击 <guimenu>Wi-Fi</guimenu>。
     </para>
    </step>
    <step>
     <para>
      单击 <guimenu>Wi-Fi 设置</guimenu>打开详细设置菜单。
     </para>
    </step>
    <step>
     <para>
      单击<guimenu>用作热点...</guimenu> 并按照指示操作。
     </para>
    </step>
    <step>
     <para>
      使用随后出现的对话框中显示的身份凭证来连接远程计算机的热点。
     </para>
    </step>
   </procedure>
  </sect2>

  <sect2 xml:id="sec.nm.vpn">
   <title>NetworkManager 和 VPN</title><indexterm> <primary>NetworkManager</primary> <secondary>VPN</secondary></indexterm><indexterm> <primary>VPN</primary></indexterm>
   <para>
    NetworkManager 支持多种虚拟专用网 (VPN) 技术。对于每种技术，<phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> 都随附了提供 NetworkManager 常规支持的基础包。此外，还需要为您的小程序安装特定于桌面的包。
   </para>
   <variablelist>
    <varlistentry>
     <term>OpenVPN</term>
     <listitem>
      <para>
       要使用此 VPN 技术，请安装
      </para>
      <itemizedlist mark="bullet" spacing="normal">
       <listitem>
        <para>
         <systemitem class="resource">NetworkManager-openvpn</systemitem> 和
        </para>
       </listitem>
       <listitem>
        <para>
         <systemitem class="resource">NetworkManager-openvpn-gnome</systemitem>。
        </para>
       </listitem>
      </itemizedlist>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>vpnc (Cisco)</term>
     <listitem>
      <para>
       要使用此 VPN 技术，请安装
      </para>
      <itemizedlist mark="bullet" spacing="normal">
       <listitem>
        <para>
         <systemitem class="resource">NetworkManager-vpnc</systemitem> 和
        </para>
       </listitem>
       <listitem>
        <para>
         <systemitem class="resource">NetworkManager-vpnc-gnome</systemitem>。
        </para>
       </listitem>
      </itemizedlist>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>PPTP（点对点隧道协议）</term>
     <listitem>
      <para>
       要使用此 VPN 技术，请安装
      </para>
      <itemizedlist mark="bullet" spacing="normal">
       <listitem>
        <para>
         <systemitem class="resource">NetworkManager-pptp</systemitem> 和
        </para>
       </listitem>
       <listitem>
        <para>
         <systemitem class="resource">NetworkManager-pptp-gnome</systemitem>。
        </para>
       </listitem>
      </itemizedlist>
     </listitem>
    </varlistentry>
   </variablelist>
   <para>
    在安装包后，按照<xref linkend="pro.nm.configure.add"/>中所述配置 VPN 连接。
   </para>
  </sect2>
 </sect1>
 <sect1 xml:id="sec.nm.security">
  <title>NetworkManager 和安全性</title><indexterm> <primary>NetworkManager</primary> <secondary>安全性</secondary></indexterm>

  <para>
   NetworkManager 区分两种类型的无线连接，即可信和不可信。可信连接是您过去明确选择的任何网络。所有其他连接均为不可信连接。可信连接用接入点的名称和 MAC 地址识别。使用 MAC 地址可以确保带有可信连接名称的不同接入点不可使用。
  </para>

  <para>
   NetworkManager 会定期扫描是否存在可用的无线网络。如果找到多个可信网络，则自动选择最近使用的可信网络。如果所有网络均不可信，NetworkManager 将等待您做出选择。
  </para>

  <para>
   如果加密设置改变，但名称和 MAC 地址不变，则 NetworkManager 将尝试连接，但首先会要求您确认新的加密设置并提供所有更新（如新密钥）。
  </para>

  <para>
   如果您从使用无线连接切换到脱机模式，则 NetworkManager 会将 SSID 或 ESSID 设为空白。这可以确保断开网卡连接。
  </para>

  <sect2 xml:id="sec.nm.sec.types">
   <title>用户和系统连接</title>
   <para>
    NetworkManager 可识别两种类型的连接：<literal>用户</literal>连接和<literal>系统</literal>连接。用户连接是第一个用户登录时对 NetworkManager 可用的连接。会要求该用户提供所有必需的身份凭证，当该用户注销时，连接会断开并从 NetworkManager 中去除。定义为系统连接的连接可以由所有用户共享，并在启动 NetworkManager 之后、任何用户登录之前即可使用。如果是系统连接，必须在创建连接时提供所有身份凭证。此类系统连接可用于自动连接到要求授权的网络。有关如何用 NetworkManager 配置用户连接或系统连接的信息，请参见<xref linkend="sec.nm.configure"/>。
   </para>
  </sect2>

  <sect2 xml:id="sec.nm.sec.store">
   <title>储存密码和身份凭证</title>
   <para>
    如果不想每次连接到加密网络时都要再次输入身份凭证，则可以使用 GNOME 密钥环管理器将身份凭证加密存储在磁盘上，并用主密码保护。
   </para>


   <para>
    NetworkManager 还可从证书储存检索用于安全连接（例如，加密的有线、无线或 VPN 连接）的证书。有关更多信息，请参考<xref linkend="cha.certstore"/>。
   </para>
  </sect2>
 </sect1>
 <sect1 xml:id="sec.nm.faq">
  <title>常见问题</title>

  <para>
   下面是关于使用 NetworkManager 配置特殊网络选项的一些常见问题。
  </para>

  <qandaset>
   <qandaentry>
    <question>
     <para>
      如何将连接绑定到特定设备？
     </para>
    </question>
    <answer>
     <para>
      默认情况下，NetworkManager 中的连接是特定于设备类型的：它们适用于同一类型的所有物理设备。如果每个连接类型有多台物理设备可用（例如您的计算机装有两块以太网卡），您可以将一个连接绑定到特定设备。

     </para>
     <para>
      要在 GNOME 中达到此目的，请先查找设备的 MAC 地址（使用小程序中提供的<guimenu>连接信息</guimenu>，或使用 <command>nm-tool</command> 或 <command>wicked show all</command> 等命令行工具的输出）。然后启动配置网络连接的对话框，选择您要修改的连接。在<guimenu>有线</guimenu>或<guimenu>无线</guimenu>选项卡上，输入设备的 <guimenu>MAC 地址</guimenu>，并确认更改。
     </para>
    </answer>
   </qandaentry>
   <qandaentry>
    <question>
     <para>
      如果检测到同一 ESSID 有多个接入点，如何指定特定接入点？
     </para>
    </question>
    <answer>
     <para>
      当有不同无线波段 (a/b/g/n) 的多个接入点时，默认情况下会自动选择信号最强的接入点。要覆盖此值，配置无线连接时请使用 <guimenu>BSSID</guimenu> 字段。
     </para>
     <para>
      基本服务集标识 (BSSID) 可唯一标识每个基本服务集。在基础结构基本服务集中，BSSID 是无线接入点的 MAC 地址。在独立（特别）基本服务集中，BSSID 是本地管理的 MAC 地址（从 46 位数字随机生成）。
     </para>
     <para>
      如<xref linkend="sec.nm.configure"/> 中所述启动配置网络连接的对话框。选择要修改的无线连接，然后单击<guimenu>编辑</guimenu>。在<guimenu>无线</guimenu>选项卡上，输入 BSSID。
     </para>
    </answer>
   </qandaentry>
   <qandaentry>
    <question>
     <para>
      如何将网络连接与其他计算机共享？
     </para>
    </question>
    <answer>
     <para>
      主设备（连接到因特网的设备）不需要任何特殊配置。但是，需要如下配置连接到本地集线器或计算机的设备：
     </para>
     <orderedlist spacing="normal">
      <listitem>
       <para>
        如<xref linkend="sec.nm.configure"/> 中所述启动配置网络连接的对话框。选择要修改的连接，然后单击<guimenu>编辑</guimenu>。切换到 <guimenu>IPv4 设置</guimenu>选项卡，从<guimenu>方法</guimenu>下拉框中选择<guimenu>共享给其他计算机</guimenu>。这将启用 IP 通讯转发并运行该设备上的 DHCP 服务器。确认在 NetworkManager 中所做更改。
       </para>
      </listitem>
      <listitem>
       <para>
        由于 DCHP 服务器使用端口 <literal>67</literal>，请确保该端口没有被防火墙阻止：在共享连接的计算机上，启动 YaST 并选择<menuchoice><guimenu>安全和用户</guimenu> <guimenu>防火墙</guimenu></menuchoice>。切换到<guimenu>允许的服务</guimenu>类别。如果 <guimenu>DHCP 服务器</guimenu>尚未显示为<guimenu>允许的服务</guimenu>，请从<guimenu>待允许的服务</guimenu>中选择 <guimenu>DHCP 服务器</guimenu>，然后单击<guimenu>添加</guimenu>。确认在 YaST 中所做更改。
       </para>
      </listitem>
     </orderedlist>
    </answer>
   </qandaentry>
   <qandaentry>
    <question>
     <para>
      如何对自动（DHCP、PPP、VPN）地址提供静态 DNS 信息？
     </para>
    </question>
    <answer>
     <para>
      如果 DHCP 服务器提供无效的 DNS 信息（和/或路由），则可以覆盖它。如<xref linkend="sec.nm.configure"/> 中所述启动配置网络连接的对话框。选择要修改的连接，然后单击<guimenu>编辑</guimenu>。切换到 <guimenu>IPv4 设置</guimenu>选项卡，从<guimenu>方法</guimenu>下拉框中选择<guimenu>仅自动 (DHCP) 地址</guimenu>。在 <guimenu>DNS 服务器</guimenu>和<guimenu>搜索域</guimenu>字段中输入 DNS 信息。要<guimenu>忽略自动取得的路由</guimenu>，请单击<guimenu>路由</guimenu>，然后激活相应的复选框。确认更改。
     </para>
    </answer>
   </qandaentry>
   <qandaentry>
    <question>
     <para>
      如何在用户登录之前将 NetworkManager 连接到受口令保护的网络？
     </para>
    </question>
    <answer>
     <para>
      定义可以用于此类用途的<literal>系统连接</literal>。有关更多信息，请参考<xref linkend="sec.nm.sec.types"/>。
     </para>
    </answer>
   </qandaentry>
  </qandaset>
 </sect1>
 <sect1 xml:id="sec.nm.trouble">
  <title>查错</title><indexterm> <primary>NetworkManager</primary> <secondary>查错</secondary></indexterm>

  <para>
   可能出现连接问题。与 NetworkManager 相关的一些常见问题包括小程序不启动或缺少 VPN 选项。解决方法和预防这些问题的方法随使用的工具而定。
  </para>

  <variablelist>
   <varlistentry>
    <term>NetworkManager 桌面小程序没有启动</term>
    <listitem>
     <para>
      如果设置了 NetworkManager 控制的网络，小程序会自动启动。如果小程序未启动，请按照<xref linkend="sec.nm.activate"/>中所述检查是否在 YaST 中启用了 NetworkManager。然后，请确保 NetworkManager-gnome 包也已安装。
     </para>
     <para>
      如果桌面小程序已经安装，但出于某种原因没有运行，则手动启动它。如果该桌面小程序已安装但由于某些原因没有运行，请用命令 <command>nm-applet</command> 手动启动它。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>NetworkManager 小程序不包括 VPN 选项</term>
    <listitem>
     <para>
      对 NetworkManager 的支持、小程序以及适用于 NetworkManager 的 VPN 已在不同的包中分发。如果 NetworkManager 小程序不包括 VPN 选项，请检查带有 NetworkManager 支持的 VPN 技术的包是否已经安装。有关详细信息，请参见<xref linkend="sec.nm.vpn"/>。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>没有可用的网络连接</term>
    <listitem>
     <para>
      如果您已正确配置网络连接并且网络连接的所有其他组件（路由器等等）也已启动并在正常运行，则重启动计算机上的网络接口有时可能有帮助。要实现此目的，请以 <systemitem class="username">root</systemitem> 身份登录到命令行，然后运行 <command>systemctl restart wicked</command>。
     </para>
    </listitem>
   </varlistentry>
  </variablelist>
 </sect1>
 <sect1 xml:id="sec.nm.more">
  <title>更多信息</title>

  <para>
   可在以下网站和目录中找到有关 NetworkManager 的更多信息：
  </para>

  <variablelist>
   <varlistentry>
    <term>NetworkManager 项目页</term>
    <listitem>
     <para>
      <link xlink:href="http://projects.gnome.org/NetworkManager/"/>
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>包文档</term>
    <listitem>
     <para>
      还可以在以下目录中找到有关 NetworkManager 和 GNOME 小程序的最新信息：
     </para>
     <itemizedlist mark="bullet" spacing="normal">
      <listitem>
       <para>
        <filename>/usr/share/doc/packages/NetworkManager/</filename>,
       </para>
      </listitem>
      <listitem>
       <para>
        <filename>/usr/share/doc/packages/NetworkManager-gnome/</filename>。
       </para>
      </listitem>
     </itemizedlist>
    </listitem>
   </varlistentry>
  </variablelist>
 </sect1>
</chapter>
