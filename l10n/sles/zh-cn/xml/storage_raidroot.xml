<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="storage_raidroot.xml" version="5.0" xml:id="cha-raidroot" xml:lang="zh-cn">
 <title>为根分区配置软件 RAID</title>
 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:bugtracker/>
   <dm:translation>yes</dm:translation>
  </dm:docmanager>
 </info>
 <para>
  在 <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> 中，设备映射程序 RAID 工具已集成到 YaST 分区程序中。安装时可以使用此分区程序为包含根 (<filename>/</filename>) 分区的系统设备创建软件 RAID。不能将 <filename>/boot</filename> 分区存储在除 RAID 1 以外的 RAID 分区上。
 </para>
 <important>
  <title>RAID 1 上的 <filename>/boot/efi</filename> 可能无法引导</title>
  <para>
   在 RAID 上创建 <filename>/boot/efi</filename> 分区时，请记住，在某些情况下，该固件可能无法识别 RAID 上的引导分区。在这种情况下，该固件会拒绝引导。
  </para>
 </important>
 <sect1 xml:id="sec-raidroot-require">
  <title>针对根分区使用软件 RAID 设备的先决条件</title>

  <para>
   请确保配置满足以下要求：
  </para>

  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>
     创建 RAID 1 镜像设备需要有两块硬盘。这两块硬盘的大小应相近。RAID 使用较小驱动器大小。块存储设备可以是本地设备（计算机中或直接挂接到计算机）、光纤通道存储子系统或 iSCSI 存储子系统的任意组合。
    </para>
   </listitem>
   <listitem>
    <para>
     如果在 MBR 中安装引导加载程序，则不需要为 <filename>/boot</filename> 创建单独的分区。如果无法在 MBR 中安装引导加载程序，则 <filename>/boot</filename> 需要驻留在单独的分区上。
    </para>
   </listitem>
   <listitem>
    <para>
     对于 UEFI 计算机，需要设置专用的 <filename>/boot/efi</filename> 分区。该分区需要格式化为 VFAT，可以驻留在 RAID 1 设备上，以防包含 <filename>/boot/efi</filename> 的物理磁盘发生故障时出现引导问题。
    </para>
   </listitem>
   <listitem>
    <para>
     如果要使用硬件 RAID 设备，请不要在其上尝试运行软件 RAID。
    </para>
   </listitem>
   <listitem>
    <para>
     如果要使用 iSCSI 目标设备，需要在创建 RAID 设备之前启用对 iSCSI 发起端的支持。
    </para>
   </listitem>
   <listitem>
    <para>
     如果存储子系统在服务器和其直接挂接的本地设备、光纤通道设备或要在软件 RAID 中使用的 iSCSI 设备之间提供多个 I/O 路径，则在创建 RAID 设备之前需要启用多路径支持。
    </para>
   </listitem>
  </itemizedlist>
 </sect1>
 <sect1 xml:id="sec-raidroot-setup">
  <title>设置使用软件 RAID 设备作为根 (<filename>/</filename>) 分区的系统</title>

  <procedure>
   <step>
    <para>
     使用 YaST 启动安装，并按照<xref linkend="cha-install"/>中的说明操作，直到<guimenu>建议分区</guimenu>步骤为止。
    </para>
   </step>
   <step>
    <para>
     单击<guimenu>专家分区程序</guimenu>打开自定义分区程序。您可以使用建议的方案，也可以使用现有方案。
    </para>
   </step>
   <step>
    <para>
     （可选）如果有要使用的 iSCSI 目标设备，则需要在屏幕左上方选择<menuchoice><guimenu>系统</guimenu> <guimenu>配置</guimenu> <guimenu>配置 iSCSI</guimenu></menuchoice> 来启用 iSCSI 发起端软件。有关更多细节，请参见<xref linkend="cha-iscsi"/>。
    </para>
   </step>
   <step>
    <para>
     （可选）如果有要使用的 FCoE 目标设备，则需要在屏幕左上方单击<menuchoice><guimenu>系统</guimenu> <guimenu>配置</guimenu> <guimenu>配置 FCoE</guimenu></menuchoice> 来配置界面。
    </para>
   </step>
   <step>
    <para>
     （可选）如果需要丢弃分区更改，请单击<menuchoice><guimenu>系统</guimenu> <guimenu>重新扫描设备</guimenu></menuchoice>。
    </para>
   </step>
   
   
   
   
   <step>
    <para>
     为要用于软件 RAID 的每个设备设置 <guimenu> Linux RAID</guimenu> 格式。应该为 <filename>/</filename>、<filename>/boot/efi</filename> 或交换分区使用 RAID。
    </para>
    <substeps performance="required">
     <step>
      <para>
       在左侧面板中，选择<guimenu>硬盘</guimenu>以及要使用的设备，然后单击<guimenu>添加分区</guimenu>。
      </para>
     </step>
     <step>
      <para>
       在<guimenu>新分区大小</guimenu>下，指定要使用的大小，然后单击<guimenu>下一步</guimenu>。
      </para>
     </step>
     <step>
      <para>
       在<guimenu>角色</guimenu>下，选择<guimenu>原始卷（未格式化）</guimenu>。
      </para>
     </step>
     <step>
      <para>
       选择<guimenu>不格式化</guimenu>和<guimenu>不挂载</guimenu>，并将<guimenu>分区 ID</guimenu> 设置为 <guimenu>Linux RAID</guimenu>。
      </para>
     </step>
     <step>
      <para>
       单击<guimenu>下一步</guimenu>，并对第二个分区重复以上步骤。
      </para>
      <informalfigure>
       <mediaobject>
        <imageobject role="fo">
         <imagedata fileref="raid_yast_install2_a.png" width="80%"/>
        </imageobject>
        <imageobject role="html">
         <imagedata fileref="raid_yast_install2_a.png" width="100%"/>
        </imageobject>
       </mediaobject>
      </informalfigure>
     </step>
    </substeps>
   </step>
   <step>
    <para>
     为 <filename>/</filename> 分区创建 RAID 设备。
    </para>
    <substeps performance="required">
     <step>
      <para>
       在左侧面板中，选择 <guimenu>RAID</guimenu>，然后选择<guimenu>添加 RAID</guimenu>。
      </para>
     </step>
     <step>
      <para>
       为 <filename>/</filename> 分区设置所需的 <guimenu>RAID 类型</guimenu>，并将 <guimenu>RAID 名称</guimenu>设置为 <literal>system</literal>。
      </para>
     </step>
     <step>
      <para>
       从<guimenu>可用设备</guimenu>部分选择您在上一步中准备好的两个 RAID 设备并<guimenu>添加</guimenu>它们。
      </para>
      <informalfigure>
       <mediaobject>
        <imageobject role="fo">
         <imagedata fileref="raid_yast_install3_a.png" width="80%"/>
        </imageobject>
        <imageobject role="html">
         <imagedata fileref="raid_yast_install3_a.png" width="100%"/>
        </imageobject>
       </mediaobject>
      </informalfigure>
      <para>
       单击<guimenu>下一步</guimenu>。
      </para>
     </step>
     <step>
      <para>
       从下拉框中选择区块大小。保留默认设置是安全的做法。
      </para>
     </step>
     <step>
      <para>
       在左侧面板中，单击 <guimenu>RAID</guimenu>。在<guimenu>设备概览</guimenu>选项卡中，选择新 RAID 并单击<guimenu>编辑</guimenu>。
      </para>
      <informalfigure>
       <mediaobject>
        <imageobject role="fo">
         <imagedata fileref="raid_yast_install_editraid.png" width="80%"/>
        </imageobject>
        <imageobject role="html">
         <imagedata fileref="raid_yast_install_editraid.png" width="100%"/>
        </imageobject>
       </mediaobject>
      </informalfigure>
     </step>
     <step>
      <para>
       在<guimenu>角色</guimenu>下选择<guimenu>操作系统</guimenu>，然后单击<guimenu>下一步</guimenu>。
      </para>
     </step>
     <step>
      <para>
       选择<guimenu>文件系统</guimenu>并将挂载点设置为 <filename>/</filename>。单击 <filename>Next</filename> 退出此对话框。
      </para>
      <informalfigure>
       <mediaobject>
        <imageobject role="fo">
         <imagedata fileref="raid_yast_install_filesystem.png" width="80%"/>
        </imageobject>
        <imageobject role="html">
         <imagedata fileref="raid_yast_install_filesystem.png" width="100%"/>
        </imageobject>
       </mediaobject>
      </informalfigure>
     </step>
     
    </substeps>
   </step>
   <step>
    <para>
     软件 RAID 设备便会受设备映射程序的管理，并会在 <filename>/dev/md/system</filename> 路径下创建一个设备。
    </para>
   </step>
   <step>
    <para>
     （可选）您可以在 RAID 中创建交换分区。步骤与上文类似，不过要在<guimenu>角色</guimenu>下选择<guimenu>交换</guimenu>。选择文件系统和挂载点，如下所示。单击<guimenu>下一步</guimenu>。
    </para>
    <informalfigure>
     <mediaobject>
      <imageobject role="fo">
       <imagedata fileref="raid_yast_install_swap.png" width="80%"/>
      </imageobject>
      <imageobject role="html">
       <imagedata fileref="raid_yast_install_swap.png" width="100%"/>
      </imageobject>
     </mediaobject>
    </informalfigure>
   </step>
   <step>
    <para>
     （可选）对于 UEFI 计算机，使用类似的步骤创建 <filename>/boot/efi</filename> 挂载分区。请记住，<filename>/boot/efi</filename> 仅支持 RAID 1，需要将该分区格式化为 FAT32 文件系统。
    </para>
    <informalfigure>
     <mediaobject>
      <imageobject role="fo">
       <imagedata fileref="raid_yast_install_boot.png" width="80%"/>
      </imageobject>
      <imageobject role="html">
       <imagedata fileref="raid_yast_install_boot.png" width="100%"/>
      </imageobject>
     </mediaobject>
    </informalfigure>
    <para>
     分区如下所示：
    </para>
    <informalfigure>
     <mediaobject>
      <imageobject role="fo">
       <imagedata fileref="raid_yast_install3_b.png" width="70%"/>
      </imageobject>
      <imageobject role="html">
       <imagedata fileref="raid_yast_install3_b.png" width="70%"/>
      </imageobject>
     </mediaobject>
    </informalfigure>
   </step>
   <step>
    <para>
     单击<guimenu>接受</guimenu>退出分区程序。
    </para>
    <para>
     <guimenu>建议分区</guimenu>页面上会显示新的建议。
    </para>
   </step>
   <step>
    <para>
     继续安装。对于包含独立 <filename>/boot/efi</filename> 分区的 UEFI 计算机，请在<guimenu>安装设置</guimenu>屏幕上单击<guimenu>引导</guimenu>，然后将<guimenu>引导加载程序</guimenu>设置为 <guimenu>GRUB2 for EFI</guimenu>。检查<guimenu>启用安全引导支持</guimenu>选项是否已选中。
    </para>
    <para>
     每次重引导服务器时，设备映射程序都会在引导时启动，以便让系统能自动识别软件 RAID，并启动根 (<literal>/</literal>) 分区上的操作系统。
    </para>
   </step>
  </procedure>
 </sect1>
</chapter>
