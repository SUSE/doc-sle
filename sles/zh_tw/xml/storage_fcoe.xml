<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="storage_fcoe.xml" version="5.0" xml:id="cha.fcoe" xml:lang="zh-tw">
 <title>乙太網路光纖通道儲存︰FCoE</title>
 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:bugtracker/>
   <dm:translation>yes</dm:translation>
  </dm:docmanager>
 </info>
 <para>
  許多企業資料中心的 LAN 和資料流量都依賴於乙太網路，而他們的儲存基礎架構則依賴於光纖通道網路。開放式乙太網路光纖通道 (FCoE) 啟動器軟體允許具有乙太網路卡的伺服器透過乙太網路連接至光纖通道儲存子系統。而在以前，此連接性僅可供具有光纖通道配接器的系統透過光纖通道光纖使用。FCoE 技術支援網路會聚，降低了資料中心的複雜程度。這可協助您保護在光纖通道儲存基礎架構中的現有投資，並簡化網路管理。
 </para>
 <figure>
  <title>開放式乙太網路光纖通道 SAN</title>
  <mediaobject>
   <imageobject role="fo">
    <imagedata fileref="fcoe_san_a.svg" width="80%" format="SVG"/>
   </imageobject>
   <imageobject role="html">
    <imagedata fileref="fcoe_san_a.png" width="100%" format="PNG"/>
   </imageobject>
  </mediaobject>
 </figure>
 <para>
  開放式 FCoE 可讓您在主機上，而不是在主機匯流排配接器上的專屬硬體上執行光纖通道通訊協定。它專用於 10 Gbps (每秒 GB) 乙太網路卡，但是也可用於支援暫停訊框的任何乙太網路卡。啟動器軟體提供了光纖通道通訊協定處理模組以及基於乙太網路的傳輸模組。開放式 FCoE 模組用作 SCSI 的低階驅動程式。開放式 FCoE 傳輸使用 <command>net_device</command> 來傳送和接收封包。資料中心橋接 (DCB) 驅動程式提供 FCoE 的服務品質。
 </para>
 <para>
  FCoE 是一種封裝通訊協定，它可透過乙太網路連接移動光纖通道通訊協定流量，而不需要變更光纖通道訊框。這使得網路安全和流量管理基礎架構可以如同採用光纖通道一樣利用 FCoE。
 </para>
 <para>
  如果存在下列情況，您可以選擇在您的企業中部署 FCoE︰
 </para>
 <itemizedlist mark="bullet" spacing="normal">
  <listitem>
   <para>
    您的企業已擁有光纖通道儲存子系統，以及具備光纖通道技能和知識的管理員。
   </para>
  </listitem>
  <listitem>
   <para>
    您要在網路中部署 10 Gbps 乙太網路。
   </para>
  </listitem>
 </itemizedlist>
 <para>
  本節說明如何在網路中設定 FCoE。
 </para>
 <sect1 xml:id="sec.fcoe.installation">
  <title>在安裝期間設定 FCoE 介面</title>

  <para>
   如果在交換器上為伺服器與光纖通道儲存基礎架構之間的連接啟用了 FCoE，則可以透過適用於 <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> 的 YaST 來在作業系統安裝期間設定 FCoE 磁碟。某些類型的系統 BIOS 能自動偵測到 FCoE 磁碟，並向 YaST 安裝軟體報告這些磁碟。不過，並非所有類型的 BIOS 都支援 FCoE 磁碟的自動偵測。在此情況下，若要啟用自動偵測，則可以在開始安裝時將 <command>withfcoe</command> 選項新增至核心指令行︰
  </para>

<screen>withfcoe=1</screen>

  <para>
   偵測到 FCoE 磁碟時，YaST 安裝會在此時提供用於設定 FCoE 例項的選項。在「磁碟啟動」頁面上，選取<guimenu>設定 FCoE 介面</guimenu>以存取 FCoE 組態。如需如何設定 FCoE 介面的相關資訊，請參閱<xref linkend="sec.fcoe.yast" xrefstyle="SectTitleOnPage"/>。
  </para>

  <informalfigure>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="fcoe_inst_disk_activation_a.png" width="80%" format="PNG"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="fcoe_inst_disk_activation_a.png" width="10%" format="PNG"/>
    </imageobject>
   </mediaobject>
  </informalfigure>
  <note>
   <title>掛接點支援</title>
   <para>開機期間，FCoE 裝置將非同步顯示。雖然 initrd 可保證為根檔案系統正確設定這些裝置，但對於任何其他檔案系統或掛接點 (例如 <filename>/usr</filename>)，並無此類保證。因此，任何系統掛接點 (例如 <filename>/usr</filename> 或 <filename>/var</filename>) 都不受支援。如果您想要使用這些裝置，請確認相應的服務和裝置均正確同步。</para>
  </note>
 </sect1>
 <sect1 xml:id="sec.fcoe.install">
  <title>安裝 FCoE 和 YaST FCoE 用戶端</title>

  <para>
   您可透過在交換器上啟用 FCoE 以連接伺服器的方式，於儲存基礎架構中設定 FCoE 磁碟。如果在安裝 <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> 作業系統時 FCoE 磁碟可用，安裝期間會自動安裝 FCoE 啟動器軟體。
  </para>

  <para>
   如果 FCoE 啟動器軟體和 YaST FCoE 用戶端軟體均未安裝，請使用下列程序透過下面的指令手動安裝它們︰
  </para>

<screen>sudo zypper in yast2-fcoe-client fcoe-utils</screen>

  <para>
   您也可以使用 YaST 軟體管理員來安裝以上所列套件。
  </para>
 </sect1>
 <sect1 xml:id="sec.fcoe.yast">
  <title>使用 YaST 管理 FCoE 服務</title>

  <para>
   您可以使用「YaST FCoE 用戶端組態」選項來為光纖通道儲存基礎架構中的 FCoE 磁碟建立、設定和移除 FCoE 介面。若要使用此選項，必須安裝並執行 FCoE 啟動器服務 (<systemitem class="daemon">fcoemon</systemitem> 精靈) 和「連結層探查通訊協定」代理程式精靈 (<systemitem class="daemon">llpad</systemitem>)，並且必須在支援 FCoE 的交換器上啟用 FCoE 連接。
  </para>

  <procedure>
   <step>
    <para>
     啟動 YaST 並選取<menuchoice><guimenu>網路服務</guimenu><guimenu> FCoE 用戶端組態</guimenu></menuchoice>。
    </para>
    <informalfigure>
     <mediaobject>
      <imageobject role="fo">
       <imagedata fileref="fcoe_services_a.png" width="80%" format="PNG"/>
      </imageobject>
      <imageobject role="html">
       <imagedata fileref="fcoe_services_a.png" width="100%" format="PNG"/>
      </imageobject>
     </mediaobject>
    </informalfigure>
   </step>
   <step>
    <para>
     在<guimenu>服務</guimenu>索引標籤上，可以視需要檢視或修改 FCoE 服務和 Lldpad (「連結層探查協定」代理程式精靈) 服務啟動時間。
    </para>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <formalpara>
       <title>啟動 FCoE 服務︰</title>
       <para>
        指定是在伺服器開機時啟動乙太網路光纖通道服務 <command>fcoemon</command> 精靈還是手動啟動。該精靈用於控制 FCoE 介面，並可與 <systemitem class="daemon">llpad</systemitem> 精靈建立連接。值為<guimenu>開機時</guimenu>(預設) 或<guimenu>手動</guimenu>。
       </para>
      </formalpara>
     </listitem>
     <listitem>
      <formalpara>
       <title>啟動 Lldpad 服務︰</title>
       <para>
        指定是在伺服器開機時啟動「連結層探查通訊協定」代理程式 <systemitem class="daemon">llpad</systemitem> 精靈，還是手動啟動該精靈。<systemitem class="daemon">llpad</systemitem> 精靈會向 <command>fcoemon</command> 精靈報告資料中心橋接功能和 FCoE 介面組態的相關資訊。值為<guimenu>開機時</guimenu>(預設) 或<guimenu>手動</guimenu>。
       </para>
      </formalpara>
     </listitem>
    </itemizedlist>
    <para>
     如果修改設定，請按一下<guimenu>確定</guimenu>以儲存並套用變更。
    </para>
   </step>
   <step>
    <para>
     在<guimenu>介面</guimenu>索引標籤上，可以檢視伺服器上所有偵測到的網路卡的相關資訊，包括 VLAN 和 FCoE 組態的相關資訊。您還可以建立 FCoE VLAN 介面、變更現有 FCoE 介面的設定或移除 FCoE 介面。
    </para>
    <informalfigure>
     <mediaobject>
      <imageobject role="fo">
       <imagedata fileref="fcoe_notconfig_interface_a.png" width="80%" format="PNG"/>
      </imageobject>
      <imageobject role="html">
       <imagedata fileref="fcoe_notconfig_interface_a.png" width="100%" format="PNG"/>
      </imageobject>
     </mediaobject>
    </informalfigure>
    <para>
     請使用 <guimenu>FCoE VLAN 介面</guimenu>欄來確定 FCoE 是否可用︰
    </para>
    <variablelist>
     <varlistentry>
      <term><replaceable>介面名稱</replaceable>
      </term>
      <listitem>
       <para>
        如果將名稱 (例如 <filename>eth4.200</filename>) 指定給介面，則 FCoE 在交換器上可用，並會為配接器啟動 FCoE 介面。
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>未設定組態︰</term>
      <listitem>
       <para>
        如果狀態是<guimenu>未設定</guimenu>，則表示在交換器上啟用 FCoE，但是尚未為配接器啟動 FCoE 介面。選取配接器，然後按一下<guimenu>建立 FCoE VLAN 介面</guimenu>以在配接器上啟動介面。
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>不可用︰</term>
      <listitem>
       <para>
        如果狀態是<guimenu>不可用</guimenu>，則表示因為沒有在交換器上為該連接啟用 FCoE，所以 FCoE 對於配接器不可用。
       </para>
      </listitem>
     </varlistentry>
    </variablelist>
   </step>
   <step>
    <para>
     若要設定未經設定之支援 FCoE 的配接卡，請選取它，然後按一下<guimenu>建立 FCoE VLAN 介面</guimenu>。對顯示的問題按一下<guimenu>是</guimenu>確認。
    </para>
    <para>
     該配接卡現在會以某個介面名稱列在 <guimenu>FCoE VLAN 介面</guimenu>欄中。
    </para>
   </step>
   <step>
    <para>
     若要變更已設定配接卡的設定，請在清單中選取它，然後按一下<guimenu>變更設定</guimenu>。
    </para>
    <para>
     可設定下列選項︰
    </para>
    <variablelist>
     <varlistentry>
      <term><guimenu>FCoE 啟用</guimenu>
      </term>
      <listitem>
       <para>
        啟用或停用為配接器建立 FCoE 例項。
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term><guimenu>需要 DCB</guimenu>
      </term>
      <listitem>
       <para>
        指定配接卡是否需要資料中心橋接 (通常會需要)。
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term><guimenu>自動 VLAN</guimenu>
      </term>
      <listitem>
       <para>
        指定 <systemitem class="daemon">fcoemon</systemitem> 精靈是否自動建立 VLAN 介面。
       </para>
      </listitem>
     </varlistentry>
    </variablelist>
    <para>
     如果修改設定，請按一下<guimenu>下一步</guimenu>以儲存並套用變更。這些設定會寫入 <filename>/etc/fcoe/cfg-eth<replaceable>X</replaceable></filename> 檔案中。<systemitem class="daemon">fcoemon</systemitem> 精靈會在啟始化時讀取每個 FCoE 介面的組態檔案。
    </para>
   </step>
   <step>
    <para>
     若要移除已設定的介面，請從清單中選取它。按一下<guimenu>移除介面</guimenu>，然後按一下<guimenu>繼續</guimenu>加以確認。FCoE 介面值會變更為<guimenu>未設定</guimenu>。
    </para>
   </step>
   <step>
    <para>
     在<guimenu>組態</guimenu>索引標籤上，可以檢視或修改 FCoE 系統服務的一般設定。您可以從 FCoE 服務程序檔和 <systemitem class="daemon">fcoemon</systemitem> 精靈中啟用或停用除錯訊息，並可指定是否將訊息傳送至系統記錄。
    </para>
    <informalfigure>
     <mediaobject>
      <imageobject role="fo">
       <imagedata fileref="fcoe_configtab_a.png" width="80%" format="PNG"/>
      </imageobject>
      <imageobject role="html">
       <imagedata fileref="fcoe_configtab_a.png" width="100%" format="PNG"/>
      </imageobject>
     </mediaobject>
    </informalfigure>
   </step>
   <step>
    <para>
     按一下<guimenu>確定</guimenu>以儲存並套用變更。
    </para>
   </step>
  </procedure>
 </sect1>
 <sect1 xml:id="sec.fcoe.cli">
  <title>使用指令設定 FCoE</title>

  <procedure>
   <step>
    <para>
     開啟終端機主控台。
    </para>
   </step>
   <step>
    <para>
     使用 YaST 設定乙太網路的網路介面卡，例如 <filename>eth2</filename>。
    </para>
   </step>
   <step>
    <para>
     啟動「連結層探查通訊協定」代理程式精靈 (<systemitem class="daemon">llpad</systemitem>)。
    </para>
<screen>sudo systemctl start lldpad</screen>
   </step>
   <step>
    <para role="intro">
     在乙太網路卡上啟用資料中心橋接。
    </para>
<screen><prompt>tux &gt; </prompt>dcbtool sc eth2 dcb on
  Version:       2
  Command:       Set Config
  Feature:       DCB State
  Port:          eth2
  Status:        Successful</screen>
   </step>
   <step>
    <para>
     啟用並設定資料中心橋接的優先程度流程控制 (PFC) 設定。
    </para>
<screen>sudo dcbtool sc eth&lt;x&gt; pfc e:1 a:1 w:1</screen>
    <para>
     引數設定值為︰
    </para>
    <variablelist>
     <varlistentry xml:id="bynkj1s">
      <term>e:&lt;0|1&gt;</term>
      <listitem>
       <para>
        控制功能的啟用。
       </para>
      </listitem>
     </varlistentry>
     <varlistentry xml:id="bynkjej">
      <term>a:&lt;0|1&gt;</term>
      <listitem>
       <para>
        控制是否透過資料中心橋接交換通訊協定向對等推廣功能。
       </para>
      </listitem>
     </varlistentry>
     <varlistentry xml:id="bynkjy8">
      <term>w:&lt;0|1&gt;</term>
      <listitem>
       <para>
        控制功能是否希望根據從對等接收到的回饋變更其操作組態。
       </para>
      </listitem>
     </varlistentry>
    </variablelist>
   </step>
   <step>
    <para>
     啟用資料中心橋接以接受交換器的 FCoE 優先程度設定。
    </para>
<screen><prompt>tux &gt; </prompt>sudo dcbtool sc eth2 app:fcoe e:1
  Version:       2
  Command:       Set Config
  Feature:       Application FCoE
  Port:          eth2
  Status:        Successful</screen>
   </step>
   <step>
    <para>
     將預設 FCoE 組態檔案複製到 <filename>/etc/fcoe/cfg-eth2</filename>。
    </para>
<screen>sudo cp /etc/fcoe/cfg-ethx /etc/fcoe/cfg-eth2</screen>
   </step>
   <step>
    <para>
     啟動 FCoE 啟動器服務。
    </para>
<screen>systemctl start fcoe.service</screen>
   </step>
   <step>
    <para>
     將「連結層探查通訊協定」代理程式精靈 (<systemitem class="daemon">llpad</systemitem>) 和 FCoE 啟動器服務設定為開機時啟動。
    </para>
<screen>systemctl enable llpad fcoe</screen>
   </step>
  </procedure>
 </sect1>
 <sect1 xml:id="sec.fcoe.admin">
  <title>使用 FCoE 管理工具管理 FCoE 例項</title>

  <para>
   <command>fcoeadm</command> 公用程式是乙太網路光纖通道 (FCoE) 管理工具。可以在指定網路介面上使用該工具來建立、損毀和重設 FCoE 例項。<command>fcoeadm</command> 公用程式透過通訊端介面將指令傳送給正在執行的 <systemitem class="daemon">fcoemon</systemitem> 程序。如需 <command>fcoemon</command> 的相關資訊，請參閱 <command>man 8 fcoemon</command>。
  </para>

  <para>
   <command>fcoeadm</command> 公用程式可讓您查詢 FCoE 例項的下列相關資訊︰
  </para>

  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>
     介面
    </para>
   </listitem>
   <listitem>
    <para>
     目標 LUN
    </para>
   </listitem>
   <listitem>
    <para>
     連接埠統計資料
    </para>
   </listitem>
  </itemizedlist>

  <para>
   <command>fcoeadm</command> 公用程式是 <filename>fcoe-utils</filename> 套件的一部分。該指令的一般語法如下所示︰
  </para>

<screen>fcoeadm
  [-c|--create] [&lt;ethX&gt;]
  [-d|--destroy] [&lt;ethX&gt;]
  [-r|--reset] [&lt;ethX&gt;]
  [-S|--Scan] [&lt;ethX&gt;]
  [-i|--interface] [&lt;ethX&gt;]
  [-t|--target] [&lt;ethX&gt;]
  [-l|--lun] [&lt;ethX&gt;]
  [-s|--stats &lt;ethX&gt;] [&lt;interval&gt;]
  [-v|--version]
  [-h|--help]
</screen>

  <para>
   如需詳細資料，請參閱 <command>man 8 fcoeadm</command>。
  </para>

  <bridgehead>範例</bridgehead>

  <variablelist>
   <varlistentry>
    <term><command>fcoeadm -c eth2.101</command>
    </term>
    <listitem>
     <para>
      在 eth2.101 上建立 FCoE 例項。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><command>fcoeadm -d eth2.101</command>
    </term>
    <listitem>
     <para>
      損毀 eth2.101 上的 FCoE 例項。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><command>fcoeadm -i eth3</command>
    </term>
    <listitem>
     <para>
      顯示介面 <literal>eth3</literal> 上所有 FCoE 例項的相關資訊。如果未指定任何介面，則會顯示所有已建立 FCoE 例項之介面的相關資訊。下面的範例會顯示連接 eth0.201 的相關資訊︰
     </para>
<screen><prompt>tux &gt; </prompt>sudo fcoeadm -i eth0.201
  Description:      82599EB 10-Gigabit SFI/SFP+ Network Connection 
  Revision:         01
  Manufacturer:     Intel Corporation 
  Serial Number:    001B219B258C 
  Driver:           ixgbe 3.3.8-k2 
  Number of Ports:  1      

      Symbolic Name:     fcoe v0.1 over eth0.201     
      OS Device Name:    host8     
      Node Name:         0x1000001B219B258E     
      Port Name:         0x2000001B219B258E     
      FabricName:        0x2001000573D38141     
      Speed:             10 Gbit     
      Supported Speed:   10 Gbit     
      MaxFrameSize:      2112     
      FC-ID (Port ID):   0x790003     
      State:             Online
</screen>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><command>fcoeadm -l eth3.101</command>
    </term>
    <listitem>
     <para>
      顯示在連接 eth3.101 上探查到的所有 LUN 的詳細資訊。如果未指定任何連接，則會顯示在所有 FCoE 連接上探查到的所有 LUN 的相關資訊。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><command>fcoeadm -r eth2.101</command>
    </term>
    <listitem>
     <para>
      重設 eth2.101 上的 FCoE 例項。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><command>fcoeadm -s eth3 3</command>
    </term>
    <listitem>
     <para>
      以三秒的時間間隔顯示具有 FCoE 例項之特定 eth 3 連接埠的統計資訊。每隔一段時間會顯示一行統計資料。若未指定時間間隔，則使用預設值一秒。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><command>fcoeadm -t eth3</command>
    </term>
    <listitem>
     <para>
      顯示從具有 FCoE 例項之指定 eth3 連接埠探查到的所有目標的相關資訊。每個已探查到的目標後面列出了所有相關聯的 LUN。若未指定例項，則會顯示來自所有具有 FCoE 例項之連接埠的目標。下面的範例顯示來自 eth0.201 連接之目標的相關資訊︰
     </para>
<screen><prompt>tux &gt; </prompt>sudo fcoeadm -t eth0.201  
  Interface:        eth0.201 
  Roles:            FCP Target 
  Node Name:        0x200000D0231B5C72 
  Port Name:        0x210000D0231B5C72 
  Target ID:        0 
  MaxFrameSize:     2048 
  OS Device Name:   rport-8:0-7 
  FC-ID (Port ID):  0x79000C 
  State:            Online  

LUN ID  Device Name   Capacity   Block Size  Description 
------  -----------  ----------  ----------  ----------------------------     
    40  /dev/sdqi     792.84 GB      512     IFT DS S24F-R2840-4 (rev 386C)
    72  /dev/sdpk     650.00 GB      512     IFT DS S24F-R2840-4 (rev 386C)
   168  /dev/sdgy       1.30 TB      512     IFT DS S24F-R2840-4 (rev 386C)
</screen>
    </listitem>
   </varlistentry>
  </variablelist>
 </sect1>
 <sect1 xml:id="sec.fcoe.info">
  <title>其他資訊</title>

  <para>
   如需相關資訊，請參閱以下文件︰
  </para>

  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>
     如需開放式 FCoE 服務精靈的相關資訊，請參閱 <command>fcoemon(8)</command> man 頁面。
    </para>
   </listitem>
   <listitem>
    <para>
     如需開放式 FCoE 管理工具的相關資訊，請參閱 <command>fcoeadm(8)</command> man 頁面。
    </para>
   </listitem>
   <listitem>
    <para>
     如需資料中心橋接組態工具的相關資訊，請參閱 <command>dcbtool(8)</command> man 頁面。
    </para>
   </listitem>
   <listitem>
    <para>
     如需「連結層探查協定」代理程式精靈的相關資訊，請參閱 <filename>lldpad(8)</filename> man 頁面。
    </para>
   </listitem>
   <listitem>
    <para>
     如需一般資訊，請參閱 Open-FCoE 首頁︰<link xlink:href="http://www.open-fcoe.org/dokuwiki/start"/>。
    </para>
   </listitem>
  </itemizedlist>
 </sect1>
</chapter>
