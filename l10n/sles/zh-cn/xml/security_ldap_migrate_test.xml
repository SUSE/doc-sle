<?xml version="1.0" encoding="UTF-8"?>
<sect1 xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="security_ldap_migrate_test.xml" version="5.0" xml:id="sec-security-ldap-migrate">
  <info>
    <title>ä» OpenLDAP è¿ç§»åˆ° 389 Directory Server</title>
    <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
      <dm:translation>yes</dm:translation>
    </dm:docmanager>
  </info>

  <para>
    <phrase os="sles;sled">ä» SUSE Linux Enterprise 15 SP3 å¼€å§‹</phrase>ï¼ŒOpenLDAP å·²å¼ƒç”¨ä¸”ä¸å†å—æ”¯æŒã€‚å®ƒå·²ç”± 389 Directory Server å–ä»£ã€‚SUSE æä¾›äº† <command>openldap_to_ds</command> å®ç”¨ç¨‹åºç”¨äºå¸®åŠ©è¿ç§»ï¼Œè¯¥å®ç”¨ç¨‹åºéšé™„åœ¨ <package>389-ds</package> è½¯ä»¶åŒ…ä¸­ã€‚
  </para>

  <para>
    <command>openldap_to_ds</command> å®ç”¨ç¨‹åºä¼šè‡ªåŠ¨æ‰§è¡Œå°½å¯èƒ½å¤šçš„è¿ç§»å·¥ä½œã€‚ä½†æ˜¯ï¼Œæ¯ä¸ª LDAP éƒ¨ç½²å„ä¸ç›¸åŒï¼Œå› æ­¤æˆ‘ä»¬æ— æ³•å¼€å‘é€‚åˆæ‰€æœ‰æƒ…å†µçš„å·¥å…·ã€‚è¯·åœ¨å¿…è¦æ—¶è¿›è¡Œå¹²é¢„å¹¶æ‰§è¡Œæ‰‹åŠ¨æ­¥éª¤ã€‚æ­¤å¤–è¿˜éœ€åœ¨å°è¯•è¿›è¡Œç”Ÿäº§è¿ç§»ä¹‹å‰å…¨é¢æµ‹è¯•æ‚¨çš„è¿ç§»è¿‡ç¨‹ã€‚
  </para>

  <important>
    <title>æŸ¥çœ‹ <command>help</command> é¡µé¢</title>
    <para>
      åœ¨ä½¿ç”¨ <command>openldap_to_ds</command> è¿ç§»å·¥å…·ä¹‹å‰ï¼Œå¼ºçƒˆå»ºè®®æ‚¨æŸ¥çœ‹ <command>openldap_to_ds
      --help</command> çš„è¾“å‡ºã€‚å®ƒæœ‰åŠ©äºæ‚¨äº†è§£è¿ç§»å·¥å…·çš„åŠŸèƒ½å’Œé™åˆ¶ï¼Œå¹¶é˜²æ­¢æ‚¨åšå‡ºé”™è¯¯çš„å‡è®¾ã€‚
    </para>
  </important>

  <sect2 xml:id="sec-security-ldap-migrate-test">
    <title>æµ‹è¯•ä» OpenLDAP è¿ç§»</title>
    <para>
      ç”±äº OpenLDAP ä¸ 389 Directory Server çš„å·®å¼‚éå¸¸å¤§ï¼Œå› æ­¤éœ€è¦å¯¹è¿ç§»è¿›è¡Œåå¤æµ‹è¯•å’Œè°ƒæ•´ã€‚æ‰§è¡Œå¿«é€Ÿè¿ç§»æµ‹è¯•ä¼šå¾ˆæœ‰å¸®åŠ©ï¼Œè¿™æ ·å¯å¤§è‡´äº†è§£éœ€è¦æ‰§è¡Œå“ªäº›æ­¥éª¤æ‰èƒ½ç¡®ä¿è¿ç§»æˆåŠŸã€‚
    </para>
    <para>
      å…ˆå†³æ¡ä»¶ï¼š
    </para>
    <itemizedlist>
      <listitem>
        <para>
          æ­£åœ¨è¿è¡Œçš„ 389 Directory Server å®ä¾‹
        </para>
      </listitem>
      <listitem>
        <para>
          é‡‡ç”¨åŠ¨æ€ ldif æ ¼å¼çš„ OpenLDAP <filename>slapd</filename> é…ç½®æ–‡ä»¶æˆ–ç›®å½•
        </para>
      </listitem>
      <listitem>
        <para>
          OpenLDAP æ•°æ®åº“çš„ ldif æ–‡ä»¶å¤‡ä»½
        </para>
      </listitem>
    </itemizedlist>
    <para>
      å¦‚æœæ‚¨çš„ slapd é…ç½®ä¸æ˜¯åŠ¨æ€ ldif æ ¼å¼ï¼Œè¯·ä½¿ç”¨ <command>slaptest</command> åˆ›å»ºåŠ¨æ€å‰¯æœ¬ã€‚åˆ›å»ºä¸€ä¸ª <filename>slapd.d</filename> ç›®å½•ï¼ˆä¾‹å¦‚ <filename>/root/slapd.d/</filename>ï¼‰ï¼Œç„¶åè¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š
    </para>
<screen><prompt>&gt; </prompt><command>sudo</command> <command>slaptest -f /etc/openldap/slapd.conf -F /root/slapd.d</command>
     </screen>
    <para>
      è¿™ä¼šç”Ÿæˆå‡ ä¸ªç±»ä¼¼äºä»¥ä¸‹ç¤ºä¾‹çš„æ–‡ä»¶ï¼š
    </para>
<screen><prompt>&gt; </prompt><command>sudo</command> <command>ls /root/slapd.d/*</command>

/root/slapd.d/cn=config.ldif

/root/slapd.d/cn=config:
cn=module{0}.ldif  cn=schema.ldif                 olcDatabase={0}config.ldif
cn=schema          olcDatabase={-1}frontend.ldif  olcDatabase={1}mdb.ldif
</screen>
    <para>
      ä¸ºæ¯ä¸ªåç¼€åˆ›å»ºä¸€ä¸ª ldif æ–‡ä»¶ã€‚åœ¨ä»¥ä¸‹ç¤ºä¾‹ä¸­ï¼Œåç¼€ä¸º dc=<replaceable>LDAP1</replaceable>,dc=<replaceable>COM</replaceable>ã€‚å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯ <filename>/etc/openldap/slapd.conf</filename> æ ¼å¼ï¼Œè¯·è¿è¡Œä»¥ä¸‹å‘½ä»¤åˆ›å»º ldif å¤‡ä»½æ–‡ä»¶ï¼š
    </para>
<screen>
<prompt>&gt; </prompt><command>sudo</command> <command>slapcat -f /etc/openldap/slapd.conf -b dc=<replaceable>LDAP1</replaceable>,dc=<replaceable>COM</replaceable></command> \
<command>-l <replaceable>/root/LDAP1-COM</replaceable>.ldif</command>
   </screen>
    <para>
      ä½¿ç”¨ <command>openldap_to_ds</command> åˆ†æé…ç½®å’Œæ–‡ä»¶ï¼Œå¹¶æ˜¾ç¤ºè¿ç§»è®¡åˆ’è€Œä¸æ›´æ”¹ä»»ä½•å†…å®¹ï¼š
    </para>
<screen><prompt>&gt; </prompt><command>sudo</command> <command>openldap_to_ds <replaceable>LDAP1</replaceable></command>\
<command>/root/slapd.d <replaceable>/root/LDAP1-COM</replaceable>.ldif.ldif</command></screen>
    <para>
      è¿™ä¼šæ‰§è¡Œè¯•è¿è¡Œï¼Œä½†ä¸æ›´æ”¹ä»»ä½•å†…å®¹ã€‚è¾“å‡ºå¦‚ä¸‹æ‰€ç¤ºï¼š
    </para>
<screen>Examining OpenLDAP Configuration ...
Completed OpenLDAP Configuration Parsing.
Examining Ldifs ...
Completed Ldif Metadata Parsing.
The following migration steps will be performed:
 * Schema Skip Unsupported Attribute -&gt; otherMailbox (0.9.2342.19200300.100.1.22)
 * Schema Skip Unsupported Attribute -&gt; dSAQuality (0.9.2342.19200300.100.1.49)
 * Schema Skip Unsupported Attribute -&gt; singleLevelQuality (0.9.2342.19200300.100.1.50)
 * Schema Skip Unsupported Attribute -&gt; subtreeMinimumQuality (0.9.2342.19200300.100.1.51)
 * Schema Skip Unsupported Attribute -&gt; subtreeMaximumQuality (0.9.2342.19200300.100.1.52)
 * Schema Create Attribute -&gt; suseDefaultBase (SUSE.YaST.ModuleConfig.Attr:2)
 * Schema Create Attribute -&gt; suseNextUniqueId (SUSE.YaST.ModuleConfig.Attr:3)
[...]
 * Schema Create ObjectClass -&gt; suseDhcpConfiguration (SUSE.YaST.ModuleConfig.OC:10)
 * Schema Create ObjectClass -&gt; suseMailConfiguration (SUSE.YaST.ModuleConfig.OC:11)
 * Database Reindex -&gt; dc=example,dc=com
 * Database Import Ldif -&gt; dc=example,dc=com from example.ldif -
excluding entry attributes = [{'structuralobjectclass', 'entrycsn'}]
No actions taken. To apply migration plan, use '--confirm'
</screen>
    <para>
      ä»¥ä¸‹ç¤ºä¾‹ä¼šæ‰§è¡Œè¿ç§»ï¼Œå…¶è¾“å‡ºä¸è¯•è¿è¡Œåçš„è¾“å‡ºä¸åŒï¼š
    </para>
    <screen><?dbfo keep-together="always"?>

  <prompt>&gt; </prompt><command>sudo</command> <command>openldap_to_ds <replaceable>LDAP1</replaceable> /root/slapd.d <replaceable>/root/LDAP1-COM</replaceable>.ldif --confirm</command>
Starting Migration ... This may take some time ...
migration: 1 / 40 complete ...
migration: 2 / 40 complete ...
migration: 3 / 40 complete ...
[...]
Index task index_all_05252021_120216 completed successfully
post: 39 / 40 complete ...
post: 40 / 40 complete ...
ğŸ‰ Migration complete!
----------------------
You should now review your instance configuration and data:
 * [ ] - Create/Migrate Database Access Controls (ACI)
 * [ ] - Enable and Verify TLS (LDAPS) Operation
 * [ ] - Schedule Automatic Backups
 * [ ] - Verify Accounts Can Bind Correctly
 * [ ] - Review Schema Inconistent ObjectClass -&gt; pilotOrganization (0.9.2342.19200300.100.4.20)
 * [ ] - Review Database Imported Content is Correct -&gt; dc=ldap1,dc=com
</screen>
    <para>
      è¿ç§»å®Œæˆåï¼Œ<command>openldap_to_ds</command> ä¼šåˆ›å»ºå¿…é¡»å®Œæˆçš„è¿ç§»åä»»åŠ¡æ ¸å¯¹æ¸…å•ã€‚æœ€å¥½è®°å½•è¿ç§»åæ­¥éª¤ï¼Œä»¥ä¾¿å¯ä»¥åœ¨åæœŸç”Ÿäº§è¿‡ç¨‹ä¸­å†ç°è¿™äº›æ­¥éª¤ã€‚ç„¶åæµ‹è¯•å®¢æˆ·ç«¯å’Œåº”ç”¨ç¨‹åºä¸è¿ç§»å 389 Directory Server å®ä¾‹çš„é›†æˆã€‚
    </para>
    <important>
      <title>åˆ¶å®šå›æ»šè®¡åˆ’</title>
      <para>
        åˆ¶å®šå›æ»šè®¡åˆ’ä»¥é˜²å‘ç”Ÿä»»ä½•å¤±è´¥ã€‚æ­¤è®¡åˆ’åº”è¯¥å®šä¹‰æˆåŠŸè¿ç§»çš„è¦ç´ ã€ç”¨äºç¡®å®šå“ªäº›æ–¹é¢æ­£å¸¸ä»¥åŠå“ªäº›æ–¹é¢éœ€è¦ä¿®å¤çš„æµ‹è¯•ã€è‡³å…³é‡è¦çš„æ­¥éª¤ã€å¯ä»¥æ¨è¿Ÿçš„äº‹é¡¹ã€å¦‚ä½•ç¡®å®šä½•æ—¶æ’¤æ¶ˆæ›´æ”¹ã€å¦‚ä½•åœ¨å°½é‡å‡å°‘æœåŠ¡ä¸­æ–­çš„æƒ…å†µä¸‹æ’¤æ¶ˆæ›´æ”¹ï¼Œä»¥åŠå…¶ä»–å“ªäº›å›¢é˜Ÿéœ€è¦å‚ä¸è¿ç§»ã€‚
      </para>
    </important>
    <para>
      ç”±äºéƒ¨ç½²çš„å¯å˜æ€§ï¼Œå¾ˆéš¾æä¾›æˆåŠŸè¿›è¡Œç”Ÿäº§è¿ç§»çš„é€šç”¨æ–¹æ³•ã€‚åœ¨å…¨é¢æµ‹è¯•è¿ç§»è¿‡ç¨‹å¹¶ç¡®è®¤ç»“æœæ­£å¸¸åï¼Œä»¥ä¸‹å¸¸è§„æ­¥éª¤å°†æœ‰åŠ©äºï¼š
    </para>
    <itemizedlist>
      <listitem>
        <para>
          åœ¨åšå‡ºæ›´æ”¹ä¹‹å‰çš„ 48 å°æ—¶å°†æ‰€æœ‰ä¸»æœºå/DNS TTL å‡å°‘è‡³ 5 åˆ†é’Ÿï¼Œä»¥ä¾¿èƒ½å¤Ÿå¿«é€Ÿå›æ»šåˆ°ç°æœ‰çš„ OpenLDAP éƒ¨ç½²ã€‚
        </para>
      </listitem>
      <listitem>
        <para>
          æš‚åœæ‰€æœ‰æ•°æ®åŒæ­¥å’Œä¼ å…¥æ•°æ®è¿‡ç¨‹ï¼Œä»¥ç¡®ä¿ OpenLDAP ç¯å¢ƒä¸­çš„æ•°æ®åœ¨è¿ç§»æœŸé—´ä¸ä¼šæ›´æ”¹ã€‚
        </para>
      </listitem>
      <listitem>
        <para>
          åœ¨è¿ç§»ä¹‹å‰å‡†å¤‡å¥½æ‰€æœ‰è¦éƒ¨ç½² 389 Directory Server çš„ä¸»æœºã€‚
        </para>
      </listitem>
      <listitem>
        <para>
          å‡†å¤‡å¥½æµ‹è¯•è¿ç§»æ–‡æ¡£ã€‚
        </para>
      </listitem>
    </itemizedlist>
  </sect2>

  <sect2 xml:id="sec-security-ldap-migrate-saslauthd">
    <title>æµ‹è¯•ä½¿ç”¨ <literal>saslauthd</literal> çš„ OpenLDAP æœåŠ¡å™¨è¿ç§»</title>
    <para>
      åœ¨ OpenLDAP éƒ¨ç½²ä¸­ï¼Œå¸¸ä¼šä½¿ç”¨ <literal>saslauthd</literal> æ¥è¿›è¡Œç”¨æˆ·çš„ç›´é€šèº«ä»½éªŒè¯ã€‚èº«ä»½éªŒè¯è¿‡ç¨‹æ¶‰åŠä»¥ä¸‹ç»„ä»¶ï¼š
    </para>
<screen>
 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 â”‚                 â”‚
 â”‚   LDAP client   â”‚
 â”‚                 â”‚
 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
      binds to
          â”‚
          â–¼
 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 â”‚    OpenLDAP     â”‚
 â”‚     server      â”‚
 â”‚                 â”‚
 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”‚
          â–¼
 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 â”‚                 â”‚
 â”‚    saslauthd    â”‚
 â”‚                 â”‚
 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”‚
          â–¼
 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 â”‚                 â”‚
 â”‚  External auth  â”‚
 â”‚                 â”‚
 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</screen>
    <para>
      ä¸ºäº†æ£€æŸ¥é…ç½®çš„æ­£ç¡®æ€§ä»¥åŠä»¥åè¿›è¡Œæ•…éšœæ’é™¤ï¼ŒåŠ¡å¿…è¦äº†è§£ä»¥ä¸‹ä¿¡æ¯ï¼š
    </para>
    <itemizedlist>
      <listitem>
        <para>
          å¦‚æœ <literal>userPassword</literal> å±æ€§çš„å€¼é‡‡ç”¨ <literal>userPassword:
          {SASL}<replaceable>USERNAME@REALM</replaceable></literal> æ ¼å¼ï¼Œåˆ™ OpenLDAP ä¼šå‘ç°å…è®¸å¯¹ç”¨æˆ·è¿›è¡Œç›´é€šèº«ä»½éªŒè¯ã€‚å‰ææ˜¯è¦æ„å»º OpenLDAP æœåŠ¡å™¨ï¼Œå¹¶è®¾ç½® <literal>--enable-spasswd</literal> é€‰é¡¹ä»¥å¯ç”¨ç›´é€šèº«ä»½éªŒè¯ã€‚
        </para>
      </listitem>
      <listitem>
        <para>
          OpenLDAP é€šè¿‡ <filename>/usr/lib/sasl2/slapd.conf</filename> é…ç½®ä¸ <literal>saslauthd</literal> çš„è¿æ¥ã€‚
        </para>
      </listitem>
      <listitem>
        <para>
          <literal>saslauthd</literal> ä¼šä½¿ç”¨ <literal>/etc/sysconfig/saslauthd</literal> ä¸­é…ç½®çš„å‘½ä»¤è¡Œå‚æ•°æ¥å‘ç°ç›¸å…³æ¨¡å—ã€‚
        </para>
      </listitem>
      <listitem>
        <para>
          <literal>saslauthd</literal> çš„åç«¯æ¨¡å—åˆ™ä½¿ç”¨è‡ªå·±çš„é…ç½®ï¼ˆå¦‚ <command>man saslauthd</command> ä¸­æ‰€è¿°ï¼‰ã€‚
        </para>
      </listitem>
    </itemizedlist>
    <para>
      æœ‰å…³ä½¿ç”¨ OpenLDAP çš„ç›´é€šèº«ä»½éªŒè¯çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è§å®˜æ–¹ <link xlink:href="https://openldap.org/doc/admin24/security.html#Pass-Through%20authentication">OpenLDAP
      Admin Guide</link>ã€‚
    </para>
    <sect3 xml:id="sec-security-ldap-migrate-saslauthd-procedure">
      <title>å°† SASL ç›´é€šèº«ä»½éªŒè¯ä» OpenLDAP è¿ç§»åˆ° 389 Directory Server</title>
      <para>
        ä¸ºéµå¾ªå°† SASL ç›´é€šèº«ä»½éªŒè¯ä» OpenLDAP æ­£ç¡®è¿ç§»åˆ° 389 Directory Server çš„æœ€ä½³å®è·µï¼Œè¯·æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼š
      </para>
      <procedure>
        <step>
          <para>
            åœ¨è¿ç§»ä¹‹å‰ï¼Œç¡®ä¿æ‚¨å¯ä»¥åœ¨ OpenLDAP æœåŠ¡å™¨ä¸ŠæˆåŠŸè¿è¡Œ <command>testsaslauthd</command>ã€‚
          </para>
<screen><prompt>&gt; </prompt><command>sudo</command> <command>testsaslauthd -u <replaceable>USERNAME@REALM</replaceable> -p <replaceable>PASSWORD</replaceable></command></screen>
          <para>
            è¯¥é¢†åŸŸä¼šå°†èº«ä»½éªŒè¯è·¯ç”±åˆ° <literal>saslauthd</literal> ä¸­çš„æ­£ç¡®åç«¯ï¼Œç„¶åä½¿ç”¨ç”¨æˆ·åæ¥æ£€æŸ¥èº«ä»½ã€‚
          </para>
        </step>
        <step>
          <para>
            å®‰è£…å¯ä½¿ 389 Directory Server èƒ½ä¸ <literal>saslauthd</literal> è¿æ¥çš„è½¯ä»¶åŒ… <package>pam_saslauthd</package>ã€‚
          </para>
<screen><prompt>&gt; </prompt><command>sudo</command> <command>zypper install -y pam_saslauthd</command></screen>
        </step>
        <step>
          <para>
            è¿è¡Œ <command>openldap_to_ds</command> å‘½ä»¤è¡Œå·¥å…·ä» OpenLDAP è¿ç§»åˆ° 389 Directory Serverã€‚æœ‰å…³è¯¥è¿ç§»è¿‡ç¨‹çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è§<xref linkend="sec-security-ldap-migrate-test"/>ã€‚
          </para>
          <note>
            <para>
              åœ¨ <command>openldap_to_ds</command> è¿›ç¨‹è¿è¡Œæ—¶ï¼Œå¦‚æœæ£€æµ‹åˆ°æŸç”¨æˆ· <literal>userPssword</literal> å±æ€§çš„å€¼é‡‡ç”¨ <literal>userPassword:
              {SASL}<replaceable>USERNAME@REALM</replaceable></literal> æ ¼å¼ï¼Œåˆ™ä¼šå°†è¯¥å€¼å»é™¤å¹¶è®¾ç½®ä¸º <literal>nsSaslauthId</literal> å±æ€§çš„å€¼ï¼ˆé‡‡ç”¨ <literal>nsSaslauthId:
              <replaceable>USERNAME@REALM</replaceable></literal> æ ¼å¼ï¼‰ã€‚æ­¤å¤–ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨æ·»åŠ å±æ€§å€¼ <literal>objectClass:
              nsSaslauthAccount</literal> ä»¥æ”¯æŒä¿®æ”¹ã€‚
            </para>
          </note>
        </step>
        <step>
          <para>
            è¿ç§»å®Œæˆåï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤æ£€æŸ¥æ˜¯å¦æ­£ç¡®é…ç½®äº† PAM ç›´é€šèº«ä»½éªŒè¯ï¼š
          </para>
<screen><prompt>&gt; </prompt><command>sudo</command> <command>dsconf <replaceable>INSTANCE</replaceable> plugin pam-pass-through-auth show</command></screen>
<screen><prompt>&gt; </prompt><command>sudo</command> <command>dsconf <replaceable>INSTANCE</replaceable> plugin pam-pass-through-auth list</command></screen>
        </step>
      </procedure>
      <para>
        æˆåŠŸè¿ç§»åï¼Œç›´é€šèº«ä»½éªŒè¯æµç¨‹æ¶‰åŠä»¥ä¸‹ç»„ä»¶ï¼š
      </para>
<screen><?dbfo keep-together="always"?>

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                 â”‚
  â”‚   LDAP client   â”‚
  â”‚                 â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
       binds to
           â”‚
           â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚     389-DS      â”‚
  â”‚     server      â”‚
  â”‚                 â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                 â”‚
  â”‚  pam saslauthd  â”‚
  â”‚                 â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                 â”‚
  â”‚    saslauthd    â”‚
  â”‚                 â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚
           â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                 â”‚
  â”‚  External auth  â”‚
  â”‚                 â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

</screen>
    </sect3>
    <sect3 xml:id="sec-security-ldap-troubleshoot-saslauthd">
      <title><literal>saslauthd</literal> ç›´é€šèº«ä»½éªŒè¯æŸ¥é”™</title>
      <para>
        è¦å¯¹ä» OpenLDAP è¿ç§»åˆ° 389 Directory Server ä¹‹å‰å’Œä¹‹åçš„ <literal>saslauthd</literal> ç›´é€šèº«ä»½éªŒè¯é—®é¢˜æŸ¥é”™ï¼Œè¯·å‚è§ä»¥ä¸‹æç¤ºï¼š
      </para>
      <variablelist>
        <varlistentry>
          <term>ç¡®ä¿ <command>testsaslauthd</command> é€‚ç”¨äº <replaceable>USERNAME@REALM</replaceable>ã€‚</term>
          <listitem>
            <para>
              è¯·å‚è§<xref linkend="sec-security-ldap-migrate-saslauthd"/>ä¸­è¿è¡Œ <command>testsaslauthd</command> çš„æ­¥éª¤ã€‚
            </para>
            <para>
              å¦‚æœå‡ºç°é—®é¢˜ï¼Œè¯·å°è¯•ä»¥ä¸‹æ–¹æ³•ï¼š
            </para>
            <itemizedlist>
              <listitem>
                <para>
                  æ£€æŸ¥ <filename>/etc/sysconfig/saslauthd</filename>ï¼Œç¡®ä¿ <literal>saslauthd</literal> åç«¯æ¨¡å—é…ç½®æ­£ç¡®ã€‚æœ‰å…³ <literal>saslauthd</literal> åç«¯æ¨¡å—åŠå…¶é…ç½®çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·è¿è¡Œ <command>man saslauthd</command>
                </para>
              </listitem>
              <listitem>
                <para>
                  åœ¨ <filename>/etc/sysconfig/saslauthd</filename> ä¸­æ·»åŠ  <literal>SASLAUTHD_PARAMS="-d"</literal> ä»¥å¯ç”¨è°ƒè¯•æ—¥å¿—è®°å½•ã€‚
                </para>
              </listitem>
              <listitem>
                <para>
                  æŸ¥çœ‹ <command>journalctl</command> å‘½ä»¤è¾“å‡ºä¸­çš„ <literal>saslauthd</literal> æ—¥å¿—ã€‚
                </para>
              </listitem>
            </itemizedlist>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term>ç¡®ä¿ PAM <literal>saslauthd</literal> å¯æ­£å¸¸å·¥ä½œã€‚</term>
          <listitem>
            <para>
              è¦æ£€æŸ¥ PAM <literal>saslauthd</literal> æ˜¯å¦æ­£å¸¸å·¥ä½œï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ <link xlink:href="https://github.com/kanidm/pam_tester"/> ä¸Šæä¾›çš„ <command>pam_tester</command> å·¥å…·ã€‚
            </para>
            <note>
              <para>
                <command>pam_tester</command> å·¥å…·ä¸å—å®˜æ–¹æ”¯æŒã€‚
              </para>
            </note>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term>ç¡®ä¿å·²å¯ç”¨ PAM Pass Through Auth æ’ä»¶ã€‚</term>
          <listitem>
            <para>
              è¿è¡Œä»¥ä¸‹å‘½ä»¤æ£€æŸ¥ PAM Pass Through Auth æ’ä»¶çš„çŠ¶æ€ï¼š
            </para>
<screen><prompt>&gt; </prompt><command>sudo</command> <command>dsconf <replaceable>INSTANCE</replaceable> plugin pam-passt-through-auth status</command></screen>
            <para>
              è¦å¯ç”¨è¯¥æ’ä»¶ï¼Œè¯·è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š
            </para>
<screen><prompt>&gt; </prompt><command>sudo</command> <command>dsconf <replaceable>INSTANCE</replaceable> plugin pam-pass-through-auth enable</command></screen>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term>æ£€æŸ¥ PAM Pass Through Auth æ’ä»¶çš„é…ç½®ã€‚</term>
          <listitem>
            <para>
              è¦æ£€æŸ¥æœåŠ¡å™¨å®ä¾‹çš„ PAM Pass Through Auth æ’ä»¶é…ç½®ï¼Œè¯·è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š
            </para>
<screen><prompt>&gt; </prompt><command>sudo</command> <command>dsconf <replaceable>INSTANCE</replaceable> plugin pam-pass-through-auth show</command></screen>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term>æ£€æŸ¥æœåŠ¡å™¨å®ä¾‹çš„ç”¨æˆ·é”™è¯¯æ—¥å¿—ã€‚</term>
          <listitem>
            <para>
              æ£€æŸ¥ <filename>/var/lib/<replaceable>SERVER_USER_NAME</replaceable>/<replaceable>INSTANCE</replaceable>/error</filename> ä¸­çš„æ—¥å¿—ã€‚
            </para>
          </listitem>
        </varlistentry>
      </variablelist>
    </sect3>
  </sect2>

  <sect2 xml:id="sec-security-ldap-migrate-plan">
    <title>è§„åˆ’è¿ç§»</title>
    <para>
      ç”±äº OpenLDAP å¦‚åŒä¸€ä¸ª<quote>é›¶ä»¶ç®±</quote>ä¸”é«˜åº¦å¯è‡ªå®šä¹‰ï¼Œå› æ­¤æ— æ³•åˆ¶å®šå‡º<quote>æ”¾ä¹‹å››æµ·çš†å‡†</quote>çš„è¿ç§»è®¡åˆ’ã€‚å› è€Œæœ‰å¿…è¦é’ˆå¯¹ OpenLDAP å’Œå…¶ä»–é›†æˆè¯„ä¼°æ‚¨çš„å½“å‰ç¯å¢ƒå’Œé…ç½®ã€‚è¿™åŒ…æ‹¬ä½†ä¸é™äºï¼š
    </para>
    <itemizedlist>
      <listitem>
        <para>
          å¤åˆ¶æ‹“æ‰‘
        </para>
      </listitem>
      <listitem>
        <para>
          é«˜å¯ç”¨æ€§å’Œè´Ÿè½½å¹³è¡¡å™¨é…ç½®
        </para>
      </listitem>
      <listitem>
        <para>
          å¤–éƒ¨æ•°æ®æµï¼ˆIGAã€HRã€AD ç­‰ï¼‰
        </para>
      </listitem>
      <listitem>
        <para>
          é…ç½®çš„å åŠ ç»„ä»¶ï¼ˆ389 Directory Server ä¸­çš„æ’ä»¶ï¼‰
        </para>
      </listitem>
      <listitem>
        <para>
          å®¢æˆ·ç«¯é…ç½®å’Œé¢„æœŸçš„æœåŠ¡å™¨åŠŸèƒ½
        </para>
      </listitem>
      <listitem>
        <para>
          è‡ªå®šä¹‰çº²è¦
        </para>
      </listitem>
      <listitem>
        <para>
          TLS é…ç½®
        </para>
      </listitem>
    </itemizedlist>
    <para>
      è§„åˆ’ 389 Directory Server éƒ¨ç½²çš„æœ€ç»ˆå¤§è‡´ç»“æœã€‚æ­¤é¡¹è§„åˆ’åŒ…å«çš„å†…å®¹ä¸ä¸Šé¢çš„åˆ—è¡¨ç›¸åŒï¼Œä¸è¿‡éœ€è¦å°†å åŠ ç»„ä»¶æ›¿æ¢ä¸ºæ’ä»¶ã€‚è¯„ä¼°å½“å‰ç¯å¢ƒå¹¶è§„åˆ’æ‚¨é¢„æœŸçš„ 389 Directory Server ç¯å¢ƒåï¼Œä¾¿å¯ä»¥åˆ¶å®šè¿ç§»è®¡åˆ’ã€‚å»ºè®®æ„å»ºä¸ OpenLDAP ç¯å¢ƒå¹¶è¡Œçš„ 389 Directory Server ç¯å¢ƒï¼Œä»¥ä¾¿å¯ä»¥åœ¨ä¸¤è€…ä¹‹é—´åˆ‡æ¢ã€‚
    </para>
    <para>
      ä» OpenLDAP è¿ç§»åˆ° 389 Directory Server å±äºå•å‘è¿ç§»ã€‚ä¸¤è€…ä¹‹é—´çš„å·®å¼‚ç›¸å½“å¤§ï¼Œå› æ­¤å®ƒä»¬ä¸å¯äº’æ“ä½œï¼Œå¹¶ä¸”ä¸å­˜åœ¨ä» 389 Directory Server åˆ° OpenLDAP çš„è¿ç§»è·¯å¾„ã€‚ä¸‹è¡¨é‡ç‚¹æŒ‡å‡ºäº†ä¸¤è€…çš„ä¸»è¦ç›¸ä¼¼å’Œä¸åŒä¹‹å¤„ã€‚
    </para>
    <informaltable>
      <tgroup cols="4">
        <thead>
          <row>
            <entry>åŠŸèƒ½</entry>
            <entry>OpenLDAP</entry>
            <entry>389 Directory Server</entry>
            <entry>å…¼å®¹</entry>
          </row>
        </thead>
        <tbody>
          <row>
            <entry>åŒå‘å¤åˆ¶</entry>
            <entry>SyncREPL</entry>
            <entry>ç‰¹å®šäº 389 DS çš„ç³»ç»Ÿ</entry>
            <entry>å¦</entry>
          </row>
          <row>
            <entry>MemberOf</entry>
            <entry>å åŠ ç»„ä»¶</entry>
            <entry>æ’ä»¶</entry>
            <entry>æ˜¯ï¼Œä»…é™ç®€å•é…ç½®</entry>
          </row>
          <row>
            <entry>å¤–éƒ¨èº«ä»½éªŒè¯</entry>
            <entry>ä»£ç†</entry>
            <entry>-</entry>
            <entry>å¦</entry>
          </row>
          <row>
            <entry>Active Directory åŒæ­¥</entry>
            <entry>-</entry>
            <entry>Winsync æ’ä»¶</entry>
            <entry>å¦</entry>
          </row>
          <row>
            <entry>å†…ç½®çº²è¦</entry>
            <entry>OLDAP çº²è¦</entry>
            <entry>389 Directory Server çº²è¦</entry>
            <entry>æ˜¯ï¼Œå—è¿ç§»å·¥å…·æ”¯æŒ</entry>
          </row>
          <row>
            <entry>è‡ªå®šä¹‰çº²è¦</entry>
            <entry>OLDAP çº²è¦</entry>
            <entry>389 Directory Server çº²è¦</entry>
            <entry>æ˜¯ï¼Œå—è¿ç§»å·¥å…·æ”¯æŒ</entry>
          </row>
          <row>
            <entry>æ•°æ®åº“å¯¼å…¥</entry>
            <entry>LDIF</entry>
            <entry>LDIF</entry>
            <entry>æ˜¯ï¼Œå—è¿ç§»å·¥å…·æ”¯æŒ</entry>
          </row>
          <row>
            <entry>å£ä»¤å“ˆå¸Œ</entry>
            <entry>ä¸ç¡®å®š</entry>
            <entry>ä¸ç¡®å®š</entry>
            <entry>æ˜¯ï¼Œæ”¯æŒé™¤ Argon2 ä»¥å¤–çš„æ‰€æœ‰æ ¼å¼</entry>
          </row>
          <row>
            <entry>OpenLDAP åˆ° 389 DS çš„å¤åˆ¶</entry>
            <entry>-</entry>
            <entry>-</entry>
            <entry>ä¸æä¾›ç”¨äºå¤åˆ¶åˆ° 389 DS çš„æœºåˆ¶</entry>
          </row>
          <row>
            <entry>åŸºäºæ—¶é—´çš„ä¸€æ¬¡æ€§å£ä»¤ (TOTP)</entry>
            <entry>TOTP å åŠ ç»„ä»¶</entry>
            <entry>-</entry>
            <entry>å¦ï¼Œç›®å‰ä¸æ”¯æŒ</entry>
          </row>
          <row>
            <entry>entryUUID</entry>
            <entry>OpenLDAP çš„ç»„æˆéƒ¨åˆ†</entry>
            <entry>æ’ä»¶</entry>
            <entry>æ˜¯</entry>
          </row>
        </tbody>
      </tgroup>
    </informaltable>
  </sect2>
</sect1>
