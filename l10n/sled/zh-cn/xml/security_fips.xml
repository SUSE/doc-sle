<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="security_fips.xml" version="5.0" xml:id="cha-security-fips">
 <title>确保符合 FIPS 140-2 标准</title>
 <info>
  <abstract>
   <para>
     如果您的组织要为美国联邦政府履行任何责任，那么，您的加密应用程序（例如 openSSL、GnuTLS 和 OpenJDK）很可能需要符合联邦信息处理标准 (FIPS) 140-2。FIPS 140-2 是一个安全认证程序，用于验证私营公司生产的加密模块。如果合规性规则不要求您的组织以 FIPS 模式运行 SUSE Linux Enterprise，则最好不要以这种模式运行。本章提供有关启用 FIPS 模式的指导，以及包含详细信息的资源的链接。
   </para>
  </abstract>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:bugtracker/>
   <dm:translation>yes</dm:translation>
  </dm:docmanager>
 </info>

<sect1 xml:id="sec-fips-concept">
  <title>FIPS 140-2 概览</title>

  <warning>
    <title>实施 FIPS 需要具备专业知识</title>
    <para>
      FIPS 的管理非常复杂，需要具备丰富的专业知识。正确实施、测试 FIPS 以及对其进行查错都需要很高的知识水平。
    </para>
  </warning>

  <para>
    开发和维护加密应用程序并想要测试其 FIPS 合规性的每家供应商必须将其提交到加密模块验证程序 (CMVP)（请参见 <link xlink:href="https://csrc.nist.gov/projects/cryptographic-module-validation-program"/>）。
  </para>
  <para>
    目前有两项 FIPS 加密标准：FIPS 140-2 和 FIPS 140-3。FIPS 140-2 标准在 2002 年已定稿，有效期截至 2026 年 9 月 22 日。FIPS 140-3 标准在 2019 年 3 月已获批准，并在逐步取代 140-2。CMVP 不再接受 FIPS 140-2 测试模块，而仅接受 FIPS 140-3 测试模块。
  </para>
  <para>
    SUSE 在 <link xlink:href="https://www.suse.com/support/security/certifications/"/> 上维护一个已认证模块列表，并提供其他许多有用信息。
  </para>
</sect1>

<sect1 xml:id="sec-fips-use-case">
  <title>何时启用 FIPS 模式</title>
  <para>
    在 SUSE Linux Enterprise 上启用 FIPS 模式的用例非常简单：在需要满足合规性规则时以 FIPS 模式运行您的服务器即可。
  </para>
  <para>
     不需要满足合规性规则时，最好不要以 FIPS 模式运行系统。不使用 FIPS 模式的部分原因如下：
  </para>
  <itemizedlist>
    <listitem>
      <para>
        FIPS 有约束性。它强制要求使用经验证的特定加密算法，并强制要求使用实现这些经验证算法的特定已认证二进制文件。您只能使用已认证的二进制文件。
      </para>
    </listitem>
    <listitem>
      <para>
        升级可能会破坏功能。
      </para>
    </listitem>
    <listitem>
      <para>
         审批过程非常漫长，因此已认证的二进制文件始终比最新版本要落后几个版本。
      </para>
    </listitem>
    <listitem>
      <para>
        已认证的二进制文件（例如 ssh、sshd 和 sftp-server）在启动时运行自检，并仅在这些检查成功时才会运行。这会导致性能小幅下降。
      </para>
    </listitem>
    <listitem>
      <para>
        FIPS 的管理非常复杂，需要具备丰富的专业知识。
      </para>
    </listitem>
  </itemizedlist>
</sect1>

<sect1 xml:id="sec-fips-install">
  <title>安装 FIPS</title>
  <para>
    最好在新的安装中安装 <package>patterns-server-enterprise-fips</package> 软件集。在安装完成后，通过运行<xref linkend="sec-fips-enable"/>中的步骤启用 FIPS 模式。
  </para>
  <para>
    可以在运行中的系统上安装 <package>patterns-server-enterprise-fips</package> 并启用 FIPS 模式，但可能必须进行调整，例如重新生成密钥，并审计设置以确保 FIPS 设置正确。
  </para>
</sect1>

<sect1 xml:id="sec-fips-enable">
  <title>启用 FIPS 模式</title>


<para>
  只需执行少量几个步骤即可启用 FIPS。首先，读取 <package>openssh-common</package> 软件包中的 <filename>/usr/share/doc/packages/openssh-common/README.FIPS</filename> 和 <filename>/usr/share/doc/packages/openssh-common/README.SUSE</filename> 文件。这些文件包含有关 SUSE Linux Enterprise 上 FIPS 的重要信息。
  </para>
  <para>
    检查是否已启用 FIPS：
  </para>
  <screen><prompt>&gt; </prompt><command>sudo</command> <command>sysctl -a | grep fips</command>
crypto.fips_enabled = 0</screen>
  <para>
  <literal>crypto.fips_enabled = 0</literal> 表示未启用。返回值 1 表示已启用。
  </para>
  <para>
    然后编辑 <filename>/etc/default/grub</filename>。如果 <filename>/boot</filename> 不在单独的分区上，请将 <literal>fips=1</literal> 添加到 <literal>GRUB_CMDLINE_LINUX_DEFAULT</literal>，如以下示例所示：
  </para>
  <screen>GRUB_CMDLINE_LINUX_DEFAULT="splash=silent mitigations=auto quiet fips=1"</screen>
  <para>
    如果 <filename>/boot</filename> 在单独的分区上，请指定该分区，如以下示例所示（请将占位符替换为您的引导分区名称）：
  </para>
  <screen>GRUB_CMDLINE_LINUX_DEFAULT="splash=silent mitigations=auto quiet fips=1 boot=<replaceable>/dev/sda1"</replaceable></screen>
  <para>
    保存更改，并重构建 GRUB 配置和 initramfs 映像（请将 <replaceable>NAME</replaceable> 替换为当前 initrd 的名称，将 <replaceable>KERNELVERSION</replaceable> 替换为当前运行的内核）：
  </para>
  <screen><prompt>&gt; </prompt><command>sudo</command> <command>grub2-mkconfig -o /boot/grub2/grub.cfg</command>
<prompt>&gt; </prompt><command>sudo</command> <command>/usr/bin/dracut --logfile /var/log/YaST2/mkinitrd.log --force /boot/$initrd-<replaceable>NAME</replaceable> $<replaceable>KERNELVERSION</replaceable></command></screen>
  <para>
  重引导，然后校验您的更改。以下示例显示 FIPS 已启用：
  </para>
<screen><prompt>&gt; </prompt><command>sudo</command> <command>sysctl -a | grep fips</command>
crypto.fips_enabled = 1</screen>
  <para>
  启用 FIPS 后，您的系统有可能不会引导。如果发生这种情况，请重引导以显示 GRUB 菜单。按 <keycap>E</keycap> 编辑引导项，然后删除 <literal>linux</literal> 行中的 <literal>fips</literal> 项。按 <keycap>F10</keycap> 键以引导。这是一项临时更改，问题原因很可能与 <filename>/etc/default/grub</filename> 中的错误有关。请更正该错误，重构建 GRUB 和 initramfs，然后重引导。
  </para>
 </sect1>

 <sect1 xml:id="sec-fips-samba-cifs">
  <title>Samba/CIFS 不支持 MD5</title>
  <para>
   根据 FIPS 标准，MD5 不是安全的哈希算法，不得将它用于身份验证。如果您运行 FIPS 合规的网络环境，并且您的客户端或服务器以 FIPS 合规的模式运行，则您必须使用 Kerberos 服务对 Samba/CIFS 用户进行身份验证。之所以必须这样做，是因为所有其他 Samba 身份验证模式都包含 MD5。
  </para>
  <para>
   有关运行 Samba 服务器的详细信息，请参见《<citetitle>Storage Administration Guide</citetitle>》（储存管理指南）的“Samba”一节。
  </para>
 </sect1>
</chapter>
