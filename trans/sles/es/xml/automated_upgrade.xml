<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE chapter PUBLIC "-//Novell//DTD NovDoc XML V1.0//EN" "novdocx.dtd">
<!--
*********************************
Please see LICENSE.txt for this document's license.
*********************************
-->
<chapter xml:base="automated_upgrade.xml" id="cha.update.auto" os="sles">
 <title>Actualización automática de SUSE Linux Enterprise 11 SP2 a 11 SP3</title>
 <para>
  El siguiente procedimiento es un modo de realizar una actualización masiva sin intervención del usuario de SUSE Linux Enterprise 11 SP2 a SUSE Linux Enterprise 11 SP3. Es necesario llevar a cabo varios pasos de preparación para crear un perfil de AutoYaST adecuado. Finalmente, AutoYaST ejecutará el proceso de actualización.
 </para>
 <sect1 id="sec.update.auto.prep_autoyast">
  <title>Preparación del perfil de AutoYaST</title>

  <para>
   El perfil de AutoYaST para la actualización automatizada utiliza el mismo formato de archivo que la instalación de AutoYaST. Para obtener más información acerca de AutoYaST, consulte la <xref linkend="cha.deployment.autoinst"/> y la <xref linkend="book.autoyast"/>.
  </para>

  <para>
   Sin embargo, existen algunas partes del sistema (como el particionamiento) que no tiene sentido configurar durante la actualización. Por otra parte, resulta útil configurar opciones específicas de actualización mediante el perfil de AutoYaST.
  </para>

  <sect2>
   <title>Actualización</title>
   <para>
    Las opciones de actualización definen el comportamiento de la resolución de dependencias durante la actualización:
   </para>
<screen>&lt;upgrade&gt;
  &lt;only_installed_packages
    config:type="boolean"&gt;false&lt;/only_installed_packages&gt;
  &lt;stop_on_solver_conflict
    config:type="boolean"&gt;true&lt;/stop_on_solver_conflict&gt;
&lt;/upgrade&gt;</screen>
   <variablelist>
    <varlistentry>
     <term><literal>only_installed_packages</literal>
     </term>
     <listitem>
      <para>
       Definido como <literal>true</literal> para actualizaciones basadas en paquetes (recomendadas para actualizaciones al siguiente paquete de servicio del mismo producto) o <literal>false</literal> para actualizaciones basadas en patrones (recomendadas para actualizaciones entre versiones del producto, por ejemplo de SLES10 a SLES11).
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>stop_on_solver_conflict</literal>
     </term>
     <listitem>
      <para>
       Define si se debe mostrar la propuesta en caso de que no sea posible resolver las dependencias de paquetes de forma interactiva (se recomienda definir el valor <literal>true,</literal> pero esto podría provocar un proceso interactivo que obligaría al usuario a resolver los conflictos manualmente).
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
  </sect2>

  <sect2>
   <title>Selección del software</title>
   <para>
    Las opciones de selección de software definen los componentes que se deben seleccionar o deseleccionar además de los resultados de la resolución:
   </para>
<screen>&lt;software&gt;
  &lt;packages config:type="list"&gt;
    &lt;package&gt;autoyast2-installation&lt;/package&gt;
    &lt;package&gt;apparmor-profile-editor&lt;/package&gt;
  &lt;/packages&gt;
  &lt;patterns config:type="list"&gt;
    &lt;pattern&gt;base&lt;/pattern&gt;
  &lt;/patterns&gt;
  &lt;remove-packages config:type="list"/&gt;
  &lt;remove-patterns config:type="list"/&gt;
&lt;/software&gt;</screen>
   <para>
    Es especialmente importante definir paquetes o patrones seleccionados o deseleccionados para resolver conflictos de paquetes y evitar la necesidad de una intervención interactiva. Después de realizada la actualización, el archivo <filename>autoupg_updated.xml</filename> recién creado contendrá estos paquetes y patrones, además de los seleccionados o deseleccionados por cualquier otro motivo.
   </para>
  </sect2>

  <sect2>
   <title>Copia de seguridad antes de la actualización</title>
   <para>
    Las opciones de copia de seguridad antes de la actualización se corresponden con estas funciones en la propuesta de actualización.
   </para>
<screen>&lt;backup&gt;
  &lt;sysconfig config:type="boolean"&gt;true&lt;/sysconfig&gt;
  &lt;modified config:type="boolean"&gt;true&lt;/modified&gt;
  &lt;remove_old config:type="boolean"&gt;false&lt;/remove_old&gt;
&lt;/backup&gt;</screen>
   <variablelist>
    <varlistentry>
     <term><literal>sysconfig</literal>
     </term>
     <listitem>
      <para>
       define si se debe realizar una copia de seguridad de sysconfig antes de la actualización.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>modified</literal>
     </term>
     <listitem>
      <para>
       define si se debe realizar una copia de seguridad de los archivos de configuración modificados antes de la actualización.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>remove_old</literal>
     </term>
     <listitem>
      <para>
       define si se deben eliminar las copias de seguridad de las actualizaciones anteriores.
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
  </sect2>
 </sect1>
 <sect1 id="sec.update.auto.run">
  <title>Ejecución de la actualización automatizada</title>

  <para>
   Para iniciar la actualización automatizada, arranque el medio de instalación y pásele el perfil de AutoYaST. Existen dos maneras de pasar el perfil al sistema:
  </para>

  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>
     Pase el perfil a la línea de comandos del núcleo, del mismo modo que para la instalación de AutoYaST (utilice el parámetro <literal>autoupgrade=1</literal> <filename>autoyast=http://host/path/profile.xml</filename>). Para System z, es la única posibilidad.
    </para>
   </listitem>
   <listitem>
    <para>
     Pase el parámetro <literal>autoupgrade=1</literal> a la línea de comandos del núcleo. Antes de iniciar la actualización, copie el perfil en <filename>/root/autoupg.xml</filename>. A partir de ese momento, no será necesario ningún parámetro adicional en el núcleo.
    </para>
   </listitem>
  </itemizedlist>

  <para>
   Este último enfoque permite tener una única línea de comandos del núcleo de instalación incluso para diferentes equipos, basta con copiar el perfil adecuado en el sistema de archivos.
  </para>

  <para>
   Si tiene solamente un sistema SUSE Linux Enterprise instalado en el equipo, no existen conflictos de paquetes y no ha configurado el perfil para que se detenga en las propuestas de actualización, el proceso completo será automático. Si ha introducido las propuestas de actualización, puede modificar los valores de configuración para la actualización.
  </para>

  <para>
   Cuando finalice la actualización, YaST escribe el archivo <filename>/root/autoupg-updated.xml</filename>, que contiene el perfil con los cambios aplicados en la selección de software realizados en la propuesta. Esto es especialmente útil en caso de actualizaciones masivas de equipos con la misma selección de paquetes. De este modo, las resoluciones de conflictos de un equipo se pueden aplicar fácilmente a otros equipos, que a su vez resolverán automáticamente los conflictos, logrando que la actualización sea automática.
  </para>

  <para>
   Si hay más sistemas SUSE Linux Enterprise instalados en el equipo, siempre se le preguntará cuál desea actualizar. No es posible seleccionarlo por adelantado.
  </para>
 </sect1>
 <sect1 id="sec.update.auto.grub">
  <title>Sección del menú de GRUB 2 para arrancar la actualización</title>

  

  <para>
   Un modo alternativo de arrancar el sistema es crear una sección adicional en el menú de GRUB 2 (u otros cargadores de arranque y arquitecturas) para iniciar la instalación. En el siguiente ejemplo se presupone que existe una partición <filename>/boot</filename> independiente, a la que se hace referencia en GRUB 2 como <literal>(hd 0,0)</literal>:
  </para>

<screen>title Upgrade
    root (hd0,0)
    kernel /upgrade/linux
    install=<replaceable>inst_source_url</replaceable> autoupgrade=1
    autoyast=<replaceable>autoyast_profile_url</replaceable> vga=0x314
    initrd /upgrade/initrd
  </screen>

  <para>
   En el ejemplo anterior se presupone que el núcleo e <systemitem>initrd</systemitem> de la instalación se encuentran en el directorio <filename>/boot/upgrade</filename>.
  </para>

  <para>
   En System z, debe añadir los parámetros al archivo PARM. Proceda del mismo modo que para realizar una instalación mediante AutoYaST.
  </para>
 </sect1>
 <sect1 id="sec.update.auto.2nd-stage">
  <title>Segunda etapa de la actualización</title>

  <para>
   La actualización automatizada no permite por defecto realizar cambios de configuración durante la segunda etapa de la actualización. La única excepción es la configuración de red, que es necesario definir para que se conserve en el perfil de actualización de AutoYaST.
  </para>

  <para>
   Si es necesario realizar el ajuste de la configuración de algunas áreas del sistema después de la actualización (por ejemplo, configurar un nuevo servicio), añada las secciones relevantes al perfil de AutoYaST de la actualización y la configuración de las áreas de sistema seleccionadas se guardará durante la actualización.
  </para>

  <warning>
   <title>La configuración proporcionada por AutoYaST sustituye a la existente</title>
   <para>
    Tenga en cuenta que la configuración existente de esa área del sistema se sustituirá y destruirá con la configuración de AutoYaST.
   </para>
  </warning>

  <para>
   Normalmente, el único ajuste de configuración que debe estar presente en el perfil de AutoYaST es el registro del sistema en Subscription Management Tool (SMT) o el Centro de servicios al cliente de SUSE (SCC). Si falta este ajuste, el sistema no obtendrá el repositorio de actualización y no será posible realizar actualizaciones a menos que se configure de nuevo más adelante.
  </para>
 </sect1>
 <sect1 id="sec.update.auto.limitations">
  <title>Limitaciones y sugerencias</title>

  <para/>

  <sect2>
   <title>NetworkManager y registro</title>
   <para>
    En caso de utilizar NetworkManager para la gestión de dispositivos y conexiones de red, las conexiones de red no estarán disponibles durante la segunda etapa de la actualización. Esto impide que el sistema lleve a cabo el registro.
   </para>
  </sect2>

  <sect2>
   <title>Limpieza de ajustes de actualización</title>
   <para>
    Si realiza algún cambio en el sistema para activar el proceso de actualización (por ejemplo, añadir una nueva sección al menú del cargador de arranque), probablemente sea preferible eliminarlo cuando concluya la actualización.
   </para>
   <para>

    
    
    Puede hacerlo automáticamente con un guion posterior a la instalación. Encontrará algunos ejemplos en <xref linkend="createprofile.scripts"/>. Hay un guion de ejemplo que limpia el archivo <filename>menu.lst</filename> de GRUB 2 incluido en el archivo <filename>autoupg.xml</filename> de muestra. Asegúrese de que el guion coincide con su configuración concreta y solamente elimina los elementos deseados.
   </para>
  </sect2>

  <sect2>
   <title>Información adicional</title>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>
      Documentación de Linuxrc: <ulink url="http://en.opensuse.org/SDB:Linuxrc"/>
     </para>
    </listitem>
   </itemizedlist>
  </sect2>
 </sect1>
</chapter>
