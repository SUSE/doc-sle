<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="deployment_image.xml" version="5.0" role="General" xml:id="cha-deployment-clone-image">
 <title>Clonación de imágenes de discos</title>
 <info>
  <abstract>
   <para>
    En este capítulo se describe cómo utilizar imágenes duplicadas para instalar <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server.</phrase></phrase> Este procedimiento se utiliza principalmente en entornos virtualizados.
   </para>
  </abstract>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:bugtracker/>
   <dm:translation>sí</dm:translation>
  </dm:docmanager>
 </info>
 <sect1 xml:id="sec-deployment-clone-image-overview">
  <title>Descripción general</title>
  <para>
   <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> proporciona un guion para la limpieza de la configuración que es exclusivo de cada instalación. Con la introducción de <systemitem class="daemon">systemd</systemitem>, se utilizan y se definen identificadores de sistema exclusivos en distintos archivos y ubicaciones. Por lo tanto, la duplicación ya no es el método recomendado para crear imágenes de sistema. Las imágenes se pueden crear con KIWI (consulte <link xlink:href="https://doc.suse.com/kiwi/"/>).
  </para>
  <para>
   Para clonar discos de equipos, consulte la documentación de su entorno de virtualización.
  </para>
 </sect1>
 <sect1 xml:id="sec-deployment-clone-image-clean">
  <title>Limpieza de los identificadores de sistema únicos</title>
  <warning>
   <title>pérdida importante de configuración</title>
   <para>
    Al ejecutar el siguiente procedimiento, se suprimen de forma permanente datos de configuración del sistema. Si el sistema de origen de la clonación se utiliza en un entorno de producción, ejecute el guion de limpieza sobre la imagen clonada.
   </para>
  </warning>
  <para>
   Para limpiar todos los identificadores de sistema únicos, ejecute el siguiente procedimiento antes o después de duplicar una imagen de disco. Si se ejecuta en el duplicado, el procedimiento deberá ejecutarse en cada duplicado. Por lo tanto, recomendamos crear una <literal>imagen limpia</literal> que no se utilice en producción y solo sirva como origen para crear duplicados. La imagen limpia estará preparada para que los duplicados se puedan utilizar inmediatamente.
  </para>
  <para>
   Por ejemplo, el comando <command>clone-master-clean-up</command> elimina:
  </para>
  <itemizedlist>
   <listitem>
    <para>Archivos de intercambio</para>
   </listitem>
   <listitem>
    <para>Repositorios de Zypper</para>
   </listitem>
   <listitem>
    <para>Claves de hosts y clientes SSH</para>
   </listitem>
   <listitem>
    <para>Directorios temporales, como <filename>/tmp/*</filename></para>
   </listitem>
   <listitem>
    <para>Datos de postfix</para>
   </listitem>
   <listitem>
    <para>Guion del cortafuegos HANA</para>
   </listitem>
   <listitem>
    <para>Diario de systemd</para>
   </listitem>
  </itemizedlist>
  <procedure>
   <step>
    <para>
     Uso de <command>zypper</command> para la instalación <package>clone-master-clean-up</package>:
    </para>
    <screen><prompt>tux &gt; </prompt><command>sudo</command> <command>zypper</command> install clone-master-clean-up</screen>
   </step>
   <step>
    <para>
     Para configurar el comportamiento de <command>clone-master-clean-up</command>, edite <filename>/etc/sysconfig/clone-master-clean-up</filename>. Este archivo de configuración define si se deben eliminar los usuarios con un UID de más de 1000, el archivo <filename>/etc/sudoers</filename>, los repositorios de software  para la instalación del paquete y las instantáneas Btrfs.
    </para>
   </step>
   <step>
    <para>
     Elimine la configuración existente y los identificadores únicos ejecutando el guion:
    </para>
    <screen><prompt>tux &gt; </prompt><command>sudo</command> <command>clone-master-clean-up</command></screen>
   </step>
  </procedure>
 </sect1>
</chapter>
