<?xml version="1.0" encoding="UTF-8"?>
<sect1 xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="net_router.xml" version="5.0" xml:id="sec-network-router">
 <title>路由器基本設定</title>



 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:bugtracker/>
   <dm:translation>yes</dm:translation>
  </dm:docmanager>
 </info>

 <para>
  路由器是一種網路裝置，可接收和傳送往來於多個網路的資料 (網路封包)。路由器常用於將本地網路連接至遠端網路 (網際網路) 或連接多個本地網路區段。透過 <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase>，您可以建構一個具備 NAT (網路位址翻譯) 或進階防火牆等功能的路由器。
 </para>



 <para>
  下面是將 <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> 轉變為路由器的基本步驟。
 </para>

 <procedure>
  <step>
   <para>
    啟用轉遞，例如在 <filename>/etc/sysctl.d/50-router.conf</filename> 中
   </para>
<screen>net.ipv4.conf.all.forwarding = 1
net.ipv6.conf.all.forwarding = 1</screen>
   <para>
    然後，為介面提供靜態 IPv4 與 IPv6 IP 設定。啟用轉遞會停用多項機制，例如 IPv6 不再接受 IPv6 RA (路由器廣播)，這也會妨礙建立預設路由器。
   </para>
  </step>
  <step>
   <para>
    許多情況下 (例如，當您可以透過多個介面連接同一個網路，或者通常使用的是 VPN 且已位於<quote>正常的多宿主主機</quote>上時)，必須停用 IPv4 逆向路徑過濾 (此功能目前不適用於 IPv6)：
   </para>
<screen>net.ipv4.conf.all.rp_filter = 0</screen>
   <para>
    不過，您還可以改用防火牆設定進行過濾。
   </para>
  </step>
  <step>
   <para>
    若要接受來自路由器 (位於外部、上行或 ISP 介面) 的 IPv6 RA，並再次建立預設 (亦或更具特定性) 的 IPv6 路由，請設定：
   </para>
<screen>net.ipv6.conf.${ifname}.accept_ra = 2
net.ipv6.conf.${ifname}.autoconf = 0</screen>
   <para>
    (注意：在以點分隔的 sysfs 路徑中，<quote><literal>eth0.42</literal></quote> 需要寫為 <literal>eth0/42</literal>。)
   </para>
  </step>
 </procedure>

 <para>
  更多路由器行為和轉遞相依性的描述，可造訪 <link xlink:href="https://www.kernel.org/doc/Documentation/networking/ip-sysctl.txt">https://www.kernel.org/doc/Documentation/networking/ip-sysctl.txt</link>。
 </para>

 <para>
  為了在內部 (DMZ) 介面上提供 IPv6，並將您自己宣告為 IPv6 路由器，同時<quote>將網路自動設定</quote>到用戶端，請安裝並設定 <filename>/etc/radvd.conf</filename> 中的 <systemitem class="daemon">radvd</systemitem>，例如：
 </para>

<screen>interface eth0
{
    IgnoreIfMissing on;         # do not fail if interface missed

    AdvSendAdvert on;           # enable sending RAs
    AdvManagedFlag on;          # IPv6 addresses managed via DHCPv6
    AdvOtherConfigFlag on;      # DNS, NTP... only via DHCPv6

    AdvDefaultLifetime 3600;    # client default route lifetime of 1 hour

    prefix 2001:db8:0:1::/64    # (/64 is default and required for autoconf)
    {
        AdvAutonomous off;         # Disable address autoconf (DHCPv6 only)

        AdvValidLifetime 3600;     # prefix (autoconf addr) is valid 1 h
        AdvPreferredLifetime 1800; # prefix (autoconf addr) is prefered 1/2 h
    }
}</screen>

 <para>
  設定防火牆，以透過 NAT 偽裝從 LAN 進入 WAN 的流量，並在 WAN 介面上阻擋內傳流量：
 </para>
<screen><prompt>&gt; </prompt><command>sudo</command> <command>firewall-cmd</command> --permanent --zone=external --change-interface=<replaceable>WAN_INTERFACE</replaceable>
<prompt>&gt; </prompt><command>sudo</command> <command>firewall-cmd</command> --permanent --zone=external --add-masquerade
<prompt>&gt; </prompt><command>sudo</command> <command>firewall-cmd</command> --permanent --zone=internal --change-interface=<replaceable>LAN_INTERFACE</replaceable>
<prompt>&gt; </prompt><command>sudo</command> <command>firewall-cmd</command> --reload</screen>
</sect1>
