<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="libvirt_configuration_gui.xml" version="5.0" xml:id="cha-libvirt-config-gui">
  <title>使用虚拟机管理器配置虚拟机</title>
  <info>
    <abstract>
      <para>
        虚拟机管理器的<guimenu>细节</guimenu>视图提供有关 VM Guest 完整配置和硬件要求的深入信息。使用此视图还可以更改 Guest 配置，或者添加和修改虚拟硬件。要访问此视图，请在虚拟机管理器中打开 Guest 的控制台，然后从菜单中选择<menuchoice> <guimenu>视图</guimenu>
        <guimenu>细节</guimenu> </menuchoice>，或者在工具栏中单击<guimenu>显示虚拟硬件细节</guimenu>。
      </para>
    </abstract>
    <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
      <dm:bugtracker/>
      <dm:translation>yes</dm:translation>
    </dm:docmanager>
  </info>
  <para/>
  <figure>
    <title>VM Guest 的<guimenu>细节</guimenu>视图</title>
    <mediaobject>
      <imageobject role="fo">
        <imagedata fileref="libvirt_vmm_details.png" width="75%"/>
      </imageobject>
      <imageobject role="html">
        <imagedata fileref="libvirt_vmm_details.png" width="75%"/>
      </imageobject>
    </mediaobject>
  </figure>
  <para>
    窗口的左侧面板列出了 VM Guest 概述及已安装的硬件。在列表中单击某个项后，可以在细节视图中访问其详细设置。您可以根据需要更改硬件参数，然后单击<guimenu>应用</guimenu>确认更改。有些更改会立即生效，而有些更改需要重引导计算机，<systemitem>virt-manager</systemitem> 会预先通知您此情况。
  </para>
  <para>
    要从 VM Guest 中去除安装的硬件，请在左侧面板中选择相应的列表项，然后单击窗口右下方的<guimenu>去除</guimenu>。
  </para>
  <para>
    要添加新硬件，请单击左侧面板下方的<guimenu>添加硬件</guimenu>，然后在<guimenu>添加新虚拟硬件</guimenu>窗口中选择要添加的硬件类型。修改其参数并单击<guimenu>完成</guimenu>进行确认。
  </para>
  <para>
    下列章节介绍<emphasis>要添加</emphasis>的特定硬件类型的配置选项。其中不会重点介绍如何修改现有的硬件，因为选项均相同。
  </para>
  <sect1 xml:id="sec-libvirt-config-machine-setup">
    <title>计算机设置</title>

    <para>
      本节介绍虚拟化处理器和内存硬件的设置。这些组件对于 VM Guest 至关重要，因此不能将其去除。本节还将介绍如何查看概述和性能信息，以及如何更改引导参数。
    </para>

    <sect2>
      <title>概览</title>
      <para>
        <guimenu>概览</guimenu>显示有关 VM Guest 和超级管理程序的基本细节。
      </para>
      <figure>
        <title>概览细节</title>
        <mediaobject>
          <imageobject role="fo">
            <imagedata fileref="libvirt_vmm_overview.png" width="70%"/>
          </imageobject>
          <imageobject role="html">
            <imagedata fileref="libvirt_vmm_overview.png" width="70%"/>
          </imageobject>
        </mediaobject>
      </figure>
      <para>
        <guimenu>名称</guimenu>、<guimenu>标题</guimenu>和<guimenu>说明</guimenu>均可编辑，有助于您在<guimenu>虚拟机管理器</guimenu>的计算机列表中识别 VM Guest。
      </para>
      <figure>
        <title>VM Guest 标题和说明</title>
        <mediaobject>
          <imageobject role="fo">
            <imagedata fileref="libvirt_vmm_desc.png" width="40%"/>
          </imageobject>
          <imageobject role="html">
            <imagedata fileref="libvirt_vmm_desc.png" width="40%"/>
          </imageobject>
        </mediaobject>
      </figure>
      <para>
        <guimenu>UUID</guimenu> 显示虚拟机的全局唯一标识符，而<guimenu>状态</guimenu>显示虚拟机的当前状态 — <guimenu>正在运行</guimenu>、<guimenu>已暂停</guimenu>或<guimenu>已关闭</guimenu>。
      </para>
      <para>
        <guimenu>超级管理程序细节</guimenu>部分显示超级管理程序类型、CPU 体系结构、使用的模拟器和芯片组类型。所有超级管理程序参数都不可更改。
      </para>
    </sect2>

    <sect2>
      <title>性能</title>
      <para>
        <guimenu>性能</guimenu>显示 CPU 使用率和内存用量以及磁盘和网络 I/O 的定期更新图表。
      </para>
      <figure>
        <title>性能</title>
        <mediaobject>
          <imageobject role="fo">
            <imagedata fileref="libvirt_vmm_performance.png" width="70%"/>
          </imageobject>
          <imageobject role="html">
            <imagedata fileref="libvirt_vmm_performance.png" width="70%"/>
          </imageobject>
        </mediaobject>
      </figure>
      <tip>
        <title>启用已禁用的图表</title>
        <para>
          <guimenu>图表</guimenu>视图中的所有图表并非默认都已启用。要启用这些图表，请转到<menuchoice><guimenu>文件</guimenu><guimenu>视图管理器</guimenu></menuchoice>，然后选择<menuchoice><guimenu>编辑</guimenu><guimenu>首选项</guimenu>
          <guimenu>轮询</guimenu></menuchoice>，检查您要查看的图表是否定期更新。
        </para>
      </tip>
      <figure>
        <title>统计图</title>
        <mediaobject>
          <imageobject role="fo">
            <imagedata fileref="libvirt_vmm_polling_charts.png" width="40%"/>
          </imageobject>
          <imageobject role="html">
            <imagedata fileref="libvirt_vmm_polling_charts.png" width="40%"/>
          </imageobject>
        </mediaobject>
      </figure>
    </sect2>

    <sect2>
      <title>处理器</title>
      <para>
        <guimenu>CPU</guimenu> 视图包含有关 VM Guest 处理器配置的详细信息。
      </para>
      <figure>
        <title>处理器视图</title>
        <mediaobject>
          <imageobject role="fo">
            <imagedata fileref="libvirt_vmm_processor.png" width="70%"/>
          </imageobject>
          <imageobject role="html">
            <imagedata fileref="libvirt_vmm_processor.png" width="70%"/>
          </imageobject>
        </mediaobject>
      </figure>
      <para>
        在 <guimenu>CPU</guimenu> 部分，可以配置分配给 VM Guest 的虚拟 CPU 数量。<guimenu>逻辑主机 CPU</guimenu> 显示 VM 主机服务器上的联机 CPU 和可用 CPU 数量。
      </para>
      <para>
        <guimenu>配置</guimenu>部分可让您配置 CPU 型号和拓扑。
      </para>
      <para>
        如果激活<guimenu>复制主机 CPU 配置</guimenu>选项，将为 VM Guest 使用主机 CPU 型号。可以在 <command>virsh
        capabilities</command> 命令的输出中查看主机 CPU 型号的细节。如果该 CPU 型号已停用，需要通过下拉框中的可用型号列表指定该型号。
      </para>
      <para>
        主机 CPU 型号可在 CPU 功能和 VM Guest 迁移功能之间提供良好的平衡。<systemitem class="library">libvirt</systemitem> 不会对每个 CPU 的每个方面建模，因此 VM Guest CPU 不与 VM 主机服务器 CPU 完全匹配。但是，提供给 VM Guest 的 ABI 可重现，并且在迁移过程中，完整的 CPU 型号定义将传输到目标 VM 主机服务器，确保迁移的 VM Guest 可以在目标上看到完全相同的 CPU 型号。
      </para>
      <para>
        <literal>host-passthrough</literal> 型号为 VM Guest 提供与 VM 主机服务器 CPU 完全相同的 CPU。当 <systemitem class="library">libvirt</systemitem> 的简化 <literal>host-model</literal> CPU 不能提供 VM Guest 工作负载所需的 CPU 功能时，该型号可能很有用。<literal>host-passthrough</literal> 型号存在迁移能力下降的劣势。采用 <literal>host-passthrough</literal> 型号 CPU 的 VM Guest 只能迁移到具有相同硬件的 VM 主机服务器。
      </para>
      <para>
        有关 <systemitem class="library">libvirt</systemitem> 的 CPU 型号和拓扑选项的详细信息，请参见 <link xlink:href="https://libvirt.org/formatdomain.html#cpu-model-and-topology"/> 上的 <citetitle>CPU model and topology</citetitle> 文档。
      </para>
      <para>
        激活<guimenu>手动设置 CPU 拓扑</guimenu>后，可以指定 CPU 的自定义插槽数、核心数和线程数。
      </para>
    </sect2>

    <sect2>
      <title>内存</title>
      <para>
        <guimenu>内存</guimenu>视图包含有关 VM Guest 可用内存的信息。
      </para>
      <figure>
        <title>内存视图</title>
        <mediaobject>
          <imageobject role="fo">
            <imagedata fileref="libvirt_vmm_memory.png" width="70%"/>
          </imageobject>
          <imageobject role="html">
            <imagedata fileref="libvirt_vmm_memory.png" width="70%"/>
          </imageobject>
        </mediaobject>
      </figure>
      <variablelist>
        <varlistentry>
          <term><guimenu>总主机内存</guimenu></term>
          <listitem>
            <para>
              VM 主机服务器上安装的内存总量。
            </para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term><guimenu>当前分配</guimenu></term>
          <listitem>
            <para>
              当前可供 VM Guest 使用的内存量。可以通过增大此值（但不超过<guimenu>最大分配数量</guimenu>）来热插入更多内存。
            </para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term><guimenu>启用共享内存</guimenu></term>
          <listitem>
            <para>
              指定虚拟机是否可以通过基于 <literal>memfd</literal> 的内存使用共享内存。只有这样才能使用 <emphasis>virtiofs</emphasis> 文件系统。有关详细信息，请参见 <link xlink:href="https://libvirt.org/kbase/virtiofs.html"/>。
            </para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term><guimenu>最大分配</guimenu></term>
          <listitem>
            <para>
              可热插入的当前可用内存的最大值。对此值所做的任何更改将在 VM Guest 下次重引导后生效。
            </para>
          </listitem>
        </varlistentry>
        <varlistentry>
            <term>启用启动安全性</term>
            <listitem>
              <para>
                如果 VM 主机服务器支持 AMD-SEV 技术，激活此选项可为受保护的 Guest 启用加密内存。此选项需要芯片组类型为 Q35 的虚拟机。<phrase os="sles;sled">有关更多细节，请参见<xref linkend="article-amd-sev"/>。</phrase>
              </para>
            </listitem>
        </varlistentry>
      </variablelist>
      <important>
        <title>大内存 VM Guest</title>
        <para>
          内存要求为 4 TB 或以上的 VM Guest 必须使用 <literal>host-passthrough</literal> CPU 模式，或者在使用 <literal>host-model</literal> 或 <literal>custom</literal> CPU 模式时显式指定虚拟 CPU 地址大小。这些模式的默认虚拟 CPU 地址大小可能不足以满足 4 TB 或以上的内存配置。只能通过编辑 VM Guest XML 配置来指定地址大小。有关指定虚拟 CPU 地址大小的详细信息，请参见<xref linkend="sec-libvirt-config-memory-virsh"/>。
        </para>
      </important>
    </sect2>

    <sect2>
      <title>引导选项</title>
      <para>
        <guimenu>引导选项</guimenu>引入了影响 VM Guest 引导进程的选项。
      </para>
      <figure>
        <title>引导选项</title>
        <mediaobject>
          <imageobject role="fo">
            <imagedata fileref="libvirt_vmm_boot.png" width="70%"/>
          </imageobject>
          <imageobject role="html">
            <imagedata fileref="libvirt_vmm_boot.png" width="70%"/>
          </imageobject>
        </mediaobject>
      </figure>
      <para>
        在<guimenu>自动启动</guimenu>部分，可以指定是否应在 VM 主机服务器引导阶段自动启动虚拟机。
      </para>
      <para>
        在<guimenu>引导设备顺序</guimenu>中，激活用于引导 VM Guest 的设备。可以使用列表右侧的向上和向下箭头按钮更改其顺序。要在 VM Guest 启动时从可引导设备列表中进行选择，请激活<guimenu>启用引导菜单</guimenu>。
      </para>
      <para>
        要引导其他内核而不是引导设备上的内核，请激活<guimenu>启用直接内核引导</guimenu>，并指定替代内核以及位于 VM 主机服务器文件系统上的 initrd 的路径。您还可以指定要传递给所装载内核的内核参数。
      </para>
    </sect2>
  </sect1>
  <sect1 xml:id="sec-libvirt-config-storage">
    <title>储存</title>

    <para>
      本节提供储存设备配置选项的详细说明。其中包括硬盘和可移动媒体，例如 USB 或 CD-ROM 驱动器。
    </para>

    <procedure>
      <title>添加新储存设备</title>
      <step>
        <para>
          在左侧面板下方，单击<guimenu>添加硬件</guimenu>打开<guimenu>添加新虚拟硬件</guimenu>窗口。在此窗口中选择<guimenu>储存</guimenu>。
        </para>
        <figure>
          <title>添加新储存设备</title>
          <mediaobject>
            <imageobject role="fo">
              <imagedata fileref="libvirt_vmm_storage1.png" width="70%"/>
            </imageobject>
            <imageobject role="html">
              <imagedata fileref="libvirt_vmm_storage1.png" width="70%"/>
            </imageobject>
          </mediaobject>
        </figure>
      </step>
      <step>
        <para>
          要在默认位置创建 <literal>qcow2</literal> 磁盘映像，请激活<guimenu>创建虚拟机的磁盘映像</guimenu>，然后以 GB 为单位指定其大小。
        </para>
        <para>
          要以更高的控制度创建磁盘映像，请激活<guimenu>选择或创建自定义储存</guimenu>，然后单击<guimenu>管理</guimenu>以管理储存池和映像。<guimenu>选择存储卷</guimenu>窗口即会打开，其中提供的功能与<xref linkend="sec-libvirt-storage-vmm"/>中所述的<guimenu>存储</guimenu>选项卡基本相同。
        </para>
        <tip>
          <title>支持的储存格式</title>
          <para>
            SUSE 仅支持以下存储格式：<literal>raw</literal> 和 <literal>qcow2</literal>。
          </para>
        </tip>
      </step>
      <step>
        <para>
          创建并指定磁盘映像文件后，指定<guimenu>设备类型</guimenu>。设备类型可为以下选项之一：
        </para>
        <itemizedlist>
          <listitem>
            <para>
              <guimenu>磁盘设备</guimenu>
            </para>
          </listitem>
          <listitem>
            <para>
              <guimenu>CDROM 设备</guimenu>：不允许使用<guimenu>创建虚拟机的磁盘映像</guimenu>。
            </para>
          </listitem>
          <listitem>
            <para>
              <guimenu>软盘设备</guimenu>：不允许使用<guimenu>创建虚拟机的磁盘映像</guimenu>。
            </para>
          </listitem>
          <listitem>
            <para>
              <guimenu>LUN 直通</guimenu>：如果想直接使用现有的 SCSI 存储而不将其添加到存储池，则需使用此选项。
            </para>
          </listitem>
        </itemizedlist>
      </step>
      <step>
        <para>
          选择设备的<guimenu>总线类型</guimenu>。可用选项的列表取决于您在上一步中选择的设备类型。基于 <guimenu>VirtIO</guimenu> 的类型使用半虚拟化驱动程序。
        </para>
      </step>
      <step>
        <para>
          在<guimenu>高级选项</guimenu>部分选择首选的<guimenu>缓存模式</guimenu>。有关缓存模式的详细信息，请参见<xref linkend="cha-cachemodes"/>。
        </para>
      </step>
      <step>
        <para>
          单击<guimenu>完成</guimenu>确认您的设置。新储存设备随即显示在左侧面板中。
        </para>
      </step>
    </procedure>
  </sect1>
  <sect1 xml:id="sec-libvirt-config-controllers">
    <title>控制器</title>

    <para>
      本节重点介绍如何添加和配置新控制器。
    </para>

    <procedure>
      <title>添加新控制器</title>
      <step>
        <para>
          在左侧面板下方，单击<guimenu>添加硬件</guimenu>打开<guimenu>添加新虚拟硬件</guimenu>窗口。在此窗口中选择<guimenu>控制器</guimenu>。
        </para>
        <figure>
          <title>添加新控制器</title>
          <mediaobject>
            <imageobject role="fo">
              <imagedata fileref="libvirt_vmm_controller.png" width="70%"/>
            </imageobject>
            <imageobject role="html">
              <imagedata fileref="libvirt_vmm_controller.png" width="70%"/>
            </imageobject>
          </mediaobject>
        </figure>
      </step>
      <step>
        <para>
          选择控制器的类型。可以选择 <guimenu>IDE</guimenu>、<guimenu>软盘</guimenu>、<guimenu>SCSI</guimenu>、<guimenu>SATA</guimenu>、<guimenu>VirtIO Serial</guimenu>（半虚拟化）、<guimenu>USB</guimenu> 或 <guimenu>CCID</guimenu>（智能卡设备）。
        </para>
      </step>
      <step>
        <para>
          （可选）如果选择了 USB 或 SCSI 控制器，请选择控制器型号。
        </para>
      </step>
      <step>
        <para>
          单击<guimenu>完成</guimenu>确认您的设置。新控制器随即显示在左侧面板中。
        </para>
      </step>
    </procedure>
  </sect1>
  <sect1 xml:id="sec-libvirt-config-networking">
    <title>网络</title>

    <para>
      本节介绍如何添加和配置新网络设备。
    </para>

    <procedure>
      <title>添加新网络设备</title>
      <step>
        <para>
          在左侧面板下方，单击<guimenu>添加硬件</guimenu>打开<guimenu>添加新虚拟硬件</guimenu>窗口。在此窗口中选择<guimenu>网络</guimenu>。
        </para>
        <figure>
          <title>添加新网络接口</title>
          <mediaobject>
            <imageobject role="fo">
              <imagedata fileref="libvirt_vmm_network.png" width="70%"/>
            </imageobject>
            <imageobject role="html">
              <imagedata fileref="libvirt_vmm_network.png" width="70%"/>
            </imageobject>
          </mediaobject>
        </figure>
      </step>
      <step>
        <para>
          在<guimenu>网络源</guimenu>列表中，选择网络连接的来源。该列表包含 VM 主机服务器的可用物理网络接口、网桥或网络绑定。您还可以将 VM Guest 指派到已定义的虚拟网络。有关使用虚拟机管理器设置虚拟网络的详细信息，请参见<xref linkend="libvirt-host-network"/>。
        </para>
      </step>
      <step>
        <para>
          指定网络设备的 <guimenu>MAC 地址</guimenu>。尽管出于方便虚拟机管理器会预先填充一个随机值，但我们建议提供适合您网络环境的 MAC 地址，以免发生网络冲突。
        </para>
      </step>
      <step>
        <para>
          从列表中选择设备型号。可以保留<guimenu>超级管理程序默认值</guimenu>，或者指定 <guimenu>e1000</guimenu>、<guimenu>rtl8139</guimenu> 或 <guimenu>virtio</guimenu> 型号中的一个。<emphasis>virtio</emphasis> 使用半虚拟化驱动程序。
        </para>
      </step>
      <step>
        <para>
          单击<guimenu>完成</guimenu>确认您的设置。新网络设备随即显示在左侧面板中。
        </para>
      </step>
    </procedure>
  </sect1>
  <sect1 xml:id="sec-libvirt-config-input">
    <title>输入设备</title>

    <para>
      本节重点介绍如何添加和配置新输入设备，例如鼠标、键盘或绘图板。
    </para>

    <procedure xml:id="proc-libvirt-config-input">
      <title>添加新输入设备</title>
      <step>
        <para>
          在左侧面板下方，单击<guimenu>添加硬件</guimenu>打开<guimenu>添加新虚拟硬件</guimenu>窗口。在此窗口中选择<guimenu>输入</guimenu>。
        </para>
        <figure>
          <title>添加新输入设备</title>
          <mediaobject>
            <imageobject role="fo">
              <imagedata fileref="libvirt_vmm_input.png" width="70%"/>
            </imageobject>
            <imageobject role="html">
              <imagedata fileref="libvirt_vmm_input.png" width="70%"/>
            </imageobject>
          </mediaobject>
        </figure>
      </step>
      <step>
        <para>
          从列表中选择设备类型。
        </para>
      </step>
      <step>
        <para>
          单击<guimenu>完成</guimenu>确认您的设置。新输入设备随即显示在左侧面板中。
        </para>
      </step>
    </procedure>

    <tip xml:id="tip-libvirt-config-tablet">
      <title>启用无缝且同步的鼠标指针移动</title>
      <para>
        当您使用鼠标在 VM Guest 的控制台中单击时，指针将由控制台窗口捕获，除非显式释放指针（按 <keycombo>
        <keycap function="alt"/> <keycap function="control"/> </keycombo>），否则无法在控制台外部使用指针。为了防止控制台独占按键，以及在主机与 Guest 之间启用无缝指针移动，请按照<xref linkend="proc-libvirt-config-input"/>中的说明将一个 <guimenu>EvTouch USB 绘图板</guimenu>添加到 VM Guest。
      </para>
      <para>
        添加绘图板的另一个好处是，在 Guest 上使用图形环境时可以同步 VM 主机服务器与 VM Guest 之间的鼠标指针移动。如果不在 Guest 上配置绘图板，您经常会看到两个有拖尾现象（一个指针拖在另一个指针后面）的指针。
      </para>
    </tip>
  </sect1>
  <sect1 xml:id="sec-libvirt-config-video">
    <title>视频</title>

    <para>
      本节介绍如何添加和配置新视频设备。
    </para>

    <procedure>
      <title>添加视频设备</title>
      <step>
        <para>
          在左侧面板下方，单击<guimenu>添加硬件</guimenu>打开<guimenu>添加新虚拟硬件</guimenu>窗口。在此窗口中选择<guimenu>视频</guimenu>。
        </para>
      </step>
      <step>
        <figure>
          <title>添加新视频设备</title>
          <mediaobject>
            <imageobject role="fo">
              <imagedata fileref="libvirt_vmm_video.png" width="70%"/>
            </imageobject>
            <imageobject role="html">
              <imagedata fileref="libvirt_vmm_video.png" width="70%"/>
            </imageobject>
          </mediaobject>
        </figure>
      </step>
      <step>
        <para>
          从下拉框中选择一个型号。
        </para>
        <note>
          <title>次要视频设备</title>
          <para>
            只能将 <guimenu>QXL</guimenu> 和 <guimenu>Virtio</guimenu> 添加为次要视频设备。
          </para>
        </note>
      </step>
      <step>
        <para>
          单击<guimenu>完成</guimenu>确认您的设置。新视频设备随即显示在左侧面板中。
        </para>
      </step>
    </procedure>
  </sect1>
  <sect1 xml:id="sec-libvirt-config-usb-redirectors">
    <title>USB 重定向器</title>

    <para>
      可以使用 <guimenu>USB 重定向器</guimenu>将连接到客户端计算机的 USB 设备重定向到 VM Guest。
    </para>

    <procedure>
      <title>添加 USB 重定向器</title>
      <step>
        <para>
          在左侧面板下方，单击<guimenu>添加硬件</guimenu>打开<guimenu>添加新虚拟硬件</guimenu>窗口。在此窗口中选择 <guimenu>USB 重新定向</guimenu>。
        </para>
        <figure>
          <title>添加新 USB 重定向器</title>
          <mediaobject>
            <imageobject role="fo">
              <imagedata fileref="libvirt_vmm_usb_redirector.png" width="70%"/>
            </imageobject>
            <imageobject role="html">
              <imagedata fileref="libvirt_vmm_usb_redirector.png" width="70%"/>
            </imageobject>
          </mediaobject>
        </figure>
      </step>
      <step>
        <para>
          从列表中选择设备类型。根据您的配置，您可以选择 <guimenu>Spice 通道</guimenu>或 <guimenu>TCP</guimenu> 重定向器。
        </para>
      </step>
      <step>
        <para>
          单击<guimenu>完成</guimenu>确认您的设置。新 USB 重定向器随即显示在左侧面板中。
        </para>
      </step>
    </procedure>
  </sect1>
  <sect1 xml:id="sec-libvirt-config-miscellaneous">
    <title>杂项</title>

    <variablelist>
      <varlistentry>
        <term>智能卡</term>
        <listitem>
          <para>
            可以通过 <guimenu>Smartcard</guimenu> 元素添加智能卡功能。然后，物理 USB 智能卡读卡器便可以直通到 VM Guest。
          </para>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term>看门狗</term>
        <listitem>
          <para>
            系统还支持虚拟看门狗设备。可通过 <guimenu>Watchdog</guimenu> 元素创建这些设备。可以指定型号和设备操作。
          </para>
          <tip>
            <title>虚拟看门狗设备的要求</title>
            <para>
              要使用 QA 虚拟看门狗设备，需要在 VM Guest 中安装特定的驱动程序和守护程序，否则虚拟检查包设备将无法正常工作。
            </para>
          </tip>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term>TPM</term>
        <listitem>
          <para>
            可以通过 <guimenu>TPM</guimenu> 元素添加 TPM 功能，以在 VM Guest 中使用主机 TPM 设备。
          </para>
          <tip>
            <title>虚拟 TPM</title>
            <para>
              每次只能在一个 VM Guest 中使用主机 TPM。
            </para>
          </tip>
        </listitem>
      </varlistentry>
    </variablelist>
  </sect1>
  <sect1 xml:id="sec-libvirt-config-cdrom">
    <title>使用虚拟机管理器添加 CD/DVD-ROM 设备</title>

    <para>
      KVM 通过直接访问 VM 主机服务器上的物理驱动器或访问 ISO 映像来支持 VM Guest 中的 CD 和 DVD-ROM。要基于现有 CD 或 DVD 创建 ISO 映像，请使用 <command>dd</command>：
    </para>

<screen><prompt>&gt; </prompt><command>sudo</command> dd if=/dev/<replaceable>CD_DVD_DEVICE</replaceable> of=my_distro.iso bs=2048</screen>

    <para>
      要将 CD/DVD-ROM 设备添加到 VM Guest，请执行以下操作：
    </para>

    <procedure>
      <step>
        <para>
          双击虚拟机管理器中的某个 VM Guest 项打开其控制台，然后选择<menuchoice>
          <guimenu>视图</guimenu> <guimenu>细节</guimenu> </menuchoice>切换到<guimenu>细节</guimenu>视图。
        </para>
      </step>
      <step>
        <para>
          单击<guimenu>添加硬件</guimenu>并在弹出窗口中选择<guimenu>储存</guimenu>。
        </para>
      </step>
      <step>
        <para>
          将<guimenu>设备类型</guimenu>更改为 <guimenu>IDE CDROM</guimenu>。
        </para>
      </step>
      <step>
        <para>
          选择<guimenu>选择或创建自定义储存</guimenu>。
        </para>
        <substeps performance="required">
          <step>
            <para>
              要将设备指派到物理媒体，请在<guimenu>管理</guimenu>旁边输入 VM 主机服务器 CD/DVD-ROM 设备的路径（例如 <filename>/dev/cdrom</filename>）。或者，使用<guimenu>管理</guimenu>打开文件浏览器，然后单击<guimenu>浏览本地</guimenu>选择设备。仅当 VM 主机服务器上已启动虚拟机管理器时，才能将设备指派到物理媒体。
            </para>
          </step>
          <step>
            <para>
              要将设备指派到现有映像，请单击<guimenu>管理</guimenu>以从储存池中选择映像。如果 VM 主机服务器上已启动虚拟机管理器，您也可以单击<guimenu>浏览本地</guimenu>从文件系统上的另一个位置选择映像。选择某个映像并单击<guimenu>选择卷</guimenu>以关闭文件浏览器。
            </para>
          </step>
        </substeps>
      </step>
      <step>
        <para>
          单击<guimenu>完成</guimenu>以保存新虚拟化设备。
        </para>
      </step>
      <step>
        <para>
          重引导 VM Guest 以使新设备可用。有关更多信息，请参见<xref linkend="sec-libvirt-config-cdrom-media-change"/>。
        </para>
      </step>
    </procedure>
  </sect1>
  <sect1 xml:id="sec-libvirt-config-floppy">
    <title>使用虚拟机管理器添加软盘设备</title>

    <para>
      KVM 目前仅支持使用软盘映像 — 不支持使用物理软盘驱动器。使用 <command>dd</command> 基于现有软盘创建软盘映像：
    </para>

<screen><prompt>&gt; </prompt><command>sudo</command> dd if=/dev/fd0 of=/var/lib/libvirt/images/floppy.img</screen>

    <para>
      要创建空软盘映像，请使用以下命令之一：
    </para>

    <variablelist>
      <varlistentry>
        <term>Raw 映像</term>
        <listitem>
<screen><prompt>&gt; </prompt><command>sudo</command> dd if=/dev/zero of=/var/lib/libvirt/images/floppy.img bs=512 count=2880</screen>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term>FAT 格式映像</term>
        <listitem>
<screen><prompt>&gt; </prompt><command>sudo</command> mkfs.msdos -C /var/lib/libvirt/images/floppy.img 1440</screen>
        </listitem>
      </varlistentry>
    </variablelist>

    <para>
      要将软盘设备添加到 VM Guest，请执行以下操作：
    </para>

    <procedure>
      <step>
        <para>
          双击虚拟机管理器中的某个 VM Guest 项打开其控制台，然后选择<menuchoice>
          <guimenu>视图</guimenu> <guimenu>细节</guimenu> </menuchoice>切换到<guimenu>细节</guimenu>视图。
        </para>
      </step>
      <step>
        <para>
          单击<guimenu>添加硬件</guimenu>并在弹出窗口中选择<guimenu>储存</guimenu>。
        </para>
      </step>
      <step>
        <para>
          将<guimenu>设备类型</guimenu>更改为<guimenu>软盘</guimenu>。
        </para>
      </step>
      <step>
        <para>
          选择<guimenu>选择或创建自定义储存</guimenu>，然后单击<guimenu>管理</guimenu>以从储存池中选择一个现有映像。如果 VM 主机服务器上已启动虚拟机管理器，您也可以单击<guimenu>浏览本地</guimenu>从文件系统上的另一个位置选择映像。选择某个映像并单击<guimenu>选择卷</guimenu>以关闭文件浏览器。
        </para>
      </step>
      <step>
        <para>
          单击<guimenu>完成</guimenu>以保存新虚拟化设备。
        </para>
      </step>
      <step>
        <para>
          重引导 VM Guest 以使新设备可用。有关更多信息，请参见<xref linkend="sec-libvirt-config-cdrom-media-change"/>。
        </para>
      </step>
    </procedure>
  </sect1>
  <sect1 xml:id="sec-libvirt-config-cdrom-media-change">
    <title>使用虚拟机管理器弹出和更换软盘或 CD/DVD-ROM 媒体</title>

    <para>
      无论您使用的是 VM 主机服务器的物理 CD/DVD-ROM 设备，还是 ISO/软盘映像，在更换 VM Guest 中现有设备的媒体或映像之前，都需要先将媒体与 Guest <literal>disconnect</literal>。
    </para>

    <procedure>
      <step>
        <para>
          双击虚拟机管理器中的某个 VM Guest 项打开其控制台，然后选择<menuchoice>
          <guimenu>视图</guimenu> <guimenu>细节</guimenu> </menuchoice>切换到<guimenu>细节</guimenu>视图。
        </para>
      </step>
      <step>
        <para>
          选择软盘或 CD/DVD-ROM 设备，然后单击<guimenu>断开连接</guimenu>以<quote>弹出</quote>媒体。
        </para>
      </step>
      <step>
        <para>
          要<quote>插入</quote>新媒体，请单击<guimenu>连接</guimenu>。
        </para>
        <substeps performance="required">
          <step>
            <para>
              如果使用的是 VM 主机服务器的物理 CD/DVD-ROM 设备，请先更换设备中的媒体（这可能需要先在 VM 主机服务器上卸载该媒体，然后再将其弹出）。然后选择 <guimenu>CD-ROM 或 DVD</guimenu>，并从下拉框中选择设备。
            </para>
          </step>
          <step>
            <para>
              如果您使用的是 ISO 映像，请选择 <guimenu>ISO 映像位置</guimenu>，然后单击<guimenu>管理</guimenu>以选择映像。从远程主机连接时，只能选择现有储存池中的映像。
            </para>
          </step>
        </substeps>
      </step>
      <step>
        <para>
          单击<guimenu>确定</guimenu>以完成操作。现在便可在 VM Guest 中访问新媒体了。
        </para>
      </step>
    </procedure>
  </sect1>
  <sect1 xml:id="sec-libvirt-config-pci">
    <title>将主机 PCI 设备指派到 VM Guest</title>

    <para>
      可以直接将主机 PCI 设备指派到 Guest（PCI 直通）。将 PCI 设备指派到某个 VM Guest 后，除非重新指派，否则在主机上无法使用该设备，其他 VM Guest 也不能使用该设备。此功能的先决条件是 VM 主机服务器配置符合<xref linkend="ann-vt-io-require"/>中所述的要求。
    </para>

    <sect2 xml:id="sec-libvirt-config-pci-vmm">
      <title>使用虚拟机管理器添加 PCI 设备</title>
      <para>
        以下过程说明如何使用虚拟机管理器将主机计算机中的 PCI 设备指派到 VM Guest：
      </para>
      <procedure>
        <step>
          <para>
            双击虚拟机管理器中的某个 VM Guest 项打开其控制台，然后选择<menuchoice>
            <guimenu>视图</guimenu> <guimenu>细节</guimenu> </menuchoice>切换到<guimenu>细节</guimenu>视图。
          </para>
        </step>
        <step>
          <para>
            单击<guimenu>添加硬件</guimenu>，然后在左侧面板中选择 <guimenu>PCI 主机设备</guimenu>类别。窗口右侧将显示可用 PCI 设备的列表。
          </para>
          <figure>
            <title>添加 PCI 设备</title>
            <mediaobject>
              <imageobject role="fo">
                <imagedata fileref="virt_add_pcidevice.png" width="75%"/>
              </imageobject>
              <imageobject role="html">
                <imagedata fileref="virt_add_pcidevice.png" width="75%"/>
              </imageobject>
            </mediaobject>
          </figure>
        </step>
        <step>
          <para>
            在可用 PCI 设备的列表中，选择您要传递给 Guest 的设备。单击<guimenu>完成</guimenu>确认。
          </para>
        </step>
      </procedure>
      <important>
        <title>SLES 11 SP4 KVM Guest</title>
        <para>
          在包含 SLES 11 SP4 KVM Guest 的新型 QEMU 计算机（pc-i440fx-2.0 或更高版本）上，默认不会在 Guest 中装载 <systemitem class="resource">acpiphp</systemitem> 模块。必须装载此模块才能启用磁盘和网络设备热插拔功能。要手动装载该模块，请使用 <command>modprobe acpiphp</command> 命令。也可以通过在 <filename>/etc/modprobe.conf.local</filename> 文件中添加 <literal>install acpiphp
          /bin/true</literal> 来自动装载该模块。
        </para>
      </important>
      <important>
        <title>使用 QEMU Q35 计算机类型的 KVM Guest</title>
        <para>
          使用 QEMU Q35 计算机类型的 KVM Guest 采用 PCI 拓扑，其中包含一个 <literal>pcie-root</literal> 控制器和七个 <literal>pcie-root-port</literal> 控制器。<literal>pcie-root</literal> 控制器不支持热插拔。每个 <literal>pcie-root-port</literal> 控制器支持热插拔一个 PCIe 设备。PCI 控制器无法热插拔，因此，如果要热插拔的 PCIe 设备超过七个，请相应地做好规划并添加更多 <literal>pcie-root-port</literal> 控制器。可以添加一个 <literal>pcie-to-pci-bridge</literal> 控制器来支持热插拔旧式 PCI 设备。有关不同 QEMU 计算机类型的 PCI 拓扑的详细信息，请参见 <link xlink:href="https://libvirt.org/pci-hotplug.html"/>。
        </para>
      </important>
    </sect2>
  </sect1>
  <sect1 xml:id="sec-libvirt-config-usb">
    <title>将主机 USB 设备指派到 VM Guest</title>

    <para>
      与指派主机 PCI 设备（请参见<xref linkend="sec-libvirt-config-pci"/>）类似，您可以直接将主机 USB 设备指派到 Guest。将 USB 设备指派到某个 VM Guest 后，除非重新指派，否则在主机上无法使用该设备，其他 VM Guest 也不能使用该设备。
    </para>

    <sect2 xml:id="sec-libvirt-config-usb-vmm">
      <title>使用虚拟机管理器添加 USB 设备</title>
      <para>
        要使用虚拟机管理器将主机 USB 设备指派到 VM Guest，请执行以下步骤：
      </para>
      <procedure>
        <step>
          <para>
            双击虚拟机管理器中的某个 VM Guest 项打开其控制台，然后选择<menuchoice>
            <guimenu>视图</guimenu> <guimenu>细节</guimenu> </menuchoice>切换到<guimenu>细节</guimenu>视图。
          </para>
        </step>
        <step>
          <para>
            单击<guimenu>添加硬件</guimenu>，然后在左侧面板中选择 <guimenu>USB 主机设备</guimenu>类别。窗口右侧将显示可用 USB 设备的列表。
          </para>
          <figure>
            <title>添加 USB 设备</title>
            <mediaobject>
              <imageobject role="fo">
                <imagedata fileref="virt_add_usbdevice.png" width="75%"/>
              </imageobject>
              <imageobject role="html">
                <imagedata fileref="virt_add_usbdevice.png" width="75%"/>
              </imageobject>
            </mediaobject>
          </figure>
        </step>
        <step>
          <para>
            在可用 USB 设备的列表中，选择您要传递给 Guest 的设备。单击<guimenu>完成</guimenu>确认。新 USB 设备随即显示在<guimenu>细节</guimenu>视图的左侧窗格中。
          </para>
          <tip>
            <title>去除 USB 设备</title>
            <para>
              要去除主机 USB 设备指派，请在<guimenu>细节</guimenu>视图的左侧窗格中单击此设备，然后单击<guimenu>去除</guimenu>确认。
            </para>
          </tip>
        </step>
      </procedure>
    </sect2>
  </sect1>
</chapter>
