<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="sle_update_upgrading.xml" version="5.0" xml:id="cha.update.sle">
 <title>Aufrüsten von SUSE Linux Enterprise</title>
 <info>
  <abstract>
   <para>
    SUSE® Linux Enterprise (SLE) ermöglicht die Aktualisierung eines vorhandenen Systems auf die neue Version, zum Beispiel von SLE 11 SP4 zu SLE 12. Es ist keine neue Installation erforderlich. Bestehende Daten wie Home- und Datenverzeichnisse sowie Systemkonfigurationen bleiben erhalten. Sie können die Aktualisierung von einem lokalen CD- oder DVD-Laufwerk oder von einer zentralen Netzwerkinstallationsquelle durchführen.
   </para>

   <para>
    In diesem Kapitel erfahren Sie, wie Sie das SUSE Linux Enterprise-System manuell per DVD, über das Netzwerk, mit einem automatisierten Prozess oder mit SUSE Manager aufrüsten.
   </para>
  </abstract>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:translation>Ja</dm:translation>
  </dm:docmanager>
 </info>
 <sect1 xml:id="sec.update.sle.paths">
  <title>Unterstützte Aufrüstungspfade auf SLE 12 SP3</title>

  <important>
   <title>Architekturübergreifende Aufrüstungen werden nicht unterstützt</title>
   <para>
    Architekturübergreifende Aufrüstungen wie von einer 32-Bit-Version von <phrase role="productname"><phrase os="sled">SUSE Linux Enterprise Desktop</phrase></phrase> auf die 64-Bit-Version oder die Aufrüstung von Big Endian auf Little Endian werden <emphasis>nicht</emphasis> unterstützt.
   </para>
   <para>
    Insbesondere SLE 11 unter POWER (Big Endian) auf SLE 12 SP2 unter POWER (neu: Little Endian) wird <emphasis>nicht</emphasis> unterstützt.
   </para>
   <para>
    Da SUSE Linux Enterprise 12 nur in der 64-Bit-Version verfügbar ist, werden Aufrüstungen von 32-Bit-Systemen von SUSE Linux Enterprise 11 auf SUSE Linux Enterprise 12 und höher <emphasis>nicht</emphasis> unterstützt.
   </para>
   <para>
    Ist eine architekturübergreifende Aufrüstung erforderlich, so muss eine Neuinstallation ausgeführt werden.
   </para>
  </important>

  <para>
   Vor der Migration beachten Sie <xref linkend="sec.update.prep"/>.
  </para>

  <note>
   <title>Überspringen von Service Packs</title>
   <para>
    Die Installation aller Service Packs in der richtigen Reihenfolge ist der sicherste Aufrüstungspfad. In bestimmten Fällen können ein oder zwei Service Packs bei der Aufrüstung übersprungen werden. Es wird jedoch empfohlen, <emphasis>keine</emphasis> Service Packs zu überspringen. 
   </para>
  </note>

  <note>
   <title>Aufrüsten von Hauptversionen</title>
   <para>
    Beim Aufrüsten auf eine neue Hauptversion (z. B. von SUSE Linux Enterprise 11 auf SUSE Linux Enterprise 12) wird eine Neuinstallation empfohlen.
   </para>
  </note>

  <variablelist>
   <varlistentry>
    <term>Aufrüsten von SUSE Linux Enterprise 10 (mit beliebigem Service Pack)</term>
    <listitem>
     <para>
      Es gibt keinen unterstützten direkten Migrationspfad zu SUSE Linux Enterprise 12. In diesem Fall wird eine Neuinstallation empfohlen.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Aufrüsten von SUSE Linux Enterprise 11 GA, SP1 oder SP2</term>
    <listitem>
     <para>
      Es gibt keinen unterstützten direkten Migrationspfad zu SUSE Linux Enterprise 12. Zum Aufrüsten auf SLE 12 SP3 muss mindestens SLE 11 SP4 vorliegen.
     </para>
     <para>
      Falls Sie keine Neuinstallation ausführen können, rüsten Sie zunächst das installierte SLE 11-Service Pack auf SLE 11 SP4 auf. Diese Schritte werden im <link xlink:href="https://www.suse.com/documentation/sles11/">SUSE Linux Enterprise 11-Bereitstellungshandbuch</link> beschrieben.
     </para>
     <para>
      Fahren Sie anschließend mit <xref linkend="sec.update.sle.methods"/> fort.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Aufrüsten von SUSE Linux Enterprise 11 SP4</term>
    <listitem>
     <para>
      Das Aufrüsten von SLE 11 auf SLE 12 SP3 wird nur im Offline-Modus unterstützt. Weitere Informationen finden Sie unter <xref linkend="sec.update.sle.methods"/>.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Aufrüsten von SUSE Linux Enterprise 12 GA auf SP3</term>
    <listitem>
     <para>
      Eine direkte Aufrüstung von SLE 12 GA auf SP3 wird nicht unterstützt. Rüsten Sie zunächst auf SLE 12 SP2 auf.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Aufrüsten von SUSE Linux Enterprise 12 SP1 oder SP2 auf SP3</term>
    <listitem>
     <para>
      Die Aufrüstung von SUSE Linux Enterprise 12 SP1 oder SP2 auf SP3 wird unterstützt.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Aufrüsten von SUSE Linux Enterprise 12 LTSS GA, SP1 oder SP2 auf SP3</term>
    <listitem>
     <para>
      Die Aktualisierung einer früheren SLE 12-LTSS-Version auf SP3 wird unterstützt.
     </para>
    </listitem>
   </varlistentry>
  </variablelist>
  <figure xml:id="fig.update.sle.paths-overview">
   <title>Überblick über die kürzesten Aufrüstungspfade</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="upgrade-paths.svg" width="100%" format="SVG"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="upgrade-paths.png" width="80%" format="PNG"/>
    </imageobject>
   </mediaobject>
  </figure>
 </sect1>
 <sect1 xml:id="sec.update.sle.methods">
  <title>Online- und Offline-Aufrüstung</title>
  <para>
   SUSE unterstützt zwei verschiedene Aufrüstungs- und Migrationsmethoden. Weitere Informationen zu diesen Begriffen finden Sie unter <xref linkend="sec.update.sle.terminology"/>. Die folgenden Methoden werden unterstützt:
  </para>

  <variablelist>
   <varlistentry>
    <term>Online</term>
    <listitem>
     <para>
      Alle Aufrüstungen, die vom laufenden System aus gestartet werden, gelten als Online-Aufrüstungen. Beispiele: Verbindung über through SUSE Customer Center, Subscription Management Tool (SMT), SUSE Manager mit zypper oder YaST.
     </para>
     <para>
      Zur Migration auf andere Service Packs derselben Hauptversion wird <xref linkend="sec.update.migr.yast.onlinemigr"/> oder <xref linkend="sec.update.migr.zypper.onlinemigr"/> empfohlen.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Offline</term>
    <listitem>
     <para>
      Bei den Offline-Methoden wird in der Regel ein anderes Betriebssystem gebootet, von dem aus die installierte SLE-Version aufgerüstet wird. Beispiele: DVD, Flash-Laufwerk, ISO-Image, AutoYaST, <quote>einfaches RPM</quote> oder PXE-Boot.
     </para>
    </listitem>
   </varlistentry>
  </variablelist>
  <para>
   Die Aufrüstung von SUSE Linux Enterprise 11 SP4 auf SUSE Linux Enterprise 12 SP3 wird ausschließlich als Offline-Aufrüstung unterstützt. Weitere Informationen hierzu finden Sie unter <xref linkend="cha.update.offline"/>
  </para>

  <para>
   Die Aufrüstung einer beliebigen SUSE Linux Enterprise 12-LTSS-Version oder von SUSE Linux Enterprise 12 SP1 oder SP2 auf SP3 wird mit allen Offline- und Online-Methoden unterstützt. Weitere Informationen hierzu finden Sie unter <xref linkend="cha.update.offline"/> und <xref linkend="cha.update.online"/>.
  </para>
 </sect1>
 <sect1 xml:id="sec.update.prep">
  <title>Vorbereiten des Systems</title>
  <para>
   Vor Beginn der Aufrüstung muss das System ordnungsgemäß vorbereitet werden. Zur Vorbereitung gehören unter anderem das Sichern der Daten und das Lesen der Versionshinweise.
  </para>

  <sect2 xml:id="sec.update.prep.relnotes">
   <title>Lesen Sie die Versionshinweise</title>
   <para>
    In den Versionshinweisen finden Sie zusätzliche Informationen zu den Änderungen, die seit der vorangegangenen Version von <phrase role="productname"><phrase os="sled">SUSE Linux Enterprise Desktop</phrase></phrase> vorgenommen wurden. Informieren Sie sich in den Versionshinweisen über Folgendes:
   </para>
   <itemizedlist>
    <listitem>
     <para>
      Sind bei der Hardware besondere Überlegungen zu beachten?
     </para>
    </listitem>
    <listitem>
     <para>
      Wurden erhebliche Änderungen an den verwendeten Software-Paketen vorgenommen?
     </para>
    </listitem>
    <listitem>
     <para>
      Gelten besondere Vorsichtsmaßnahmen für die vorliegende Installation?
     </para>
    </listitem>
   </itemizedlist>
   <para>
    In den Versionshinweisen finden Sie auch Informationen, die erst nach der Fertigstellung des Handbuchs bekannt wurden. Auch bekannte Probleme werden beschrieben.
   </para>
   <para>
    Falls Sie mindestens ein Service Pack überspringen, beachten Sie auch die Versionshinweise der übersprungenen Service Packs. Die Versionshinweise enthalten in der Regel nur die Änderungen zwischen zwei aufeinander folgenden Versionen. Wenn Sie nur die aktuellen Versionshinweise lesen, entgehen Ihnen eventuell wichtige Änderungen.
   </para>
   <para>
    Die Versionshinweise befinden sich lokal im Verzeichnis <filename>/usr/share/doc/release-notes</filename> sowie online unter <link xlink:href="https://www.suse.com/releasenotes/"/>.
   </para>
  </sect2>
  <sect2 xml:id="sec.update.prep.backup">
   <title>Anlegen einer Sicherungskopie</title>
   <para>
    Kopieren Sie die bestehenden Konfigurationsdateien vor der Aktualisierung auf ein separates Medium (wie ein Bandlaufwerk oder eine externe Festplatte), um die Daten zu sichern. Dies gilt hauptsächlich für die in <filename>/etc</filename> gespeicherten Dateien sowie für bestimmte Verzeichnisse und Dateien in <filename>/var</filename> und <filename>/opt</filename>. Zudem empfiehlt es sich, die Benutzerdaten in <filename>/home</filename> (den <envar>HOME</envar>-Verzeichnissen) auf ein Sicherungsmedium zu schreiben. Melden Sie sich zur Sicherung dieser Daten als <systemitem class="username">root</systemitem> an. Nur der Benutzer <systemitem class="username">root</systemitem> verfügt über die Leseberechtigung für alle lokalen Dateien.
   </para>
   <para>
    Wenn Sie in YaST den Installationsmodus <guimenu>Vorhandenes System aktualisieren</guimenu> ausgewählt haben, können Sie später wahlweise eine (System-)Sicherung ausführen. Sie können alle geänderten Dateien und die Dateien aus dem Verzeichnis <filename>/etc/sysconfig</filename> einschließen. Dies ist allerdings keine vollständige Sicherung, da alle anderen wichtigen, oben genannten Verzeichnisse außer Acht gelassen werden. Die Sicherungskopie befindet sich im Verzeichnis<filename>/var/adm/backup</filename>.
   </para>
   <sect3 xml:id="sec.update.prep.backup.packagelist">
    <title>Auflisten installierter Pakete und Repositorys</title>
    <para>
     Eine Liste der installierten Pakete ist häufig von Nutzen, beispielsweise bei einer Neuinstallation einer neuen SLE-Hauptversion oder beim Zurücksetzen des Systems auf die bisherige Version.
    </para>
    <para>
     Denken Sie daran, dass nicht alle installierten Pakete oder verwendeten Repositorys in neueren Versionen von SUSE Linux Enterprise vorliegen. Einige Elemente wurden unter Umständen umbenannt, andere ersetzt. Außerdem könnten bestimmte Pakete weiterhin zu Legacy-Zwecken verfügbar sein, während standardmäßig ein anderes Paket herangezogen wird. Aus diesem Grund müssen die Dateien ggf. manuell bearbeitet werden. Dies können Sie mit einem beliebigen Texteditor durchführen.
    </para>
    <para>
     Erstellen Sie die Datei <filename>repositories.bak</filename> mit einer Liste aller verwendeten Repositorys.
    </para>
    <screen><prompt role="root">root # </prompt><command>zypper</command> lr -e repositories.bak</screen>
    <para>
     Erstellen Sie außerdem die Datei <filename>installed-software.bak</filename> mit einer Liste aller installierten Pakete:
    </para>
    <screen><prompt role="root">root # </prompt><command>rpm</command> -qa --queryformat '%{NAME}\n' &gt; installed-software.bak</screen>
    <para>
     Erstellen Sie Sicherungskopien beider Dateien. Die Repositorys und die installierten Pakete können mit den folgenden Befehlen wiederhergestellt werden:
    </para>
    <screen><prompt role="root">root # </prompt><command>zypper</command> ar repositories.bak
<prompt role="root">root # </prompt><command>zypper</command> install $(cat installed-software.bak)</screen>
   </sect3>
  </sect2>

  <sect2 xml:id="sec.update.prep.mariadb">
   <title>Migration der MySQL-Datenbank</title>
   <remark>toms 2015-09-03: already reviewed by Ondrej and Kristýna.</remark>
   <para>
    Ab SUSE Linux Enterprise 12 hat SUSE von MySQL auf MariaDB umgestellt. Bevor Sie die Aufrüstung starten, wird dringend empfohlen, die Datenbank zu sichern.
   </para>

   <para>
    So führen Sie die Datenbankmigration aus:
   </para>
   <procedure>
    <step>
     <para>
      Melden Sie sich auf dem SUSE Linux Enterprise 11-Computer an.
     </para>
    </step>
    <step>
     <para>
      Erstellen Sie eine Dump-Datei:
     </para>
<screen><prompt role="root">root # </prompt><command>mysqldump</command> -u root -p --all-databases &gt; mysql_backup.sql</screen>
     <para>
      Standardmäßig wird die Datenbank <literal>INFORMATION_SCHEMA</literal> oder <literal>performance_schema</literal> nicht im Speicherauszug mit <command>mysqldump</command> berücksichtigt. Weitere Einzelheiten finden Sie unter <link xlink:href="https://dev.mysql.com/doc/refman/5.5/en/mysqldump.html"/>.
     </para>
    </step>
    <step>
     <para>
      Legen Sie die Dump-Datei, die Konfigurationsdatei <filename>/etc/my.cnf</filename> und das Verzeichnis <filename>/etc/mysql/</filename> zur späteren Untersuchung (<emphasis>NICHT</emphasis> Installation!) an einem sicheren Speicherort ab.
     </para>
    </step>
    <step>
     <para>
      Führen Sie die Aufrüstung aus. Nach der Aufrüstung ist die bisherige Konfigurationsdatei <filename>/etc/my.cnf</filename> unverändert. Die neue Konfiguration finden Sie in der Datei <filename>/etc/my.cnf.rpmnew</filename>.
     </para>
    </step>
    <step>
     <para>
      Konfigurieren Sie die MariaDB-Datenbank je nach Bedarf. Bearbeiten Sie dabei <emphasis>NICHT</emphasis> die bisherige Konfigurationsdatei und das frühere Verzeichnis, sondern nutzen Sie diese nur als Vorlage, und passen Sie die Einstellungen entsprechend an.
     </para>
    </step>
    <step>
     <para>
      Starten Sie den MariaDB-Server:
     </para>
<screen><prompt role="root">root # </prompt><command>systemctl</command> start mysql</screen>
     <para>
      Soll der MariaDB-Server bei jedem Booten gestartet werden, aktivieren Sie den Dienst:
     </para>
<screen><prompt role="root">root # </prompt><command>systemctl</command> enable mysql</screen>

    </step>
    <step>
     <para>
      Prüfen Sie, ob MariaDB ordnungsgemäß ausgeführt wird. Stellen Sie hierzu eine Verbindung zur Datenbank her:
     </para>
<screen><prompt role="root">root # </prompt><command>mysql</command> -u root -p</screen>
    </step>
   </procedure>
  </sect2>

  <sect2 xml:id="sec.update.prep.postgresql">
   <title>Migration der PostgreSQL-Datenbank</title>
   <remark>toms 2015-09-09: FATE#319049</remark>
   <remark>Already reviewd by Reinhard</remark>
   <para>
    SLE11 SP3 und SLE12 GA erhalten eine neuere Version der PostgreSQL-Datenbank als Wartungsaktualisierung. Aufgrund der erforderlichen Migrationsschritte für die Datenbank ist kein automatischer Upgradevorgang verfügbar. Die Umstellung auf die neue Version muss daher manuell erfolgen.
   </para>
   <para>
    Der Migrationsvorgang wird mit dem Befehl <command>pg_upgrade</command> ausgeführt. Dieser Befehl ist eine alternative Methode zur bewährten Methode mit Erstellen eines Speicherauszugs und Neuladen. Im Vergleich zu <quote>Speicherauszug und Neuladen</quote> ist die Migration mit <command>pg_upgrade</command> weniger zeitaufwändig.
   </para>
   <para>
    Die Dateien der verschiedenen PostgreSQL-Versionen sind jeweils in verschiedenen versionsabhängigen Verzeichnissen gespeichert. Nach der Aktualisierung gelten die folgenden neuen Verzeichnisse:
   </para>
   <variablelist>
    <varlistentry>
     <term>SLE11 SP3/SP4</term>
     <listitem>
      <para>
       <filename>/usr/lib/postgresql91/</filename> to <filename>/usr/lib/postgresql94/</filename>
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>SLE12 GA</term>
     <listitem>
      <para>
       <filename>/usr/lib/postgresql93/</filename> to <filename>/usr/lib/postgresql94/</filename>
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
   <para>
    So führen Sie die Datenbankmigration aus:
   </para>
   <procedure>
    <step>
     <para>
      Prüfen Sie, ob die folgenden Voraussetzungen erfüllt sind:
     </para>
     <itemizedlist>
      <listitem>
       <para>
        Rüsten Sie alle Pakete der alten PostgreSQL-Version per Wartungsaktualisierung auf die aktuelle Version auf, sofern Sie dies noch nicht erledigt haben.
       </para>
      </listitem>
      <listitem>
       <para>
        Erstellen Sie eine Sicherung der vorhandenen Datenbank.
       </para>
      </listitem>
      <listitem>
       <para>
        Installieren Sie die Pakete der neuen PostgreSQL-Hauptversion. Bei SLE 12 installieren Sie
        <package>postgresql94-server</package>
        und alle Pakete, von denen dieses Paket abhängig ist.
       </para>
      </listitem>
      <listitem>
       <para>
        Installieren Sie das Paket
        <package>postgresql94-contrib</package>
        (enthält den Befehl <command>pg_upgrade</command>).
       </para>
      </listitem>
      <listitem>
       <para>
        Prüfen Sie, ob ausreichend freier Speicherplatz im PostgreSQL-Datenbereich verfügbar ist (standardmäßig <filename>/var/lib/pgsql/data</filename>). Falls der Speicherplatz nicht ausreicht, versuchen Sie, die einzelnen Datenbanken mit dem folgenden SQL-Befehl zu verkleinern (kann sehr lange dauern!):
       </para>
<screen>VACUUM FULL</screen>
      </listitem>
     </itemizedlist>
    </step>
    <step>
     <para>
      Halten Sie den PostgreSQL-Server an:
     </para>
<screen><prompt role="root">root # </prompt><command>/usr/sbin/rcpostgresql</command> stop</screen>
    </step>
    <step>
     <para>
      Benennen Sie das alte Datenverzeichnis um:
     </para>
<screen><prompt role="root">root # </prompt><command>mv</command> /var/lib/pgsql/data /var/lib/pgsql/data.old</screen>
    </step>
    <step>
     <para>
      Erstellen Sie ein neues Datenverzeichnis:
     </para>
<screen><prompt role="root">root # </prompt><command>mkdir</command> -p /var/lib/pgsql/data</screen>
    </step>
    <step>
     <para>
      Wenn Sie die Konfigurationsdateien in der alten Version geändert hatten, kopieren Sie die Dateien <filename>postgresql.conf</filename>
      <filename> und pg_hba.conf</filename> in das neue Verzeichnis <filename>data</filename>:
     </para>
<screen><prompt role="root">root # </prompt><command>cp</command> /var/lib/pgsql/data.old/*.conf \
     /var/lib/pgsql/data</screen>
    </step>
    <step>
     <para>
      Initialisieren Sie die neue Datenbankinstanz manuell mit <command>initdb</command> oder starten und stoppen Sie PostgreSQL, wodurch die Instanz automatisch initialisiert wird:
     </para>
<screen><prompt role="root">root # </prompt><command>/usr/sbin/rcpostgresql</command> start
<prompt role="root">root # </prompt><command>/usr/sbin/rcpostgresql</command> stop</screen>
    </step>
    <step>
     <para>
      Starten Sie den Migrationsvorgang und ersetzen Sie den Platzhalter <replaceable>OLD</replaceable> durch die ältere Version:
     </para>
<screen><prompt role="root">root # </prompt><command>pg_upgrade</command> \
   --old-datadir "/var/lib/pgsql/data.old" \
   --new-datadir "/var/lib/pgsql/data" \
   --old-bindir "/usr/lib/postgresql<replaceable>OLD</replaceable>/bin/" \
   --new-bindir "/usr/lib/postgresql94/bin/"</screen>
    </step>
    <step>
     <para>
      Starten Sie die neue Datenbankinstanz:
     </para>
<screen><prompt role="root">root # </prompt><command>/usr/sbin/rcpostgresql</command> start</screen>
    </step>
    <step>
     <para>
      Überprüfen Sie, ob die Migration erfolgreich war. Für diesen Schritt gibt es kein automatisiertes Tool. Der Umfang und die Elemente für den Test sind abhängig von Ihrem jeweiligen Anwendungsfall.
     </para>
    </step>
    <step>
     <para>
      Entfernen Sie alle alten PostgreSQL-Pakete und das alte Datenverzeichnis:
     </para>
<screen><prompt role="root">root # </prompt><command>zypper</command> search -s postgresql<replaceable>OLD</replaceable> | xargs zypper rm -u
<prompt role="root">root # </prompt><command>rm</command> -rf /var/lib/pgsql/data.old</screen>
    </step>
   </procedure>
  </sect2>

  <sect2 xml:id="sec.update.prep.ssl">
   <title>Erstellen von Nicht-MD5-Server-Zertifikaten für Java-Anwendungen</title>
   <remark>toms 2016-07-27: from bsc#970153, c#24</remark>
   <para>
    Beim Update von SP1 auf SP2 wurden MD5-basierte Zertifikate im Rahmen eines Sicherheits-Fixes deaktiviert. Wenn Sie über als MD5 erstellte Zertifikate verfügen, erstellen Sie diese mit folgenden Schritten neu:
   </para>

   <procedure>
    <step>
     <para>
      Öffnen Sie ein Terminal und melden Sie sich als <systemitem class="username">root</systemitem> an.
     </para>
    </step>
    <step>
     <para>
      Erstellen Sie einen privaten Schlüssel:
     </para>
     <screen><prompt role="root">root # </prompt><command>openssl</command> genrsa -out server.key 1024</screen>
     <para>
      Wenn Sie einen Schlüssel mit höherer Sicherheit wünschen, ersetzen Sie <literal>1024</literal> durch eine höhere Zahl, z. B. <literal>4096</literal>.
     </para>
    </step>
    <step>
     <para>
      Erstellen Sie einen Zertifizierungsantrag (CSR):
     </para>
     <screen><prompt role="root">root # </prompt><command>openssl</command> req -new -key server.key -out server.csr</screen>
    </step>
    <step>
     <para>
      Führen Sie eine Eigensignierung des Zertifikats durch:
     </para>
     <screen><prompt role="root">root # </prompt><command>openssl</command> x509 -req -days 365 -in server.csr -signkey server.key -out server.crt</screen>
    </step>
    <step>
     <para>
      Erstellen Sie die PEM-Datei:
     </para>
     <screen><prompt role="root">root # </prompt><command>cat</command> server.key server.crt &gt; server.pem</screen>
    </step>
    <step>
     <para>Legen Sie die Dateien <filename>server.crt</filename>, <filename>server.csr</filename>, <filename>server.key</filename> und <filename>server.pem</filename> in den jeweiligen Verzeichnissen ab, in denen die Schlüssel gefunden werden können. Für Tomcat beispielsweise lautet das Verzeichnis <filename>/etc/tomcat/ssl/</filename>.
     </para>
    </step>
   </procedure>
  </sect2>

  <sect2 xml:id="sec.update.prep.vms">
   <title>Herunterfahren von VM-Gästen</title>
   <para>
    Wenn Ihr Rechner als VM-Hostserver für KVM oder Xen fungiert, müssen Sie vor der Aktualisierung alle aktiven VM-Gäste ordnungsgemäß herunterfahren. Andernfalls können Sie nach der Aktualisierung wahrscheinlich nicht mehr auf die Gäste zugreifen.
   </para>
  </sect2>

  <sect2 xml:id="sec.update.prep.smt">
   <title>Prüfen des Skripts <command>clientSetup4SMT.sh</command> auf SMT-Clients</title>
   <para>
    Wenn Sie Ihr bei einem SMT-Server registriertes Clientbetriebssystem migrieren möchten, müssen Sie prüfen, ob die Version des Skripts <command>clientSetup4SMT.sh</command> auf dem Host aktuell ist. <command>clientSetup4SMT.sh</command> aus älteren Versionen von SMT kann nicht zum Verwalten von SMT 12-Clients verwendet werden. Wenn Sie auf Ihrem SMT-Server regelmäßig Software-Patches anwenden, finden Sie die neueste Version von <command>clientSetup4SMT.sh</command> immer unter <filename>&lt;SMT_HOSTNAME&gt;/repo/tools/clientSetup4SMT.sh</filename>.
   </para>
  </sect2>

  <sect2 xml:id="sec.update.disk">
   <title>Festplattenspeicher</title>

   <para>
    Software weist normalerweise von Version zu Version mehr Umfang auf. Folglich sollten Sie vor dem Aktualisieren den verfügbaren Partitionsspeicher überprüfen. Wenn Sie befürchten, dass der Speicherplatz nicht ausreicht, sichern Sie Ihre Daten und erhöhen Sie dann den verfügbaren Speicherplatz, indem Sie beispielsweise die Größe von Partitionen ändern. Es gibt keine Faustregel hinsichtlich des Speicherplatzes einzelner Partitionen. Die Platzanforderungen hängen von Ihrem bestimmten Partitionsprofil und von der ausgewählten Software ab.
   </para>

   <note>
    <title>Automatische Prüfung des verfügbaren Speicherplatzes in YaST</title>
    <para>
     YaST prüft während des Aktualisierungsvorgangs den freien verfügbaren Speicherplatz und zeigt dem Benutzer eine Warnmeldung an, wenn die verfügbare Menge möglicherweise nicht für die Installation ausreicht. Wenn Sie die Aktualisierung in diesem Fall dennoch durchführen, kann das <emphasis>System unbrauchbar</emphasis> werden! Sie sollten die Warnmeldung nur dann ignorieren und mit der Aktualisierung fortfahren, wenn Sie genau wissen, was Sie tun (da Sie dies in einem Vorabtest abgeklärt haben).
    </para>
   </note>

   <sect3 xml:id="sec.update.disk.space">
    <title>Ermitteln des freien Speicherplatzes auf Nicht-Btrfs-Dateisystemen</title>
    <para>
     Listen Sie mit dem Kommando <command>df</command> den verfügbaren Speicherplatz auf. In <xref linkend="aus.update.df"/> ist beispielsweise <filename>/dev/sda3</filename> die Root-Partition (eingehängt als <filename>/</filename>).
    </para>
    <example xml:id="aus.update.df">
     <title>Über <command>df -h</command> angezeigte Liste</title>
<screen os="sled">Filesystem     Size  Used Avail Use% Mounted on
/dev/sda3       74G   22G   53G  29% /
tmpfs          506M     0  506M   0% /dev/shm
/dev/sda5      116G  5.8G  111G   5% /home
/dev/sda1       39G  1.6G   37G   4% /windows/C
/dev/sda2      4.6G  2.6G  2.1G  57% /windows/D</screen>

    </example>
   </sect3>

   <sect3 xml:id="sec.update.disk.btrfs-on-root">
    <title>Ermitteln des freien Speicherplatzes auf Btrfs-Root-Dateisystemen</title>
    <para>
     Wenn Sie Btrfs als Root-Dateisysteme auf dem Computer nutzen, muss ausreichend freier Speicherplatz zur Verfügung stehen. Im schlimmsten Fall belegt eine Aufrüstung ebenso viel Speicherplatz wie das aktuelle Root-Dateisystem (ohne <filename>/.snapshot</filename>) für einen neuen Snapshot. Mit diesem Befehl rufen Sie den verfügbaren Speicherplatz ab:
    </para>
<screen><prompt role="root">root # </prompt><command>df</command> -h /</screen>
    <para>
     Prüfen Sie auch den verfügbaren Platz auf allen anderen eingehängten Partitionen. Die folgenden Empfehlungen haben sich bewährt:
    </para>
    <itemizedlist>
     <listitem>
      <para>
       Bei allen Dateisystemen (auch Btrfs) benötigen Sie ausreichend freien Speicherplatz, damit Sie große RPMs herunterladen und installieren können. Der Speicherplatz der alten RPMs wird erst dann freigegeben, wenn die neuen RPMs installiert sind.
      </para>
     </listitem>
     <listitem>
      <para>
       Bei Btrfs mit Snapshots benötigen Sie mindestens so viel freien Speicherplatz, wie von der aktuellen Installation belegt wird. Es wird mindestens der doppelte freie Speicherplatz empfohlen, wie von der aktuellen Installation belegt wird.
      </para>
      <para>
       Falls nicht ausreichend freier Speicherplatz verfügbar ist, können Sie ältere Snapshots mit <command>snapper</command> löschen:
      </para>
<screen><prompt role="root">root # </prompt><command>snapper</command> list
<prompt role="root">root # </prompt><command>snapper</command> delete NUMBER</screen>
      <para>
       Dies reicht jedoch nicht in allen Fällen aus. Vor der Migration belegen die meisten Snapshots nur wenig Platz.
      </para>
     </listitem>
    </itemizedlist>
   </sect3>
  </sect2>
  <sect2 xml:id="sec.update.prep.multiversion">
   <title>Vorübergehende Deaktivierung der Unterstützung mehrerer Kernel-Versionen</title>
   <para>
    <phrase role="productname"><phrase os="sled">SUSE Linux Enterprise Desktop</phrase></phrase> ermöglicht die Installation mehrerer Kernel-Versionen. Hierfür müssen die entsprechenden Einstellungen in <filename>/etc/zypp/zypp.conf</filename> aktiviert werden. Für die Aufrüstung auf ein Service Pack muss diese Funktion vorübergehend deaktiviert werden. Sobald die Aktualisierung erfolgreich abgeschlossen wurde, kann die Unterstützung mehrerer Versionen wieder aktiviert werden. Zur Deaktivierung der Unterstützung mehrerer Versionen müssen die entsprechenden Zeilen in der Datei <filename>/etc/zypp/zypp.conf</filename> auf Kommentar gesetzt werden. Das Ergebnis sollte wie folgt aussehen:
   </para>
<screen>#multiversion = provides:multiversion(kernel)
#multiversion.kernels = latest,running</screen>
   <para>
    Wenn Sie diese Funktion nach einer erfolgreichen Aktualisierung wieder aktivieren möchten, entfernen Sie die Kommentarzeichen. Weitere Informationen zur Unterstützung mehrerer Versionen finden Sie in <xref linkend="cha.tuning.multikernel.enable"/>.
   </para>
  </sect2>
 </sect1>
 
 
</chapter>
