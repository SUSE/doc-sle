<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sect1
[
  <!ENTITY % entities SYSTEM "generic-entities.ent">
    %entities;
]>

<sect1 version="5.0" xml:id="CreateProfile-Network"
  xmlns="http://docbook.org/ns/docbook"
  xmlns:xi="http://www.w3.org/2001/XInclude"
  xmlns:xlink="http://www.w3.org/1999/xlink">
  <title>Network Configuration</title>

 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:bugtracker></dm:bugtracker>
   <dm:translation>yes</dm:translation>
  </dm:docmanager>
 </info>

   <para>
    Network configuration is used to connect a single workstation to an
    Ethernet-based LAN or to configure a dial-up connection. More complex
    configurations (multiple network cards, routing, etc.) are also
    provided.
   </para>

   <para>
    If the following setting is set to <literal>true</literal>, &yast;
    will keep network settings created during the installation (via
    <command>linuxrc</command>) and/or merge it with network settings from the
    &ay; control file (if defined).
   </para>
   <note>
    <title>The <command>linuxrc</command> program</title>
    <para>
     For a detailed description of how <command>linuxrc</command> works and its
     keywords, see <xref linkend="appendix-linuxrc"/>.
    </para>
   </note>
   <para>
    &ay; settings have higher priority than any configuration files already
    present. &yast; will write ifcfg-* files based on the entries in the control
    file without removing old ones. If there is an empty or absent DNS and
    routing section, &yast; will keep any pre-existing values. Otherwise,
    settings from the control file will be applied.
   </para>

<screen>&lt;keep_install_network
config:type="boolean"&gt;true&lt;/keep_install_network&gt;</screen>

   <para>
    During the second stage, installation of additional packages will take
    place before the network, as described in the profile, is configured.
    <literal>keep_install_network</literal> is set by default to
    <literal>true</literal> to ensure that a network is available
    in case it is needed to install those packages. If all packages
    are installed during the first stage and the network is not needed early
    during the second one, setting <literal>keep_install_network</literal>
    to <literal>false</literal> will avoid copying the configuration.
   </para>

   <para>
    To configure network settings and activate networking automatically, one
    global resource is used to store the whole network configuration.
   </para>

   <example xml:id="ex-ay-network-config-general">
    <title>Network Configuration</title>
<screen>&lt;networking&gt;
  &lt;dns&gt;
    &lt;dhcp_hostname config:type="boolean"&gt;true&lt;/dhcp_hostname&gt;
    &lt;domain&gt;site&lt;/domain&gt;
    &lt;hostname&gt;linux-bqua&lt;/hostname&gt;
    &lt;nameservers config:type="list"&gt;
      &lt;nameserver&gt;&dnsip;&lt;/nameserver&gt;
      &lt;nameserver&gt;&dnsip117;&lt;/nameserver&gt;
      &lt;nameserver&gt;&dnsip118;&lt;/nameserver&gt;
    &lt;/nameservers&gt;
    &lt;resolv_conf_policy&gt;auto&lt;/resolv_conf_policy&gt;
    &lt;searchlist config:type="list"&gt;
      &lt;search&gt;&exampledomain;&lt;/search&gt;
      &lt;search&gt;&exampledomain1;&lt;/search&gt;
    &lt;/searchlist&gt;
    &lt;write_hostname config:type="boolean"&gt;false&lt;/write_hostname&gt;
  &lt;/dns&gt;
  &lt;interfaces config:type="list"&gt;
    &lt;interface&gt;
      &lt;bootproto&gt;dhcp&lt;/bootproto&gt;
      &lt;device&gt;eth0&lt;/device&gt;
      &lt;startmode&gt;auto&lt;/startmode&gt;
    &lt;/interface&gt;
    &lt;interface&gt;
      &lt;bootproto&gt;static&lt;/bootproto&gt;
      &lt;broadcast&gt;127.255.255.255&lt;/broadcast&gt;
      &lt;device&gt;lo&lt;/device&gt;
      &lt;firewall&gt;no&lt;/firewall&gt;
      &lt;ipaddr&gt;127.0.0.1&lt;/ipaddr&gt;
      &lt;netmask&gt;255.0.0.0&lt;/netmask&gt;
      &lt;network&gt;127.0.0.0&lt;/network&gt;
      &lt;prefixlen&gt;8&lt;/prefixlen&gt;
      &lt;startmode&gt;nfsroot&lt;/startmode&gt;
      &lt;usercontrol&gt;no&lt;/usercontrol&gt;
    &lt;/interface&gt;
  &lt;/interfaces&gt;
  &lt;ipv6 config:type="boolean"&gt;true&lt;/ipv6&gt;
  &lt;keep_install_network config:type="boolean"&gt;false&lt;/keep_install_network&gt;
  ## false means use Wicked, true means use NetworkManager
  &lt;managed config:type="boolean"&gt;false&lt;/managed&gt;
  &lt;net-udev config:type="list"&gt;
    &lt;rule&gt;
      &lt;name&gt;eth0&lt;/name&gt;
      &lt;rule&gt;ATTR{address}&lt;/rule&gt;
      &lt;value&gt;&wsImac;&lt;/value&gt;
    &lt;/rule&gt;
  &lt;/net-udev&gt;
  &lt;s390-devices config:type="list"&gt;
    &lt;listentry&gt;
      &lt;chanids&gt;0.0.0800 0.0.0801 0.0.0802&lt;/chanids&gt;
      &lt;type&gt;qeth&lt;/type&gt;
    &lt;/listentry&gt;
  &lt;/s390-devices&gt;
  &lt;routing&gt;
    &lt;ipv4_forward config:type="boolean"&gt;false&lt;/ipv4_forward&gt;
    &lt;ipv6_forward config:type="boolean"&gt;false&lt;/ipv6_forward&gt;
    &lt;routes config:type="list"&gt;
      &lt;route&gt;
        &lt;destination&gt;&routerintipII;&lt;/destination&gt;
        &lt;device&gt;eth0&lt;/device&gt;
        &lt;extrapara&gt;foo&lt;/extrapara&gt;
        &lt;gateway&gt;-&lt;/gateway&gt;
        &lt;netmask&gt;-&lt;/netmask&gt;
      &lt;/route&gt;
      &lt;route&gt;
        &lt;destination&gt;default&lt;/destination&gt;
        &lt;device&gt;eth0&lt;/device&gt;
        &lt;gateway&gt;&routerintipI;&lt;/gateway&gt;
        &lt;netmask&gt;-&lt;/netmask&gt;
      &lt;/route&gt;
      &lt;route&gt;
        &lt;destination&gt;default&lt;/destination&gt;
        &lt;device&gt;lo&lt;/device&gt;
        &lt;gateway&gt;&gateip;&lt;/gateway&gt;
        &lt;netmask&gt;-&lt;/netmask&gt;
      &lt;/route&gt;
    &lt;/routes&gt;
  &lt;/routing&gt;
&lt;/networking&gt;</screen>
   </example>

   <example xml:id="ex-ay-network-config-bridge">
     <title>Bridge Interface Configuration</title>
<screen>
&lt;interfaces config:type="list"&gt;
  &lt;interface&gt;
    &lt;device&gt;br0&lt;/device&gt;
    &lt;bootproto&gt;static&lt;/bootproto&gt;
    &lt;bridge&gt;yes&lt;/bridge&gt;
    &lt;bridge_forwarddelay&gt;0&lt;/bridge_forwarddelay&gt;
    &lt;bridge_ports&gt;eth0 eth1&lt;/bridge_ports&gt;
    &lt;bridge_stp&gt;off&lt;/bridge_stp&gt;
    &lt;ipaddr&gt;&subnetI;.100&lt;/ipaddr&gt;
    &lt;netmask&gt;&subnetmask;&lt;/netmask&gt;
    &lt;network&gt;&subnetI;.0&lt;/network&gt;
    &lt;prefixlen&gt;24&lt;/prefixlen&gt;
    &lt;startmode&gt;auto&lt;/startmode&gt;
  &lt;/interface&gt;
  &lt;interface&gt;
    &lt;device&gt;eth0&lt;/device&gt;
    &lt;bootproto&gt;none&lt;/bootproto&gt;
    &lt;startmode&gt;hotplug&lt;/startmode&gt;
  &lt;/interface&gt;
  &lt;interface&gt;
    &lt;device&gt;eth1&lt;/device&gt;
    &lt;bootproto&gt;none&lt;/bootproto&gt;
    &lt;startmode&gt;hotplug&lt;/startmode&gt;
  &lt;/interface&gt;
&lt;/interfaces&gt;
</screen>
   </example>

   <tip>
    <title>IPv6 Address Support</title>
    <para>
     Using IPv6 addresses in &ay; is fully supported. To disable IPv6
     Address Support, set &lt;ipv6
     config:type="boolean"&gt;false&lt;/ipv6&gt;
    </para>
   </tip>

   <sect2 xml:id="CreateProfile-Network-names">
    <title>Persistent Names of Network Interfaces</title>
    <para>
     The following elements must be between the
     &lt;net-udev&gt;...&lt;/net-udev&gt; tags.
    </para>
    <informaltable>
     <tgroup cols="3">
      <thead>
       <row>
        <entry>
         <para>
          Element
         </para>
        </entry>
        <entry>
         <para>
          Description
         </para>
        </entry>
        <entry>
         <para>
          Comment
         </para>
        </entry>
       </row>
      </thead>
      <tbody>
       <row>
        <entry>
         <para>
          name
         </para>
        </entry>
        <entry>
         <para>
          Network interface name, for example <literal>eth3</literal>
         </para>
        </entry>
        <entry>
         <para>
          required
         </para>
        </entry>
       </row>
       <row>
        <entry>
         <para>
          rule
         </para>
        </entry>
        <entry>
         <para>
          <literal>ATTR{address}</literal> for a MAC based rule,
          <literal>KERNELS</literal> for a bus ID based rule
         </para>
        </entry>
        <entry>
         <para>
          required
         </para>
        </entry>
       </row>
       <row>
        <entry>
         <para>
          value
         </para>
        </entry>
        <entry>
         <para>
          for example <literal>f0:de:f1:6b:da:69</literal> for a MAC rule,
          <literal>0000:00:1c.1 or 0.0.0700</literal> for a bus ID rule
         </para>
        </entry>
        <entry>
         <para>
          required
         </para>
        </entry>
       </row>
      </tbody>
     </tgroup>
    </informaltable>

    <tip>
     <title>Handling Collisions in Device Names</title>
      <para>
       When creating an incomplete <emphasis>udev</emphasis> rule set, the
       chosen device name can collide with existing device names. For
       example, when renaming a network interface to <literal>eth0</literal>,
       a collision with a device automatically generated by the kernel can
       occur. &ay; tries to handle such cases in a best effort manner and
       renames colliding devices.
      </para>
     </tip>
    </sect2>

   <sect2 xml:id="CreateProfile-Network-s390">
    <title>s390 Options</title>
    <para>
     The following elements must be between the
     &lt;s390-devices&gt;...&lt;/s390-devices&gt; tags.
    </para>
    <informaltable>
     <tgroup cols="3">
      <thead>
       <row>
        <entry>
         <para>
          Element
         </para>
        </entry>
        <entry>
         <para>
          Description
         </para>
        </entry>
        <entry>
         <para>
          Comment
         </para>
        </entry>
       </row>
      </thead>
      <tbody>
       <row>
        <entry>
         <para>
          type
         </para>
        </entry>
        <entry>
         <para>
          qeth, ctc or iucv
         </para>
        </entry>
        <entry>
         <para/>
        </entry>
       </row>
       <row>
        <entry>
         <para>
          chanids
         </para>
        </entry>
        <entry>
         <para>
          channel ids separated by spaces
         </para>
<screen>&lt;chanids&gt;0.0.0700 0.0.0701 0.0.0702&lt;/chanids&gt;</screen>
        </entry>
        <entry>
         <para/>
        </entry>
       </row>
       <row>
        <entry>
         <para>
          layer2
         </para>
        </entry>
        <entry>
         <para/>
<screen>&lt;layer2 config:type="boolean"&gt;true&lt;/layer2&gt;</screen>
        </entry>
        <entry>
         <para>
          boolean; default: false
         </para>
        </entry>
       </row>
       <row>
        <entry>
         <para>
          portname
         </para>
        </entry>
        <entry>
         <para>
          QETH port name (deprecated since <phrase os="sles;sled">SLE 12
          SP2</phrase><phrase os="osuse">openSUSE 42.2</phrase>)
         </para>
        </entry>
        <entry>
         <para/>
        </entry>
       </row>
       <row>
        <entry>
         <para>
          protocol
         </para>
        </entry>
        <entry>
         <para>
          CTC / LCS protocol, a small number (as a string)
         </para>
<screen>&lt;protocol&gt;1&lt;/protocol&gt;</screen>
        </entry>
        <entry>
         <para>
          optional
         </para>
        </entry>
       </row>
       <row>
        <entry>
         <para>
          router
         </para>
        </entry>
        <entry>
         <para>
          IUCV router/user
         </para>
        </entry>
        <entry>
         <para/>
        </entry>
       </row>
      </tbody>
     </tgroup>
    </informaltable>

    <para>
     In addition to the options mentioned above, &ay; also supports
     &zseries;-specific options in other sections of the configuration file.
     In particular, you can define the logical link address, or LLADDR (in
     the case of Ethernet, that is the MAC address). To do so, use the option
     <literal>LLADDR</literal> in the device definition.
    </para>
    <tip>
     <title>LLADDR for VLANs</title>
     <para>
      VLAN devices inherit their LLADDR from the underlying physical devices.
      To set a particular address for a VLAN device, set the
      LLADDR option for the underlying physical device.
     </para>
    </tip>
   </sect2>

   <sect2 xml:id="Configuration-Network-Proxy">
    <title>Proxy</title>
    <para>
     Configure your Internet proxy (caching) settings.
    </para>
    <para>
     Configure proxies for HTTP, HTTPS, and FTP with
     <literal>http_proxy</literal>, <literal>https_proxy</literal>
     and <literal>ftp_proxy</literal>, respectively. Addresses or names that
     should be directly accessible need to be specified with
     <literal>no_proxy</literal> (space separated values). If you are using
     a proxy server with authorization, fill in
     <literal>proxy_user</literal> and <literal>proxy_password</literal>,
    </para>
    <example>
     <title>Network configuration: Proxy</title>
<screen>&lt;proxy&gt;
  &lt;enabled config:type="boolean"&gt;true&lt;/enabled&gt;
  &lt;ftp_proxy&gt;http://192.168.1.240:3128&lt;/ftp_proxy&gt;
  &lt;http_proxy&gt;http://192.168.1.240:3128&lt;/http_proxy&gt;
  &lt;no_proxy&gt;www.&exampledomain; .&exampledomain2; localhost&lt;/no_proxy&gt;
  &lt;proxy_password&gt;testpw&lt;/proxy_password&gt;
  &lt;proxy_user&gt;testuser&lt;/proxy_user&gt;
&lt;/proxy&gt;</screen>
    </example>
   </sect2>
   <!-- 2017-10-20 tbazant: xinetd is gone (https://fate.suse.com/323373)
   <sect2 xml:id="Configuration-Network-Inetd">
    <title>(X)Inetd</title>
    <para>
     The control file has elements to specify which superserver should be
     used (netd_service), whether it should be enabled (netd_status) and how
     the services should be configured (netd_conf).
    </para>
    <para>
     A service description element needs two parts: key and non-key. When
     writing the configuration, services are matched using the key fields;
     to the matching service, non-key fields are applied. If no service
     matches, it is created. If more services match, a warning is reported.
     The key fields are <emphasis>script, service, protocol and
     server.</emphasis>
    </para>
    <para>
     <emphasis>service</emphasis> and <emphasis>protocol</emphasis> are
     matched literally. <emphasis>script</emphasis> is the base name of the
     configuration file: usually a file in<filename>
     /etc/xinetd.d</filename>, for example "echo-udp", or "inetd.conf". For
     compatibility with 8.2, <emphasis>server</emphasis> is matched more
     loosely: if it is <filename>/usr/sbin/tcpd</filename>, the real server
     name is taken from <emphasis>server_args</emphasis>. After that, the
     basename of the first whitespace-separated word is taken and these
     values are compared.
    </para>

    <example>
     <title>Inetd Example</title>
<screen>&lt;profile&gt;
  &lt;inetd&gt;
    &lt;netd_service config:type="symbol"&gt;xinetd&lt;/netd_service&gt;
    &lt;netd_status config:type="integer"&gt;0&lt;/netd_status&gt;
    &lt;netd_conf config:type="list"&gt;
      &lt;conf&gt;
        &lt;script&gt;imap&lt;/script&gt;
        &lt;service&gt;pop3&lt;/service&gt;
        &lt;enabled config:type="boolean"&gt;true&lt;/enabled&gt;
      &lt;/conf&gt;
      &lt;conf&gt;
        &lt;server&gt;in.ftpd&lt;/server&gt;
        &lt;server_args&gt;-A&lt;/server_args&gt;
        &lt;enabled config:type="boolean"&gt;true&lt;/enabled&gt;
      &lt;/conf&gt;
      &lt;conf&gt;
        &lt;service&gt;daytime&lt;/service&gt;
        &lt;protocol&gt;tcp&lt;/protocol&gt;
      &lt;/conf&gt;
      &lt;conf&gt;...&lt;/conf&gt;
    &lt;/netd_conf&gt;
  &lt;/inetd&gt;
&lt;/profile&gt;</screen>
    </example>
   </sect2> -->
  </sect1>