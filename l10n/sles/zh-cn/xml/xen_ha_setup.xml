<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="xen_ha_setup.xml" version="5.0" xml:id="cha-xen-ha">
 <title>使用 Xen 作为高可用性虚拟化主机</title>
 <info>
      <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
        <dm:bugtracker>
        </dm:bugtracker>
	<dm:translation>yes</dm:translation>
      </dm:docmanager>
    </info>
    <para>
  与在专用硬件上运行每台服务器的设置相比，将两台 Xen 主机设置为故障转移系统可以带来多项优势。
 </para>
 <itemizedlist mark="bullet" spacing="normal">
  <listitem>
   <para>
    一台服务器发生故障不会导致出现重大服务中断情况。
   </para>
  </listitem>
  <listitem>
   <para>
    购置一台大型计算机通常比购置多台小型计算机要便宜。
   </para>
  </listitem>
  <listitem>
   <para>
    按需添加新服务器的工作简单无比。
   </para>
  </listitem>
  <listitem>
   <para>
    服务器的利用率可得到改进，而这又会对系统的能耗产生正面影响。
   </para>
  </listitem>
 </itemizedlist>
 <para>
  <xref linkend="sec-xen-manage-migrate"/>中介绍了 Xen 主机的迁移设置。下面描述了几种典型方案。
 </para>
 <sect1 xml:id="sec-xen-ha-remote-storage">
  <title>使用远程储存实现 Xen HA</title>



  <para>
   Xen 可以直接向相应的 Xen Guest 系统提供多个远程块设备。这些设备包括 iSCSI、NPIV 和 NBD。所有这些设备都可用于执行实时迁移。储存系统准备就绪后，请先尝试使用您已在网络中使用的相同设备类型。
  </para>

  <para>
   如果储存系统不可直接使用，但具有通过 NFS 提供所需空间的能力，您也可以在 NFS 上创建映像文件。如果所有 Xen 主机系统上都提供了 NFS，则此方法还可以实现 Xen Guest 的实时迁移。
  </para>

  <para>
   设置新系统时，其中一个主要考虑因素为是否应该实施专用的储存区域网络。可行的方法如下：
  </para>



  <table xml:id="tab-xen-remote-storage">
   <title>Xen 远程储存</title>
   <tgroup cols="3">
    <thead>
     <row>
      <entry>
       <para>
        方法
       </para>
      </entry>
      <entry>
       <para>
        复杂性
       </para>
      </entry>
      <entry>
       <para>
        注释
       </para>
      </entry>
     </row>
    </thead>
    <tbody>
     <row>
      <entry>
       <para>
        以太网
       </para>
      </entry>
      <entry>
       <para>
        低
       </para>
      </entry>
      <entry>
       <para>
        请注意，所有块设备流量都将通过用于传送网络流量的同一以太网接口传送。这可能会使 Guest 的性能受到限制。
       </para>
      </entry>
     </row>
     <row>
      <entry>
       <para>
        专用于储存的以太网。
       </para>
      </entry>
      <entry>
       <para>
        中
       </para>
      </entry>
      <entry>
       <para>
        通过专用以太网接口运行储存流量可以消除服务器端的瓶颈。但是，为自己的网络规划自己的 IP 地址范围时，以及规划专用于储存的 VLAN（可能有此需要）时，您需要考虑很多因素。
       </para>
      </entry>
     </row>
     <row>
      <entry>
       <para>
        NPIV
       </para>
      </entry>
      <entry>
       <para>
        高
       </para>
      </entry>
      <entry>
       <para>
        NPIV 是用于虚拟化光纤通道连接的一种方法。通过使用最低支持 4 Gbit/秒的数据传输速率并允许复杂储存系统设置的适配器来提供此功能。
       </para>
      </entry>
     </row>
    </tbody>
   </tgroup>
  </table>

  <para>
   通常，1 Gbit/秒的以太网设备可以充分利用典型的硬盘或储存系统。在使用极快的储存系统时，此类以太网设备也许会限制系统的速度。
  </para>
 </sect1>
 <sect1 xml:id="sec-xen-ha-local-storage">
  <title>使用本地储存实现 Xen HA</title>

  <para>
   出于空间和预算原因，有时可能需要依赖于 Xen 主机系统本地的储存。如果仍想实现实时迁移，需要构建镜像到两台 Xen 主机的块设备。可用于执行此操作的软件称为分布式复制块设备 (DRBD)。
  </para>

  <para>
   如果需要设置一个使用 DRBD 在两台 Xen 主机之间镜像块设备或文件的系统，这两台主机应使用相同的硬件。如果其中一台主机的硬盘速度较慢，则两台主机的速度会受到同样的限制。
  </para>

  <para>
   在设置期间，所需的每个块设备均应使用自己的 DRBD 设备。设置此类系统是一个相当复杂的任务。
  </para>
 </sect1>
 <sect1 xml:id="sec-xen-ha-private-bridge">
  <title>Xen HA 和专用网桥</title>

  <para>
   使用需要相互通讯的多个 Guest 系统时，可以通过普通的接口来进行通讯。但出于安全原因，建议您创建一个仅连接到 Guest 系统的网桥。
  </para>

  <para>
   在还需要支持实时迁移的 HA 环境中，此类专用网桥必须连接到其他 Xen 主机。使用专用物理以太网设备和专用网络可以做到这一点。
  </para>

  <para>
   另一种实现方法是使用 VLAN 接口。在这种情况下，所有流量都将通过普通以太网接口传送。不过，VLAN 接口不会收到普通流量，因为只有标记为要传送到正确 VLAN 的 VLAN 包会被转发。
  </para>

  <para>
   有关 VLAN 接口设置的详细信息，请参见<xref linkend="sec-xen-net-vlan"/>。
  </para>
 </sect1>
</chapter>
