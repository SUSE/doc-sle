<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE chapter PUBLIC "-//Novell//DTD NovDoc XML V1.0//EN" "novdocx.dtd">
<!--
*********************************
Please see LICENSE.txt for this document's license.
*********************************
-->
<chapter xml:base="systemd.xml" id="cha.systemd">
 <title><systemitem class="daemon">systemd</systemitem> 守护程序</title>
 <para>
  <systemitem class="daemon">systemd</systemitem> 程序是进程 ID 为 1 的进程。它负责以所需的方式初始化系统。<systemitem class="daemon">systemd</systemitem> 由内核直接启动，信号 9（该信号通常会终止进程）对它不起作用。所有其他程序都由 systemd 直接启动，或由它的其中一个子进程启动。
 </para>
 <para>
  从 <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> 12 起，systemd 取代了常用的 System V init 守护程序。<systemitem class="daemon">systemd</systemitem> 与 System V init 完全兼容（通过支持 init 脚本实现）。systemd 的其中一个主要优点是可通过激进方式并行启动多项服务来大幅加快引导速度。另外，systemd 只在确实有需要时才会启动服务。守护程序并不是在系统引导时无条件地启动，而是在第一次需要时启动。systemd 还支持内核控制组 (cgroups)，以拍摄系统状态快照以及恢复系统状态等等。有关详细信息，请参见<ulink url="http://www.freedesktop.org/wiki/Software/systemd/"/>。
 </para>

 <sect1 id="sec.boot.systemd.concept">
  <title>systemd 概念</title>

  <para>
   本节将详细介绍有关 systemd 的概念。
  </para>

  <sect2 id="sec.boot.systemd.whatissystemd">
   <title>systemd 是什么</title>
   <para>
    systemd 是适用于 Linux 的系统和会话管理器，它与 System V 及 LSB init 脚本兼容。主要功能包括：
   </para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>
      提供激进式并行化功能
     </para>
    </listitem>
    <listitem>
     <para>
      使用套接字及 D-Bus 激活来启动服务
     </para>
    </listitem>
    <listitem>
     <para>
      提供按需启动守护程序功能
     </para>
    </listitem>
    <listitem>
     <para>
      使用 Linux cgroups 跟踪进程
     </para>
    </listitem>
    <listitem>
     <para>
      支持拍摄系统状态快照及恢复系统状态
     </para>
    </listitem>
    <listitem>
     <para>
      维护安装点和自动安装点
     </para>
    </listitem>
    <listitem>
     <para>
      实施精细的、基于事务依赖性的服务控制逻辑
     </para>
    </listitem>
   </itemizedlist>
  </sect2>

  <sect2 id="sec.boot.systemd.unitfile">
   <title>单元文件</title>
   <para>
    单元配置文件会对有关以下项目的信息进行编码：服务、套接字、设备、安装点、自动安装点、交换文件或分区、启动目标、监控的文件系统路径、受 systemd 控制和监管的计时器、临时系统状态快照、资源管理部分或一组外部创建的进程。<quote>单元文件</quote>是 systemd 用于描述下列各项的通用术语：
   </para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <formalpara>
      <title>服务</title>
      <para>
       进程相关信息（例如运行守护程序）；文件以 .service 结尾
      </para>
     </formalpara>
    </listitem>
    <listitem>
     <formalpara>
      <title>目标</title>
      <para>
       用于将单元分组以及在启动期间用作同步点；文件以 .target 结尾
      </para>
     </formalpara>
    </listitem>
    <listitem>
     <formalpara>
      <title>套接字</title>
      <para>
       IPC 或网络套接字或文件系统 FIFO 相关信息，适用于基于套接字的激活（如 <systemitem class="daemon">inetd</systemitem>）；文件以 .socket 结尾
      </para>
     </formalpara>
    </listitem>
    <listitem>
     <formalpara>
      <title>路径</title>
      <para>
       用于触发其他单元（例如，在文件更改时运行服务）；文件以 .path 结尾
      </para>
     </formalpara>
    </listitem>
    <listitem>
     <formalpara>
      <title>计时器</title>
      <para>
       受控制计时器相关信息，适用于基于计时器的激活；文件以 .timer 结尾
      </para>
     </formalpara>
    </listitem>
    <listitem>
     <formalpara>
      <title>装入点</title>
      <para>
       通常由 fstab 生成器自动生成；文件以 .mount 结尾
      </para>
     </formalpara>
    </listitem>
    <listitem>
     <formalpara>
      <title>自动安装点</title>
      <para>
       文件系统自动安装点相关信息；文件以 .automount 结尾
      </para>
     </formalpara>
    </listitem>
    <listitem>
     <formalpara>
      <title>交换</title>
      <para>
       内存分页的交换设备或文件相关信息；文件以 .swap 结尾
      </para>
     </formalpara>
    </listitem>
    <listitem>
     <formalpara>
      <title>设备</title>
      <para>
       sysfs/udev(7) 设备树中公开的设备相关信息；文件以 .device 结尾
      </para>
     </formalpara>
    </listitem>
    <listitem>
     <formalpara>
      <title>范围/部分</title>
      <para>
       有关分层管理一组进程的资源的概念；文件以 .scope/.slice 结尾
      </para>
     </formalpara>
    </listitem>
   </itemizedlist>
   <para>
    有关 systemd.unit 的更多信息，请参见<ulink url="http://www.freedesktop.org/software/systemd/man/systemd.unit.html"/>
   </para>
  </sect2>
 </sect1>
 <sect1 id="sec.boot.systemd.basics">
  <title>基本用途</title>

  <para>
   System V init 系统使用几个不同的命令来处理服务：init 脚本、<command>insserv</command>、<command>telinit</command> 及其他。systemd 使服务管理变得简单，要运行大部分服务处理任务，只需要记住一条命令：<command>systemctl</command>。它使用<quote>命令加子命令</quote>表示法，与 <command>git</command> 或 <command>zypper</command> 相似：
  </para>

<screen>systemctl <replaceable>[general OPTIONS]</replaceable> <replaceable>subcommand</replaceable> <replaceable>[subcommand OPTIONS]</replaceable></screen>

  <para>
   有关完整的手册，请参见 <command>man 1 systemctl</command>。
  </para>

  <tip>
   <title>终端输出和 Bash 补全</title>
   <para>
    如果输出传递到某个终端（而不是某个管道或文件），systemd 命令默认会将长输出发送到分页器。使用 <option>--no-pager</option> 选项可关闭分页模式。
   </para>
   <para>
    systemd 还支持 bash 补全，允许您输入子命令的第一个字母，然后按 <keycap function="tab"/> 自动补全子命令。此功能只能在 <systemitem>bash</systemitem> 外壳中使用，并且需要安装 <systemitem class="resource">bash-completion</systemitem> 包。
   </para>
  </tip>

  <sect2 id="sec.boot.systemd.basics.services">
   <title>管理正在运行的系统中的服务</title>
   <para>
    用于管理服务的子命令与使用 System V init 管理服务的子命令相同（<command>start</command>、<command>stop</command> 等）。服务管理命令的一般语法如下所示：
   </para>
   <variablelist>
    <varlistentry>
     <term>systemd</term>
     <listitem>
<screen>systemctl reload|restart|start|status|stop|<replaceable>...</replaceable> <replaceable>&lt;my_service(s)&gt;</replaceable>.service</screen>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>System V init</term>
     <listitem>
<screen>rc<replaceable>&lt;my_service(s)&gt;</replaceable> reload|restart|start|status|stop|<replaceable>...</replaceable></screen>
     </listitem>
    </varlistentry>
   </variablelist>
   <para>
    systemd 允许您一次管理多个服务。不用像 System V init 要逐个执行 init 脚本，而是执行如下命令：
   </para>
<screen>systemctl start <replaceable>&lt;my_1st_service&gt;</replaceable>.service <replaceable>&lt;my_2nd_service&gt;</replaceable>.service</screen>
   <para>
    如果您要列出系统上所有可用的服务：
   </para>
<screen>systemctl list-unit-files --type=service</screen>
   <para>
    下表列出了 systemd 和 System V init 最重要的服务管理命令：
   </para>
   <table rowsep="1">
    <title>服务管理命令</title>
    <tgroup cols="3">
     <colspec colnum="1" colname="1" colwidth="50*"/>
     <colspec colnum="2" colname="2" colwidth="30*"/>
     <colspec colnum="3" colname="3" colwidth="20*"/>
     <thead>
      <row>
       <entry colname="1">
        <para>
         任务
        </para>
       </entry>
       <entry colname="2">
        <para>
         systemd 命令
        </para>
       </entry>
       <entry colname="3">
        <para>
         System V init 命令
        </para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row>
       <entry colname="1">
        <formalpara>
         <title>启动</title>
         <para/>
        </formalpara>
       </entry>
       <entry colname="2">
<screen>start</screen>
       </entry>
       <entry colname="3">
<screen>start</screen>
       </entry>
      </row>
      <row>
       <entry colname="1">
        <formalpara>
         <title>停止</title>
         <para/>
        </formalpara>
       </entry>
       <entry colname="2">
<screen>stop</screen>
       </entry>
       <entry colname="3">
<screen>stop</screen>
       </entry>
      </row>
      <row>
       <entry colname="1">
        <formalpara>
         <title>重启动</title>
         <para>
          关闭服务，然后再启动这些服务。如果某项服务尚未运行，它将会启动。
         </para>
        </formalpara>
       </entry>
       <entry colname="2">
<screen>restart</screen>
       </entry>
       <entry colname="3">
<screen>restart</screen>
       </entry>
      </row>
      <row>
       <entry colname="1">
        <formalpara>
         <title>有条件地重启动</title>
         <para>
          如果服务当前正在运行，则重启动它们。对未在运行的服务不执行任何操作。
         </para>
        </formalpara>
       </entry>
       <entry colname="2">
<screen>try-restart</screen>
       </entry>
       <entry colname="3">
<screen>try-restart</screen>
       </entry>
      </row>
      <row>
       <entry colname="1">
        <formalpara>
         <title>重新装载</title>
         <para>
          让服务在不中断操作的情况下重新装载它们的配置文件。使用案例：让 Apache 重新装载修改过的 <filename>httpd.conf</filename> 配置文件。请注意，并非所有服务都支持重新装载。
         </para>
        </formalpara>
       </entry>
       <entry colname="2">
<screen>reload</screen>
       </entry>
       <entry colname="3">
<screen>reload</screen>
       </entry>
      </row>
      <row>
       <entry colname="1">
        <formalpara>
         <title>重新装载或重启动</title>
         <para>
          如果支持重新装载则重新装载服务，否则重启动服务。如果某项服务尚未运行，它将会启动。
         </para>
        </formalpara>
       </entry>
       <entry colname="2">
<screen>reload-or-restart</screen>
       </entry>
       <entry colname="3">
<screen>n/a</screen>
       </entry>
      </row>
      <row>
       <entry colname="1">
        <formalpara>
         <title>有条件地重新装载或重启动</title>
         <para>
          如果支持重新装载则重新装载服务，否则，如果服务当前正在运行，则重启动服务。对未在运行的服务不执行任何操作。
         </para>
        </formalpara>
       </entry>
       <entry colname="2">
<screen>reload-or-try-restart</screen>
       </entry>
       <entry colname="3">
<screen>n/a</screen>
       </entry>
      </row>
      <row>
       <entry colname="1">
        <formalpara>
         <title>获得详细的状态信息</title>
         <para>
          列出服务状态的相关信息。<systemitem class="daemon">systemd</systemitem> 命令会显示说明、可执行文件、状态、cgroup 及服务发出的最新讯息等细节（请参见<xref linkend="sec.boot.systemd.basics.services_debugging"/>）。使用 System V init 显示的详细程度因服务而异。
         </para>
        </formalpara>
       </entry>
       <entry colname="2">
<screen>status</screen>
       </entry>
       <entry colname="3">
<screen>status</screen>
       </entry>
      </row>
      <row>
       <entry colname="1">
        <formalpara>
         <title>获得简要的状态信息</title>
         <para>
          显示服务是否处于活动状态。
         </para>
        </formalpara>
       </entry>
       <entry colname="2">
<screen>is-active</screen>
       </entry>
       <entry colname="3">
<screen>status</screen>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </table>
  </sect2>

  <sect2 id="sec.boot.systemd.basics.services_enabling">
   <title>永久启用/禁用服务</title>
   <para>
    上一节中提到的服务管理命令可让您操控当前会话的服务。systemd 还允许您永久启用或禁用服务，让它们在用户要求时自动启动或永远不可用。您可以使用 YaST 或在命令行上运行命令来实现此目的。
   </para>
   <sect3 id="sec.boot.systemd.basics.services_enabling.cmd">
    <title>在命令行上启用/禁用服务</title>
    <para>
     下表列出了 systemd 和 System V init 用于启用和禁用服务的命令：
    </para>
    <important>
     <title>启动服务</title>
     <para>
      在命令行上启用服务时，服务不会自动启动。它会安排在下一次系统启动或运行级别/目标发生更改时启动。要在启用服务之后立即启动它，请明确运行 <command>systemctl start <replaceable>&lt;我的服务&gt;</replaceable>.service</command> 或 <command>rc<replaceable>&lt;我的服务&gt;</replaceable> start</command>。
     </para>
    </important>
    <table rowsep="1">
     <title>用于启用和禁用服务的命令</title>
     <tgroup cols="3">
      <colspec colnum="1" colname="1" colwidth="32*"/>
      <colspec colnum="2" colname="2" colwidth="40*"/>
      <colspec colnum="3" colname="3" colwidth="28*"/>
      <thead>
       <row>
        <entry colname="1">
         <para>
          任务
         </para>
        </entry>
        <entry colname="2">
         <para>
          <systemitem class="daemon">systemd 命令</systemitem>
         </para>
        </entry>
        <entry colname="3">
         <para>
          System V init 命令
         </para>
        </entry>
       </row>
      </thead>
      <tbody>
       <row>
        <entry colname="1">
         <formalpara>
          <title>启用</title>
          <para/>
         </formalpara>
        </entry>
        <entry colname="2">
         <para>
          <command>systemctl enable <replaceable>&lt;我的服务&gt;</replaceable>.service</command>
         </para>
        </entry>
        <entry colname="3">
         <para>
          <command>insserv <replaceable>&lt;我的服务&gt;</replaceable></command>
         </para>
        </entry>
       </row>
       <row>
        <entry colname="1">
         <formalpara>
          <title>禁用</title>
          <para/>
         </formalpara>
        </entry>
        <entry colname="2">
         <para>
          <command>systemctl disable <replaceable>&lt;我的服务&gt;</replaceable>.service</command>
         </para>
        </entry>
        <entry colname="3">
         <para>
          <command>insserv <option>-r</option> <replaceable>&lt;我的服务&gt;</replaceable></command>
         </para>
        </entry>
       </row>
       <row>
        <entry colname="1">
         <formalpara>
          <title>检查</title>
          <para>
           显示某项服务是否启用。
          </para>
         </formalpara>
        </entry>
        <entry colname="2">
         <para>
          <command>systemctl is-enabled <replaceable>&lt;我的服务&gt;</replaceable>.service</command>
         </para>
        </entry>
        <entry colname="3">
         <para>
          无
         </para>
        </entry>
       </row>
       <row>
        <entry colname="1">
         <formalpara>
          <title>重新启用</title>
          <para>
           与重启动服务相似，此命令先禁用服务，然后再启用该服务。可用来使用默认值重新启用服务。
          </para>
         </formalpara>
        </entry>
        <entry colname="2">
         <para>
          <command>systemctl reenable <replaceable>&lt;我的服务&gt;</replaceable>.service</command>
         </para>
        </entry>
        <entry colname="3">
         <para>
          无
         </para>
        </entry>
       </row>
       <row>
        <entry colname="1">
         <formalpara>
          <title>屏蔽</title>
          <para>
           <quote>禁用</quote>某项服务之后，仍然可以手动启动它。要彻底禁用服务，您需要屏蔽它。须谨慎使用该功能。
          </para>
         </formalpara>
        </entry>
        <entry colname="2">
         <para>
          <command>systemctl mask <replaceable>&lt;我的服务&gt;</replaceable>.service</command>
         </para>
        </entry>
        <entry colname="3">
         <para>
          无
         </para>
        </entry>
       </row>
       <row>
        <entry colname="1">
         <formalpara>
          <title>取消屏蔽</title>
          <para>
           屏蔽某项服务之后，只有在将其取消屏蔽之后才能再次使用它。
          </para>
         </formalpara>
        </entry>
        <entry colname="2">
         <para>
          <command>systemctl unmask <replaceable>&lt;我的服务&gt;</replaceable>.service</command>
         </para>
        </entry>
        <entry colname="3">
         <para>
          无
         </para>
        </entry>
       </row>
      </tbody>
     </tgroup>
    </table>
   </sect3>
  </sect2>
 </sect1>
 <sect1 id="sec.boot.systemd.boot">
  <title>系统启动和目标管理</title>

  <para>
   启动和关闭系统的整个过程由 systemd 负责维护。从这一点来看，可以将内核视为一个后台进程，其任务是维护所有其他进程，以及根据其他程序的请求来调整 CPU 时间和硬件访问。
  </para>

  <sect2 id="sec.boot.systemd.targets">
   <title>目标与运行级别</title>
   <para>
    使用 System V init 时，系统引导到所谓的<quote>运行级别</quote>。运行级别定义系统如何启动以及正在运行的系统中有哪些服务可用。运行级别是有编号的；最知名的运行级别是 <literal>0</literal>（关闭系统）、<literal>3</literal>（联网的多用户模式）和 <literal>5</literal>（联网并使用显示管理器的多用户模式）。
   </para>
   <para>
    systemd 使用所谓的<quote>目标单元</quote>引入新的概念。不过，它仍然与运行级别概念完全兼容。目标单元用名称而不是编号来标识，并具有特定的作用。例如，目标 <systemitem>local-fs.target</systemitem> 和 <systemitem>swap.target</systemitem> 用于装入本地文件系统和交换空间。
   </para>
   <para>
    目标 <systemitem>graphical.target</systemitem> 提供联网并使用显示管理器的多用户系统，作用与运行级别 5 相当。复杂目标（如 <systemitem>graphical.target</systemitem>）通过将一部分其他目标组合起来充当<quote>元</quote>目标。systemd 通过组合现有目标简化了创建自定义目标的工作，从而提供了极大的灵活性。
   </para>
   <para>
    下面的列表显示了最重要的 systemd 目标单元。有关完整列表，请参见 <command>man 7 systemd.special</command>。
   </para>
   <variablelist>
    <title>选定的 systemd 目标单元</title>
    <varlistentry>
     <term><systemitem>default.target</systemitem>
     </term>
     <listitem>
      <para>
       默认引导的目标。这并不是<quote>实际</quote>目标，而是指向另一个目标（如 <systemitem>graphic.target</systemitem>）的符号链接，可通过 YaST 永久更改（请参见<xref linkend="sec.boot.runlevel.edit"/>）。要为某个会话更改它，请在引导提示处使用内核命令行选项 <literal>systemd.unit=<replaceable>&lt;我的目标&gt;.target</replaceable></literal>。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><systemitem>emergency.target</systemitem>
     </term>
     <listitem>
      <para>
       在控制台上启动紧急外壳。请仅在引导提示处按以下格式使用它：<literal>systemd.unit=emergency.target</literal>。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><systemitem>graphical.target</systemitem>
     </term>
     <listitem>
      <para>
       启动联网的具有多用户支持和显示管理器的系统。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><systemitem>halt.target</systemitem>
     </term>
     <listitem>
      <para>
       关闭系统。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><systemitem>mail-transfer-agent.target</systemitem>
     </term>
     <listitem>
      <para>
       启动发送和接收邮件所需的所有服务。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><systemitem>multi-user.target</systemitem>
     </term>
     <listitem>
      <para>
       启动联网的多用户系统。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><systemitem>reboot.target</systemitem>
     </term>
     <listitem>
      <para>
       重新引导系统。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><systemitem>rescue.target</systemitem>
     </term>
     <listitem>
      <para>
       启动不联网的单用户系统。
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
   <para>
    为了与 System V init 运行级别系统保持兼容，systemd 提供了名为 <literal>runlevel<replaceable>X</replaceable>.target</literal> 的特殊目标，与编号为 <replaceable>X</replaceable> 的相应运行级别相对应。
   </para>
   <para>
    如果您想知道当前的目标，请使用命令：<command>systemctl get-default</command>
   </para>
   <table rowsep="1">
    <title>System V 运行级别和 <systemitem class="daemon">systemd</systemitem> 目标单元</title>
    <tgroup cols="3">
     <colspec colnum="1" colname="1" colwidth="20*"/>
     <colspec colnum="2" colname="2" colwidth="40*"/>
     <colspec colnum="3" colname="3" colwidth="40*"/>
     <thead>
      <row>
       <entry>
        <para>
         System V 运行级别
        </para>
       </entry>
       <entry>
        <para>
         <systemitem class="daemon">systemd</systemitem> 目标
        </para>
       </entry>
       <entry>
        <para>
         目的
        </para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row>
       <entry>
        <para>
         0
        </para>
       </entry>
       <entry>
        <para>
         <systemitem>runlevel0.target</systemitem>、 <systemitem>halt.target</systemitem>、 <systemitem>poweroff.target</systemitem>
        </para>
       </entry>
       <entry>
        <para>
         系统关闭
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         1、S
        </para>
       </entry>
       <entry>
        <para>
         <systemitem>runlevel1.target</systemitem>、 <systemitem>rescue.target</systemitem>
        </para>
       </entry>
       <entry>
        <para>
         单用户模式
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         2
        </para>
       </entry>
       <entry>
        <para>
         <systemitem>runlevel2.target</systemitem>、<systemitem>multi-user.target</systemitem>
        </para>
       </entry>
       <entry>
        <para>
         无远程联网的本地多用户模式
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         3
        </para>
       </entry>
       <entry>
        <para>
         <systemitem>runlevel3.target</systemitem>、<systemitem>multi-user.target</systemitem>
        </para>
       </entry>
       <entry>
        <para>
         完整的联网多用户模式
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         4
        </para>
       </entry>
       <entry>
        <para>
         <systemitem>runlevel4.target</systemitem>
        </para>
       </entry>
       <entry>
        <para>
         未使用/用户定义
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         5
        </para>
       </entry>
       <entry>
        <para>
         <systemitem>runlevel5.target</systemitem>、 <systemitem>graphical.target</systemitem>
        </para>
       </entry>
       <entry>
        <para>
         联网并使用显示管理器的完整多用户模式
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         6
        </para>
       </entry>
       <entry>
        <para>
         <systemitem>runlevel6.target</systemitem>、 <systemitem>reboot.target</systemitem>
        </para>
       </entry>
       <entry>
        <para>
         系统重引导
        </para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </table>
   <important>
    <title>systemd 会忽略 <filename>/etc/inittab</filename></title>
    <para>
     System V init 系统中的运行级别在 <filename>/etc/inittab</filename> 中配置。systemd <emphasis>不</emphasis>使用此配置。有关如何创建您自己的可引导目标的指导，请参考<xref linkend="sec.boot.systemd.custom.targets"/>。
    </para>
   </important>
   <sect3 id="sec.boot.systemd.targets.commands">
    <title>用于更改目标的命令</title>
    <para>
     可使用下列命令来操作目标单元：
    </para>
    <informaltable rowsep="1">
     <tgroup cols="3">
      <colspec colnum="1" colname="1" colwidth="20*"/>
      <colspec colnum="2" colname="2" colwidth="50*"/>
      <colspec colnum="3" colname="3" colwidth="30*"/>
      <thead>
       <row>
        <entry colname="1">
         <para>
          任务
         </para>
        </entry>
        <entry colname="2">
         <para>
          systemd 命令
         </para>
        </entry>
        <entry colname="3">
         <para>
          System V init 命令
         </para>
        </entry>
       </row>
      </thead>
      <tbody>
       <row>
        <entry colname="1">
         <para>
          更改当前目标/运行级别
         </para>
        </entry>
        <entry colname="2">
         <para>
          <command>systemctl isolate <replaceable>&lt;我的目标&gt;</replaceable>.target</command>
         </para>
        </entry>
        <entry colname="3">
         <para>
          <command>telinit <replaceable>X</replaceable></command>
         </para>
        </entry>
       </row>
       <row>
        <entry colname="1">
         <para>
          更改为默认目标/运行级别
         </para>
        </entry>
        <entry colname="2">
         <para>
          <command>systemctl default</command>
         </para>
        </entry>
        <entry colname="3">
         <para>
          无
         </para>
        </entry>
       </row>
       <row>
        <entry colname="1">
         <para>
          获得当前目标/运行级别
         </para>
        </entry>
        <entry colname="2">
         <para>
          <command>systemctl list-units --type=target</command>
         </para>
         <para>
          使用 systemd 时，一般会有多个活动目标。该命令可列出当前处于活动状态的所有目标。
         </para>
        </entry>
        <entry colname="3">
         <para>
          <command>who -r</command>
         </para>
         <para>
          或者
         </para>
         <para>
          <command>运行级别</command>
         </para>
        </entry>
       </row>
       <row>
        <entry colname="1">
         <para>
          永久更改默认运行级别
         </para>
        </entry>
        <entry colname="2">
         <para>
          使用服务管理器或运行以下命令：
         </para>
         <para>
          <command>ln -sf /usr/lib/systemd/system/<replaceable>&lt;我的目标&gt;</replaceable>.target /etc/systemd/system/default.target</command>
         </para>
        </entry>
        <entry colname="3">
         <para>
          使用服务管理器或更改以下行
         </para>
         <para>
          <command>id:<replaceable>X</replaceable>:initdefault:</command>
         </para>
         <para>
          （<filename>/etc/inittab</filename> 中）
         </para>
        </entry>
       </row>
       <row>
        <entry colname="1">
         <para>
          更改当前引导进程的默认运行级别
         </para>
        </entry>
        <entry colname="2">
         <para>
          在引导提示处输入以下选项
         </para>
         <para>
          <command>systemd.unit=<replaceable>&lt;我的目标&gt;</replaceable>.target</command>
         </para>
        </entry>
        <entry colname="3">
         <para>
          在引导提示处输入所需的运行级别编号。
         </para>
        </entry>
       </row>
       <row>
        <entry colname="1">
         <para>
          显示目标/运行级别的依赖性
         </para>
        </entry>
        <entry colname="2">
         <para>
          <command>systemctl show -p "Requires" <replaceable>&lt;我的目标></replaceable>.target</command>
         </para>
         <para>
          <command>systemctl show -p "Wants" <replaceable>&lt;我的目标&gt;</replaceable>.target</command>
         </para>
         <para>
          <quote>Requires</quote> 会列出硬性依赖性（必须解决的依赖性），而 <quote>Wants</quote> 会列出软性依赖性（情况允许时解决的依赖性）。
         </para>
        </entry>
        <entry colname="3">
         <para>
          无
         </para>
        </entry>
       </row>
      </tbody>
     </tgroup>
    </informaltable>
   </sect3>
  </sect2>

  <sect2 id="sec.boot.systemd.debug">
   <title>调试系统的启动</title>
   <para>
    systemd 提供了分析系统启动过程的方法。您可以方便地查看所有服务及其状态的列表（而不必分析 <filename>/varlog/</filename>）。systemd 还允许您扫描启动过程，以了解每项服务启动用了多长时间。
   </para>
   <sect3 id="sec.boot.systemd.debug.review">
    <title>查看服务的启动情况</title>
    <para>
     要查看系统引导后所启动服务的完整列表，请输入命令 <command>systemctl</command>。该命令会列出所有活动服务，如下所示（已精简）。要获得特定服务的更多信息，请使用 <command>systemctl status <replaceable>&lt;我的服务&gt;</replaceable>.service</command>。
    </para>
    <example>
     <title>列出活动服务</title>
<screen><prompt role="user">root # </prompt>systemctl
UNIT                                LOAD   ACTIVE SUB       JOB DESCRIPTION
[...]
systemd-random-seed-load.path       loaded active waiting       Random Seed
acpid.service                       loaded active running       ACPI Event Daemon
apache2.service                     loaded failed failed        apache
avahi-daemon.service                loaded active running       Avahi mDNS/DNS-SD Stack
bluez-coldplug.service              loaded active exited        LSB: handles udev coldplug of bluetooth dongles
console-kit...-system-start.service loaded active exited        Console System Startup Logging
cron.service                        loaded active running       Command Scheduler
cups.service                        loaded active running       CUPS Printing Service
[...]
LOAD   = Reflects whether the unit definition was properly loaded.
ACTIVE = The high-level unit activation state, i.e. generalization of SUB.
SUB    = The low-level unit activation state, values depend on unit type.
JOB    = Pending job for the unit.

107 units listed. Pass --all to see inactive units, too.</screen>
    </example>
    <para>
     要想只列出无法启动的服务，请使用 <option>--failed</option> 选项。
    </para>
    <example>
     <title>列出失败的服务</title>
<screen><prompt role="user">root # </prompt>systemctl --failed
UNIT                   LOAD   ACTIVE SUB    JOB DESCRIPTION
apache2.service        loaded failed failed     apache
NetworkManager.service loaded failed failed     Network Manager
plymouth-start.service loaded failed failed     Show Plymouth Boot Screen

[...]</screen>
    </example>
   </sect3>
   <sect3 id="sec.boot.systemd.debug.time">
    <title>调试启动时间</title>
    <para>
     为了调试系统启动时间，systemd 提供了 <command>systemd-analyze</command> 命令。该命令会显示总启动时间及按启动时间排序的服务列表，还可以生成 SVG 图，以显示各服务相对于其他服务的启动时间。
    </para>
    <variablelist>
     <varlistentry>
      <term>列出系统启动时间</term>
      <listitem>
<screen><prompt role="user">root # </prompt>systemd-analyze
Startup finished in 2666ms (kernel) + 21961ms (userspace) = 24628ms</screen>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>列出服务启动时间</term>
      <listitem>
<screen><prompt role="user">root # </prompt>systemd-analyze blame
  6472ms systemd-modules-load.service
  5833ms remount-rootfs.service
  4597ms network.service
  4254ms systemd-vconsole-setup.service
  4096ms postfix.service
  2998ms xdm.service
  2483ms localnet.service
  2470ms SuSEfirewall2_init.service
  2189ms avahi-daemon.service
  2120ms systemd-logind.service
  1210ms xinetd.service
  1080ms ntp.service
[...]
    75ms fbset.service
    72ms purge-kernels.service
    47ms dev-vda1.swap
    38ms bluez-coldplug.service
    35ms splash_early.service</screen>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>服务启动时间图</term>
      <listitem>
<screen><prompt role="user">root # </prompt>systemd-analyze plot &gt; jupiter.example.com-startup.svg</screen>
       <informalfigure>
        <mediaobject>
         <imageobject role="fo">
          <imagedata fileref="systemd_startup.svg" width="75%" format="SVG"/>
         </imageobject>
         <imageobject role="html">
          <imagedata fileref="systemd_startup.png" width="75%" format="PNG"/>
         </imageobject>
        </mediaobject>
       </informalfigure>
      </listitem>
     </varlistentry>
    </variablelist>
   </sect3>
   <sect3 id="sec.boot.systemd.debug.complete">
    <title>查看完整的启动过程</title>
    <para>
     上面提到的命令可让您查看已启动的服务以及启动各服务所需的时间。如果您需要知道更多细节，可以在引导提示处输入下列参数，让 <systemitem class="daemon">systemd</systemitem> 详细记录整个启动过程：
    </para>
<screen>systemd.log_level=debug systemd.log_target=kmsg</screen>
    <para>
     现在，<systemitem class="daemon">systemd</systemitem> 会将日志讯息写入内核环缓冲区。使用 <command>dmesg</command> 查看该缓冲区：
    </para>
<screen>dmesg -T | less</screen>
   </sect3>
  </sect2>

  <sect2 id="sec.boot.systemd.sysv_compatibility">
   <title>System V 兼容性</title>
   <para>
    Systemd 与 System V 兼容，因此，您仍可以使用现有的 System V init 脚本。但是，至少有一个已知问题会导致 System V init 脚本不能按原样与 Systemd 配合使用：通过 init 脚本中的 <command>su</command> 或 <command>sudo</command> 以其他用户身份启动服务会导致脚本失败，从而生成<quote>访问被拒绝</quote>错误。
   </para>
   <para>
    使用 <command>su</command> 或 <command>sudo</command> 更改用户时，会启动 PAM 会话。完成 init 脚本后会终止此会话。因此，init 脚本启动的服务也会终止。要解决此问题，请执行以下步骤：
   </para>
   <procedure>
    <step performance="required">
     <para>
      创建与 init 脚本同名、扩展名为 <filename>.service</filename> 的服务文件封装程序：
     </para>
<screen>[Unit]
Description=<replaceable>DESCRIPTION</replaceable>
After=network.target

[Service]
User=<replaceable>USER</replaceable>
Type=forking<co id="co.service_wrapper.type"/>
PIDFile=<replaceable>PATH TO PID FILE</replaceable><xref linkend="co.service_wrapper.type" xrefstyle="select:label nopage"/>
ExecStart=<replaceable>PATH TO INIT SCRIPT</replaceable> start
ExecStop=<replaceable>PATH TO INIT SCRIPT</replaceable> stop
ExecStopPost=/usr/bin/rm -f <replaceable>PATH TO PID FILE</replaceable><xref linkend="co.service_wrapper.type" xrefstyle="select:label nopage"/>

[Install]
WantedBy=multi-user.target<co id="co.service_wrapper.target"/></screen>
     <para>
      将 <replaceable>UPPERCASE LETTERS</replaceable> 中写入的所有值替换为适当的值。
     </para>
     <calloutlist>
      <callout arearefs="co.service_wrapper.type">
       <para>
        可选 — 仅当 init 脚本启动守护程序时才使用。
       </para>
      </callout>
      <callout arearefs="co.service_wrapper.target">
       <para>
        <literal>multi-user.target</literal> 在引导进入 <literal>graphical.target</literal> 时也会启动 init 脚本。如果只应在引导进入显示管理器时才将它启动，请在此处使用 <literal>graphical.target</literal>。
       </para>
      </callout>
     </calloutlist>
    </step>
    <step performance="required">
     <para>
      使用 <command>systemctl start <replaceable>应用程序</replaceable>.service</command> 启动守护程序。
     </para>
    </step>
   </procedure>
  </sect2>
 </sect1>
 <sect1 id="sec.boot.runlevel.edit">
  <title>使用 YaST 管理 服务</title>

  <para>
   基本服务管理也可以通过 YaST 服务管理器模块实现。该模块支持启动、停止、启用和禁用服务。它还可让您显示服务的状态以及更改默认目标。要启动 YaST 模块，请选择 <menuchoice><guimenu>YaST</guimenu> <guimenu>系统</guimenu> <guimenu>服务管理器</guimenu></menuchoice>。
  </para>

  <figure id="fig.yast2.runlevel">
   <title>服务管理器</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="yast2_runlevel.png" width="75%" format="PNG"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="yast2_runlevel.png" width="75%" format="PNG"/>
    </imageobject>
   </mediaobject>
  </figure>

  <variablelist>
   <varlistentry>
    <term>更改<guimenu>默认系统目标</guimenu>
    </term>
    <listitem>
     <para>
      要更改系统引导到的目标，请从<guimenu>默认系统目标</guimenu>下拉框中选择某个目标。最常用的目标是<guimenu>图形界面</guimenu>（启动图形登录屏幕）和<guimenu>多用户</guimenu>（以命令行模式启动系统）。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>启动或停止服务</term>
    <listitem>
     <para>
      从表中选择一个服务。<guimenu>活动</guimenu>列显示它当前是（<guimenu>活动</guimenu>）否（<guimenu>非活动</guimenu>）正在运行。通过选择<guimenu>启动/停止</guimenu>可切换其状态。
     </para>
     <para>
      为当前正在运行的会话启动或停止服务会更改其状态。要更改服务在整个重引导过程中的状态，您需要启用或禁用服务。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>启用或禁用服务</term>
    <listitem>
     <para>
      从表中选择一个服务。<guimenu>已启用</guimenu>列显示它当前<guimenu>已启用</guimenu>还是<guimenu>已禁用</guimenu>。通过选择<guimenu>启用/禁用</guimenu>可更改其状态。
     </para>
     <para>
      通过启用或禁用服务，可配置服务在引导期间是否启动（<guimenu>已启用</guimenu>或<guimenu>已禁用</guimenu>）。此设置不会影响当前的会话。要更改服务在当前会话中的状态，您需要将其启动或停止。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>查看状态讯息</term>
    <listitem>
     <para>
      要查看某个服务的状态讯息，请从列表中选择该服务，然后选择<guimenu>显示细节</guimenu>。您看到的输出与 <command>systemctl <option>-l</option> status <replaceable>&lt;我的服务&gt;</replaceable></command> 命令生成的输出完全相同。
     </para>
    </listitem>
   </varlistentry>
  </variablelist>

  <warning>
   <title>有问题的运行级别设置可能会对您的系统造成损害</title>
   <para>
    有问题的运行级别设置可能会导致系统无法使用。在应用您的更改之前，请确保您清楚这些设置可能产生的结果。
   </para>
  </warning>
 </sect1>
 <sect1 id="sec.boot.systemd.custom">
  <title><systemitem>systemd</systemitem> 自定义</title>

  <para>
   以下几节介绍了 <systemitem>systemd</systemitem> 自定义的一些示例。
  </para>

  <warning>
   <title>避免将被覆盖的自定义</title>
   <para>
    一律在 <filename>/etc/systemd/</filename> 中进行 systemd 自定义设置，<emphasis>切勿</emphasis>在 <filename>/usr/lib/systemd/</filename> 中进行。否则，您的更改将在 systemd 下次更新时被覆盖。
   </para>
  </warning>

  <sect2 id="sec.boot.systemd.custom.service">
   <title>自定义服务文件</title>
   <para>
    systemd 服务文件位于 <filename>/usr/lib/systemd/system</filename> 中。如果您要自定义服务文件，请执行下列步骤：
   </para>
   <procedure>
    <step performance="required">
     <para>
      将要修改的文件从 <filename>/usr/lib/systemd/system</filename> 复制到 <filename>/etc/systemd/system</filename>。将文件名保持不变。
     </para>
    </step>
    <step performance="required">
     <para>
      根据需要修改 <filename>/etc/systemd/system</filename> 中的副本。
     </para>
    </step>
    <step performance="required">
     <para>
      如需配置更改的概述，请使用 <command>systemd-delta</command> 命令。它会比较并识别覆盖了其他配置文件的配置文件。有关细节，请参考 <command>systemd-delta</command> 手册页。
     </para>
    </step>
   </procedure>
   <para>
    <filename>/etc/systemd</filename> 中修改过的文件优先于 <filename>/usr/lib/systemd/system</filename> 中的原始文件，前提是它们的文件名相同。
   </para>
  </sect2>

  <sect2 id="sec.boot.systemd.custom.drop-in">
   <title>创建<quote>插入式</quote>文件</title>
   <para>
    如果您只想在配置文件中添加几行或修改文件的一小部分，可以使用所谓的<quote>插入式</quote>文件。使用插入式文件，您无需编辑或覆盖单元文件本身，即可扩展单元文件的配置。
   </para>
   <para>
    例如，要更改位于 <filename>/usr/lib/systemd/system/ <replaceable>foobar.service</replaceable></filename> 中 <replaceable>foobar</replaceable> 服务的一个值，请执行下列步骤：
   </para>
   <procedure>
    <step performance="required">
     <para>
      创建名为 <filename>/etc/systemd/system/<replaceable>&lt;我的服务&gt;</replaceable>.service.d/</filename> 的目录。
     </para>
     <para>
      注意 <literal>.d</literal> 后缀。该目录必须命名为与要用插入式文件修补的服务相似的名称。
     </para>
    </step>
    <step performance="required">
     <para>
      在该目录中，创建 <filename><replaceable>whatevermodification</replaceable>.conf</filename> 文件。
     </para>
     <para>
      确保文件中仅包含要修改的值所在的那一行。
     </para>
    </step>
    <step performance="required">
     <para>
      将更改保存到 文件中。它将作为原始文件的扩展。
     </para>
    </step>
   </procedure>
  </sect2>

  <sect2 id="sec.boot.systemd.custom.targets">
   <title>创建自定义目标</title>
   <para>
    System V init SUSE 系统上未使用运行级别 4，以便允许管理员创建自己的运行级别配置。systemd 允许您创建任意数目的自定义目标。建议您从采用 <systemitem>graphical.target</systemitem> 等现有目标开始。
   </para>
   <procedure>
    <step performance="required">
     <para>
      将配置文件 <filename>/usr/lib/systemd/system/graphical.target</filename> 复制到 <filename>/etc/systemd/system/<replaceable>&lt;我的目标&gt;</replaceable>.target</filename>，并根据需要调整该文件。
     </para>
    </step>
    <step performance="required">
     <para>
      上一步中复制的配置文件已涵盖目标的必要（<quote>硬性</quote>）依赖性。如果还要涵盖需要的（<quote>软性</quote>）依赖性，请创建目录 <filename>/etc/systemd/system/<replaceable>&lt;我的目标&gt;</replaceable>.target.wants</filename>。
     </para>
    </step>
    <step performance="required">
     <para>
      对每个需要的服务，创建从 <filename>/usr/lib/systemd/system</filename> 链到 <filename>/etc/systemd/system/<replaceable>&lt;我的目标&gt;</replaceable>.target.wants</filename> 的符号链接。
     </para>
    </step>
    <step performance="required">
     <para>
      设置好目标后，重新装载 systemd 配置以让新目标可用。
     </para>
<screen>systemctl daemon-reload</screen>
    </step>
   </procedure>
  </sect2>
 </sect1>
 <sect1 id="sec.boot.systemd.advanced">
  <title>高级用途</title>

  <para>
   以下几节介绍了适合系统管理员的高级主题。有关更高级的 systemd 文档，请参考 Lennart Pöttering 撰写的适合管理员的 systemd 相关系列，网址为 <ulink url="http://0pointer.de/blog/projects"/>。
  </para>

  <sect2 id="sec.boot.systemd.advanced.logging">
   <title>系统日志</title>
   <para>
    <xref linkend="sec.boot.systemd.basics.services_debugging"/> 介绍如何查看给定服务的日志讯息。但可显示的日志讯息并不仅限于服务日志。您还可以访问和查询 <systemitem class="daemon">systemd</systemitem> 写入的完整日志，即所谓的<quote>日记</quote>。使用 <command>systemd-journalctl</command> 命令可显示完整的日志讯息，从最早的项开始。有关诸如应用过滤器或更改输出格式的选项，请参考 <command>man 1 systemd-journalctl</command>。
   </para>
  </sect2>

  <sect2 id="sec.boot.systemd.advanced.snapshots">
   <title>快照</title>
   <para>
    您可以使用 <command>isolate</command> 子命令将 <systemitem class="daemon">systemd</systemitem> 的当前状态保存到指定快照中，并在日后还原到该状态。此功能在测试服务或自定义目标时非常有用，因为它可让您随时回到定义的状态。快照仅在当前会话中可用，重引导时将自动删除。快照名称必须以 <filename>.snapshot</filename> 结尾。
   </para>
   <variablelist>
    <varlistentry>
     <term>创建快照</term>
     <listitem>
<screen>systemctl snapshot <replaceable>&lt;my_snapshot&gt;</replaceable>.snapshot</screen>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>删除快照</term>
     <listitem>
<screen>systemctl delete <replaceable>&lt;my_snapshot&gt;</replaceable>.snapshot</screen>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>查看快照</term>
     <listitem>
<screen>systemctl show <replaceable>&lt;my_snapshot&gt;</replaceable>.snapshot</screen>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>激活快照</term>
     <listitem>
<screen>systemctl isolate <replaceable>&lt;my_snapshot&gt;</replaceable>.snapshot</screen>
     </listitem>
    </varlistentry>
   </variablelist>
  </sect2>
  
  
  <sect2 id="sec.boot.systemd.advanced.kernel_modules">
   <title>装载内核模块</title>
   <para>
    借助 <systemitem class="daemon">systemd</systemitem>，再通过使用以下位置中的配置文件，可以在引导时自动装载内核模块：
   </para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>
      <filename>/usr/lib/modules-load.d</filename> 和
     </para>
    </listitem>
    <listitem>
     <para>
      <filename>/etc/modules-load.d</filename>
     </para>
    </listitem>
   </itemizedlist>
   <para>
    有关详细信息，请参见 <systemitem>modules-load.d(5)</systemitem> 手册页。
   </para>
  </sect2>
  
  <sect2 id="sec.boot.systemd.advanced.cgroups">
   <title>内核控制组 (cgroups)
</title>
   <para>
    在传统 System V init 系统上，并不总是能够明确地将某个进程指派给生成它的服务。一些服务（例如 Apache）会生成大量第三方进程（例如 CGI 或 Java 进程），这些进程本身又会生成更多进程。这使得明确指派变得非常困难，甚至无法做到。另外，服务可能不会正常终止，导致部分子服务仍保持运行状态。
   </para>
   <para>
    systemd 通过将每个服务放入它自己的 cgroup 中，解决了这个问题。cgroups 是一项内核功能，允许将累积的进程及其所有子进程放入分层组织的组中。systemd 根据每个 cgroup 的服务名称命名各 cgroup。因为非特权进程不允许<quote>离开</quote>它的 cgroup，这提供了一种行之有效的方式，可通过服务名称来标记该服务生成的所有进程。
   </para>
   <para>
    要列出属于某个服务的所有进程，请使用命令 <command>systemd-cgls</command>。结果将如下所示（已精简）：
   </para>
   <example>
    <title>列出属于某个服务的所有进程</title>
<screen><prompt role="user">root # </prompt>systemd-cgls --no-pager
├─1 /usr/lib/systemd/systemd --switched-root --system --deserialize 20
├─user.slice
│ └─user-1000.slice
│   ├─session-102.scope
│   │ ├─12426 gdm-session-worker [pam/gdm-password]
│   │ ├─15831 gdm-session-worker [pam/gdm-password]
│   │ ├─15839 gdm-session-worker [pam/gdm-password]
│   │ ├─15858 /usr/lib/gnome-terminal-server

[...]

└─system.slice
  ├─systemd-hostnamed.service
  │ └─17616 /usr/lib/systemd/systemd-hostnamed
  ├─cron.service
  │ └─1689 /usr/sbin/cron -n
  ├─ntpd.service
  │ └─1328 /usr/sbin/ntpd -p /var/run/ntp/ntpd.pid -g -u ntp:ntp -c /etc/ntp.conf
  ├─postfix.service
  │ ├─ 1676 /usr/lib/postfix/master -w
  │ ├─ 1679 qmgr -l -t fifo -u
  │ └─15590 pickup -l -t fifo -u
  ├─sshd.service
  │ └─1436 /usr/sbin/sshd -D

[...]</screen>
   </example>
   <para>
    有关 cgroups 的更多信息，请参见<xref linkend="cha.tuning.cgroups"/>。
   </para>
  </sect2>

  <sect2 id="sec.boot.systemd.advanced.kill">
   <title>终止服务（发送信号）</title>
   <para>
    如<xref linkend="sec.boot.systemd.advanced.cgroups"/>中所述，在 System V init 系统中，并不总是能够将某个进程指派给其父服务。这导致终止服务及其所有子进程变得很困难。尚未终止的子进程将一直保持为僵停状态。
   </para>
   <para>
    systemd 将每个服务限定在某个 cgroup 中的概念使您可以明确识别一个服务的所有子进程，从而向这些进程中的每一个发送信号。您可使用 <command>systemctl kill</command> 向服务发送信号。有关可用信号的列表，请参考 <command>man 7 signals</command>。
   </para>
   <variablelist>
    <varlistentry>
     <term>向服务发送 <systemitem>SIGTERM</systemitem></term>
     <listitem>
      <para>
       <systemitem>SIGTERM</systemitem> 是发送的默认信号。
      </para>
<screen>systemctl kill <replaceable>&lt;my_service&gt;</replaceable>.service</screen>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>向服务发送 <replaceable>SIGNAL</replaceable></term>
     <listitem>
      <para>
       可使用 <option>-s</option> 选项指定应该发送的信号。
      </para>
<screen>systemctl kill -s <replaceable>SIGNAL</replaceable> <replaceable>&lt;my_service&gt;</replaceable>.service</screen>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>选择进程</term>
     <listitem>
      <para>
       默认情况下，<command>kill</command> 命令会向指定 cgroup 的<option>所有</option>进程发送信号。您可以将发送范围限制为 <option>control</option> 或 <option>main</option> 进程。后一个选项可用于通过发送 <systemitem>SIGHUP</systemitem> 强制服务重新装载其配置的情况：
      </para>
<screen>systemctl kill -s SIGHUP --kill-who=main <replaceable>&lt;my_service&gt;</replaceable>.service</screen>
     </listitem>
    </varlistentry>
   </variablelist>
  </sect2>



  <sect2 id="sec.boot.systemd.basics.services_debugging">
   <title>调试服务</title>
   <para>
    默认情况下，systemd 的输出不会太详细。如果服务启动成功，则不会产生任何输出。如果服务启动失败，则会显示简短的错误讯息。不过，<command>systemctl status</command> 提供了调试服务的启动和操作的途径。
   </para>
   <para>
    systemd 附带了自己的日志记录机制（<quote>日志</quote>）来记录系统讯息。这可让您一并显示服务讯息与状态讯息。<command>status</command> 命令的工作方式与 <command>tail</command> 相似，也可以采用不同的格式显示日志讯息，是一个功能强大的调试工具。
   </para>
   <variablelist>
    <varlistentry>
     <term>显示服务启动失败讯息</term>
     <listitem>
      <para>
       当服务启动失败时，使用 <command>systemctl status <replaceable>&lt;我的服务&gt;</replaceable>.service</command> 可获得详细的错误讯息：
      </para>
<screen><prompt role="user">root # </prompt>systemctl start apache2.service
Job failed. See system journal and 'systemctl status' for details.
<prompt role="user">root # </prompt>systemctl status apache2.service
   Loaded: loaded (/usr/lib/systemd/system/apache2.service; disabled)
   Active: failed (Result: exit-code) since Mon, 04 Jun 2012 16:52:26 +0200; 29s ago
   Process: 3088 ExecStart=/usr/sbin/start_apache2 -D SYSTEMD -k start (code=exited, status=1/FAILURE)
   CGroup: name=systemd:/system/apache2.service

Jun 04 16:52:26 g144 start_apache2[3088]: httpd2-prefork: Syntax error on line
205 of /etc/apache2/httpd.conf: Syntax error on li...alHost&gt;</screen>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>显示最后 <replaceable>n</replaceable> 条服务讯息</term>
     <listitem>
      <para>
       <command>status</command> 子命令的默认行为是显示服务发出的最后 10 条讯息。如想要更改要显示的讯息数目，请使用 <option>--lines=<replaceable>n</replaceable></option> 参数：
      </para>
<screen>systemctl status ntp.service
systemctl --lines=20 status ntp.service</screen>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>以附加模式显示服务讯息</term>
     <listitem>
      <para>
       要显示服务讯息的<quote>实时流</quote>，请使用 <option>--follow</option> 选项，效果与 <command>tail <option>-f</option></command> 相似：
      </para>
<screen>systemctl --follow status ntp.service</screen>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>讯息输出格式</term>
     <listitem>
      <para>
       <option>--output=<replaceable>模式</replaceable></option> 参数可让您更改服务讯息的输出格式。最重要的可用模式包括：
      </para>
      <variablelist>
       <varlistentry>
        <term><option>short</option>
        </term>
        <listitem>
         <para>
          默认格式。显示日志讯息，以及用户能看懂的时戳。
         </para>
        </listitem>
       </varlistentry>
       <varlistentry>
        <term><option>verbose</option>
        </term>
        <listitem>
         <para>
          所有字段的完整输出。
         </para>
        </listitem>
       </varlistentry>
       <varlistentry>
        <term><option>cat</option>
        </term>
        <listitem>
         <para>
          精简输出，不含时戳。
         </para>
        </listitem>
       </varlistentry>
      </variablelist>
     </listitem>
    </varlistentry>
   </variablelist>
  </sect2>
 </sect1>
 <sect1 id="sec.boot.systemd.info">
  <title>更多信息</title>

  <para>
   有关 systemd 的更多信息，请参考下列联机资源：
  </para>

  <variablelist>
   <varlistentry>
    <term>主页</term>
    <listitem>
     <para>
      <ulink url="http://www.freedesktop.org/wiki/Software/systemd"/>
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>systemd for Administrators（面向管理员的 systemd）</term>
    <listitem>
     <para>
      作者：Lennart Pöttering，一位 systemd 作家，他撰写了一系列博客（写本章时为 2013 年）。它们可在 <ulink url="http://0pointer.de/blog/projects"/> 找到。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>控制中心：<systemitem class="daemon">systemd</systemitem> Linux init 系统</term>
    <listitem>
     <para>
      <ulink url="http://www.h-online.com/open/features/Control-Centre-The-systemd-Linux-init-system-1565543.html"/>
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Booting up: Tools and tips for systemd, a Linux init tool（启动：Linux init 工具 systemd 的适用工具和提示）</term>
    <listitem>
     <para>
      <ulink url="http://www.h-online.com/open/features/Booting-up-Tools-and-tips-for-systemd-1570630.html"/>
     </para>
    </listitem>
   </varlistentry>
  </variablelist>
 </sect1>
</chapter>
