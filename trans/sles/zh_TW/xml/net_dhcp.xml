<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE chapter PUBLIC "-//Novell//DTD NovDoc XML V1.0//EN" "novdocx.dtd">
<!--
*********************************
Please see LICENSE.txt for this document's license.
*********************************
-->
<chapter xml:base="net_dhcp.xml" id="cha.dhcp">
 <title>DHCP</title>
<indexterm class="startofrange" id="idx.DHCP"> <primary>DHCP</primary> </indexterm> <indexterm> <primary>網路</primary><secondary>DHCP</secondary> </indexterm> <indexterm> <primary>IP 位址</primary> <secondary>動態指派 </secondary></indexterm>
 <abstract>
  <para>
   <emphasis>動態主機組態通訊協定</emphasis> (Dynamic Host Configuration Protocol，DHCP) 的用途是從伺服器集中指定網路設定，這樣就不必在每一個工作站本地分別設定。設定要使用 DHCP 的主機對於自己的靜態位址並沒有控制權。它可以根據伺服器的指示完全且自動地設定自己本身。如果您在用戶端使用 NetworkManager，就完全不必設定用戶端。這在環境多變、而且一次只使用一個介面的情況下非常有用。絕對不要在執行 DHCP 伺服器的機器上使用 NetworkManager。
  </para>
 </abstract>
 <tip arch="zseries" os="sles">
  <title>IBM System z：DHCP 支援</title>
  <para>
   在 IBM System z 平台上，DHCP 僅能用於使用 OSA 和 OSA Express 網路卡的介面上。這些網路卡是唯一使用 MAC 的網路卡，是 DHCP 自動組態功能的必要元件。
  </para>
 </tip>
 <para>
  DHCP 伺服器的一種設定方式是識別每個使用網路卡硬體位址 (大部分的情況下是固定的) 的用戶端，以後每次用戶端連接伺服器時，將提供相同的設定值給用戶端。或者，也可以將 DHCP 設定成從專門設定的位址池，動態指派位址給每個相關用戶端。在後者的情形中，DHCP 伺服器在每次接到請求時會指派相同的位址給用戶端，即使經過較長的時間也是一樣。這只適用於網路用戶端數少於網路位址數的情況。
 </para>
 <para>
  DHCP 可簡化系統管理員的工作。任何與位址及一般網路組態相關的變更 (包括較大的變更) 都可集中執行，只要編輯伺服器的組態檔。與重新設定眾多的工作站相比，這種方法要便利許多。此外，由於這些機器可以從位址池獲取 IP 位址，因此將機器 (特別是新機器) 整合到網路中也要容易得多。從 DHCP 伺服器擷取適當的網路設定這種方式，對於經常需要在不同網路中使用筆記型電腦的情況特別有用。
 </para>
 <para>
  在本章中，DHCP 伺服器將在使用 <systemitem class="ipaddress">192.168.2.1</systemitem> 做為閘道的工作站 <systemitem class="ipaddress">192.168.2.0/24</systemitem> 所在的同一子網路中執行。DHCP 伺服器有固定的 IP 位址 <systemitem class="ipaddress">192.168.2.254</systemitem>，提供的位址範圍有兩個：<systemitem class="ipaddress">192.168.2.10</systemitem> 到 <systemitem class="ipaddress">192.168.2.20</systemitem> 以及 <systemitem class="ipaddress">192.168.2.100</systemitem> 到 <systemitem class="ipaddress">192.168.2.200</systemitem>。
 </para>
 <para>
  DHCP 伺服器不僅提供 IP 位址和網路遮罩，也提供主機名稱、領域名稱、閘道和名稱伺服器位址供用戶端使用。除此之外，DHCP 也允許集中設定一些其他的參數，例如，用戶端可以輪詢目前時間的時間伺服器或甚至是列印伺服器。
 </para>
 <sect1 id="sec.dhcp.yast">
  <title>使用 YaST 設定 DHCP 伺服器</title>

<indexterm> <primary>YaST</primary><secondary>DHCP</secondary></indexterm><indexterm><primary>DHCP</primary><secondary>使用 YaST 設定</secondary></indexterm>

  <para>
   若要安裝 DHCP 伺服器，請啟動 YaST 並選取<menuchoice><guimenu>軟體</guimenu> <guimenu>軟體管理</guimenu></menuchoice>。選擇<menuchoice><guimenu>過濾器</guimenu> <guimenu>模式</guimenu></menuchoice>，然後選取<guimenu>DHCP 及 DNS 伺服器</guimenu>。請確蓋安裝個別套件，完成此安裝程序。
  </para>

  <important>
   <title>LDAP 支援</title>
   <para>
    YaST DHCP 模組可以設定成將伺服器組態儲存在本地 (即執行 DHCP 伺服器的主機上)，或是由 LDAP 伺服器來管理其組態資料。如果要使用 LDAP，應在設定 DHCP 伺服器之前先設定您的 LDAP 環境。
   </para>
   <para>
    如需 LDAP 的詳細資訊，請參閱<xref linkend="cha.security.ldap"/>。
   </para>
  </important>

  <para>
   YaST DHCP 模組 (<systemitem>yast2-dhcp-server</systemitem>) 可讓您將自己的 DHCP 伺服器設定用於區域網路。該模組能夠以精靈模式或是進階組態模式執行。
  </para>

  <sect2 id="sec.dhcp.yast.init">
   <title>初始組態 (精靈)</title>
   <para>
    首次啟動模組時，會啟動精靈，提示您對伺服器管理進行一些基本設定。完成此初始設定程序後會產生一個非常基本的伺服器組態，能夠發揮其基本功能。進階模式可以處理更多進階設定任務。請執行下列步驟：
   </para>
   
   <procedure id="pro.dhcp.yast.init">
    <step performance="required">
     <para>
      請從清單中選取 DHCP 伺服器應監聽的介面，然後按一下<guimenu>選取</guimenu>。接著選取<guimenu>開啟選取介面的防火牆</guimenu>，以開啟此介面的防火牆，然後按<guimenu>下一步</guimenu>。請參閱<xref linkend="fig.yast2.dhcp.wiz1"/>。
     </para>
     <figure id="fig.yast2.dhcp.wiz1">
      <title>DHCP 伺服器︰介面卡選項</title>
      <mediaobject>
       <imageobject role="fo">
        <imagedata width="75%" fileref="yast2_dhcp_wiz1.png" format="PNG"/>
       </imageobject>
       <imageobject role="html">
        <imagedata width="75%" fileref="yast2_dhcp_wiz1.png" format="PNG"/>
       </imageobject>
      </mediaobject>
     </figure>
    </step>
    <step performance="required">
     <para>
      使用核取方塊決定您的 DHCP 設定是否要由 LDAP 伺服器自動儲存。在文字方塊中提供 DHCP 伺服器應管理的所有用戶端的網路細節。這些細節包括網域名稱、時間伺服器的位址、主要及次要名稱伺服器的位址、列印和 WINS 伺服器的位址 (供同時具有 Windows 與 Linux 用戶端的混和網路使用)、閘道位址以及租用時間。請參閱<xref linkend="fig.yast2.dhcp.wiz2"/>。
     </para>
     <figure id="fig.yast2.dhcp.wiz2">
      <title>DHCP 伺服器︰全域設定</title>
      <mediaobject>
       <imageobject role="fo">
        <imagedata width="75%" fileref="yast2_dhcp_wiz2.png" format="PNG"/>
       </imageobject>
       <imageobject role="html">
        <imagedata width="75%" fileref="yast2_dhcp_wiz2.png" format="PNG"/>
       </imageobject>
      </mediaobject>
     </figure>
    </step>
    <step performance="required">
     <para>
      設定應該如何將動態 IP 位址指定給用戶端。若要這樣做，指定伺服器可以指派位址給 DHCP 用戶端的 IP 範圍。所有這些位址應該涵蓋在相同的網路遮罩下。另外也指定租用時間，在此時間段內用戶端可以保留其 IP 位址，無需要求延續租用。或者，指定最長出租時間，也就是伺服器保留特定用戶端之 IP 位址的時間。請參閱<xref linkend="fig.yast2.dhcp.wiz3"/>。
     </para>
     <figure id="fig.yast2.dhcp.wiz3">
      <title>DHCP 伺服器︰動態 DHCP</title>
      <mediaobject>
       <imageobject role="fo">
        <imagedata width="75%" fileref="yast2_dhcp_wiz3.png" format="PNG"/>
       </imageobject>
       <imageobject role="html">
        <imagedata width="75%" fileref="yast2_dhcp_wiz3.png" format="PNG"/>
       </imageobject>
      </mediaobject>
     </figure>
    </step>
    <step performance="required">
     <para>
      定義應該如何啟動 DHCP 伺服器。指定您希望系統開機時自動啟動 DHCP 伺服器，還是在需要時手動啟動 (例如，用於測試目的)。按一下<guimenu>完成</guimenu>完成伺服器的組態。請參閱<xref linkend="fig.yast2.dhcp.start"/>。

     </para>
     <figure id="fig.yast2.dhcp.start">
      <title>DHCP 伺服器︰啟動</title>
      <mediaobject>
       <imageobject role="fo">
        <imagedata width="75%" fileref="yast2_dhcp_start.png" format="PNG"/>
       </imageobject>
       <imageobject role="html">
        <imagedata width="75%" fileref="yast2_dhcp_start.png" format="PNG"/>
       </imageobject>
      </mediaobject>
     </figure>
    </step>
    <step os="sles" performance="required">
     <para>
      除了以先前步驟描述的方式使用動態 DHCP 外，您也可以設定伺服器以準靜態方式指定位址。使用下半部所提供的文字方塊，指定要以這種方式進行管理之用戶端的清單。具體而言，就是提供要指定給這類用戶端的<guimenu>名稱</guimenu>和<guimenu>IP 位址</guimenu>，另外還要提供<guimenu>硬體位址</guimenu>和<guimenu>網路類型</guimenu>(記號環或乙太網路)。使用<guimenu>新增</guimenu>、<guimenu>編輯</guimenu>和<guimenu>從清單中刪除</guimenu>修改顯示於螢幕上半部分的用戶端清單。請參閱<xref linkend="fig.yast2.dhcp.statdhcp"/>。
     </para>
     <figure id="fig.yast2.dhcp.statdhcp">
      <title>DHCP 伺服器︰主機管理</title>
      <mediaobject>
       <imageobject role="fo">
        <imagedata width="75%" fileref="yast2_dhcp_statdhcp.png" format="PNG"/>
       </imageobject>
       <imageobject role="html">
        <imagedata width="75%" fileref="yast2_dhcp_statdhcp.png" format="PNG"/>
       </imageobject>
      </mediaobject>
     </figure>
    </step>
   </procedure>
  </sect2>

  <sect2 id="sec.dhcp.yast.expert" os="sles">
   <title>DHCP 伺服器組態 (進階)</title>
   <para>
    除了稍早討論的組態方法外，還有進階組態模式，可讓您變更 DHCP 伺服器設定的每個細節。啟動進階組態，方法是在<guimenu>啟動</guimenu>對話方塊中按一下<guimenu>DHCP 伺服器進階組態</guimenu>(請參閱<xref linkend="fig.yast2.dhcp.start"/>)。
   </para>
   <variablelist>
    <varlistentry>
     <term>Chroot 環境與宣告</term>
     <listitem>
      <para>
       在此第一個對話方塊中，選取<guimenu>啟動 DHCP 伺服器</guimenu>讓現有組態可以編輯。DHCP 伺服器行為的一個重要特點是，它能夠在 chroot 環境或 chroot jail 中執行，以確保伺服器主機的安全。如果 DHCP 伺服器會遭受外部攻擊，駭客將會被阻絕於 chroot jail 的保護之外，防止其染指系統的其他部分。對話方塊的下半部顯示已經定義之宣告的樹狀檢視。使用<guimenu>新增</guimenu>、<guimenu>刪除</guimenu>和<guimenu>編輯</guimenu>修改這些宣告。選取<guimenu>進階</guimenu>將帶您到其他的進階對話方塊。請參閱<xref linkend="fig.yast2.dhcp.chroot"/>。 選取 <guimenu>新增</guimenu> 後，定義要新增的宣告類型。使用 <guimenu>進階</guimenu>，檢視伺服器的記錄檔、設定 TSIG 金鑰管理，並根據 DHCP 伺服器的設定調整防火牆的組態。
      </para>
      <figure id="fig.yast2.dhcp.chroot">
       <title>DHCP 伺服器︰Chroot Jail 和宣告</title>
       <mediaobject>
        <imageobject role="fo">
         <imagedata width="75%" fileref="yast2_dhcp_chroot.png" format="PNG"/>
        </imageobject>
        <imageobject role="html">
         <imagedata width="75%" fileref="yast2_dhcp_chroot.png" format="PNG"/>
        </imageobject>
       </mediaobject>
      </figure>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>選取宣告類型</term>
     <listitem>
      <para>
       DHCP 伺服器的<guimenu>全域選項</guimenu>由數個宣告組成。此對話方塊可讓您設定宣告類型︰<guimenu>子網路</guimenu>、<guimenu>主機</guimenu>、<guimenu>共享網路</guimenu>、<guimenu>群組</guimenu>、<guimenu>位址池</guimenu>和<guimenu>類別</guimenu>。此範例顯示新子網路的選項 (請參閱<xref linkend="fig.yast2.dhcp.newdec"/>)。
      </para>
      <figure id="fig.yast2.dhcp.newdec">
       <title>DHCP 伺服器︰選取宣告類型</title>
       <mediaobject>
        <imageobject role="fo">
         <imagedata width="75%" fileref="yast2_dhcp_newdec.png" format="PNG"/>
        </imageobject>
        <imageobject role="html">
         <imagedata width="75%" fileref="yast2_dhcp_newdec.png" format="PNG"/>
        </imageobject>
       </mediaobject>
      </figure>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>子網路組態</term>
     <listitem>
      <para>
       此對話方塊可讓您使用 IP 位址及網路遮罩來指定新的子網路。在對話方塊的中間部分，使用<guimenu>新增</guimenu>、<guimenu>編輯</guimenu>和<guimenu>刪除</guimenu>修改所選子網路的 DHCP 伺服器啟動選項。若要設定子網路的動態 DNS，選取 <guimenu>動態 DNS</guimenu>。
      </para>
      <figure id="fig.yast2.dhcp.sub">
       <title>DHCP 伺服器︰設定子網路</title>
       <mediaobject>
        <imageobject role="fo">
         <imagedata width="75%" fileref="yast2_dhcp_sub.png" format="PNG"/>
        </imageobject>
        <imageobject role="html">
         <imagedata width="75%" fileref="yast2_dhcp_sub.png" format="PNG"/>
        </imageobject>
       </mediaobject>
      </figure>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>TSIG 金鑰管理</term>
     <listitem>
      <para>
       如果在上一個對話方塊中選擇設定動態 DNS，現在可以針對安全區域傳輸設定金鑰管理。選取<guimenu>確定</guimenu> 會帶您到另一個對話方塊，讓您設定動態 DNS 的介面 (請參閱 <xref linkend="fig.yast2.dhcp.dyndns"/>)。
      </para>
      <figure id="fig.yast2.dhcp.tsig">
       <title>DHCP 伺服器︰TSIG 組態</title>
       <mediaobject>
        <imageobject role="fo">
         <imagedata width="75%" fileref="yast2_dhcp_tsig.png" format="PNG"/>
        </imageobject>
        <imageobject role="html">
         <imagedata width="75%" fileref="yast2_dhcp_tsig.png" format="PNG"/>
        </imageobject>
       </mediaobject>
      </figure>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>動態 DNS︰介面組態</term>
     <listitem>
      <para>
       選取<guimenu>啟用此子網路的動態 DNS</guimenu>，即可啟用子網路的動態 DNS。完成此操作後，使用下拉式方塊選擇正向與反向區域的 TSIG 金鑰，確定為 DNS 和 DHCP 伺服器選擇的金鑰相同。使用<guimenu>更新全域動態 DNS 設定</guimenu>，來依據動態 DNS 環境自動更新及調整全域 DHCP 伺服器設定。最後，定義每個動態 DNS 的哪些轉遞和反向區域需要更新，為兩個區域都指定主要名稱伺服器的名稱。選取<guimenu>確定</guimenu>返回子網路組態對話方塊 (請參閱<xref linkend="fig.yast2.dhcp.sub"/>)。再次選取<guimenu>確定</guimenu>返回最初的進階組態對話方塊。
      </para>
      <figure id="fig.yast2.dhcp.dyndns">
       <title>DHCP 伺服器︰動態 DNS 的介面組態</title>
       <mediaobject>
        <imageobject role="fo">
         <imagedata width="75%" fileref="yast2_dhcp_dyndns.png" format="PNG"/>
        </imageobject>
        <imageobject role="html">
         <imagedata width="75%" fileref="yast2_dhcp_dyndns.png" format="PNG"/>
        </imageobject>
       </mediaobject>
      </figure>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>網路介面組態</term>
     <listitem>
      <para>
       若要定義 DHCP 伺服器應該監聽的介面以及調整防火牆組態，請從進階組態對話方塊中選取<menuchoice><guimenu>進階</guimenu><guimenu>介面組態</guimenu></menuchoice>。從顯示的介面清單中，選取一或多個要由 DHCP 伺服器處理的介面。如果所有子網路中的用戶端都必須能與伺服器通訊，並且伺服器主機還要執行防火牆，請對防火牆進行相應的調整。若要這樣做，請選取<guimenu>調整防火牆設定</guimenu>。接著，YaST 會根據新的條件調整 SuSEFirewall2 的規則 (請參閱<xref linkend="fig.yast2.dhcp.fire"/>)，之後您即可選取<guimenu>確定</guimenu>返回最初的對話方塊。
      </para>
      <figure id="fig.yast2.dhcp.fire">
       <title>DHCP 伺服器︰網路介面和防火牆</title>
       <mediaobject>
        <imageobject role="fo">
         <imagedata width="75%" fileref="yast2_dhcp_fire.png" format="PNG"/>
        </imageobject>
        <imageobject role="html">
         <imagedata width="75%" fileref="yast2_dhcp_fire.png" format="PNG"/>
        </imageobject>
       </mediaobject>
      </figure>
     </listitem>
    </varlistentry>
   </variablelist>
   <para>
    完成所有組態步驟後，按一下<guimenu>確定</guimenu>關閉對話方塊。伺服器現在會以新的組態啟動。
   </para>
  </sect2>
 </sect1>
 <sect1 id="sec.dhcp.soft">
  <title>DHCP 軟體套件</title><indexterm> <primary>DHCP</primary> <secondary>套件</secondary> </indexterm>

  <para>
   SUSE Linux Enterprise Server 可以使用 DHCP 伺服器，也可以使用 DHCP 用戶端。可用的 DHCP 伺服器是 <systemitem class="daemon">dhcpd</systemitem> (由 Internet Systems Consortium 發佈)。用戶端提供了 <systemitem>dhcp-client</systemitem> (ISC 也有提供) 及 <systemitem>wicked</systemitem> 套件附帶的工具。
  </para>

  <para>
   依預設，<systemitem>wicked</systemitem> 工具會連同 <systemitem>wickedd-dhcp4.service</systemitem> 和 <systemitem>wickedd-dhcp6.service</systemitem> 一起安裝。系統每次開機時，會自動啟動它們，以監視 DHCP 伺服器。它們不需要組態檔來執行其工作，而且大部份的標準設定可以直接使用。如果情況較為複雜，請使用 ISC <systemitem>dhcp-client</systemitem>，此程式透過組態檔 <filename>/etc/dhclient.conf</filename> 和 <filename>/etc/dhclient6.conf</filename> 來控制。<indexterm> <primary>組態檔</primary> <secondary>dhclient.conf</secondary> </indexterm>
  </para>
 </sect1>
 <sect1 id="sec.dhcp.server">
  <title>DHCP 伺服器 dhcpd</title>

<indexterm> <primary>組態檔</primary> <secondary>dhcpd.conf</secondary> </indexterm> <indexterm class="startofrange" id="idx.dhcp_server"> <primary>DHCP</primary> <secondary>伺服器</secondary> </indexterm> <indexterm class="startofrange" id="idx.dhcp_dhcpd"> <primary>DHCP</primary> <secondary>dhcpd </secondary></indexterm>

  <para>
   任何 DHCP 系統的核心都是動態主機組態通訊協定精靈。這個伺服器會依照組態檔 <filename>/etc/dhcpd.conf</filename> 中定義的設定，<emphasis>租用</emphasis>位址並監看其使用情形。藉由變更此檔案中的參數及值，系統管理員可以透過數種方式影響程式的行為。請參閱 <xref linkend="dat.dhcp.conf"/> 中的 <filename>/etc/dhcpd.conf</filename> 基本範例檔案。
  </para>

  <example id="dat.dhcp.conf">
   <title>組態檔 /etc/dhcpd.conf</title>
<screen>
default-lease-time 600;         # 10 minutes
max-lease-time 7200;            # 2  hours

option domain-name "example.com";
option domain-name-servers 192.168.1.116;
option broadcast-address 192.168.2.255;
option routers 192.168.2.1;
option subnet-mask 255.255.255.0;

subnet 192.168.2.0 netmask 255.255.255.0
 {
  range 192.168.2.10 192.168.2.20;
  range 192.168.2.100 192.168.2.200;
 }
</screen>
  </example>

  <para>
   這個簡單的組態檔應足以讓 DHCP 伺服器在網路中指派 IP 位址。請確定每行結尾都插入分號，否則不會啟動 dhcpd。
  </para>

  <para>
   範例檔可以分為三個部分。第一個部分定義要求用戶端預設可租用 IP 位址的秒數 (<literal>default-lease-time</literal>)，此時間過後將需要申請續約。其中還包含機器可以保留 DHCP 伺服器指派之 IP 位址、不申請續約的最長期限的陳述式 (<literal>max-lease-time</literal>)。
  </para>

  <para>
   在第二部份中，一些基本網路參數定義於全域層級：
  </para>

  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>
     行 <literal>option domain-name</literal> 定義了您網路的預設網域。
    </para>
   </listitem>
   <listitem>
    <para>
     利用 <literal>option domain-name-servers</literal> 項目，最多可指定三個 DNS 伺服器值，用來將 IP 位址解析為主機名稱，或將主機名稱解析為 IP 位址。最好在設定 DHCP 前先設定機器上或網路上其他位置的名稱伺服器。該名稱伺服器也可以為每個動態位址定義主機名稱，反之亦然。若要瞭解如何設定您自己的名稱伺服器，請參閱 <xref linkend="cha.dns"/>。
    </para>
   </listitem>
   <listitem>
    <para>
     <literal>option broadcast-address</literal> 這一行定義要求用戶端應使用的廣播位址。
    </para>
   </listitem>
   <listitem>
    <para>
     利用 <literal>option routers</literal>，可設定伺服器要將無法傳送至區域網路上之主機的資料封包傳送到什麼地方 (依據提供的來源和目的主機位址及子網路遮罩)。在大多數的情況中，特別是較小的網路，此路由與網際網路閘道是完全一樣的。
    </para>
   </listitem>
   <listitem>
    <para>
     利用 <literal>option subnet-mask</literal>，指定指定給用戶端的網路遮罩。
    </para>
   </listitem>
  </itemizedlist>

  <para>
   檔案的最後一個部分定義網路，包括子網路遮罩。若要完成設定，請指定 DHCP 精靈用來指派 IP 位址給相關用戶端的位址範圍。在 <xref linkend="dat.dhcp.conf"/> 中，用戶端的指定位址可介於 <literal>192.168.2.10</literal> 與 <literal>192.168.2.20</literal> 之間以及 <literal>192.168.2.100</literal> 與 <literal>192.168.2.200</literal> 之間。
  </para>

  <para>
   編輯這幾行後，就能夠使用指令 <command>systemctl start dhcpd.service</command> 啟動 DHCP 精靈。該精靈可以立即使用。使用指令 <command>rcdhcpd</command> <option>check-syntax</option> 執行簡短的語法檢查。如果遇到任何組態方面的非預期問題 (例如伺服器因出現錯誤而中止或在啟動時沒有傳回 <literal>done</literal>)，則可以使用指令 <command>journalctl</command> 查詢主系統記錄中的資訊，找出問題所在 (如需更多資訊，請參閱<xref linkend="cha.journalctl"/>)。
  </para>

  <para>
   在預設的 <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> 系統上，出於安全性考量，DHCP 精靈會在 chroot 環境中啟動。組態檔必須複製到 chroot 環境，如此精靈才可以找到這些檔案。通常情況下不需要擔心發生這種情形，因為指令 <command>systemctl start dhcpd.service</command> 會自動複製檔案。
  </para><indexterm class="endofrange" startref="idx.dhcp_server"/><indexterm class="endofrange" startref="idx.dhcp_dhcpd"/>

  <sect2 id="sec.dhcp.statip">
   <title>使用固定 IP 位址的用戶端</title><indexterm> <primary>DHCP</primary> <secondary>靜態位址指派</secondary> </indexterm>
   <para>
    DHCP 也可以用來指派預先定義的靜態位址給特定用戶端。明確指派的位址永遠比集區的動態位址優先。當可用位址不足，伺服器必須在用戶端之間重新分配位址時 (舉例而言)，動態位址便會過期，靜態位址則不同，它永遠不會過期。
   </para>
   <para>
    為了識別使用靜態位址設定的用戶端，dhcpd 會使用硬體位址 (硬體位址是全球唯一的固定數字代碼，由六對八位元組組成)，用來識別所有網路裝置 (例如，<literal>00:30:6E:08:EC:80</literal>)。如果相對的行 (如 <xref linkend="dat.dhcp.conf.add"/> 中所示) 新增到 <xref linkend="dat.dhcp.conf"/> 的組態檔，DHCP 精靈始終會指定相同的資料集給對應的用戶端。
   </para>
   <example id="dat.dhcp.conf.add">
    <title>組態檔的增加部分</title>
<screen>host jupiter {
hardware ethernet 00:30:6E:08:EC:80;
fixed-address 192.168.2.100;
}</screen>
   </example>
   <para>
    在第一行輸入對應用戶端的名稱 (<literal>host</literal> <replaceable>主機名稱</replaceable>，範例中為 <systemitem>jupiter</systemitem>)，在第二行輸入 MAC 位址。在 Linux 主機上，使用指令 <command>ip <option>link show</option></command> 並在後面接上網路裝置 (例如，<literal>eth0</literal>) 可尋找 MAC 位址。輸出應該包含如下內容
   </para>
<screen>link/ether 00:30:6E:08:EC:80</screen>
   <para>
    在上述範例中，系統會自動給具有網路卡且 MAC 位址為 <literal>00:30:6E:08:EC:80</literal> 的用戶端指定 IP 位址 <systemitem class="ipaddress">192.168.2.100</systemitem> 及主機名稱 <literal>jupiter</literal>。幾乎所有情況中輸入的硬體類型會是 <literal>ethernet</literal>，儘管通常在 IBM 系統上找到的是 <literal>token-ring</literal>，也是可以支援的。
   </para>
  </sect2>

  <sect2 id="sec.dhcp.sle">
   <title><phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> 版本</title>
   <para>
    為了提高安全性，<phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> 版 ISC DHCP 伺服器在出貨時即套用了 Ari Edelkind 的 non-root/chroot 修補程式。這樣可讓 dhcpd 利用使用者 ID <systemitem class="username">nobody</systemitem> 執行，而且也能在 chroot 環境下 (<filename>/var/lib/dhcp</filename>) 執行 dhcpd。若要這樣做，組態檔 <filename>dhcpd.conf</filename> 必須位於 <filename>/var/lib/dhcp/etc</filename>。init 程序檔啟動時會自動複製檔案到此目錄。
   </para>
   <para>
    透過檔案 <filename>/etc/sysconfig/dhcpd</filename> 中的項目，可控制伺服器與此功能相關的行為。若是不要在 chroot 環境下執行 dhcpd，請將 <filename>/etc/sysconfig/dhcpd</filename> 中的 <systemitem>DHCPD_RUN_CHROOTED</systemitem> 變數設定為 <quote>no</quote>。
   </para>
   <para>
    若要讓 dhcpd 從 chroot 環境內解析主機名稱，必須也要複製以下其他的組態檔：
   </para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>
      <filename>/etc/localtime</filename>
     </para>
    </listitem>
    <listitem>
     <para>
      <filename>/etc/host.conf</filename>
     </para>
    </listitem>
    <listitem>
     <para>
      <filename>/etc/hosts</filename>
     </para>
    </listitem>
    <listitem>
     <para>
      <filename>/etc/resolv.conf</filename>
     </para>
    </listitem>
   </itemizedlist>
   <para>
    啟動 init 程序檔時，這些檔案會複製到 <filename>/var/lib/dhcp/etc/</filename>。如果 <filename>/etc/ppp/ip-up</filename> 之類的程序檔動態修改了這些檔案，則進行所需變更時，也要考量到這些副本。不過，如果組態檔僅指定 IP 位址 (而不是指定主機名稱) 時，則不需要擔心。
   </para>
   <para>
    如果組態包含要複製到 chroot 環境的其他檔案，請在檔案 <filename>/etc/sysconfig/dhcpd</filename> 中的變數 <systemitem>DHCPD_CONF_INCLUDE_FILES</systemitem> 下設定這些檔案。為了確定重新啟動 syslog 精靈後，DHCP 記錄功能仍起作用，<filename>/etc/sysconfig/syslog</filename> 檔案中還要有另一個項目 <systemitem>SYSLOGD_ADDITIONAL_SOCKET_DHCP</systemitem>。
   </para>
  </sect2>
 </sect1>
 <sect1 id="sec.dhcp.addinfo">
  <title>更多資訊</title>

  <para>
   如需有關 DHCP 的詳細資訊，請參閱 <emphasis>Internet Systems Consortium</emphasis> 的網站 <ulink url="http://www.isc.org/products/DHCP/"/>。在 <option>dhcpd</option>、<option>dhcpd.conf</option>、<option>dhcpd.leases</option> 和 <option>dhcp-options</option> man 頁面中也可以找到資訊。
  </para><indexterm class="endofrange" startref="idx.DHCP"/>
 </sect1>
</chapter>
