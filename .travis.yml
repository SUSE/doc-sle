language: bash
env:
      global:
      - LD_PRELOAD=/lib/x86_64-linux-gnu/libSegFault.so
      - CACHE=$HOME/.cache/entities

dist: yakkety

cache:
  directories:
    - $HOME/.cache/entities

addons:
  apt:
    packages:
    - libxml2-utils
    - libxml2-dev
    - libxml2

before_script:
    - cat /etc/os-release
    # - ls xml/*.xml
    - echo $TRAVIS_COMMIT
    - xmllint --version

script:
    - test -e $CACHE || ( mkdir -p $CACHE; wget -P $CACHE http://docbook.org/xml/4.5/docbook-xml-4.5.zip; unzip -d $CACHE $CACHE/docbook-xml-4.5.zip )
    - cp -vi $CACHE/*.mod xml/
    - cp -avi $CACHE/ent xml/
    - sed -i 's#dbcent PUBLIC .*>#dbcent SYSTEM "dbcentx.mod">#' xml/entity-decl.ent
    - for file in xml/*.xml; do echo ">>> $file"; xmllint --nonet --noout --noent $file; done
