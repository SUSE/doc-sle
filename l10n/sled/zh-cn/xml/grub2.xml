<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="grub2.xml" version="5.0" xml:id="cha-grub2"> <title>引导加载程序 GRUB 2</title>
 <info>
      <abstract>
        <para>
    本章介绍如何配置 <phrase role="productname"><phrase os="sled">SUSE® Linux Enterprise Desktop</phrase></phrase> 中使用的引导加载程序 GRUB 2。<phrase os="sled;sles">GRUB 是传统 GRUB 引导加载程序（现在称作<quote>GRUB Legacy</quote>）的后继产品。从 <phrase role="productname"><phrase os="sled">SUSE® Linux Enterprise Desktop</phrase></phrase> 12 版开始，就已使用 GRUB 2 作为默认的引导加载程序。</phrase>产品中提供了一个 YaST 模块来配置最重要的设置。<xref linkend="cha-boot"/> 中将引导过程作为一个整体进行了介绍。有关 UEFI 计算机的安全引导支持的细节，请参见<xref linkend="cha-uefi"/>。
   </para>
      </abstract>
      <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
        <dm:bugtracker/>
        <dm:translation>yes</dm:translation>
      </dm:docmanager>
    </info>
    <sect1 xml:id="sec-grub2-new-features">
  <title>GRUB Legacy 与 GRUB 2 之间的主要差异</title>

  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>
     配置储存在不同的文件中。
    </para>
   </listitem>
   <listitem>
    <para>
     支持更多的文件系统（例如 Btrfs）。
    </para>
   </listitem>
   <listitem>
    <para>
     可以直接读取 LVM 或 RAID 设备上储存的文件。
    </para>
   </listitem>
   <listitem>
    <para>
     用户界面可翻译，并可以改变主题。
    </para>
   </listitem>
   <listitem>
    <para>
     包含一项用于装载模块的机制，以支持更多功能，例如文件系统等。
    </para>
   </listitem>
   <listitem>
    <para>
     自动搜索和生成其他内核与操作系统（例如 Windows）的引导项。
    </para>
   </listitem>
   <listitem>
    <para>
     包含一个类似于 Bash 的精简控制台。
    </para>
   </listitem>
  </itemizedlist>
 </sect1>
 <sect1 xml:id="sec-grub2-file-structure">
  <title>配置文件结构</title>

  <para>
   GRUB 2 的配置基于以下文件：
  </para>

  <variablelist>
   <varlistentry>
    <term><filename>/boot/grub2/grub.cfg</filename>
    </term>
    <listitem>
     <para>
      此文件包含 GRUB 2 菜单项的配置。它替代了 GRUB Legacy 中的 <filename>menu.lst</filename>。不要编辑 <filename>grub.cfg</filename> — 它是由命令 <command>grub2-mkconfig -o /boot/grub2/grub.cfg</command> 自动生成的。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><filename>/boot/grub2/custom.cfg</filename>
    </term>
    <listitem>
     <para>
      此可选文件在引导时由 <filename>grub.cfg</filename> 直接检索，可用于向引导菜单添加自定义项。从 <phrase role="productname"><phrase os="sled">SUSE Linux Enterprise Desktop</phrase></phrase> <phrase os="sles;sled">12 SP2</phrase> 开始，使用 <command>grub-once</command> 时也将分析这些项目。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><filename>/etc/default/grub</filename>
    </term>
    <listitem>
     <para>
      此文件控制 GRUB 2 的用户设置，通常包含背景和主题等其他环境设置。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><filename>/etc/grub.d/</filename> 下的脚本
    </term>
    <listitem>
     <para>
      在执行 <command>grub2-mkconfig -o /boot/grub2/grub.cfg</command> 命令期间，将读取此目录中的脚本。主配置文件 <filename>/boot/grub/grub.cfg</filename> 中集成了这些脚本的说明。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry xml:id="vle-grub2-sysconfig">
    <term><filename>/etc/sysconfig/bootloader</filename>
    </term>
    <listitem>
     <para>
      此配置文件保存一些基本设置，例如引导加载程序类型，以及是否要启用 UEFI 安全引导支持。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><filename arch="x86_64">/boot/grub2/x86_64-efi</filename>、<filename arch="power">/boot/grub2/power-ieee1275</filename>
    </term>
    <listitem>
     <para>
      这些配置文件包含特定于体系结构的选项。
     </para>
    </listitem>
   </varlistentry>
  </variablelist>

  <para>
   可以通过多种方式控制 GRUB 2。可以在图形菜单（启动屏幕）中选择现有配置的引导项。配置从文件 <filename>/boot/grub2/grub.cfg</filename> 装载，而该文件是基于其他配置文件编译的（参见下文）。所有 GRUB 2 配置文件都被视为系统文件，编辑这些配置文件需要拥有 <systemitem class="username">root</systemitem> 特权。
  </para>

  <note>
   <title>激活配置更改</title>
   <para>
    手动编辑 GRUB 2 配置文件后，需要运行 <command>grub2-mkconfig -o /boot/grub2/grub.cfg</command> 以激活更改。但使用 YaST 更改配置时就不需要如此，因为 YaST 会自动运行 此命令。
   </para>
  </note>

  <sect2 xml:id="sec-grub2-cfg">
   <title><filename>/boot/grub2/grub.cfg</filename> 文件</title>
   <para>
    带有引导菜单的图形启动屏幕内容由 GRUB 2 配置文件 <filename>/boot/grub2/grub.cfg</filename> 控制，该文件包含有关可以通过菜单引导的所有分区或操作系统的信息。
   </para>
   <para>
    系统每次引导时，GRUB 2 会直接从文件系统装载菜单文件。因此，在更改配置文件后不需要重新安装 GRUB 2。安装或去除内核后，系统会自动重构建 <filename>grub.cfg</filename>。
   </para>
   <para>
    <filename>grub.cfg</filename> 是运行 <command>grub2-mkconfig -o /boot/grub2/grub.cfg</command> 命令时，基于文件 <filename>/etc/default/grub</filename> 以及 <filename>/etc/grub.d/</filename> 目录中的脚本编译的。因此，切勿手动编辑该文件，而应该编辑相关的源文件，或者根据<xref linkend="sec-grub2-yast2-config"/>中所述，使用 YaST <guimenu>引导加载程序</guimenu>模块来修改配置。
   </para>
  </sect2>

  <sect2 xml:id="sec-grub2-etc-default-grub">
   <title><filename>/etc/default/grub</filename> 文件</title>
   <para>
    此文件包含 GRUB 2 的其他常规选项，例如，显示菜单的时间，或者要引导的默认操作系统。要列出所有可用选项，请查看以下命令的输出：
   </para>
<screen><prompt>tux &gt; </prompt>grep "export GRUB_DEFAULT" -A50 /usr/sbin/grub2-mkconfig | grep GRUB_</screen>
   <para>
    除了已定义的变量外，用户还可以引入自己的变量，以后在 <filename>/etc/grub.d</filename> 目录中的脚本内使用。
   </para>
   <para>
    编辑 <filename>/etc/default/grub</filename> 后，请使用 <command>grub2-mkconfig -o /boot/grub2/grub.cfg</command> 更新主配置文件。</para>
   <note>
    <title>范围</title>
    <remark>
     Do we really still have Xen-specific kernels? - sknorr, 2017-05-08
    </remark>
    <para>
     此文件中设置的所有选项是会影响所有引导项的常规选项。通过 GRUB_*_XEN_* 配置选项可以设置 Xen 内核或 Xen 超级管理程序的特定选项。有关细节，请参见下文。
    </para>
   </note>
   <variablelist>
    <varlistentry>
     <term><literal>GRUB_DEFAULT</literal>
     </term>
     <listitem>
      <para>
       设置默认会引导的引导菜单项。它的值可以是数字值、菜单项的完整名称或<quote>saved</quote>。
      </para>
      <para>
       <literal>GRUB_DEFAULT=2</literal> 引导第三个（从零开始计数）引导菜单项。
      </para>
      <para>
       <literal>GRUB_DEFAULT="2&gt;0"</literal> 引导第三个顶级菜单项的第一个子菜单项。
      </para>
      <para>
       <literal>GRUB_DEFAULT="Example boot menu entry"</literal> 引导标题为<quote>Example boot menu entry</quote>的菜单项。
      </para>
      <para>
       <literal>GRUB_DEFAULT=saved</literal> 引导 <command>grub2-once</command> 或 <command>grub2-set-default</command> 命令指定的项。<command>grub2-reboot</command> 只设置下一次重引导的默认引导项，而 <command>grub2-set-default</command> 设置发生更改之前的默认引导项。<command>grub2-editenv list</command> 列出下一个引导项。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>GRUB_HIDDEN_TIMEOUT</literal>
     </term>
     <listitem>
      <para>
       等待用户按某个键的指定秒数。在此期间，除非用户按下某个键，否则不显示菜单。如果用户在指定的时间内未按任何键，控制权将转交给 <literal>GRUB_TIMEOUT</literal>。<literal>GRUB_HIDDEN_TIMEOUT=0</literal> 首先会检查是否已按下 <keycap function="shift"/>，如果是，则显示引导菜单，否则会立即引导默认的菜单项。如果 GRUB 2 只识别了一个可引导操作系统，则默认行为就是如此。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>GRUB_HIDDEN_TIMEOUT_QUIET</literal>
     </term>
     <listitem>
      <para>
       如果指定 <literal>false</literal>，则在激活了 <literal>GRUB_HIDDEN_TIMEOUT</literal> 功能时，会在一个空白屏幕上显示倒数计时器。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>GRUB_TIMEOUT</literal>
     </term>
     <listitem>
      <para>
       在自动引导默认引导项之前，显示引导菜单的期限（以秒为单位）。如果按下某个键，则会取消超时，GRUB 2 将等待您手动做出选择。如果指定 <literal>GRUB_TIMEOUT=-1</literal>，则在您手动选择引导项之前，会一直显示菜单。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>GRUB_CMDLINE_LINUX</literal>
     </term>
     <listitem>
      <para>
       此行中的项将添加到正常和恢复模式的引导项的末尾。使用它可以向引导项添加内核参数。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>GRUB_CMDLINE_LINUX_DEFAULT</literal>
     </term>
     <listitem>
      <para>
       与 <literal>GRUB_CMDLINE_LINUX</literal> 一样，但只能在正常模式下追加项。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>GRUB_CMDLINE_LINUX_RECOVERY</literal>
     </term>
     <listitem>
      <para>
       与 <literal>GRUB_CMDLINE_LINUX</literal> 一样，但只能在恢复模式下追加项。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>GRUB_CMDLINE_LINUX_XEN_REPLACE</literal>
     </term>
     <listitem>
      <para>
       此项将完全替代所有 Xen 引导项的 <literal>GRUB_CMDLINE_LINUX</literal> 参数。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>GRUB_CMDLINE_LINUX_XEN_REPLACE_DEFAULT</literal>
     </term>
     <listitem>
      <para>
       与 <literal>GRUB_CMDLINE_LINUX_XEN_REPLACE</literal> 一样，但只会替代 <literal>GRUB_CMDLINE_LINUX_DEFAULT</literal> 的参数。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>GRUB_CMDLINE_XEN</literal>
     </term>
     <listitem>
      <para>
       此项只为 Xen guest 内核指定内核参数 — 工作原理与 <literal>GRUB_CMDLINE_LINUX</literal> 相同。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>GRUB_CMDLINE_XEN_DEFAULT</literal>
     </term>
     <listitem>
      <para>
       与 <literal>GRUB_CMDLINE_XEN</literal> 一样 — 工作原理与 <literal>GRUB_CMDLINE_LINUX_DEFAULT</literal> 相同。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>GRUB_TERMINAL</literal>
     </term>
     <listitem>
      <para>
       启用和指定输入/输出终端设备。可以是 <literal>console</literal>（PC BIOS 和 EFI 控制台）、<literal>serial</literal>（串行终端）、<literal>ofconsole</literal>（开放式固件控制台）或默认值 <literal>gfxterm</literal>（图形模式输出）。用引号括住所需的选项可以启用多个设备，例如 <literal>GRUB_TERMINAL="console serial"</literal>。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>GRUB_GFXMODE</literal>
     </term>
     <listitem>
      <para>
       <literal>gfxterm</literal> 图形终端使用的分辨率。请注意，您只能使用您的图形卡 (VBE) 支持的模式。默认值为“auto”，即尝试选择首选的分辨率。在 GRUB 2 命令行中键入 <command>videoinfo</command> 可以显示 GRUB 2 适用的屏幕分辨率。GRUB 2 引导菜单屏幕显示后，键入 <keycap>C</keycap> 即可访问命令行。
      </para>
      <para>
       您还可以指定颜色深度，方法是将其值追加到分辨率设置的后面，例如 <literal>GRUB_GFXMODE=1280x1024x24</literal>。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>GRUB_BACKGROUND</literal>
     </term>
     <listitem>
      <para>
       设置 <literal>gfxterm</literal> 图形终端的背景图像。该图像必须是 GRUB 2 在引导时可读的文件，并且必须以 <literal>.png</literal>、<literal>.tga</literal>、<literal>.jpg</literal> 或 <literal>.jpeg</literal> 后缀结尾。必要时，系统会缩放该图像以适合屏幕。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>GRUB_DISABLE_OS_PROBER</literal>
     </term>
     <listitem>
      <para>
       如果将此选项设置为 <literal>true</literal>，将禁用自动搜索其他操作系统的功能。系统只会检测 <filename>/boot/</filename> 中的内核映像，以及 <filename>/etc/grub.d/</filename> 中您自己的脚本内的选项。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>SUSE_BTRFS_SNAPSHOT_BOOTING</literal>
     </term>
     <listitem>
      <para>
       如果将此选项设置为 <literal>true</literal>，GRUB 2 可直接引导至 Snapper 快照。有关详细信息，请参见<xref linkend="sec-snapper-snapshot-boot"/>。
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
   <para>
    有关选项的完整列表，请参见 <link xlink:href="http://www.gnu.org/software/grub/manual/grub.html#Simple-configuration">GNU GRUB 手册</link>。
   </para>
  </sect2>

  <sect2 xml:id="sec-grub2-etc-grub-d">
   <title><filename>/etc/grub.d</filename> 中的脚本</title>
   <para>
    在执行 <command>grub2-mkconfig -o /boot/grub2/grub.cfg</command> 命令期间，将读取此目录中的脚本。脚本中的指令将整合到 <filename>/boot/grub2/grub.cfg</filename> 中。<filename>grub.cfg</filename> 中菜单项的顺序由此目录中文件的运行顺序来决定。具有前导编号的文件先执行，从最小的编号开始。<filename>00_header</filename> 在 <filename>10_linux</filename> 之前运行，而后者又在 <filename>40_custom</filename> 之前运行。如果存在采用字母名称的文件，这些文件将在采用编号命名的文件后面执行。在执行 <command>grub2-mkconfig</command> 期间，只有可执行文件才能在 <filename>grub.cfg</filename> 中生成输出。默认情况下，<filename>/etc/grub.d</filename> 目录中的所有文件都是可执行文件。
   </para>
   <tip>
    <title>将自定义内容永久保存在 <filename>grub.cfg</filename> 中</title>
    <para>
     由于每次运行 <command>grub2-mkconfig</command> 时都会重新编译 <filename>/boot/grub2/grub.cfg</filename>，因此所有自定义内容都会丢失。如果要将您的行直接插入到 <filename>/boot/grub2/grub.cfg</filename> 中，并且希望在运行 <command>grub2-mkconfig</command> 之后它们不会丢失，请将这些行插入到下面两行之间
    </para>
    <screen>### BEGIN /etc/grub.d/90_persistent ###</screen>
    <para>
     和
    </para>
    <screen>### END /etc/grub.d/90_persistent ###</screen>
    <para>
     <filename>90_persistent</filename> 脚本可确保此类内容会保留下来。
    </para>
    <para>
     下面列出了最重要的脚本：
    </para>
   </tip>
   <variablelist>
    <varlistentry>
     <term><filename>00_header</filename>
     </term>
     <listitem>
      <para>
       设置环境变量，例如系统文件位置、显示设置、主题和以前保存的项。它还可以导入 <filename>/etc/default/grub</filename> 中储存的首选项。通常，不需要对此文件进行更改。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><filename>10_linux</filename>
     </term>
     <listitem>
      <para>
       识别根设备上的 Linux 内核，并创建相关的菜单项。这包括关联的恢复模式选项（如果已启用）。主菜单页中只显示最新内核，其他内核包含在子菜单中。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><filename>30_os-prober</filename>
     </term>
     <listitem>
      <para>
       此脚本使用 <command>os-prober</command> 来搜索 Linux 和其他操作系统，并将结果列于 GRUB 2 菜单中。其中的某些部分可以识别其他特定操作系统，例如 Windows 或 macOS。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><filename>40_custom</filename>
     </term>
     <listitem>
      <para>
       使用此文件可以方便地在 <filename>grub.cfg</filename> 中包含自定义引导项。切勿更改开头的 <literal>exec tail -n +3 $0</literal> 部分。
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
   <para>
    处理顺序根据前导编号确定，编号最小的脚本最先执行。如果多个脚本的前导编号相同，则根据整个名称的字母顺序来决定执行顺序。
   </para>
   <tip>
    <title><filename>/boot/grub2/custom.cfg</filename></title>
    <para>
     如果您创建了 <filename>/boot/grub2/custom.cfg</filename> 并在其中填充了内容，则引导时系统会自动将它包含到 <filename>/boot/grub40/grub.cfg</filename> 中紧接在 40_custom 后面的位置。
    </para>
   </tip>
  </sect2>

  <sect2 xml:id="sec-grub2-map">
   <title>BIOS 驱动器与 Linux 设备之间的映射</title>
   <para>
    在 GRUB Legacy 中，<filename>device.map</filename> 配置文件用于基于 BIOS 驱动器号派生 Linux 设备名称。不一定总能正确猜测出 BIOS 驱动器与 Linux 设备之间的映射。例如，如果 IDE 和 SCSI 驱动器的引导顺序在 BIOS 配置中被交换，则 GRUB Legacy 就会发生顺序错误。
   </para>
   <para>
    GRUB 2 在生成 <filename>grub.cfg</filename> 时使用设备 ID 字符串 (UUID) 或文件系统标签，因此避免了此问题。GRUB 2 实用程序会即时创建一个临时设备映射，这通常足以满足需要，在单磁盘系统中尤其如此。
   </para>
   <para>
    但是，如果您需要覆盖 GRUB 2 的自动设备映射机制，请创建自定义映射文件 <filename>/boot/grub2/device.map</filename>。以下示例将更改映射，使 <literal>DISK 3</literal> 成为引导磁盘。请注意，GRUB 2 分区编号以 <literal>1</literal> 开始，而不是像 GRUB Legacy 中那样以 <literal>0</literal> 开始。
   </para>
<screen>(hd1)  /dev/disk-by-id/<replaceable>DISK3 ID</replaceable>
(hd2)  /dev/disk-by-id/<replaceable>DISK1 ID</replaceable>
(hd3)  /dev/disk-by-id/<replaceable>DISK2 ID</replaceable></screen>
  </sect2>

  <sect2 xml:id="sec-grub2-menu-change">
   <title>在引导过程中编辑菜单项</title>
   <para>
    当系统由于配置错误而不再能够引导时，如果能够直接编辑菜单项，就会很有帮助。使用菜单编辑器还可以在不更改系统配置的情况下测试新设置。
   </para>
   <procedure>
    <step>
     <para>
      在图形引导菜单中，使用方向键选择要编辑的项。
     </para>
    </step>
    <step>
     <para>
      按 <keycap>E</keycap> 打开基于文本的编辑器。
     </para>
    </step>
    <step>
     <para>
      使用方向键移到您要编辑的行。
     </para>
     <figure xml:id="fig-grub2-boot-editor">
      <title>GRUB 2 引导编辑器</title>
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="grub2_edit_config.png" width="75%" format="PNG"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="grub2_edit_config.png" width="75%" format="PNG"/>
       </imageobject>
      </mediaobject>
     </figure>
     <para>
      现在，您可以采取以下两种做法：
     </para>
     <substeps performance="required">
      <step>
       <para>
        将用空格分隔的参数添加到以 <literal>linux</literal> 或 <literal>linuxefi</literal> 开头的行的末尾，以编辑内核参数。<link xlink:href="https://en.opensuse.org/Linuxrc"/> 上提供了完整的参数列表。
       </para>
      </step>
      <step>
       <para>
        或者编辑常规选项，以更改内核版本等。按 <keycap function="tab"/> 键会显示所有可能的补全建议。
       </para>
      </step>
     </substeps>
    </step>
    <step>
     <para>
      按 <keycap>F10</keycap> 使用您所做的更改引导系统，或者按 <keycap function="escape"/> 放弃您的编辑，并返回到 GRUB 2 菜单。
     </para>
    </step>
   </procedure>
   <para>
    通过这种方式进行的更改仅会应用到当前引导过程，而不会永久保存。
   </para>
   <important>
    <title>引导过程中的键盘布局</title>
    <para>
     US 键盘布局是引导时唯一可用的键盘布局。请参见<xref linkend="fig-trouble-install-keyboard-us"/>。
    </para>
   </important>
   <note arch="x86_64">
    <title>安装媒体中的引导加载程序</title>
    <para>
     在使用传统 BIOS 的系统上，安装媒体中的引导加载程序仍是 GRUB Legacy。要添加引导参数，请选择一项，然后开始键入。在安装引导项中添加的选项将永久保存在安装的系统中。
    </para>
   </note>
   
  </sect2>

  <sect2 xml:id="sec-grub2-password">
   <title>设置引导口令</title>
   <para>
    即使在操作系统引导之前，GRUB 2 也支持对文件系统的访问。没有 root 权限的用户可以访问 Linux 系统中的文件，而在引导系统后，他们将无权访问这些文件。要阻止此类访问或防止用户引导某些菜单项，请设置引导口令。
   </para>
   <important>
    <title>引导需要口令</title>
    <para>
     如果设置了引导口令，则每次引导时都需要输入该口令，这意味着系统不会自动引导。
    </para>
   </important>
   <para>
    按如下步骤设置引导口令。或者使用 YaST（<xref linkend="vle-grub2-yast2-boot-password"/>）。
   </para>
   <procedure>
    <step>
     <para>
      使用 <command>grub2-mkpasswd-pbkdf2</command> 来加密口令：
     </para>
<screen><prompt>tux &gt; </prompt><command>sudo</command> grub2-mkpasswd-pbkdf2
Password: ****
Reenter password: ****
PBKDF2 hash of your password is grub.pbkdf2.sha512.10000.9CA4611006FE96BC77A...
</screen>
    </step>
    <step>
     <para>
      将生成的字符串连同 <command>set superusers</command> 命令一起粘贴到文件 <filename>/etc/grub.d/40_custom</filename> 中。
     </para>
<screen>set superusers="root"
password_pbkdf2 root grub.pbkdf2.sha512.10000.9CA4611006FE96BC77A...</screen>
    </step>
    <step>
     <para>
      要将更改导入到主要配置文件中，请运行：
     </para>
     <screen><prompt>tux &gt; </prompt><command>sudo</command> grub2-mkconfig -o /boot/grub2/grub.cfg</screen>
    </step>
   </procedure>
   <para>
    在重引导后，当您尝试引导某个菜单项时，系统会提示您输入用户名和口令。输入 <literal>root</literal> 以及您在执行 <command>grub2-mkpasswd-pbkdf2</command> 命令期间键入的口令。如果身份凭证正确，系统将引导选定的引导项。
   </para>
   <para>
    有关详细信息，请参见<link xlink:href="https://www.gnu.org/software/grub/manual/grub.html#Security"/>。
   </para>
  </sect2>
 </sect1>
 <xi:include href="grub2_yast_i.xml"/>
 
 <sect1 xml:id="sec-grub2-commands">
  <title>有用的 GRUB 2 命令</title>

  <variablelist>
   <varlistentry xml:id="vle-grub2-mkconfig">
    <term><command>grub2-mkconfig</command>
    </term>
    <listitem>
     <para>
      基于 <filename>/etc/default/grub</filename> 以及 <filename>/etc/grub.d/</filename> 中的脚本生成新的 <filename>/boot/grub2/grub.cfg</filename>。
     </para>
     <example>
      <title>grub2-mkconfig 用法</title>
<screen>grub2-mkconfig -o /boot/grub2/grub.cfg</screen>
     </example>
     <tip>
      <title>语法检查</title>
      <para>
       运行不带任何参数的 <command>grub2-mkconfig</command> 会将配置打印到 STDOUT 中供用户查看。在写入 <filename>/boot/grub2/grub.cfg</filename> 后使用 <xref linkend="vle-grub2-script-check"/> 可以检查其语法。
      </para>
     </tip>
     <important>
      <title><command>grub2-mkconfig</command> 无法修复 UEFI 安全引导表</title>
      <para>
       如果您使用的是 UEFI 安全引导，而您的系统无法再正常连接 GRUB 2，您可能需要另外重新安装 Shim 并重新生成 UEFI 引导表。要执行此操作，请使用：
      </para>
<screen><prompt role="root">root # </prompt>shim-install --config-file=/boot/grub2/grub.cfg</screen>
     </important>
    </listitem>
   </varlistentry>
   <varlistentry xml:id="vle-grub2-mkrescue">
    <term><command>grub2-mkrescue</command></term>
    <listitem>
     <para>
      为安装的 GRUB 2 配置创建一个可引导的救援映像。
     </para>
     <example>
      <title>grub2-mkrescue 用法</title>
<screen>grub2-mkrescue -o save_path/name.iso iso</screen>
     </example>
    </listitem>
   </varlistentry>
   <varlistentry xml:id="vle-grub2-script-check">
    <term><command>grub2-script-check</command>
    </term>
    <listitem>
     <para>
      检查给定文件中有无语法错误。
     </para>
     <example>
      <title>grub2-script-check 用法</title>
<screen>grub2-script-check /boot/grub2/grub.cfg</screen>
     </example>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><command>grub2-once</command>
    </term>
    <listitem>
     <para>
      仅设置下次引导的默认引导项。要获取可用引导项的列表，请使用 <option>--list</option> 选项。
     </para>
     <example>
      <title>grub2-once 用法</title>
<screen>grub2-once number_of_the_boot_entry</screen>
     </example>
     <tip>
      <title><command>grub2-once</command> 帮助</title>
      <para>
       不使用任何选项调用该程序可以获取所有可用选项的完整列表。
      </para>
     </tip>
    </listitem>
   </varlistentry>
  </variablelist>
 </sect1>
 <sect1 xml:id="sec-grub2-info">
  <title>更多信息</title>

  <para>
   <link xlink:href="https://www.gnu.org/software/grub/"/> 上提供了有关 GRUB 2 的大量信息。还请参见 <command>grub</command> 信息页面。<phrase os="sles;sled">您也可以在技术信息搜索 (<quote>) 中搜索关键字</quote>GRUB 2<link xlink:href="https://www.suse.com/support"/>，以获取有关特殊问题的信息。</phrase>
  </para>
 </sect1>
</chapter>
