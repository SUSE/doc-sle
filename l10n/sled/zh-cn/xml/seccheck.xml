<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="seccheck.xml" version="5.0" role="General" xml:id="sec-sec-prot-general-seccheck"> <title>使用 seccheck 进行自动安全检查</title>
 <info>
      <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
        <dm:bugtracker/>
        <dm:translation>yes</dm:translation>
      </dm:docmanager>
    </info>
    <para>
    <command>seccheck</command> SUSE 安全检查器是一组外壳脚本，旨在定期自动检查系统的本地安全，并通过电子邮件向 root 用户或管理员配置的任何用户发送报告。 
   </para>
   <para>
    如果系统上未安装 <package>seccheck</package>，请使用 <command>sudo zypper in seccheck</command> 进行安装。这些脚本由 <systemitem class="daemon">systemd</systemitem> 计时器进行控制，该计时器默认未启用，必须由管理员进行启用。
   </para>
   
    <sect1 xml:id="sec-seccheck-timers">
     <title>Seccheck 计时器</title>
   <para>
        有以下四种 <command>seccheck</command> 计时器：
    </para>
    <itemizedlist>
        <listitem>
            <para>
                /usr/lib/systemd/system/seccheck-daily.timer
            </para>
        </listitem>
         <listitem>
            <para>
                /usr/lib/systemd/system/seccheck-monthly.timer
            </para>
        </listitem>
         <listitem>
            <para>
                /usr/lib/systemd/system/seccheck-weekly.timer
            </para>
        </listitem>
         <listitem>
            <para>
                /usr/lib/systemd/system/seccheck-autologout.timer
            </para>
        </listitem>
    </itemizedlist>
    <para>
       <literal>seccheck-daily.timer</literal>、<literal>seccheck-monthly.timer</literal> 和 <literal>seccheck-weekly.timer</literal> 运行多项检查，如<xref linkend="sec-sec-prot-general-seccheck-config"/>中所述。<literal>seccheck-autologout.timer</literal> 可注销非活动用户，请参见<xref linkend="sec-sec-prot-general-seccheck-autologout"/>。
   </para>
   <para> 
      您可以将 seccheck 邮件的收件人由 root 更改为 <filename>/etc/sysconfig/seccheck</filename> 中的任何用户。以下示例将其更改为名为 <literal>firewall</literal> 的管理员用户：
    </para>
    <screen>SECCHK_USER="firewall"</screen> 
</sect1>    
   <sect1 xml:id="sec-sec-prot-general-seccheck-enable">
       <title>启用 seccheck 计时器</title>
   <para>
       使用 <command>systemctl</command> 管理您的计时器，如同任何其他 systemd 计时器一样。以下示例启用并启动 <literal>seccheck-daily.timer</literal>：
   </para>
   <screen><prompt>tux &gt; </prompt><command>sudo</command> systemctl enable --now seccheck-daily.timer
   </screen>
   <para>
       列出所有活动计时器：
   </para>
   <screen><prompt>tux &gt; </prompt><command>sudo</command> systemctl list-timers</screen>
   <para>
       列出所有已启用的活动和非活动计时器：
   </para>
   <screen><prompt>tux &gt; </prompt><command>sudo</command> systemctl list-timers --all</screen>
   </sect1>
   <sect1 xml:id="sec-sec-prot-general-seccheck-config">
    <title>每日、每周和每月检查</title>
    <para>
     <command>seccheck</command> 执行下列每日检查：
    </para>
    <informaltable>
     <tgroup cols="2">
      <colspec colname="c1"/>
      <colspec colname="c2"/>
      <tbody>
       <row>
        <entry>
         <para>
          <filename>/etc/passwd</filename> 检查
         </para>
        </entry>
        <entry>
         <para>
          字段的长度/数量/内容，具有相同 UID 的帐户，UID/GID 为 0 或 1 的帐户（root 和 bin 除外）
         </para>
        </entry>
       </row>
       <row>
        <entry>
         <para>
          <filename>/etc/shadow</filename> 检查
         </para>
        </entry>
        <entry>
         <para>
          字段的长度/数量/内容，没有口令的帐户
         </para>
        </entry>
       </row>
       <row>
        <entry>
         <para>
          <filename>/etc/group</filename> 检查
         </para>
        </entry>
        <entry>
         <para>
          字段的长度/数量/内容
         </para>
        </entry>
       </row>
       <row>
        <entry>
         <para>
          用户 root 检查
         </para>
        </entry>
        <entry>
         <para>
          安全 umask 和 <envar>PATH</envar>
         </para>
        </entry>
       </row>
       <row>
        <entry>
         <para>
          <filename>/etc/ftpusers</filename>
         </para>
        </entry>
        <entry>
         <para>
          检查是否将重要的系统用户置于此处
         </para>
        </entry>
       </row>
       <row>
        <entry>
         <para>
          <filename>/etc/aliases</filename>
         </para>
        </entry>
        <entry>
         <para>
          检查执行程序的邮件别名
         </para>
        </entry>
       </row>
       <row> 
        <entry>
         <para>
          <filename>.rhosts</filename> 检查
         </para>
        </entry>
        <entry>
         <para>
          检查用户的 <filename>.rhosts</filename> 文件是否包含 <literal>+</literal> 符号
         </para>
        </entry>
       </row>
       <row>
        <entry>
         <para>
          用户主目录
         </para>
        </entry>
        <entry>
         <para>
          检查主目录是否可写入或被其他用户拥有
         </para>
        </entry>
       </row>
       <row>
        <entry>
         <para>
          点文件检查
         </para>
        </entry>
        <entry>
         <para>
          检查主目录中的众多点文件是否具有正确的所有权和权限
         </para>
        </entry>
       </row>
       <row>
        <entry>
         <para>
          邮箱检查
         </para>
        </entry>
        <entry>
         <para>
          检查用户邮箱是否由正确的用户拥有，以及是否可读
         </para>
        </entry>
       </row>
       <row>
        <entry>
         <para>
          NFS 导出检查
         </para>
        </entry>
        <entry>
         <para>
          不应进行全局导出
         </para>
        </entry>
       </row>
       <row>
        <entry>
         <para>
          NFS 导入检查
         </para>
        </entry>
        <entry>
         <para>
          NFS 装入应设置 <option>nosuid</option> 选项
         </para>
        </entry>
       </row>
       <row>
        <entry>
         <para>
          混杂检查
         </para>
        </entry>
        <entry>
         <para>
          检查网卡是否处于混杂模式
         </para>
        </entry>
       </row>
       <row>
        <entry>
         <para>
          列表模块
         </para>
        </entry>
        <entry>
         <para>
          列出装载的模块
         </para>
        </entry>
       </row>
       <row>
        <entry>
         <para>
          列表套接字
         </para>
        </entry>
        <entry>
         <para>
          列出打开的端口
         </para>
        </entry>
       </row>
      </tbody>
     </tgroup>
    </informaltable>
       
    <para>
       下表列出了每周检查：
   </para>
   
    <informaltable>
     <tgroup cols="2">
      <colspec colname="c1"/>
      <colspec colname="c2"/>
      <tbody>
 
       <row>
        <entry>
         <para>
          口令检查
         </para>
        </entry>
        <entry>
         <para>
          运行 <command>john</command> 以破解口令文件；用户将收到更改其口令的电子邮件通知
         </para>
        </entry>
       </row>
       <row>
        <entry>
         <para>
          RPM md5 检查
         </para>
        </entry>
        <entry>
         <para>
          通过 RPM 的 MD5 校验和功能检查已更改文件
         </para>
        </entry>
       </row>
       <row>
        <entry>
         <para>
          suid/sgid 检查
         </para>
        </entry>
        <entry>
         <para>
          列出所有 suid 和 sgid 文件
         </para>
        </entry>
       </row>
       <row>
        <entry>
         <para>
          可执行文件组写入
         </para>
        </entry>
        <entry>
         <para>
          列出组可写/全局可写的所有可执行文件
         </para>
        </entry>
       </row>
       <row>
        <entry>
         <para>
          可写入检查
         </para>
        </entry>
        <entry>
         <para>
          列出全局可写的所有文件（包括可执行文件）
         </para>
        </entry>
       </row>
       <row>
        <entry>
         <para>
          设备检查
         </para>
        </entry>
        <entry>
         <para>
          列出所有设备
         </para>
        </entry>
       </row>
      </tbody>
     </tgroup>
    </informaltable>

    <important>
     <title>使用 <command>john</command> 审计口令</title>
     <para>
      要启用口令审计，需要先安装软件包 <package>john</package>，即 John the Ripper 口令快速破解程序。该软件包可从 <link xlink:href="https://build.opensuse.org/package/show/security/john"/> 上的 openSUSE Build Service 获取。
     </para>
    </important>
    
    <para>
     每月检查会列显一份完整的报告，每日检查和每周检查的列显内容则不相同。
    </para>
   </sect1>

   <sect1 xml:id="sec-sec-prot-general-seccheck-autologout">
    <title>自动注销</title>
    <para>
     <systemitem>seccheck-autologout.timer</systemitem> 计时器每隔 10 分钟运行一次，检查远程和本地终端会话是否处于非活动状态，并在超过空闲时间后终止会话。
    </para>
    <para>
     在 <filename>/etc/security/autologout.conf</filename> 文件中配置您需要的超时。参数包括默认的空闲和注销延迟时间，以及限制特定于用户、组、TTY 设备和 SSH 会话的最大空闲时间的配置。<filename>/etc/security/autologout.conf</filename> 包含多个配置示例。
    </para>
   </sect1>
</chapter>
