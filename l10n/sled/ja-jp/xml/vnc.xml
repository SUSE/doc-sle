<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="vnc.xml" version="5.0" xml:id="cha-vnc">
 <title>VNCによるリモートアクセス</title>
 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:bugtracker/>
   <dm:translation>yes</dm:translation>
  </dm:docmanager>
  <abstract>
   <para>
    VNC (Virtual Network Computing)では、グラフィカルなデスクトップを使用してリモートコンピュータを制御できます。これは、リモートシェルアクセスとは対照的です。VNCはプラットフォームに依存しないので、VNCを使用すれば、任意のオペレーティングシステムからリモートマシンにアクセスできます。
   </para>

   <para>
    <phrase role="productname"><phrase os="sled">SUSE Linux Enterprise Desktop</phrase></phrase>では、2種類のVNCセッションをサポートしています。1つはクライアントからのVNC接続が続く限り、<quote>存続する</quote>一時的セッションで、もう1つは明示的に終了されるまで<quote>存続する</quote>永続的セッションです。
   </para>
  </abstract>
 </info>
 <note>
  <title>セッションタイプ</title>
  <para>
   両方のタイプのセッションを1つのコンピュータの異なるポートから同時に提供ができます。ただし、オープンセッションを1つのタイプからもう一方のタイプに変換することはできません。
  </para>
 </note>
 
 <sect1 xml:id="sec-vnc-viewer">
  <title><command>vncviewer</command>クライアント</title>

  <para>
   サーバによって提供されるVNCサービスに接続するには、クライアントが必要です。<phrase role="productname"><phrase os="sled">SUSE Linux Enterprise Desktop</phrase></phrase>のデフォルトは<command>vncviewer</command>で、これは<systemitem class="resource">tigervnc</systemitem>パッケージで提供されます。
  </para>

  <sect2 xml:id="sec-vnc-viewer-connectcli">
   <title>vncviewer CLIを使用した接続</title>
   <para>
    VNCビューアを起動し、サーバとのセッションを開始するには、次のコマンドを使用します。
   </para>
<screen><prompt>tux &gt; </prompt>vncviewer jupiter.example.com:1</screen>
   <para>
    VNCディスプレイ番号の代わりに、2つのコロンを使用してポート番号を指定することもできます。
   </para>
<screen><prompt>tux &gt; </prompt>vncviewer jupiter.example.com::5901</screen>
   <note>
    <title>ディスプレイ番号とポート番号</title>
    <para>
     VNCクライアントで実際に指定するディスプレイ番号またはポート番号は、ターゲットマシンで<command>vncserver</command>によって選択されるディスプレイ番号またはポート番号と同じである必要があります。詳細については、<xref linkend="sec-vnc-persistent"/>を参照してください。
    </para>
   </note>
  </sect2>

  <sect2 xml:id="sec-vnc-viewer-connectgui">
   <title>vncviewer GUIを使用した接続</title>
   <para>
    <command>--listen</command>または接続先ホストを指定せずに<command>vncviewer</command>を実行すると、接続の詳細を入力するよう求めるウィンドウが表示されます。<xref linkend="sec-vnc-viewer-connectcli"/>のように<guimenu>VNC server (VNCサーバ)</guimenu>フィールドにホストを入力し、<guimenu>接続</guimenu>をクリックします。
   </para>
   <figure xml:id="fig-vnc-viewer-connectgui">
    <title>vncviewer</title>
    <mediaobject>
     <textobject role="description"><phrase>vncviewerにより接続の詳細を入力するよう求められる</phrase>
     </textobject>
     <imageobject role="html">
      <imagedata fileref="vnc_connect.png" format="PNG"/>
     </imageobject>
     <imageobject role="fo">
      <imagedata fileref="vnc_connect.png" format="PNG"/>
     </imageobject>
    </mediaobject>
   </figure>
  </sect2>

  <sect2 xml:id="sec-vnc-viewer-encrypt">
   <title>暗号化されていない接続の通知</title>
   <para>
    VNCプロトコルは、さまざまな種類の暗号化接続をサポートしています。これをパスワード認証と混同しないでください。接続がTLSを使用していない場合、<quote>(Connection not encrypted!) (接続が暗号化されていません!)</quote>というテキストがVNCビューアのウィンドウタイトルに表示されることがあります。
   </para>
  </sect2>
 </sect1>
 <sect1 xml:id="vnc-remmina">
  <title>Remmina: リモートデスクトップクライアント</title>

  <para>
   Remminaは、最新の機能豊富なリモートデスクトップクライアントです。VNC、SSH、RDP、Spiceなど、複数のアクセス方法をサポートしています。
  </para>

  <sect2 xml:id="vnc-remmina-install">
   <title>インストール</title>
   <para>
    Remminaを使用するには、 <package>remmina</package> パッケージがシステムにインストールされているかどうかを確認し、インストールされていない場合はインストールします。Remmina用のVNCプラグインもインストールすることを忘れないでください。
   </para>
<screen>
<prompt role="root">root # </prompt>zypper in remmina remmina-plugin-vnc
</screen>
  </sect2>

  <sect2 xml:id="vnc-remmina-usage">
   <title>メインウィンドウ</title>
   <para>
    <command>remmina</command>コマンドを入力してRemminaを実行します。
   </para>
   <figure>
    <title>Remminaのメインウィンドウ</title>
    <mediaobject>
     <imageobject role="fo">
      <imagedata fileref="remmina.png" width="50%" format="PNG"/>
     </imageobject>
     <imageobject role="html">
      <imagedata fileref="remmina.png" width="50%" format="PNG"/>
     </imageobject>
    </mediaobject>
   </figure>
   <para>
    メインアプリケーションウィンドウには、保存されているリモートセッションのリストが表示されます。ここでは、新しいリモートセッションを追加および保存したり、保存せずに新しいセッションをクイックスタートしたり、以前に保存したセッションを開始したり、Remminaのグローバル設定を行うことができます。
   </para>
  </sect2>

  <sect2 xml:id="vnc-remmina-addnew">
   <title>リモートセッションの追加</title>
   <para>
    新しいリモートセッションを追加して保存するには、メインウィンドウの左上にある<inlinemediaobject><textobject role="description"><phrase>Add new session (新しいセッションの追加)</phrase></textobject><imageobject role="fo"><imagedata fileref="remmina_plus.png" width="1.2em" format="PNG"/></imageobject><imageobject role="html"><imagedata fileref="remmina_plus.png" width="1.2em" format="PNG"/></imageobject></inlinemediaobject>をクリックします。<guimenu>リモートデスクトップ初期設定</guimenu>ウィンドウが開きます。
   </para>
   <figure>
    <title>リモートデスクトップ初期設定</title>
    <mediaobject>
     <imageobject role="fo">
      <imagedata fileref="remmina_session_details.png" width="80%" format="PNG"/>
     </imageobject>
     <imageobject role="html">
      <imagedata fileref="remmina_session_details.png" width="80%" format="PNG"/>
     </imageobject>
    </mediaobject>
   </figure>
   <para>
    新しく追加したリモートセッションプロファイルを指定するフィールドに入力します。最も重要な設定には次のものがあります。
   </para>
   <variablelist>
    <varlistentry>
     <term>名前</term>
     <listitem>
      <para>
       プロファイルの名前。この名前は、メインウィンドウにリストされます。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>プロトコル</term>
     <listitem>
      <para>
       リモートセッションに接続するときに使用するプロトコル(VNCなど)。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>サーバ</term>
     <listitem>
      <para>
       リモートサーバのIPアドレスまたはDNSアドレスとディスプレイ番号。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>ユーザ名、パスワード</term>
     <listitem>
      <para>
       リモート認証に使用する資格情報。認証しない場合は空のままにします。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>色数、品質</term>
     <listitem>
      <para>
       接続速度と品質に応じて最適なオプションを選択します。
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
   <para>
    より詳細な設定を入力するには、<guimenu>詳細</guimenu>タブを選択します。
   </para>
   <tip>
    <title>暗号の無効化</title>
    <para>
     クライアントとリモートサーバ間の通信が暗号化されていない場合は、<guimenu>Disable encryption (暗号の無効化)</guimenu>を有効にします。そうしないと接続が失敗します。
    </para>
   </tip>
   <para>
    高度なSSHトンネリングと認証オプションについては、<guimenu>SSH</guimenu>タブを選択してください。
   </para>
   <para>
    ［保存］<guimenu>をクリックして確定します。</guimenu>新しいプロファイルがメインウィンドウに表示されます。
   </para>
  </sect2>

  <sect2 xml:id="vnc-remmina-start">
   <title>リモートセッションの開始</title>
   <para>
    以前に保存したセッションを開始するか、または接続の詳細を保存せずにリモートセッションをクイックスタートすることができます。
   </para>
   <sect3 xml:id="vnc-remmina-quickstart">
    <title>リモートセッションのクイックスタート</title>
    <para>
     接続の詳細を追加および保存することなく、リモートセッションをすばやく開始するには、メインウィンドウの上部にあるドロップダウンボックスとテキストボックスを使用します。
    </para>
    <figure>
     <title>クイックスタート</title>
     <mediaobject>
      <imageobject role="fo">
       <imagedata fileref="remmina_quickstart.png" width="40%" format="PNG"/>
      </imageobject>
      <imageobject role="html">
       <imagedata fileref="remmina_quickstart.png" width="40%" format="PNG"/>
      </imageobject>
     </mediaobject>
    </figure>
    <para>
     ドロップダウンボックスから通信プロトコル(「VNC」など)を選択して、次にVNCサーバのDNSまたはIPアドレスを入力し、それに続けてコロンとディスプレイ番号を入力して、<keycap function="enter"/>で確定します。
    </para>
   </sect3>
   <sect3>
    <title>保存されたリモートセッションを開く</title>
    <para>
     特定のリモートセッションを開くには、セッションのリストからダブルクリックします。
    </para>
   </sect3>
   <sect3>
    <title>リモートセッションウィンドウ</title>
    <para>
     リモートセッションは別のウィンドウのタブで開きます。タブごとに1つのセッションをホストします。ウィンドウの左側にあるツールバーは、ウィンドウ/セッションの管理(フルスクリーンモードの切り替え、セッションの表示サイズに合わせたウィンドウのサイズ変更、セッションへの特定のキーストロークの送信、セッションのスクリーンショット撮影、画質の設定など)に役立ちます。
    </para>
    <figure>
     <title>RemminaのSLES <phrase role="productnumber"><phrase os="sles;sled">15 SP1</phrase></phrase>リモートセッションの表示</title>
     <mediaobject>
      <imageobject role="fo">
       <imagedata fileref="remmina_sle15inside.png" width="80%" format="PNG"/>
      </imageobject>
      <imageobject role="html">
       <imagedata fileref="remmina_sle15inside.png" width="80%" format="PNG"/>
      </imageobject>
     </mediaobject>
    </figure>
   </sect3>
  </sect2>

  <sect2 xml:id="vnc-remmina-edit-delete-clone">
   <title>保存されたセッションの編集、コピー、および削除</title>
   <para>
    保存されたリモートセッションを<emphasis>編集</emphasis>するには、Remminaのメインウィンドウでその名前を右クリックし、<guimenu>編集</guimenu>を選択します。関連するフィールドの説明については、<xref linkend="vnc-remmina-addnew"/>を参照してください。
   </para>
   <para>
    保存されたリモートセッションを<emphasis>コピー</emphasis>するには、Remminaのメインウィンドウでその名前を右クリックし、<guimenu>コピー</guimenu>を選択します。<guimenu>リモートデスクトップ初期設定</guimenu>ウィンドウで、プロファイルの名前を変更し、関連するオプションを必要なら調整し、<guimenu>保存</guimenu>をクリックして確定します。
   </para>
   <para>
    保存されたリモートセッションを<emphasis>削除</emphasis>するには、Remminaのメインウィンドウでその名前を右クリックし、<guimenu>削除</guimenu>を選択します。次のダイアログで<guimenu>はい</guimenu>をクリックして確定します。
   </para>
  </sect2>

  <sect2 xml:id="vnc-remmina-cmdline">
   <title>コマンドラインからのリモートセッションの実行</title>
   <para>
    最初にメインのアプリケーションウィンドウを開くことなく、コマンドラインまたはバッチファイルからリモートセッションを開く必要がある場合は、次の構文を使用します。
   </para>
<screen>
 <prompt>tux &gt; </prompt>remmina -c <replaceable>profile_name</replaceable>.remmina
</screen>
   <para>
    Remminaのプロファイルファイルは、ホームディレクトリの<filename>.local/share/remmina/</filename>ディレクトリに保存されます。開きたいセッションに属しているプロファイルファイルを決定するには、Remminaを実行し、メインウィンドウでセッション名をクリックし、下部のウィンドウのステータス行でプロファイルファイルへのパスを読み込みます。
   </para>
   <figure>
    <title>プロファイルファイルへのパスの読み込み</title>
    <mediaobject>
     <imageobject role="fo">
      <imagedata fileref="remmina_status.png" width="50%" format="PNG"/>
     </imageobject>
     <imageobject role="html">
      <imagedata fileref="remmina_status.png" width="50%" format="PNG"/>
     </imageobject>
    </mediaobject>
   </figure>
   <para>
    Remminaが実行されていないときに、プロファイルファイルの名前を<filename>sle15.remmina</filename>などのより合理的なファイル名に変更することができます。プロファイルファイルをカスタムディレクトリにコピーして、そこから<command>remmina -c</command>コマンドを使用して実行することもできます。
   </para>
  </sect2>
 </sect1>
 <sect1 xml:id="sec-vnc-one-time">
  <title>一時的VNCセッション</title>

  <para>
   一時的セッションは、リモートクライアントによって開始されます。これにより、サーバにグラフィカルなログイン画面が開きます。この画面でセッションを開始するユーザを選択できます。さらに、ログインマネージャでサポートされている場合はデスクトップ環境も選択できます。そのようなVNCセッションへのクライアント接続を終了すると、そのセッション内で開始したアプリケーションもすべて終了します。一時的なVNCセッションは共用できませんが、1つのホストで同時に複数のセッションを実行することは可能です。
  </para>

  <procedure xml:id="pro-vnc-one-time-activate">
   <title>一時的VNCセッションの有効化</title>
   <step>
    <para>
     まず、<menuchoice> <guimenu>YaST</guimenu> <guimenu>ネットワークサービス</guimenu> <guimenu>リモート管理(VNC)</guimenu>
     </menuchoice>の順に選択します。
    </para>
   </step>
   <step>
    <para>
     <guimenu>セッション管理機能無しのリモート管理を許可する</guimenu>をオンにします。
    </para>
   </step>
   <step>
    <para>
     WebブラウザウィンドウでVNCセッションにアクセスする場合は、<guimenu>Web ブラウザを利用したアクセスを有効にする</guimenu>をアクティブにします。
    </para>
   </step>
   <step>
    <para>
     必要な場合は、<guimenu>ファイアウォールでポートを開く</guimenu>にもチェックマークを付けます (たとえば、ネットワークインタフェースを外部ゾーンに属するように設定する場合)。ネットワークインタフェースが複数ある場合は、<guimenu>ファイアウォールの詳細</guimenu>で、特定のインタフェースにだけファイアウォールポートを開くように制限します。
    </para>
   </step>
   <step>
    <para>
     <guimenu>次へ</guimenu>をクリックすると設定が確定し、
    </para>
   </step>
   <step>
    <para>
     必要なパッケージの一部をまだ入手できない場合は、足りないパッケージのインストールを承認する必要があります。
    </para>
    <tip>
     <title>ディスプレイマネージャの再起動</title>
     <para>
      YaSTはディスプレイマネージャの設定を変更します。現在のグラフィカルセッションからログアウトし、ディスプレイマネージャを再起動して変更を有効にする必要があります。
     </para>
    </tip>
   </step>
  </procedure>

  <figure>
   <title>リモート管理</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="vnc_nosession.png" width="70%" format="PNG"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="vnc_nosession.png" width="70%" format="PNG"/>
    </imageobject>
   </mediaobject>
  </figure>

  <sect2 xml:id="sec-vnc-one-time-configs">
   <title>使用可能な設定</title>
   <para>
    <phrase role="productname"><phrase os="sled">SUSE Linux Enterprise Desktop</phrase></phrase>のデフォルト設定では、1024x768ピクセルの解像度と16ビットの色数でセッションが提供されます。セッションで使用できるポートは、<quote>正規の</quote> VNCビューアの場合はポート<systemitem class="resource">5901</systemitem>(VNCディスプレイ<literal>1</literal>に相当)、Webブラウザの場合はポート<systemitem class="resource">5801</systemitem>です。
   </para>
   <para>
    その他の設定は、異なるポートで使用できます。<phrase os="sled"> 設定を変更する必要がある場合は、システム管理者に詳細を問い合わせてください。</phrase>
   </para>
   <para>
    VNCディスプレイ番号とXディスプレイ番号は、一時的セッションでは互いに独立しています。VNCディスプレイ番号は、サーバがサポートするすべての設定に手動で割り当てられます(上記の例では1)。VNCセッションは、設定の1つを使用して開始されるたびに、自動的に未使用のXディスプレイ番号を取得します。
   </para>
   <para>
    デフォルトでは、VNCクライアントとサーバの両方が、インストール後に生成される自己署名SSL証明書を使用してセキュアな通信を試みます。デフォルトの証明書を使用することも、独自の証明書に置き換えることもできます。自己署名証明書を使用する際、初回の接続前に、VNCビューアおよびWebブラウザの両方で署名を確認する必要があります。
   </para>
  </sect2>

  <sect2 xml:id="sec-vnc-one-time-connect">
   <title>一時的VNCセッションを開始する</title>
   <para>
    一時的VNCセッションに接続するには、VNCビューアをインストールする必要があります。<xref linkend="sec-vnc-viewer"/>も参照してください。または、JavaScriptを有効にしたWebブラウザで、URLとして「<literal>http://jupiter.example.com:5801</literal>」を入力することにより、VNCセッションを表示できます。
   </para>
  </sect2>

  <sect2 xml:id="sec-vnc-one-time-config">
   <title>一時的VNCセッションを設定する</title>
   <para>
    デフォルト設定を変更する必要も意志もない場合は、このセクションをスキップできます。
   </para>
   <para>
    一時的VNCセッションは、<systemitem class="daemon">systemd</systemitem>ソケット<systemitem>xvnc.socket</systemitem>を介して開始されます。このファイルは、デフォルトで、6つの設定ブロックを提供します: VNCビューア用に3ブロック(<literal>vnc1</literal>から<literal>vnc3</literal>まで)、JavaScriptクライアント用に3ブロック(<literal>vnchttpd1</literal>から<literal>vnchttpd3</literal>まで)。デフォルトでは、<literal>vnc1</literal> と <literal>vnchttpd1</literal>だけが有効です。
   </para>
   <para>
    ブート時にVNCサーバソケットをアクティブにするには、次のコマンドを実行します。
   </para>
<screen>sudo systemctl enable xvnc.socket</screen>
   <para>
    すぐにソケットを起動するには、次のコマンドを実行します。
   </para>
<screen>sudo systemctl start xvnc.socket</screen>
   <para>
    <command>Xvnc</command>サーバは、<literal>server_args</literal>オプションを介して設定できます。オプションのリストについては、<command>Xvnc --help</command>を参照してください。
   </para>
   <para>
    カスタム設定を追加する際には、それらの設定が、同じホスト上の他の設定、他のサービス、または既存の永続的VNCセッションですでに使用中のポートを使用しないことを確認してください。
   </para>
   <para>
    設定の変更を有効にするには、次のコマンドを入力します:
   </para>
<screen><prompt>tux &gt; </prompt><command>sudo</command> systemctl reload xvnc.socket</screen>
   <important>
    <title>ファイアウォールとVNCポート</title>
    <para>
     <xref linkend="pro-vnc-one-time-activate"/>で説明されているように、リモート管理をアクティブにすると、ファイアウォール内でポート<systemitem class="resource">5801</systemitem>および<systemitem class="resource">5901</systemitem>が開きます。VNCセッションで使用されるネットワークインタフェースがファイアウォールで保護されている場合、VNCセッションの追加ポートをアクティブにする際には各ポートを手動で開く必要があります。手順については、<xref linkend="cha-security-firewall"/>を参照してください。
    </para>
   </important>
  </sect2>
 </sect1>
 <sect1 xml:id="sec-vnc-persistent">
  <title>永続的VNCセッション</title>

  <para>
   永続的セッションは、複数のクライアントから同時にアクセスすることが可能です。この機能では、1つのクライアントがフルアクセスをもち、他のすべてのクライアントが表示専用アクセスを持つため、デモ用途に最適です。また、講師が受講生のデスクトップにアクセスする必要があるトレーニングでも使用できます。
  </para>

  <tip xml:id="sec-vnc-persistent-connect">
   <title>永続的VNCセッションに接続する</title>
   <para>
    永続的VNCセッションに接続するには、VCNビューアをインストールする必要があります。詳細については、<xref linkend="sec-vnc-viewer"/>を参照してください。または、JavaScriptを有効にしたWebブラウザで、URLとして「<literal>http://jupiter.example.com:5801</literal>」を入力することにより、VNCセッションを表示できます。
   </para>
  </tip>

  <para>
   永続的VNCセッションには次の2つのタイプがあります。
  </para>

  <itemizedlist>
   <listitem>
    <para>
     <xref linkend="vnc-persistent-vncserver" xrefstyle="select:title"/>
    </para>
   </listitem>
   <listitem>
    <para>
     <xref linkend="vnc-persistent-vncmanager" xrefstyle="select:title"/>
    </para>
   </listitem>
  </itemizedlist>

  <sect2 xml:id="vnc-persistent-vncserver">
   <title><systemitem>vncserver</systemitem>を使用して開始されたVNCセッション</title>
   <para>
    このタイプの永続的VNCセッションは、サーバ上で開始されます。セッションとこのセッションで開始されたすべてのアプリケーションは、クライアント接続とは関わりなく、セッションが終了するまで実行されます。永続的セッションへのアクセスは、可能な2タイプのパスワードによって保護されます:
   </para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>
      フルアクセスを付与する通常のパスワード。または、
     </para>
    </listitem>
    <listitem>
     <para>
      非対話的(表示オンリー)アクセスを付与するオプションの表示オンリーパスワード。
     </para>
    </listitem>
   </itemizedlist>
   <para>
    1つのセッションに、両方の種類のクライアント接続が一度に複数存在できます。
   </para>
   <procedure xml:id="pro-vnc-persistent-activate">
    <title><command>vncserver</command>を使用した永続的VNCセッションの開始</title>
    <step>
     <para>
      シェルを開き、VNCセッションを所有するユーザとしてログインしていることを確認します。

     </para>
    </step>
    <step>
     <para>
      VNCセッションで使用されるネットワークインタフェースがファイアウォールで保護されている場合は、ファイアウォール内でセッションによって使用されるポートを手動で開く必要があります。複数のセッションを開始する場合は、一連のポートを開くことができます。ファイアウォールの設定方法の詳細については、<xref linkend="cha-security-firewall"/>を参照してください。
     </para>
     <para>
      <command>vncserver</command>は、ディスプレイ<literal>:1</literal>にはポート<systemitem class="resource">5901</systemitem>、ディスプレイ<literal>:2</literal>にはポート<systemitem class="resource">5902</systemitem>という順序でポートを使用します。永続的セッションの場合、VNCディスプレイとXディスプレイは、通常、同じ番号です。
     </para>
    </step>
    <step>
     <para>
      1024x768ピクセルの解像度と16ビットの色数でセッションを開始するには、次のコマンドを入力します。
     </para>
<screen>vncserver -alwaysshared -geometry 1024x768 -depth 16</screen>
     <para>
      <command>vncserver</command>コマンドは、何も指定されない場合、未使用のディスプレイ番号を選択し、その選択内容を出力します。追加オプションについては、<command>man 1 vncserver</command>を参照してください。
     </para>
    </step>
   </procedure>
   <para>
    初めて<command>vncserver</command>を実行すると、セッションへのフルアクセス用パスワードが要求されます。必要な場合は、セッションへの表示オンリーアクセス用パスワードも入力できます。
   </para>
   <para>
    ここで指定するパスワードは、同じユーザによって開始される今後のセッションにも使用されます。それらのパスワードは、<command>vncpasswd</command>コマンドで変更できます。
   </para>
   <important>
    <title>セキュリティ上の考慮事項</title>
    <para>
     必ず、かなりの長さ(8文字以上)の強力なパスワードを使用してください。これらのパスワードは共用しないでください。
    </para>
   </important>
   <para>
    VNCセッションを終了するには、通常のローカルXセッションのシャットダウンのように、VNC環境内部で実行中のデスクトップ環境をVCNビューアからシャットダウンします。
   </para>
   <para>
    セッションを手動で終了したい場合は、VNCサーバでシェルを開き、終了したいVNCセッションを所有するユーザとしてログインしていることを確認します。次のコマンドを実行して、ディスプレイ<literal>:1</literal>で実行されているセッションを終了します: <command>vncserver -kill :1</command>
   </para>
   <sect3 xml:id="sec-vnc-persistent-configure">
    <title>永続的VNCセッションを設定する</title>
    <para>
     永続的VNCセッションは、<filename>$HOME/.vnc/xstartup</filename>を編集することによって設定できます。デフォルトでは、このシェルスクリプトは、起動元と同じGUI/ウィンドウマネージャを起動します。<phrase role="productname"><phrase os="sled">SUSE Linux Enterprise Desktop</phrase></phrase>では、これは、GNOMEまたはIceWMのいずれかです。好みのウィンドウマネージャでセッションを開始する場合は、変数<envar>WINDOWMANAGER</envar>を設定します。
    </para>
<screen>WINDOWMANAGER=gnome vncserver -geometry 1024x768
WINDOWMANAGER=icewm vncserver -geometry 1024x768</screen>
    <note>
     <title>ユーザごとに1つの設定</title>
     <para>
      永続的VNCセッションは、ユーザごとの単一設定として設定されます。同じユーザが開始する複数のセッションでは、すべて同じ起動ファイルとパスワードファイルが使用されます。
     </para>
    </note>
   </sect3>
  </sect2>

  <sect2 xml:id="vnc-persistent-vncmanager">
   <title><systemitem>vncmanager</systemitem>を使用して開始されたVNCセッション</title>
   <para/>
   <procedure xml:id="vnc-persistent-vncmanager-enable">
    <title>永続的VNCセッションの有効化</title>
    <step>
     <para>
      まず、<menuchoice> <guimenu>YaST</guimenu> <guimenu>ネットワークサービス</guimenu> <guimenu>リモート管理(VNC)</guimenu>
      </menuchoice>の順に選択します。
     </para>
    </step>
    <step>
     <para>
      <guimenu>セッション管理機能付きのリモート管理を許可する</guimenu>をアクティブにします。
     </para>
    </step>
    <step>
     <para>
      WebブラウザウィンドウでVNCセッションにアクセスする場合は、<guimenu>Web ブラウザを利用したアクセスを有効にする</guimenu>をアクティブにします。
     </para>
    </step>
    <step>
     <para>
      必要な場合は、<guimenu>ファイアウォールでポートを開く</guimenu>にもチェックマークを付けます (たとえば、ネットワークインタフェースを外部ゾーンに属するように設定する場合)。ネットワークインタフェースが複数ある場合は、<guimenu>ファイアウォールの詳細</guimenu>で、特定のインタフェースにだけファイアウォールポートを開くように制限します。
     </para>
    </step>
    <step>
     <para>
      <guimenu>次へ</guimenu>をクリックすると設定が確定し、
     </para>
    </step>
    <step>
     <para>
      必要なパッケージの一部をまだ入手できない場合は、足りないパッケージのインストールを承認する必要があります。
     </para>
     <tip>
      <title>ディスプレイマネージャの再起動</title>
      <para>
       YaSTはディスプレイマネージャの設定を変更します。現在のグラフィカルセッションからログアウトし、ディスプレイマネージャを再起動して変更を有効にする必要があります。
      </para>
     </tip>
    </step>
   </procedure>
   <sect3 xml:id="vnc-persistent-vncmanager-configure">
    <title>永続的VNCセッションを設定する</title>
    <para>
     <xref linkend="vnc-persistent-vncmanager-enable"/>で説明したVNCセッション管理を有効にすると、通常、<command>vncviewer</command>やRemminaなどの好みのVNCビューアでリモートセッションに接続できます。ログイン画面が表示されます。ログインすると、デスクトップ環境のシステムトレイに「VNC」アイコンが表示されます。アイコンをクリックすると、<guimenu>VNCセッション</guimenu>ウィンドウが開きます。表示されない場合、またはデスクトップ環境がシステムトレイのアイコンをサポートしていない場合は、手動で<command>vncmanager-controller</command>を実行してください。
    </para>
    <figure>
     <title>VNCセッション設定</title>
     <mediaobject>
      <imageobject role="fo">
       <imagedata fileref="vncmanager_session.png" width="85%" format="PNG"/>
      </imageobject>
      <imageobject role="html">
       <imagedata fileref="vncmanager_session.png" width="85%" format="PNG"/>
      </imageobject>
     </mediaobject>
    </figure>
    <para>
     VNCセッションの動作に影響するいくつかの設定があります。
    </para>
    <variablelist>
     <varlistentry>
      <term><guimenu>Non-persistent, private (非永続的、プライベート)</guimenu>
      </term>
      <listitem>
       <para>
        これは一時的セッションに相当します。このセッションは他のユーザに表示されず、セッションを切断すると終了します。詳細については、「<xref linkend="sec-vnc-one-time"/>」を参照してください。
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term><guimenu>Persistent, visible (永続的、可視)</guimenu>
      </term>
      <listitem>
       <para>
        このセッションは他のユーザに表示され、セッションを切断しても実行され続けます。
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term><guimenu>[セッション名]</guimenu>
      </term>
      <listitem>
       <para>
        ここで、永続的セッションの名前を指定して、再接続時に簡単に識別できるようにすることができます。
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term><guimenu>No password required (パスワード不要)</guimenu>
      </term>
      <listitem>
       <para>
        セッションに、ユーザの資格情報でログインすることなく、自由にアクセス可能です。
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term><guimenu>Require user login (ユーザログインが必要)</guimenu>
      </term>
      <listitem>
       <para>
        セッションにアクセスするには、有効なユーザ名とパスワードでログインする必要があります。<guimenu>Allowed users (許可されたユーザ)</guimenu>テキストボックスに有効なユーザ名を一覧表示します。
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term><guimenu>Allow one client at time (同時に1つのクライアントを許可)</guimenu>
      </term>
      <listitem>
       <para>
        同時に複数のユーザがセッションに参加しないようにします。
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term><guimenu>Allow multiple clients at time (同時に複数のクライアントを許可)</guimenu>
      </term>
      <listitem>
       <para>
        複数のユーザが永続的セッションに同時に参加できるようにします。リモートプレゼンテーションまたはトレーニングに役立ちます。
       </para>
      </listitem>
     </varlistentry>
    </variablelist>
    <para>
     <guimenu>OK</guimenu>をクリックして、確定します。
    </para>
   </sect3>
   <sect3 xml:id="vnc-persistent-vncmanager-join">
    <title>永続的VNCセッションへの参加</title>
    <para>
     <xref linkend="vnc-persistent-vncmanager-configure"/>で説明した永続的VNCセッションを設定した後、VNCビューアでそのセッションに参加することができます。VNCクライアントからサーバに接続すると、新しいセッションを作成するか、既存のセッションに参加するかを選択するよう求めるプロンプトが表示されます。
    </para>
    <figure>
     <title>永続的VNCセッションへの参加</title>
     <mediaobject>
      <imageobject role="fo">
       <imagedata fileref="vncmanager_whether.png" width="80%" format="PNG"/>
      </imageobject>
      <imageobject role="html">
       <imagedata fileref="vncmanager_whether.png" width="80%" format="PNG"/>
      </imageobject>
     </mediaobject>
    </figure>
    <para>
     既存のセッションの名前をクリックすると、永続的セッションの設定に応じて、ログインアカウント情報の入力を求められることがあります。
    </para>
   </sect3>
  </sect2>
 </sect1>
 <sect1 xml:id="sec-vnc-encrypt">
  <title>暗号化されたVNC通信</title>

  <para>
   VNCサーバが正しく設定されている場合、VNCサーバとクライアント間の通信はすべて暗号化されます。セッションの開始時に認証が行われ、実際のデータ転送はその後に開始されます。
  </para>

  <para>
   一時的VNCセッションか永続的VNCセッションかにかかわらず、セキュリティオプションは、<literal>server_args</literal>行にある<command>/usr/bin/Xvnc</command>コマンドの<option>-securitytypes</option>パラメータを介して設定されます。<option>-securitytypes</option>パラメータでは、認証方法と暗号化の両方を選択します。次のオプションがあります。
  </para>

  <variablelist>
   <title>認証</title>
   <varlistentry>
    <term>None、TLSNone、X509None</term>
    <listitem>
     <para>
      認証なし。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>VncAuth、TLSVnc、X509Vnc</term>
    <listitem>
     <para>
      カスタムパスワードを使用する認証。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Plain、TLSPlain、X509Plain</term>
    <listitem>
     <para>
      PAMを使用してユーザのパスワードを検証する認証。
     </para>
    </listitem>
   </varlistentry>
  </variablelist>

  <variablelist>
   <title>暗号化</title>
   <varlistentry>
    <term>None、VncAuth、Plain</term>
    <listitem>
     <para>
      暗号化なし。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>TLSNone、TLSVnc、TLSPlain</term>
    <listitem>
     <para>
      匿名のTLS暗号化。すべてが暗号化されますが、リモートホストの検証は行われません。したがって、受動的攻撃からは保護されますが、中間者攻撃からは保護されません。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>X509None、X509Vnc、X509Plain</term>
    <listitem>
     <para>
      証明書によるTLS暗号化。自己署名証明書を使用する場合、初回接続時に証明書を検証するよう要求されます。以降の接続では、証明書が変更された場合にのみ警告が表示されます。したがって、初回接続時には中間者攻撃以外のすべての攻撃から保護されます(SSHの一般的な使用方法と同様)。マシン名に一致する認証局によって署名された証明書を使用すると、完全なセキュリティを実現できます(HTTPSの一般的な使用方法と同様)。
     </para>
     <tip>
      <title>署名とキーのパス</title>
      <para>
       X509ベースの暗号化では、<option>-X509Cert</option>オプションと<option>-X509Key</option>オプションで、X509証明書とキーのパスを指定する必要があります。
      </para>
     </tip>
    </listitem>
   </varlistentry>
  </variablelist>

  <para>
   複数のセキュリティタイプをカンマで区切って選択した場合、クライアントとサーバの両方でサポートおよび許可されているセキュリティタイプが使用されます。この方法により、サーバ上で日和見暗号化を設定できます。これは、暗号化をサポートしないVNCクライアントをサポートする必要がある場合に便利です。
  </para>

  <para>
   暗号化が有効であることがわかっているサーバに接続する場合、クライアント側で、許可されているセキュリティタイプを指定してダウングレード攻撃を防止することもできます(ただし、この場合、vncviewerに「Connection not encrypted! (接続が暗号化されていません)」という警告メッセージが表示されます)。
  </para>
 </sect1>
</chapter>
