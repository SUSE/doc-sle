<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="sle_update_upgrading.xml" version="5.0" xml:id="cha-update-sle">
 <title>Mise à niveau de SUSE Linux Enterprise</title>
 <info>
  <abstract>
   <para>
    SUSE® Linux Enterprise (SLE) permet de mettre à niveau un système existant vers la nouvelle version, par exemple de SLE 11 SP4 vers le dernier Service Pack de SLE 12. Aucune installation nouvelle n'est requise. Les données existantes, telles que les répertoires privés et de données, ainsi que la configuration du système, sont conservées. Vous pouvez effectuer la mise à jour à partir d'un lecteur de CD ou de DVD local ou à partir d'une source d'installation réseau centrale.
   </para>

   <para>
    Ce chapitre explique comment effectuer une mise à niveau manuelle de votre système SUSE Linux Enterprise, que ce soit à partir d'un DVD, du réseau, d'un processus automatisé ou de SUSE Manager.
   </para>
  </abstract>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:translation>oui</dm:translation>
  </dm:docmanager>
 </info>
 <sect1 xml:id="sec-update-sle-paths">
  <title>Chemins de mise à niveau pris en charge vers SLE 12 SP4</title>

<figure xml:id="fig-update-sle-paths-overview">
   <title>Aperçu des chemins de mise à niveau pris en charge</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata os="sles" fileref="upgrade-paths.svg" width="100%" format="SVG"/>

    </imageobject>
    <imageobject role="html">
     <imagedata os="sles" fileref="upgrade-paths.png" width="80%" format="PNG"/>

    </imageobject>
   </mediaobject>
  </figure>

  <important>
   <title>les mises à niveau entre architectures ne sont pas prises en charge</title>
   <para>
    Les mises à niveau entre architectures, comme une mise à niveau depuis une version 32 bits de <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> vers la version 64 bits, ou d'un format Big Endian vers un mode Little Endian, ne sont <emphasis>pas</emphasis> prises en charge !
   </para>
   <para>
    En particulier, la mise à niveau de SLE 2 sur POWER (Big Endian) vers SLE 12 SP1 sur POWER (nouveauté : Little Endian) n'est <emphasis>pas</emphasis> prise en charge.
   </para>
   <para>
    De plus, étant donné que SUSE Linux Enterprise 12 est une version exclusivement 64 bits, les mises à niveau à partir d'un système SUSE Linux Enterprise 11 32 bits vers SUSE Linux Enterprise 12 ou version ultérieure ne sont <emphasis>pas</emphasis> prises en charge.
   </para>
   <para>
    Pour effectuer une mise à niveau entre architectures, vous devez procéder à une nouvelle installation.
   </para>
  </important>

  <note>
   <title>omission de Service Packs</title>
   <para os="sles">
    Le chemin le plus sûr pour la mise à niveau consiste à progresser étape par étape et à installer consécutivement tous les Service Packs. Dans certains cas, il est toutefois envisageable d'ignorer 1 ou 2 Service Packs. Pour plus d'informations, reportez-vous à la section <xref linkend="vl-update-paths-sle-supported"/> et à la <xref linkend="fig-update-sle-paths-overview"/>. Il est cependant recommandé de ne <emphasis>pas</emphasis> ignorer de Service Pack.
   </para>

  </note>

  <note>
   <title>mise à niveau vers des versions majeures</title>
   <para>
    Il est recommandé d'effectuer une nouvelle installation lors de la mise à niveau vers une nouvelle version majeure, par exemple pour passer de SUSE Linux Enterprise 11 à SUSE Linux Enterprise 12.
   </para>
  </note>

  <variablelist xml:id="vl-update-paths-sle-supported">
   <title>Chemins de mise à niveau pris en charge par version</title>
   <varlistentry>
    <term>Mise à niveau à partir de SUSE Linux Enterprise 10 (tout Service Pack)</term>
    <listitem>
     <para>
      Aucun chemin de migration direct vers SUSE Linux Enterprise 12 n'est pris en charge. Il est recommandé dans ce cas d'effectuer une nouvelle installation.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Mise à niveau de SUSE Linux Enterprise 11 GA / SP1 / SP2 / SP3</term>
    <listitem>
     <para>
      Aucun chemin de migration direct vers SUSE Linux Enterprise 12 n'est pris en charge. Avant de pouvoir passer à SLE 12 SP4, vous devez au minimum disposer de SLE 11 SP4.
     </para>
     <para>
      Si vous ne pouvez pas effectuer une nouvelle installation, commencez par mettre à niveau le Service Pack SLE 11 installé vers SLE 11 SP4. Ces étapes sont décrites dans le <citetitle><citetitle>Guide de déploiement</citetitle></citetitle> de SUSE Linux Enterprise 11 : <link os="sles" xlink:href="https://www.suse.com/documentation/sles11/"/> .
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Mise à niveau à partir de SUSE Linux Enterprise 11 SP4</term>
    <listitem>
     <para>
      La mise à niveau de SLE 11 SP4 vers SLE 12 SP4 est uniquement prise en charge via une mise à niveau hors ligne. Reportez-vous au <xref linkend="cha-update-offline"/> pour obtenir des informations détaillées.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Mise à niveau de SUSE Linux Enterprise 12 GA vers SP4</term>
    <listitem>
     <para>
      Vous ne pouvez pas mettre à niveau directement SLE 12 GA vers le Service Pack 4. Effectuez d'abord une mise à niveau vers SLE 12 <phrase os="sles">SP2 ou</phrase> SP3.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Mise à niveau de SUSE Linux Enterprise 12 SP1 vers SP4</term>
    <listitem>
     <para>
      Une mise à niveau directe de SLE 12 SP1 vers SP4 n'est pas prise en charge. Effectuez d'abord une mise à niveau vers SLE 12 <phrase os="sles">SP2 ou</phrase> SP3.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry os="sles">
    <term>Mise à niveau de SUSE Linux Enterprise 12 SP2 vers SP4</term>
    <listitem>
     <para>
      La mise à niveau de SUSE Linux Enterprise 12 SP2 vers SP4 est prise en charge.
     </para>
    </listitem>
   </varlistentry>

   <varlistentry>
    <term>Mise à niveau de SUSE Linux Enterprise 12 SP3 vers SP4</term>
    <listitem>
     <para>
      La mise à niveau de SUSE Linux Enterprise 12 SP3 vers SP4 est prise en charge.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry os="sles">
    <term>Mise à niveau de SUSE Linux Enterprise 12 LTSS SP1 vers SP4</term>
    <listitem>
     <para>
      La mise à jour de SUSE Linux Enterprise 12 SP1 vers SP4 est prise en charge.
     </para>
    </listitem>
   </varlistentry>
  </variablelist>
 </sect1>
 <sect1 xml:id="sec-update-sle-methods">
  <title>Mise à niveau en ligne et hors ligne</title>
  <para>
   SUSE prend en charge deux méthodes différentes de mise à niveau et de migration. Pour plus d'informations sur la terminologie, reportez‑vous à la <xref linkend="sec-update-sle-terminology"/>. Les méthodes existantes sont les suivantes :
  </para>

  <variablelist>
   <varlistentry>
    <term>En ligne</term>
    <listitem>
     <para>
      Toutes les mises à niveau exécutées à partir du système en cours d'exécution sont considérées comme étant en ligne. Exemples : connexion par le biais du SUSE Customer Center, de Subscription Management Tool (SMT), de SUSE Manager à l'aide de Zypper ou de YaST.
     </para>
     <para>
      Lors de la migration entre des Service Packs de la même version majeure, suivez les instructions de la <xref linkend="sec-update-migr-yast-onlinemigr"/> ou de la <xref linkend="sec-update-migr-zypper-onlinemigr"/>.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Hors ligne</term>
    <listitem>
     <para>
      Les méthodes hors ligne démarrent généralement un autre système d'exploitation à partir duquel la version de SLE installée est mise à niveau. Exemples : DVD, disque flash, image ISO, AutoYaST, <quote>RPM simple</quote> ou démarrage PXE.
     </para>
    </listitem>
   </varlistentry>
  </variablelist>
  <para>
   La mise à niveau de SUSE Linux Enterprise 11 SP4 vers SUSE Linux Enterprise 12 SP4 est uniquement prise en charge par le biais d'une mise à niveau hors ligne. Reportez-vous au <xref linkend="cha-update-offline"/>.
  </para>
  <para>
   La mise à niveau de SUSE Linux Enterprise 12 LTSS SP1 vers SP4 est prise en charge avec toutes les méthodes en ligne et hors ligne. Reportez-vous au <xref linkend="cha-update-offline"/> et au <xref linkend="cha-update-online"/>.
  </para>
  <important>
   <title>clients SUSE Manager</title>
   <para>
    Si votre machine est gérée par SUSE Manager, la procédure de mise à niveau doit être démarrée dans l'interface de gestion. Pour plus de détails, reportez-vous à la <xref linkend="sec-update-sle-manager"/>.
   </para>
  </important>
 </sect1>

 <sect1 xml:id="sec-update-prep">
  <title>Préparation du système</title>
  <para>
   Avant de lancer la procédure de mise à niveau, assurez-vous que votre système est prêt. Cette préparation implique notamment la sauvegarde des données et la consultation des notes de version.
  </para>

  <sect2 xml:id="sec-update-prep-update">
   <title>Vérification de l'actualisation du système</title>
   <para>
    La mise à niveau du système est prise en charge uniquement à partir du niveau de correctif le plus récent. Assurez-vous que les dernières mises à jour système sont installées, en exécutant le <command>correctif zypper</command> ou en démarrant le module YaST <guimenu>Online Update</guimenu>.
   </para>
  </sect2>

  <sect2 xml:id="sec-update-prep-relnotes">
   <title>Lecture des notes de version</title>
   <para>
    Les notes de version contiennent des informations supplémentaires sur les modifications apportées depuis la version précédente de <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase>. Consultez les notes de version pour vérifier les aspects suivants :
   </para>
   <itemizedlist>
    <listitem>
     <para>
      Votre matériel doit tenir compte de certaines considérations spéciales;
     </para>
    </listitem>
    <listitem>
     <para>
      Les paquetages logiciels utilisés ont été considérablement modifiés;
     </para>
    </listitem>
    <listitem>
     <para>
      Des précautions spéciales sont nécessaires pour votre installation.
     </para>
    </listitem>
   </itemizedlist>
   <para>
    Les notes de version incluent également des informations de dernière minute qui, faute de temps, n'ont pas pu être intégrées au manuel. Elles contiennent également des notes concernant les problèmes connus.
   </para>
   <para os="sles">
    Si vous omettez d'installer un ou plusieurs Service Packs, consultez néanmoins les notes de version de ces Service Packs ignorés. Les notes de version contiennent généralement uniquement les changements effectués entre deux versions successives. Vous risquez de manquer des changements importants si vous lisez uniquement les notes de version actuelles.
   </para>
   <para>
    Les notes de version sont disponibles en local dans le répertoire <filename>/usr/share/doc/release-notes</filename> ou en ligne à l'adresse <link xlink:href="https://www.suse.com/releasenotes/"/>.
   </para>
  </sect2>
  <sect2 xml:id="sec-update-prep-backup">
   <title>Exécution d'une sauvegarde</title>
   <para>
    Avant de procéder à la mise à jour, copiez les fichiers de configuration existants sur un support distinct (comme un périphérique à bande, un disque dur amovible, etc.) pour sauvegarder les données. Cela concerne principalement les fichiers stockés dans le répertoire <filename>/etc</filename>, ainsi que certains répertoires et fichiers sous <filename>/var</filename> et <filename>/opt</filename>. Vous pouvez également écrire les données de l'utilisateur de <filename>/home</filename> (les répertoires <envar>HOME</envar>) dans un support de sauvegarde. Sauvegardez ces données en tant que <systemitem class="username">root</systemitem>. Seul l'utilisateur <systemitem class="username">root</systemitem> a des droits de lecture sur tous les fichiers locaux.
   </para>
   <para>
    Si vous avez sélectionné <guimenu>Mettre à jour un système existant</guimenu> comme mode d'installation dans YaST, vous pouvez choisir d'effectuer une sauvegarde (système) ultérieurement. Vous pouvez inclure tous les fichiers modifiés, ainsi que ceux issus du répertoire <filename>/etc/sysconfig</filename>. Il ne s'agit toutefois pas d'une sauvegarde complète, dans la mesure où il manque tous les autres répertoires importants mentionnés ci-dessus. Recherchez la sauvegarde dans le répertoire <filename>/var/adm/backup</filename>.
   </para>
   <sect3 xml:id="sec-update-prep-backup-packagelist">
    <title>Liste des paquetages et dépôts installés</title>
    <para>
     Il est souvent utile de disposer d'une liste des paquetages installés, par exemple pour effectuer une nouvelle installation d'une nouvelle version majeure de SLE ou pour revenir à l'ancienne version.
    </para>
    <para>
     N'oubliez pas que les paquetages installés ou dépôts utilisés ne sont pas tous disponibles dans les versions plus récentes de SUSE Linux Enterprise. Certains ont parfois été renommés et d'autres remplacés. Il se peut aussi que certains paquetages restent disponibles pour des raisons d'héritage, mais qu'un autre paquetage soit utilisé par défaut. Par conséquent, une modification manuelle des fichiers peut s'avérer nécessaire. Elle peut être réalisée avec n'importe quel éditeur de texte.
    </para>
    <para>
     Créez un fichier nommé <filename>repositories.bak</filename> contenant une liste de tous les dépôts utilisés :
    </para>
    <screen><prompt role="root">root # </prompt><command>zypper</command> lr -e repositories.bak</screen>
    <para>
     Créez un fichier nommé <filename>installed-software.bak</filename> contenant une liste de tous les paquetages utilisés :
    </para>
    <screen><prompt role="root">root # </prompt><command>rpm</command> -qa --queryformat '%{NAME}\n' &gt; installed-software.bak</screen>
    <para>
     Sauvegardez les fichiers. Les dépôts et paquetages installés peuvent être restaurés à l'aide des commandes suivantes :
    </para>
    <screen><prompt role="root">root # </prompt><command>zypper</command> ar repositories.bak
<prompt role="root">root # </prompt><command>zypper</command> install $(cat installed-software.bak)</screen>

    <note xml:id="note-update-prep-backup-package-amount">
     <title>
      augmentation du nombre de paquetages en cas de mise à jour vers une nouvelle version majeure
     </title>
     <para>
      Un système mis à niveau vers une nouvelle version majeure (SLE <replaceable>X+1</replaceable>) peut contenir plus de paquetages que le système initial (SLE <replaceable>X</replaceable>). Il en contient aussi davantage qu'une nouvelle installation de SLE <replaceable>X+1</replaceable> avec la même sélection de modèle. Il existe plusieurs raisons à cela :
     </para>
     <itemizedlist>
      <listitem>
       <para>
        Les paquetages ont été divisés pour permettre une sélection plus rigoureuse de l'ensemble. Par exemple, 37 paquetages <package>texlive</package> dans SLE 11 ont été divisés en 422 paquetages dans SLE 12.
       </para>
      </listitem>
      <listitem>
       <para>
        Lorsqu'un paquetage a été divisé en plusieurs autres, tous les nouveaux paquetages sont installés de manière à conserver les mêmes fonctionnalités que la version précédente en cas de mise à niveau. Toutefois, la nouvelle configuration par défaut pour une nouvelle installation de SLE <replaceable>X+1</replaceable> ne consiste pas forcément à installer tous les paquetages.
       </para>
      </listitem>
      <listitem>
       <para>
        Les paquetages hérités de SLE <replaceable>X</replaceable> peuvent être conservés pour des raisons de compatibilité.
       </para>
      </listitem>
      <listitem>
       <para>
        Les dépendances de paquetages et l'étendue des modèles peuvent avoir changé.
       </para>
      </listitem>
     </itemizedlist>
    </note>
   </sect3>
  </sect2>

  <sect2 xml:id="sec-update-prep-mariadb">
   <title>Migration de votre base de données MySQL</title>
   <remark>toms 2015-09-03: already reviewed by Ondrej and Kristýna.</remark>
   <para>
    À partir de la version 12 de SUSE Linux Enterprise, SUSE est passé de MySQL à MariaDB. Avant de lancer une mise à niveau, il est vivement recommandé de sauvegarder votre base de données.
   </para>

   <para>
    Pour effectuer la migration de la base de données, procédez comme suit :
   </para>
   <procedure>
    <step>
     <para>
      Connectez-vous à votre machine SUSE Linux Enterprise 11.
     </para>
    </step>
    <step>
     <para>
      Créer un fichier de vidage :
     </para>
<screen><prompt role="root">root # </prompt><command>mysqldump</command> -u root -p --all-databases &gt; mysql_backup.sql</screen>
     <para>
      Par défaut, <command>mysqldump</command> ne vide pas la base de données <literal>INFORMATION_SCHEMA</literal> ni <literal>performance_schema</literal>. Pour plus d'informations, consultez la page <link xlink:href="https://dev.mysql.com/doc/refman/5.5/en/mysqldump.html"/>.
     </para>
    </step>
    <step>
     <para>
      Enregistrez votre fichier de vidage, le fichier de configuration <filename>/etc/my.cnf</filename> ainsi que le répertoire <filename>/etc/mysql/</filename> pour le consulter ultérieurement (<emphasis>PAS</emphasis> le répertoire d'installation) dans un endroit sûr.
     </para>
    </step>
    <step>
     <para>
      Effectuez la mise à niveau. Après la mise à niveau, votre ancien fichier de configuration <filename>/etc/my.cnf</filename> reste inchangé. La nouvelle configuration est disponible dans le fichier <filename>/etc/my.cnf.rpmnew</filename>.
     </para>
    </step>
    <step>
     <para>
      Configurez votre base de données MariaDB selon vos besoins. <emphasis>N'utilisez PAS</emphasis> les anciens répertoire et fichier de configuration. Vous pouvez toutefois les adapter et vous en servir ultérieurement comme références.
     </para>
    </step>
    <step>
     <para>
      Assurez-vous que vous démarrez le serveur MariaDB :
     </para>
<screen><prompt role="root">root # </prompt><command>systemctl</command> start mysql</screen>
     <para>
      Si vous voulez lancer le serveur MariaDB à chaque démarrage, activez ce service :
     </para>
<screen><prompt role="root">root # </prompt><command>systemctl</command> enable mysql</screen>

    </step>
    <step>
     <para>
      Vérifiez que MariaDB s'exécute correctement en vous connectant à la base de données :
     </para>
<screen><prompt role="root">root # </prompt><command>mysql</command> -u root -p</screen>
    </step>
   </procedure>
  </sect2>

  <sect2 xml:id="sec-update-prep-postgresql">
   <title>Migration de votre base de données PostgreSQL</title>
   <para>
    Une version plus récente de la base de données PostgreSQL est fournie en tant que mise à jour de maintenance. En raison du travail de migration requis pour la base de données, le processus de mise à niveau n'est pas automatique. De ce fait, le passage d'une version à l'autre doit être effectué manuellement.
   </para>
   <para>
    La migration est exécutée à l'aide de la commande <command>pg_upgrade</command>. Elle constitue une méthode qui diffère du vidage et du rechargement classique. Par rapport à la méthode de <quote>vidage et rechargement</quote>, la migration effectuée par le biais de la commande <command>pg_upgrade</command> est plus rapide.
   </para>
   <para>
    Les fichiers programmes de chaque version PostgreSQL sont stockés dans des répertoires différents selon la version, par exemple, dans <filename>/usr/lib/postgresql96/</filename> pour la version 9.6 et dans <filename>/usr/lib/postgresql10/</filename> pour la version 10. Notez que la stratégie de contrôle des versions de PostgreSQL a changé entre les versions majeures 9.6 et 10. Pour plus de détails, consultez l'adresse <link xlink:href="https://www.postgresql.org/support/versioning/"/>.
   </para>
   <important>
    <title>mise à niveau à partir de SLE 11</title>
     <para>
      Lors de la mise à niveau à partir de SLE 11, <systemitem>postgresql94</systemitem> sera désinstallé et ne pourra plus être utilisé pour la migration de la base de données vers une version ultérieure de PostgreSQL. Par conséquent, veillez à migrer la base de données PostgreSQL <emphasis>avant</emphasis> de mettre à niveau votre système.
    </para>
   </important>
   <para>
    La procédure ci-dessous décrit la migration de la base de données de la version 9.6 vers la version 10. Lorsque vous utilisez une version différente comme source ou comme cible, remplacez les numéros de version en conséquence.
   </para>
   <para>
    Pour effectuer la migration de la base de données, procédez comme suit :
   </para>
   <procedure>
    <step>
     <para>
      Assurez-vous que les conditions préalables suivantes sont remplies :
     </para>
     <itemizedlist>
      <listitem>
       <para>
        Si ce n'est déjà fait, mettez à niveau les paquetages de l'ancienne version de PostgreSQL vers la version la plus récente par le biais d'une mise à jour de maintenance.
       </para>
      </listitem>
      <listitem>
       <para>
        Créez une sauvegarde de votre base de données existante.
       </para>
      </listitem>
      <listitem>
       <para>
        Installez les paquetages de la nouvelle version majeure de PostgreSQL. Pour SLE12 SP4, cela implique d'installer
        <package>postgresql10-server</package>
        et tous les paquetages dont il dépend.
       </para>
      </listitem>
      <listitem>
       <para>
        Installez le paquetage
        <package>postgresql10-contrib</package>
        qui contient la commande <command>pg_upgrade</command>.
       </para>
      </listitem>
      <listitem>
       <para>
        Assurez-vous que vous disposez de suffisamment d'espace disponible dans la zone de stockage des données PostgreSQL, par défaut <filename>/var/lib/pgsql/data</filename>. Si l'espace risque d'être insuffisant, essayez de réduire la taille à l'aide de la commande SQL suivante sur chaque base de données (cette opération risque d'être très longue) :
       </para>
<screen>VACUUM FULL</screen>
      </listitem>
     </itemizedlist>
    </step>
    <step>
     <para>
      Arrêtez le serveur PostgreSQL avec une des commandes suivantes :
     </para>
<screen><prompt role="root">root # </prompt><command>/usr/sbin/rcpostgresql</command> stop</screen>
    <para>ou</para>
<screen><prompt role="root">root # </prompt>systemctl stop postgresql.service</screen>
    <para>(Selon la version SLE que vous utilisez comme version de départ pour la mise à niveau).</para>
    </step>
    <step>
     <para>
      Renommez votre ancien répertoire de données :
     </para>
<screen><prompt role="root">root # </prompt><command>mv</command> /var/lib/pgsql/data /var/lib/pgsql/data.old</screen>
    </step>

    <step>
     <para>
      Initialisez votre nouvelle instance de base de données, soit manuellement avec <command>initdb</command>, soit en démarrant et arrêtant PostgreSQL, qui le fera automatiquement :
     </para>
<screen><prompt role="root">root # </prompt><command>/usr/sbin/rcpostgresql</command> start
<prompt role="root">root # </prompt><command>/usr/sbin/rcpostgresql</command> stop</screen>
     <para>ou</para>
<screen><prompt role="root">root # </prompt>systemctl start postgresql.service
<prompt role="root">root # </prompt>systemctl stop postgresql.service</screen>
     <para>(Selon la version SLE que vous utilisez comme version de départ pour la mise à niveau).</para>
    </step>
    <step>
     <para>
      Si vous avez modifié les fichiers de configuration dans l'ancienne version, pensez à transférer ces modifications vers les nouveaux fichiers de configuration. Cela peut concerner les fichiers <filename>postgresql.auto.conf</filename>, <filename>postgresql.conf</filename>, <filename>pg_hba.conf</filename> et <filename>pg_ident.conf</filename>. L'ancienne version de ces fichiers se trouve dans <filename>/var/lib/pgsql/data.old/</filename> ; les nouvelles versions sont disponibles dans <filename>/var/lib/pgsql/data</filename>.
     </para>
     <para>
      Notez qu'il est déconseillé de vous contenter de copier les anciens fichiers de configuration, car cela peut écraser de nouvelles options, de nouvelles valeurs par défaut et des commentaires modifiés.
     </para>
    </step>
    <step>
     <para>
      Démarrez le processus de migration en tant qu'utilisateur <systemitem class="username">postgres</systemitem> :
     </para>
<screen><prompt role="root">root # </prompt><command>pg_upgrade</command> \
   --old-datadir "/var/lib/pgsql/data.old" \
   --new-datadir "/var/lib/pgsql/data" \
   --old-bindir "/usr/lib/postgresql96/bin/" \
   --new-bindir "/usr/lib/postgresql10/bin/"</screen>
    </step>
    <step>
     <para>
      Démarrez votre nouvelle instance de base de données avec l'une des commandes suivantes :
     </para>
<screen><prompt role="root">root # </prompt><command>/usr/sbin/rcpostgresql</command> start</screen>
     <para>ou</para>
<screen><prompt role="root">root # </prompt>systemctl start postgresql.service</screen>
    </step>
    <step>
     <para>
      Vérifiez si la migration a réussi. L'étendue du test dépend de votre cas d'utilisation. Il n'existe pas d'outil général permettant d'automatiser cette étape.
     </para>
    </step>
    <step>
     <para>
      Supprimez les anciens paquetages PostgreSQL et votre ancien répertoire de données :
     </para>
<screen><prompt role="root">root # </prompt><command>zypper</command> search -s postgresql96 | xargs zypper rm -u
<prompt role="root">root # </prompt><command>rm</command> -rf /var/lib/pgsql/data.old</screen>
    </step>
   </procedure>
  </sect2>

  <sect2 xml:id="sec-update-prep-ssl">
   <title>Création de certificats de serveur non-MD5 pour les applications Java</title>
   <remark>toms 2016-07-27: from bsc#970153, c#24</remark>
   <para>
    Au cours de la mise à jour du SP1 vers SP2, les certificats basés sur MD5 ont été désactivés dans le cadre d'un correctif de sécurité. Si vous disposez de certificats créés à l'aide de l'algorithme MD5, recréez vos certificats en procédant comme suit :
   </para>

   <procedure>
    <step>
     <para>
      Ouvrez un terminal et connectez-vous en tant qu'utilisateur <systemitem class="username">root</systemitem>.
     </para>
    </step>
    <step>
     <para>
      Créez une clé privée :
     </para>
     <screen><prompt role="root">root # </prompt><command>openssl</command> genrsa -out server.key 1024</screen>
     <para>
      si vous souhaitez une clé renforcée, remplacez <literal>1024</literal> par un nombre plus élevé, par exemple <literal>4096</literal>.
     </para>
    </step>
    <step>
     <para>
      Créez une requête de signature de certificat (CSR) :
     </para>
     <screen><prompt role="root">root # </prompt><command>openssl</command> req -new -key server.key -out server.csr</screen>
    </step>
    <step>
     <para>
      Auto-signez le certificat :
     </para>
     <screen><prompt role="root">root # </prompt><command>openssl</command> x509 -req -days 365 -in server.csr -signkey server.key -out server.crt</screen>
    </step>
    <step>
     <para>
      Créez le fichier PEM :
     </para>
     <screen><prompt role="root">root # </prompt><command>cat</command> server.key server.crt &gt; server.pem</screen>
    </step>
    <step>
     <para>Placez les fichiers <filename>server.crt</filename>, <filename>server.csr</filename>, <filename>server.key</filename> et <filename>server.pem</filename> dans les répertoires respectifs contenant les clés. Pour Tomcat, il s'agit par exemple du répertoire <filename>/etc/tomcat/ssl/</filename>.
     </para>
    </step>
   </procedure>
  </sect2>

  <sect2 xml:id="sec-update-prep-vms">
   <title>Arrêt des invités de machine virtuelle</title>
   <para>
    Si votre machine fait office de serveur hôte de machine virtuelle pour KVM ou Xen, veillez à arrêter correctement tous les invités de machine virtuelle actifs avant de procéder à la mise à jour. Dans le cas contraire, l'accès aux invités peut s'avérer impossible après la mise à jour.
   </para>
  </sect2>

  <sect2 xml:id="sec-update-prep-smt">
   <title>Vérification du script <command>clientSetup4SMT.sh</command> sur les clients SMT</title>
   <para>
    Si vous migrez votre système d'exploitation client enregistré sur un serveur SMT, vous devez vérifier si la version du script <command>clientSetup4SMT.sh</command> sur votre hôte est à jour. Le fichier <command>clientSetup4SMT.sh</command> des anciennes versions de SMT ne peut pas gérer les clients SMT 12. Si vous appliquez régulièrement des correctifs logiciels à votre serveur SMT, la dernière version du fichier <command>clientSetup4SMT.sh</command> est toujours disponible à l'emplacement <filename>&lt;NOM_HÔTE_SMT&gt;/repo/tools/clientSetup4SMT.sh</filename>.
   </para>
  </sect2>

  <sect2 xml:id="sec-update-disk">
   <title>Espace disque</title>

   <para>
    La taille des logiciels tend à augmenter de versions en versions. Il convient donc de vérifier l'espace disponible sur la partition avant d'effectuer la mise à jour. Si vous pensez que vous allez manquer d'espace disque, sauvegardez vos données avant d'augmenter l'espace disponible en redimensionnant des partitions, par exemple. Il n'existe pas de règle précise concernant l'espace de chaque partition. L'espace requis dépend de votre profil particulier de partitionnement et du logiciel sélectionné.
   </para>

   <note>
    <title>vérification automatique de l'espace dans YaST</title>
    <para>
     Au cours de la procédure de mise à jour, YaST vérifie la quantité d'espace disque disponible et affiche un avertissement si la taille de l'installation risque de dépasser la quantité d'espace disponible. Dans ce cas, la mise à jour risque de rendre le <emphasis>système inutilisable</emphasis> ! Si vous savez exactement ce que vous faites (en ayant effectué des tests au préalable), vous pouvez ignorer l'avertissement et poursuivre la mise à jour.
    </para>
   </note>

   <sect3 xml:id="sec-update-disk-space">
    <title>Vérification de l'espace disque sur des systèmes de fichiers racines non-Btrfs</title>
    <para>
     Utilisez la commande <command>df</command> pour obtenir une liste de l'espace disque disponible. Dans l'<xref linkend="aus-update-df"/>, la partition root à écrire est <filename>/dev/sda3</filename> (montée en tant que <filename>/</filename>).
    </para>
    <example xml:id="aus-update-df">
     <title>List with <command>df -h</command></title>

<screen os="sles">Filesystem     Size  Used Avail Use% Mounted on
/dev/sda3       74G   22G   53G  29% /
tmpfs          506M     0  506M   0% /dev/shm
/dev/sda5      116G  5.8G  111G   5% /home
/dev/sda1       44G    4G   40G   9% /data</screen>
    </example>
   </sect3>

   <sect3 xml:id="sec-update-disk-btrfs-on-root">
    <title>Vérification de l'espace disque sur des systèmes de fichiers racines Btrfs</title>
    <para>
     Si vous utilisez Btrfs en tant que systèmes de fichiers racines sur votre machine, assurez-vous qu'il dispose de suffisamment d'espace libre. Dans le pire des cas, une mise à niveau a besoin d'autant d'espace disque que le système de fichiers racine actuel (sans le répertoire <filename>/.snapshot</filename>) pour un nouvel instantané. Pour afficher l'espace disque disponible, utilisez la commande suivante :
    </para>
<screen><prompt role="root">root # </prompt><command>df</command> -h /</screen>
    <para>
     Vérifiez également l'espace disponible sur toutes les autres partitions montées. Les recommandations suivantes ont fait leurs preuves :
    </para>
    <itemizedlist>
     <listitem>
      <para>
       Pour tous les systèmes de fichiers comprenant Btrfs, vous avez besoin de suffisamment d'espace disque disponible pour télécharger et installer des RPM volumineux. L'espace occupé par les anciens RPM n'est libéré qu'après l'installation des nouveaux RPM.
      </para>
     </listitem>
     <listitem>
      <para>
       Pour Btrfs avec des instantanés, vous avez au minimum besoin d'une quantité d'espace libre égale à celle occupée par votre installation actuelle. Il est recommandé de disposer de deux fois plus d'espace libre que celui occupé par l'installation actuelle.
      </para>
      <para>
       Si vous ne disposez pas de suffisamment d'espace, vous pouvez tenter de supprimer les anciens instantanés à l'aide de <command>snapper</command> :
      </para>
<screen><prompt role="root">root # </prompt><command>snapper</command> list
<prompt role="root">root # </prompt><command>snapper</command> delete NUMBER</screen>
      <para>
       Toutefois, cela ne fonctionne pas toujours. Avant la migration, la plupart des instantanés n'occupent pas tellement d'espace.
      </para>
     </listitem>
    </itemizedlist>
   </sect3>
  </sect2>
  <sect2 xml:id="sec-update-prep-multiversion">
   <title>Désactivation temporaire de la prise en charge de plusieurs versions du kernel</title>
   <para>
    <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> (SLES) permet d'installer plusieurs versions de kernel en activant les paramètres correspondants sous <filename>/etc/zypp/zypp.conf</filename>. La prise en charge de cette fonctionnalité doit pourtant être désactivée temporairement pour effectuer une mise à niveau vers un Service Pack. Une fois la mise à jour terminée, la prise en charge de plusieurs versions peut être réactivée. Pour désactiver la prise en charge de plusieurs versions, commentez les lignes correspondantes sous <filename>/etc/zypp/zypp.conf</filename>. Le résultat doit ressembler à ceci :
   </para>
<screen>#multiversion = provides:multiversion(kernel)
#multiversion.kernels = latest,running</screen>
   <para>
    Pour réactiver cette fonction après une mise à jour réussie, supprimez les signes de commentaire. Pour plus d'informations sur la prise en charge de plusieurs versions, reportez-vous à la <xref linkend="cha-tuning-multikernel-enable"/>.
   </para>
  </sect2>
 </sect1>
 <sect1 xml:id="sec-update-sle-sle12zseries" os="sles">
  <title>Mise à niveau sur IBM z Systems</title>
  <para>La mise à niveau d'une installation SUSE Linux Enterprise sur z Systems nécessite <command>Upgrade=1</command> comme paramètre de kernel, par exemple via le fichier parmfile. Reportez-vous à la <xref linkend="sec-appdendix-parm" xrefstyle="HeadingOnPage"/>.
  </para>
 </sect1>
 <sect1 xml:id="sec-update-prep-ppc-x" os="sles" arch="power">
  <title>IBM POWER : démarrage d'un serveur X</title>
  <para>
   Sous SLES 12 pour IBM POWER, le gestionnaire d'affichage est configuré pour ne pas démarrer un serveur X local par défaut. Ce paramètre a été annulé sous SLES 12 SP1. Le gestionnaire d'affichage démarre désormais un serveur X.
  </para>
  <para>
   Pour éviter des problèmes au cours de la mise à niveau, le paramètre <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> n'est pas modifié automatiquement. Si vous souhaitez que le gestionnaire d'affichage démarre un serveur X après la mise à niveau, modifiez le paramètre <envar>DISPLAYMANAGER_STARTS_XSERVER</envar> sous <filename>/etc/sysconfig/displaymanager</filename> comme suit :
  </para>
  <screen>DISPLAYMANAGER_STARTS_XSERVER="yes"</screen>
 </sect1>
</chapter>
