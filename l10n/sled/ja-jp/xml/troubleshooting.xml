<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="troubleshooting.xml" version="5.0" xml:id="cha-trouble">
 <title>最も頻繁に起こる問題およびその解決方法</title>
 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:bugtracker/>
   <dm:translation>yes</dm:translation>
  </dm:docmanager>
 </info>
 <para>
  この章では、一連の潜在的な問題とその解決法について説明します。ここで状況が正確に記載されていなくても、問題解決のヒントになる類似した状況が見つかる場合があります。
 </para>
 <sect1 xml:id="sec-trouble-info">
  <title>情報の検索と収集</title>

  <para>
   Linuxでは、非常に詳細なレポートが提供されます。システムの使用中に問題が発生した場合、調べる必要のあるところが何箇所かあります。それらのほとんどは、Linuxシステム一般で標準とされるもので、残りのいくつかは<phrase role="productname"><phrase os="sled">SUSE Linux Enterprise Desktop</phrase></phrase>システムに関連するものです。大半のログファイルはYaSTを使って表示することができます(<menuchoice>
   <guimenu>その他</guimenu> <guimenu>起動ログを表示</guimenu>
   </menuchoice>)。
  </para>



  <para>
   YaSTは、サポートチームが必要とするすべてのシステム情報を収集することができます。<menuchoice>

   <guimenu>その他</guimenu> <guimenu>サポート</guimenu> </menuchoice>の順に選択し、問題のカテゴリを選択します。すべての情報が収集されたら、それをサポートリクエストに添付します。
  </para>

  <para>
   最も頻繁にチェックされるログファイルのリストの後には、一般的な目的に関する説明があります。<filename>~</filename>を含むパスは、現在のユーザのホームディレクトリを参照します。
  </para>

  <table xml:id="tab-trouble-info">
   <title>ログファイル</title>
   <tgroup cols="2">
    <thead>
     <row>
      <entry>
       <para>
        ログファイル
       </para>
      </entry>
      <entry>
       <para>
        説明
       </para>
      </entry>
     </row>
    </thead>
    <tbody>
     <row>
      <entry>
       <para>
        <filename>~/.xsession-errors</filename>
       </para>
      </entry>
      <entry>
       <para>
        現在実行中のデスクトップアプリケーションからのメッセージです。
       </para>
      </entry>
     </row>
     <row>
      <entry>
       <para>
        <filename>/var/log/apparmor/</filename>
       </para>
      </entry>
      <entry>
       <para>
        AppArmorからのログファイル。詳細については、<xref linkend="part-apparmor"/>を参照してください。
       </para>
      </entry>
     </row>
     <row>
      <entry>
       <para>
        <filename>/var/log/audit/audit.log</filename>
       </para>
      </entry>
      <entry>
       <para>
        システムのファイル、ディレクトリ、またはリソースに対するすべてのアクセスを追跡し、システムコールをトレースする監査からのログファイル。詳細については、<xref linkend="part-audit"/>を参照してください。
       </para>
      </entry>
     </row>

     <row>
      <entry>
       <para>
        <filename>/var/log/mail.*</filename>
       </para>
      </entry>
      <entry>
       <para>
        メールシステムから受け取るメッセージです。
       </para>
      </entry>
     </row>
     <row>
      <entry>
       <para>
        <filename>/var/log/NetworkManager</filename>
       </para>
      </entry>
      <entry>
       <para>
        NetworkManagerからのログファイルで、ネットワーク接続についての問題を収集します。
       </para>
      </entry>
     </row>
     <row>
      <entry>
       <para>
        <filename>/var/log/samba/</filename>
       </para>
      </entry>
      <entry>
       <para>
        Sambaサーバおよびクライアントのログメッセージを含んでいるディレクトリです。
       </para>
      </entry>
     </row>
     <row>
      <entry>
       <para>
        <filename>/var/log/warn</filename>
       </para>
      </entry>
      <entry>
       <para>
        カーネルおよびシステムのログデーモンから受け取る、<quote>警告</quote>レベル以上のすべてのメッセージ。
       </para>
      </entry>
     </row>
     <row>
      <entry>
       <para>
        <filename>/var/log/wtmp</filename>
       </para>
      </entry>
      <entry>
       <para>
        現在のコンピュータセッションのユーザのログインレコードを含むバイナリファイルです。<command>last</command>コマンドを使用して表示させます。
       </para>
      </entry>
     </row>
     <row>
      <entry>
       <para>
        <filename>/var/log/Xorg&#x002E;*&#x002E;log</filename>
       </para>
      </entry>
      <entry>
       <para>
        Xウィンドウシステムからの、起動時およびランタイムのさまざまなログファイルです。Xの失敗した起動をデバッグするのに役に立ちます。
       </para>
      </entry>
     </row>
     <row>
      <entry>
       <para>
        <filename>/var/log/YaST2/</filename>
       </para>
      </entry>
      <entry>
       <para>
        YaSTのアクションおよびその結果を含んでいるディレクトリです。
       </para>
      </entry>
     </row>
     <row>
      <entry>
       <para>
        <filename>/var/log/zypper.log</filename>
       </para>
      </entry>
      <entry>
       <para>
        Zypperのログファイル。
       </para>
      </entry>
     </row>
    </tbody>
   </tgroup>
  </table>

  <para>
   ログファイルとは別に、稼働中のシステムの情報も提供されます。<xref linkend="tab-trouble-system" xrefstyle="select:label title nopage"/>を参照してください。
  </para>

  <table xml:id="tab-trouble-system">
   <title><filename>/proc</filename>ファイルシステムによるシステム情報</title>
   <tgroup cols="2">
    <thead>
     <row>
      <entry>
       <para>
        ファイル
       </para>
      </entry>
      <entry>
       <para>
        説明
       </para>
      </entry>
     </row>
    </thead>
    <tbody>
     <row>
      <entry>
       <para>
        <filename>/proc/cpuinfo</filename>
       </para>
      </entry>
      <entry>
       <para>
        プロセッサのタイプ、製造元、モデル、およびパフォーマンスなどを含む情報を表示します。
       </para>
      </entry>
     </row>
     <row>
      <entry>
       <para>
        <filename>/proc/dma</filename>
       </para>
      </entry>
      <entry>
       <para>
        どのDMAチャネルが現在使用されているかを表示します。
       </para>
      </entry>
     </row>
     <row>
      <entry>
       <para>
        <filename>/proc/interrupts</filename>
       </para>
      </entry>
      <entry>
       <para>
        どの割り込みが使用されているか、各割り込みの使用回数を表示します。
       </para>
      </entry>
     </row>
     <row>
      <entry>
       <para>
        <filename>/proc/iomem</filename>
       </para>
      </entry>
      <entry>
       <para>
        I/Oメモリの状態を表示します。
       </para>
      </entry>
     </row>
     <row>
      <entry>
       <para>
        <filename>/proc/ioports</filename>
       </para>
      </entry>
      <entry>
       <para>
        その時点でどのI/Oポートが使用されているかを表示します。
       </para>
      </entry>
     </row>
     <row>
      <entry>
       <para>
        <filename>/proc/meminfo</filename>
       </para>
      </entry>
      <entry>
       <para>
        メモリステータスを表示します。
       </para>
      </entry>
     </row>
     <row>
      <entry>
       <para>
        <filename>/proc/modules</filename>
       </para>
      </entry>
      <entry>
       <para>
        個々のモジュールを表示します。
       </para>
      </entry>
     </row>
     <row>
      <entry>
       <para>
        <filename>/proc/mounts</filename>
       </para>
      </entry>
      <entry>
       <para>
        現在マウントされているデバイスを表示します。
       </para>
      </entry>
     </row>
     <row>
      <entry>
       <para>
        <filename>/proc/partitions</filename>
       </para>
      </entry>
      <entry>
       <para>
        すべてのハードディスクのパーティション設定を表示します。
       </para>
      </entry>
     </row>
     <row>
      <entry>
       <para>
        <filename>/proc/version</filename>
       </para>
      </entry>
      <entry>
       <para>
        現在のLinuxバージョンを表示します。
       </para>
      </entry>
     </row>
    </tbody>
   </tgroup>
  </table>

  <para>
   Linuxカーネルは、<filename>/proc</filename>ファイルシステムの場合を除いて、メモリ内ファイルシステムである<literal>sysfs</literal>モジュールで情報をエクスポートします。このモジュールは、カーネルオブジェクトとその属性および関係を表します。<literal>sysfs</literal>の詳細については、<xref linkend="cha-udev"/>でudevのコンテキストを参照してください。<xref linkend="tab-trouble-sysfs" xrefstyle="select:label nopage"/>には、<filename>/sys</filename>の下にある最も一般的なディレクトリの概要が含まれています。
  </para>

  <table xml:id="tab-trouble-sysfs">
   <title><filename>/sys</filename>ファイルシステムによるシステム情報</title>
   <tgroup cols="2">
    <thead>
     <row>
      <entry>
       <para>
        ファイル
       </para>
      </entry>
      <entry>
       <para>
        説明
       </para>
      </entry>
     </row>
    </thead>
    <tbody>
     <row>
      <entry>
       <para>
        <filename>/sys/block</filename>
       </para>
      </entry>
      <entry>
       <para>
        システム内で検出された各ブロックデバイスのサブディレクトリが含まれています。一般に、これらの大半はディスクタイプのデバイスです。
       </para>
      </entry>
     </row>
     <row>
      <entry>
       <para>
        <filename>/sys/bus</filename>
       </para>
      </entry>
      <entry>
       <para>
        各物理バスタイプのサブディレクトリが含まれます。
       </para>
      </entry>
     </row>
     <row>
      <entry>
       <para>
        <filename>/sys/class</filename>
       </para>
      </entry>
      <entry>
       <para>
        デバイスの機能タイプとしてグループ化されたサブディレクトリが含まれます(graphics、net、printerなど)。
       </para>
      </entry>
     </row>
     <row>
      <entry>
       <para>
        <filename>/sys/device</filename>
       </para>
      </entry>
      <entry>
       <para>
        グローバルなデバイス階層が含まれます。
       </para>
      </entry>
     </row>
    </tbody>
   </tgroup>
  </table>

  <para>
   Linuxには、システム解析とモニタリング用のさまざまなツールが用意されています。システム診断で使用される最も重要なツールの選択については、<xref linkend="cha-util"/>を参照してください。
  </para>

  <para>
   次の各シナリオは、問題を説明するヘッダに続いて、推奨される解決方法、より詳細な解決方法への利用可能な参照、および関連する他のシナリオへの相互参照が書かれた、1つまたは2つの段落から構成されています。
  </para>
 </sect1>

 <sect1 xml:id="sec-trouble-boot">
  <title>ブートの問題</title>

  <para>
   ブートの問題とは、システムが適切にブートしないような場合を指します(意図したターゲットおよびログイン画面までブートしない場合)。
  </para>

  <sect2 xml:id="sec-trouble-boot-nogrub">
   <title>GRUB 2ブートローダをロードできない</title>
   <para>
    ハードウェアが問題なく機能している場合、ブートローダが壊れてしまってLinuxがコンピュータ上で起動できない可能性があります。このような場合、ブートローダを修復する必要があります。そのためには、<xref linkend="sec-trouble-data-recover-rescue"/>の説明に従ってレスキューシステムを起動し、<xref linkend="sec-trouble-data-recover-rescue-grub"/>の手順に従う必要があります。
   </para>
   <para>
    または、次の手順でレスキューシステムを使用してブートローダを修復できます。インストールメディアからマシンをブートします。ブート画面で、<menuchoice><guimenu>詳細</guimenu> <guimenu>Linuxシステムのブート</guimenu></menuchoice>を選択します。インストール済みシステムとカーネルが含まれるディスク、およびデフォルトのカーネルオプションを選択します。
   </para>

   

   <para>
    システムがブートしたら、YaSTを起動して<menuchoice><guimenu>システム</guimenu> <guimenu>ブートローダ</guimenu></menuchoice>に切り替えます。<guimenu>MBRに汎用ブートコードを書き込む</guimenu>オプションが有効になっていることを確認して、<guimenu>OK</guimenu>をクリックします。これにより、ブートローダが壊れている場合は上書きして修復し、ブートローダが見つからない場合はインストールします。
   </para>

   <para>
    コンピュータが起動しない理由は他にBIOS関連のものが考えられます。
   </para>
   <variablelist>
    <varlistentry>
     <term>BIOS設定</term>
     <listitem>
      <para>
       ハードディスクの参照情報については、BIOSを確認してください。ハードディスク自体が現在のBIOS設定に見つからない場合、GRUB 2が単に開始されていない可能性があります。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>BIOSブートオーダー</term>
     <listitem>
      <para>
       お使いのシステムのブートオーダーがハードディスクを含んでいるか確認します。ハードディスクオプションが有効になっていない場合、システムは適切にインストールされていますが、ハードディスクへのアクセスが要求される際に起動に失敗する可能性があります。
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
  </sect2>

  <sect2 xml:id="sec-trouble-boot-hang" os="sled;osuse">
   <title>ログインなし、またはプロンプトが表示される</title>
   <para>
    通常、これはカーネルのアップグレードに失敗した後に発生します。プロセスの最終段階にときどき発生するシステムコンソールのエラーであるということから、<emphasis>「カーネルパニック」として知られます。</emphasis>ソフトウェアのアップグレードに続いてコンピュータを再起動した直後である場合は、実証済みの古いバージョンのLinuxカーネルおよび関連ファイルを使用して再起動します。この操作は、ブートプロセス中にGRUB 2ブートローダ画面で行います。次の手順に従ってください。
   </para>
   <procedure>
    <step>
     <para>
      コンピュータをリセットボタンで再起動するか、いったんオフにしてからオンにします。
     </para>
    </step>
    <step>
     <para>
      GRUB 2のブート画面が表示されたら、<guimenu>詳細オプション</guimenu>項目を選択して、以前のカーネルをメニューから選択します。コンピュータは、旧バージョンのカーネルとその関連ファイルを使用して起動します。
     </para>
    </step>
    <step xml:id="st-trouble-boot-hang-modify-grub">
     <para>
      ブートプロセスが完了してから、新たにインストールされたカーネルを削除します。必要に応じて、デフォルトのブート項目を、YaST<guimenu>ブートローダ</guimenu>モジュールを使用する古いカーネルに設定します。詳細については、<xref linkend="sec-grub2-yast2-config"/>を参照してください。ただし、多くの場合、このファイルの更新は必要ありません。このファイルは、通常、ロールバック処理時に自動更新ツールにより変更されるからです。
     </para>
    </step>
    <step>
     <para>
      再起動します。
     </para>
    </step>
   </procedure>
   <para>
    これでも問題が解決されない場合は、インストールメディアを使用してコンピュータをブートしてください。コンピュータが起動したら、 「<xref linkend="st-trouble-boot-hang-modify-grub" xrefstyle="StepOnPage"/>」を続行します。
   </para>
  </sect2>

  <sect2 xml:id="sec-trouble-boot-prompt">
   <title>グラフィカルログインがない</title>
   <para>
    マシンは起動するものの、グラフィカルログインマネージャがブートしない場合は、デフォルトのsystemdターゲットの選択、またはXウィンドウシステムの設定のいずれかに問題があると考えられます。現在のデフォルトのsystemdターゲットを確認するには、<command>sudo systemctl get-default</command>コマンドを実行します。返された値が<emphasis></emphasis>
    <literal>graphical.target</literal>で「ない」場合、<command>sudo systemctl isolate graphical.target</command>コマンドを実行します。グラフィカルログイン画面が起動する場合は、ログインして、<menuchoice> <guimenu>YaST</guimenu>
    <guimenu>システム</guimenu> <guimenu>サービスマネージャ</guimenu></menuchoice>を起動し、<guimenu>デフォルトのシステムターゲット</guimenu>を<guimenu>Graphical Interface (グラフィカルインタフェース)</guimenu>に設定します。今後、システムはグラフィカルログイン画面でブートするようになります。
   </para>
   <para>
    ブートするかグラフィカルターゲットに切り替わっても、グラフィカルログイン画面が起動しない場合は、ご使用のデスクトップかXウィンドウソフトウェアの設定が間違っているか、破損している可能性があります。<filename>/var/log/Xorg&#x002E;*&#x002E;log</filename>のログファイルで、Xサーバが起動を試みた際にXサーバによって記録された詳細メッセージを調べます。デスクトップの起動に失敗する場合は、システムジャーナルにエラーメッセージが記録されている場合があります。エラーメッセージは<command>journalctl</command>コマンド(詳細は<xref linkend="cha-journalctl"/>を参照)で問い合わせることができます。これらのエラーメッセージがXサーバの設定の問題を示唆している場合は、これを直すようにしてください。それでもグラフィカルシステムが起動しない場合は、グラフィカルデスクトップを再インストールすることを考えてください。
   </para>

  </sect2>

  <sect2 xml:id="sec-trouble-boot-btrfs">
   <title>ルートBtrfsパーティションをマウントできない</title>
   <para>
    <systemitem class="filesystem">btrfs</systemitem>ルートパーティションが壊れた場合は、次のオプションを試してみてください。
   </para>
   <itemizedlist>
    <listitem>
     <para>
      <option>-o recovery</option>オプションを使用してパーティションをマウントする。
     </para>
    </listitem>
    <listitem>
     <remark>toms 2014-03-12: According to FATE#315126: "this one is open to
      debate, it might do more harm than good.."</remark>
     <para>
      これが失敗する場合は、ルートパーティション上で<command>btrfs-zero-log</command>を実行する。
     </para>
    </listitem>
   </itemizedlist>
  </sect2>

  <sect2 xml:id="sec-trouble-boot-forcecheck">
   <title>ルートパーティションを強制的に確認する</title>
   <remark>toms 2016-05-18: FATE#320126</remark>
   <para>
    ルートパーティションが壊れた場合、パラメータ<parameter>forcefsck</parameter>をブートプロンプトで使用します。これにより、オプション<option>-f</option>(強制)が<command>fsck</command>コマンドに渡されます。
   </para>
  </sect2>
  
  <sect2 xml:id="sec-trouble-boot-disable-swap">
      <title>スワップを無効にしてブートを有効にする</title>
      <para>
          スワップデバイスが使用できず、システムがブート中に有効にできない場合、ブートは失敗する場合があります。次のオプションをカーネルコマンドラインに追加して、すべてのスワップデバイスを無効にしてみます。
      </para>
      <screen>systemd.device_wants_unit=off systemd.mask=swap.target</screen>
      <para>
          特定のスワップデバイスを無効にしてみることもできます。
      </para>
      <screen>systemd.mask=dev-sda1.swap</screen>
  </sect2>
  
  <sect2 xml:id="sec-trouble-boot-dual-boot">
   <title>デュアルブートシステムでの再起動中にGRUB 2が失敗する</title>
   <remark>jufa 2021-06-09: bsc#1185274</remark>
   <para>
    再起動中にGRUB 2が失敗した場合は、BIOSの<option>Fast Boot</option>設定を無効にします。
     </para>
   
  </sect2>
 </sect1>
 
 <sect1 xml:id="sec-trouble-login">
  <title>ログインの問題</title>

  <para>
   ログインの問題は、お使いのマシンが予期されるようこそ画面またはログインプロンプトまで起動するが、ユーザ名およびパスワードを受け付けない、または受け付けるが、その後適切な動きをしない場合に発生します(グラフィックデスクトップ開始の失敗、エラーの発生、コマンドラインに落ちる、など)。
  </para>

  <sect2 xml:id="sec-trouble-login-no">
   <title>有効なユーザ名とパスワードを使っても失敗する</title>
   <para>
    この問題は、一般的にシステムがネットワーク認証またはディレクトリサービスを使用するように設定されており、何らかの理由で、設定されたサーバから結果を取得できない場合に発生します。このような場合でも、<systemitem class="username">root</systemitem>ユーザは唯一のローカルユーザとしてこれらのコンピュータにログインできます。次に、コンピュータが機能しているように見えるのにログインを正しく処理できない一般的な理由をいくつか挙げます。
   </para>
   <itemizedlist>
    <listitem>
     <para>
      ネットワークが機能していません。この場合の更なる対処方法については、<xref linkend="sec-trouble-netconfig"/>を参照してください
     </para>
    </listitem>
    <listitem>
     <para>
      現在、DNSが機能していません(このためGNOMEが動作せず、システムはセキュアサーバに検証済みの要求を送信できません)。すべてのアクションに対して、コンピュータに極端に長い時間かかる場合は、この問題の可能性があります。このトピックの詳細は、<xref linkend="sec-trouble-netconfig"/>を参照してください。
     </para>
    </listitem>
    <listitem>
     <para>
      システムがKerberosを使用するように設定されている場合、システムのローカルタイムは、Kerberosサーバのタイムとの間で許容される相違を超えてしまっている可能性があります(通常 300秒)。NTP (network time protocol)が適切に動いていない、またはローカルのNTPサーバが動いていない場合、Kerberos の認証は機能しなくなります。その理由は、この認証はネットワーク間の一般的なクロック同期に依存しているからです。
     </para>
    </listitem>
    <listitem>
     <para>
      システムの認証設定が間違って設定されています。関連するPAM設定ファイルの中に誤字や命令の順序違いがないか確認します。PAMおよび関連する設定ファイルの構文に関する背景情報の詳細については、<xref linkend="cha-pam"/>を参照してください。
     </para>
    </listitem>
    <listitem>
     <para>
      ホームパーティションが暗号化されています。このトピックの詳細は、<xref linkend="sec-trouble-login-encrypted"/>を参照してください。
     </para>
    </listitem>
   </itemizedlist>
   <para>
    外部のネットワーク問題を含まない他のすべての問題については、解決方法としてシステムをシングルユーザモードに再起動して、動作モードに再び起動してログインし直す前に、設定を修復します。シングルユーザモードで起動するには、次の手順に従います。
   </para>
   <procedure xml:id="proc-trouble-login-no">
    <step>
     <para>
      システムを再起動します。ブート画面の表示に続き、プロンプトが表示されます。
     </para>
    </step>

    <step>
     <para>
      <keycap function="escape"/>を押して、スプラッシュスクリーンを終了し、GRUB 2テキストベースメニューに移動します。
     </para>
    </step>
    <step>
     <para>
      <keycap>B</keycap>を押して、GRUB 2エディタを起動します。
     </para>
    </step>
    <step>
     <para>
      カーネルパラメータを含む行に次のパラメータを追加します。
     </para>
<screen>systemd.unit=rescue.target</screen>
    </step>
    <step>
     <para>
      <keycap>F10</keycap>キーを押します。
     </para>
    </step>
    <step>
     <para>
      <systemitem class="username">root</systemitem>のユーザ名とパスワードを入力します。
     </para>
    </step>
    <step>
     <para>
      必要な変更をすべて加えます。
     </para>
    </step>
    <step>
     <para>
      コマンドラインに「<command>systemctl isolate graphical.target</command>」と入力して、完全なマルチユーザおよびネットワークモードでブートします。
     </para>
    </step>
   </procedure>
  </sect2>

  <sect2 xml:id="sec-trouble-login-pw">
   <title>有効なユーザ名とパスワードが受け付けられない</title>
   <para>
    これは、今のところユーザが経験する問題のうち、最も一般的なものです。その理由は、この問題が起こる原因がたくさんあるからです。ローカルのユーザ管理および認証を使用するか、ネットワーク認証を使用するかによって、異なる原因によりログイン失敗が発生します。
   </para>
   <para>
    ローカルユーザ管理は、次の原因により失敗する可\&apos;94\&apos;5c性があります。
   </para>
   <itemizedlist>
    <listitem>
     <para>
      間違ったパスワードを入力した可能性があります。
     </para>
    </listitem>
    <listitem>
     <para>
      ユーザのホームディレクトリが、破損または書き込み保護されたデスクトップ設定ファイルを含んでいます。
     </para>
    </listitem>
    <listitem>
     <para>
      この特定のユーザを認証するのに、X Window Systemに何らかの問題があります。特に、ユーザのホームディレクトリが、現在のLinuxをインストールする以前の他のLinuxディストリビューションによって使用されている場合です。
     </para>
    </listitem>
   </itemizedlist>
   <para>
    ローカルログイン失敗の原因を発見するには、次の手順に従います。
   </para>
   <procedure>
    <step>
     <para>
      認証方式全体をデバッグする前に、ユーザがパスワードを正しく覚えているか確認します。ユーザが正しいパスワードを覚えていない場合は、YaSTユーザ管理モジュールを使用してそのユーザのパスワードを変更します。<keycap>Caps Lock</keycap>キーに注意し、必要に応じてそのロックを解除します。
     </para>
    </step>
    <step>
     <para>
      <systemitem class="username">root</systemitem>ユーザでログインし、ログインプロセスおよびPAMのエラーメッセージがないかどうか<command>journalctl -e</command>でシステムジャーナルを確認します。
     </para>
    </step>
    <step>
     <para>
      コンソールからログインしてみます(<keycombo>
      <keycap function="control"/> <keycap function="alt"/> <keycap>F1</keycap>
      </keycombo>キーを使用)。これが成功する場合、PAMには問題はありません。その理由は、そのユーザをそのコンピュータ上で認証可能だからです。XウィンドウシステムまたはGNOMEデスクトップに問題がないか探してみてください。詳細については、<xref linkend="sec-trouble-login-dk"/>を参照してください。
     </para>
    </step>
    <step>
     <para>
      ユーザのホームディレクトリが他のLinuxディストリビューションによって使用されている場合、ユーザのホームにある<filename>Xauthority</filename>ファイルを削除します。<keycombo>
      <keycap function="control"/> <keycap function="alt"/> <keycap>F1</keycap>
      </keycombo> キーを押してコンソールログインを使用し、<command>rm .Xauthority</command>をこのユーザとして実行します。これにより、X認証の問題はこのユーザに関してはなくなるはずです。グラフィカルログインを再試行します。
     </para>
    </step>

    <step>
     <para>
      設定ファイルが壊れていて、デスクトップが開始できなかった場合、<xref linkend="sec-trouble-login-dk"/>に進みます。
     </para>
    </step>
   </procedure>
   <para>
    次に、特定のマシンで特定のユーザのネットワーク認証が失敗する一般的な理由を示します。
   </para>
   <itemizedlist>
    <listitem>
     <para>
      間違ったパスワードを入力した可能性があります。
     </para>
    </listitem>
    <listitem>
     <para>
      コンピュータのローカル認証ファイルの中に存在し、ネットワーク認証システムからも提供されるユーザ名が競合しています。
     </para>
    </listitem>
    <listitem>
     <para>
      ホームディレクトリは存在しますが、それが壊れている、または利用不可能です。書き込み保護がされているか、その時点でアクセスできないサーバ上にディレクトリが存在するかのどちらかの可\&apos;94\&apos;5c性があります。
     </para>
    </listitem>
    <listitem>
     <para>
      認証システム内で、ユーザがその特定のサーバにログインする権限がありません。
     </para>
    </listitem>
    <listitem>
     <para>
      コンピュータのホスト名が何らかの理由で変更されていて、そのホストにユーザがログインするパーミッションがありません。
     </para>
    </listitem>
    <listitem>
     <para>
      コンピュータが、認証サーバまたはそのユーザの情報を含んでいるディレクトリサーバに接続できません。
     </para>
    </listitem>
    <listitem>
     <para>
      この特定のユーザを認証するのに、X Window Systemに何らかの問題があります。特に、ユーザのホームが、現在のLinuxをインストールする以前に他のLinuxディストリビューションによって使用されている場合です。
     </para>
    </listitem>
   </itemizedlist>
   <para>
    ネットワーク認証におけるログイン失敗の原因を突き止めるには、次の手順に従います。
   </para>
   <procedure xml:id="proc-trouble-login-pw">
    <step>
     <para>
      認証方式全体をデバッグする前に、ユーザがパスワードを正しく覚えているか確認します。
     </para>
    </step>
    <step>
     <para>
      認証用にマシンが利用するディレクトリサーバを判別し、それがきちんと動作しており、他のマシンと適切に通信していることを確認します。
     </para>
    </step>
    <step>
     <para>
      ユーザのユーザ名およびパスワードが他のマシン上でも使用できるかを判別し、そのユーザの認証データが存在し、適切に配布されていることを確認します。
     </para>
    </step>
    <step>
     <para>
      別のユーザが、問題のある動きをしているマシンにログインできるかどうかを確認します。別のユーザで問題なくログインできる場合、または<systemitem class="username">root</systemitem>でログインできる場合、ログイン後、<command>journalctl -e</command>&gt;ファイルでシステムジャーナルを調べます。ログインの試行に対応するタイムスタンプを見つけ出し、PAMによって、エラーメッセージが生成されていないか判別します。
     </para>
    </step>
    <step>
     <para>
      コンソールからログインしてみます(<keycombo>
      <keycap function="control"/> <keycap function="alt"/> <keycap>F1</keycap>
      </keycombo>キーを使用)。これが成功する場合、PAMやユーザのホームがあるディレクトリサーバには問題はありません。その理由は、そのユーザをそのコンピュータ上で認証可能だからです。XウィンドウシステムまたはGNOMEデスクトップに問題がないか探してみてください。詳細については、<xref linkend="sec-trouble-login-dk"/>を参照してください。
     </para>
    </step>
    <step>
     <para>
      ユーザのホームディレクトリが他のLinuxディストリビューションによって使用されている場合、ユーザのホームにある<filename>Xauthority</filename>ファイルを削除します。<keycombo>
      <keycap function="control"/> <keycap function="alt"/> <keycap>F1</keycap>
      </keycombo> キーを押してコンソールログインを使用し、<command>rm .Xauthority</command>をこのユーザとして実行します。これにより、X認証の問題はこのユーザに関してはなくなるはずです。グラフィカルログインを再試行します。
     </para>
    </step>

    <step>
     <para>
      設定ファイルが壊れていて、デスクトップが開始できなかった場合、<xref linkend="sec-trouble-login-dk"/>に進みます。
     </para>
    </step>
   </procedure>
  </sect2>

  <sect2 xml:id="sec-trouble-login-encrypted">
   <title>暗号化されたホームパーティションへのログインが失敗します</title>
   <para>
    ラップトップでは暗号化されたホームパーティションの使用が推奨されます。ラップトップにログインできない場合、通常その理由は簡単です。パーティションのロックを解除できなかったためです。
   </para>
   <para>
    ブート時に、暗号化パーティションのロックを解除するためにパスフレーズを入力する必要があります。パスフレーズを入力しない場合、パーティションがロックしたまま起動プロセスが続行します。
   </para>
   <para>
    暗号化されたパーティションのロックを解除するには、次の手順に従います。
   </para>
   <procedure>
    <step>
     <para>
      <keycombo> <keycap function="control"/>
      <keycap function="alt"/> <keycap>F1</keycap> </keycombo>でテキストコンソールに切り替えます。
     </para>
    </step>
    <step>
     <para>
      <systemitem class="username">root</systemitem>になります。
     </para>
    </step>
    <step>
     <para>
      次のコマンドにより、ロックを解除するプロセスを再開します。
     </para>
<screen><prompt role="root"># </prompt>systemctl restart home.mount</screen>
    </step>
    <step>
     <para>
      暗号化されたパーティションのロックを解除するためのパスフレーズを入力します。
     </para>
    </step>
    <step>
     <para>
      テキストコンソールを終了し、<keycombo>
      <keycap function="alt"/> <keycap>F7</keycap> </keycombo>でログイン画面に切り替えます。
     </para>
    </step>
    <step>
     <para>
      通常通りログインします。
     </para>
    </step>
   </procedure>
  </sect2>

  <sect2 xml:id="sec-trouble-login-dk">
   <title>GNOMEデスクトップに問題があります</title>
   <para>
     GNOMEデスクトップで問題が発生している場合は、グラフィカルなデスクトップ環境の動作不良をトラブルシューティングするためのいくつかの方法があります。次に説明する推奨手順は、壊れたGNOMEデスクトップを修復するための最も安全なオプションを提供します。
   </para>
   <procedure>
     <title>GNOMEのトラブルシューティング</title>
     <step>
       <para>
	 YaSTを起動し、<guimenu>セキュリティとユーザ</guimenu>に切り替えます。
       </para>
     </step>
     <step>
       <para>
	 <guimenu>ユーザおよびグループの管理</guimenu>ダイアログを開いて、<guimenu>追加</guimenu>をクリックします。
       </para>
     </step>
     <step>
       <para>
	 必須フィールドに入力して、<guimenu>OK</guimenu>をクリックし、新しいユーザを作成します。
       </para>
     </step>
     <step>
       <para>
	 ログアウトして、新しいユーザとしてログインします。これにより、新しいGNOME環境が提供されます。
       </para>
     </step>
     <step>
       <para>
	 古いユーザアカウントの<filename>~/.local/</filename>と<filename>~/.config/</filename>ディレクトリから新しいユーザアカウントの各ディレクトリに個々のサブディレクトリをコピーします。
       </para>
       <para>
	 コピー操作を行うたびにログアウトして、新しいユーザとして再度ログインし、GNOMEが引き続き正常に動作するかどうかを確認します。
       </para>
     </step>
     <step>
       <para>
	 GNOMEを壊す設定ファイルが見つかるまで、前の手順を繰り返します。
       </para>
     </step>
     <step>
       <para>
	 古いユーザとしてログインし、問題のある設定ファイルを別の場所に移動します。ログアウトして、古いユーザとして再度ログインします。
       </para>
     </step>
     <step>
       <para>
	 以前に作成したユーザを削除します。
       </para>
     </step>
   </procedure>
  </sect2>

 </sect1>
 <sect1 xml:id="sec-trouble-netconfig">
  <title>ネットワークの問題</title>

  <para>
   システム上の問題は、最初はそうは見えないのですが、ネットワークに関する問題であることが多いです。たとえば、システムにユーザがログインできない理由は、ある種のネットワークの問題であったりします。ここでは、ネットワークの問題に直面した場合の簡単なチェックリストを紹介します。
  </para>

  <procedure xml:id="proc-trouble-config-net">
   <title>ネットワークの問題を識別する方法</title>
   <para>
    コンピュータとネットワークの接続の確認をする場合、以下の手順に従ってください。
   </para>
   <step>
    <para>
     Ethernet接続を使用する場合、はじめにハードウェアを確認します。ネットワークケーブルがコンピュータおよびルータ(またはハブなど)にしっかり差し込まれていることを確認してください。Ethernetコネクタの横に制御ランプがある場合、通常はその両方がアクティブになります。
    </para>
    <para>
     接続に失敗する場合、お使いのネットワークケーブルが他のコンピュータでは使用可能かどうか確認します。使用可能な場合、ネットワークカードに問題の原因があります。ネットワークのセットアップにハブやスイッチを使用している場合は、それらが誤っている可能性もあります。
    </para>
   </step>
   <step>
    <para>
     無線接続を使用する場合、他のコンピュータからワイヤレスリンクが確立できるかどうか確認します。そうでない場合は、無線ネットワークの管理者にお問い合わせください。
    </para>
   </step>
   <step>
    <para>
     基本的なネットワーク接続を確認し終わったら、どのサービスが応答していないかを探します。お使いの構成上のすべてのネットワークサーバのアドレス情報を集めます。適切なYaSTモジュール内で探すか、システム管理者に問い合わせてください。次のリストには、セットアップにかかわる一般的なネットワークサーバを、それらの故障の兆候とともに表わしています。
    </para>
    <variablelist>
     <varlistentry>
      <term>DNS (ネームサービス)</term>
      <listitem>
       <para>
        壊れた、あるいは誤作動しているネームサービスは、ネットワークの機能にさまざまな形で影響を与えます。ローカルマシンの認証をネットワークサーバで行っている場合、名前解決に問題があるためにそれらのサーバが見つからないと、ユーザはログインすることもできません。壊れたネームサーバが管理するネットワーク内のマシンは、お互いを<quote>認識</quote>できないため通信できません。
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>NTP (タイムサービス)</term>
      <listitem>
       <para>
        誤作動している、または完全に壊れたNTPサービスは、Kerberosの認証およびXサーバの機\&apos;94\&apos;5cに影響を与えます。
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>NFS (ファイルサービス)</term>
      <listitem>
       <para>
        NFSマウントされたディレクトリに保存されたデータを必要とするアプリケーションがあった場合、このサービスがダウンしてるか、間違って設定されていると、そのアプリケーションは起動できないか、正しく機能しません。最悪のケースとしては、<filename>.gconf</filename>サブディレクトリを含んでいる、あるユーザのホームディレクトリが、NFSサーバの故障のために検出されなかった場合、そのユーザ個人のデスクトップ設定が起動しません。
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>Samba (ファイルサービス)</term>
      <listitem>
       <para>
        故障したSambaサーバ上のディレクトリに保存されたデータを必要とするアプリケーションがある場合、そのアプリケーションは起動できないか、正しく機能しません。
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>NIS (ユーザ管理)</term>
      <listitem>
       <para>
        <phrase role="productname"><phrase os="sled">SUSE Linux Enterprise Desktop</phrase></phrase>システムがユーザデータを提供するために故障したNISサーバを使用している場合、ユーザはマシンにログインできません。
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>LDAP (ユーザ管理)</term>
      <listitem>
       <para>
        <phrase role="productname"><phrase os="sled">SUSE Linux Enterprise Desktop</phrase></phrase>システムがユーザデータを提供するために故障したLDAPサーバを使用している場合、ユーザはマシンにログインできません。
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>Kerberos (認証)</term>
      <listitem>
       <para>
        認証が機能せず、すべてのコンピュータへのログインが失敗します。
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>CUPS (ネットワーク印刷)</term>
      <listitem>
       <para>
        ユーザが印刷できません。
       </para>
      </listitem>
     </varlistentry>
    </variablelist>
   </step>
   <step>
    <para>
     ネットワークサーバが起動しているか、ネットワーク上で接続を確立できる設定になっているか、を確認します。
    </para>
    <important>
     <title>制限</title>
     <para>
      次で説明するデバッグの手順は、内部ルーティングを必要としない、簡単なネットワークサーバ/クライアント設定にのみ適用されます。サーバとクライアントの両方が、追加でルーティングする必要のない同じサブネットのメンバーであることが前提です。
     </para>
    </important>
    <substeps performance="required">
     <step>
      <para>
       <command>ping</command>
       <replaceable>IP_ADDRESS/HOSTNAME</replaceable>(サーバのホスト名またはIPアドレスで置き換えます)を使って、サーバが起動中で、ネットワークに反応するかどうか確認します。このコマンドが成功する場合は、目的のホストは起動しており、ネットワークのネームサービスは正しく設定されていることがわかります。
      </para>
      <para>
       pingが「<literal>destination host unreachable</literal>」というメッセージで失敗する場合、お使いのシステムまたは宛先のサーバが正しく設定されていないか、ダウンしています。その場合、他のコンピュータから<command>ping</command> <replaceable>IP address</replaceable>または<replaceable>YOUR_HOSTNAME</replaceable>を実行して、お使いのシステムに到達可能か確認してください。他のマシンからお使いのコンピュータに接続可能な場合には、宛先のサーバが動作していないか、正しく設定されていません。
      </para>
      <para>
       pingが「<literal>unknown host</literal>」というメッセージで失敗する場合、ネームサービスが正しく設定されていないか、使用したホスト名が正しくありません。この問題を詳細に調べるには、<xref linkend="st-trouble-config-net-host" xrefstyle="StepOnPage"/>を参照してください。それでもpingが失敗する場合は、ネットワークカードが正しく設定されていないか、ネットワークのハードウェアに障害があります。
      </para>
     </step>
     <step xml:id="st-trouble-config-net-host">
      <para>
       <command>host</command> <replaceable>HOSTNAME</replaceable>を使用して、接続しようとしているサーバのホスト名が適切なIPアドレスに変換され、またその逆も問題ないか確認します。このコマンドによって、このホストのIPアドレスが返される場合、ネームサービスは起動中です。この<command>host</command>コマンドが失敗する場合、お使いのホスト上の名前とアドレス解決に関係するすべてのネットワーク設定ファイルを確認します。
      </para>
      <variablelist>
       <varlistentry>
        <term><filename>/var/run/netconfig/resolv.conf</filename>
        </term>
        <listitem>
         <para>
          このファイルは、ネームサーバおよび現在使用中のドメインを管理するために使用されます。これは<filename>/run/netconfig/resolv.conf</filename>へのシンボリックリンクであり、通常、YaSTまたはDHCPによって自動的に調整されます。ただし、このファイルが以下のような構造およびネットワークアドレスを含んでいること、さらにドメイン名が正しいことを確認してください。
         </para>
<screen>search <replaceable>FULLY_QUALIFIED_DOMAIN_NAME</replaceable>
nameserver <replaceable>IPADDRESS_OF_NAMESERVER</replaceable></screen>
         <para>
          このファイルには1つ以上のネームサーバのアドレスを含むことができますが、その中の少なくとも1つは、お使いのホストの名前解決が正しくできる必要があります。必要に応じて、YaSTネットワーク設定モジュール(［ホスト名/DNS］タブ)を使用してこのファイルを修正します。
         </para>
         <para>
          ネットワーク接続をDHCPで処理している場合は、DHCPでホスト名とネームサービスの情報を変更できるようにします。このためには、YaSTネットワーク設定モジュール(［ホスト名/DNS］タブ)で、<guimenu>DHCPでホスト名を設定</guimenu> (すべてのインタフェースに対してグローバルに設定することも、インタフェースごとに設定することもできます)、および<guimenu>Update Name Servers and Search List via DHCP (DHCPでネームサーバと検索リストを更新)</guimenu>を選択します。
         </para>
        </listitem>
       </varlistentry>
       <varlistentry>
        <term><filename>/etc/nsswitch.conf</filename>
        </term>
        <listitem>
         <para>
          このファイルは、Linuxがネームサービス情報を探す場所を示します。このようになります。
         </para>
<screen> ...
hosts: files dns
networks: files dns
...</screen>
         <para>
          <option>dns</option>エントリは必須です。これにより、Linuxは外部のネームサーバを使用するようになります。通常、これらのエントリはYaSTにより自動的に管理されますが、慎重にチェックする必要があります。
         </para>
         <para>
          ホスト上で、すべての関連エントリが正しい場合は、システム管理者に依頼して、正しいゾーン情報に関するDNSサーバの設定を確認してもらいます。お使いのホストのDNS設定およびDNSサーバが正しいことが確認できた場合、ネットワークおよびネットワークデバイス設定の確認に進みます。
         </para>
        </listitem>
       </varlistentry>
      </variablelist>
     </step>
     <step>
      <para>
       お使いのシステムがネットワークサーバに接続できない状況で、ネームサービスの問題を障害原因の可能性リストから除外した場合は、ネットワークカードの設定を確認します。
      </para>
      <para>
       <command>ip addr show</command>
       <replaceable>NETWORK_DEVICE</replaceable>コマンドを使用して、このデバイスが適切に設定されているか確認します。<option>inet address</option>がネットマスク(<literal>/<replaceable>MASK</replaceable></literal>)を使用して正しく設定されていることを確認します。IPアドレス内に間違いがある場合、またはネットワークマスク内で不明のビットがある場合は、ネットワーク設定が使用不可能になります。必要であれば、サーバ上でもこの確認をしてください。
      </para>
     </step>
     <step>
      <para>
       ネームサービスおよびネットワークサービスが正しく設定され起動している場合でも、外部のネットワーク接続がタイムアウトするのに時間がかかったり、完全に失敗する場合は、<command>traceroute</command>
       <replaceable>FULLY_QUALIFIED_DOMAIN_NAME</replaceable> (<systemitem class="username">root</systemitem>ユーザで実行)コマンドを使用して、リクエストがネットワーク上でどのルートを使用するか追跡します。このコマンドは、お使いのコンピュータのリクエストが宛先に到達するまでに経由するゲートウェイ(ホップ)をリストします。各ホップの応答時間およびこのホップに到達可能かどうかをリストします。tracerouteおよびpingコマンドを組み合わせて原因を追究し、管理者に知らせてください。
      </para>
     </step>
    </substeps>
   </step>
  </procedure>

  <para>
   ネットワーク障害の原因を突き止めたら、自身でそれを解決するか(自分のコンピュータ上に問題がある場合)、お使いのネットワークのシステム管理者に原因について報告し、サービスを再設定するか、必要なシステムを修理してもらってください。
  </para>

  <sect2 xml:id="sec-trouble-networkmanager">
   <title>NetworkManagerの問題</title>
   <remark>This is a bit small, needs more text.</remark>
   <para>
    ネットワーク接続に問題がある場合は、<xref linkend="proc-trouble-config-net"/>の説明に従って原因を絞り込んでください。NetworkManagerが原因と考えられる場合は、以降の説明に従ってNetworkManager障害の理由を調べるために役立つログを取得してください。
   </para>
   <procedure>
    <step>
     <para>
      シェルを開いて、<systemitem class="username">root</systemitem>としてログインします。
     </para>
    </step>
    <step>
     <para>
      NetworkManagerを再起動します。
     </para>
<screen><prompt>&gt; </prompt><command>sudo</command> systemctl restart NetworkManager</screen>
    </step>
    <step>
     <para>
      一般ユーザとして<link xlink:href="http://www.opensuse.org"/>などのWebページを開いて、正常に接続できているかどうかを確認します。
     </para>
    </step>
    <step>
     <para>
      <filename>/var/log/NetworkManager</filename>にある、NetworkManagerに関する情報を収集します。
     </para>
    </step>
   </procedure>
   <para>
    NetworkManagerについての詳細は、<xref linkend="cha-nm"/>を参照してください。
   </para>
  </sect2>
 </sect1>
 <sect1 xml:id="sec-trouble-data">
  <title>データの問題</title>

  <para>
   データの問題とは、コンピュータが正常に起動するかしないかに関係なく、システム上でデータが壊れており、システムの修復が必要な場合を言います。このような状況では、システムに障害が発生する前の状態にシステムを復元するために、重要なデータをバックアップする必要があります。
  </para>

  <sect2 xml:id="sec-trouble-data-partitions">
   <title>パーティションイメージの管理</title>
   <para>
    パーティション全体、さらにはハードディスク全体からバックアップを実行することが必要になる場合があります。Linuxには、ディスクの正確なコピーを作成できる<command>dd</command>ツールが付属しています。<command>gzip</command>と組み合わせることで、若干の領域の節約になります。
   </para>
   <procedure>
    <title>ハードディスクのバックアップと復元</title>
    <step>
     <para>
      <systemitem class="username">root</systemitem>ユーザとしてシェルを起動します。
     </para>
    </step>
    <step>
     <para>
      ソースデバイスを選択します。これは、<filename>/dev/sda</filename>などが一般的です(<replaceable>SOURCE</replaceable>というラベルが付きます)。
     </para>
    </step>
    <step>
     <para>
      イメージを保存する場所を決めます(<replaceable>BACKUP_PATH</replaceable>というラベルが付きます)。これは、ソースデバイスとは異なる場所にする必要があります。つまり、<filename>/dev/sda</filename>からバックアップを作成する場合、イメージファイルは<filename>/dev/sda</filename>に保存しないでください。
     </para>
    </step>
    <step>
     <para>
      コマンドを実行して圧縮イメージファイルを作成します。
     </para>
<screen><prompt role="root"># </prompt>dd if=/dev/<replaceable>SOURCE</replaceable> | gzip &gt; /<replaceable>BACKUP_PATH</replaceable>/image.gz </screen>
    </step>
    <step>
     <para>
      次のコマンドによりハードディスクを復元します。
     </para>
<screen><prompt role="root"># </prompt>gzip -dc /<replaceable>BACKUP_PATH</replaceable>/image.gz | dd of=/dev/<replaceable>SOURCE</replaceable></screen>
    </step>
   </procedure>
   <para>
    パーティションをバックアップするだけでよい場合は、<replaceable>SOURCE</replaceable>プレースホルダを各パーティションに置き換えます。この場合、イメージファイルを同じハードディスクにおくことができます。ただし、パーティションは異なります。
   </para>
  </sect2>





  <xi:include href="system_repair.xml"/>
 </sect1>
 
 
</chapter>
