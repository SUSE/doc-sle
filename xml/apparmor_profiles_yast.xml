<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE chapter PUBLIC "-//Novell//DTD NovDoc XML V1.0//EN" "novdocx.dtd"
[
  <!ENTITY % NOVDOC.DEACTIVATE.IDREF "INCLUDE">
  <!ENTITY % entities SYSTEM "entity-decl.ent">
  %entities;
]>
<chapter role="General" id="cha.apparmor.yast">
 <title>Building and Managing Profiles with &yast;</title>
 <para>
  &yast; provides an easy way to build profiles and manage &aareg;. It
  provides two interfaces: a graphical one and a text-based one. The
  text-based interface consumes less resources and bandwidth, making it a
  better choice for remote administration, or for times when a local
  graphical environment is inconvenient. Although the interfaces have
  differing appearances, they offer the same functionality in similar ways.
  Another alternative is to use &aa; commands, which can control &aa; from a
  terminal window or through remote connections. The command line tools are
  described in <xref linkend="cha.apparmor.commandline"/>.
 </para>
 <para>
  Start &yast; from the main menu and enter your &rootuser; password when
  prompted for it. Alternatively, start &yast; by opening a terminal window,
  logging in as &rootuser;, and entering <command>yast2</command> for the
  graphical mode or <command>yast</command> for the text-based mode.
 </para>
 <figure>
  <title>&yast; Controls for &aa;</title>
  <mediaobject>
   <textobject role="description"><phrase>&yast;'s main controls for
      &aa;</phrase>
   </textobject>
   <imageobject role="fo">
    <imagedata format="PNG" fileref="y2_aa_main.png" width="70%"/>
   </imageobject>
   <imageobject role="html">
    <imagedata format="PNG" fileref="y2_aa_main.png"/>
   </imageobject>
  </mediaobject>
 </figure>
 <para>
  The right frame shows the &aa; options:
 </para>
 <variablelist>
  <varlistentry>
   <term>Add Profile Wizard</term>
   <listitem>
    <para>
     For detailed steps, refer to
     <xref linkend="sec.apparmor.yast.wizard"/>.
    </para>
   </listitem>
  </varlistentry>
  <varlistentry>
   <term>Manually Add Profile</term>
   <listitem>
    <para>
     Add a &aa; profile for an application on your system without the help
     of the wizard. For detailed steps, refer to
     <xref linkend="sec.apparmor.yast.add"/>.
    </para>
   </listitem>
  </varlistentry>
  <varlistentry>
   <term>Edit Profile</term>
   <listitem>
    <para>
     Edits an existing &aa; profile on your system. For detailed steps,
     refer to <xref linkend="sec.apparmor.yast.edit"/>.
    </para>
   </listitem>
  </varlistentry>
  <varlistentry>
   <term>Delete Profile</term>
   <listitem>
    <para>
     Deletes an existing &aa; profile from your system. For detailed steps,
     refer to <xref linkend="sec.apparmor.yast.del"/>.
    </para>
   </listitem>
  </varlistentry>
  <varlistentry>
   <term>Update Profile Wizard</term>
   <listitem>
    <para>
     For detailed steps, refer to
     <xref linkend="sec.apparmor.yast.update"/>.
    </para>
   </listitem>
  </varlistentry>

  <!-- fs 2011-11-09 - see bnc #722915
     (reporting is not available in 12.1 (aa-eventd isn't maintained upstream,
      and doesn't understand the (not-so-)new audit.log format))
  <varlistentry>
   <term>&aa; Reports</term>
   <listitem>
    <para>
     For detailed steps, refer to
     <xref linkend="sec.apparmor.managing.config_reports"/>.
    </para>
   </listitem>
  </varlistentry>
-->
  <varlistentry>
   <term>&aa; Control Panel</term>
   <listitem>
    <para>
     For detailed steps, refer to
     <xref linkend="sec.apparmor.yast.manage"/>.
    </para>
   </listitem>
  </varlistentry>
 </variablelist>
 <sect1 id="sec.apparmor.yast.wizard">
  <title>Adding a Profile Using the Wizard</title>

  <para>
   <guimenu>Add Profile Wizard</guimenu> is designed to set up &aa;
   profiles using the &aa; profiling tools, <command>aa-genprof</command>
   (generate profile) and <command>aa-logprof</command> (update profiles
   from learning mode log file). For more information about these tools,
   refer to
   <xref xrefstyle="SectTitleOnPage" linkend="sec.apparmor.commandline.profiling.summary"/>.
  </para>

  <procedure>
   <step>
    <para>
     Stop the application before profiling it to ensure that application
     start-up is included in the profile. To do this, make sure that the
     application or daemon is not running.
    </para>
    <para>
     For example, enter <command>rc<replaceable>PROGRAM</replaceable>
     stop</command> (or
     <command>/etc/init.d/<replaceable>PROGRAM</replaceable> stop</command>)
     in a terminal window while logged in as &rootuser;, replacing
     <replaceable>PROGRAM</replaceable> with the name of the program to
     profile.
    </para>
   </step>
   <step>
    <para>
     Start &yast; and select <menuchoice> <guimenu>&aa;</guimenu>
     <guimenu>Add Profile Wizard</guimenu> </menuchoice>.
    </para>
    <informalfigure>
     <mediaobject>
      <textobject role="description"><phrase>Choose the application to
	profile</phrase>
      </textobject>
      <imageobject role="fo">
       <imagedata format="PNG" fileref="sd_profilecreationwizard_1.png" width="75%"/>
      </imageobject>
      <imageobject role="html">
       <imagedata format="PNG" fileref="sd_profilecreationwizard_1.png"/>
      </imageobject>
     </mediaobject>
    </informalfigure>
   </step>
   <step>
    <para>
     Enter the name of the application or browse to the location of the
     program.
    </para>
   </step>
   <step os="slert">
    <para>
     Click <guimenu>Create</guimenu>. This runs an &aa; tool named
     <command>aa-autodep</command>, which performs a static analysis of the
     program to profile and loads an approximate profile into the &aa;
     module. For more information about <command>aa-autodep</command>, refer
     to
     <xref
       xrefstyle="HeadingOnPage" linkend="sec.apparmor.commandline.profiling.summary.autodep"/>.
    </para>
    <para>
     The <guimenu>&aa; Profile Wizard</guimenu> window opens.
    </para>
    <informalfigure>
     <mediaobject>
      <textobject role="description"><phrase>The &aa; Profile
	 Wizard</phrase>
      </textobject>
      <imageobject role="fo">
       <imagedata format="PNG" fileref="sd_profilecreationwizard_2.png" width="75%"/>
      </imageobject>
      <imageobject role="html">
       <imagedata format="PNG" fileref="sd_profilecreationwizard_2.png"/>
      </imageobject>
     </mediaobject>
    </informalfigure>
    <para>
     In the background, &aa; also sets the profile to learning mode. For
     more information about learning mode, refer to
     <xref linkend="sec.apparmor.commandline.profiling.summary.complain"/>.
    </para>
   </step>
   <step os="sles;osuse;sled">
    <para>
     Click <guimenu>Create</guimenu>. This runs an &aa; tool named
     <command>aa-autodep</command>, which performs a static analysis of the
     program to profile and loads an approximate profile into the &aa;
     module. For more information about <command>aa-autodep</command>, refer
     to
     <xref
       xrefstyle="HeadingOnPage" linkend="sec.apparmor.commandline.profiling.summary.autodep"/>.
    </para>
    <para>
     Depending on whether the profile you are about to create already exists
     either in the local profile repository (see
     <xref
      linkend="sec.apparmor.repos.local"/>) or in the external
     profile repository (see <xref linkend="cha.apparmor.repos"/>) or
     whether it does not exist yet, proceed with one of the following
     options:
    </para>
    <itemizedlist>
     <listitem>
      <para>
       Determine whether you want to use or fine-tune an already existing
       profile from your local profile repository, as outlined in
       <xref
	linkend="st.apparmor.yast.wizard.local"/>.
      </para>
     </listitem>
     <listitem>
      <para>
       Determine whether you want to use or fine-tune an already existing
       profile from the external profile repository, as outlined in
       <xref linkend="st.apparmor.yast.wizard.ext"/>.
      </para>
     </listitem>
     <listitem>
      <para>
       Create the profile from scratch and proceed with
       <xref
	linkend="st.apparmor.yast.wizard.run"/> and beyond.
      </para>
     </listitem>
    </itemizedlist>
   </step>
   <step id="st.apparmor.yast.wizard.local" os="osuse;sles;sled">
    <para>
     If the profile already exists in the local profile repository under
     <filename>/etc/apparmor/profiles/extra</filename>, &yast; informs you
     that there is an inactive profile which you can either use as a base
     for your own efforts or which you can just accept as is.
    </para>
    <para>
     Alternatively, you can choose not to use the local version at all and
     start creating the profile from scratch. In any case, proceed with
     <xref linkend="st.apparmor.yast.wizard.run"/>.
    </para>
   </step>
   <step id="st.apparmor.yast.wizard.ext" os="osuse;sles;sled">
    <para>
     If the profile already exists in the external profile repository and
     this is the first time you tried to create a profile that already
     exists in the repository, configure your access to the server and
     determine how to use it:
    </para>
    <substeps>
     <step>
      <para>
       Determine whether you want to enable access to the external
       repository or postpone this decision. In case you have selected
       <guimenu>Enable Repository</guimenu>, determine the access mode
       (download/upload) in a next step. In case you want to postpone the
       decision, select <guimenu>Ask Me Later</guimenu> and proceed directly
       to <xref linkend="st.apparmor.yast.wizard.run"/>.
      </para>
     </step>
     <step>
      <para>
       Provide username and password for your account on the profile
       repository server and register at the server.
      </para>
     </step>
     <step>
      <para>
       Select the profile to use and proceed to
       <xref
	linkend="st.apparmor.yast.wizard.run"/>.
      </para>
     </step>
    </substeps>
   </step>
   <step id="st.apparmor.yast.wizard.run">
    <para>
     Run the application to profile.
    </para>
   </step>
   <step>
    <para>
     Perform as many of the application functions as possible, so that
     learning mode can log the files and directories to which the program
     requires access to function properly. Be sure to include restarting and
     stopping the program in the exercised functions. &aa; needs to handle
     these events, as well as any other program function.
    </para>
   </step>
   <step id="st.apparmor.yast.wizard.scan">
    <para>
     Click <guimenu>Scan system log for &aa; events</guimenu> to parse the
     learning mode log files. This generates a series of questions that you
     must answer to guide the wizard in generating the security profile.
    </para>
    <para>
     If requests to add hats appear, proceed to
     <xref linkend="cha.apparmor.hat"/>.
    </para>
<?dbfo-need height="10em"?>
    <para>
     The questions fall into two categories:
    </para>
    <itemizedlist>
     <listitem>
      <para>
       A resource is requested by a profiled program that is not in the
       profile (see <xref linkend="fig.apparmor.yast.wizard.learn"/>). Allow
       or deny access to a specific resource.
      </para>
     </listitem>
     <listitem>
      <para>
       A program is executed by the profiled program and the security domain
       transition has not been defined (see
       <xref
	linkend="fig.apparmor.yast.wizard.perms"/>). Define execute
       permissions for an entry.
      </para>
     </listitem>
    </itemizedlist>
    <para>
     Each of these cases results in a series of questions that you must
     answer to add the resource to the profile or to add the program to the
     profile. For an example of each case, see
     <xref linkend="fig.apparmor.yast.wizard.learn"/> and
     <xref linkend="fig.apparmor.yast.wizard.perms"/>. Subsequent steps
     describe your options in answering these questions.
    </para>
    <note>
     <title>Varying Processing Options</title>
     <para>
      Depending on the type of entry processed, the available options vary.
     </para>
    </note>
    <figure id="fig.apparmor.yast.wizard.learn">
     <title>Learning Mode Exception: Controlling Access to Specific Resources</title>
     <mediaobject>
      <imageobject role="fo">
       <imagedata format="PNG" fileref="sd_profilecreationwizard_3.png" width="75%"/>
      </imageobject>
      <imageobject role="html">
       <imagedata fileref="sd_profilecreationwizard_3.png" format="PNG"/>
      </imageobject>
     </mediaobject>
    </figure>
    <figure id="fig.apparmor.yast.wizard.perms">
     <title>Learning Mode Exception: Defining Execute Permissions for an Entry</title>
     <mediaobject>
      <imageobject role="fo">
       <imagedata format="PNG" fileref="sd_profilecreationwizard_3exb.png" width="75%"/>
      </imageobject>
      <imageobject role="html">
       <imagedata fileref="sd_profilecreationwizard_3exb.png" format="PNG"/>
      </imageobject>
     </mediaobject>
    </figure>
<?dbfo-need height="20em"?>
   </step>
   <step>
    <para>
     The <guimenu>Add Profile Wizard</guimenu> begins suggesting directory
     path entries that have been accessed by the application profiled (as
     seen in <xref linkend="fig.apparmor.yast.wizard.learn"/>) or requires
     you to define execute permissions for entries (as seen in
     <xref
      linkend="fig.apparmor.yast.wizard.perms"/>).
    </para>
    <itemizedlist>
     <listitem>
      <para>
       For
       <xref linkend="fig.apparmor.yast.wizard.learn" xrefstyle="select:label title
	nopage"/>:
       Select the option that satisfies the request for access, which could
       be a suggested include, a particular globbed version of the path, or
       the actual pathname. Depending on the situation, these options are
       available:
      </para>
      <variablelist>
       <varlistentry>
        <term><literal>#include</literal>
        </term>
        <listitem>
         <para>
          The section of a &aa; profile that refers to an include file.
          Include files give access permissions for programs. By using an
          include, you can give the program access to directory paths or
          files that are also required by other programs. Using includes can
          reduce the size of a profile. It is good practice to select
          includes when suggested.
         </para>
        </listitem>
       </varlistentry>
       <varlistentry>
        <term>Globbed Version</term>
        <listitem>
         <para>
          Accessed by clicking <guimenu>Glob</guimenu>. For information
          about globbing syntax, refer to
          <xref linkend="sec.apparmor.profiles.glob"/>.
         </para>
        </listitem>
       </varlistentry>
       <varlistentry>
        <term>Actual Pathname</term>
        <listitem>
         <para>
          Literal path that the program needs to access to run properly.
         </para>
        </listitem>
       </varlistentry>
      </variablelist>
      <para>
       After selecting a directory path, process it as an entry to the &aa;
       profile by clicking <guimenu>Allow</guimenu> or
       <guimenu>Deny</guimenu>. If you are not satisfied with the directory
       path entry as it is displayed, you can also <guimenu>Glob</guimenu>
       or <guimenu>Edit</guimenu> it.
      </para>
      <para>
       The following options are available to process the learning mode
       entries and build the profile:
      </para>
      <variablelist>
       <varlistentry>
        <term>Allow</term>
        <listitem>
         <para>
          Grant the program access to the specified directory path entries.
          The <guimenu>Add Profile Wizard</guimenu> suggests file permission
          access. For more information about this, refer to
          <xref xrefstyle="SectTitleOnPage" linkend="sec.apparmor.profiles.perm"/>.
         </para>
        </listitem>
       </varlistentry>
       <varlistentry>
        <term>Deny</term>
        <listitem>
         <para>
          Click <guimenu>Deny</guimenu> to prevent the program from
          accessing the specified paths.
         </para>
        </listitem>
       </varlistentry>
       <varlistentry>
        <term>Glob</term>
        <listitem>
         <para>
          Clicking this modifies the directory path (using wild cards) to
          include all files in the suggested directory. Double-clicking it
          grants access to all files and subdirectories beneath the one
          shown. For more information about globbing syntax, refer to
          <xref xrefstyle="SectTitleOnPage" linkend="sec.apparmor.profiles.glob"/>.
         </para>
        </listitem>
       </varlistentry>
       <varlistentry>
        <term>Glob w/Ext</term>
        <listitem>
         <para>
          Modify the original directory path while retaining the filename
          extension. A single click causes
          <filename>/etc/apache2/file.ext</filename> to become
          <filename>/etc/apache2/*.ext</filename>, adding the wild card
          (asterisk) in place of the filename. This allows the program to
          access all files in the suggested directories that end with the
          <filename>.ext</filename> extension. When you double-click it,
          access is granted to all files with the particular extension and
          subdirectories beneath the one shown.
         </para>
        </listitem>
       </varlistentry>
       <varlistentry>
        <term>Edit</term>
        <listitem>
         <para>
          Edit the highlighted line. The new edited line appears at the
          bottom of the list.
         </para>
        </listitem>
       </varlistentry>
       <varlistentry>
        <term>Abort</term>
        <listitem>
         <para>
          Abort <command>aa-logprof</command>, losing all rule changes
          entered so far and leaving all profiles unmodified.
          <remark>rwalter: I am
           not keen on this unexplained ref to the command line tools. For
           future (10.3 preferably), either explain this or kill it. If it
           _only_ aborts the back-end (<command>aa-logprof</command>), I'd go
           for explaining ahead of time. If it aborts the YaST module, I'd go
           for killing.</remark>
         </para>
        </listitem>
       </varlistentry>
       <varlistentry>
        <term>Finish</term>
        <listitem>
         <para>
          Close <command>aa-logprof</command>, saving all rule changes
          entered so far and modifying all profiles.
         </para>
        </listitem>
       </varlistentry>
      </variablelist>
      <para>
       Click <guimenu>Allow</guimenu> or <guimenu>Deny</guimenu> for each
       learning mode entry. These help build the &aa; profile.
      </para>
      <note>
       <para>
        The number of learning mode entries corresponds to the complexity of
        the application.
       </para>
      </note>
     </listitem>
     <listitem>
      <para>
       For
       <xref linkend="fig.apparmor.yast.wizard.perms" xrefstyle="select:label title
	nopage"/>:
       From the following options, select the one that satisfies the request
       for access. For detailed information about the options available,
       refer to <xref linkend="sec.apparmor.profiles.perm"/>.
      </para>
      <variablelist>
       <varlistentry>
        <term>Inherit</term>
        <listitem>
         <para>
          Stay in the same security profile (parent's profile).
         </para>
        </listitem>
       </varlistentry>
       <varlistentry>
        <term>Profile</term>
        <listitem>
         <para>
          Require a separate profile to exist for the executed program. When
          selecting this option, also select whether &aa; should sanitize
          the environment when switching profiles by removing certain
          environment variables that can modify the execution behavior of
          the child process. Unless these variables are absolutely required
          to properly execute the child process, always choose the more
          secure, sanitized option.
         </para>
        </listitem>
       </varlistentry>
       <varlistentry>
        <term>Unconfined</term>
        <listitem>
         <para>
          Execute the program without a security profile. When prompted,
          have &aa; sanitize the environment to avoid adding security risks
          by inheriting certain environmental variables from the parent
          process.
         </para>
         <warning>
          <title>Risks of Running Unconfined</title>
          <para>
           Unless absolutely necessary, do not run unconfined. Choosing the
           <guimenu>Unconfined</guimenu> option executes the new program
           without any protection from &aa;.
          </para>
         </warning>
        </listitem>
       </varlistentry>
       <varlistentry>
        <term>Deny</term>
        <listitem>
         <para>
          Click <guimenu>Deny</guimenu> to prevent the program from
          accessing the specified paths.
         </para>
        </listitem>
       </varlistentry>
       <varlistentry>
        <term>Abort</term>
        <listitem>
         <para>
          Abort <command>aa-logprof</command>, losing all rule changes
          entered so far, and leaving all profiles unmodified.
         </para>
        </listitem>
       </varlistentry>
       <varlistentry>
        <term>Finish</term>
        <listitem>
         <para>
          Close <command>aa-logprof</command>, saving all rule changes
          entered so far, and modifying all profiles.
         </para>
        </listitem>
       </varlistentry>
      </variablelist>
     </listitem>
    </itemizedlist>
   </step>
   <step os="slert">
    <para>
     Repeat the previous steps if you need to execute more functionality of
     the application.
    </para>
    <para>
     When you are done, click <guimenu>Finish</guimenu>. In the following
     pop-up, click <guimenu>Yes</guimenu> to exit the <guimenu>Profile
     Creation Wizard</guimenu>. The profile is saved and loaded into the
     &aa; module.
    </para>
   </step>
   <step os="sles;sled;osuse">
    <para>
     Repeat the previous steps if you need to execute more functionality of
     the application.
    </para>
    <para>
     When you are done, click <guimenu>Finish</guimenu>. Choose to apply
     your changes to the local profile set. If you have previously chosen to
     upload your profile to the external profile repository, provide a brief
     change log entry describing your work and upload the profile. If you
     had postponed the decision on whether to upload the profile or not,
     &yast; asks you again and you can create an account the upload the
     profile now or not upload it at all.
    </para>
    <para>
     As soon as you exit the <guimenu>Profile Creation Wizard</guimenu>, the
     profile is saved both locally and on the repository server, if you have
     chosen to upload it. The profile is then loaded into the &aa; module.
    </para>
   </step>
  </procedure>
 </sect1>
 <sect1 id="sec.apparmor.yast.add">
  <title>Manually Adding a Profile</title>

  <para>
   &aa; enables you to create a &aa; profile by manually adding entries
   into the profile. Select the application for which to create a profile
   then add entries.
  </para>

  <procedure>
   <step>
    <para>
     Start &yast; and select <menuchoice> <guimenu>&aa;</guimenu>
     <guimenu>Manually Add Profile</guimenu> </menuchoice>.
    </para>
   </step>
   <step>
    <para>
     Browse your system to find the application for which to create a
     profile.
    </para>
   </step>
   <step>
    <para>
     When you find the application, select it and click
     <guimenu>Open</guimenu>. A basic, empty profile appears in the
     <guimenu>&aa; Profile Dialog</guimenu> window.
    </para>
   </step>
   <step>
    <para>
     In <guimenu>&aa; Profile Dialog</guimenu>, add, edit, or delete &aa;
     profile entries by clicking the corresponding buttons and referring to
     <xref xrefstyle="HeadingOnPage"
      linkend="sec.apparmor.yast.edit.add"/>,
     <xref xrefstyle="HeadingOnPage" linkend="sec.apparmor.yast.edit.edit"/>,
     or
     <xref xrefstyle="HeadingOnPage" linkend="sec.apparmor.yast.edit.del"/>.
    </para>
   </step>
   <step>
    <para>
     When finished, click <guimenu>Done</guimenu>.
    </para>
   </step>
  </procedure>
 </sect1>
 <sect1 id="sec.apparmor.yast.edit">
  <title>Editing Profiles</title>

  <para>
   &aa; enables you to edit &aa; profiles manually by adding, editing, or
   deleting entries. To edit a profile, proceed as follows:
  </para>

  <procedure>
   <step>
    <para>
     Start &yast; and select <menuchoice>
     <guimenu>&aa;</guimenu><guimenu>Edit Profile</guimenu> </menuchoice>.
    </para>
    <informalfigure>
     <mediaobject>
      <textobject role="description"><phrase>Choose the profile to edit</phrase>
      </textobject>
      <imageobject role="fo">
       <imagedata format="PNG" fileref="edit_1.png" width="75%"/>
      </imageobject>
      <imageobject role="html">
       <imagedata format="PNG" fileref="edit_1.png"/>
      </imageobject>
     </mediaobject>
    </informalfigure>
   </step>
   <step>
    <para>
     From the list of profiled applications, select the profile to edit.
    </para>
   </step>
   <step>
    <para>
     Click <guimenu>Next</guimenu>. The <guimenu>&aa; Profile
     Dialog</guimenu> window displays the profile.
    </para>
    <informalfigure>
     <mediaobject>
      <textobject role="description"><phrase>&aa; profile dialog</phrase>
      </textobject>
      <imageobject role="fo">
       <imagedata format="PNG" fileref="edit_2.png" width="75%"/>
      </imageobject>
      <imageobject role="html">
       <imagedata format="PNG" fileref="edit_2.png"/>
      </imageobject>
     </mediaobject>
    </informalfigure>
   </step>
   <step>
    <para>
     In the <guimenu>&aa; Profile Dialog</guimenu> window, add, edit, or
     delete &aa; profile entries by clicking the corresponding buttons and
     referring to
     <xref xrefstyle="HeadingOnPage" linkend="sec.apparmor.yast.edit.add"/>,
     <xref xrefstyle="HeadingOnPage" linkend="sec.apparmor.yast.edit.edit"/>,
     or
     <xref xrefstyle="HeadingOnPage" linkend="sec.apparmor.yast.edit.del"/>.
    </para>
   </step>
   <step>
    <para>
     When you are finished, click <guimenu>Done</guimenu>.
    </para>
   </step>
   <step>
    <para>
     In the pop-up that appears, click <guimenu>Yes</guimenu> to confirm
     your changes to the profile and reload the &aa; profile set.
    </para>
   </step>
  </procedure>

  <tip>
   <title>Syntax Checking in &aa;</title>
   <para>
    &aa; contains a syntax check that notifies you of any syntax errors in
    profiles you are trying to process with the &yast; &aa; tools. If an
    error occurs, edit the profile manually as &rootuser; and reload the
    profile set with <command>rcapparmor <option>reload</option></command>.
   </para>
  </tip>

  <sect2 id="sec.apparmor.yast.edit.add">
   <title>Adding an Entry</title>
   <para>
    The <guimenu>Add Entry</guimenu> option can be found in
    <xref xrefstyle="SectTitleOnPage" linkend="sec.apparmor.yast.add"/> or
    <xref xrefstyle="SectTitleOnPage" linkend="sec.apparmor.yast.edit"/>.
    When you select <guimenu>Add Entry</guimenu>, a list shows the types of
    entries you can add to the &aa; profile.
   </para>
   <para>
    From the list, select one of the following:
   </para>
   <variablelist>
    <varlistentry>
     <term>File</term>
     <listitem>
      <para>
       In the pop-up window, specify the absolute path of a file, including
       the type of access permitted. When finished, click
       <guimenu>OK</guimenu>.
      </para>
      <para>
       You can use globbing if necessary. For globbing information, refer to
       <xref xrefstyle="SectTitleOnPage" linkend="sec.apparmor.profiles.glob"/>.
       For file access permission information, refer to
       <xref xrefstyle="SectTitleOnPage" linkend="sec.apparmor.profiles.perm"/>.
      </para>
      <informalfigure>
       <mediaobject>
        <textobject role="description"><phrase>Select a file to add</phrase>
        </textobject>
        <imageobject role="fo">
         <imagedata format="PNG" fileref="add_2_addentry_file.png"
	  width="60%"/>
        </imageobject>
        <imageobject role="html">
         <imagedata fileref="add_2_addentry_file.png" width="35%" format="PNG"/>
        </imageobject>
       </mediaobject>
      </informalfigure>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>Directory</term>
     <listitem>
      <para>
       In the pop-up window, specify the absolute path of a directory,
       including the type of access permitted. You can use globbing if
       necessary. When finished, click <guimenu>OK</guimenu>.
      </para>
      <para>
       For globbing information, refer to
       <xref xrefstyle="SectTitleOnPage" linkend="sec.apparmor.profiles.glob"/>.
       For file access permission information, refer to
       <xref xrefstyle="SectTitleOnPage" linkend="sec.apparmor.profiles.perm"/>.
      </para>
      <informalfigure>
       <mediaobject>
        <textobject role="description"><phrase>Select a directory to
	  add</phrase>
        </textobject>
        <imageobject role="fo">
         <imagedata format="PNG" fileref="add_2_addentry_file.png" width="60%"/>
        </imageobject>
        <imageobject role="html">
         <imagedata fileref="add_2_addentry_file.png" width="35%" format="PNG"/>
        </imageobject>
       </mediaobject>
      </informalfigure>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>Network Rule</term>
     <listitem>
      <para>
       In the pop-up window, select the appropriate network family and the
       socket type. For more information, refer to
       <xref xrefstyle="SectTitleOnPage" linkend="sec.apparmor.profiles.nac"/>.
      </para>
      <informalfigure>
       <mediaobject>
        <textobject role="description"><phrase>Select capabilities</phrase>
        </textobject>
        <imageobject role="fo">
         <imagedata format="PNG" fileref="add_2_addentry_network.png" width="75%"/>
        </imageobject>
        <imageobject role="html">
         <imagedata format="PNG" fileref="add_2_addentry_network.png"/>
        </imageobject>
       </mediaobject>
      </informalfigure>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>Capability</term>
     <listitem>
      <para>
       In the pop-up window, select the appropriate capabilities. These are
       statements that enable each of the 32 POSIX.1e capabilities. Refer to
       <xref xrefstyle="SectTitleOnPage" linkend="sec.apparmor.profiles.capabilities"/>
       for more information about capabilities. When finished making your
       selections, click <guimenu>OK</guimenu>.
      </para>
      <informalfigure>
       <mediaobject>
        <textobject role="description"><phrase>Select capabilities</phrase>
        </textobject>
        <imageobject role="fo">
         <imagedata format="PNG" fileref="add_2_addentry_capability.png" width="75%"/>
        </imageobject>
        <imageobject role="html">
         <imagedata format="PNG" fileref="add_2_addentry_capability.png"/>
        </imageobject>
       </mediaobject>
      </informalfigure>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>Include</term>
     <listitem>
      <para>
       In the pop-up window, browse to the files to use as includes.
       Includes are directives that pull in components of other &aa;
       profiles to simplify profiles. For more information, refer to
       <xref xrefstyle="SectTitleOnPage" linkend="sec.apparmor.profiles.includes"/>.
      </para>
      <informalfigure>
       <mediaobject>
        <textobject role="description"><phrase>Select includes</phrase>
        </textobject>
        <imageobject role="fo">
         <imagedata format="PNG" fileref="add_2_addentry_includefile.png" width="75%"/>
        </imageobject>
        <imageobject role="html">
         <imagedata format="PNG" fileref="add_2_addentry_includefile.png"/>
        </imageobject>
       </mediaobject>
      </informalfigure>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>Hat</term>
     <listitem>
      <para>
       In the pop-up window, specify the name of the subprofile
       (<emphasis>hat</emphasis>) to add to your current profile and click
       <guimenu>Create Hat</guimenu>. For more information, refer to
       <xref
	 linkend="cha.apparmor.hat"/>.
      </para>
      <informalfigure>
       <mediaobject>
        <imageobject role="fo">
         <imagedata fileref="add_2_addentry_hat.png" width="75%" format="PNG"/>
        </imageobject>
        <imageobject role="html">
         <imagedata fileref="add_2_addentry_hat.png" format="PNG"/>
        </imageobject>
       </mediaobject>
      </informalfigure>
     </listitem>
    </varlistentry>
   </variablelist>
  </sect2>

  <sect2 id="sec.apparmor.yast.edit.edit">
   <title>Editing an Entry</title>
   <para>
    When you select <guimenu>Edit Entry</guimenu>, the file browser pop-up
    window opens. From here, edit the selected entry.
   </para>
   <para>
    In the pop-up window, specify the absolute path of a file, including the
    type of access permitted. You can use globbing if necessary. When
    finished, click <guimenu>OK</guimenu>.
   </para>
   <para>
    For globbing information, refer to
    <xref linkend="sec.apparmor.profiles.glob"/>. For file access permission
    information, refer to <xref linkend="sec.apparmor.profiles.perm"/>.
   </para>
  </sect2>

  <sect2 id="sec.apparmor.yast.edit.del">
   <title>Deleting an Entry</title>
   <para>
    To delete an entry in a given profile, select <guimenu>Delete
    Entry</guimenu>. &aa; removes the selected profile entry.
   </para>
  </sect2>
 </sect1>
 <sect1 id="sec.apparmor.yast.del">
  <title>Deleting a Profile</title>

  <para>
   &aa; enables you to delete an &aa; profile manually. Simply select the
   application for which to delete a profile then delete it as follows:
  </para>

  <procedure>
   <step>
    <para>
     Start &yast; and select <menuchoice> <guimenu>&aa;</guimenu>
     <guimenu>Delete Profile</guimenu> </menuchoice>.
    </para>
   </step>
   <step>
    <para>
     Select the profile to delete.
    </para>
   </step>
   <step>
    <para>
     Click <guimenu>Next</guimenu>.
    </para>
   </step>
   <step>
    <para>
     In the pop-up that opens, click <guimenu>Yes</guimenu> to delete the
     profile and reload the &aa; profile set.
    </para>
   </step>
  </procedure>
 </sect1>
 <sect1 id="sec.apparmor.yast.update">
  <title>Updating Profiles from Log Entries</title>

  <para>
   The &aa; profile wizard uses aa-logprof, the tool that scans log files
   and enables you to update profiles. aa-logprof tracks messages from the
   &aa; module that represent exceptions for all profiles running on your
   system. These exceptions represent the behavior of the profiled
   application that is outside of the profile definition for the program.
   You can add the new behavior to the relevant profile by selecting the
   suggested profile entry.
  </para>
<!-- fs 2011-11-09 - see bnc #722915
     (The online profile repository is disabled by default now)

  <tip os="sles;sled;osuse">
   <title>Support for the External Profile Repository</title>
   <para>
    Similar to the <guimenu>Add Profile Wizard</guimenu>, the
    <guimenu>Update Profile Wizard</guimenu> also supports profile exchange
    with the external repository server. For background information on the
    use of the external &aa; profile repository, refer to
    <xref
     linkend="cha.apparmor.repos"/>. For details on how to
    configure access and access mode to the server, check the procedure
    described under <xref
     linkend="sec.apparmor.yast.wizard"/>.
   </para>
  </tip>
-->

  <procedure>
   <step>
    <para>
     Start &yast; and select <menuchoice> <guimenu>&aa;</guimenu>
     <guimenu>Update Profile Wizard</guimenu> </menuchoice>.
    </para>
    <para>
     Running <guimenu>Update Profile Wizard</guimenu> (aa-logprof) parses
     the learning mode log files. This generates a series of questions that
     you must answer to guide aa-logprof to generate the security profile.
     The exact procedure is the same as with creating a new profile. Refer
     to <xref
      linkend="st.apparmor.yast.wizard.scan"/> in
     <xref linkend="sec.apparmor.yast.wizard"/> for details.
    </para>
   </step>
   <step>
    <para>
     When you are done, click <guimenu>Finish</guimenu>. In the following
     pop-up, click <guimenu>Yes</guimenu> to exit the <guimenu>Add Profile
     Wizard</guimenu>. The profile is saved and loaded into the &aa;
     module.
    </para>
   </step>
  </procedure>
 </sect1>


<!-- fs 2011-11-09 - see bnc #722915
     (Event notification depends on the (unmaintained) aa-eventd - please
      remove the parts about notification.)
-->

 <sect1 id="sec.apparmor.yast.manage">
  <title>Managing &aa;</title>

  <para>
   You can change the status of &aa; by enabling or disabling it. Enabling
   &aa; protects your system from potential program exploitation. Disabling
   &aa;, even if your profiles have been set up, removes protection from your
   system. To change the status of &aa;, start &yast; and select <menuchoice>
    <guimenu>&aa;</guimenu> <guimenu>&aa;
     Control Panel</guimenu> </menuchoice>.
  </para>

  <informalfigure>
   <mediaobject>
    <textobject role="description"><phrase>The &aa; control
	panel</phrase>
    </textobject>
    <imageobject role="fo">
     <imagedata format="PNG" fileref="sd_controlpanel_1.png" width="75%"/>
    </imageobject>
    <imageobject role="html">
     <imagedata format="PNG" fileref="sd_controlpanel_1.png"/>
    </imageobject>
   </mediaobject>
  </informalfigure>

  <para>
   To change the status of &aa;, continue as described in
   <xref
    xrefstyle="HeadingOnPage"
    linkend="sec.apparmor.yast.manage.status"/>.
   To change the mode of individual profiles, continue as described in
   <xref linkend="sec.apparmor.yast.manage.profmodes"/>.
  </para>

  <sect2 id="sec.apparmor.yast.manage.status">
   <title>Changing &aa; Status</title>
   <para>
    When you change the status of &aa;, set it to enabled or disabled. When
    &aa; is enabled, it is installed, running, and enforcing the &aa;
    security policies.
   </para>
   <procedure>
    <step>
     <para>
      Start &yast; and select <menuchoice> <guimenu>&aa;</guimenu>
      <guimenu>&aa; Control Panel</guimenu> </menuchoice>.
     </para>
    </step>
    <step>
     <para>
      Enable &aa; by checking <guimenu>Enable &aa;</guimenu> or disable &aa;
      by deselecting it.
     </para>
    </step>
    <step>
     <para>
      Click <guimenu>Done</guimenu> in the <guimenu>&aa;
      Configuration</guimenu> window.
     </para>
    </step>
    <step>
     <para>
      Click <menuchoice> <guimenu>File</guimenu> <guimenu>Quit</guimenu>
      </menuchoice> in the &yast; Control Center.
     </para>
    </step>
   </procedure>
  </sect2>

  <sect2 id="sec.apparmor.yast.manage.profmodes">
   <title>Changing the Mode of Individual Profiles</title>
   <para>
    &aa; can apply profiles in two different modes. In
    <emphasis>complain</emphasis> or <emphasis>learning</emphasis> mode,
    violations of &aa; profile rules, such as the profiled program accessing
    files not permitted by the profile, are detected. The violations are
    permitted, but also logged. This mode is convenient for developing
    profiles and is used by the &aa; tools for generating profiles. Loading
    a profile in <emphasis>enforce</emphasis> mode enforces the policy
    defined in the profile and reports policy violation attempts to syslogd.
   </para>
<?dbfo-need height="20em"?>
   <para>
    The <guimenu>Profile Modes</guimenu> dialog allows you to view and edit
    the mode of currently loaded &aa; profiles. This feature is useful for
    determining the status of your system during profile development. During
    the course of systemic profiling (see
    <xref linkend="sec.apparmor.commandline.profiling.systemic"/>), you can
    use this tool to adjust and monitor the scope of the profiles for which
    you are learning behavior.
   </para>
   <para>
    To edit an application's profile mode, proceed as follows:
   </para>
   <procedure>
    <step>
     <para>
      Start &yast; and select <menuchoice> <guimenu>&aa;</guimenu>
      <guimenu>&aa; Control Panel</guimenu> </menuchoice>.
     </para>
    </step>
    <step>
     <para>
      In the <guimenu>Configure Profile Modes</guimenu> section, select
      <guimenu>Configure</guimenu>.
     </para>
    </step>
    <step>
     <para>
      Select the profile for which to change the mode.
     </para>
    </step>
    <step>
     <para>
      Select <guimenu>Toggle Mode</guimenu> to set this profile to
      <emphasis>complain</emphasis> mode or to <emphasis>enforce</emphasis>
      mode.
     </para>
    </step>
    <step>
     <para>
      Apply your settings and leave &yast; with <guimenu>Done</guimenu>.
     </para>
    </step>
   </procedure>
   <para>
    To change the mode of all profiles, use <guimenu>Set All to
    Enforce</guimenu> or <guimenu>Set All to Complain</guimenu>.
   </para>
   <tip>
    <title>Listing the Profiles Available</title>
    <para>
     By default, only active profiles are listed (any profile that has a
     matching application installed on your system). To set up a profile
     before installing the respective application, click <guimenu>Show All
     Profiles</guimenu> and select the profile to configure from the list
     that appears.
    </para>
   </tip>
  </sect2>
 </sect1>
</chapter>
