<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="deployment_images_description.xml" version="5.0" xml:id="cha-images-description">
 <title>事前に構築されたイメージの説明</title>
 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:bugtracker/>
   <dm:translation>yes</dm:translation>
  </dm:docmanager>
 </info>
 <para>
  SLE Microは、事前に構築されたイメージを使用して展開できます。現在、利用可能なイメージには、生のディスクイメージとセルフインストールISOの2種類があります。
 </para>
 <para>
  SLE Micro生イメージは、AMD64/Intel 64アーキテクチャ、IBM Z ZSeries、およびAArch64向けに提供されます。セルフインストールイメージは現在、AMD64/Intel 64アーキテクチャ用にのみ提供されています。事前に構築されたイメージは、IgnitionまたはCombustionのいずれかを使用して、最初のブート時に設定することを意図しています。ブートローダは最初のブートを検出します。詳細については、<xref linkend="sec-first-boot"/>を参照してください。各イメージには、<xref linkend="sec-default-partitioning"/>で説明されるように、デフォルトでマウントされたサブボリュームがあります。これらのイメージの展開手順については、<xref linkend="cha-images-procedure"/>を参照してください。
 </para>
 <important>
  <title>Podmanと一緒にファイアウォールを使用しない</title>
  <para>
   Podmanと一緒にファイアウォールを使用すると、<literal>firewalld</literal>サービスを再ロードした後で、Podman関連のファイアウォールルールが失われる可能性があります。したがって、Podmanを使用する場合は、ファイアウォールを無効にしておくことをお勧めします。
  </para>
 </important>
 <note>
  <title>VMホストサーバとしてのSLE Micro</title>
  <para>
   SLE MicroはKVMホストサーバとして実行できます。Xenはサポートされていません。ただし、VMホストサーバとして実行するSLE Microにはいくつかの制限があります。詳細については、<link xlink:href="https://documentation.suse.com/sles/15-SP3/html/SLES-all/cha-virt-support.html">virtualization limits and support (仮想化の制限とサポート)</link>を参照してください。
  </para>
 </note>
 <sect1 xml:id="sec-default-partitioning">
  <title>デフォルトパーティショニング</title>

  <para>
   事前に構築されたイメージは、デフォルトパーティショニングスキームで提供され、IgnitionまたはCombustionのいずれかを使用して最初のブート時に変更できます。システムを再パーティショニングする手順については、<xref linkend="sec-ignition-configuration"/>または<xref linkend="sec-combustion-script"/>を参照してください。
  </para>

  <important>
   <title>Btrfsはルートファイルシステムに必須である</title>
   <para>
    デフォルトパーティショニングスキームに変更を行う場合は、ルートファイルシステムをbtrfsにする必要があります。
   </para>
  </important>

  <para>
   各イメージには次のサブボリュームがあります。
  </para>

<screen>
 /home
 /root
 /opt
 /srv 
 /usr/local
 /var
 </screen>

  <para>
   イメージには、デフォルトでブートするためのサブボリュームもマウントされています。特定のサブボリュームは、アーキテクチャによって異なります。
  </para>

  <para>
   <literal>/etc</literal>ディレクトリはoverlayfsとしてマウントされ、上位ディレクトリは<filename>/var/lib/overlay/1/etc/</filename>にマウントされます。
  </para>

  <para>
   デフォルトでマウントされているサブボリュームは、<filename>/etc/fstab</filename>の<literal>x-initrd.mount</literal>オプションで認識できます。その他のサブボリュームまたはパーティションは、IgnitionまたはCombustionのいずれかによって設定する必要があります。
  </para>
 </sect1>
 <sect1 xml:id="sec-first-boot">
  <title>最初のブートの検出</title>

  <para>
   設定は、最初のブート時にのみ実行されます。最初のブートとその後のブートを区別するために、最初のブートが実行された後にフラグファイル<filename>/boot/writable/firstboot_happened</filename>が作成されます。ファイルシステムにファイルが存在しない場合は、<literal>ignition.firstboot</literal>属性がカーネルコマンドラインに渡されます。これにより、Ignitionの場合は<filename>initramfs</filename>の作成がトリガーされ、Combustionの場合はdracutモジュールが実行されます。最初のブートの完了後、<filename>/boot/writable/firstboot_happened</filename>フラグファイルが作成されます。
  </para>

  <note>
   <title>フラグファイルは常に作成される</title>
   <para>
    設定ファイルが不適切または欠落しているため、設定が正常に行われない場合でも、<filename>/boot/writable/firstboot_happened</filename>フラグファイルが作成されます。
   </para>
   
   <para>
    最初のブート設定は、カーネルコマンドラインに<literal>ignition.firstboot</literal>属性を渡すか、<filename>/boot/writable/firstboot_happened</filename>フラグファイルを削除することによって、以降のブートで強制的に実行できます。
   </para>
  </note>
 </sect1>
</chapter>
