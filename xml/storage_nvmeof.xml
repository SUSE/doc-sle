<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE chapter
[
  <!ENTITY % entities SYSTEM "entity-decl.ent">
    %entities;
]>

<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" version="5.0" xml:id="cha.nvmeof" xml:lang="en">
 <title>&nvmeof;</title>
 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:bugtracker></dm:bugtracker>
   <dm:translation>yes</dm:translation>
  </dm:docmanager>
  <abstract>
   <para>
    Abstract.
   </para>
  </abstract>
 </info>
 <sect1 xml:id="cha.nvmeof.overview">
  <title>Overview</title>
  <para>
   <emphasis>NVM Express</emphasis> (<emphasis>&nvme;</emphasis>) is an
   interface standard for accessing non-volatile storage, commonly SSD
   disks. &nvme; supports much higher speeds and has a lower latency
   than SATA.
  </para>
  <para>
   <emphasis>&nvmeof;</emphasis> is an architecture to access &nvme;
   storage over different networking fabrics, like RDMA and &nvme; over
   Fibre Channel. The role of &nvmeof; is similar to iSCSI. To increase
   the fault-tolerance, &nvmeof; has a built-in support for
   multipathing. The &nvmeof; multipathing is not based on the
   traditional &dmmpio;.
  </para>
  <para>
   &nvme; is supported on &slea; &productnumber;. There are Kernel
   modules available for the &nvme; block storage and &nvmeof; target
   and client. &nvme; native multipathing is enabled by default. To
   print the layout of the multipath devices, use the command
   <command>nvme list-subsys</command>. To disable NVMe native
   multipathing, add <option>nvme-core.multipath=N</option> as a boot
   parameter.
  </para>
 </sect1>
 <sect1 xml:id="sec.nvmeof.client_configuration">
  <title>Setting Up an &nvmeof; Client</title>
  <para>
   To use &nvmeof;, a target must be available with one of the supported
   networking methods. Supported are &nvme; over Fibre Channel and RDMA.
   The following sections describe how to connect a client to a &nvme;
   target.
  </para>
  <sect2 xml:id="sec.nvmeof.client_configuration.cli">
   <title>Command Line Client</title>
   <para>
    To use &nvmeof; you need the <command>nvme</command> command line
    tool. Install it with <command>zypper</command>:
   </para>
   <screen>&prompt.sudo;<command>zypper in nvme-cli</command></screen>
   <para>
    Use <command>nvme --help</command> to list all available
    subcommands. Man pages are available for <command>nvme</command>
    subcommands. Consult them by executing <command>man
    nvme-<replaceable>SUBCOMMAND</replaceable></command>. For example,
    to view the man page for the <option>discover</option> subcommand,
    execute <command>man nvme-discover</command>.
   </para>
  </sect2>
  <sect2 xml:id="sec.nvmeof.client_configuration.target_discovery">
   <title>Discovering &nvmeof; Targets</title>
   <para>
    To list available &nvme; subsystems on the &nvmeof; target, you need
    the discovery controller address and service ID.
   </para>
   <screen>&prompt.sudo;<command>nvme discover -t <replaceable>TRANSPORT</replaceable> -a <replaceable>DISCOVERY_CONTROLLER_ADDRESS</replaceable> -s <replaceable>SERVICE_ID</replaceable></command></screen>
   <para>
    Replace <replaceable>TRANSPORT</replaceable> with the underlying
    transport medium: <option>loop</option>, <option>rdma</option> or
    <option>fc</option>.
    Replace <replaceable>DISCOVERY_CONTROLLER_ADDRESS</replaceable> with
    the address of the discovery controller. For RDMA this should be an
    IPv4 address.
    Replace <replaceable>SERVICE_ID</replaceable> with the transport
    service ID. If the service is IP based, like RDMA, this specifies
    the port number.
   </para>
   <para>
    Example:
   </para>
   <screen>&prompt.sudo;<command>nvme discover -t rdma -a 10.0.1.100 -s 4420</command></screen>
   <para>
    For more details, see <command>man nvme-discover</command>.
   </para>
  </sect2>
  <sect2 xml:id="sec.nvmeof.client_configuration.connect_target">
   <title>Connecting to &nvmeof; Targets</title>
   <para>
    
   </para>
   <screen>&prompt.sudo;<command>nvme connect -t <replaceable>transport</replaceable> -a <replaceable>DISCOVERY_CONTROLLER_ADDRESS</replaceable> -s <replaceable>SERVICE_ID</replaceable> -n <replaceable>SUBSYSTTEM_NQN</replaceable></command></screen>
   <para>
    Replace <replaceable>TRANSPORT</replaceable> with the underlying
    transport medium: <option>loop</option>, <option>rdma</option> or
    <option>fc</option>.
    Replace <replaceable>DISCOVERY_CONTROLLER_ADDRESS</replaceable> with
    the address of the discovery controller. For RDMA this should be an
    IPv4 address.
    Replace <replaceable>SERVICE_ID</replaceable> with the transport
    service ID. If the service is IP based, like RDMA, this specifies
    the port number.
    Replace <replaceable>SUBSYSTTEM_NQN</replaceable> with the NVMe
    qualified name of the desired subsystem as found by the discovery
    command.
   </para>
   <para>Example:</para>
   <screen>&prompt.sudo;<command>nvme connect -t rdma -a 10.0.1.100 -s 4420 -n nqn.2014-08.com.example:nvme:nvm-subsystem-sn-d78432</command></screen>
   <para>
    Alternatively, use <command>nvme connect-all</command> to connect
    to all discovered namespaces. For advanced usage please see
    <command>man nvme-connect</command> and <command>man
    nvme-connect-all</command>.
   </para>
  </sect2>
 </sect1>
 <sect1 xml:id="sec.nvmeof.target_configuration">
  <title>Setting Up an &nvmeof; Target</title>
  <sect2 xml:id="sec.nvmeof.target_configuration.cli">
   <title>Command Line Client</title>
   <para>
    To configure a &nvmeof; target, you need the <command>nvmetcli</command> command line
    tool. Install it with <command>zypper</command>:
   </para>
   <screen>&prompt.sudo;<command>zypper in nvmetcli</command></screen>
  </sect2>
  <sect2>
<para>
ramones:~/:[0]# nvmetcli 
/> cd ports 
/ports> create 1
/ports> ls 1/
o- 1 ......................................................................................................................... [...]
  o- referrals ............................................................................................................... [...]
  o- subsystems .............................................................................................................. [...]
/ports> cd /subsystems 
/subsystems> create nqn.2014-08.org.nvmexpress:NVMf:uuid:c36f2c23-354d-416c-95de-f2b8ec353a82
/subsystems> cd nqn.2014-08.org.nvmexpress:NVMf:uuid:c36f2c23-354d-416c-95de-f2b8ec353a82/
/subsystems/n...-f2b8ec353a82> ls
o- nqn.2014-08.org.nvmexpress:NVMf:uuid:c36f2c23-354d-416c-95de-f2b8ec353a82 ................................................. [...]
  o- allowed_hosts ........................................................................................................... [...]
  o- namespaces .............................................................................................................. [...]
/subsystems/n...-f2b8ec353a82> cd namespaces
/subsystems/n...82/namespaces> create 1
/subsystems/n...82/namespaces> cd 1 
/subsystems/n.../namespaces/1> set device path=/dev/nullb0
Parameter path is now '/dev/nullb0'.
/subsystems/n.../namespaces/1> cd ..
/subsystems/n.../namespaces/1> enable
The Namespace has been enabled.
/subsystems/n...82/namespaces> cd ..
/subsystems/n...-f2b8ec353a82> ls
o- nqn.2014-08.org.nvmexpress:NVMf:uuid:c36f2c23-354d-416c-95de-f2b8ec353a82 ................................................. [...]
  o- allowed_hosts ........................................................................................................... [...]
  o- namespaces .............................................................................................................. [...]
    o- 1 ..................................................................................................................... [...]
/subsystems/n...-f2b8ec353a82> set attr allow_any_host=1
Parameter allow_any_host is now '1'.
/subsystems/n...-f2b8ec353a82> cd /
/> ls
o- / ......................................................................................................................... [...]
  o- hosts ................................................................................................................... [...]
  o- ports ................................................................................................................... [...]
  | o- 1 ..................................................................................................................... [...]
  |   o- referrals ........................................................................................................... [...]
  |   o- subsystems .......................................................................................................... [...]
  o- subsystems .............................................................................................................. [...]
    o- nqn.2014-08.org.nvmexpress:NVMf:uuid:c36f2c23-354d-416c-95de-f2b8ec353a82 ............................................. [...]
      o- allowed_hosts ....................................................................................................... [...]
      o- namespaces .......................................................................................................... [...]
        o- 1 ................................................................................................................. [...]
/> cd ports/1/
/ports/1> set addr adrfam=ipv4 trtype=rdma traddr=1.1.1.2 trsvcid=4420
Parameter trtype is now 'rdma'.
Parameter adrfam is now 'ipv4'.
Parameter trsvcid is now '4420'.
Parameter traddr is now '1.1.1.2'.
/ports/1> cd subsystems 
/ports/1/subsystems> create nqn.2014-08.org.nvmexpress:NVMf:uuid:c36f2c23-354d-416c-95de-f2b8ec353a82
</para>
  </sect2>
 </sect1>
 <sect1 xml:id="cha.nvmeof.more_information">
  <title>More Information</title>
  <para>
   For more details about the abilities of <command>nvme</command>,
   refer to <command>nvme nvme-help</command>.
  </para>
  <para>
   The following blog posts are recommended for a basic introduction to
   &nvme; and &nvmeof;:
  </para>
  <itemizedlist>
   <listitem>
    <para><link xlink:href="http://nvmexpress.org/"/></para>
   </listitem>
   <listitem>
    <para><link xlink:href="http://www.nvmexpress.org/wp-content/uploads/NVMe_Over_Fabrics.pdf"/></para>
   </listitem>
   <listitem>
    <para><link xlink:href="https://storpool.com/blog/demystifying-what-is-nvmeof"/></para>
   </listitem>
   <listitem>
    <para><link xlink:href="https://medium.com/@metebalci/a-quick-tour-of-nvm-express-nvme-3da2246ce4ef"/></para>
   </listitem>
  </itemizedlist>
 </sect1>
</chapter>
