<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="apparmor_profiles_yast.xml" version="5.0" role="General" xml:id="cha-apparmor-yast">
 <title>使用 YaST 构建和管理配置文件</title>
 <info>
      <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
        <dm:bugtracker>
          </dm:bugtracker>
        <dm:translation>是</dm:translation>
      </dm:docmanager>
    </info>
    <para>
  YaST 提供了用于构建配置文件以及管理 <phrase>AppArmor®</phrase> 配置文件的基本途径。它提供了两个界面：一个图形界面和一个基于文本的界面。基于文本的界面消耗的资源和带宽更少，因此，需要进行远程管理或者当本地图形环境不够方便时，基于文本的界面是更好的选择。尽管这两个界面的外观不同，但它们以类似的方式提供相同的功能。另一种方法是使用 <phrase>AppArmor</phrase> 命令，这些命令可以从终端窗口或通过远程连接控制 <phrase>AppArmor</phrase>。<xref linkend="cha-apparmor-commandline"/>中介绍了命令行工具。
 </para>
 <para>
  从主菜单中启动 YaST，并在出现提示时输入 <systemitem class="username">root</systemitem> 口令。或者，通过打开终端窗口，以 <systemitem class="username">root</systemitem> 身份登录，然后输入 <command>yast2</command>（表示图形模式）或 <command>yast</command>（表示基于文本的模式）来启动 YaST。
 </para>
 <para>
  <guimenu>安全和用户</guimenu>部分显示了一个 <guimenu><phrase>AppArmor</phrase> 配置</guimenu>图标。单击该图标可启动 <phrase>AppArmor</phrase> YaST 模块。
 </para>
 <sect1 xml:id="sec-apparmor-yast-add">
  <title>手动添加配置文件</title>

  <para>
   <phrase>AppArmor</phrase> 允许您通过手动向配置文件添加项的方式来创建 <phrase>AppArmor</phrase> 配置文件。选择要为其创建配置文件的应用程序，然后添加项。
  </para>

  <procedure>
   <step>
    <para>
     启动 YaST，选择 <guimenu><phrase>AppArmor</phrase> 配置</guimenu>，然后在主窗口中单击<guimenu>手动添加配置文件</guimenu>。
    </para>
   </step>
   <step>
    <para>
     浏览系统以找到要创建配置文件的应用程序。
    </para>
   </step>
   <step>
    <para>
     找到应用程序后，选择它并单击<guimenu>打开</guimenu>。<guimenu><phrase>AppArmor</phrase> 配置文件对话框</guimenu>窗口中将出现一个空的基本配置文件。
    </para>
   </step>
   <step>
    <para>
     在 <guimenu><phrase>AppArmor</phrase> 配置文件对话框</guimenu>中，通过单击对应的按钮并参考<xref xrefstyle="HeadingOnPage" linkend="sec-apparmor-yast-edit-add"/>、<xref xrefstyle="HeadingOnPage" linkend="sec-apparmor-yast-edit-edit"/>或<xref xrefstyle="HeadingOnPage" linkend="sec-apparmor-yast-edit-del"/>来添加、编辑或删除 <phrase>AppArmor</phrase> 配置文件项。
    </para>
   </step>
   <step>
    <para>
     完成后，单击<guimenu>完成</guimenu>。
    </para>
   </step>
  </procedure>
 </sect1>
 <sect1 xml:id="sec-apparmor-yast-edit">
  <title>编辑配置文件</title>

  <tip>
   <para>
    YaST 提供针对 <phrase>AppArmor</phrase> 配置文件的基本操作，例如创建或编辑配置文件。不过，最直接的编辑 <phrase>AppArmor</phrase> 配置文件的方式是使用 <command>vi</command> 这样的文本编辑器：
   </para>
<screen><prompt>tux &gt; </prompt><command>sudo</command> vi /etc/apparmor.d/usr.sbin.httpd2-prefork</screen>
  </tip>

  <tip>
   <para>
    <command>vi</command> 编辑器还包含语法（错误）高亮显示和语法错误高亮显示功能，当编辑后的 <phrase>AppArmor</phrase> 配置文件存在语法错误时，它会以视觉方式发出警告。
   </para>
  </tip>

  <para>
   <phrase>AppArmor</phrase> 允许您通过添加、编辑或删除项来手动编辑 <phrase>AppArmor</phrase> 配置文件。要编辑配置文件，请执行以下操作：
  </para>

  <procedure>
   <step>
    <para>
     启动 YaST，选择 <guimenu><phrase>AppArmor</phrase> 配置</guimenu>，然后在主窗口中单击<guimenu>管理现有配置文件</guimenu>。
    </para>
    <informalfigure>
     <mediaobject>
      <textobject role="description"><phrase>选择要编辑的配置文件</phrase>
      </textobject>
      <imageobject role="fo">
       <imagedata fileref="edit_1.png" width="75%"/>
      </imageobject>
      <imageobject role="html">
       <imagedata fileref="edit_1.png"/>
      </imageobject>
     </mediaobject>
    </informalfigure>
   </step>
   <step>
    <para>
     在已构建配置文件的应用程序列表中，选择要编辑的配置文件。
    </para>
   </step>
   <step>
    <para>
     单击<guimenu>编辑</guimenu>。此时 <guimenu><phrase/>AppArmor 配置文件对话框</guimenu>窗口会显示配置文件。
    </para>
    <informalfigure>
     <mediaobject>
      <textobject role="description"><phrase><phrase/>AppArmor 配置文件对话框</phrase>
      </textobject>
      <imageobject role="fo">
       <imagedata fileref="edit_2.png" width="75%"/>
      </imageobject>
      <imageobject role="html">
       <imagedata fileref="edit_2.png"/>
      </imageobject>
     </mediaobject>
    </informalfigure>
   </step>
   <step>
    <para>
     在 <guimenu><phrase>AppArmor</phrase> 配置文件对话框</guimenu>窗口中，通过单击对应的按钮并参考<xref xrefstyle="HeadingOnPage" linkend="sec-apparmor-yast-edit-add"/>、<xref xrefstyle="HeadingOnPage" linkend="sec-apparmor-yast-edit-edit"/>或<xref xrefstyle="HeadingOnPage" linkend="sec-apparmor-yast-edit-del"/>来添加、编辑或删除 <phrase>AppArmor</phrase> 配置文件项。
    </para>
   </step>
   <step>
    <para>
     完成后，单击<guimenu>完成</guimenu>。
    </para>
   </step>
   <step>
    <para>
     在出现的弹出窗口中，单击<guimenu>是</guimenu>以确认对配置文件所做的更改，然后重新装载 <phrase>AppArmor</phrase> 配置文件集。
    </para>
   </step>
  </procedure>

  <tip>
   <title><phrase>AppArmor</phrase> 中的语法检查</title>
   <para>
    <phrase>AppArmor</phrase> 包含语法检查功能，如果您尝试使用 YaST <phrase>AppArmor</phrase> 工具处理的配置文件中存在任何语法错误，它会发出通知。如果发生错误，请以 <systemitem class="username">root</systemitem> 身份手动编辑配置文件，然后使用 <command>systemctl reload apparmor</command> 重新装载配置文件集。
   </para>
  </tip>

  <sect2 xml:id="sec-apparmor-yast-edit-add">
   <title>添加项</title>
   <para>
    <guimenu><phrase>AppArmor</phrase> 配置文件窗口</guimenu>中的<guimenu>添加项</guimenu>按钮会列出您可以添加到 <phrase>AppArmor</phrase> 配置文件的项类型。
   </para>
   <para>
    在列表中选择以下选项之一：
   </para>
   <variablelist>
    <varlistentry>
     <term>文件</term>
     <listitem>
      <para>
       在弹出窗口中，指定文件的绝对路径，包括允许的访问类型。完成后，单击<guimenu>确定</guimenu>。
      </para>
      <para>
       必要时，您可以使用通配。有关通配的详细信息，请参见<xref xrefstyle="SectTitleOnPage" linkend="sec-apparmor-profiles-glob"/>。有关文件访问权限的详细信息，请参见<xref xrefstyle="SectTitleOnPage" linkend="sec-apparmor-profiles-perm"/>。
      </para>
      <informalfigure>
       <mediaobject>
        <textobject role="description"><phrase>选择要添加的文件</phrase>
        </textobject>
        <imageobject role="fo">
         <imagedata fileref="add_2_addentry_file.png" width="60%"/>
        </imageobject>
        <imageobject role="html">
         <imagedata fileref="add_2_addentry_file.png" width="35%"/>
        </imageobject>
       </mediaobject>
      </informalfigure>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>目录</term>
     <listitem>
      <para>
       在弹出窗口中，指定目录的绝对路径，包括允许的访问类型。必要时，您可以使用通配。完成后，单击<guimenu>确定</guimenu>。
      </para>
      <para>
       有关通配的详细信息，请参见<xref xrefstyle="SectTitleOnPage" linkend="sec-apparmor-profiles-glob"/>。有关文件访问权限的详细信息，请参见<xref xrefstyle="SectTitleOnPage" linkend="sec-apparmor-profiles-perm"/>。
      </para>
      <informalfigure>
       <mediaobject>
        <textobject role="description"><phrase>选择要添加的目录</phrase>
        </textobject>
        <imageobject role="fo">
         <imagedata fileref="add_2_addentry_file.png" width="60%"/>
        </imageobject>
        <imageobject role="html">
         <imagedata fileref="add_2_addentry_file.png" width="35%"/>
        </imageobject>
       </mediaobject>
      </informalfigure>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>网络规则</term>
     <listitem>
      <para>
       在弹出窗口中，选择适当的网络系列和套接字类型。有关更多信息，请参考<xref xrefstyle="SectTitleOnPage" linkend="sec-apparmor-profiles-nac"/>。
      </para>
      <informalfigure>
       <mediaobject>
        <textobject role="description"><phrase>选择功能</phrase>
        </textobject>
        <imageobject role="fo">
         <imagedata fileref="add_2_addentry_network.png" width="50%"/>
        </imageobject>
        <imageobject role="html">
         <imagedata fileref="add_2_addentry_network.png" width="35%"/>
        </imageobject>
       </mediaobject>
      </informalfigure>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>功能</term>
     <listitem>
      <para>
       在对话窗口中，选择适当的功能。这些语句用于启用 32 个 POSIX.1e 功能。有关功能的详细信息，请参见<xref xrefstyle="SectTitleOnPage" linkend="sec-apparmor-profiles-capabilities"/>。完成选择后，单击<guimenu>确定</guimenu>。
      </para>
      <informalfigure>
       <mediaobject>
        <textobject role="description"><phrase>选择功能</phrase>
        </textobject>
        <imageobject role="fo">
         <imagedata fileref="add_2_addentry_capability.png" width="75%"/>
        </imageobject>
        <imageobject role="html">
         <imagedata fileref="add_2_addentry_capability.png"/>
        </imageobject>
       </mediaobject>
      </informalfigure>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>Include 文件</term>
     <listitem>
      <para>
       在弹出窗口中，浏览到要用作 include 的文件。Include 是可提取其他 <phrase>AppArmor</phrase> 配置文件的组件以简化配置文件的指令。有关更多信息，请参考<xref xrefstyle="SectTitleOnPage" linkend="sec-apparmor-profiles-includes"/>。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>帽子</term>
     <listitem>
      <para>
       在弹出窗口中，指定要添加到当前配置文件的子配置文件（<emphasis>帽子</emphasis>）的名称，然后单击<guimenu>创建帽子</guimenu>。有关更多信息，请参考<xref linkend="cha-apparmor-hat"/>。
      </para>
      <informalfigure>
       <mediaobject>
        <imageobject role="fo">
         <imagedata fileref="add_2_addentry_hat.png" width="50%"/>
        </imageobject>
        <imageobject role="html">
         <imagedata fileref="add_2_addentry_hat.png" width="60%"/>
        </imageobject>
       </mediaobject>
      </informalfigure>
     </listitem>
    </varlistentry>
   </variablelist>
  </sect2>

  <sect2 xml:id="sec-apparmor-yast-edit-edit">
   <title>编辑项</title>
   <para>
    选择<guimenu>编辑项</guimenu>时，会打开一个弹出窗口。请在此窗口中编辑选定的项。
   </para>
   <para>
    在弹出窗口中，编辑需要修改的项。必要时，您可以使用通配。完成后，单击<guimenu>确定</guimenu>。
   </para>
   <para>
    有关通配的详细信息，请参见<xref linkend="sec-apparmor-profiles-glob"/>。有关访问权限的信息，请参见<xref linkend="sec-apparmor-profiles-perm"/>。
   </para>
  </sect2>

  <sect2 xml:id="sec-apparmor-yast-edit-del">
   <title>删除项</title>
   <para>
    要删除给定配置文件中的项，请选择<guimenu>删除项</guimenu>。<phrase>AppArmor</phrase> 将去除选定的配置文件项。
   </para>
  </sect2>
 </sect1>
 <sect1 xml:id="sec-apparmor-yast-del">
  <title>删除简报</title>

  <para>
   <phrase>AppArmor</phrase> 允许您手动删除 <phrase>AppArmor</phrase> 配置文件。只需选择要删除其配置文件的应用程序，然后按如下所示删除：
  </para>

  <procedure>
   <step>
    <para>
     启动 YaST，选择 <guimenu><phrase>AppArmor</phrase> 配置</guimenu>，然后在主窗口中单击<guimenu>管理现有配置文件</guimenu>。
    </para>
   </step>
   <step>
    <para>
     选择要删除的配置文件。
    </para>
   </step>
   <step>
    <para>
     单击<guimenu>删除</guimenu>。
    </para>
   </step>
   <step>
    <para>
     在打开的弹出窗口中，单击<guimenu>是</guimenu>以删除该配置文件，然后重新装载 <phrase>AppArmor</phrase> 配置文件集。
    </para>
   </step>
  </procedure>
 </sect1>
 <sect1 xml:id="sec-apparmor-yast-manage">
  <title>管理 <phrase>AppArmor</phrase></title>

  <para>
   可以通过启用或禁用 <phrase>AppArmor</phrase> 来更改其状态。启用 <phrase>AppArmor</phrase> 可保护您的系统抵御潜在的程序漏洞攻击。禁用 <phrase>AppArmor</phrase> 将撤销对系统的保护，即使已设置了配置文件。要更改 <phrase>AppArmor</phrase> 的状态，请启动 YaST，选择 <guimenu><phrase>AppArmor</phrase> 配置</guimenu>，然后在主窗口中单击<guimenu>设置</guimenu>。
  </para>

  <informalfigure>
   <mediaobject>
    <textobject role="description"><phrase><phrase>AppArmor 控制面板</phrase></phrase>
    </textobject>
    <imageobject role="fo">
     <imagedata fileref="sd_controlpanel_1.png" width="75%"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="sd_controlpanel_1.png"/>
    </imageobject>
   </mediaobject>
  </informalfigure>

  <para>
   要更改 <phrase>AppArmor</phrase> 的状态，请按照<xref xrefstyle="HeadingOnPage" linkend="sec-apparmor-yast-manage-status"/>中所述继续操作。要更改单个配置文件的模式，请按照<xref linkend="sec-apparmor-yast-manage-profmodes"/>中所述继续操作。
  </para>

  <sect2 xml:id="sec-apparmor-yast-manage-status">
   <title>更改 <phrase>AppArmor</phrase> 状态</title>
   <para>
    更改 <phrase>AppArmor</phrase> 的状态时，请将其设置为已启用或已禁用。启用 <phrase>AppArmor</phrase> 后，系统将安装并运行 <phrase>AppArmor</phrase>，并强制执行其安全策略。
   </para>
   <procedure>
    <step>
     <para>
      启动 YaST，选择 <guimenu><phrase>AppArmor</phrase> 配置</guimenu>，然后在主窗口中单击<guimenu>设置</guimenu>。
     </para>
    </step>
    <step>
     <para>
      选中<guimenu>启用 <phrase>AppArmor</phrase></guimenu> 以启用 <phrase>AppArmor</phrase>，或取消选中该选项以禁用 <phrase>AppArmor</phrase>。
     </para>
    </step>
    <step>
     <para>
      单击 <guimenu>AppArmor 配置</guimenu>窗口中的<guimenu><phrase/>完成</guimenu>。
     </para>
    </step>
   </procedure>
   <tip>
    <para>
     对于正在运行的程序，一律需要将其重启动才能应用配置文件。
    </para>
   </tip>
  </sect2>

  <sect2 xml:id="sec-apparmor-yast-manage-profmodes">
   <title>更改单个配置文件的模式</title>
   <para>
    <phrase>AppArmor</phrase> 可在两种不同的模式下应用配置文件。在<emphasis>控诉</emphasis>模式下，会检测对 <phrase>AppArmor</phrase> 配置文件规则的违规，例如构建了配置文件的程序访问配置文件不允许的文件。冲突是允许的，但也会被记录。此模式有利于开发配置文件，<phrase>AppArmor</phrase> 工具用其来生成配置文件。在<emphasis>强制</emphasis>模式下装载配置文件会强制执行该配置文件中定义的策略，并在 <systemitem class="daemon">rsyslogd</systemitem>（或者 <systemitem class="daemon">auditd</systemitem> 或 <systemitem class="daemon">journalctl</systemitem>，具体取决于系统配置）中报告策略违规尝试。
   </para>
   <para>
    您可在<guimenu>配置文件模式配置</guimenu>对话框中查看和编辑当前装载的 <phrase>AppArmor</phrase> 配置文件的模式。在开发配置文件期间，可以使用此功能来确定系统的状态。在系统性配置文件构建（请参见<xref linkend="sec-apparmor-commandline-profiling-systemic"/>）期间，您可以使用此工具来调整和监视您正在探测其行为的配置文件的范围。
   </para>
   <para>
    要编辑应用程序的配置文件模式，请执行以下操作：
   </para>
   <procedure>
    <step>
     <para>
      启动 YaST，选择 <guimenu><phrase>AppArmor</phrase> 配置</guimenu>，然后在主窗口中单击<guimenu>设置</guimenu>。
     </para>
    </step>
    <step>
     <para>
      在<guimenu>配置配置文件模式</guimenu>部分，选择<guimenu>配置</guimenu>。
     </para>
    </step>
    <step>
     <para>
      选择要更改其模式的配置文件。
     </para>
    </step>
    <step>
     <para>
      选择<guimenu>转换模式</guimenu>以将此配置文件设置为<emphasis>控诉</emphasis>模式或<emphasis>强制</emphasis>模式。
     </para>
    </step>
    <step>
     <para>
      应用您的设置，然后单击<guimenu>完成</guimenu>退出 YaST。
     </para>
    </step>
   </procedure>
   <para>
    要更改所有配置文件的模式，请使用<guimenu>全部设置为强制</guimenu>或<guimenu>全部设置为控诉</guimenu>。
   </para>
   <tip>
    <title>列出可用的配置文件</title>
    <para>
     默认只会列出活动的配置文件（系统上安装了其匹配应用程序的配置文件）。要在安装相关应用程序之前设置配置文件，请单击<guimenu>显示所有配置文件</guimenu>，然后从显示的列表中选择要配置的配置文件。
    </para>
   </tip>
  </sect2>
 </sect1>
</chapter>
