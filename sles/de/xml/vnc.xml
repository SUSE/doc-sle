<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="vnc.xml" version="5.0" xml:id="cha.vnc">
 <title>Fernzugriff mit VNC</title>
 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:bugtracker/>
   <dm:translation>Ja</dm:translation>
  </dm:docmanager>
  <abstract>
   <para>
    Mit Virtual Network Computing (VNC) können Sie einen Remote-Computer über einen grafischen Desktop steuern (anders als bei einem Remote-Shell-Zugriff). VNC ist plattformunabhängig und ermöglicht Ihnen den Zugriff auf den Remote-Rechner über ein beliebiges Betriebssystem.
   </para>

   <para>
    <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> unterstützt zwei verschiedene Arten von VNC-Sitzungen: einmalige Sitzungen, die so lange <quote>aktiv</quote> sind, wie die VNC-Verbindung zum Client besteht, und permanente Sitzungen, die so lange <quote>aktiv</quote> sind, bis sie explizit beendet werden.
   </para>
  </abstract>
 </info>
 <note>
  <title>Sitzungstypen </title>
  <para>
   Ein Rechner kann beide Sitzungen gleichzeitig auf verschiedenen Ports bieten, eine geöffnete Sitzung kann jedoch nicht von einem Typ in den anderen konvertiert werden.
  </para>
 </note>
 
 <sect1 xml:id="sec.vnc.viewer">
  <title>Der <command>vncviewer</command>-Client</title>

  <para>
   Um eine Verbindung zu einem VNC-Dienst herzustellen, der von einem Server bereitgestellt wird, ist ein Client erforderlich. Der Standard-Client in <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> ist <command>vncviewer</command>, der im Paket <systemitem class="resource">tigervnc</systemitem> bereitgestellt wird.
  </para>

  <sect2 xml:id="sec.vnc.viewer.connectcli">
   <title>Verbinden mithilfe der vncviewer-CLI</title>
   <para>
    Mit folgendem Kommando können Sie den VNC-Viewer starten und eine Sitzung mit dem Server initiieren:
   </para>
<screen>vncviewer jupiter.example.com:1</screen>
   <para>
    Anstelle der VNC-Anmeldenummer können Sie auch die Portnummer mit zwei Doppelpunkten angeben:
   </para>
<screen>vncviewer jupiter.example.com::5901</screen>
   <note>
    <title>Hinweis: Anzeige- und Portnummer</title>
    <para>
     Die im VNC-Client angegebene Anzeige- oder Portnummer muss mit der Anzeige- oder Portnummer übereinstimmen, die durch den Befehl <command>vncserver</command> auf dem Zielcomputer ausgewählt wird. Weitere Informationen finden Sie unter <xref linkend="sec.vnc.persistent"/>.
    </para>
   </note>
  </sect2>

  <sect2 xml:id="sec.vnc.viewer.connectgui">
   <title>Verbinden mithilfe der vncviewer-GUI</title>
   <para>
    Wenn <command>vncviewer</command> ausgeführt wird, ohne <command>--listen</command> oder einen Host für die Verbindung anzugeben, wird ein Fenster zur Eingabe von Verbindungsinformationen angezeigt. Geben Sie den Host in das Feld <guimenu>VNC server</guimenu> (VNC-Server) wie in <xref linkend="sec.vnc.viewer.connectcli"/> ein und klicken Sie auf <guimenu>Connect</guimenu> (Verbinden).
   </para>
   <figure xml:id="fig.vnc.viewer.connectgui">
    <title>vncviewer</title>
    <mediaobject>
     <textobject role="description"><phrase>vncviewer fordert die Angabe von Verbindungsinformationen</phrase>
     </textobject>
     <imageobject role="html">
      <imagedata fileref="vnc_connect.png" format="PNG"/>
     </imageobject>
     <imageobject role="fo">
      <imagedata fileref="vnc_connect.png" format="PNG"/>
     </imageobject>
    </mediaobject>
   </figure>
  </sect2>

  <sect2 xml:id="sec.vnc.viewer.encrypt">
   <title>Benachrichtigungen zu unverschlüsselten Verbindungen</title>
   <para>
    Das VNC-Protokoll unterstützt verschiedene Arten von verschlüsselten Verbindungen, nicht zu verwechseln mit Passwortauthentifizierung. Wenn eine Verbindung kein TLS verwendet, wird der Text <quote>(Connection not encrypted!)</quote> (Verbindung nicht verschlüsselt!) im Fenstertitel des VNC-Viewers angezeigt.
   </para>
  </sect2>
 </sect1>
 <sect1 xml:id="sec.vnc.one-time">
  <title>Einmalige VNC-Sitzungen</title>

  <para>
   Eine einmalige Sitzung wird vom Remote-Client initiiert. Sie startet einen grafischen Anmeldebildschirm auf dem Server. Auf diese Weise können Sie den Benutzer auswählen, der die Sitzung starten soll sowie, sofern vom Anmeldungsmanager unterstützt, die Desktop-Umgebung. Wenn Sie die Client-Verbindung, beispielsweise eine VNC-Sitzung, beenden, werden auch alle während der Sitzung gestarteten Anwendungen beendet. Einmalige VNC-Sitzungen können nicht freigegeben werden, Sie können jedoch mehrere Sitzungen gleichzeitig auf demselben Host ausführen.
  </para>

  <procedure xml:id="pro.vnc.one-time.activate">
   <title>Aktivieren von einmaligen VNC-Sitzungen</title>
   <step>
    <para>
     Starten Sie <menuchoice> <guimenu>YaST</guimenu> <guimenu>Netzwerkdienste</guimenu> <guimenu>Verwaltung von entfernten Rechnern aus (remote) (VNC)</guimenu>
     </menuchoice>.
    </para>
   </step>
   <step>
    <para>
     Aktivieren Sie <guimenu>Verwaltung via entfernten Rechner (remote) erlauben</guimenu>.
    </para>
   </step>
   <step>
    <para>
     Aktivieren Sie bei Bedarf <guimenu>Firewall-Port öffnen</guimenu> (wenn Ihre Netzwerkschnittstelle z. B. so konfiguriert ist, dass sie in der externen Zone liegt). Wenn Sie mehrere Netzwerkschnittstellen haben, beschränken Sie das Öffnen der Firewall-Ports über <guimenu>Firewall-Details</guimenu> auf eine bestimmte Schnittstelle.
    </para>
   </step>
   <step>
    <para>
     Bestätigen Sie die Einstellungen mit <guimenu>Beenden</guimenu>.
    </para>
   </step>
   <step>
    <para>
     Falls zu dem Zeitpunkt noch nicht alle erforderlichen Pakete verfügbar sind, müssen Sie der Installation der fehlenden Pakete zustimmen.
    </para>
   </step>
  </procedure>

  <sect2 xml:id="sec.vnc.one-time.configs">
   <title>Verfügbare Konfigurationen</title>
   <para>
    Die Standardkonfiguration von <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> stellt Sitzungen mit einer Auflösung von 1024 x 768 Pixeln und einer Farbtiefe von 16 Bit bereit. Die Sitzungen sind an Port <systemitem class="resource">5901</systemitem> für <quote>reguläre</quote> VNC-Viewer (entspricht VNC-Display <literal>1</literal>) und an Port <systemitem class="resource">5801</systemitem> für Webbrowser verfügbar.
   </para>
   <para>
    Weitere Konfigurationen können an anderen Ports verfügbar gemacht werden.<phrase os="sles;osuse">, siehe <xref linkend="sec.vnc.one-time.config"/></phrase>
   </para>
   <para>
    VNC-Anzeigenummern und X-Anzeigenummern sind bei einmaligen Sitzungen unabhängig. Eine VNC-Anzeigenummer wird manuell jeder Konfiguration zugewiesen, die vom Server unterstützt wird (:1 im obigen Beispiel). Immer, wenn eine VNC-Sitzung mit einer der Konfigurationen initiiert wird, erhält sie automatisch eine freie X-Display-Nummer.
   </para>
   <para>
    Standardmäßig versuchen sowohl der VNC-Client als auch der Server, über ein selbstsigniertes SSL-Zertifikat sicher zu kommunizieren, das nach der Installation erzeugt wird. Verwenden Sie wahlweise das Standardzertifikat oder ersetzen Sie es durch Ihr eigenes Zertifikat. Wenn Sie das selbstsignierte Zertifikat verwenden, müssen Sie vor dem ersten Herstellen einer Verbindung die Signatur bestätigen – sowohl im VNC-Viewer als auch im Webbrowser. Der Java-Client wird über HTTPS mit demselben Zertifikat wie VNC bereitgestellt.
   </para>
  </sect2>

  <sect2 xml:id="sec.vnc.one-time.connect">
   <title>Initiieren einer einmaligen VNC-Sitzung</title>
   <para>
    Um eine Verbindung zu einer permanenten VNC-Sitzung herzustellen, muss ein VNC-Viewer installiert sein, lesen Sie hierzu auch <xref linkend="sec.vnc.viewer"/>. Alternativ können Sie einen Java-fähigen Webbrowser verwenden, um die VNC-Sitzung anzuzeigen. Geben Sie hierzu folgende URL ein: <literal>http://jupiter.example.com:5801</literal>.
   </para>
  </sect2>

  <sect2 xml:id="sec.vnc.one-time.config">
   <title>Konfigurieren einmaliger VNC-Sitzungen</title>
   <para>
    Sie können diesen Abschnitt überspringen, wenn Sie die Standardkonfiguration nicht ändern müssen bzw. möchten.
   </para>
   <para>
    Einmalige VNC-Sitzungen werden über den <systemitem class="daemon">xinetd</systemitem>-Daemon gestartet. Eine Konfigurationsdatei befindet sich unter <filename>/etc/xinetd.d/vnc</filename>. Standardmäßig bietet sie sechs Konfigurationsblöcke: drei für VNC-Viewer (<literal>vnc1</literal> bis <literal>vnc3</literal>) und drei für Java-Applets (<literal>vnchttpd1</literal> bis <literal>vnchttpd3</literal>). Standardmäßig sind nur <literal>vnc1</literal> und <literal>vnchttpd1</literal> aktiv.
   </para>
   <para>
    Um eine Konfiguration zu aktivieren, können Sie die Zeile <literal>disable = yes</literal> mit dem Zeichen <literal>#</literal> in der ersten Spalte auskommentieren oder die Zeile vollständig löschen. Wenn Sie eine Konfiguration deaktivieren möchten, dann entfernen Sie das Kommentarzeichen oder fügen Sie diese Zeile hinzu.
   </para>
   <para>
    Der <command>Xvnc</command>-Server kann über die Option <literal>server_args</literal> konfiguriert werden – eine Liste der Optionen finden Sie mit <command>Xnvc --help</command>.
   </para>
   <para>
    Achten Sie beim Hinzufügen benutzerdefinierter Konfigurationen darauf, keine Ports zu verwenden, die bereits von anderen Konfigurationen, anderen Services oder bestehenden permanenten VNC-Sitzungen auf demselben Host verwendet werden.
   </para>
   <para>
    Aktivieren Sie Konfigurationsänderungen mit folgendem Kommando:
   </para>
<screen>sudo systemctl reload xinetd</screen>
   <important>
    <title>Firewall und VNC-Ports</title>
    <para>
     Wenn Sie die entfernte Verwaltung wie in <xref linkend="pro.vnc.one-time.activate"/> beschrieben aktivieren, werden die Ports <systemitem class="resource">5801</systemitem> und <systemitem class="resource">5901</systemitem> in der Firewall geöffnet. Wenn die Netzwerkschnittstelle, über die die VNC-Sitzung bereitgestellt wird, durch eine Firewall geschützt wird, müssen Sie die entsprechenden Ports manuell öffnen, wenn Sie zusätzliche Ports für VNC-Sitzungen aktivieren. Eine Anleitung dazu finden Sie in <xref linkend="cha.security.firewall"/>.
    </para>
   </important>
  </sect2>
 </sect1>
 <sect1 xml:id="sec.vnc.persistent">
  <title>Permanente VNC-Sitzungen</title>

  <para>
   Eine permanente VNC-Sitzung wird auf dem Server initiiert. Die Sitzung und sämtliche in dieser Sitzungsausführung gestarteten Anwendungen werden ungeachtet der Client-Verbindungen so lange ausgeführt, bis die Sitzung beendet wird.
  </para>

  <para>
   Auf eine permanente Sitzung kann gleichzeitig von mehreren Clients zugegriffen werden. Dies eignet sich ideal für Demozwecke, bei denen ein Client den vollen Zugriff und alle anderen einen reinen Anzeigezugriff haben. Weiter eignet sich dies für Schulungen, bei denen der Schulungsleiter einen Zugriff auf den Desktop des Teilnehmers benötigt. In den meisten Fällen werden Sie Ihre VNC-Sitzung jedoch nicht freigeben wollen. 
  </para>

  <para>
   Im Gegensatz zu einer einmaligen Sitzung, bei der ein Display-Manager gestartet wird, startet eine permanente Sitzung einen einsatzbereiten Desktop, der unter dem Benutzernamen ausgeführt wird, unter dem die VNC-Sitzung gestartet wurde. Der Zugriff auf permanente Sitzungen ist passwortgeschützt.
  </para>

  <para>
   Der Zugriff auf permanente Sitzungen wird durch zwei mögliche Arten von Passwörtern geschützt:
  </para>

  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>
     ein reguläres Passwort, das den vollen Zugriff ermöglicht, oder
    </para>
   </listitem>
   <listitem>
    <para>
     ein optionales Passwort, das keinen interaktiven Zugriff ermöglicht und nur eine Anzeige liefert.
    </para>
   </listitem>
  </itemizedlist>

  <para>
   Eine Sitzung kann mehrere Client-Verbindungen beider Arten gleichzeitig haben.
  </para>

  <procedure xml:id="pro.vnc.persistent.activate">
   <title>Starten einer permanenten VNC-Sitzung</title>
   <step>
    <para>
     Öffnen Sie eine Shell uns stellen Sie sicher, dass Sie als der Benutzer angemeldet sind, der Eigentümer der VNC-Sitzung sein soll.

    </para>
   </step>
   <step>
    <para>
     Wenn die Netzwerkschnittstelle, über die die VNC-Sitzung bereitgestellt wird, durch eine Firewall geschützt wird, müssen Sie die von Ihrer Sitzung verwendeten Ports manuell in der Firewall öffnen. Wenn Sie mehrere Sitzungen starten, können ie alternativ einen Portbereich öffnen. Details zur Konfiguration der Firewall finden Sie unter <xref linkend="cha.security.firewall"/>.
    </para>
    <para>
     <command>vncserver</command> verwendet die Port <systemitem class="resource">5901</systemitem> für Display <literal>:1</literal>, <systemitem class="resource">5902</systemitem> für Display <literal>:2</literal> usw. Bei permanenten Sitzungen haben das VNC-Display und das X-Display normalerweise dieselbe Nummer.
    </para>
   </step>
   <step>
    <para>
     Geben Sie folgendes Kommando ein, um eine Sitzung mit einer Auflösung von 1024x769 Pixel und einer Farbtiefe von 16 Bit zu starten:
    </para>
<screen>vncserver -geometry 1024x768 -depth 16</screen>
    <para>
     Das Kommando <command>vncserver</command> verwendet, sofern keine Display-Nummer angegeben ist, eine freie Display-Nummer und gibt seine Auswahl aus. Weitere Optionen finden Sie mit <command>man 1 vncserver</command>.
    </para>
   </step>
  </procedure>

  <para>
   Bei der erstmaligen Ausführung von <command>vncserver</command> wird nach einem Passwort für den vollständigen Zugriff auf die Sitzung gefragt. Geben Sie gegebenenfalls auch ein Passwort für den reinen Anzeigezugriff auf die Sitzung ein.
  </para>

  <para>
   Die hier angegebenen Passwörter werden auch für zukünftige Sitzungen verwendet, die durch denselben Benutzer gestartet werden. Sie können mit dem Kommando <command>vncpasswd</command> geändert werden.
  </para>

  <important>
   <title>Sicherheitsüberlegungen</title>
   <para>
    Achten Sie darauf, dass Ihre Passwörter sicher und ausreichend lang sind (mindestens acht Zeichen). Teilen Sie diese Passwörter niemandem mit. 
   </para>
  </important>

  <para>
   Beenden Sie, um die Sitzung zu beenden, die Desktopumgebung, die innerhalb der VNC-Sitzung ausgeführt wird über den VNC-Viewer so, wie Sie eine normale lokale X-Sitzung beenden würden. 
  </para>

  <para>
   Wenn Sie eine Sitzung lieber manuell beenden, öffnen Sie eine Shell auf dem VNC-Server und vergewissern Sie sich, dass Sie als der Benutzer angemeldet ist, der der Eigentümer der zu beendenden VNC-Sitzung ist. Führen Sie das folgende Kommando aus, um die Sitzung zu beenden, die auf Display <literal>:1</literal>: <command>vncserver -kill :1</command> ausgeführt wird.
  </para>

  <sect2 xml:id="sec.vnc.persistent.connect">
   <title>Verbindung zu einer permanenten VNC-Sitzung herstellen</title>
   <para>
    Um eine Verbindung zu einer permanenten VNC-Sitzung herzustellen, muss ein VNC-Viewer installiert sein, lesen Sie hierzu auch <xref linkend="sec.vnc.viewer"/>. Alternativ können Sie einen Java-fähigen Webbrowser verwenden, um die VNC-Sitzung anzuzeigen. Geben Sie hierzu folgende URL ein: <literal>http://jupiter.example.com:5801</literal>.
   </para>
  </sect2>

  <sect2 xml:id="sec.vnc.persistent.configure">
   <title>Konfigurieren von permanenten VNC-Sitzungen</title>
   <para>
    Permanente VNC-Sitzungen können durch Bearbeiten von <filename>$HOME/.vnc/xstartup</filename> konfiguriert werden. Standardmäßig startet dieses Shell-Skript dieselbe GUI bzw. denselben Fenstermanager, aus dem es gestartet wurde. In <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> ist dies entweder GNOME oder IceWM. Wenn Sie beim Starten Ihrer Sitzung einen bestimmten Fenstermanager verwenden möchten, legen Sie die Variable <envar>WINDOWMANAGER</envar> fest:
   </para>
<screen>WINDOWMANAGER=gnome vncserver -geometry 1024x768
WINDOWMANAGER=icewm vncserver -geometry 1024x768</screen>
   <note>
    <title>Eine Konfiguration pro Benutzer</title>
    <para>
     Permanente VNC-Sitzungen werden jeweils nur einmal pro Benutzer konfiguriert. Mehrere von demselben Benutzer gestartete Sitzungen verwenden alle dieselben Start- und Passwortdateien.
    </para>
   </note>
  </sect2>
 </sect1>
 <sect1 xml:id="vnc.encrypted">
  <title>Verschlüsselte VNC-Kommunikation</title>

  <para>
   Wenn der VNC-Server ordnungsgemäß eingerichtet ist, wird die gesamte Kommunikation zwischen dem VNC-Server und dem Client verschlüsselt. Hierzu gehört die Authentifizierung zu Beginn sowie die gesamte Datenübertragung im weiteren Verlauf.
  </para>

  <para>
   Die Sicherheitsoptionen werden unabhängig vom Typ der zu startenden VNC-Sitzung (einmalig oder persistent) mit dem Parameter <option>-securitytypes</option> des Befehls <command>/usr/bin/Xvnc</command> in der Zeile <literal>server_args</literal> konfiguriert. Der Parameter <option>-securitytypes</option> bestimmt sowohl die Authentifizierungsmethode als auch die Verschlüsselung. Hier stehen die folgenden Optionen zur Auswahl:
  </para>

  <variablelist>
   <title>Authentifizierungen</title>
   <varlistentry>
    <term>None, TLSNone, X509None</term>
    <listitem>
     <para>
      Keine Authentifizierung.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>VncAuth, TLSVnc, X509Vnc</term>
    <listitem>
     <para>
      Authentifizierung mit benutzerdefiniertem Passwort.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Plain, TLSPlain, X509Plain</term>
    <listitem>
     <para>
      Authentifizierung mit Überprüfung des Benutzerpassworts mit PAM.
     </para>
    </listitem>
   </varlistentry>
  </variablelist>

  <variablelist>
   <title>Verschlüsselungen</title>
   <varlistentry>
    <term>None, VncAuth, Plain</term>
    <listitem>
     <para>
      Keine Verschlüsselung.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>TLSNone, TLSVnc, TLSPlain</term>
    <listitem>
     <para>
      Anonyme TLS-Verschlüsselung. Alle Angaben werden verschlüsselt; auf dem Remote-Host erfolgt jedoch keine Überprüfung. Damit sind Sie gegen passive Angreifer geschützt, nicht jedoch gegen Man-in-the-Middle-Angreifer.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>X509None, X509Vnc, X509Plain</term>
    <listitem>
     <para>
      TLS-Verschlüsselung mit Zertifikat. Wenn Sie ein selbstsigniertes Zertifikat heranziehen, werden Sie bei der ersten Verbindung aufgefordert, dieses Zertifikat zu bestätigen. Bei weiteren Verbindungen erhalten Sie nur dann eine Warnung, wenn das Zertifikat geändert wurde. So sind Sie gegen alle Angreifer geschützt, ausgenommen Man-in-the-Middle-Angreifer bei der ersten Verbindung (ähnlich wie bei der typischen SSH-Verwendung). Wenn Sie ein Zertifikat heranziehen, das von einer Zertifizierungsstelle signiert wurde und das mit dem Computernamen übereinstimmt, erzielen Sie praktisch uneingeschränkte Sicherheit (ähnlich wie bei der typischen HTTPS-Verwendung).
     </para>
     <tip>
      <title>Pfad zum Zertifikat und zum Schlüssel</title>
      <para>
       Bei der X509-gestützten Verschlüsselung müssen Sie den Pfad zum X509-Zertifikat/-Schlüssel mit den Optionen <option>-X509Cert</option> und <option>-X509Key</option> angeben.
      </para>
     </tip>
    </listitem>
   </varlistentry>
  </variablelist>

  <para>
   Wenn Sie mehrere Sicherheitstypen angeben (jeweils durch Komma getrennt), wird der erste Typ herangezogen, der sowohl vom Client als auch vom Server unterstützt wird. So können Sie die opportunistische Verschlüsselung auf dem Server konfigurieren. Dies ist von Nutzen, wenn VNC-Clients unterstützt werden sollen, die ihrerseits keine Verschlüsselung unterstützen.
  </para>

  <para>
   Auf dem Client können Sie außerdem die zulässigen Sicherheitstypen angeben, sodass ein Downgrade-Angriff vermieden wird, wenn Sie eine Verbindung zu einem Server herstellen, auf dem bekanntermaßen die Verschlüsselung aktiviert ist. (Der VNC-Viewer warnt Sie in diesem Fall allerdings mit der Meldung „Verbindung nicht verschlüsselt!“ ).
  </para>
 </sect1>
</chapter>
