<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="printing.xml" version="5.0" xml:id="cha-print"> <title>Operação da impressora</title>
 <info>
      <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
        <dm:bugtracker/>
        <dm:translation>yes</dm:translation>
      </dm:docmanager>
    </info>
    <para>
  O <phrase role="productname"><phrase os="sled">SUSE® Linux Enterprise Desktop</phrase></phrase> suporta a impressão com muitos tipos de impressoras, incluindo impressoras de rede remotas. É possível configurar as impressoras manualmente ou com o YaST. Para obter instruções de configuração, consulte a <xref linkend="sec-yast-hw-print"/>. Os utilitários gráficos e de linha de comando estão disponíveis para iniciar e gerenciar serviços de impressão. Se a sua impressora não funcionar como se esperava, consulte a <xref linkend="sec-print-prob"/>.
 </para>
 <para>
  CUPS (Common Unix Printing System) é o sistema de impressão padrão no <phrase role="productname"><phrase os="sled">SUSE Linux Enterprise Desktop</phrase></phrase>.
 </para>
 <para>
  As impressoras podem ser distinguidas pela interface, como USB ou rede, e pela linguagem de impressão. Ao comprar uma impressora, verifique se a sua interface é suportada (USB, Ethernet ou Wi-Fi) e se a sua linguagem é adequada. As impressoras podem ser categorizadas com base em três classes de linguagem:
 </para>
 <variablelist>
  <varlistentry>
   <term>Impressoras PostScript</term>
   <listitem>
    <para>
     PostScript é a linguagem de impressora na qual a maior parte dos serviços de impressão em Linux e Unix são gerados e processados pelo sistema de impressão interno. Se documentos PostScript puderem ser diretamente processados pela impressora e não precisarem ser convertidos em estágios adicionais do sistema de impressão, o número de origens de erro potenciais será reduzido.
    </para>
    <para>
     Atualmente, o PostScript vem sendo substituído pelo PDF como o formato padrão dos serviços de impressão. Já existem impressoras PostScript+PDF que imprimem diretamente em PDF (e também em PostScript). Para as impressoras PostScript tradicionais, é necessário converter de PDF em PostScript no workflow de impressão.
    </para>
   </listitem>
  </varlistentry>
  <varlistentry>
   <term>Impressoras padrão (linguagens como PCL e ESC/P)</term>
   <listitem>
    <para>
     No caso de linguagens de impressora conhecidas, o sistema de impressão pode converter serviços PostScript na respectiva linguagem de impressão com o Ghostscript. Esta fase do processamento é chamada de interpretação. As linguagens mais conhecidas são PCL (mais usada pelas impressoras HP e seus clones) e ESC/P (utilizada nas impressoras Epson). Geralmente, essas linguagens são suportadas no Linux e produzem um resultado de impressão adequado. O Linux pode não conseguir realizar algumas funções especiais da impressora. Com exceção da HP e da Epson, não há fabricantes de impressoras que desenvolvem e disponibilizam drivers de Linux a distribuidores Linux sob uma licença de código-fonte aberto.
    </para>
   </listitem>
  </varlistentry>
  <varlistentry xml:id="sec-print-prep-gdi">
   <term>Impressoras proprietárias (também denominadas impressoras GDI)</term>
   <listitem>
    <para>
     Essas impressoras não suportam nenhuma das linguagens de impressora comuns. Elas usam suas próprias linguagens de impressora não documentadas, que ficam sujeitas a mudanças quando é lançada uma edição nova de um modelo. Geralmente, apenas os drivers do Windows estão disponíveis para essas impressoras. Consulte a <xref linkend="sec-print-gdi"/> para obter mais informações.
    </para>
   </listitem>
  </varlistentry>
 </variablelist>
 <para>
  Antes de comprar uma nova impressora, consulte as seguintes fontes para verificar a abrangência do suporte ao equipamento pretendido:
 </para>
 <variablelist>
  <varlistentry>
   <term><link xlink:href="http://www.openprinting.org/printers"/>
   </term>
   <listitem>
    <para>
     A home page OpenPrinting com o banco de dados de impressão. O banco de dados mostra o status mais recente de suporte do Linux. No entanto, a distribuição do Linux só pode integrar os drivers disponíveis no momento da produção. Da mesma forma, uma impressora atualmente classificada como <quote>perfeitamente suportada</quote> talvez não apresentasse esse status quando a versão mais recente do <phrase role="productname"><phrase os="sled">SUSE Linux Enterprise Desktop</phrase></phrase> foi lançada. Assim, os bancos de dados não indicarão necessariamente o status correto, mas apenas uma informação aproximada.
    </para>
   </listitem>
  </varlistentry>
  <varlistentry>
   <term><link xlink:href="http://pages.cs.wisc.edu/~ghost/"/>
   </term>
   <listitem>
    <para>
     Página do Ghostscript na Web.
    </para>
   </listitem>
  </varlistentry>
  <varlistentry>
   <term><filename>/usr/share/doc/packages/ghostscript/catalog.devices</filename>
   </term>
   <listitem>
    <para>
     Lista de drivers Ghostscript incorporados.
    </para>
   </listitem>
  </varlistentry>
 </variablelist>
 <sect1 xml:id="sec-print-workflow">
  <title>O workflow do CUPS</title>

  <para>
   O usuário cria um serviço de impressão. O serviço de impressão consiste nos dados que serão impressos mais as informações do spooler. Isso inclui o nome da impressora ou o nome da fila de impressão e, opcionalmente, as informações do filtro (por exemplo, as opções específicas da impressora).
  </para>

  <para>
   Existe pelo menos uma fila de impressão dedicada para cada impressora. O spooler mantém o serviço de impressão em fila até que a impressora desejada esteja pronta para receber dados. Uma vez pronta, o spooler envia os dados pelo filtro, tendo a impressora como back end.
  </para>

  <para>
   O filtro converte os dados gerados pelo aplicativo que está imprimindo (geralmente PostScript ou PDF, mas também ASCII, JPEG etc.) em dados específicos da impressora (PostScript, PCL, ESC/P etc.). Os recursos da impressora são descritos nos arquivos PPD. O arquivo PPD contém opções da impressora com os parâmetros necessários para habilitá-los. O sistema de filtros verifica se as opções selecionadas pelo usuário foram habilitadas.
  </para>

  <para>
   Se você usa uma impressora PostScript, o sistema de filtros converte os dados em PostScript específico da impressora. Isso não exige um driver de impressora. Se você usa uma impressora não PostScript, o sistema de filtros converte os dados em dados específicos da impressora. Isso exige um driver adequado à sua impressora. O back end recebe do filtro os dados específicos da impressora e os repassa a ela.
  </para>
 </sect1>
 <sect1 xml:id="sec-print-method">
  <title>Métodos e protocolos de conexão de impressoras</title>

  <para>
   Existem várias possibilidades para conectar uma impressora ao sistema. A configuração do CUPS não faz distinção entre uma impressora local e uma impressora conectada ao sistema pela rede. Para obter mais informações sobre a conexão de impressoras, leia o artigo <emphasis>CUPS in a Nutshell</emphasis> (CUPS numa Casca de Noz) em <link xlink:href="https://en.opensuse.org/SDB:CUPS_in_a_Nutshell"/>.
  </para>

  

  <warning>
   <title>Mudando as conexões de cabo em um sistema em execução</title>
   <para>
    Ao conectar a impressora à máquina, não esqueça de que apenas dispositivos USB podem ser conectados ou desconectados durante a operação. Para evitar danos ao sistema ou à impressora, encerre o sistema antes de mudar qualquer conexão que não seja USB.
   </para>
  </warning>
 </sect1>
 <sect1 xml:id="sec-print-software">
  <title>Instalando o software</title>

  <para>
   PPD (descrição de impressora PostScript) é a linguagem de computador que descreve as propriedades, como resolução, e as opções, como disponibilidade de uma unidade duplex. Essas descrições são necessárias para o uso de várias opções de impressora no CUPS. Sem um arquivo PPD, os dados de impressão seriam encaminhados à impressora em estado <quote>bruto</quote>, o que normalmente não é desejado.
  </para>

  <para>
   Para configurar uma impressora PostScript, a melhor opção é obter um arquivo PPD adequado. Muitos arquivos PPD estão disponíveis nos pacotes <systemitem>manufacturer-PPDs</systemitem> e <systemitem>OpenPrintingPPDs-postscript</systemitem>. Consulte a <xref linkend="sec-print-special-ppd"/> e a <xref linkend="sec-print-prob-ppd"/>.
  </para>

  <para>
   É possível armazenar novos arquivos PPD no diretório <filename>/usr/share/cups/model/</filename> ou adicioná-los ao sistema de impressão com o YaST, conforme descrito na <xref linkend="sec-yast-hw-print-local-get-ppd"/>. Na sequência, é possível selecionar o arquivo PPD durante a configuração da impressora.
  </para>

  <para>
   Observe se o fabricante da impressora requer que você instale pacotes inteiros de software. Esse tipo de instalação pode resultar na perda do suporte oferecido pelo <phrase role="productname"><phrase os="sled">SUSE Linux Enterprise Desktop</phrase></phrase>. Além disso, os comandos de impressão podem funcionar de forma diferente, e o sistema talvez não possa mais processar dispositivos de outros fabricantes. Por isso, não recomendamos instalar o software do fabricante.
  </para>
 </sect1>
 <sect1 xml:id="sec-print-net">
  <title>Impressoras de rede</title>

  <para>
   Uma impressora de rede pode suportar vários protocolos, alguns deles até simultaneamente. Embora a maioria dos protocolos suportados seja padronizada, alguns fabricantes modificam o padrão. Os fabricantes então fornecem drivers apenas para alguns sistemas operacionais. Infelizmente, raros são os drivers para Linux. Na situação atual, não é possível agir como se todos os protocolos funcionassem perfeitamente no Linux. Portanto, talvez seja necessário testar várias opções para chegar a uma configuração funcional.
  </para>



  <para>
   O CUPS suporta os protocolos <systemitem>socket</systemitem>, <systemitem>LPD</systemitem>, <systemitem>IPP</systemitem> e <systemitem>smb</systemitem>.
  </para>

  <variablelist>
   <varlistentry>
    <term>socket</term>
    <listitem>
     <para>
      <emphasis>Socket</emphasis> refere-se a uma conexão em que os dados de impressão simples são enviados diretamente a um soquete TCP. Alguns números de portas de soquete normalmente usados são <option>9100</option> ou <option>35</option>. A sintaxe do URI (Uniform Resource Identifier) do dispositivo é: socket://<replaceable>IP.DA.IMPRESSORA</replaceable>:<replaceable>PORTA</replaceable>. Por exemplo: <systemitem>socket://192.168.2.202:9100/</systemitem>.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>LPD (daemon de impressora de linha)</term>
    <listitem>
     <para>
      O protocolo LPD está descrito no RFC 1179. Nesse protocolo, alguns dados relacionados ao serviço, como o ID da fila de impressão, são enviados antes dos dados da impressão propriamente ditos. Portanto, a fila de impressão deve ser especificada no momento da configuração do protocolo LPD. As implementações de fabricantes de impressoras diferentes são flexíveis o suficiente para aceitar qualquer nome como a fila de impressão. Se necessário, o manual da impressora indicará o nome a ser usado. Geralmente se usa LPT, LPT1, LP1 ou nomes semelhantes. O número de porta para o serviço LPD é <option>515</option>. Um exemplo de URI de dispositivo é <systemitem>lpd://192.168.2.202/LPT1</systemitem>.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>IPP (protocolo de impressão de Internet)</term>
    <listitem>
     <para>
      O IPP é baseado no protocolo HTTP. Com o IPP, mais dados referentes à tarefa são transmitidos. O CUPS usa o IPP em transmissões internas de dados. É necessário indicar o nome da fila de impressão para que o IPP seja configurado corretamente. A porta padrão do IPP é <literal>631</literal>. Exemplos de URIs de dispositivo: <systemitem>ipp://192.168.2.202/ps</systemitem> e <systemitem>ipp://192.168.2.202/impressoras/ps</systemitem>.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>SMB (compartilhamento Windows)</term>
    <listitem>
     <para>
      O CUPS também suporta a impressão em impressoras conectadas a compartilhamentos Windows. O protocolo usado para essa finalidade é o SMB. O SMB usa os números de porta <option>137</option>, <option>138</option> e <option>139</option>. Exemplos de URIs de dispositivo: <systemitem>smb://usuário:senha@grupo_de_trabalho/smb.example.com/printer</systemitem>, <systemitem>smb://usuário:senha@smb.example.com/impressora</systemitem> e <systemitem>smb://smb.example.com/impressora</systemitem>.
     </para>
    </listitem>
   </varlistentry>
  </variablelist>

  <para>
   O protocolo suportado pela impressora deve ser determinado antes da configuração. Se o fabricante não fornecer as informações necessárias, o comando <command>nmap</command> (que vem com o pacote <systemitem>nmap</systemitem>) pode ser usado para verificar o protocolo. O <command>nmap</command> verifica se há portas abertas em um host. Por exemplo:
  </para>

<screen><prompt>tux &gt; </prompt>nmap -p 35,137-139,515,631,9100-10000 <replaceable>IP.OF.THE.PRINTER</replaceable></screen>
 </sect1>
 <sect1 xml:id="sec-print-net-config-cmdl">
  <title>Configurando o CUPS com ferramentas de linha de comando</title>

  <para>
   É possível configurar o CUPS com ferramentas de linha de comando, como <command>lpinfo</command>, <command>lpadmin</command> e <command>lpoptions</command>. Você precisa de um URI de dispositivo composto por um back end, como USB, e parâmetros. Para determinar os URIs de dispositivo válidos no sistema, use o comando <command>lpinfo -v | grep ":/"</command>:
  </para>

<screen><prompt>tux &gt; </prompt><command>sudo</command> lpinfo -v | grep ":/"
direct usb://ACME/FunPrinter%20XL
network socket://192.168.2.253</screen>

  <para>
   Com o <command>lpadmin</command>, o administrador do servidor CUPS pode adicionar, remover ou gerenciar filas de impressão. Para adicionar uma fila de impressão, use a seguinte sintaxe:
  </para>

<screen><prompt>tux &gt; </prompt><command>sudo</command> lpadmin -p <replaceable>QUEUE</replaceable> -v <replaceable>DEVICE-URI</replaceable> -P <replaceable>PPD-FILE</replaceable> -E</screen>

  <para>
   Em seguida, o dispositivo (<option>-v</option>) fica disponível como <replaceable>FILA</replaceable> (<option>-p</option>), usando o arquivo PPD especificado (<option>-P</option>). Isso significa que você precisa saber qual é o arquivo PPD e o URI de dispositivo para configurar a impressora manualmente.
  </para>

  <para>
   Não use <option>-E</option> como primeira opção. Em todos os comandos CUPS, <option>-E</option> como primeiro argumento define o uso de uma conexão criptografada. Para habilitar a impressora, <option>-E</option> deve ser usado como mostrado no seguinte exemplo:
  </para>

<screen><prompt>tux &gt; </prompt><command>sudo</command> lpadmin -p ps -v usb://ACME/FunPrinter%20XL -P \
/usr/share/cups/model/Postscript.ppd.gz -E</screen>

  <para>
   O seguinte exemplo configura uma impressora de rede:
  </para>

<screen><prompt>tux &gt; </prompt><command>sudo</command> lpadmin -p ps -v socket://192.168.2.202:9100/ -P \
/usr/share/cups/model/Postscript-level1.ppd.gz -E</screen>

  <para>
   Para conhecer mais opções de <command>lpadmin</command>, consulte a página de manual de <systemitem>lpadmin(8)</systemitem>.
  </para>

  <para>
   Durante a configuração da impressora, algumas opções são definidas como padrão. Essas opções podem ser modificadas para cada serviço de impressão (dependendo da ferramenta de impressão utilizada). Também é possível modificar essas opções padrão com o YaST. Usando ferramentas de linha de comando, defina opções padrão da seguinte forma:
  </para>

  <procedure>
   <step>
    <para>
     Primeiro, liste todas as opções:
    </para>
<screen><prompt>tux &gt; </prompt><command>sudo</command> lpoptions -p <replaceable>QUEUE</replaceable> -l</screen>
    <para>
     Exemplo:
    </para>
<screen>Resolution/Output Resolution: 150dpi *300dpi 600dpi</screen>
    <para>
     A opção padrão ativada é identificada por um asterisco na frente (<literal>*</literal>).
    </para>
   </step>
   <step>
    <para>
     Mude a opção com <command>lpadmin</command>:
    </para>
<screen><prompt>tux &gt; </prompt><command>sudo</command> lpadmin -p <replaceable>QUEUE</replaceable> -o Resolution=600dpi</screen>
   </step>
   <step>
    <para>
     Verifique a nova configuração:
    </para>
<screen><prompt>tux &gt; </prompt><command>sudo</command> lpoptions -p <replaceable>QUEUE</replaceable> -l

Resolution/Output Resolution: 150dpi 300dpi *600dpi</screen>
   </step>
  </procedure>

  <para>
   Quando um usuário comum executa <command>lpoptions</command>, as configurações são gravadas em <filename>~/.cups/lpoptions</filename>. Porém, as configurações de <systemitem class="username">root</systemitem> são gravadas em <filename>/etc/cups/lpoptions</filename>.
  </para>
 </sect1>
 <sect1 xml:id="sec-print-appl-commandline">
  <title>Imprimindo pela linha de comando</title>

  <para>
   Para imprimir da linha de comando, digite <command>lp -d</command>
   <replaceable> NOMEDAFILA</replaceable> <replaceable> NOMEDOARQUIVO</replaceable>, substituindo <replaceable>NOMEDAFILA</replaceable> e <replaceable>NOMEDOARQUIVO</replaceable> pelos nomes correspondentes.
  </para>

  <para>
   Alguns aplicativos dependem do comando <command>lp</command> para imprimir. Neste caso, digite o comando correto na caixa de diálogo do aplicativo, normalmente sem especificar <replaceable>NOMEDOARQUIVO</replaceable>. Por exemplo, <command>lp -d</command> <replaceable> NOMEDAFILA</replaceable>.
  </para>
 </sect1>
 <sect1 xml:id="sec-print-special">
  <title>Recursos especiais no <phrase role="productname"><phrase os="sled">SUSE Linux Enterprise Desktop</phrase></phrase></title>

  <para>
   Vários recursos do CUPS foram adaptados para o <phrase role="productname"><phrase os="sled">SUSE Linux Enterprise Desktop</phrase></phrase>. Algumas das mudanças mais importantes são abordadas aqui.
  </para>

  <sect2 xml:id="sec-print-special-cupsfire">
   <title>CUPS e firewall</title>
   <para>
    Após realizar a instalação padrão do <phrase role="productname"><phrase os="sled">SUSE Linux Enterprise Desktop</phrase></phrase>, o <systemitem class="daemon">firewalld</systemitem> estará ativo, e as interfaces de rede serão configuradas para ficarem na zona <literal>pública</literal>, que bloqueia o tráfego de entrada. 
</para>
   <para>
       Quando o <systemitem class="daemon">firewalld</systemitem> está ativo, pode ser necessário configurá-lo para permitir que os clientes procurem impressoras de rede com a permissão de <literal>mdns</literal> e <literal>ipp</literal> pela zona de rede interna. A zona pública nunca deve expor as filas da impressora. 
   </para>
   <para>
    (Há mais informações sobre a configuração do <systemitem class="daemon">firewalld</systemitem> disponíveis no <xref linkend="sec-security-firewall-firewalld"/> e em <link xlink:href="https://en.opensuse.org/SDB:CUPS_and_SANE_Firewall_settings"/>.)
   </para>
   <sect3 xml:id="sec-print-special-cupsfire-client">
    <title>Cliente CUPS</title>
    <para>
     Normalmente, um cliente CUPS é executado em uma estação de trabalho comum, localizada em um ambiente de rede confiável protegido por firewall. Neste caso, é recomendável configurar a interface de rede para ficar na <literal>Zona Interna</literal>, de modo que a estação de trabalho possa ser alcançada de dentro da rede.
    </para>
   </sect3>
   <sect3 xml:id="sec-print-special-cupsfire-server">
    <title>Servidor CUPS</title>
    <para>
     Se o servidor CUPS fizer parte de um ambiente de rede confiável, protegido por um firewall, a interface de rede deverá ser configurada para ficar na <literal>Zona Interna</literal> do firewall. Não é recomendado configurar um servidor CUPS em um ambiente de rede não confiável, a menos que você garanta que ele seja protegido por regras especiais de firewall e opções seguras na configuração do CUPS.
    </para>
   </sect3>
  </sect2>

  <sect2 xml:id="sec-print-special-browsing">
   <title>Procurando impressoras de rede</title>
   <para>
    Os servidores CUPS anunciam regularmente as informações sobre disponibilidade e status das impressoras compartilhadas na rede. Os clientes podem acessar essas informações para exibir uma lista de impressoras disponíveis nas caixas de diálogo de impressão, por exemplo. Isso se chama <quote>procurar</quote>.
   </para>
   <para>
    Os servidores CUPS anunciam suas filas de impressão pela rede usando o protocolo de procura tradicional do CUPS ou o Bonjour/DNS-SD. Para habilitar a procura de filas de impressão de rede, o serviço <systemitem class="daemon">cups-browsed</systemitem> precisa ser executado em todos os clientes que imprimem por meio de servidores CUPS. O <systemitem class="daemon">cups-browsed</systemitem> não é iniciado por padrão. Para iniciá-lo na sessão ativa, use <command>sudo systemctl start cups-browsed</command>. Para assegurar que ele seja iniciado automaticamente após a inicialização, habilite-o com <command>sudo systemctl enable cups-browsed</command> em todos os clientes.
   </para>
   <para>
    Caso a pesquisa não funcione depois de iniciar <systemitem class="daemon">cups-browsed</systemitem>, o(s) servidor(es) CUPS provavelmente anunciará(ão) as filas de impressão de rede pelo Bonjour/DNS-SD. Neste caso, é necessário instalar também o pacote <systemitem class="resource">avahi</systemitem> e iniciar o serviço associado ao <command>sudo systemctl start avahi-daemon</command> em todos os clientes.
   </para>
   <para>
       Consulte a <xref linkend="sec-print-special-cupsfire"/> para obter informações sobre como permitir a procura de impressoras por meio do <systemitem class="daemon">firewalld</systemitem>.
   </para>
  </sect2>

  <sect2 xml:id="sec-print-special-ppd">
   <title>Arquivos PPD em vários pacotes</title>
   <para>
    A configuração de impressora do YaST define as filas do CUPS usando os arquivos PPD instalados em <filename>/usr/share/cups/model</filename>. Para localizar os arquivos PPD adequados ao modelo da impressora, o YaST compara o fornecedor e o modelo determinados durante a detecção de hardware com os fornecedores e modelos em todos os arquivos PPD. Para isso, a configuração de impressora do YaST gera um banco de dados com as informações de fabricante e modelo extraídas dos arquivos PPD.
   </para>
   <para>
    A configuração com apenas arquivos PPD e nenhuma outra fonte de informação tem a vantagem de permitir a livre modificação de arquivos PPD em <filename>/usr/share/cups/model/</filename>. Por exemplo, se você possui impressoras PostScript, será possível copiar os arquivos PPD diretamente para <filename>/usr/share/cups/model</filename> (se ainda não existirem nos pacotes <systemitem>manufacturer-PPDs</systemitem> ou <systemitem>OpenPrintingPPDs-postscript</systemitem>) para atingir a configuração ideal para as suas impressoras.
   </para>
   <para>
    Os arquivos PPD adicionais são fornecidos pelos seguintes pacotes:
   </para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>
      <systemitem>gutenprint</systemitem>: o driver Gutenprint e seus PPDs correspondentes
     </para>
    </listitem>
    <listitem>
     <para>
      <systemitem>splix</systemitem>: o driver SpliX e seus PPDs correspondentes
     </para>
    </listitem>
    <listitem>
     <para>
      <systemitem>OpenPrintingPPDs-ghostscript</systemitem>: os PPDs para os drivers Ghostscript incorporados
     </para>
    </listitem>
    <listitem>
     <para>
      <systemitem>OpenPrintingPPDs-hpijs</systemitem>: PPDs para o driver HPIJS para impressoras não HP
     </para>
    </listitem>
   </itemizedlist>
  </sect2>
 </sect1>
 <sect1 xml:id="sec-print-prob">
  <title>Solução de problemas</title>

  <para>
   As seções a seguir abordam alguns dos problemas mais encontrados em relação a hardware e software de impressora, bem como formas de solucionar ou superar esses problemas. Os tópicos abordados incluem impressoras GDI, arquivos PPD e configuração de porta. Problemas comuns de impressoras de rede, impressões com defeito e gerenciamento de filas também são tratados.
  </para>

  <sect2 xml:id="sec-print-gdi">
   <title>Impressoras sem suporte de linguagem de impressora padrão</title>
   <para>
    Essas impressoras não suportam nenhuma linguagem de impressora comum, podendo apenas ser tratadas com sequências especiais de controle proprietário. Portanto, elas só funcionam com as versões de sistema operacional para as quais o fabricante fornece driver. GDI é uma interface de programação desenvolvida pela Microsoft* para dispositivos gráficos. Geralmente o fabricante fornece drivers apenas para Windows e, com o driver do Windows usa a interface GDI, essas impressoras também são chamadas de <emphasis>impressoras GDI</emphasis>. O verdadeiro problema não é a interface de programação, mas o fato de que essas impressoras apenas podem ser reconhecidas com a linguagem de impressora proprietária do respectivo modelo da impressora.
   </para>
   <para>
    Algumas impressoras GDI podem ser ajustadas para funcionar no modo GDI ou em uma das linguagens de impressora padrão. Consulte o manual da impressora para saber se isso é possível. Alguns modelos exigem software especial do Windows para fazer o ajuste (observe que o driver de impressora do Windows pode sempre retornar a impressora para o modo GDI quando se imprime do Windows). Para outras impressoras GDI, existem módulos de extensão disponíveis para uma linguagem de impressora padrão.
   </para>
   <para>
    Alguns fabricantes oferecem drivers proprietários para suas impressoras A desvantagem dos drivers de impressora proprietários é que não há garantia de que vão funcionar com o sistema de impressão instalado ou de que sejam adequados para as diferentes plataformas de hardware. Em contraste, impressoras que suportam uma linguagem de impressora padrão não dependem de uma versão do sistema de impressão especial ou de plataforma de hardware especial.
   </para>
   <para>
    Em vez de perder tempo tentando fazer funcionar um driver de Linux proprietário, a compra de uma impressora que suporte a linguagem padrão de impressora (preferencialmente PostScript) pode ter melhor custo-benefício. Isso soluciona o problema do driver de uma vez por todas, eliminando a necessidade de instalar e configurar software de driver especial e obter atualizações de driver que talvez fossem necessárias por causa de novos avanços no sistema de impressão.
   </para>
  </sect2>

  <sect2 xml:id="sec-print-prob-ppd">
   <title>Nenhum arquivo PPD adequado disponível para impressora PostScript</title>
   <para>
    Se o pacote <systemitem>manufacturer-PPDs</systemitem> ou <systemitem>OpenPrintingPPDs-postscript</systemitem> não incluir o arquivo PPD adequado para uma impressora PostScript, será possível utilizar o arquivo PPD do CD do driver do fabricante da impressora ou fazer download de um arquivo PPD adequado da página do fabricante da impressora na Web.
   </para>
   <para>
    Se o arquivo PPD for fornecido como arquivo compactado (.zip) ou arquivo compactado de autoextração (<filename>.exe</filename>), faça a descompactação com <command>unzip</command>. Primeiro, reveja os termos de licença do arquivo PPD. Em seguida, use o utilitário <command>cupstestppd</command> para verificar se o arquivo PPD atende à <quote>Especificação de Formato de Arquivo PPD (PostScript Printer Description — Descrição de Impressora PostScript) da Adobe, versão 4.3</quote>. Se o utilitário retornar <quote>FAIL</quote>, significa que os erros nos arquivos PPD são graves e provavelmente causam os principais problemas. Os problemas reportados pelo <command>cupstestppd</command> devem ser eliminados. Se necessário, peça o arquivo PPD adequado ao fabricante da impressora.
   </para>
  </sect2>

  <sect2 xml:id="sec-print-prob-netconnect">
   <title>Conexões da impressora de rede</title>
   <para/>
   <variablelist>
    <varlistentry>
     <term>Identificação de problemas de rede</term>
     <listitem>
      <para>
       Conecte a impressora diretamente ao computador. Para fins de teste, configure-a como impressora local. Se isso funcionar, o problema está na rede.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>Verificando a rede TCP/IP</term>
     <listitem>
      <para>
       A rede TCP/IP e a resolução de nomes devem ser funcionais.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>Verificando um <command>lpd</command> remoto
     </term>
     <listitem>
      <para>
       Use o comando a seguir para testar o estabelecimento de uma conexão TCP com <command>lpd</command> (porta <literal>515</literal>) no <replaceable>HOST</replaceable>:
      </para>
<screen><prompt>tux &gt; </prompt>netcat -z <replaceable>HOST</replaceable> 515 &amp;&amp; echo ok || echo failed</screen>
      <para>
       Se a conexão com <command>lpd</command> não for estabelecida, o <command>lpd</command> pode não estar ativo ou pode haver problemas básicos de rede.
      </para>
      <para>
       Desde que o respectivo <command>lpd</command> esteja ativo e o host aceite consultas, execute o seguinte comando como <systemitem class="username">root</systemitem> para consultar um relatório de status para <replaceable>FILA</replaceable> no <replaceable>HOST</replaceable> remoto:
      </para>
<screen><prompt role="root">root # </prompt>echo -e "\004queue" \
| netcat -w 2 -p 722 <replaceable>HOST</replaceable> 515</screen>
      <para>
       Se o <command>lpd</command> não responder, ele pode não estar ativo ou pode haver problemas básicos de rede. Se o <command>lpd</command> responder, a resposta deverá mostrar por que não é possível imprimir na <literal>fila</literal> do <literal>host</literal>. Se você receber uma resposta como esta, mostrada no <xref linkend="aus-d-lpd"/>, significa que o problema está sendo causado pelo <command>lpd</command> remoto.
      </para>
      <example xml:id="aus-d-lpd">
       <title>Mensagem de erro do <command>lpd</command></title>
<screen>lpd: your host does not have line printer access
lpd: queue does not exist
printer: spooling disabled
printer: printing disabled</screen>
      </example>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>Verificando um <command>cupsd</command> remoto
     </term>
     <listitem>
      <para>
       Um servidor de rede CUPS pode transmitir suas filas por padrão a cada 30 segundos na porta UDP <literal>631</literal>. Conforme apresentado, os seguintes comandos podem ser usados para testar se existe um servidor de rede CUPS de broadcasting na rede. Não deixe de parar seu daemon CUPS local antes de executar o comando.
      </para>
<screen><prompt>tux &gt; </prompt>netcat -u -l -p 631 &amp; PID=$! ; sleep 40 ; kill $PID</screen>
      <para>
       Se existir um servidor de rede CUPS de transmissão, a saída aparecerá conforme mostrado no <xref linkend="aus-d-bcast"/>.
      </para>
      <example xml:id="aus-d-bcast">
       <title>Transmissão do servidor de rede CUPS</title>
<screen>ipp://192.168.2.202:631/printers/queue</screen>
      </example>
      
      <para>
       Use o comando a seguir para testar o estabelecimento de uma conexão TCP com <command>cupsd</command> (porta <literal>631</literal>) no <replaceable>HOST</replaceable>:
      </para>
<screen><prompt>tux &gt; </prompt>netcat -z <replaceable>HOST</replaceable> 631 &amp;&amp; echo ok || echo failed</screen>
      <para>
       Se a conexão com <command>cupsd</command> não for estabelecida, o <command>cupsd</command> poderá não estar ativo ou talvez haja problemas básicos de rede. <command>lpstat -h</command> <replaceable>HOST</replaceable> -l -t retorna um relatório de status (possivelmente muito extenso) para todas as filas no <replaceable>HOST</replaceable>, desde que o respectivo <command>cupsd</command> esteja ativo e o host aceite consultas.
      </para>
      <para>
       O próximo comando pode ser usado para testar se a <replaceable>FILA</replaceable> no <replaceable>HOST</replaceable> aceita um serviço de impressão que consiste em um único caractere de retorno de carro. Nada será impresso. Possivelmente, será ejetada uma página em branco.
      </para>
<screen><prompt>tux &gt; </prompt>echo -en "\r" \
| lp -d queue -h <replaceable>HOST</replaceable></screen>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>
      Solução de problemas na impressora de rede ou na máquina do servidor de impressão
     </term>
     <listitem>
      <para>
       Algumas vezes, spoolers executados na máquina do servidor de impressão causam problemas quando precisam processar vários serviços de impressão. Como esse problema é causado pelo spooler na máquina do servidor de impressão, ele não tem solução. Como medida alternativa, desvie o spooler na máquina do servidor de impressão endereçando a impressora conectada à máquina diretamente com o soquete TCP. Consulte a <xref linkend="sec-print-net"/>.
      </para>
      <para>
       Dessa forma, a máquina do servidor de impressão é reduzida a um conversor entre as várias formas de transferência de dados (conexão de rede TCP/IP e impressora local). Para usar esse método, você precisa saber a porta TCP da máquina do servidor de impressão. Se a impressora estiver conectada à máquina do servidor de impressão e ligada, essa porta TCP poderá ser determinada normalmente com o utilitário <command>nmap</command> do pacote <systemitem>nmap</systemitem>, algum tempo depois que a máquina for ligada. Por exemplo, <command>nmap </command> <replaceable>endereço-IP</replaceable> pode resultar na seguinte saída para a máquina do servidor de impressão:
      </para>
<screen>Port       State       Service
23/tcp     open        telnet
80/tcp     open        http
515/tcp    open        printer
631/tcp    open        cups
9100/tcp   open        jetdirect</screen>
      <para>
       Essa saída indica que a impressora conectada à máquina do servidor de impressão pode ser endereçada via soquete TCP na porta <literal>9100</literal>. Por padrão, <command>nmap</command> verifica somente algumas portas mais conhecidas listadas em <filename>/usr/share/nmap/nmap-services</filename>. Para verificar todas as portas possíveis, use o comando <command>nmap-p </command>
       <replaceable>PORTA_DE_ORIGEM</replaceable>-<replaceable>PORTA_DE_DESTINO</replaceable> <replaceable>ENDEREÇO_IP</replaceable>. O processo pode levar algum tempo. Para obter mais informações, consulte a página de manual de <command>nmap</command>.
      </para>
      <para>
       Digite um comando como
      </para>
<screen><prompt>tux &gt; </prompt>echo -en "\rHello\r\f" | netcat -w 1 IP-address port
cat file | netcat -w 1 IP-address port</screen>
      <para>
       para enviar strings de caracteres ou arquivos diretamente à respectiva porta para testar se a impressora pode ser endereçada dessa porta.
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
  </sect2>

  <sect2 xml:id="sec-print-prob-defective-printouts">
   <title>Defeitos na impressão sem mensagem de erro</title>
   <para>
    Para o sistema de impressão, o serviço de impressão é concluído quando o back end do CUPS conclui a transferência de dados ao destinatário (impressora). Se houver falha no processamento posterior no destinatário (por exemplo, se a impressora não imprimir seus próprios dados específicos), o sistema de impressão não notará. Se a impressora não puder imprimir seus dados específicos, selecione um arquivo PPD mais adequado à impressora.
   </para>
  </sect2>

  <sect2 xml:id="sec-print-prob-disabled-queues">
   <title>Filas desabilitadas</title>
   <para>
    Se a transferência de dados para o destinatário falhar completamente após várias tentativas, o back end do CUPS, como <literal>USB</literal> ou <literal>socket</literal>, reportará um erro ao sistema de impressão (ao <command>cupsd</command>). O back end determina quantas tentativas malsucedidas são necessárias para que a transferência de dados seja considerada impossível. Visto que as tentativas posteriores serão inúteis, o <command>cupsd</command> desabilita a impressão da fila correspondente. Após resolver a causa do problema, o administrador do sistema deve reabilitar a impressão com o comando <command>cupsenable</command>.
   </para>
  </sect2>

  <sect2 xml:id="sec-print-prob-deleting-jobs">
   <title>Navegação do CUPS: apagando serviços de impressão</title>
   <para>
    Se um servidor de rede CUPS transmitir suas filas aos hosts de clientes via navegação e um <command>cupsd</command> local adequado estiver ativo nos hosts de clientes, o <command>cupsd</command> de cliente aceitará serviços de impressão de aplicativos e os encaminhará ao <command>cupsd</command> no servidor. Quando <command>cupsd</command> no servidor aceitar um serviço de impressão, ele receberá um novo número de serviço. Portanto, o número da tarefa no host cliente é diferente do número da tarefa no servidor. Como geralmente um serviço de impressão é encaminhado de imediato, não é possível apagá-lo com o número de serviço do host cliente, porque o <command>cupsd</command> do cliente considera o serviço de impressão concluído quando ele é encaminhado ao <command>cupsd</command> do servidor.
   </para>
   <para>
    Para apagar o serviço de impressão do servidor, use um comando como <command>lpstat -h cups.example.com -o</command> para determinar o número do serviço no servidor. Esse procedimento assume que o servidor ainda não tenha concluído o serviço de impressão (isto é, enviado-o completamente para a impressora). Use o número de serviço obtido para apagar o serviço de impressão do servidor da seguinte maneira:
   </para>
<screen><prompt>tux &gt; </prompt>cancel -h cups.example.com <replaceable>QUEUE-JOBNUMBER</replaceable></screen>
  </sect2>

  <sect2 xml:id="sec-print-prob-brokenjobs">
   <title>Serviços de impressão com defeito e erros de transferência de dados</title>
   <para>
    Se você desligar a impressora ou encerrar o computador durante o processo de impressão, o serviço de impressão permanecerá na fila. A impressão continua quando o computador (ou a impressora) é ligado novamente. Os serviços de impressão com defeito devem ser removidos da fila com <command>cancel</command>.
   </para>
   <para>
    Se um serviço de impressão estiver corrompido ou se ocorrer um erro na comunicação entre o host e a impressora, a impressora não poderá processar os dados corretamente e imprimirá várias folhas de papel com caracteres ininteligíveis. Para corrigir o problema, siga estas etapas:
   </para>
   <procedure>
    <step>
     <para>
      Para interromper a impressão, remova todo o papel das bandejas da impressora jato de tinta ou laser. Impressoras de alta qualidade têm um botão de cancelamento da impressão.
     </para>
    </step>
    <step>
     <para>
      O serviço de impressão pode ainda estar na fila, já que os serviços apenas são removidos depois de inteiramente enviados à impressora. Use <command>lpstat -o</command> ou <command>lpstat -h cups.example.com -o</command> para verificar a fila que está sendo impressa. Apague o serviço de impressão com <command>cancel</command>
      <replaceable>FILA</replaceable>-<replaceable>NÚMERODOSERVIÇO</replaceable> ou <command>cancel -h cups.example.com</command>
      <replaceable>FILA</replaceable>-<replaceable>NÚMERODOSERVIÇO</replaceable>.
     </para>
    </step>
    <step>
     <para>
      Alguns dados podem ainda ser transferidos à impressora mesmo que o serviço tenha sido apagado da fila. Verifique se há um processo back end do CUPS em execução para a fila respectiva e termine-o.
     </para>
    </step>
    <step>
     <para>
      Reinicialize a impressora completamente deixando-a desligada por um tempo. Em seguida, insira o papel e ligue a impressora.
     </para>
    </step>
   </procedure>
  </sect2>

  <sect2 xml:id="sec-print-prob-debugging">
   <title>Depurando o CUPS</title>
   <para>
    Use o seguinte procedimento genérico para localizar problemas no CUPS:
   </para>
   <procedure>
    <step>
     <para>
      Defina <command>LogLevel debug</command> em <filename>/etc/cups/cupsd.conf</filename>.
     </para>
    </step>
    <step>
     <para>
      Pare o <command>cupsd</command>.
     </para>
    </step>
    <step>
     <para>
      Remova <filename>/var/log/cups/error_log*</filename> para não precisar procurar em arquivos de registro muito grandes.
     </para>
    </step>
    <step>
     <para>
      Inicie o <command>cupsd</command>.
     </para>
    </step>
    <step>
     <para>
      Repita a ação que causou o problema.
     </para>
    </step>
    <step>
     <para>
      Verifique as mensagens em <filename>/var/log/cups/error_log*</filename> para identificar a causa do problema.
     </para>
    </step>
   </procedure>
  </sect2>

  <sect2 xml:id="sec-print-prob-more-information">
   <title>Mais informações</title>
   <para>
    Há informações detalhadas sobre impressão no <phrase role="productname"><phrase os="sled">SUSE Linux Enterprise Desktop</phrase></phrase> no Banco de Dados de Suporte do openSUSE em <link xlink:href="https://en.opensuse.org/Portal:Printing"/>. <phrase os="sles;sled">Há soluções para vários problemas específicos no SUSE Knowledgebase (<link xlink:href="https://www.suse.com/support/"/>). Localize os artigos relevantes com uma pesquisa pelo texto <literal>CUPS</literal>.</phrase>
   </para>
  </sect2>
 </sect1>
</chapter>
