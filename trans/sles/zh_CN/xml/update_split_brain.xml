<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sect1 PUBLIC "-//Novell//DTD NovDoc XML V1.0//EN" "novdocx.dtd">
<!--
*********************************
Please see LICENSE.txt for this document's license.
*********************************
-->
<sect1 xml:base="update_split_brain.xml" id="sec.update.split-brain">
 <title>原子更新</title>

 <para>
  原子更新所基于的工具能够管理系统的两个副本，并在更新失败后可以轻松地恢复系统。提供的工具需要特殊的磁盘分区设置。每个系统副本都驻留在自己的主分区上。如果更新失败，总是可以转换回以前的系统状态，该系统状态在其他分区上。
 </para>



 <sect2 id="cha.update.split-brain.setup">
  <title>设置</title>
  <warning>
   <title>严格的分区要求</title>
   <para>
    磁盘分区的实施有严格的要求，第一个 root 分区是 <filename>/dev/sda1</filename>，占用空间不得超过整个磁盘大小的一半。然后工具会为系统的第二个 root 分区创建 <filename>/dev/sda2</filename>。其他分区（如果有）共同分享两个根分区的大小，也就是说，要将这些分区的大小计算在内，并相应地减小第一个分区的大小。大致计算方法如下：
   </para>
   <para>
    整个磁盘大小减去 <systemitem>sda1</systemitem> 和 <systemitem>sda2</systemitem> 等于其他分区的可用空间。
   </para>
  </warning>
  <procedure>
   <step performance="required">
    <para>
     用 <filename>/dev/sda1</filename> 作为单个 root 分区安装系统，其空间小于整个磁盘大小的一半。
    </para>
   </step>
   <step performance="required">
    <para>
     根据需要自定义已安装系统。确保 <systemitem>multi-update-tools</systemitem> 包已安装。
    </para>
   </step>
   <step performance="required">
    <para>
     运行 <command>multi-update-setup --partition</command>，创建大小类似的第二个 root 分区 (<filename>/dev/sda2</filename>)。
    </para>
   </step>
   <step performance="required">
    <para>
     根据需要对剩余磁盘空间分区，并继续自定义 (*)。
    </para>
   </step>
   <step performance="required">
    <para>
     运行 <command>multi-update-setup --clone</command> 将系统复制到其他分区。用此命令还可以更改目标系统 <filename>/etc/fstab</filename> 中的 <filename>/</filename>(root) 条目。
    </para>
   </step>
   <step performance="required">
    <para>
     如果需要，请执行进一步自定义 (*)。
    </para>
   </step>
   <step performance="required">
    <para>
     运行 <command>multi-update-setup --bootloader</command> 初始化引导加载程序设置。这样引导加载程序菜单就会包含一个条目，用于引导另一个系统。
    </para>
    <warning>
     <title>GRUB 2 引导加载程序强制要求</title>
     <para>
      必须安装 GRUB 2 引导加载程序。这些工具与其他引导加载程序不兼容。
     </para>
    </warning>
   </step>
   <step performance="required">
    <para>
     如果没有对标有 (*) 的项进行自定义，请运行 <command>multi-update-setup --complete</command> 执行所有三个步骤。
    </para>
   </step>
  </procedure>
 </sect2>



 <sect2 id="cha.update.split-brain.updating">
  <title>更新另一个系统</title>
  <para>
   运行 <command>multi-update</command>。此命令会在 <command>chroot</command> 环境中运行 <systemitem>zypper</systemitem>，并更新另一个系统 — 哪个系统处于活动状态无关紧要。其引导菜单在引导时作为默认值提供。
  </para>
 </sect2>



 <sect2 id="cha.update.split-brain.touble">
  <title>查错</title>
  <para>
   如果更新的系统在更新之后引导加载程序受损，则必须更改<quote>活动</quote>标志，将它分配给另一个系统的根分区，以便可以引导该系统。
  </para>
  <para>
   如果更新的系统根本无法引导，则需要访问引导加载程序菜单以选择另一个系统。
  </para>
  <para>
   有关 GRUB 2 的详细信息，请参见<xref linkend="cha.grub2"/>。
  </para>
 </sect2>

 <sect2 id="cha.update.split-brain.limitation">
  <title>限制</title>
  <para>
   根分区必须按分区名、ID 或其他方式进行装载。不支持按分区 UUID 或标签进行装载。
  </para>
 </sect2>



 <sect2 id="cha.update.split-brain.info">
  <title>更多信息</title>
  <para>
   有关更多信息，请参见随 <systemitem>multi-update-tools</systemitem> 包一起提供的 <filename>/usr/sha e/doc/packages/multi-update-tools/README</filename>。
  </para>
 </sect2>
</sect1>
