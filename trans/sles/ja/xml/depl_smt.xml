<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE chapter PUBLIC "-//Novell//DTD NovDoc XML V1.0//EN" "novdocx.dtd">
<!--
*********************************
Please see LICENSE.txt for this document's license.
*********************************
-->
<chapter xml:base="depl_smt.xml" id="cha.smt">
 <title>登録管理</title>

 <para>
  SUSE Linux Enterprise Server <phrase role="productname"><phrase os="sles;sled;slerte">12</phrase></phrase>またはSUSE Linux Enterprise Desktop <phrase role="productname"><phrase os="sles;sled;slerte">12</phrase></phrase>を実行するマシンは、SUSEカスタマーセンターやNUサーバと直接通信するのではなく、ローカルのSubscription Management Toolサーバに登録することにより、そこからソフトウェアアップデートをダウンロードするように設定できます。SMTサーバをクライアントの登録用とローカルのアップデートソースとして使用するには、先にネットワーク内にSMTサーバを設定する必要があります。SMTサーバソフトウェアは、SUSE Linux Enterprise Serverのアドオンとして配布されます。その設定については、『<emphasis>Subscription Management Tool Guide</emphasis>』に説明があります。SMTサーバに登録するように設定するクライアントには、アドオンをインストールする必要はありません。
 </para>
 <para>
  SMTサーバにクライアントを登録するには、クライアントにサーバのURLを指定する必要があります。登録時には、クライアントとサーバはHTTPSプロトコルを介して通信するため、クライアントがサーバの証明書を信用していることを確認する必要があります。SMTサーバがデフォルトのサーバ証明書を使用するよう設定されている場合、<literal>http://<replaceable>FQDN</replaceable>/smt.crt</literal>でHTTPプロトコルを使用することで、SMTサーバでCA証明書を使用できます。この場合は、証明書を操作する必要はありません。異なる設定を行わない限り、登録プロセスにより、そこから自動的にCA 証明書がダウンロードされます。CA証明書が外部認証局から発行されている場合は、サーバのCA証明書へのパスを入力する必要があります。
 </para>

 <para>
  この情報を指定してクライアントマシンがSMTを使用するように設定する方法は、複数あります。1つ目は、必要な情報をブート時にカーネルパラメータを介して指定する方法です。2つ目は、AutoYaSTプロファイルを使用してクライアントを設定する方法です。Subscription Management Toolで配布されるスクリプト<command>clientSetup4SMT.sh</command>をクライアント上で実行して、特定のSMTサーバへの登録を行えるようにする方法もあります。これらの方法については次のセクションに説明があります。
 </para>
 <sect1 id="smt.client.parameters">
  <title>カーネルパラメータを使用したSMTサーバへのアクセス</title>

  <para>
   コンピュータのブート時にカーネルパラメータ<literal>regurl</literal>および<literal>regcert</literal>を使用して、SMTを使用するようにクライアントを設定できます。1つ目のパラメータは必須で、2つ目のパラメータは任意です。
  </para>

  <variablelist>
   <varlistentry>
    <term>regurl</term>
    <listitem>
     <para>
      SMTサーバのURLURLは、<literal>https://<replaceable>FQDN</replaceable></literal>というフォーマットで、<replaceable>FQDN</replaceable>はSMTサーバの完全修飾ホスト名にする必要があります。これはSMTサーバで使用されるサーバ証明書のFQDNと同じである必要があります。例:
     </para>
<screen>regurl=https://smt.example.com</screen>
    </listitem>
   </varlistentry>
  </variablelist>

  <warning>
   <title>入力ミスに注意してください</title>
   <para>
    入力した値が正しいことを確認してください。<literal>regurl</literal>が正しく指定されていないと、アップデートソースの登録が失敗します。
   </para>
  </warning>

  <warning>
   <title>SMTサーバ証明書の変更</title>
   <para>
    SMTサーバが、信頼されていない新しいCAから新しい証明書を取得する場合、クライアントは新しいCA証明書ファイルをフェッチする必要があります。これは登録プロセスで自動的に実行されます。ただし、そのためには、インストール時のURLの使用で証明書が取得されたか、または<literal>regcert</literal>パラメータの省略によってデフォルトURLが使用されている必要があります。他の方法(ローカルパスなど)でロードしたCA証明書は、更新されません。
   </para>
  </warning>
 </sect1>
 <sect1 id="smt.client.autoyast">
  <title>AutoYaSTプロファイルを使用したクライアントの設定</title>

  <para>
   クライアントは、AutoYaSTプロファイルによってSMTサーバに登録するように設定できます。AutoYaSTプロファイルの作成と、自動インストールのための準備に関する一般的な情報については、<xref linkend="cha.deployment.autoinst"/>を参照してください。このセクションでは、SMT固有の設定についてのみ説明します。
  </para>

  <para>
   AutoYaSTを使用してSMT固有のデータを設定するには、次の手順に従います。
  </para>

  <procedure>
   <step performance="required">
    <para>
     <systemitem class="username">root</systemitem>としてYaSTを起動し、<menuchoice><guimenu>その他</guimenu><guimenu>自動インストール</guimenu></menuchoice>の順に選択して、AutoYaST GUIを起動します。
    </para>
    <para>
     コマンドラインからは<command>yast2 autoyast</command>コマンドを使用してAutoYaST GUIを起動できます。

    </para>
   </step>
   <step performance="required">
    <para>
     <menuchoice><guimenu>ファイル</guimenu><guimenu>開く</guimenu></menuchoice>を使用して既存のプロファイルを開き、<menuchoice><guimenu>ツール</guimenu><guimenu>参照プロファイルの作成</guimenu></menuchoice>を使用して現在のシステムの設定に基づきプロファイルを作成するか、または空のプロファイルから作成します。
    </para>
   </step>
   <step performance="required">
    <para>
     <menuchoice><guimenu>サポート</guimenu><guimenu>SUSEカスタマーセンターの環境設定</guimenu></menuchoice>の順に選択します。現在の設定の概要が表示されます。
    </para>
   </step>
   <step performance="required">
    <para>
     <guimenu>編集</guimenu>をクリックします。
    </para>
   </step>
   <step performance="required">

    <para>
     インストール中に自動で登録を行うには、<guimenu>製品登録の実行</guimenu>を選択します。 
    </para>
   </step>
   <step performance="required">
    <para>
     <guimenu>SMT Server (SMTサーバ)</guimenu>でURLを設定し、オプションで<guimenu>SMT Certificate (SMT証明書)</guimenu>で証明書の場所を設定します。設定可能な値はカーネルパラメータ<literal>regurl</literal>と同じです。設定可能な値はカーネルパラメータ<literal>regurl</literal>および<literal>regcert</literal>と同じです (<xref linkend="smt.client.parameters"/>を参照)。ただし、<literal>regcert</literal>の<literal>ask</literal>値はユーザの操作を必要とするため、AutoYaSTでは有効ではない点が異なります。これを使用する場合、登録プロセスはスキップされます。
    </para>
    <para>登録プロセスを完了すると、SUSEカスタマーセンターの登録サーバから提供されているアドオン(拡張機能またはモジュール)をYaSTで使用できるようになります。SUSEカスタマーセンターを使用して、新製品(SUSE Software Development Kit、High Availability、GEO Clustering for SUSE Linux Enterprise High Availability Extensionなど)や、SUSEカスタマーセンターから直接利用可能な他の製品を登録およびインストールできます。さらに、SUSEカスタマーセンターを使用して最新のパッチレベルをインストールすることもできます。
    </para>
   </step>
   <step performance="required">
    <para>
     システムを展開するために必要な他の設定を実行します。
    </para>
   </step>
   <step performance="required">
    <para>
     <menuchoice><guimenu>ファイル</guimenu><guimenu>名前を付けて保存</guimenu></menuchoice>の順に選択して、<filename>autoinst.xml</filename>のようにファイル名をプロファイルに入力します。
    </para>
   </step>
  </procedure>
 </sect1>
 <sect1 id="smt.client.clientsetupscript">
  <title>clientSetup4SMT.shスクリプトを使用したクライアントの設定</title>

  <para>
   <command>/usr/share/doc/packages/smt/clientSetup4SMT.sh</command>スクリプトはSMTで提供されます。このスクリプトを使用すると、クライアントマシンがSMTサーバを使用するよう設定したり、または別のSMTサーバを使用するよう再設定したりすることができます。
  </para>

  <para>
   <command>clientSetup4SMT.sh</command>スクリプトを使用してクライアントマシンがSMTを使用するよう設定するには、次の手順に従います。
  </para>

  <procedure>
   <step performance="required">
    <para>
     <filename>/usr/share/doc/packages/smt/clientSetup4SMT.sh</filename>スクリプトをSMTサーバからクライアントマシンにコピーします。
    </para>
   </step>
   <step performance="required">
    <para>
     <systemitem class="username">root</systemitem>として、スクリプトをクライアントマシンで実行します。スクリプトは次の2つの方法で実行できます。
    </para>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <para>
       スクリプト名に続けて次の登録URLを入力します。
      </para>
<screen>./clientSetup4SMT.sh <replaceable>registration_URL</replaceable></screen>
      <para>
       たとえば、次のように入力します。
      </para>
<screen>./clientSetup4SMT.sh  https://smt.example.com/center/regsvc</screen>
     </listitem>
     <listitem>
      <para>
       スクリプト名に続けて<option>--host</option>オプション、次にSMTサーバのホスト名を入力します。
      </para>
<screen>./clientSetup4SMT.sh  --host <replaceable>server_hostname</replaceable></screen>
      <para>
       たとえば、次のように入力します。
      </para>
<screen>./clientSetup4SMT.sh --host  smt.example.com</screen>
     </listitem>
    </itemizedlist>
    <para>
     スクリプトはサーバのCA証明書をダウンロードします。
    </para>
    <important>
     <title><option>--host</option>パラメータ</title>
     <para>
      <option>--host</option>パラメータで指定するホスト名は、証明書の発行先と同じ名前にする必要があります。また、証明書の名前が完全修飾ホスト名(たとえば、add smt.example.com)の場合は、それに従って入力する必要があります。「短縮」<quote/>名(smt)を入力すると<command>clientSetup4SMT.sh</command>スクリプトが失敗する原因になります。
     </para>
    </important>
   </step>
   <step performance="required">
    <para>
     <keycap>y</keycap>を押して、サーバのCA証明書を受諾します。
    </para>
   </step>
   <step performance="required">
    <para>
     スクリプトはクライアント上で必要な変更をすべて実行します。必要な場合、登録自体をスクリプトによって実行できます。
    </para>
   </step>
   <step performance="required">
    <para>
     
     クライアント上で<command>suse_register</command>を実行して、登録を行います。
    </para>
   </step>
  </procedure>




 </sect1>
 <sect1 id="sec.smt.register">
  <title>SMTテスト環境へのクライアントの登録</title>

  

  <para>
   クライアントを運用環境ではなくテスト環境で登録するよう設定するには、次のようにクライアントコンピュータ上で<command>SUSEConnect</command>を変更します。
  </para>

<screen>SUSEConnect -r <replaceable>REG_CODE</replaceable></screen>

  <para>
   <replaceable>REG_CODE</replaceable>を製品の登録コードに置き換えます。登録コードについては、次のサイトを参照してください。<ulink url="http://scc.suse.com"/> 
  </para>



  <para>
   テスト環境でのSMTの使用の詳細については、『<emphasis>Subscription Management Tool Guide</emphasis>』を参照してください。
  </para>
 </sect1>
</chapter>
