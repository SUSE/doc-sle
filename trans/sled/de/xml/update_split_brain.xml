<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sect1 PUBLIC "-//Novell//DTD NovDoc XML V1.0//EN" "novdocx.dtd">
<!--
*********************************
Please see LICENSE.txt for this document's license.
*********************************
-->
<sect1 xml:base="update_split_brain.xml" id="sec.update.split-brain">
 <title>Atomic-Aktualisierung</title>

 <para>
  Die Atomic-Aktualisierung basiert auf Tools, die zwei Kopien des Systems verwalten und nach einem Aktualisierungsfehler eine einfache Wiederherstellung des Systems ermöglichen. Für die bereitgestellten Tools ist ein spezielles Festplattenpartitions-Setup erforderlich. Jede Kopie des Systems befindet sich auf einer eigenen primären Partition. Falls eine Aktualisierung fehlschlägt, können Sie jederzeit zum vorherigen Zustand des Systems auf der anderen Partition zurückwechseln.
 </para>



 <sect2 id="cha.update.split-brain.setup">
  <title>Einrichtung</title>
  <warning>
   <title>Strenge Partitionierungsanforderungen</title>
   <para>
    Die Implementierung stellt strenge Anforderungen an die Festplattenpartitionierung: Die erste Root-Partition lautet <filename>/dev/sda1</filename>; sie darf nicht mehr als die Hälfte der gesamten Festplatte belegen. Als zweite Root-Partition des Systems erstellt das Tool danach die Partition <filename>/dev/sda2</filename>. Weitere Partitionen, sofern erforderlich, werden von beiden Root-Partitionen gemeinsam verwendet. Deren Größe muss berücksichtigt werden, d. h., die Größe der ersten Root-Partition muss entsprechend reduziert werden. Hier eine Berechnungsformel zur Grobabschätzung:
   </para>
   <para>
    Die Größe der Festplatte minus der Größe von <systemitem>sda1</systemitem> minus der Größe von <systemitem>sda2</systemitem> ist der freie Speicher für zusätzliche Partitionen.
   </para>
  </warning>
  <procedure>
   <step performance="required">
    <para>
     Installieren Sie das System mit <filename>/dev/sda1</filename> als einzige Root-Partition, wobei diese Partition weniger als die Hälfte der Gesamtfestplattengröße einnehmen darf.
    </para>
   </step>
   <step performance="required">
    <para>
     Passen Sie das installierte System nach Bedarf an. Vergewissern Sie sich, dass das Paket <systemitem>multi-update-tools</systemitem> installiert ist.
    </para>
   </step>
   <step performance="required">
    <para>
     Führen Sie <command>multi-update-setup --partition</command> aus. Dadurch wird die zweite Root-Partition des Systems (<filename>/dev/sda2</filename>) mit gleicher Größe erstellt.
    </para>
   </step>
   <step performance="required">
    <para>
     Partitionieren Sie den Rest der Festplatte nach Bedarf und fahren Sie mit den erforderlichen Anpassungen fort(*).
    </para>
   </step>
   <step performance="required">
    <para>
     Führen Sie <command>multi-update-setup --clone</command> aus, um das System auf die andere Partition zu kopieren. Mit diesem Kommando ändern Sie auch den Root-Eintrag (<filename>/</filename>) auf dem Zielsystem in <filename>/etc/fstab</filename>.
    </para>
   </step>
   <step performance="required">
    <para>
     Nehmen Sie bei Bedarf weitere Anpassungen vor (*).
    </para>
   </step>
   <step performance="required">
    <para>
     Führen Sie <command>multi-update-setup --bootloader</command> aus, um das Bootloader-Setup zu starten. Durch dieses Kommando wird dem Bootloader-Menü ein Eintrag zum Booten des anderen Systems hinzugefügt.
    </para>
    <warning>
     <title>GRUB 2-Bootloader obligatorisch</title>
     <para>
      Die Installation des GRUB 2-Bootloaders ist obligatorisch. Die Tools sind nicht mit anderen Bootloadern kompatibel.
     </para>
    </warning>
   </step>
   <step performance="required">
    <para>
     Wenn an den mit (*) gekennzeichneten Stellen keine Anpassungen vorgenommen werden müssen, führen Sie <command>multi-update-setup --complete</command> aus. Hierdurch werden alle drei Schritte durchgeführt.
    </para>
   </step>
  </procedure>
 </sect2>



 <sect2 id="cha.update.split-brain.updating">
  <title>Aktualisierung des anderen Systems</title>
  <para>
   Führen Sie <command>multi-update</command> aus. Dieses Kommando führt <command>zypper</command> in einer <systemitem>chroot</systemitem>-Umgebung aus und aktualisiert das jeweils andere System, unabhängig davon, welches System aktiv ist. Sein Bootmenü wird beim Booten als Standard angeboten.
  </para>
 </sect2>



 <sect2 id="cha.update.split-brain.touble">
  <title>Fehlersuche</title>
  <para>
   Falls der Bootloader des aktualisierten Systems bei der Aktualisierung beschädigt wurde, müssen Sie das <quote>Active</quote>-Flag für die Root-Partition des anderen Systems setzen, um dieses System zu booten.
  </para>
  <para>
   Lässt sich das aktualisierte System gar nicht booten, benötigen Sie Zugriff auf das Bootloader-Menü, um das andere System auswählen zu können.
  </para>
  <para>
   Weitere Informationen zu GRUB 2 finden Sie unter <xref linkend="cha.grub2"/>.
  </para>
 </sect2>

 <sect2 id="cha.update.split-brain.limitation">
  <title>Einschränkung</title>
  <para>
   Die Root-Partition muss anhand des Partitionsnamens, der ID oder auf andere Weise eingehängt werden. Das Einhängen anhand der Partitions-UUID oder der Kennung wird nicht unterstützt.
  </para>
 </sect2>



 <sect2 id="cha.update.split-brain.info">
  <title>Weiterführende Informationen</title>
  <para>
   Weitere Informationen finden Sie in der Readme-Datei <filename>/usr/share/doc/packages/multi-update-tools/README</filename> des <systemitem>multi-update-tools</systemitem>-Pakets.
  </para>
 </sect2>
</sect1>
