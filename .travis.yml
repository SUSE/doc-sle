language: bash
env:
      global:
      - LD_PRELOAD=/lib/x86_64-linux-gnu/libSegFault.so

dist: yakkety

cache:
  directories:
    - $HOME/.cache/entities

addons:
  apt:
    packages:
    - libxml2-utils
    - libxml2-dev
    - libxml2

before_script:
    - cat /etc/os-release
    # - ls xml/*.xml
    - echo $TRAVIS_COMMIT
    - xmllint --version

script:
    - test -e $HOME/.cache/entities || mkdir -p $HOME/.cache/entities
    - wget -P $HOME/.cache/entities http://docbook.org/xml/4.5/docbook-xml-4.5.zip
    - unzip -d $HOME/.cache/entities/ $HOME/.cache/entities/docbook-xml-4.5.zip
    - cp -vi $HOME/.cache/entities/*.mod xml/
    - cp -avi $HOME/.cache/entities/ent xml/
    # - wget -P xml/ http://www.oasis-open.org/docbook/xml/4.5/dbcentx.mod
    - sed -i 's#dbcent PUBLIC .*>#dbcent SYSTEM "dbcentx.mod">#' xml/entity-decl.ent
    - for file in xml/*.xml; do echo ">>> $file"; xmllint --nonet --noout --noent $file; done
