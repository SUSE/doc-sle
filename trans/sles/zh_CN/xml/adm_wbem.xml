<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE chapter PUBLIC "-//Novell//DTD NovDoc XML V1.0//EN" "novdocx.dtd">
<!--
*********************************
Please see LICENSE.txt for this document's license.
*********************************
-->
<chapter xml:base="adm_wbem.xml" id="cha.wbem">
 <title>使用 SFCB 的基于 Web 的企业管理</title>
 <para/>
 <sect1 id="sec.wbem.intro">
  <title>简介和基本概念</title>

  <para>
   SUSE® Linux Enterprise Server (SLES) 提供了一组基于开放标准的工具，用于统一管理不同的计算系统和环境。我们的企业解决方案实现 Distributed Management Task Force 所提出的标准。以下段落描述了它们的基本组件。
  </para>

  <para>
   Distributed Management Task Force, Inc (DMTF) 是业内引领企业和因特网环境管理标准开发的公司。他们的目标是统一管理标准和计划，开发出集成度更高、成本更低、可互操作性更好的管理解决方案。DMTF 标准为控制和通讯提供通用系统管理组件。他们的解决方案是独立于平台和技术的。<emphasis>基于 Web 的企业管理</emphasis>和<emphasis>通用信息模型</emphasis>是其关键技术之一。
  </para>

  <para>
   基于 Web 的企业管理 (WBEM) 是一整套管理和因特网标准技术。开发 WBEM 的意图是统一企业计算环境的管理。它为该行业提供了使用 Web 技术并且良好集成的管理工具集。WBEM 由以下标准组成：
  </para>

  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>
     数据模型：通用信息模型 (CIM) 标准
    </para>
   </listitem>
   <listitem>
    <para>
     编码规范：CIM-XML 编码规范
    </para>
   </listitem>
   <listitem>
    <para>
     传输机制：通过 HTTP 的 CIM 操作
    </para>
   </listitem>
  </itemizedlist>

  <para>
   通用信息模型是描述系统管理的概念信息模型。它并不局限于特定的实施，能在管理系统、网络、服务和应用程序之间交换管理信息。CIM 有两部分 — CIM 规范和 CIM 纲要。
  </para>

  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>
     <emphasis>CIM 规范</emphasis>描述语言、命名和元纲要。元模式是模型的正式定义。它定义用来表示模型及其用途以及语义的术语。元模式的元素有<emphasis>类</emphasis>、<emphasis>属性</emphasis>和<emphasis>方法</emphasis>。元纲要也支持使用<emphasis>指令</emphasis>和<emphasis>关联</emphasis>作为<emphasis>类</emphasis>的类型，使用<emphasis>参考</emphasis>作为<emphasis>属性</emphasis>的类型。
    </para>
   </listitem>
   <listitem>
    <para>
     <emphasis>CIM 纲要</emphasis>可提供实际模型描述。它提供具有属性和关联的类集合，这些类可提供易理解的概念框架，在该框架内可组织关于受管环境的可用信息。
    </para>
   </listitem>
  </itemizedlist>

  <para>
   “通用信息模型对象管理器”（CIMOM）是一种 CIM 对象管理器，或更确切地说，它是一个根据 CIM 标准管理对象的应用程序。CIMOM 管理 CIMOM 提供程序与 CIM 客户端（管理员管理系统的位置）之间的通讯。
  </para>

  <para>
   <emphasis>CIMOM 提供程序</emphasis>是在 CIMOM 内执行客户端应用程序请求的特定任务的软件。每个提供者实施 CIMOM 模式的一个或多个方面。这些提供程序直接与硬件交互。
  </para>

  <para>
   <emphasis>Standards Based Linux Instrumentation for Manageability (SBLIM)</emphasis> 是设计用来支持基于 Web 的企业管理 (WBEM) 的工具集。SUSE® Linux Enterprise Server 使用名为<emphasis>小规模 CIM 中介程序</emphasis>的 SBLIM 项目提供的开放源 CIMOM（或 CIM 服务器）。
  </para>

  <para>
   <emphasis>小规模 CIM 中介程序</emphasis>是设计用于资源有限或嵌入式环境中的 CIM 服务器。它设计为同时保持模块化与轻量级。它是基于开放标准的，支持 CMPI 提供程序、CIM-XML 编码和<emphasis>管理对象格式 (MOF)</emphasis>。它可以灵活配置，并且即便提供程序崩溃也仍然表现稳定。它也很容易访问，因为它支持各种传输协议，例如 HTTP、HTTPS、Unix 域套接字、Service Location Protocol (SLP) 和 Java Database Connectivity (JDBC)。
  </para>
 </sect1>
 <sect1 id="sec.wbem.setting">
  <title>设置 SFCB</title>

  <para>
   要设置小规模 CIM 中介程序 (SFCB) 环境，请确保 <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> 安装期间选择了 YaST 中的<guimenu>基于 Web 的企业管理</guimenu>模式。或者选择它作为组件安装到已在运行的服务器上。确保您的系统上安装了以下包：
  </para>

  <variablelist>
   <varlistentry>
    <term>cim-schema，通用信息模型 (CIM) 纲要</term>
    <listitem>
     <para>
      包含通用信息模型 (CIM)。CIM 是描述网络或企业环境中总体管理信息的模型。CIM 由规范和模式组成。规范定义与其他管理模型集成的详细信息。模式提供实际模型说明。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>cmpi-bindings-pywbem</term>
    <listitem>
     <para>
      包含在 Python 中写入和运行 CMPI 类型的 CIM 提供程序的适配器。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>cmpi-pywbem-base</term>
    <listitem>
     <para>
      包含基本系统 CIM 提供程序。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>cmpi-pywbem-power-management</term>
    <listitem>
     <para>
      包含基于 DSP1027 的电源管理提供程序。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>python-pywbem</term>
    <listitem>
     <para>
      包含通过 WBEM 协议调用 CIM 操作来查询和更新受管对象的 Phthon 模块。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>cmpi-provider-register，CIMOM 中性提供程序注册实用程序</term>
    <listitem>
     <para>
      包含的实用程序允许 CMPI 提供程序包用 CIMOM 存在于系统上的任何内容注册。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>sblim-sfcb，小规模 CIM 中介程序</term>
    <listitem>
     <para>
      包含小规模 CIM 中介程序。它是通过 HTTP 协议与 CIM 操作保持一致的 CIM 服务器。它功能强大，占用资源又少，因此很适合嵌入式和资源有限的环境。SFCB 支持通过 Common Manageability Programming Interface (CMPI) 写入的提供程序。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>sblim-sfcc</term>
    <listitem>
     <para>
      包含小规模 CIM 客户端库运行时库。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>sblim-wbemcli</term>
    <listitem>
     <para>
      包含 WBEM 命令行界面。它是一个独立的命令行 WBEM 客户端，特别适合基本的系统管理任务。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>smis-providers</term>
    <listitem>
     <para>
      包含用于在 Linux 文件系统上处理卷和快照的提供程序。这些分别基于 SNIA 的 SMI-S 卷管理配置文件和 Copy Services 配置文件。
     </para>
    </listitem>
   </varlistentry>
  </variablelist>

  <figure id="fig.wbem.setting.yast_install">
   <title>基于 Web 的企业管理模式的包选择</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="yast_install_wbem.png" width="80%" format="PNG"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="yast_install_wbem.png" width="75%" format="PNG"/>
    </imageobject>
   </mediaobject>
  </figure>

  <sect2 id="sec.wbem.setting.addinst">
   <title>安装其他提供程序</title>
   <para>
    <phrase role="productname"><phrase os="sles">SUSE® Linux Enterprise Server</phrase></phrase> 软件储存库包含基于 Web 的企业管理安装模式中没有的额外 CIM 提供程序。您可以在 YaST 软件安装模块中搜索模式 <literal>sblim-cmpi-</literal> 来方便地获取其列表和安装状态。这些提供程序涵盖了各种系统管理任务，例如 DHCP、NFS 或内核参数设置。安装要用于 SFCB 的那些提供程序是很有用的。
   </para>
   <figure id="fig.wbem.setting.yast_cimproviders_install">
    <title>其他 CIM 提供程序的包选择</title>
    <mediaobject>
     <imageobject role="fo">
      <imagedata fileref="yast_cim_providers_install.png" width="80%" format="PNG"/>
     </imageobject>
     <imageobject role="html">
      <imagedata fileref="yast_cim_providers_install.png" width="75%" format="PNG"/>
     </imageobject>
    </mediaobject>
   </figure>
  </sect2>

  <sect2 id="sec.wbem.setting.daemon">
   <title>启动、停止 SFCB 和检查其状态</title>
   <para>
    CIM 服务器 sfcbd 守护程序是和基于 Web 的企业管理软件一起安装的，默认会在系统启动时启动。下表描述如何启动、停止 sfcbd 和检查其状态。
   </para>
   <table id="tab.wbem.setting.daemon.1" frame="topbot" rowsep="0">
    <title>用于管理 sfcbd 的命令</title>
    <tgroup cols="2">
     <colspec colnum="1" colname="1"/>
     <colspec colnum="2" colname="2"/>
     <thead>
      <row rowsep="1">
       <entry colname="1">
        <para>
         任务
        </para>
       </entry>
       <entry colname="2">
        <para>
         Linux命令
        </para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row rowsep="0">
       <entry colname="1">
        <para>
         启动 sfcbd
        </para>
       </entry>
       <entry colname="2">
        <para>
         以 <systemitem class="username">root</systemitem> 用户身份在命令行中输入 <command>systemctl start sfcb.service</command>。
        </para>
       </entry>
      </row>
      <row rowsep="0">
       <entry colname="1">
        <para>
         停止 sfcbd
        </para>
       </entry>
       <entry colname="2">
        <para>
         以 <systemitem class="username">root</systemitem> 用户身份在命令行中输入 <command>systemctl stop sfcb.service</command>。
        </para>
       </entry>
      </row>
      <row rowsep="0">
       <entry colname="1">
        <para>
         检查 sfcbd 状态
        </para>
       </entry>
       <entry colname="2">
        <para>
         以 <systemitem class="username">root</systemitem> 用户身份在命令行中输入 <command>systemctl status sfcb.service</command>。
        </para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </table>
  </sect2>

  <sect2 id="sec.wbem.setting.secure">
   <title>确保安全访问</title>
   <para>
    SFCB 的默认设置相对来说比较安全。但是也要检查对 SFCB 组件访问的安全性是否符合您的组织要求。
   </para>
   <sect3 id="sec.wbem.setting.secure.cert">
    <title>证书</title>
    <para>
     安全套接字层 (SSL) 传输需要保证安全通讯的证书。安装 SFCB 时，会生成自我签名的证书。
    </para>
    <para>
     您可以通过更改 <filename>/etc/sfcb/sfcb.cfg</filename> 中的 <literal>sslCertificateFilePath: <replaceable>路径_文件名</replaceable></literal>设置将默认证书的路径换成商业或自我签名证书。该文件必须是 PEM 格式。
    </para>
    <para>
     默认生成的服务器证书位置如下：
    </para>
    <para>
     <filename>/etc/sfcb/server.pem</filename>
    </para>
    <note>
     <title>SSL 证书的路径</title>
     <para>
      默认生成的证书文件 <filename>servercert.pem</filename> 和 <filename> serverkey.pem</filename> 储存在 <filename>/etc/ssl/servercerts</filename> 目录下。文件 <filename>/etc/sfcb/client.pem</filename>、<filename>/etc/sfcb/file.pem</filename> 和 <filename>/etc/sfcb/server.pem</filename> 是这些文件的符号链接。
     </para>
    </note>
    <para>
     如果想生成新证书，请以 <systemitem class="username">root</systemitem> 身份在命令行中输入以下命令：
    </para>
<screen>tux@mercury:~&gt; sh /usr/share/sfcb/genSslCert.sh
Generating SSL certificates in .
Generating a 2048 bit RSA private key
...................................................................+++
.+++
writing new private key to '/var/tmp/sfcb.0Bjt69/key.pem'
-----</screen>
    <para>
     默认情况下，该脚本在当前工作目录下生成证书 <filename>client.pem</filename>、<filename>file.pem</filename> 和 <filename>server.pem</filename>。如果希望脚本在 <filename>/etc/sfcb</filename> 目录中生成证书，需要将它追加到命令后。如这些文件已存在，将显示一条警告消息，而不会重写旧的证书。
    </para>
<screen>tux@mercury:~&gt; sh /usr/share/sfcb/genSslCert.sh /etc/sfcb
Generating SSL certificates in .
WARNING: server.pem SSL Certificate file already exists.
         old file will be kept intact.
WARNING: client.pem SSL Certificate trust store already exists.
         old file will be kept intact.</screen>
    <para>
     必须从文件系统删除旧的证书并重新运行命令。
    </para>
    <para>
     如果希望更改 SFCB 使用证书的方式，请参见<xref linkend="sec.wbem.setting.secure.auth"/>。
    </para>
   </sect3>
   <sect3 id="sec.wbem.setting.secure.ports">
    <title>端口</title>
    <para>
     默认情况下，将 SFCB 配置为接受通过安全端口 5989 的所有通讯。以下段落描述通讯端口的设置和建议的配置。
    </para>
    <variablelist>
     <varlistentry>
      <term>端口 5989（安全）</term>
      <listitem>
       <para>
        SFCB 通讯通过 HTTPS 服务使用的安全端口。这是默认选项。通过此设置，当通过因特网在服务器和工作站之间发送通信时，将加密 CIMOM 和客户程序应用程序之间的所有通信。用户必须以客户端应用程序进行身份验证，才能连接到 SFCB 服务器。建议您保留该设置。为了让 SFCB CIMOM 能与必要的应用程序通讯，如果客户端应用程序与所监视的节点之间存在路由器和防火墙，必须在它们上面打开此端口。
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>端口 5988（不安全）</term>
      <listitem>
       <para>
        SFCB 通讯通过 HTTP 服务使用的不安全端口。在默认情况下会禁用该设置。通过此设置，当任何人在未经身份验证的情况下通过因特网在服务器和工作站之间发送通讯时，将打开并查看 CIMOM 和客户端应用程序之间的所有通讯。建议仅当尝试调试 CIMOM 问题时才使用此设置。在问题解决后，请将非安全端口选项设置回禁用。为了使 SFCB CIMOM 能够与需要非安全访问的必要应用程序进行通讯，必须在正在监视的客户端应用程序和节点之间的路由器和防火墙中打开此端口。
       </para>
      </listitem>
     </varlistentry>
    </variablelist>
    <para>
     如果希望更改默认端口指派，请参见<xref linkend="sec.wbem.setting.secure.ports"/>。
    </para>
   </sect3>
   <sect3 id="sec.wbem.setting.secure.auth">
    <title>身份验证</title>
    <para>
     SFCB 支持 HTTP 基本身份验证和基于客户端证书的身份验证（通过 SSL 连接的 HTTP）。基本 HTTP 身份验证通过在 SFCB 配置文件（默认是 <filename>/etc/sfcb/sfcb.cfg</filename>）中指定 <literal>doBasicAuth</literal> =<replaceable>true</replaceable> 来启用。SFCB 的 SUSE® Linux Enterprise Server 安装支持可嵌入身份验证模块 (PAM) 方式；因此本地 root 用户可以用本地 root 身份凭证向 SFCB CIMOM 验证。
    </para>
    <para>
     如果 <literal>sslClientCertificate</literal> 配置属性设置为 <replaceable>accept</replaceable> 或 <replaceable>require</replaceable>，SFCB HTTP 适配器通过 HTTP over SSL (HTTPS) 连接时，会从客户端请求证书。如果指定了 <replaceable>require</replaceable>，客户端<emphasis role="bold">必须</emphasis>提供有效的证书（根据通过 <replaceable>sslClientTrustStore</replaceable> 指定的客户端信任储存）。如果客户端未能提供，CIM 服务器将拒绝该连接。
    </para>
    <para>
     <literal>sslClientCertificate</literal> =<replaceable>accept</replaceable> 设置可能不是显式的。如果同时允许基本和客户端证书身份验证，它将很有用。如果客户端能提供有效的证书，将建立 HTTPS 连接，并且不会执行基本身份验证步骤。如果该功能不能校验证书，则会发生 HTTP 基本身份验证。
    </para>
   </sect3>
  </sect2>
 </sect1>
 <sect1 id="sec.wbem.config">
  <title>SFCB CIMOM 配置</title>

  <para>
   SFCB 是 CIM 服务器的“轻量级”实现，但也是可以灵活配置的。有若干选项可控制其行为。您可以通过三种方式控制 SFCB 服务器：
  </para>

  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>
     设置相应的环境变量
    </para>
   </listitem>
   <listitem>
    <para>
     使用命令行选项
    </para>
   </listitem>
   <listitem>
    <para>
     更改其配置文件
    </para>
   </listitem>
  </itemizedlist>

  <sect2 id="sec.wbem.config.env">
   <title>环境变量</title>
   <para>
    有若干环境变量会直接影响 SFCB 的行为。您必须使用 <command>systemctl restart sfcb.service</command> 重启动 SFCB 守护程序才能让更改生效。
   </para>
   <variablelist>
    <varlistentry>
     <term><literal>PATH</literal>
     </term>
     <listitem>
      <para>
       指定 <systemitem>sfcbd</systemitem> 守护程序和实用程序的路径。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>LD_LIBRARY_PATH</literal>
     </term>
     <listitem>
      <para>
       指定 sfcb 运行时库的路径。或者可以将此路径添加到系统范围的动态加载器配置文件 <filename>/etc/ld.so.conf</filename> 中。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>SFCB_PAUSE_PROVIDER</literal>
     </term>
     <listitem>
      <para>
       指定提供程序的名称。SFCB 服务器会在第一次装载提供程序后暂停。然后您就可以将运行时调试程序加到提供程序的进程中，以便调试。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>SFCB_PAUSE_CODEC</literal>
     </term>
     <listitem>
      <para>
       指定 SFCB 编解码器（目前仅支持 <literal>http</literal>）的名称。SFCB 服务器将在第一次装载编解码器后暂停。然后您就可以将运行时调试程序加到进程中。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>SFCB_TRACE</literal>
     </term>
     <listitem>
      <para>
       为 SFCB 指定调试消息的级别。有效值有 0（无调试消息）、1（关键调试消息）和 4（全部调试消息）。默认值是 1。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>SFCB_TRACE_FILE</literal>
     </term>
     <listitem>
      <para>
       默认情况下，SFCB 将其调试消息输出到标准错误输出 (STDERR)。设置该值会将调试消息写入指定的文件。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>SBLIM_TRACE</literal>
     </term>
     <listitem>
      <para>
       为 SBLIM 提供程序指定调试消息级别。有效值有 0（无调试消息）、1（关键调试消息）和 4（全部调试消息）。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>SBLIM_TRACE_FILE</literal>
     </term>
     <listitem>
      <para>
       默认情况下，SBLIM 提供程序将把跟踪消息输出到 STDERR。设置该值会将调试消息写入指定的文件。
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
  </sect2>

  <sect2 id="sec.wbem.config.cmdline">
   <title>命令行选项</title>
   <para>
    SFCB 守护程序 <systemitem>sfcbd</systemitem> 有若干命令行选项，可以打开或关闭特定运行时功能。SFCB 守护程序启动时输入这些选项。
   </para>
   <variablelist>
    <varlistentry>
     <term><literal>-c, --config-file</literal>=<replaceable>FILE</replaceable>
     </term>
     <listitem>
      <para>
       SFCB 守护程序启动时，默认会从 <filename>/etc/sfcb/sfcb.cfg</filename> 读取其配置。您可以用该选项指定备用配置文件。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>-d, --daemon</literal>
     </term>
     <listitem>
      <para>
       强制 sfcbd 及其子进程在后台运行。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>-s, --collect-stats</literal>
     </term>
     <listitem>
      <para>
       打开运行时统计数字收集。各种 sfcbd 运行时统计数字都会写入当前工作目录下的 <filename>sfcbStat</filename> 文件。默认情况下，不收集统计数字。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>-l, --syslog-level</literal>=<replaceable>LOGLEVEL</replaceable>
     </term>
     <listitem>
      <para>
       指定系统日志记录工具的详细级别。<replaceable>LOGLEVEL</replaceable> 可以是 LOG_INFO、LOG_DEBUG 或 LOG_ERR（默认）。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>-k, --color-trace</literal>=<replaceable>日志级别</replaceable>
     </term>
     <listitem>
      <para>
       以不同颜色打印每个进程的跟踪输出，以方便调试。
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
   <variablelist>
    <varlistentry>
     <term><literal>-t, --trace-components</literal>=<replaceable>NUM</replaceable>
     </term>
     <listitem>
      <para>
       激活组件级跟踪消息，其中 <replaceable>NUM</replaceable> 是进行 OR 运算的位掩码整数，它定义要跟踪哪个组件。您指定 <option>-t ?</option> 后，它会列出所有组件及其相关整数位掩码：
      </para>
<screen>tux@mercury:~&gt; sfcbd -t ?
---   Traceable Components:     Int       Hex
--- 	       providerMgr:          1	0x0000001
--- 	       providerDrv:          2	0x0000002
--- 	        cimxmlProc:          4	0x0000004
--- 	        httpDaemon:          8	0x0000008
--- 	           upCalls:         16	0x0000010
--- 	          encCalls:         32	0x0000020
--- 	   ProviderInstMgr:         64	0x0000040
--- 	  providerAssocMgr:        128	0x0000080
--- 	         providers:        256	0x0000100
--- 	       indProvider:        512	0x0000200
--- 	  internalProvider:       1024	0x0000400
--- 	        objectImpl:       2048	0x0000800
--- 	             xmlIn:       4096	0x0001000
--- 	            xmlOut:       8192	0x0002000
--- 	           sockets:      16384	0x0004000
--- 	         memoryMgr:      32768	0x0008000
--- 	          msgQueue:      65536	0x0010000
--- 	        xmlParsing:     131072	0x0020000
--- 	    responseTiming:     262144	0x0040000
--- 	         dbpdaemon:     524288	0x0080000
--- 	               slp:    1048576	0x0100000</screen>
      <para>
       能反映 sfcbd 的内部功能，但不会产生过多消息的有用值是 <option>-t</option> <replaceable>2019</replaceable>。
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
  </sect2>

  <sect2 id="sec.wbem.config.confile">
   <title>SFCB 配置文件</title>
   <para>
    SFCB 启动后从配置文件 <filename>/etc/sfcb/sfcb.cfg</filename> 读取其运行时配置。该行为在启动时可以用 <option>-c</option> 选项覆盖。
   </para>
   <para>
    配置文件包含<option>选项</option>:<replaceable>值</replaceable>对，一行一对。当对此文件执行更改时，如果文本编辑器保存文件的格式是所使用环境的本机格式，则可以使用此文本编辑器更改文件。
   </para>
   <para>
    由井号 (#) 注释的选项的所有设置都使用默认设置。
   </para>
   <para>
    以下选项列表可能不完整。查看 <filename>/etc/sfcb/sfcb.cfg</filename> 和 <filename>/usr/share/doc/packages/sblim-sfcb/README</filename> 的内容以获取其完整列表。
   </para>
   <sect3 id="sec.wbem.config.confile.1">
    <title>httpPort</title>
    <bridgehead>目的</bridgehead>
    <para>
     指定 sfcbd 用于侦听接收自 CIM 客户端的 HTTP（非安全）请求的本地端口值。默认值是 <literal>5988</literal>。
    </para>
    <bridgehead>语法</bridgehead>
    <para>
     <literal>httpPort:</literal> <replaceable>端口号</replaceable>
    </para>
   </sect3>
   <sect3 id="sec.wbem.config.confile.2">
    <title>enableHttp</title>
    <bridgehead>目的</bridgehead>
    <para>
     指定 SFCB 是否接受 HTTP 客户端的连接。默认为 <literal>false</literal>。
    </para>
    <bridgehead>语法</bridgehead>
    <para>
     <literal>enableHttp:</literal> <replaceable>选项</replaceable>
    </para>
    <informaltable frame="topbot" rowsep="1">
     <tgroup cols="2">
      <thead>
       <row>
        <entry>
         <para>
          选项
         </para>
        </entry>
        <entry>
         <para>
          描述
         </para>
        </entry>
       </row>
      </thead>
      <tbody>
       <row>
        <entry>
         <para>
          true
         </para>
        </entry>
        <entry>
         <para>
          启用 HTTP 连接。
         </para>
        </entry>
       </row>
       <row>
        <entry>
         <para>
          false
         </para>
        </entry>
        <entry>
         <para>
          禁用 HTTP 连接。
         </para>
        </entry>
       </row>
      </tbody>
     </tgroup>
    </informaltable>
   </sect3>
   <sect3 id="sec.wbem.config.confile.3">
    <title>httpProcs</title>
    <bridgehead>目的</bridgehead>
    <para>
     指定在阻止新进来的 HTTP 请求之前，HTTP 客户端连接的最大并行数。默认值是 <literal>8</literal>。
    </para>
    <bridgehead>语法</bridgehead>
    <para>
     <literal>httpProcs:</literal> <replaceable>最大连接数</replaceable>
    </para>
   </sect3>
   <sect3 id="sec.wbem.config.confile.3.5">
    <title>httpUserSFCB、httpUser</title>
    <bridgehead>目的</bridgehead>
    <para>
     这些选项控制将运行 HTTP 服务器的用户。如果 <option>httpUserSFCB</option> 为 <literal>true</literal>，HTTP 将以 SFCB 主进程的同一用户身份运行。如果为 <literal>false</literal>，将使用为 <option>httpUser</option> 指定的用户名。此设置用于 HTTP 和 HTTPS 服务器。如果 <option>httpUserSFCB</option> 设置为 <literal>false</literal>，则<emphasis>必须</emphasis>指定 <option>httpUser</option>。默认值为 <literal>true</literal>。
    </para>
    <bridgehead>语法</bridgehead>
    <para>
     <literal>httpUserSFCB:</literal> <replaceable>true</replaceable>
    </para>
   </sect3>
   <sect3 id="sec.wbem.config.confile.3.8">
    <title>httpLocalOnly</title>
    <bridgehead>目的</bridgehead>
    <para>
     指定是否将 HTTP 请求限制为仅 localhost。默认为 <literal>false</literal>。
    </para>
    <bridgehead>语法</bridgehead>
    <para>
     <literal>httpLocalOnly:</literal> <replaceable>false</replaceable>
    </para>
   </sect3>
   <sect3 id="sec.wbem.config.confile.4">
    <title>httpsPort</title>
    <bridgehead>目的</bridgehead>
    <para>
     指定 sfcbd 侦听来自 CIM 客户端的 HTTPS 请求的本地端口值。默认值是 <literal>5989</literal>。
    </para>
    <bridgehead>语法</bridgehead>
    <para>
     <literal>httpsPort:</literal> <replaceable>端口号</replaceable>
    </para>
   </sect3>
   <sect3 id="sec.wbem.config.confile.5">
    <title>enableHttps</title>
    <bridgehead>目的</bridgehead>
    <para>
     指定 SFCB 是否接受 HTTPS 客户端连接。默认值是 <literal>true</literal>。
    </para>
    <bridgehead>语法</bridgehead>
    <para>
     <literal>enableHttps:</literal> <replaceable>选项</replaceable>
    </para>
    <informaltable frame="topbot" rowsep="1">
     <tgroup cols="2">
      <thead>
       <row>
        <entry>
         <para>
          选项
         </para>
        </entry>
        <entry>
         <para>
          描述
         </para>
        </entry>
       </row>
      </thead>
      <tbody>
       <row>
        <entry>
         <para>
          true
         </para>
        </entry>
        <entry>
         <para>
          启用 HTTPS 连接。
         </para>
        </entry>
       </row>
       <row>
        <entry>
         <para>
          false
         </para>
        </entry>
        <entry>
         <para>
          禁用 HTTPS 连接。
         </para>
        </entry>
       </row>
      </tbody>
     </tgroup>
    </informaltable>
   </sect3>
   <sect3 id="sec.wbem.config.confile.7">
    <title>httpsProcs</title>
    <bridgehead>目的</bridgehead>
    <para>
     指定在阻止新进来的 HTTPS 请求之前，HTTPS 客户端连接的最大并行数。默认为 <literal>8</literal>。
    </para>
    <bridgehead>语法</bridgehead>
    <para>
     <literal>httpsProcs:</literal> <replaceable>最大连接数</replaceable>
    </para>
   </sect3>
   <sect3 id="sec.wbem.config.confile.8">
    <title>enableInterOp</title>
    <bridgehead>目的</bridgehead>
    <para>
     指定 SFCB 是否为指示支持提供 <emphasis>interop</emphasis> 名称空间。默认值是 <literal>true</literal>。
    </para>
    <bridgehead>语法</bridgehead>
    <para>
     <literal>enableInterOp:</literal> <replaceable>选项</replaceable>
    </para>
    <informaltable frame="topbot" rowsep="1">
     <tgroup cols="2">
      <thead>
       <row>
        <entry>
         <para>
          选项
         </para>
        </entry>
        <entry>
         <para>
          描述
         </para>
        </entry>
       </row>
      </thead>
      <tbody>
       <row>
        <entry>
         <para>
          true
         </para>
        </entry>
        <entry>
         <para>
          启用 interop 名称空间。
         </para>
        </entry>
       </row>
       <row>
        <entry>
         <para>
          false
         </para>
        </entry>
        <entry>
         <para>
          禁用 interop 名称空间。
         </para>
        </entry>
       </row>
      </tbody>
     </tgroup>
    </informaltable>
   </sect3>
   <sect3 id="sec.wbem.config.confile.9">
    <title>provProcs</title>
    <bridgehead>目的</bridgehead>
    <para>
     指定并发提供程序进程的最大数。达到这点之后，如果有新进来的请求要求装载新提供程序，则现有提供程序之一将自动卸载。默认值是 <literal>32</literal>。
    </para>
    <bridgehead>语法</bridgehead>
    <para>
     <literal>provProcs:</literal> <replaceable>最大进程数</replaceable>
    </para>
   </sect3>
   <sect3 id="sec.wbem.config.confile.10">
    <title>doBasicAuth</title>
    <bridgehead>目的</bridgehead>
    <para>
     根据客户端用户标识符打开或关闭它接受请求之前所做的基本身份验证。默认值为 <literal>true</literal>，表示执行基本客户端身份验证。
    </para>
    <bridgehead>语法</bridgehead>
    <para>
     <literal>doBasicAuth:</literal> <replaceable>选项</replaceable>
    </para>
    <informaltable frame="topbot" rowsep="1">
     <tgroup cols="2">
      <thead>
       <row>
        <entry>
         <para>
          选项
         </para>
        </entry>
        <entry>
         <para>
          描述
         </para>
        </entry>
       </row>
      </thead>
      <tbody>
       <row>
        <entry>
         <para>
          true
         </para>
        </entry>
        <entry>
         <para>
          启用基本身份验证。
         </para>
        </entry>
       </row>
       <row>
        <entry>
         <para>
          false
         </para>
        </entry>
        <entry>
         <para>
          禁用基本身份验证。
         </para>
        </entry>
       </row>
      </tbody>
     </tgroup>
    </informaltable>
   </sect3>
   <sect3 id="sec.wbem.config.confile.11">
    <title>basicAuthLib</title>
    <bridgehead>目的</bridgehead>
    <para>
     指定本地库名称。SFCB 服务器将装载该库以验证客户端用户标识符。默认值是 <literal>sfcBasicPAMAuthentication</literal>。
    </para>
    <bridgehead>语法</bridgehead>
    <para>
     <literal>provProcs:</literal> <replaceable>最大进程数</replaceable>
    </para>
   </sect3>
   <sect3 id="sec.wbem.config.confile.12">
    <title>useChunking</title>
    <bridgehead>目的</bridgehead>
    <para>
     该选项启用或禁用 HTTP/HTTPS<quote>分块</quote>。如果启用，服务器将以小<quote>块</quote>形式将大量响应数据返回客户端，而不是缓存数据并以一个大块全部发回。默认值是 <literal>true</literal>。
    </para>
    <bridgehead>语法</bridgehead>
    <para>
     <literal>useChunking:</literal> <replaceable>选项</replaceable>
    </para>
    <informaltable frame="topbot" rowsep="1">
     <tgroup cols="2">
      <thead>
       <row>
        <entry>
         <para>
          选项
         </para>
        </entry>
        <entry>
         <para>
          描述
         </para>
        </entry>
       </row>
      </thead>
      <tbody>
       <row>
        <entry>
         <para>
          true
         </para>
        </entry>
        <entry>
         <para>
          启用 HTTP/HTTPS 数据分块。
         </para>
        </entry>
       </row>
       <row>
        <entry>
         <para>
          false
         </para>
        </entry>
        <entry>
         <para>
          禁用 HTTP/HTTPS 数据分块。
         </para>
        </entry>
       </row>
      </tbody>
     </tgroup>
    </informaltable>
   </sect3>
   <sect3 id="sec.wbem.config.confile.13">
    <title>keepaliveTimeout</title>
    <bridgehead>目的</bridgehead>
    <para>
     指定一个连接上的 SFCB HTTP 进程在两次请求之间最多等待多少秒就终止。将它设置为 <literal>0</literal> 将禁用 HTTP keep-alive。默认值是 <literal>0</literal>。
    </para>
    <bridgehead>语法</bridgehead>
    <para>
     <literal>keepaliveTimeout:</literal> <replaceable>秒</replaceable>
    </para>
   </sect3>
   <sect3 id="sec.wbem.config.confile.14">
    <title>keepaliveMaxRequest</title>
    <bridgehead>目的</bridgehead>
    <para>
     指定一个连接上连续请求的最大数。将它设置为 <literal>0</literal> 将禁用 HTTP keep-alive。默认值是 <literal>10</literal>。
    </para>
    <bridgehead>语法</bridgehead>
    <para>
     <literal>keepaliveMaxRequest:</literal> <replaceable>连接数</replaceable>
    </para>
   </sect3>
   <sect3 id="sec.wbem.config.confile.15">
    <title>registrationDir</title>
    <bridgehead>目的</bridgehead>
    <para>
     指定注册目录，它包含提供程序的注册数据、分阶段区域和静态安装源。默认值是 <filename>/var/lib/sfcb/registration</filename>。
    </para>
    <bridgehead>语法</bridgehead>
    <para>
     <literal>registrationDir:</literal> <replaceable>目录</replaceable>
    </para>
   </sect3>
   <sect3 id="sec.wbem.config.confile.16">
    <title>providerDirs</title>
    <bridgehead>目的</bridgehead>
    <para>
     指定 SFCB 搜索提供程序库的目录的空格分隔列表。默认值是 <filename>/usr/lib64 /usr/lib64 /usr/lib64/cmpi</filename>。
    </para>
    <bridgehead>语法</bridgehead>
    <para>
     <literal>providerDirs:</literal> <replaceable>目录</replaceable>
    </para>
   </sect3>
   <sect3 id="sec.wbem.config.confile.17">
    <title>providerSampleInterval</title>
    <bridgehead>目的</bridgehead>
    <para>
     指定提供程序管理器间隔多少秒检查空闲的提供程序。默认值是 <literal>30</literal>。
    </para>
    <bridgehead>语法</bridgehead>
    <para>
     <literal>providerSampleInterval:</literal> <replaceable>秒</replaceable>
    </para>
   </sect3>
   <sect3 id="sec.wbem.config.confile.18">
    <title>providerTimeoutInterval</title>
    <bridgehead>目的</bridgehead>
    <para>
     指定提供程序管理器经过多少秒的间隔就卸载空闲的提供程序。默认值是 <literal>60</literal>。
    </para>
    <bridgehead>语法</bridgehead>
    <para>
     <literal>providerTimeoutInterval:</literal> <replaceable>秒</replaceable>
    </para>
   </sect3>
   <sect3 id="sec.wbem.config.confile.19">
    <title>providerAutoGroup</title>
    <bridgehead>目的</bridgehead>
    <para>
     如果提供程序注册文件未指定任何其他组，而该选项设置为 <replaceable>true</replaceable>，则同一共享库内的所有提供程序都将在同一进程中执行。
    </para>
    <bridgehead>语法</bridgehead>
    <para>
     <literal>providerAutoGroup:</literal> <replaceable>选项</replaceable>
    </para>
    <informaltable frame="topbot" rowsep="1">
     <tgroup cols="2">
      <thead>
       <row>
        <entry>
         <para>
          选项
         </para>
        </entry>
        <entry>
         <para>
          描述
         </para>
        </entry>
       </row>
      </thead>
      <tbody>
       <row>
        <entry>
         <para>
          true
         </para>
        </entry>
        <entry>
         <para>
          启用提供程序分组。
         </para>
        </entry>
       </row>
       <row>
        <entry>
         <para>
          false
         </para>
        </entry>
        <entry>
         <para>
          禁用提供程序分组。
         </para>
        </entry>
       </row>
      </tbody>
     </tgroup>
    </informaltable>
   </sect3>
   <sect3 id="sec.wbem.config.confile.20">
    <title>sslCertificateFilePath</title>
    <bridgehead>目的</bridgehead>
    <para>
     指定包含服务器证书的文件的名称。该文件必须是 PEM (保密邮件，RFC 1421 和 RFC 1424）格式。只有当 <literal>enableHttps</literal> 设置为 <literal>true</literal> 时才需要该文件。默认值是 <filename>/etc/sfcb/server.pem</filename>。
    </para>
    <bridgehead>语法</bridgehead>
    <para>
     <literal>sslCertificateFilePath:</literal> <replaceable>路径</replaceable>
    </para>
   </sect3>
   <sect3 id="sec.wbem.config.confile.21">
    <title>sslKeyFilePath</title>
    <bridgehead>目的</bridgehead>
    <para>
     指定包含服务器证书私用密钥的文件的名称。该文件必须是 PEM 格式且不能有通行密码的保护。该文件仅当 <literal>enableHttps</literal> 设置为 <literal>true</literal> 时才需要。默认值是 <filename>/etc/sfcb/file.pem</filename>。
    </para>
    <bridgehead>语法</bridgehead>
    <para>
     <literal>sslKeyFilePath:</literal> <replaceable>路径</replaceable>
    </para>
   </sect3>
   <sect3 id="sec.wbem.config.confile.22">
    <title>sslClientTrustStore</title>
    <bridgehead>目的</bridgehead>
    <para>
     指定包含客户端的 CA 或自我签名证书的文件的名称。该文件必须是 PEM 格式，只有当 <literal>sslClientCertificate</literal> 设置为 <literal>accept</literal> 或 <literal>require</literal> 时才需要。默认值是 <filename>/etc/sfcb/client.pem</filename>。
    </para>
    <bridgehead>语法</bridgehead>
    <para>
     <literal>sslClientTrustStore:</literal> <replaceable>路径</replaceable>
    </para>
   </sect3>
   <sect3 id="sec.wbem.config.confile.23">
    <title>sslClientCertificate</title>
    <bridgehead>目的</bridgehead>
    <para>
     指定 SFCB 处理基于客户端证书的身份验证的方式。如果设置为 <literal>ignore</literal>，将不会从客户端请求证书。如果设置为 <literal>accept</literal>，它会从客户端请求证书，但即使客户端没有证书也不会失败。如果设置为 <literal>require</literal>，会在客户端不存在证书时拒绝客户端连接。默认值是 <literal>ignore</literal>。
    </para>
    <bridgehead>语法</bridgehead>
    <para>
     <literal>sslClientCertificate:</literal> <replaceable>选项</replaceable>
    </para>
    <informaltable frame="topbot" rowsep="1">
     <tgroup cols="2">
      <thead>
       <row>
        <entry>
         <para>
          选项
         </para>
        </entry>
        <entry>
         <para>
          描述
         </para>
        </entry>
       </row>
      </thead>
      <tbody>
       <row>
        <entry>
         <para>
          ignore
         </para>
        </entry>
        <entry>
         <para>
          禁止请求客户端证书。
         </para>
        </entry>
       </row>
       <row>
        <entry>
         <para>
          接受
         </para>
        </entry>
        <entry>
         <para>
          禁止请求客户端证书。
         </para>
         <para>
          如果证书不存在，不会失败。
         </para>
        </entry>
       </row>
       <row>
        <entry>
         <para>
          require
         </para>
        </entry>
        <entry>
         <para>
          拒绝无有效证书的客户端连接。
         </para>
        </entry>
       </row>
      </tbody>
     </tgroup>
    </informaltable>
   </sect3>
   <sect3 id="sec.wbem.config.confile.24">
    <title>certificateAuthLib</title>
    <bridgehead>目的</bridgehead>
    <para>
     指定用于请求基于客户端证书的用户身份验证的本地库名称。只有当 <literal>sslClientCertificate</literal> 未设置成 <literal>ignore</literal> 时才这样请求。默认值是 <filename>sfcCertificateAuthentication</filename>。
    </para>
    <bridgehead>语法</bridgehead>
    <para>
     <literal>certificateAuthLib:</literal> <replaceable>文件</replaceable>
    </para>
   </sect3>
   <sect3 id="sec.wbem.config.confile.25">
    <title>traceLevel</title>
    <bridgehead>目的</bridgehead>
    <para>
     指定 SFCB 的跟踪级别您可以通过设置环境变量 <literal>SFCB_TRACE_LEVEL</literal> 覆盖它。默认值是 <literal>0</literal>。
    </para>
    <bridgehead>语法</bridgehead>
    <para>
     <literal>traceLevel:</literal> <replaceable>级别数</replaceable>
    </para>
   </sect3>
   <sect3 id="sec.wbem.config.confile.26">
    <title>traceMask</title>
    <bridgehead>目的</bridgehead>
    <para>
     指定 SFCB 的跟踪掩码。您可以用命令行选项 <option>--trace-components</option> 覆盖它。默认值是 <literal>0</literal>。
    </para>
    <bridgehead>语法</bridgehead>
    <para>
     <literal>traceMask:</literal> <replaceable>掩码</replaceable>
    </para>
   </sect3>
   <sect3 id="sec.wbem.config.confile.27">
    <title>tracefile</title>
    <bridgehead>目的</bridgehead>
    <para>
     为 SFCB 指定跟踪文件。您可以通过设置环境变量 <literal>SFCB_TRACE_FILE</literal> 覆盖它。默认值是 <literal>stderr</literal>（标准错误输出）。
    </para>
    <bridgehead>语法</bridgehead>
    <para>
     <literal>traceFile:</literal> <replaceable>输出</replaceable>
    </para>
   </sect3>
  </sect2>
 </sect1>
 <sect1 id="sec.wbem.advanced">
  <title>高级 SFCB 任务</title>

  <para>
   本章涵盖了与 SFCB 使用相关的更多高级主题。要了解这些主题，您需要有 Linux 文件系统的基础知识，并具有使用 Linux 命令行的经验。本章包括以下任务:
  </para>

  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>
     安装 CMPI 提供程序
    </para>
   </listitem>
   <listitem>
    <para>
     测试 SFCB
    </para>
   </listitem>
   <listitem>
    <para>
     使用 <command>wbemcli</command> CIM 客户端
    </para>
   </listitem>
  </itemizedlist>

  <sect2 id="sec.wbem.advanced.cmpinst">
   <title>安装 CMPI 提供程序</title>
   <para>
    要安装 CMPI 提供程序，您必须确保其共享库已复制到 <literal>providerDirs</literal> 配置选项所指定的目录之一，参见<xref linkend="sec.wbem.config.confile.16"/>。提供程序还必须用 <command>sfcbstage</command> 和 <command>sfcbrepos</command> 命令正确注册。
   </para>
   <para>
    提供程序包通常是为 SFCB 准备的，为此其安装过程负责进行正确的注册。多数 SBLIM 提供程序是为 SFCB 准备的。
   </para>
   <sect3 id="sec.wbem.advanced.cmpinst.crep">
    <title>类安装源</title>
    <para>
     <emphasis>类安装源</emphasis>就是 SFCB 储存 CIM 类信息的位置。它通常由名称空间组件组成的目录树组成。典型的 CIM 名称空间如 <literal>root/cimv2</literal> 或 <literal>root/interop</literal>，它们会分别转换为文件系统上的类安装源目录路径
    </para>
    <para>
     <filename>/var/lib/sfcb/registration/repository/root/cimv2</filename>
    </para>
    <para>
     和
    </para>
    <para>
     <filename>/var/lib/sfcb/registration/repository/root/interop</filename>
    </para>
    <para>
     每个名称空间目录都包含文件 <filename>classSchemas</filename>。该文件中有该名称空间下注册的所有 CIM 类的已编译二进制表示。它还包含有关其 CIM 超类的必要信息。
    </para>
    <para>
     此外，每个名称空间目录都可能包含文件 <filename>qualifiers</filename>，其中包含了该名称空间的所有限定符。sfcbd 重启动时，类提供程序会扫描目录 <filename>/var/lib/sfcb/registration/repository/</filename> 及其全部子目录，以确定注册的名称空间。然后将解码 <filename>classSchemas</filename> 文件，为每个名称空间构建类的层次结构。
    </para>
   </sect3>
   <sect3 id="sec.wbem.advanced.cmpinst.classadd">
    <title>添加新类</title>
    <para>
     SFCB 不能在线处理 CIM 类。您需要脱机添加、更改或删除类，然后使用 <command>systemctl restart sfcb.service</command> 重启动 SFCB 服务来注册这些更改。
    </para>
    <para>
     为储存提供程序类和注册信息，SFCB 使用名为<emphasis>分阶段区域</emphasis>的位置。在 SUSE® Linux Enterprise Server 系统上，它就是 <filename>/var/lib/sfcb/stage/</filename> 下的目录结构。
    </para>
    <para>
     为添加新的提供程序，您必须：
    </para>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <para>
       将提供程序类定义文件复制到分阶段区域目录的子目录 <filename>./mofs</filename> (<filename>/var/lib/sfcb/stage/mofs</filename>)。
      </para>
     </listitem>
     <listitem>
      <para>
       将包含类名、提供程序类型和可执行库文件名的注册文件复制到 <filename>./regs</filename> 子目录。
      </para>
     </listitem>
    </itemizedlist>
    <para>
     分阶段目录中有两个默认的 <quote>mof</quote>（类定义）文件：<filename>indication.mof</filename> 和 <filename>interop.mof</filename>。运行 <filename>sfcbrepos</filename> 命令后，root 阶段目录 <filename>/var/lib/sfcb/stage/mofs</filename> 下的 MOF 文件将复制到每个名称空间。<filename>interop.mof</filename> 将只编译到 <emphasis>interop</emphasis> 名称空间。
    </para>
    <para>
     目录布局看上去如下所示：
    </para>
<screen>tux@mercury:~&gt; ls /var/lib/sfcb/stage
default.reg  mofs  regs</screen>
<screen>tux@mercury:~&gt; ls /var/lib/sfcb/stage/mofs
indication.mof  root</screen>
<screen>tux@mercury:~&gt; ls /var/lib/sfcb/stage/mofs/root
cimv2  interop  suse  virt</screen>
<screen>tux@mercury:~&gt; ls -1 /var/lib/sfcb/stage/mofs/root/cimv2 | less
Linux_ABIParameter.mof
Linux_BaseIndication.mof
Linux_Base.mof
Linux_DHCPElementConformsToProfile.mof
Linux_DHCPEntity.mof
[..]
OMC_StorageSettingWithHints.mof
OMC_StorageVolumeDevice.mof
OMC_StorageVolume.mof
OMC_StorageVolumeStorageSynchronized.mof
OMC_SystemStorageCapabilities.mof</screen>
<screen>tux@mercury:~&gt; ls -1 /var/lib/sfcb/stage/mofs/root/interop
ComputerSystem.mof
ElementConformsToProfile.mof
HostSystem.mof
interop.mof
Linux_DHCPElementConformsToProfile.mof
[..]
OMC_SMIElementSoftwareIdentity.mof
OMC_SMISubProfileRequiresProfile.mof
OMC_SMIVolumeManagementSoftware.mof
ReferencedProfile.mof
RegisteredProfile.mof</screen>
<screen>tux@mercury:~&gt; ls -1 /var/lib/sfcb/stage/regs
AllocationCapabilities.reg
Linux_ABIParameter.reg
Linux_BaseIndication.reg
Linux_DHCPGlobal.reg
Linux_DHCPRegisteredProfile.reg
[..]
OMC_Base.sfcb.reg
OMC_CopyServices.sfcb.reg
OMC_PowerManagement.sfcb.reg
OMC_Server.sfcb.reg
RegisteredProfile.reg</screen>
<screen>tux@mercury:~&gt;  cat /var/lib/sfcb/stage/regs/Linux_DHCPRegisteredProfile.reg
[Linux_DHCPRegisteredProfile]
   provider: Linux_DHCPRegisteredProfileProvider
   location: cmpiLinux_DHCPRegisteredProfile
   type: instance
   namespace: root/interop
#
[Linux_DHCPElementConformsToProfile]
   provider: Linux_DHCPElementConformsToProfileProvider
   location: cmpiLinux_DHCPElementConformsToProfile
   type: instance association
   namespace: root/cimv2
#
[Linux_DHCPElementConformsToProfile]
   provider: Linux_DHCPElementConformsToProfileProvider
   location: cmpiLinux_DHCPElementConformsToProfile
   type: instance association
   namespace: root/interop</screen>
    <para>
     SFCB 对每个提供程序使用自定义提供程序注册文件。
    </para>
    <note>
     <title>SBLIM 提供程序注册文件</title>
     <para>
      SBLIM 网站上的所有 SBLIM 提供程序都已包括用于生成 SFCB 的 .reg 文件的注册文件。
     </para>
    </note>
    <para>
     SFCB 注册文件的格式是：
    </para>
<screen>
[&lt;class-name&gt;]
   provider: &lt;provide-name&gt;
   location: &lt;library-name&gt;
   type: [instance] [association] [method] [indication]
   group: &lt;group-name&gt;
   unload: never
   namespace: &lt;namespace-for-class&gt; ...
</screen>
    <para>
     其中：
    </para>
    <variablelist>
     <varlistentry>
      <term><literal>&lt;class-name&gt;</literal>
      </term>
      <listitem>
       <para>
        CIM 类名（必需）
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term><literal>&lt;provider-name&gt;</literal>
      </term>
      <listitem>
       <para>
        CMPI 提供程序名称（必需）
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term><literal>&lt;location-name&gt;</literal>
      </term>
      <listitem>
       <para>
        提供程序库的名称（必需）
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term><literal>type</literal>
      </term>
      <listitem>
       <para>
        提供程序的类型（必需）它可以是以下的任意组合：<literal>instance</literal>、<literal>association</literal>、<literal>method</literal> 或 <literal>indication</literal>。
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term><literal>&lt;group-name&gt;</literal>
      </term>
      <listitem>
       <para>
        可以将多个提供程序组合起来，在单一进程下运行，以进一步最小化运行时资源的占用。所有注册在同一 &lt;group-name&gt; 下的提供程序都将在同一进程下执行。默认情况下每个提供程序作为单独的进程运行。
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term><literal>unload</literal>
      </term>
      <listitem>
       <para>
        指定提供程序的卸载策略。目前唯一支持的选项是 <option>never</option>，即指定不监视提供程序的空闲次数，也从不卸载。默认情况下，每个提供程序只要空闲次数超过配置文件中指定的值就卸载。
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term><literal>namespace</literal>
      </term>
      <listitem>
       <para>
        可执行本提供程序的名称空间的列表。这是必需的，尽管对于多数提供程序来说它就是 <replaceable>root/cimv2</replaceable>。
       </para>
      </listitem>
     </varlistentry>
    </variablelist>
    <para>
     所有类定义和提供程序注册文件都储存在分阶段区域后，就需要用命令 <command> sfcbrepos <option>-f</option></command> 重构建 SFCB 类安装源。
    </para>
    <para>
     您可以用这种方式添加、更改或删除类。重构建类储存库后，用命令 <command>systemctl restart sfcb.service</command> 重启动 SFCB。
    </para>
    <para>
     或者，SFCB 包包含一个实用程序，它会将提供程序类 mof 文件和注册文件复制到分阶段区域中正确的位置。
    </para>
    <para>
     <command>sfcbstage <option>-r</option></command> <literal>[provider.reg] [class1.mof] [class2.mof] ...</literal>
    </para>
    <para>
     运行该命令后，您还需要重构建类安装源并重启动 SFCB 服务。
    </para>
   </sect3>
  </sect2>

  <sect2 id="sec.wbem.advanced.testing">
   <title>测试 SFCB</title>
   <para>
    SFCB 包包括两个测试脚本：<command>wbemcat</command> 和 <command>xmltest</command>。
   </para>
   <para>
    <command>wbemcat</command> 通过 HTTP 协议将原始 CIM-XML 数据发送到端口 5988 上正在侦听的指定 SFCB 主机（默认为本地主机）。然后它会显示返回的结果以下文件包含标准 EnumerateClasses 请求的 CIM-XML 表示：
   </para>
<screen>&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;CIM CIMVERSION="2.0" DTDVERSION="2.0"&gt;
  &lt;MESSAGE ID="4711" PROTOCOLVERSION="1.0"&gt;
    &lt;SIMPLEREQ&gt;
      &lt;IMETHODCALL NAME="EnumerateClasses"&gt;
        &lt;LOCALNAMESPACEPATH&gt;
          &lt;NAMESPACE NAME="root"/&gt;
          &lt;NAMESPACE NAME="cimv2"/&gt;
        &lt;/LOCALNAMESPACEPATH&gt;
        &lt;IPARAMVALUE NAME="ClassName"&gt;
          &lt;CLASSNAME NAME=""/&gt;
        &lt;/IPARAMVALUE&gt;
        &lt;IPARAMVALUE NAME="DeepInheritance"&gt;
          &lt;VALUE&gt;TRUE&lt;/VALUE&gt;
        &lt;/IPARAMVALUE&gt;
        &lt;IPARAMVALUE NAME="LocalOnly"&gt;
          &lt;VALUE&gt;FALSE&lt;/VALUE&gt;
        &lt;/IPARAMVALUE&gt;
        &lt;IPARAMVALUE NAME="IncludeQualifiers"&gt;
          &lt;VALUE&gt;FALSE&lt;/VALUE&gt;
        &lt;/IPARAMVALUE&gt;
        &lt;IPARAMVALUE NAME="IncludeClassOrigin"&gt;
          &lt;VALUE&gt;TRUE&lt;/VALUE&gt;
        &lt;/IPARAMVALUE&gt;
      &lt;/IMETHODCALL&gt;
    &lt;/SIMPLEREQ&gt;
  &lt;/MESSAGE&gt;
&lt;/CIM&gt;</screen>
   <para>
    将该请求发送到 SFCB CIMOM 后，会返回具有已注册提供程序的所有支持类的列表。假定您将文件保存为 <filename>cim_xml_test.xml</filename>。
   </para>
<screen>tux@mercury:~&gt; wbemcat cim_xml_test.xml | less
HTTP/1.1 200 OK
Content-Type: application/xml; charset="utf-8"
Content-Length: 337565
Cache-Control: no-cache
CIMOperation: MethodResponse

&lt;?xml version="1.0" encoding="utf-8" ?&gt;
&lt;CIM CIMVERSION="2.0" DTDVERSION="2.0"&gt;
&lt;MESSAGE ID="4711" PROTOCOLVERSION="1.0"&gt;
&lt;SIMPLERSP&gt;
&lt;IMETHODRESPONSE NAME="EnumerateClasses"&gt;
[..]
&lt;CLASS NAME="Linux_DHCPParamsForEntity" SUPERCLASS="CIM_Component"&gt;
&lt;PROPERTY.REFERENCE NAME="GroupComponent" REFERENCECLASS="Linux_DHCPEntity"&gt;
&lt;/PROPERTY.REFERENCE&gt;
&lt;PROPERTY.REFERENCE NAME="PartComponent" REFERENCECLASS="Linux_DHCPParams"&gt;
&lt;/PROPERTY.REFERENCE&gt;
&lt;/CLASS&gt;
&lt;/IRETURNVALUE&gt;
&lt;/IMETHODRESPONSE&gt;
&lt;/SIMPLERSP&gt;
&lt;/MESSAGE&gt;
&lt;/CIM&gt;</screen>
   <para>
    列出的类会随您在系统上安装的提供程序的不同而不同。
   </para>
   <para>
    第二个脚本 <command>xmltest</command> 也用于将原始 CIM-XML 测试文件发送到 SFCB CIMOM。它会随即比较返回的结果和以前保存的<quote>OK</quote>结果文件。如果还不存在对应的<quote>OK</quote>文件，将创建它以备后用：
   </para>
<screen>tux@mercury:~&gt; xmltest cim_xml_test.xml
Running test cim_xml_test.xml ... OK
	Saving response as cim_xml_test.OK
tux@mercury:~&gt; xmltest cim_xml_test.xml
Running test cim_xml_test.xml ... Passed</screen>
  </sect2>

  <sect2 id="sec.wbem.advanced.wbemcli">
   <title>命令行 CIM 客户端：wbemcli</title>
   <para>
    除了 <command>wbemcat</command> 和 <command>xmltest</command> 外，SBLIM 项目包含更高级的命令行 CIM 客户端 <command>wbemcli</command>。该客户端用于将 CIM 请求发送到 SFCB 服务器，并显示返回的结果。它独立于 CIMOM 库，可与所有 WBEM 兼容实现一起使用。
   </para>
   <para>
    例如，如果您需要列出注册到您的 SFCB 的 SBLIM 提供程序实现的所有类，则将 <quote>EnumerateClasses</quote> (ec) 请求发送到 SFCB：
   </para>
<screen>tux@mercury:~&gt; wbemcli -dx ec http://localhost/root/cimv2
To server: &lt;?xml version="1.0" encoding="utf-8" ?&gt;
&lt;CIM CIMVERSION="2.0" DTDVERSION="2.0"&gt;
&lt;MESSAGE ID="4711" PROTOCOLVERSION="1.0"&gt;&lt;SIMPLEREQ&gt;&lt;IMETHODCALL \
    NAME="EnumerateClasses"&gt;&lt;LOCALNAMESPACEPATH&gt;&lt;NAMESPACE NAME="root"&gt; \
    &lt;/NAMESPACE&gt;&lt;NAMESPACE NAME="cimv2"&gt;&lt;/NAMESPACE&gt; \
    &lt;/LOCALNAMESPACEPATH&gt;
&lt;IPARAMVALUE NAME="DeepInheritance"&gt;&lt;VALUE&gt;TRUE&lt;/VALUE&gt; \
    &lt;/IPARAMVALUE&gt;
&lt;IPARAMVALUE NAME="LocalOnly"&gt;&lt;VALUE&gt;FALSE&lt;/VALUE&gt;&lt;/IPARAMVALUE&gt;
&lt;IPARAMVALUE NAME="IncludeQualifiers"&gt;&lt;VALUE&gt;FALSE&lt;/VALUE&gt; \
    &lt;/IPARAMVALUE&gt;
&lt;IPARAMVALUE NAME="IncludeClassOrigin"&gt;&lt;VALUE&gt;TRUE&lt;/VALUE&gt; \
    &lt;/IPARAMVALUE&gt;
&lt;/IMETHODCALL&gt;&lt;/SIMPLEREQ&gt;
&lt;/MESSAGE&gt;&lt;/CIM&gt;
From server: Content-Type: application/xml; charset="utf-8"
From server: Content-Length: 337565
From server: Cache-Control: no-cache
From server: CIMOperation: MethodResponse
From server: &lt;?xml version="1.0" encoding="utf-8" ?&gt;
&lt;CIM CIMVERSION="2.0" DTDVERSION="2.0"&gt;
&lt;MESSAGE ID="4711" PROTOCOLVERSION="1.0"&gt;
&lt;SIMPLERSP&gt;
&lt;IMETHODRESPONSE NAME="EnumerateClasses"&gt;
&lt;IRETURNVALUE&gt;
&lt;CLASS NAME="CIM_ResourcePool" SUPERCLASS="CIM_LogicalElement"&gt;
&lt;PROPERTY NAME="Generation" TYPE="uint64"&gt;
&lt;/PROPERTY&gt;
&lt;PROPERTY NAME="ElementName" TYPE="string"&gt;
&lt;/PROPERTY&gt;
&lt;PROPERTY NAME="Description" TYPE="string"&gt;
&lt;/PROPERTY&gt;
&lt;PROPERTY NAME="Caption" TYPE="string"&gt;
&lt;/PROPERTY&gt;
&lt;PROPERTY NAME="InstallDate" TYPE="datetime"&gt;
&lt;/PROPERTY&gt;
[..]
&lt;CLASS NAME="Linux_ReiserFileSystem" SUPERCLASS="CIM_UnixLocalFileSystem"&gt;
&lt;PROPERTY NAME="FSReservedCapacity" TYPE="uint64"&gt;
&lt;/PROPERTY&gt;
&lt;PROPERTY NAME="TotalInodes" TYPE="uint64"&gt;
&lt;/PROPERTY&gt;
&lt;PROPERTY NAME="FreeInodes" TYPE="uint64"&gt;
&lt;/PROPERTY&gt;
&lt;PROPERTY NAME="ResizeIncrement" TYPE="uint64"&gt;
&lt;VALUE&gt;0&lt;/VALUE&gt;
&lt;/PROPERTY&gt;
&lt;PROPERTY NAME="IsFixedSize" TYPE="uint16"&gt;
&lt;VALUE&gt;0&lt;/VALUE&gt;
&lt;/PROPERTY&gt;
[..]</screen>
   <para>
    <option>-dx</option> 选项向您显示 <command>wbemcli</command> 发送到 SFCB 的实际 XML，以及收到的实际 XML。在以上示例中，众多返回类中的第一个就是 <literal>CIM_ResourcePool</literal>，后面是 <literal>Linux_ReiserFileSystem</literal>。类似的条目会对所有其他注册的类显示。
   </para>
   <para>
    如果您省略 <option>-dx</option> 选项，<command>wbemcli</command> 会显示返回数据的简化表示：
   </para>
<screen>tux@mercury:~&gt; wbemcli ec http://localhost/root/cimv2
localhost:5988/root/cimv2:CIM_ResourcePool Generation=,ElementName=, \
    Description=,Caption=,InstallDate=,Name=,OperationalStatus=, \
    StatusDescriptions=,Status=,HealthState=,PrimaryStatus=, \
    DetailedStatus=,OperatingStatus=,CommunicationStatus=,InstanceID=, \
    PoolID=,Primordial=,Capacity=,Reserved=,ResourceType=, \
    OtherResourceType=,ResourceSubType=, \AllocationUnits=
localhost:5988/root/cimv2:Linux_ReiserFileSystem FSReservedCapacity=, \
    TotalInodes=,FreeInodes=,ResizeIncrement=,IsFixedSize=,NumberOfFiles=, \
    OtherPersistenceType=,PersistenceType=,FileSystemType=,ClusterSize=, \
    MaxFileNameLength=,CodeSet=,CasePreserved=,CaseSensitive=, \
    CompressionMethod=,EncryptionMethod=,ReadOnly=,AvailableSpace=, \
    FileSystemSize=,BlockSize=,Root=,Name=,CreationClassName=,CSName=, \
    CSCreationClassName=,Generation=,ElementName=,Description=,Caption=, \
    InstanceID=,InstallDate=,OperationalStatus=,StatusDescriptions=, \
    Status=,HealthState=,PrimaryStatus=,DetailedStatus=,OperatingStatus= \
    ,CommunicationStatus=,EnabledState=,OtherEnabledState=,RequestedState= \
    ,EnabledDefault=,TimeOfLastStateChange=,AvailableRequestedStates=, \
    TransitioningToState=,PercentageSpaceUse=
    [..]</screen>
  </sect2>
 </sect1>
 <sect1 id="sec.wbem.moreinfo">
  <title>更多信息</title>

  <variablelist>
   <title>有关 WBEM 和 SFCB 的细节，请参见以下来源：</title>
   <varlistentry>
    <term><ulink url="http://www.dmtf.org">http://www.dmtf.org</ulink>
    </term>
    <listitem>
     <para>
      Distributed Management Task Force 网站
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><ulink url="http://www.dmtf.org/standards/wbem/">http://www.dmtf.org/standards/wbem/</ulink>
    </term>
    <listitem>
     <para>
      Web-Based Enterprise Management (WBEM) 网站
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><ulink url="http://www.dmtf.org/standards/cim/">http://www.dmtf.org/standards/cim/</ulink>
    </term>
    <listitem>
     <para>
      通用信息模型 (CIM) 网站
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><ulink url="http://sblim.wiki.sourceforge.net/">http://sblim.wiki.sourceforge.net/</ulink>
    </term>
    <listitem>
     <para>
      Standards Based Linux Instrumentation (SBLIM) 网站
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><ulink url="http://sblim.wiki.sourceforge.net/Sfcb">http://sblim.wiki.sourceforge.net/Sfcb</ulink>
    </term>
    <listitem>
     <para>
      小规模 CIM 中介程序 (SFCB) 网站
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><ulink url="http://sblim.wiki.sourceforge.net/Providers">http://sblim.wiki.sourceforge.net/Providers</ulink>
    </term>
    <listitem>
     <para>
      SBLIM 提供程序包
     </para>
    </listitem>
   </varlistentry>
  </variablelist>
 </sect1>
</chapter>
