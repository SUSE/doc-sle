<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="printing.xml" version="5.0" xml:id="cha-print"> <title>印表機操作</title>
 <info>
      <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
        <dm:bugtracker/>
        <dm:translation>yes</dm:translation>
      </dm:docmanager>
    </info>
    <para>
  <phrase role="productname"><phrase os="sles">SUSE® Linux Enterprise Server</phrase></phrase> 支援以多種類型的印表機進行列印，包括遠端網路印表機。您可以手動設定印表機，也可以使用 YaST 進行設定。如需組態設定指示，請參閱<xref linkend="sec-yast-hw-print"/>。圖形和指令行公用程式都可用來啟動和管理列印工作。如果您的印表機無法如預期般運作，請參閱<xref linkend="sec-print-prob"/>。
 </para>
 <para>
  CUPS (Common Unix Printing System，通用 UNIX 列印系統) 是 <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> 中的標準列印系統。
 </para>
 <para>
  印表機可藉由介面 (例如 USB 或網路) 和印表機語言加以區分。在購買印表機時，請確認硬體可支援印表機的介面，並且印表機採用適合的語言。印表機可根據下列三種印表機語言來分類：
 </para>
 <variablelist>
  <varlistentry>
   <term>PostScript 印表機</term>
   <listitem>
    <para>
     Linux 和 Unix 內部列印系統以 PostScript 印表機語言產生和處理大部分列印工作。如果印表機可直接處理 PostScript 文件，且不需轉換到列印系統中其他階段，潛在錯誤來源的次數便會減少。
    </para>
    <para>
     目前，PostScript 正逐漸被 PDF 取代，後者成為標準列印工作格式。可直接列印 PDF (而不是僅僅是 PostScript) 的 PostScript+PDF 印表機已面世。對於傳統的 PostScript 印表機，需要在列印工作流程中將 PDF 轉換為 PostScript。
    </para>
   </listitem>
  </varlistentry>
  <varlistentry>
   <term>標準印表機 (PCL 和 ESC/P 等語言)</term>
   <listitem>
    <para>
     如果已知印表機語言，列印系統可以藉由 Ghostscript 將 PostScript 工作轉換為對應的印表機語言。此處理階段稱為解釋。最知名的語言是大多數 HP 印表機與類似產品使用的 PCL，以及 Epson 印表機使用的 ESC/P。這些印表機語言通常都受 Linux 支援，並可產生不錯的列印效果。Linux 可能無法提供一些特殊的印表機功能。除了 HP 和 Epson 之外，目前尚沒有其他印表機廠商開發 Linux 驅動程式，並透過開放原始碼授權將這些驅動程式提供給 Linux 套裝作業系統供應商。
    </para>
   </listitem>
  </varlistentry>
  <varlistentry xml:id="sec-print-prep-gdi">
   <term>專屬印表機 (也稱為 GDI 印表機)</term>
   <listitem>
    <para>
     這些印表機並不支援任何一般的印表機語言。它們使用自己的印表機語言，而當有新型號發行，那些語言也可能有所變更。這些印表機通常指有 Windows 驅動程式。如需詳細資訊，請參閱<xref linkend="sec-print-gdi"/>。
    </para>
   </listitem>
  </varlistentry>
 </variablelist>
 <para>
  在購買新印表機之前，請參考下列來源以檢查您想要購買的印表機之支援性：
 </para>
 <variablelist>
  <varlistentry>
   <term><link xlink:href="http://www.openprinting.org/printers"/>
   </term>
   <listitem>
    <para>
     OpenPrinting 首頁，含印表機資料庫。資料庫會顯示最新的 Linux 支援狀態。但是，Linux 版本僅可與生產期間可用的驅動程式整合。因此，目前被評選為<quote>完全支援</quote>的印表機，在最新的 <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> 版本發行之後，可能將失去此稱號。因此，資料庫不一定能指出正確狀態，而僅提供估計值。
    </para>
   </listitem>
  </varlistentry>
  <varlistentry>
   <term><link xlink:href="http://pages.cs.wisc.edu/~ghost/"/>
   </term>
   <listitem>
    <para>
     Ghostscript 網頁。
    </para>
   </listitem>
  </varlistentry>
  <varlistentry>
   <term><filename>/usr/share/doc/packages/ghostscript/catalog.devices</filename>
   </term>
   <listitem>
    <para>
     內建 Ghostscript 驅動程式清單
    </para>
   </listitem>
  </varlistentry>
 </variablelist>
 <sect1 xml:id="sec-print-workflow">
  <title>CUPS 工作流程</title>

  <para>
   使用者會建立列印工作。列印工作由要列印的資料和有關線上同時週邊作業器的資訊組成。其中包括印表機的名稱或列印佇列的名稱，還有可能包括有關過濾器 (例如印表機特定的選項) 的資訊。
  </para>

  <para>
   每一台印表機都至少有一個專屬的列印佇列。線上同時週邊作業器會在佇列中列印工作，直到所需的印表機已準備好接收資料。當印表機備妥時，線上同時週邊作業器會透過過濾器與後端，傳送資料至印表機。
  </para>

  <para>
   過濾器會將列印應用程式所產生的資料 (通常為 PostScript 或 PDF，但也會有 ASCII、JPEG 等) 轉換為印表機特定資料 (PostScript、PCL、ESC/P 等)。印表機的特性描述在 PPD 檔案中。PPD 檔案含有印表機特定選項以及在印表機上啟用它們所需的參數。過濾器系統可確保啟用使用者所選取的選項。
  </para>

  <para>
   如果您是使用 PostScript 印表機，過濾器系統會將資料轉換為印表機特定的 PostScript。這並不需要印表機驅動程式。如果您使用非 PostScript 印表機，過濾器系統會將資料轉換為印表機特定資料。這將需要印表機適用的印表機驅動程式。後端會從過濾器接收印表機特定的資料，然後將它傳送至印表機。
  </para>
 </sect1>
 <sect1 xml:id="sec-print-method">
  <title>連接印表機的方法和通訊協定</title>

  <para>
   有各種方法可將印表機連接到系統。CUPS 的組態無法辨識本地印表機與透過網路連接到系統的印表機。如需有關印表機連線的詳細資訊，請參閱 <link xlink:href="https://en.opensuse.org/SDB:CUPS_in_a_Nutshell"/> 上的文章 <emphasis>CUPS in a Nutshell</emphasis> (CUPS 概述)。
  </para>

  <para arch="zseries" os="sles">
   CUPS 不支援 z/VM 所提供且本地連接到 IBM Z 大型主機的印表機和類似裝置。在這些平台上，僅可透過網路列印。網路印表機的電纜必須根據印表機廠商的說明來安裝。
  </para>

  <warning>
   <title>變更執行中系統的電纜連接</title>
   <para>
    在將印表機連接到機器時，請不要忘記只有 USB 裝置可在操作中插上和拔除。若要避免損壞您的系統或印表機，請先關機再變更任何非 USB 的連接。
   </para>
  </warning>
 </sect1>
 <sect1 xml:id="sec-print-software">
  <title>安裝軟體</title>

  <para>
   PPD (PostScript 印表機描述) 為描述內容 (如解析度) 和選項 (如雙面列印模組的可用性) 的電腦語言。這些描述是使用 CUPS 中各種印表機選項所需。沒有 PPD 檔案，列印資料會被轉送給處於 <quote>raw</quote> 狀態的印表機，這通常不是想要的狀態。
  </para>

  <para>
   若要設定 PostScript 印表機，最好的方法是取得適當的 PPD 檔。<systemitem>manufacturer-PPDs</systemitem> 與 <systemitem>OpenPrintingPPDs-postscript</systemitem> 套件中提供了許多 PPD 檔案。請參閱<xref linkend="sec-print-special-ppd"/>和<xref linkend="sec-print-prob-ppd"/>。
  </para>

  <para>
   新的 PPD 檔案可儲存在 <filename>/usr/share/cups/model/</filename> 目錄中，或依照<xref linkend="sec-yast-hw-print-local-get-ppd"/>中所述透過 YaST 新增到列印系統中。之後，便可在印表機設定期間選取該 PPD 檔案。
  </para>

  <para>
   如果印表機廠商要求您安裝整個軟體套件，請謹慎處理。這種安裝類型可能導致 <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> 提供的支援失效。另外，列印指令可能會以不同的方式運作，並且系統可能不再能夠對其他廠商的裝置定址。基於此原因，不建議安裝廠商軟體。
  </para>
 </sect1>
 <sect1 xml:id="sec-print-net">
  <title>網路印表機</title>

  <para>
   網路印表機可支援各種通訊協定，有些甚至可同時支援。雖然大部分受支援的通訊協定已標準化，但有一些廠商還是會修改標準。這樣，廠商只會針對一部分作業系統提供驅動程式。不幸地，他們很少提供 Linux 驅動程式。目前的情況是，您無法以每一個通訊協定均能在 Linux 中順暢執行的假設來行事。因此，您可能需要試驗各種選項以實現功能性組態。
  </para>



  <para>
   CUPS 支援 <systemitem>socket</systemitem>、<systemitem>LPD</systemitem>、<systemitem>IPP</systemitem> 和 <systemitem>smb</systemitem> 通訊協定。
  </para>

  <variablelist>
   <varlistentry>
    <term>socket</term>
    <listitem>
     <para>
      <emphasis>socket</emphasis> 指將純文字列印資料直接傳送到 TCP 通訊端的連接。經常使用的幾個 socket 連接埠號碼為 <option>9100</option> 或 <option>35</option>。裝置 URI (資源識別字串) 的語法為 socket://<replaceable>IP.OF.THE.PRINTER</replaceable>:<replaceable>PORT</replaceable>，例如 <systemitem>socket://192.168.2.202:9100/</systemitem>。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>LPD (行列式印表機精靈，Line Printer Daemon)</term>
    <listitem>
     <para>
      RFC 1179 中有對 LPD 通訊協定的詳細介紹。在此通訊協定下，部分工作相關資料 (如列印佇列的 ID) 會先於實際列印的資料傳送。因此，在設定 LPD 通訊協定時，必須指定列印佇列。雖然各家印表機廠商不同，但其實作方式足以靈活地接受任何名稱做為列印佇列。如有需要，印表機手冊應該會指出要使用的名稱。通常使用 LPT、LPT1、LP1 或類似名稱。LPD 服務的連接埠號碼為 <option>515</option>。裝置 URI 的範例為 <systemitem>lpd://192.168.2.202/LPT1</systemitem>。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>IPP (網際網路列印通訊協定，Internet printing protocol)</term>
    <listitem>
     <para>
      IPP 基於 HTTP 通訊協定。有了 IPP，可比使用其他通訊協定傳輸更多工作相關資料。CUPS 使用 IPP 進行內部資料傳輸。正確設定 IPP 必須要有列印佇列的名稱。IPP 的連接埠號碼為 <literal>631</literal>。裝置 URI 的範例為 <systemitem>ipp://192.168.2.202/ps</systemitem> 和 <systemitem>ipp://192.168.2.202/printers/ps</systemitem>。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>SMB (Windows 共用)</term>
    <listitem>
     <para>
      CUPS 也支援在連接到 Windows 共用的印表機上列印。此用途使用的通訊協定為 SMB。SMB 使用的埠號有 <option>137</option>、<option>138</option> 和 <option>139</option>。裝置 URI 的範例為 <systemitem>smb://user:password@workgroup/smb.example.com/printer</systemitem>、<systemitem>smb://user:password@smb.example.com/printer</systemitem> 和 <systemitem>smb://smb.example.com/printer</systemitem>。
     </para>
    </listitem>
   </varlistentry>
  </variablelist>

  <para>
   必須在設定組態之前決定印表機支援的通訊協定。如果廠商未提供所需資訊，可使用 <command>nmap</command> 指令 (隨附於 <systemitem>nmap</systemitem> 套件) 來確定通訊協定。<command>nmap</command> 會檢查主機上是否有開啟的連接埠。例如：
  </para>

<screen><prompt>tux &gt; </prompt>nmap -p 35,137-139,515,631,9100-10000 <replaceable>IP.OF.THE.PRINTER</replaceable></screen>
 </sect1>
 <sect1 xml:id="sec-print-net-config-cmdl">
  <title>使用指令行工具設定 CUPS</title>

  <para>
   CUPS 可透過 <command>lpinfo</command>、<command>lpadmin</command> 與 <command>lpoptions</command> 等指令行工具來設定。您需要一個裝置 URI，其中包含後端 (如 USB 和參數)。若要判斷系統中的裝置 URI 是否有效，請使用以下 <command>lpinfo -v | grep ":/"</command> 指令：
  </para>

<screen><prompt>tux &gt; </prompt><command>sudo</command> lpinfo -v | grep ":/"
direct usb://ACME/FunPrinter%20XL
network socket://192.168.2.253</screen>

  <para>
   使用 <command>lpadmin</command>，CUPS 伺服器管理員可新增、移除或管理列印佇列。若要新增印表機佇列，請使用下列語法：
  </para>

<screen><prompt>tux &gt; </prompt><command>sudo</command> lpadmin -p <replaceable>QUEUE</replaceable> -v <replaceable>DEVICE-URI</replaceable> -P <replaceable>PPD-FILE</replaceable> -E</screen>

  <para>
   裝置 (<option>-v</option>) 便會以 <replaceable>QUEUE</replaceable> (<option>-p</option>) 的形式供您使用，並使用指定的 PPD 檔案 (<option>-P</option>)。這表示如果要手動設定印表機，您必須知道 PPD 檔案以及裝置 URI。
  </para>

  <para>
   請勿使用 <option>-E</option> 做為第一選項。對於所有 CUPS 指令，第一個引數 <option>-E</option> 設定使用加密連接。若要啟用印表機，必須依照下列範例所示使用 <option>-E</option>：
  </para>

<screen><prompt>tux &gt; </prompt><command>sudo</command> lpadmin -p ps -v usb://ACME/FunPrinter%20XL -P \
/usr/share/cups/model/Postscript.ppd.gz -E</screen>

  <para>
   下列範例是設定網路印表機：
  </para>

<screen><prompt>tux &gt; </prompt><command>sudo</command> lpadmin -p ps -v socket://192.168.2.202:9100/ -P \
/usr/share/cups/model/Postscript-level1.ppd.gz -E</screen>

  <para>
   如需 <command>lpadmin</command> 的更多選項，請參閱 <systemitem>lpadmin(8)</systemitem> 的 man 頁面。
  </para>

  <para>
   在印表機設定期間，某些選項會設成預設。可針對每一個列印工作修改這些選項 (視所使用的列印工具而定)。也可以使用 YaST 變更這些預設選項。使用指令行工具，可依下列方式設定預設選項：
  </para>

  <procedure>
   <step>
    <para>
     首先，列出所有選項：
    </para>
<screen><prompt>tux &gt; </prompt><command>sudo</command> lpoptions -p <replaceable>QUEUE</replaceable> -l</screen>
    <para>
     範例:
    </para>
<screen>Resolution/Output Resolution: 150dpi *300dpi 600dpi</screen>
    <para>
     啟用的預設選項前面會加上星號 (<literal>*</literal>)，用以識別。
    </para>
   </step>
   <step>
    <para>
     以 <command>lpadmin</command> 變更選項：
    </para>
<screen><prompt>tux &gt; </prompt><command>sudo</command> lpadmin -p <replaceable>QUEUE</replaceable> -o Resolution=600dpi</screen>
   </step>
   <step>
    <para>
     檢查新設定：
    </para>
<screen><prompt>tux &gt; </prompt><command>sudo</command> lpoptions -p <replaceable>QUEUE</replaceable> -l

Resolution/Output Resolution: 150dpi 300dpi *600dpi</screen>
   </step>
  </procedure>

  <para>
   當一般使用者執行 <command>lpoptions</command> 時，設定會寫入 <filename>~/.cups/lpoptions</filename>。然而，<systemitem class="username">root</systemitem> 設定會會寫至 <filename>/etc/cups/lpoptions</filename>。
  </para>
 </sect1>
 <sect1 xml:id="sec-print-appl-commandline">
  <title>從指令行列印</title>

  <para>
   若要從指令行列印，請輸入 <command>lp -d</command>
   <replaceable>QUEUENAME</replaceable> <replaceable>FILENAME</replaceable>，並以相應的名稱取代 <replaceable>QUEUENAME</replaceable> 和 <replaceable>FILENAME</replaceable>。
  </para>

  <para>
   有些應用程式有賴 <command>lp</command> 指令來進行列印。在此情況下，請在應用程式的列印對話方塊中輸入正確的指令 (通常無需指定 <replaceable>FILENAME</replaceable>)，例如 <command>lp -d </command> <replaceable>QUEUENAME</replaceable>。
  </para>
 </sect1>
 <sect1 xml:id="sec-print-special">
  <title><phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> 中的特殊功能</title>

  <para>
   部分 CUPS 功能已針對 <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> 做出調整。此處涵蓋部份最重要的變更。
  </para>

  <sect2 xml:id="sec-print-special-cupsfire">
   <title>CUPS 和防火牆</title>
   <para>
    完成 <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> 的預設安裝後，<systemitem class="daemon">firewalld</systemitem> 將處於使用中狀態，並且網路介面設定為位於 <literal>public</literal> 區域中，這會阻擋內送流量。 
</para>
   <para>
       當 <systemitem class="daemon">firewalld</systemitem> 處於使用中狀態時，您可能需要將 firewalld 設定為允許用戶端瀏覽網路印表機，方法是允許 <literal>mdns</literal> 和 <literal>ipp</literal> 通過內部網路區域。公用區域應該永不公開印表機佇列。 
   </para>
   <para>
    (<xref linkend="sec-security-firewall-firewalld"/>中和 <link xlink:href="https://en.opensuse.org/SDB:CUPS_and_SANE_Firewall_settings"/> 上提供了有關 <systemitem class="daemon">firewalld</systemitem> 組態的詳細資訊。)
   </para>
   <sect3 xml:id="sec-print-special-cupsfire-client">
    <title>CUPS 用戶端</title>
    <para>
     CUPS 用戶端通常在位於防火牆之後的受信任網路環境中的一般工作站上執行。在此情況下，建議將網路介面設定為處於「<literal>內部區域</literal>」中，以便可從該網路中存取工作站。
    </para>
   </sect3>
   <sect3 xml:id="sec-print-special-cupsfire-server">
    <title>CUPS 伺服器</title>
    <para>
     如果 CUPS 伺服器位於受防火牆保護的受信任網路環境中，則應將網路介面設定為處於防火牆的「<literal>內部區域</literal>」中。建議不要在不可信網路環境中設定 CUPS 伺服器，除非您確定該伺服器受到特殊防火牆規則和 CUPS 組態中的安全設定的保護。
    </para>
   </sect3>
  </sect2>

  <sect2 xml:id="sec-print-special-browsing">
   <title>瀏覽網路印表機</title>
   <para>
    CUPS 伺服器會定期宣告透過網路共用之印表機的可用性及狀態資訊。用戶端可以存取此資訊，以便在列印對話方塊之類的地方顯示可用印表機清單。這稱為<quote>「瀏覽」</quote>。
   </para>
   <para>
    CUPS 伺服器透過傳統的 CUPS 瀏覽協定或 Bonjour/DNS-SD 通告其在網路上的列印佇列。為了能夠瀏覽網路列印佇列，需要在透過 CUPS 伺服器列印的所有用戶端上執行 <systemitem class="daemon">cups-browsed</systemitem> 服務。預設不會啟動 <systemitem class="daemon">cups-browsed</systemitem>。若要為使用中的工作階段啟動該服務，請使用 <command>sudo systemctl start cups-browsed</command>。若要確保它在開機後會自動啟動，請在所有用戶端上透過 <command>sudo systemctl enable cups-browsed</command> 予以啟用。
   </para>
   <para>
    如果在啟動 <systemitem class="daemon">cups-browsed</systemitem> 後瀏覽無法運作，則表明 CUPS 伺服器可能是透過 Bonjour/DNS-SD 通告網路列印佇列。在這種情況下，您需要另外安裝套件 <systemitem class="resource">avahi</systemitem>，然後在所有用戶端上透過 <command>sudo systemctl start avahi-daemon</command> 啟動相關聯的服務。
   </para>
   <para>
       如需如何透過 <systemitem class="daemon">firewalld</systemitem> 允許瀏覽印表機的資訊，請參閱<xref linkend="sec-print-special-cupsfire"/>。
   </para>
  </sect2>

  <sect2 xml:id="sec-print-special-ppd">
   <title>各個套件中的 PPD 檔案</title>
   <para>
    YaST 印表機組態使用安裝於 <filename>/usr/share/cups/model/</filename> 中的 PPD 檔案來設定 CUPS 的佇列。為了尋找適合印表機型號的 PPD 檔案，YaST 會對照硬體偵測期間確定的廠商和型號比較所有 PPD 檔案內的廠商和型號。基於此原因，YaST 印表機組態將從 PPD 檔案中取出的廠商和型號資訊產生資料庫。
   </para>
   <para>
    僅使用 PPD 檔案且不使用其他資訊來源的組態，好處在於 <filename>/usr/share/cups/model/</filename> 中的 PPD 檔案可自由修改。例如，如果您擁有 PostScript 印表機，可直接將 PPD 檔案複製到 <filename>/usr/share/cups/model</filename> (如果這些檔案尚不存在於 <systemitem>manufacturer-PPDs</systemitem> 或 <systemitem>OpenPrintingPPDs-postscript</systemitem> 套件中)，以取得印表機的最佳組態。
   </para>
   <para>
    其他 PPD 檔案由下列套件提供：
   </para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>
      <systemitem>gutenprint</systemitem>：Gutenprint 驅動程式及其相符的 PPD
     </para>
    </listitem>
    <listitem>
     <para>
      <systemitem>splix</systemitem>：SpliX 驅動程式及其相符的 PPD
     </para>
    </listitem>
    <listitem>
     <para>
      <systemitem>OpenPrintingPPDs-ghostscript</systemitem>：Ghostscript 內建驅動程式的 PPD
     </para>
    </listitem>
    <listitem>
     <para>
      <systemitem>OpenPrintingPPDs-hpijs</systemitem>：適用於非 HP 印表機之 HPIJS 驅動程式的 PPD
     </para>
    </listitem>
   </itemizedlist>
  </sect2>
 </sect1>
 <sect1 xml:id="sec-print-prob">
  <title>疑難排解</title>

  <para>
   下列章節涵蓋印表機硬體和軟體最常遭遇的問題，以及解決或避免這些問題的方式。涵蓋的主題包括 GDI 印表機、PPD 檔案和連接埠組態，並討論了一般網路印表機問題、列印瑕疵、佇列處理。
  </para>

  <sect2 xml:id="sec-print-gdi">
   <title>不支援標準印表機語言的印表機</title>
   <para>
    這些印表機不支援任何的一般印表機語言，且只有特殊的專屬控制序列才能處理。因此它們僅可在製造廠商針對其開發驅動程式的作業系統版本上使用。GDI 是 Microsoft* 為繪圖裝置所開發的程式設計介面。製造廠商通常只提供 Windows 適用的驅動程式，而由於 Windows 驅動程式使用 GDI 介面，因此這些印表機也稱為 <emphasis>GDI 印表機</emphasis>。問題實際並不是出在程式設計介面上，而是因這些印表機只能透過相應印表機型號的專用印表機語言來定址所造成。
   </para>
   <para>
    部分 GDI 印表機可切換到 GDI 模式或某種標準印表機語言來操作。如果手邊有印表機手冊，可以參閱其中內容。某些型號需要特殊的 Windows 軟體才能進行切換 (請注意，從 Windows 列印時，Windows 印表機驅動程式可能都會將印表機切換回 GDI 模式)。對於其他 GDI 印表機，則可以使用標準印表機語言的延伸模組。
   </para>
   <para>
    部分製造廠商提供其 印表機的專用驅動程式。專用印表機驅動程式的壞處在於，其不保證可與安裝的列印系統配合使用，也不保證適用於各種硬體平台。相反的，支援標準印表機語言的印表機不需依賴特殊的列印系統版本或特殊硬體平台。
   </para>
   <para>
    與其費時費力研究如何讓專用 Linux 驅動程式運作，購買一台支援標準印表機語言 (最好是 PostScript) 的印表機可能更符合成本效益。這樣可一次解決所有驅動程式問題、減少安裝與設定特殊驅動程式軟體以及取得列印系統中新開發所需之驅動程式更新的需要。
   </para>
  </sect2>

  <sect2 xml:id="sec-print-prob-ppd">
   <title>PostScript 印表機沒有合適的可用 PPD 檔案</title>
   <para>
    如果 <systemitem>manufacturer-PPDs</systemitem> 或 <systemitem>OpenPrintingPPDs-postscript</systemitem> 套件不包含適用於 PostScript 印表機的 PPD 檔案，通常可以使用印表機廠商提供的驅動程式 CD 中的 PPD 檔案，或從印表機廠商的網頁下載適合的 PPD 檔案。
   </para>
   <para>
    如果 PPD 檔案以壓縮保存檔 (.zip) 或自解壓縮保存檔 (<filename>.exe</filename>) 形式提供，請以 <command>unzip</command> 解壓縮。首先，檢閱 PPD 檔案的授權條款。然後，請使用 <command>cupstestppd</command> 公用程式來檢查 PPD fi檔案是否符合 <quote>Adobe PostScript Printer Description File Format Specification, version 4.3</quote> (Adobe PostScript 印表機說明檔案格式規格，版本 4.3)。如果公用程式傳回 <quote>FAIL</quote>，就表示 PPD 檔案非常嚴重，可能造成重大問題。應該要減少 <command>cupstestppd</command> 所報告的問題點。若有需要，請詢問印表機製造廠商以取得適合的 PPD 檔案。
   </para>
  </sect2>

  <sect2 xml:id="sec-print-prob-netconnect">
   <title>網路印表機連接</title>
   <para/>
   <variablelist>
    <varlistentry>
     <term>確定網路問題</term>
     <listitem>
      <para>
       將印表機直接連接到電腦。基於測試因素，請將印表機設為本地印表機。如果可以，問題便與網路相關。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>檢查 TCP/IP 網路</term>
     <listitem>
      <para>
       TCP/IP 網路和名稱解析必須可作用。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>檢查遠端 <command>lpd</command>
     </term>
     <listitem>
      <para>
       使用以下指令測試是否可以與 <replaceable>Host</replaceable> 上的 <literal>lpd</literal> (連接埠 <command>515</command>) 建立 TCP 連接：
      </para>
<screen><prompt>tux &gt; </prompt>netcat -z <replaceable>HOST</replaceable> 515 &amp;&amp; echo ok || echo failed</screen>
      <para>
       如果無法建立到 <command>lpd</command> 的連接，可能是 <command>lpd</command> 不在作用中，或是有基本網路問題。
      </para>
      <para>
       如果相應的 <command>lpd</command> 處於使用中狀態，並且主機接受查詢，請以 <systemitem class="username">root</systemitem> 身分執行以下指令，以查詢遠端 <replaceable>HOST</replaceable> 上 <replaceable>QUEUE</replaceable> 的狀態報告：
      </para>
<screen><prompt role="root">root # </prompt>echo -e "\004queue" \
| netcat -w 2 -p 722 <replaceable>HOST</replaceable> 515</screen>
      <para>
       如果 <command>lpd</command> 沒有回應，它可能不在作用中，或是有基本網路問題。如果 <command>lpd</command> 有回應，回應應該會顯示<literal>主機</literal>上的<literal>佇列</literal>為何無法列印。如果您收到類似<xref linkend="aus-d-lpd"/> 中的回應，問題可能是由遠端 <command>lpd</command> 所造成的。
      </para>
      <example xml:id="aus-d-lpd">
       <title>來自 <command>lpd</command> 的錯誤訊息</title>
<screen>lpd: your host does not have line printer access
lpd: queue does not exist
printer: spooling disabled
printer: printing disabled</screen>
      </example>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>檢查遠端 <command>cupsd</command>
     </term>
     <listitem>
      <para>
       CUPS 網路伺服器預設每 30 秒在 UDP 連接埠 <literal>631</literal> 上廣播一次其佇列。因而可以使用下面的指令來測試網路中是否有廣播 CUPS 網路伺服器。請確定在執行指令之前停止本地 CUPS 精靈。
      </para>
<screen><prompt>tux &gt; </prompt>netcat -u -l -p 631 &amp; PID=$! ; sleep 40 ; kill $PID</screen>
      <para>
       如果廣播 CUPS 網路伺服器存在，輸出將如 <xref linkend="aus-d-bcast"/> 中所示。
      </para>
      <example xml:id="aus-d-bcast">
       <title>來自 CUPS 網路伺服器的廣播</title>
<screen>ipp://192.168.2.202:631/printers/queue</screen>
      </example>
      <para arch="zseries" os="sles">
       請注意，IBM Z 乙太網路裝置預設不接收廣播。
      </para>
      <para>
       以下指令可用於測試是否可以與 <replaceable>HOST</replaceable> 上的 <command>cupsd</command> (連接埠 <literal>631</literal>) 建立 TCP 連接：
      </para>
<screen><prompt>tux &gt; </prompt>netcat -z <replaceable>HOST</replaceable> 631 &amp;&amp; echo ok || echo failed</screen>
      <para>
       如果無法建立到 <command>cupsd</command> 的連線，可能是 <command>cupsd</command> 不在作用中，或是有基本網路問題。<command>lpstat -h</command> <replaceable>HOST</replaceable> -l -t 會傳回 <replaceable>HOST</replaceable> 上所有佇列的狀態報告 (可能很長)，前提是相應的 <command>cupsd</command> 處於作用中狀態並且主機接受查詢。
      </para>
      <para>
       下面的指令可用於測試 <replaceable>HOST</replaceable> 上的 <replaceable>QUEUE</replaceable> 是否接受由單一換行字元組成的列印工作。應該不會印出任何資料。可能會退出一張空白頁。
      </para>
<screen><prompt>tux &gt; </prompt>echo -en "\r" \
| lp -d queue -h <replaceable>HOST</replaceable></screen>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>
      對網路印表機或列印伺服器機器進行疑難排解
     </term>
     <listitem>
      <para>
       有時，在列印伺服器機器中執行的線上同時週邊作業器在處理多項列印工作時會產生問題。這是列印伺服器機器中的線上同時週邊作業器造成的，目前尚無法解決此問題。因應措施是，直接透過 TCP 通訊端對連接到列印伺服器機器的印表機進行定址，以繞過列印伺服器機器中的線上同時週邊作業器。請參閱<xref linkend="sec-print-net"/>。
      </para>
      <para>
       如此，列印伺服器機器僅充當各種不同資料傳輸方式之間 (TCP/IP 網路和本地印表機連接) 的轉換器。若要使用此方法，您需要知道列印伺服器機器上的 TCP 連接埠。如果印表機連接到列印伺服器機器且已啟動，則通常可以在開啟列印伺服器機器電源一段時間後，使用 <command>nmap</command> 套件中的 <systemitem>nmap</systemitem> 公用程式確定此 TCP 連接埠。例如，<command>nmap </command> <replaceable>IP-address</replaceable> 可能會傳送列印伺服器機器的以下輸出：
      </para>
<screen>Port       State       Service
23/tcp     open        telnet
80/tcp     open        http
515/tcp    open        printer
631/tcp    open        cups
9100/tcp   open        jetdirect</screen>
      <para>
       此輸出表示，可以在連接埠 <literal>9100</literal> 上透過 TCP 通訊端對連接到列印伺服器機器的印表機定址。根據預設，<command>nmap</command> 僅會檢查 <filename>/usr/share/nmap/nmap-services</filename> 中所列出之一般熟知的幾個連接埠。若要檢查所有可能的連接埠，請使用指令 <command>nmap -p </command>
       <replaceable>FROM_PORT</replaceable>-<replaceable>TO_PORT</replaceable> <replaceable>IP_ADDRESS</replaceable>。這可能會花費一些時間。如需詳細資訊，請參閱 <command>nmap</command> 的 man 頁面。
      </para>
      <para>
       輸入以下指令
      </para>
<screen><prompt>tux &gt; </prompt>echo -en "\rHello\r\f" | netcat -w 1 IP-address port
cat file | netcat -w 1 IP-address port</screen>
      <para>
       將字元字串或檔案直接傳送到對應連接埠以測試印表機是否可在此連接埠上定址。
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
  </sect2>

  <sect2 xml:id="sec-print-prob-defective-printouts">
   <title>列印成品有瑕疵但不顯示錯誤訊息</title>
   <para>
    對列印系統而言，在 CUPS 後端完成資料至接收者 (印表機) 的資料傳輸時，列印工作便完成。如果接收者的進一步處理失敗 (例如，印表機無法列印印表機特定資料)，列印系統並不知道。如果印表機無法列印印表機特定資料，請選取更適合印表機的 PPD 檔案。
   </para>
  </sect2>

  <sect2 xml:id="sec-print-prob-disabled-queues">
   <title>停用的佇列</title>
   <para>
    如果到接收者的資料傳輸在數次嘗試之後完全失敗，CUPS 後端 (如 <literal>USB</literal> 或 <literal>socket</literal>) 會向列印系統報告錯誤 (向 <command>cupsd</command>)。在報告資料傳輸失敗之前，允許失敗嘗試的次數，由後端決定。因為進一步的嘗試可能徒勞無功，<command>cupsd</command> 會停止對應佇列的列印。排除問題的起因之後，系統管理員必須以指令 <command>cupsenable</command> 重新啟動列印。
   </para>
  </sect2>

  <sect2 xml:id="sec-print-prob-deleting-jobs">
   <title>CUPS 瀏覽：刪除列印工作</title>
   <para>
    如果 CUPS 網路伺服器透過瀏覽向用戶端主機廣播它的佇列，而且在用戶端主機上有適合的本地 <command>cupsd</command> 在作用中，用戶端 <command>cupsd</command> 會從應用程式接收列印工作，並將它們轉送給伺服器上的 <command>cupsd</command>。當伺服器上的 <command>cupsd</command> 接受列印工作時，系統會為其指定一個新工作號碼。因此，用戶端主機上的工作號碼和伺服器上的工作號碼不同。列印工作通常會立刻轉遞，所以無法以用戶端主機上的工作編號來刪除，因為用戶端 <command>cupsd</command> 將列印工作轉遞給伺服器 <command>cupsd</command> 後，便認為列印工作已完成。
   </para>
   <para>
    若要刪除伺服器上的列印工作，請使用 <command>lpstat -h cups.example.com -o</command> 之類的指令來確定伺服器上的工作編號。此情況假設伺服器尚未完成該列印工作 (即尚未完全將它傳送到印表機)。以如下方式使用獲得的工作編號來刪除伺服器上的列印工作：
   </para>
<screen><prompt>tux &gt; </prompt>cancel -h cups.example.com <replaceable>QUEUE-JOBNUMBER</replaceable></screen>
  </sect2>

  <sect2 xml:id="sec-print-prob-brokenjobs">
   <title>不良列印工作和資料傳輸錯誤</title>
   <para>
    如果您在列印過程中關閉印表機或電腦，列印工作將保留在佇列中。一旦電腦 (或印表機) 重新開啟，列印工作將繼續進行。必須以 <command>cancel</command> 將損毀的列印工作從佇列中移除。
   </para>
   <para>
    如果列印工作損毀，或主機與印表機之間的通訊發生錯誤，印表機將無法正確處理資料，並列印出許多含有不明字元的紙張。若要修復該問題，請執行以下步驟：
   </para>
   <procedure>
    <step>
     <para>
      若要停止列印，請從噴墨印表機取出所有紙張，或是打開雷射印表機的紙匣。高品質的印表機會有按鈕可取消目前的列印成品。
     </para>
    </step>
    <step>
     <para>
      列印工作可能仍在佇列中，因為只有將工作完全傳送到印表機之後，才會移除。使用 <command>lpstat -o</command> 或 <command>lpstat -h cups.example.com -o</command> 檢查目前正在列印的佇列。使用 <command>cancel</command>
      <replaceable>QUEUE</replaceable>-<replaceable>JOBNUMBER</replaceable> 或 <command>cancel -h cups.example.com</command>
      <replaceable>QUEUE</replaceable>-<replaceable>JOBNUMBER</replaceable> 刪除列印工作。
     </para>
    </step>
    <step>
     <para>
      即使列印工作已從佇列刪除，部份資料可能仍會傳送到印表機。請檢查對應佇列的 CUPS 後端程序是否仍在執行中，並將它終止。
     </para>
    </step>
    <step>
     <para>
      將印表機關閉一段時間以完全重設印表機。然後裝入紙張並開啟印表機電源。
     </para>
    </step>
   </procedure>
  </sect2>

  <sect2 xml:id="sec-print-prob-debugging">
   <title>CUPS 除錯</title>
   <para>
    使用以下標準程序找出 CUPS 中的問題：
   </para>
   <procedure>
    <step>
     <para>
      設定 <filename>/etc/cups/cupsd.conf</filename> 中的 <command>LogLevel debug</command>。
     </para>
    </step>
    <step>
     <para>
      停止 <command>cupsd</command>。
     </para>
    </step>
    <step>
     <para>
      移除 <filename>/var/log/cups/error_log*</filename> 以避免必須搜尋很大的記錄檔。
     </para>
    </step>
    <step>
     <para>
      啟動 <command>cupsd</command>。
     </para>
    </step>
    <step>
     <para>
      重覆造成問題的動作。
     </para>
    </step>
    <step>
     <para>
      檢查 <filename>/var/log/cups/error_log*</filename> 中的訊息以辨識問題的起因。
     </para>
    </step>
   </procedure>
  </sect2>

  <sect2 xml:id="sec-print-prob-more-information">
   <title>更多資訊</title>
   <para>
    如需在 <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> 上執行列印操作的詳細資訊，請參閱 <link xlink:href="https://en.opensuse.org/Portal:Printing"/> 上的 openSUSE 支援資料庫。<phrase os="sles;sled">許多特定問題的解決方法在「SUSE 知識庫」(<link xlink:href="https://www.suse.com/support/"/>) 中都有說明。請搜尋文字 <literal>CUPS</literal> 找到相關文章。</phrase>
   </para>
  </sect2>
 </sect1>
</chapter>
