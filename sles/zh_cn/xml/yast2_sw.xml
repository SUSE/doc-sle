<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="yast2_sw.xml" version="5.0" xml:id="cha.y2.sw">
 <title>安装或删除软件</title>
 <info>
  <abstract>
   <para>
    使用 YaST 的软件管理模块可以搜索要添加或去除的软件组件。YaST 将解析所有依赖性。要安装未随安装媒体提供的包，请将其他软件储存库添加到您的设置中，让 YaST 管理它们。通过使用更新小程序管理软件更新，以使系统处于最新状态。
   </para>
  </abstract>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:bugtracker/>
   <dm:translation>yes</dm:translation>
  </dm:docmanager>
 </info><indexterm>
 <primary>YaST</primary>
 <secondary>软件</secondary></indexterm><indexterm>
 <primary>配置</primary>
 <secondary>软件</secondary></indexterm>
 <para>
  使用 YaST 软件管理器更改系统的软件集合。此 YaST 模块有两种形式：一种是 X Window 的图形变体，另一种是命令行上使用的基于文本的变体。本章介绍图形变体 — 有关基于文本的 YaST 的细节，请参见<xref linkend="cha.yast.text"/>。
 </para>
 <note>
  <title>确认和复查更改</title>
  <para>
   安装、更新或删除包时，软件管理器中的任何更改不会立即应用，而是在您相应单击<guimenu>接受</guimenu>或<guimenu>应用</guimenu>进行确认后才会应用。YaST 有一个包含所有操作的列表，允许您在将更改应用于系统前对更改进行复查和修改。
  </para>
 </note>
 <sect1 xml:id="sec.onlineupdate.terms">
  <title>术语定义</title>

  <variablelist>
   <varlistentry>
    <term>储存库</term>
    <listitem>
     <para>
      包含包和有关这些包的更多信息（包元数据）的本地或远程目录。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>（储存库）别名/储存库名称</term>
    <listitem>
     <para>
      储存库的简短名称（在 Zypper 中称为<literal>别名</literal>，在 YaST 中称为<guimenu>储存库名称</guimenu>）。该别名可以由用户在添加储存库时选择且必须唯一。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>储存库描述文件</term>
    <listitem>
     <para>
      每个安装源都提供描述安装源内容（包名称和版本等）的文件。这些储存库描述文件将下载到 YaST 使用的本地超速缓存中。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>产品</term>
    <listitem>
     <para>
      表示整个产品，例如 <phrase role="productname"><phrase os="sles">SUSE® Linux Enterprise Server</phrase></phrase>。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>模式</term>
    <listitem>
     <para>
      模式是一组专用于某种用途的可安装包。例如，<systemitem>便携式计算机</systemitem>模式包含移动计算环境中所需的所有包。模式定义包依赖性（比如必需的包或推荐的包），并预选择了标记为安装的包。这可确保在安装此模式后某种用途所需的最重要的包在系统上可用。但是，不一定要预选择模式中的所有包进行安装，您可以根据自己的需求和喜好手动选择或取消选择模式中的包。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>包</term>
    <listitem>
     <para>
      包是 <literal>rpm</literal> 格式的压缩文件，包含特定程序的文件。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry xml:id="vle.patch">
    <term>增补程序</term>
    <listitem>
     <para>
      增补程序由一个或多个包组成，可通过增量 RPM 方式应用。它也可能带来与尚未安装的包的依赖性。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>可解决</term>
    <listitem>
     <para>
      用于产品、模式、包或增补程序的一个常用术语。最常见的可用类型为程序包或增补程序。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>增量 RPM</term>
    <listitem>
     <para>
      增量 RPM 仅包含某个包的两个已定义版本之间的有区别二进制文件，因此其下载大小最小。安装前，需要在本地计算机上重构建完整 rpm 包。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>包依赖性</term>
    <listitem>
     <para>
      一些包依赖于其他包，例如共享库。换句话说，一个包可能会<literal>需要</literal>其他的包，如果必需的包不可用，则无法安装包。除了依赖性（包要求）必须满足外，某些包还<literal>推荐</literal>其他包。这些推荐的包仅在实际可用时才安装，否则将忽略它们，但是会安装推荐它们的包。
     </para>
    </listitem>
   </varlistentry>
  </variablelist>
 </sect1>
 <sect1 xml:id="sec.y2.sw.qt">
  <title>使用 YaST 软件管理器</title>

  <para>
   从<guimenu>YaST 控制中心</guimenu>选择<menuchoice> <guimenu>软件</guimenu> <guimenu> 软件管理</guimenu> </menuchoice>可以启动软件管理器。
  </para>

  <informalfigure>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="yast2_sw_manager.png" width="70%" format="PNG"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="yast2_sw_manager.png" width="65%" format="PNG"/>
    </imageobject>
   </mediaobject>
  </informalfigure>

  <sect2 xml:id="sec.y2.sw.search">
   <title>搜索包或模式的视图</title>
   <para>
    YaST 软件管理器可以从所有当前启用的储存库中安装包或模式。它提供了不同的视图和过滤器，帮助更方便地查找要搜索的软件。<guimenu>搜索</guimenu>视图是窗口的默认视图。要更改视图，请单击<guimenu>视图</guimenu>并从下拉框中选择以下项之一。选定视图会在新的选项卡中打开。
   </para>
   <variablelist>
    <varlistentry>
     <term>模式</term>
     <listitem>
      <para>
       列出系统上所有可用于安装的模式。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>包组</term>
     <listitem>
      <para>
       列出所有包，按组排序，例如<guimenu>图形</guimenu>、<guimenu>编程</guimenu>或<guimenu>安全性</guimenu>。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>RPM 组</term>
     <listitem>
      <para>
       列出按组及子组的功能排序的所有包。例如，<menuchoice> <guimenu> 网络</guimenu>
       <guimenu> 电子邮件</guimenu> <guimenu> 客户端</guimenu> </menuchoice> 。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>语言</term>
     <listitem>
      <para>
       一个过滤器，用于列出添加某个新系统语言所需的所有包。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>安装源</term>
     <listitem>
      <para>
       一个过滤器，用于按储存库列出包。要选择多个储存库，请按住 <keycap function="control"/> 键的同时单击储存库名称。<quote>伪储存库</quote>
       <guimenu> @System</guimenu> 会列出当前安装的所有包。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>搜索</term>
     <listitem>
      <para>
       可让您按照特定准则搜索包。输入搜索条件并按下 <keycap function="enter"/>。通过指定<guimenu>搜索范围</guimenu>和更改<guimenu>搜索模式</guimenu>来优化搜索。例如，如果您不知道包名称，只知道要搜索的应用程序名称，请尝试在搜索过程中包括包<guimenu>描述</guimenu>。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>安装摘要</term>
     <listitem>
      <para>
       如果已选择要安装、更新或去除的包，此视图会显示单击<guimenu>接受</guimenu>后将应用于系统的更改。要过滤此视图中具有特定状态的包，请激活或停用相应的复选框。要了解状态标志的细节，请按 <keycombo> <keycap function="shift"/> <keycap>  F1</keycap>
       </keycombo> 。
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
   <tip>
    <title>查找不属于活动安装源的包</title>
    <para>
     要列出所有不属于活动安装源的包，可以选择<menuchoice> <guimenu> 视图</guimenu> <guimenu> 安装源</guimenu>
     <guimenu> @System</guimenu> </menuchoice> ，然后选择<menuchoice>
     <guimenu> 次过滤器</guimenu> <guimenu> 未维护的包</guimenu></menuchoice>。例如，如果您删除了某个储存库，并想要确保系统上不再安装该储存库中的任何包，则此操作就非常有用。
    </para>
   </tip>
  </sect2>

  <sect2 xml:id="sec.y2.sw.install">
   <title>安装和删除包或模式</title>
   <para>
    一些包依赖于其他包，例如共享库。另一方面，一些包不能与其他包在系统上共存。如果可行，YaST 会自动解决这些依赖性或冲突。如果您的选择导致无法自动解决的依赖性冲突，则需要按照<xref linkend="sec.y2.sw.deps"/>中所述手动解决冲突。
   </para>
   <note>
    <title>包删除</title>
    <para>
     去除包时，默认情况下 YaST 仅去除所选的包。如果希望 YaST 还去除在去除指定包后变为不需要的所有其他包，请从主菜单中选择<menuchoice>
     <guimenu>选项</guimenu> <guimenu> 删除包时清理</guimenu> </menuchoice>。
    </para>
   </note>
   <procedure>
    <step>
     <para>
      按照<xref linkend="sec.y2.sw.search"/>中所述搜索包。
     </para>
    </step>
    <step>
     <para>
      右窗格中会列出找到的包。要安装或删除某个包，可以右键单击它并选择<guimenu>安装</guimenu>或<guimenu>删除</guimenu>。如果相关选项不可用，可以检查包名称前的符号指示的包状态 — 按 <keycombo> <keycap function="shift"/>
      <keycap>  F1</keycap> </keycombo>  可获取帮助。
     </para>
     <tip>
      <title>对列出的所有包应用操作</title>
      <para>
       要对右窗格中列出的所有包应用某项操作，请转到主菜单，并从<menuchoice>
       <guimenu>包</guimenu> <guimenu> 此列表中的全部内容</guimenu>
       </menuchoice>中选择操作。
      </para>
     </tip>
    </step>
    <step>
     <para>
      要安装某个模式，可以右键单击模式名称并选择<guimenu>安装</guimenu>。
     </para>
    </step>
    <step>
     <para>
      不可以删除模式本身。但可以选择要删除的模式的包，并将它们标记为待删除。
     </para>
    </step>
    <step>
     <para>
      要选择更多的包，请重复上述步骤。
     </para>
    </step>
    <step>
     <para>
      在应用您的更改前，可以通过单击<menuchoice> <guimenu> 视图</guimenu> <guimenu> 安装摘要</guimenu> </menuchoice> 对它们进行复查或修改。默认情况下，会列出所有将更改状态的包。
     </para>
    </step>
    <step>
     <para>
      要还原某个包的状态，可以右键单击该包并选择以下任一项：<guimenu>保留</guimenu>（如果已安排要删除或更新包），或<guimenu>不安装</guimenu>（如果已安排要安装包）。要放弃所有更改并退出软件管理器，请单击<guimenu>取消</guimenu>和<guimenu>放弃</guimenu>。
     </para>
    </step>
    <step>
     <para>
      完成后，单击<guimenu>接受</guimenu>应用您的更改。
     </para>
    </step>
    <step>
     <para>
      如果 YaST 找到其他包的依赖性，则会显示另外已选择安装、更新或删除的包的列表。单击<guimenu>继续</guimenu>接受它们。
     </para>
     <para>
      安装、更新或去除所有选定包后，YaST 软件管理器会自动终止。
     </para>
    </step>
   </procedure>
   <note>
    <title>安装资源包</title>
    <para>
     目前无法通过 YaST 软件管理器安装源包。为了实现该目的，可以使用命令行工具 <command>zypper</command>。有关详细信息，请参见<xref linkend="sec.zypper.softman.sources"/>。
    </para>
   </note>
  </sect2>

  <sect2 xml:id="sec.y2.sw.update">
   <title>更新包</title>
   <para>
    除了更新单个包外，还可以从某个储存库更改所有安装的包或所有包。大批量更新包时，通常需要注意以下几个方面：
   </para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>
      提供包的储存库的优先级，
     </para>
    </listitem>
    <listitem>
     <para>
      包的体系结构（例如 AMD64/Intel 64），
     </para>
    </listitem>
    <listitem>
     <para>
      包的版本号，
     </para>
    </listitem>
    <listitem>
     <para>
      包的供应商。
     </para>
    </listitem>
   </itemizedlist>
   <para>
    哪个方面对选择更新候选包最重要，取决于您选择的相应更新选项。
   </para>
   <procedure>
    <step>
     <para>
      要将所有安装的包更新到最新版本，请从主菜单中选择<menuchoice> <guimenu> 包</guimenu> <guimenu> 所有包</guimenu>
      <guimenu> 如有较新版本可用则更新</guimenu> </menuchoice> 。
     </para>
     <para>
      将使用以下策略在所有储存库中查找可能的更新候选包：YaST 首先尝试将搜索范围限制在与已安装包具有相同体系结构和供应商的包。如果找到结果，将根据以下过程选择<quote>最佳</quote>更新候选包。但是，如果找不到具有相同供应商的可比较包，则将搜索范围扩大到具有相同体系结构的所有包。如果还是找不到可比较包，将考虑所有包，并根据以下准则选择<quote>最佳</quote>更新候选包：
     </para>
     <orderedlist spacing="normal">
      <listitem>
       <para>
        储存库优先级：首选优先级最高的储存库中的包。
       </para>
      </listitem>
      <listitem>
       <para>
        如果这种选择的结果得出多个包，请选择体系结构<quote>最佳</quote>的包（最佳选择：与已安装包的体系结构匹配）。
       </para>
      </listitem>
     </orderedlist>
     <para>
      如果得到的包的版本号比已安装包高，将用所选的更新候选包更新并替换已安装包。
     </para>
     <para>
      此选项会试图避免更改已安装包的体系结构和供应商，但在某些情况下，会容许此类更改。
     </para>
     <note>
      <title>无条件更新</title>
      <para>
       如果选择的是<menuchoice> <guimenu>包</guimenu> <guimenu> 所有包</guimenu> <guimenu> 无条件更新</guimenu>
       </menuchoice>，则会应用相同的准则，但会无条件安装找到的任何候选包。因此，选择此选项实际上会使某些包降级。
      </para>
     </note>
    </step>
    <step>
     <para>
      确保用于大批量更新的包来自特定安装源：
     </para>
     <substeps performance="required">
      <step>
       <para>
        请按照<xref linkend="sec.y2.sw.search"/>中所述选择要从中更新的安装源。
       </para>
      </step>
      <step>
       <para>
        在窗口的右侧，单击<guimenu>将系统包切换为此储存库中的版本</guimenu>。此操作明确允许 YaST 在替换包时更改包供应商。
       </para>
       <para>
        单击<guimenu>接受</guimenu>后，所有已安装的包都将替换为来自此储存库的包（如果可用）。这样会导致更改供应商和体系结构，甚至会使某些包降级。
       </para>
      </step>
      <step>
       <para>
        要避免这种情况，请单击<guimenu>取消将系统包切换为此储存库中的版本</guimenu>。请注意，只有在按<guimenu>接受</guimenu>按钮后才能取消此操作。
       </para>
      </step>
     </substeps>
    </step>
    <step>
     <para>
      在应用您的更改前，可以通过单击<menuchoice> <guimenu> 视图</guimenu> <guimenu> 安装摘要</guimenu> </menuchoice> 对它们进行复查或修改。默认情况下，会列出所有将更改状态的包。
     </para>
    </step>
    <step>
     <para>
      如果所有选项都按照您的喜好设置完毕，请单击<guimenu>接受</guimenu>确认您的更改以启动大批量更新。
     </para>
    </step>
   </procedure>
  </sect2>

  <sect2 xml:id="sec.y2.sw.deps">
   <title>检查软件依赖性</title>
   <para>
    大多数包都依赖于其他包。例如，如果包使用了某个共享库，则它依赖于提供该库的包。另一方面，一些包若共存则会导致冲突（例如，您只能安装一个邮件传送代理：sendmail 或 postfix）。安装或删除软件时，软件管理器会确保不留下任何未解决的依赖性或冲突，以保证系统完整性。
   </para>
   <para>
    当依赖性或冲突只有一种解决方法时，将会自动解决依赖性或冲突。存在多种解决方法总是会导致需要手动解决的冲突。如果解决冲突涉及到更改供应商或体系结构，则它也需要手动解决。在软件管理器中单击<guimenu>接受</guimenu>应用更改时，会显示由自动解析程序触发的所有操作的概述，需要您确认。
   </para>
   <para>
    默认情况下，会自动检查依赖性。每次更改包的状态时（例如，将某个包标记为供安装或删除），都会执行检查。通常它很有用，但在手动解决依赖性冲突时会令人厌烦。要禁用此功能，请转到主菜单，然后停用<menuchoice>
    <guimenu>依赖性</guimenu> <guimenu> 自动检查</guimenu> </menuchoice>。通过<menuchoice>
    <guimenu> 依赖性</guimenu> <guimenu> 立即检查</guimenu></menuchoice>手动执行依赖性检查。在单击<guimenu>接受</guimenu>来确认您的选择时，总是会执行一致性检查。
   </para>
   <para>
    要查看包的依赖性，可以单击右键并选择<guimenu>显示解析程序信息</guimenu>。此时会打开显示依赖性的图。已安装的包显示在绿框中。
   </para>
   <note>
    <title>手动解决包冲突</title>
    <para>
     除非很有经验，否则在处理包冲突时请遵循 YaST 所做的建议，不然可能无法解决它们。请记住，您所做的每个更改都可能会触发其他冲突，最终很容易导致冲突数量不断上升。发生这种情况时，请<guimenu>取消</guimenu>软件管理器，<guimenu>放弃</guimenu>所有更改并重新开始。
    </para>
   </note>
   <figure xml:id="fig.y2.sw.packconfl">
    <title>软件管理器的冲突管理</title>
    <mediaobject>
     <imageobject role="fo">
      <imagedata fileref="yast2_package_conflict.png" width="70%" format="PNG"/>
     </imageobject>
     <imageobject role="html">
      <imagedata fileref="yast2_package_conflict.png" width="65%" format="PNG"/>
     </imageobject>
    </mediaobject>
   </figure>
   <sect3 xml:id="sec.y2.sw.deps.recommends">
    <title>处理包推荐</title>
    <para>
     除了具有运行程序所需的硬依赖性（例如特定的库）以外，包还可能具有弱依赖性（例如，增加额外的功能或转换）。这些弱依赖性称为包推荐。
    </para>
    <para>
     从 <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> <phrase os="sles;sled"> 12 SP1</phrase> 开始，包推荐的处理方式略有不同。安装新包时，一切都与以往相同 - 默认情况下仍会安装推荐的包。
    </para>
    <para>
     在 <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> <phrase os="sles;sled"> 12 SP1</phrase> 之前，会自动安装已安装的包的缺失推荐组件。现在将不再自动安装这些包。要切换到旧的默认设置，请在 <filename>/etc/sysconfig/yast2</filename> 中设置 <envar>PKGMGR_REEVALUATE_RECOMMENDED="yes"</envar>。要安装已安装包的所有缺失推荐组件，请启动 <menuchoice>
     <guimenu>YaST</guimenu> <guimenu> 软件管理器</guimenu>
     </menuchoice>，然后选择<menuchoice> <guimenu>额外</guimenu>
     <guimenu> 安装所有匹配的推荐包</guimenu>
     </menuchoice>。
    </para>
    <para>
     要在安装新包时不安装推荐的包，请在 YaST 软件管理器中停用<menuchoice> <guimenu>依赖性</guimenu>
     <guimenu> 安装推荐的包</guimenu> </menuchoice>。如果使用命令行工具 Zypper 来安装包，请使用选项 <option>--no-recommends</option>。
    </para>
   </sect3>
  </sect2>
 </sect1>
 <xi:include href="yast2_sw_repo.xml"/>
 <xi:include href="updater_gnome.xml"/>
</chapter>
