<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="sle_update_finish.xml" version="5.0" xml:id="cha-upgrade-finish">
 <title>完成升级</title>
 <info>
  <abstract>
   <para>
    升级后，您需要执行一些额外的任务。下一章将指导您完成这些步骤。
   </para>
  </abstract>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:translation>yes</dm:translation>
  </dm:docmanager>
 </info>

 <sect1 xml:id="sec-upgrade-finish-old-packages">
  <title>检查旧软件包</title>
   <para>
    检查孤立的和不需要的软件包。孤立的软件包在任何已配置的软件包软件源中均不再可用。这些软件包不再会更新且不再受支持。不需要的软件包安装为在升级期间已去除的软件包的依赖项。不再需要这些依赖项，因此也应将其去除。
   </para>
   <para>
    要获取孤立的软件包列表，请运行：
   </para>
<screen><prompt>&gt; </prompt><command>zypper packages --orphaned</command></screen>
   <para>
    要获取不需要的软件包列表，请运行：
   </para>
<screen><prompt>&gt; </prompt><command>zypper packages --unneeded</command></screen>
   <para>
    可以将两个列表合并为一个：
   </para>
<screen><prompt>&gt; </prompt><command>zypper packages --orphaned --unneeded</command></screen>
   <para>
    使用这些列表可以确定仍然需要哪些软件包，以及可以安全去除哪些软件包。要使用单个命令去除所有孤立的和不需要的软件包，请运行：
   </para>
<screen><prompt>&gt; </prompt><command>sudo</command> <command>zypper rm $(zypper --no-refresh packages --orphaned --unneeded | gawk '{print $5}' | tail -n +5)</command></screen>
 </sect1>
 <sect1 xml:id="sec-uggrade-finish-config-files">
  <title>检查配置文件</title>
  <para>
   检查所有 <filename>*.rpmnew</filename> 和 <filename>*.rpmsave</filename> 文件。如果升级项目包括对某个默认配置文件所做的更改，而该文件在安装软件包后已发生改变，则系统不会重写该文件，而是创建这些文件类型中的一个。<filename>*.rpmnew</filename> 包含新的默认配置并将已改变的文件保持不变，而 <filename>*.rpmsave</filename> 是已改变的配置（现已由新的默认文件替换）的副本。
  </para>
  <para>
   如果您找到这些文件中的任何一个，请检查其内容并合并所需的更改。无需搜索整个文件系统，而只需搜索 <filename>/etc</filename> 目录。使用以下命令：
  </para>
<screen><prompt>&gt; </prompt><command>find /etc/ -name "*.rpmnew" -o -name "*.rpmsave"</command></screen>
 </sect1>

 
 <sect1 xml:id="sec-upgrade-finish-python3">
  <title>启用 <literal>Python 3</literal> 模块</title>
  <para>
   <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> 15 默认会使用 Python 3.6。<phrase role="productname"><phrase os="sles">SLES</phrase></phrase> 15 SP3 中增加了更新的版本 Python 3.9 来替代 Python 3.6。自 <phrase role="productname"><phrase os="sles">SLES</phrase></phrase> 15 SP4 起，不再支持此版本，而是通过 <literal>Python 3</literal> 模块来提供包含重要更新和安全修复的较新 Python 版本。
  </para>
  <para>
   如果您在 <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> 15 SP 下安装了 3.9，请使用以下命令来启用 <literal>Python 3</literal>Python 3 模块：
  </para>
<screen><prompt>&gt; </prompt><command>sudo</command> <command>SUSEConnect -p sle-module-python3/15.5/<replaceable>x86_64</replaceable></command>&#x002E;</screen>
  <para>
   或者，您也可以使用 <command>zypper remove -u python39</command> 去除 3.9 版本，恢复为默认的 Python 版本。
  </para>
 </sect1>

 <sect1 xml:id="sec-upgrade-finish-xfs4">
  <title>重新设置 XFS v4 设备的格式</title>
  <para>
   <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> 支持 XFS 文件系统的<quote>磁盘上格式</quote> (v5)。这种格式的主要优点包括，所有 XFS 元数据的自动检查总数、文件类型支持以及支持文件更多数量的访问控制列表。
  </para>
  <para>
   请注意，低于 3.12 版的 SUSE Linux Enterprise 内核、低于 3.2.0 版的 <literal>xfsprogs</literal> 以及在 SUSE Linux Enterprise 12 之前发布的 GRUB 2 版本均不支持这种格式。
  </para>
  <important>
   <title>V4 已弃用</title>
   <para>
    XFS 正在弃用采用 V4 格式的文件系统。此文件系统格式是由以下命令创建的：
   </para>
<screen><prompt>&gt; </prompt><command>sudo</command> mkfs.xfs -m crc=0 <replaceable>DEVICE</replaceable></screen>
   <para>
    该格式用于 SLE 11 及更低版本中，现在此格式会导致 <command>dmesg</command> 发出警告消息：
   </para>
<screen>Deprecated V4 format (crc=0) will not be supported after September 2030</screen>
   <para>
    如果您在 <command>dmesg</command> 命令的输出中看到上述消息，建议将文件系统更新到 V5 格式：
   </para>
   <procedure>
    <step>
     <para>
      将数据备份到另一台设备。
     </para>
    </step>
    <step>
     <para>
      在该设备上创建文件系统。
     </para>
<screen><prompt>&gt; </prompt><command>sudo</command> mkfs.xfs -m crc=1 <replaceable>DEVICE</replaceable></screen>
    </step>
    <step>
     <para>
      在更新后的设备上使用备份恢复数据。
     </para>
    </step>
   </procedure>
  </important>
 </sect1>
</chapter>
