<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="sle_update_upgrading.xml" version="5.0" xml:id="cha.update.sle">
 <title>Fazendo upgrade do SUSE Linux Enterprise</title>
 <info>
  <abstract>
   <para>
    O SUSE® Linux Enterprise (SLE) permite atualizar um sistema existente para a nova versão, por exemplo, do SLE 11 SP4 para o SLE 12. Não há necessidade de uma nova instalação. Dados existentes, como diretórios pessoais e de dados e configuração do sistema, permanecem intactos. É possível atualizar de uma unidade de CD ou DVD local ou de uma fonte de instalação de rede central.
   </para>

   <para>
    Este capítulo explica como fazer upgrade manualmente do sistema SUSE Linux Enterprise, seja de DVD, da rede, de um processo automatizado ou do SUSE Manager.
   </para>
  </abstract>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:translation>yes (sim)</dm:translation>
  </dm:docmanager>
 </info>
 <sect1 xml:id="sec.update.sle.paths">
  <title>Caminhos de upgrade suportados para o SLE 12 SP3</title>

  <important>
   <title>Upgrades compatíveis com várias arquiteturas não são suportados</title>
   <para>
    Upgrades compatíveis com várias arquiteturas, como um upgrade da versão de 32 bits do <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> para a versão de 64 bits, ou de big endian para little endian, <emphasis>não</emphasis> são suportados!
   </para>
   <para>
    Especificamente, o upgrade do SLE 11 on POWER (big endian) para o SLE 12 SP2 on POWER (novo: little endian!) <emphasis>não</emphasis> é suportado.
   </para>
   <para>
    Além disso, como o SUSE Linux Enterprise 12 é apenas de 64 bits, os upgrades de qualquer sistema SUSE Linux Enterprise 11 de 32 bits para o SUSE Linux Enterprise 12 e posterior <emphasis>não</emphasis> são suportados.
   </para>
   <para>
    Para fazer um upgrade compatível com várias arquiteturas, você precisa executar uma nova instalação.
   </para>
  </important>

  <para>
   Antes de fazer qualquer migração, leia a <xref linkend="sec.update.prep"/>.
  </para>

  <note>
   <title>Ignorando os Service Packs</title>
   <para>
    A instalação consecutiva de todos os Service Packs é o caminho de atualização mais seguro. Em alguns casos, é permitido ignorar um ou dois Service Packs durante o upgrade. No entanto, recomendamos <emphasis>não</emphasis> ignorar nenhum Service Pack. 
   </para>
  </note>

  <note>
   <title>Fazendo upgrade de versões principais</title>
   <para>
    Recomendamos fazer uma nova instalação durante o upgrade para uma nova Versão Principal, por exemplo, do SUSE Linux Enterprise 11 para o SUSE Linux Enterprise 12.
   </para>
  </note>

  <variablelist>
   <varlistentry>
    <term>Fazendo upgrade do SUSE Linux Enterprise 10 (qualquer Service Pack)</term>
    <listitem>
     <para>
      Não há um caminho de migração direto suportado para o SUSE Linux Enterprise 12. Recomendamos uma nova instalação neste caso.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Fazendo upgrade do SUSE Linux Enterprise 11 GA, SP1 ou SP2</term>
    <listitem>
     <para>
      Não há um caminho de migração direto suportado para o SUSE Linux Enterprise 12. No mínimo, você precisa do SLE 11 SP4 antes de prosseguir para o SLE 12 SP3.
     </para>
     <para>
      Se você não pode executar uma nova instalação, primeiramente faça upgrade do SLE 11 Service Pack para o SLE 11 SP4. Essas etapas estão descritas no <link xlink:href="https://www.suse.com/documentation/sles11/">Guia de Implantação do SUSE Linux Enterprise 11</link>.
     </para>
     <para>
      Em seguida, continue na <xref linkend="sec.update.sle.methods"/>.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Fazendo upgrade do SUSE Linux Enterprise 11 SP4</term>
    <listitem>
     <para>
      O upgrade do SLE 11 para o SLE 12 SP3 apenas é suportado por meio de um upgrade offline. Consulte a <xref linkend="sec.update.sle.methods"/> para obter os detalhes.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Fazendo upgrade do SUSE Linux Enterprise 12 GA para o SP3</term>
    <listitem>
     <para>
      Não há suporte a upgrade direto do SLE 12 GA para o SP3. Faça upgrade primeiro para o SLE 12 SP2.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Fazendo upgrade do SUSE Linux Enterprise 12 SP1 ou SP2 para o SP3</term>
    <listitem>
     <para>
      O upgrade do SUSE Linux Enterprise 12 SP1 ou SP2 para o SP3 é suportado.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Fazendo upgrade do SUSE Linux Enterprise 12 LTSS GA, SP1 ou SP2 para o SP3</term>
    <listitem>
     <para>
      A atualização de qualquer versão anterior do SLE 12 LTSS para o SP3 é suportada.
     </para>
    </listitem>
   </varlistentry>
  </variablelist>
  <figure xml:id="fig.update.sle.paths-overview">
   <title>Visão geral dos caminhos de upgrade mais curtos</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="upgrade-paths.svg" width="100%" format="SVG"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="upgrade-paths.png" width="80%" format="PNG"/>
    </imageobject>
   </mediaobject>
  </figure>
 </sect1>
 <sect1 xml:id="sec.update.sle.methods">
  <title>Upgrade online e offline</title>
  <para>
   O SUSE oferece suporte a dois métodos diferentes de upgrade e migração. Para obter mais informações sobre a terminologia, consulte a <xref linkend="sec.update.sle.terminology"/>. Os métodos são:
  </para>

  <variablelist>
   <varlistentry>
    <term>Online</term>
    <listitem>
     <para>
      Todos os upgrades executados de um sistema em execução são considerados online. Exemplos: Conectado por SUSE Customer Center, SMT (Subscription Management Tool), SUSE Manager usando zypper ou YaST.
     </para>
     <para>
      Ao migrar entre Service Packs da mesma versão principal, sugerimos a <xref linkend="sec.update.migr.yast.onlinemigr"/> ou a <xref linkend="sec.update.migr.zypper.onlinemigr"/> a seguir.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Offline</term>
    <listitem>
     <para>
      Normalmente, os métodos offline inicializam outro sistema operacional do qual é feito o upgrade da versão instalada do SLE. Os exemplos são: DVD, disco flash, imagem ISO, AutoYaST, <quote>RPM simples</quote> ou boot PXE.
     </para>
    </listitem>
   </varlistentry>
  </variablelist>
  <para>
   O upgrade do SUSE Linux Enterprise 11 SP4 para o SUSE Linux Enterprise 12 SP3 apenas é suportado por meio de um upgrade offline. Consulte o <xref linkend="cha.update.offline"/>.
  </para>

  <para>
   O upgrade de qualquer versão do SUSE Linux Enterprise 12 LTSS ou do SUSE Linux Enterprise 12 SP1 ou SP2 para o SP3 é suportado para todos os métodos offline e online. Consulte o <xref linkend="cha.update.offline"/> e o <xref linkend="cha.update.online"/>.
  </para>
 </sect1>
 <sect1 xml:id="sec.update.prep">
  <title>Preparando o sistema</title>
  <para>
   Antes de iniciar o procedimento de upgrade, verifique se o sistema está preparado apropriadamente. Entre outras coisas, a preparação envolve o backup dos dados e a verificação das notas de versão.
  </para>

  <sect2 xml:id="sec.update.prep.relnotes">
   <title>Ler os detalhes da versão</title>
   <para>
    Nos detalhes da versão, você encontra mais informações sobre o que mudou desde a versão anterior do <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase>. Consulte os detalhes da versão para verificar se:
   </para>
   <itemizedlist>
    <listitem>
     <para>
      seu hardware precisa de considerações especiais.
     </para>
    </listitem>
    <listitem>
     <para>
      qualquer pacote de software usado foi significativamente modificado.
     </para>
    </listitem>
    <listitem>
     <para>
      são necessárias precauções especiais para a instalação.
     </para>
    </listitem>
   </itemizedlist>
   <para>
    Os detalhes da versão também apresentam informações que não puderam ser incluídas a tempo no manual. Eles também incluem notas sobre problemas conhecidos.
   </para>
   <para>
    Se você está ignorando um ou mais Service Packs, consulte também os detalhes da versão dos Service Packs ignorados. Geralmente, os detalhes da versão contêm apenas as mudanças entre duas versões subsequentes. Você poderá perder mudanças importantes se ler apenas os detalhes da versão atual.
   </para>
   <para>
    Encontre os detalhes da versão localmente no diretório <filename>/usr/share/doc/release-notes</filename> ou online em <link xlink:href="https://www.suse.com/releasenotes/"/>.
   </para>
  </sect2>
  <sect2 xml:id="sec.update.prep.backup">
   <title>Fazer um backup</title>
   <para>
    Antes de atualizar, copie os arquivos de configuração existentes em uma mídia separada (como dispositivo de fita, disco rígido removível, etc.) para fazer backup dos dados. Isso se aplica basicamente aos arquivos armazenados em <filename>/etc</filename> e a alguns diretórios e arquivos em <filename>/var</filename> e <filename>/opt</filename>. Você também pode gravar os dados do usuário em <filename>/home</filename> (os diretórios <envar>HOME</envar>) em uma mídia de backup. Faça o backup desses dados como <systemitem class="username">root</systemitem>. Apenas o <systemitem class="username">root</systemitem> tem permissões de leitura para todos os arquivos locais.
   </para>
   <para>
    Se você selecionou <guimenu>Atualizar um Sistema Existente</guimenu> como o modo de instalação no YaST, poderá optar por fazer o backup (do sistema) em algum outro momento. É possível incluir todos os arquivos modificados e os arquivos do diretório <filename>/etc/sysconfig</filename>. Entretanto, esse não é um backup completo, já que todos os outros diretórios importantes mencionados anteriormente não estão incluídos. Encontre o backup no diretório <filename>/var/adm/backup</filename>.
   </para>
   <sect3 xml:id="sec.update.prep.backup.packagelist">
    <title>Listando os pacotes e repositórios instalados</title>
    <para>
     Muitas vezes, convém ter uma lista dos pacotes instalados, por exemplo, ao fazer uma nova instalação de uma nova versão principal do SLE ou ao reverter para a versão antiga.
    </para>
    <para>
     Saiba que nem todos os pacotes instalados ou repositórios usados estão disponíveis nas versões mais novas do SUSE Linux Enterprise. Alguns podem ter sido renomeados, e outros substituídos. É possível também que alguns pacotes ainda estejam disponíveis para fins legados, enquanto outro pacote é usado por padrão. Portanto, talvez seja necessária alguma edição manual nos arquivos. Isso pode ser feito com qualquer editor de texto.
    </para>
    <para>
     Crie um arquivo denominado <filename>repositories.bak</filename> com uma lista de todos os repositórios usados
    </para>
    <screen><prompt role="root">root # </prompt><command>zypper</command> lr -e repositories.bak</screen>
    <para>
     Crie também um arquivo denominado <filename>installed-software.bak</filename> com uma lista de todos os pacotes instalados:
    </para>
    <screen><prompt role="root">root # </prompt><command>rpm</command> -qa --queryformat '%{NAME}\n' &gt; installed-software.bak</screen>
    <para>
     Faça backup dos dois arquivos. Os repositórios e os pacotes instalados podem ser restaurados com os comandos a seguir:
    </para>
    <screen><prompt role="root">root # </prompt><command>zypper</command> ar repositories.bak
<prompt role="root">root # </prompt><command>zypper</command> install $(cat installed-software.bak)</screen>
   </sect3>
  </sect2>

  <sect2 xml:id="sec.update.prep.mariadb">
   <title>Migrar o banco de dados MySQL</title>
   <remark>toms 2015-09-03: already reviewed by Ondrej and Kristýna.</remark>
   <para>
    A partir do SUSE Linux Enterprise 12, o SUSE trocou o MySQL pelo MariaDB. Antes de você começar qualquer upgrade, é altamente recomendável fazer backup do banco de dados.
   </para>

   <para>
    Para executar a migração do banco de dados, faça o seguinte:
   </para>
   <procedure>
    <step>
     <para>
      Efetue login na máquina do SUSE Linux Enterprise 11.
     </para>
    </step>
    <step>
     <para>
      Criar um arquivo de dump:
     </para>
<screen><prompt role="root">root # </prompt><command>mysqldump</command> -u root -p --all-databases &gt; mysql_backup.sql</screen>
     <para>
      Por padrão, o <command>mysqldump</command> não descarrega o banco de dados <literal>INFORMATION_SCHEMA</literal> ou <literal>performance_schema</literal>. Para obter mais detalhes, consulte o <link xlink:href="https://dev.mysql.com/doc/refman/5.5/en/mysqldump.html"/>.
     </para>
    </step>
    <step>
     <para>
      Armazene o arquivo de dump, o arquivo de configuração <filename>/etc/my.cnf</filename> e o diretório <filename>/etc/mysql/</filename> para investigação futura (<emphasis>NÃO</emphasis> para instalação!) em um local seguro.
     </para>
    </step>
    <step>
     <para>
      Faça o upgrade. Após o upgrade, seu arquivo de configuração antigo <filename>/etc/my.cnf</filename> ainda estará intacto. Você encontra a nova configuração no arquivo <filename>/etc/my.cnf.rpmnew</filename>.
     </para>
    </step>
    <step>
     <para>
      Configure o banco de dados MariaDB de acordo com as suas necessidades. <emphasis>NÃO</emphasis> use o arquivo de configuração e o diretório antigos, mas use-os como base e adapte-os.
     </para>
    </step>
    <step>
     <para>
      Inicie o servidor MariaDB:
     </para>
<screen><prompt role="root">root # </prompt><command>systemctl</command> start mysql</screen>
     <para>
      Para iniciar o servidor MariaDB em cada boot, habilite o serviço:
     </para>
<screen><prompt role="root">root # </prompt><command>systemctl</command> enable mysql</screen>

    </step>
    <step>
     <para>
      Verifique se o MariaDB está sendo executado apropriadamente conectando-se com o banco de dados:
     </para>
<screen><prompt role="root">root # </prompt><command>mysql</command> -u root -p</screen>
    </step>
   </procedure>
  </sect2>

  <sect2 xml:id="sec.update.prep.postgresql">
   <title>Migrar o banco de dados PostgreSQL</title>
   <remark>toms 2015-09-09: FATE#319049</remark>
   <remark>Already reviewd by Reinhard</remark>
   <para>
    O SLE11 SP3 e o SLE12 GA recebem uma versão mais recente do banco de dados PostgreSQL como uma atualização de manutenção. Por causa do trabalho de migração do banco de dados necessário, não existe um processo de upgrade automático. Dessa forma, a mudança de uma versão para outra precisa ser feita manualmente.
   </para>
   <para>
    O processo de migração é realizado pelo comando <command>pg_upgrade</command>, que é um método alternativo do clássico dump e recarregamento. Em comparação com o método <quote>dump e recarregamento</quote>, o <command>pg_upgrade</command> reduz o tempo da migração.
   </para>
   <para>
    Cada versão do PostgreSQL armazena seus arquivos em diretórios diferentes dependentes da versão. Após a atualização, os diretórios serão mudados para:
   </para>
   <variablelist>
    <varlistentry>
     <term>SLE11 SP3/SP4</term>
     <listitem>
      <para>
       <filename>/usr/lib/postgresql91/</filename> para <filename>/usr/lib/postgresql94/</filename>
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>SLE12 GA</term>
     <listitem>
      <para>
       <filename>/usr/lib/postgresql93/</filename> para <filename>/usr/lib/postgresql94/</filename>
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
   <para>
    Para executar a migração do banco de dados, faça o seguinte:
   </para>
   <procedure>
    <step>
     <para>
      Verifique se as seguintes pré-condições foram atendidas:
     </para>
     <itemizedlist>
      <listitem>
       <para>
        Caso ainda não tenha sido feito, faça upgrade de qualquer pacote da versão antiga do PostgreSQL para a versão mais recente por meio de uma atualização de manutenção.
       </para>
      </listitem>
      <listitem>
       <para>
        Crie um backup do seu banco de dados existente.
       </para>
      </listitem>
      <listitem>
       <para>
        Instale os pacotes da nova versão principal do PostgreSQL. Para o SLE12, isso significa instalar o
        <package>postgresql94-server</package>
        e todos os pacotes dos quais ele depende.
       </para>
      </listitem>
      <listitem>
       <para>
        Instale o pacote
        <package>postgresql94-contrib</package>
        que contém o comando <command>pg_upgrade</command>.
       </para>
      </listitem>
      <listitem>
       <para>
        Verifique se você tem espaço livre suficiente na área de dados do PostgreSQL, que é <filename>/var/lib/pgsql/data</filename>, por padrão. Se o espaço for pouco, tente reduzir o tamanho com o seguinte comando SQL em cada banco de dados (pode levar muito tempo!):
       </para>
<screen>VACUUM FULL</screen>
      </listitem>
     </itemizedlist>
    </step>
    <step>
     <para>
      Pare o servidor PostgreSQL:
     </para>
<screen><prompt role="root">root # </prompt><command>/usr/sbin/rcpostgresql</command> stop</screen>
    </step>
    <step>
     <para>
      Renomeie o diretório de dados antigo:
     </para>
<screen><prompt role="root">root # </prompt><command>mv</command> /var/lib/pgsql/data /var/lib/pgsql/data.old</screen>
    </step>
    <step>
     <para>
      Crie um novo diretório de dados:
     </para>
<screen><prompt role="root">root # </prompt><command>mkdir</command> -p /var/lib/pgsql/data</screen>
    </step>
    <step>
     <para>
      Se você mudou os arquivos de configuração na versão antiga, copie os arquivos <filename>postgresql.conf</filename> <filename>pg_hba.conf</filename> para o novo diretório de <filename>dados</filename>:
     </para>
<screen><prompt role="root">root # </prompt><command>cp</command> /var/lib/pgsql/data.old/*.conf \
     /var/lib/pgsql/data</screen>
    </step>
    <step>
     <para>
      Inicialize a nova instância do banco de dados manualmente com <command>initdb</command> ou iniciando e parando o PostgreSQL, que fará isso automaticamente:
     </para>
<screen><prompt role="root">root # </prompt><command>/usr/sbin/rcpostgresql</command> start
<prompt role="root">root # </prompt><command>/usr/sbin/rcpostgresql</command> stop</screen>
    </step>
    <step>
     <para>
      Inicie o processo de migração e substitua o marcador <replaceable>OLD</replaceable> pela versão mais antiga:
     </para>
<screen><prompt role="root">root # </prompt><command>pg_upgrade</command> \
   --old-datadir "/var/lib/pgsql/data.old" \
   --new-datadir "/var/lib/pgsql/data" \
   --old-bindir "/usr/lib/postgresql<replaceable>OLD</replaceable>/bin/" \
   --new-bindir "/usr/lib/postgresql94/bin/"</screen>
    </step>
    <step>
     <para>
      Inicie a nova instância do banco de dados:
     </para>
<screen><prompt role="root">root # </prompt><command>/usr/sbin/rcpostgresql</command> start</screen>
    </step>
    <step>
     <para>
      Verifique se a migração foi bem-sucedida. Não existe uma ferramenta geral para automatizar essa etapa. Isso depende do seu caso de uso, do volume e do que você deseja testar.
     </para>
    </step>
    <step>
     <para>
      Remova qualquer pacote antigo do PostgreSQL e o diretório de dados antigo:
     </para>
<screen><prompt role="root">root # </prompt><command>zypper</command> search -s postgresql<replaceable>OLD</replaceable> | xargs zypper rm -u
<prompt role="root">root # </prompt><command>rm</command> -rf /var/lib/pgsql/data.old</screen>
    </step>
   </procedure>
  </sect2>

  <sect2 xml:id="sec.update.prep.ssl">
   <title>Criar certificações de servidor não MD5 para aplicativos Java</title>
   <remark>toms 2016-07-27: from bsc#970153, c#24</remark>
   <para>
    Durante a atualização do SP1 para o SP2, os certificados com base em MD5 foram desabilitados como parte de uma correção de segurança. Se você criou certificados como MD5, recrie-os seguindo estas etapas:
   </para>

   <procedure>
    <step>
     <para>
      Abra um terminal e efetue login como <systemitem class="username">root</systemitem>.
     </para>
    </step>
    <step>
     <para>
      Crie uma chave privada:
     </para>
     <screen><prompt role="root">root # </prompt><command>openssl</command> genrsa -out server.key 1024</screen>
     <para>
      Para uma chave mais forte, troque <literal>1024</literal> por um número mais alto, por exemplo, <literal>4096</literal>.
     </para>
    </step>
    <step>
     <para>
      Crie uma CSR (Certificate Signing Request - Solicitação de Autenticação de Certificado):
     </para>
     <screen><prompt role="root">root # </prompt><command>openssl</command> req -new -key server.key -out server.csr</screen>
    </step>
    <step>
     <para>
      Autoassine o certificado:
     </para>
     <screen><prompt role="root">root # </prompt><command>openssl</command> x509 -req -days 365 -in server.csr -signkey server.key -out server.crt</screen>
    </step>
    <step>
     <para>
      Crie o arquivo PEM:
     </para>
     <screen><prompt role="root">root # </prompt><command>cat</command> server.key server.crt &gt; server.pem</screen>
    </step>
    <step>
     <para>Armazene os arquivos <filename>server.crt</filename>, <filename>server.csr</filename>, <filename>server.key</filename> e <filename>server.pem</filename> nos respectivos diretórios onde estão as chaves. Para o Tomcat, por exemplo, o diretório é <filename>/etc/tomcat/ssl/</filename>.
     </para>
    </step>
   </procedure>
  </sect2>

  <sect2 xml:id="sec.update.prep.vms">
   <title>Encerrar convidados de máquinas virtuais</title>
   <para>
    Se a sua máquina atuar como Servidor de Host de VM do KVM ou Xen, encerre apropriadamente todos os Convidados de VM em execução antes da atualização. Do contrário, pode não ser possível acessar os convidados após a atualização.
   </para>
  </sect2>

  <sect2 xml:id="sec.update.prep.smt">
   <title>Verificar o script <command>clientSetup4SMT.sh</command> nos clientes da SMT</title>
   <para>
    Se você estiver migrando o OS cliente que foi registrado em um servidor SMT, precisará verificar se a versão do script <command>clientSetup4SMT.sh</command> em seu host está atualizada. O <command>clientSetup4SMT.sh</command> de versões mais antigas da SMT não podem gerenciar clientes da SMT 12. Se você aplicar patches de software regularmente ao servidor SMT, sempre encontrará a versão mais recente do <command>clientSetup4SMT.sh</command> em <filename>&lt;NOMEDEHOST_SMT&gt;/repo/tools/clientSetup4SMT.sh</filename>.
   </para>
  </sect2>

  <sect2 xml:id="sec.update.disk">
   <title>Espaço em disco</title>

   <para>
    O software tende a crescer a cada versão. Portanto, verifique o espaço da partição disponível antes de atualizar. Se você suspeitar que esteja ficando sem espaço em disco, faça backup dos dados antes de aumentar o espaço disponível redimensionando as partições, por exemplo. Não há uma regra geral sobre a quantidade de espaço que cada partição deve ter. As exigências de espaço dependem do seu perfil de particionamento específico e do software selecionado.
   </para>

   <note>
    <title>Verificação automática de espaço suficiente no YaST</title>
    <para>
     Durante o procedimento de atualização, o YaST verificará a quantidade disponível de espaço livre em disco e mostrará um aviso para o usuário se houver a possibilidade de a instalação exceder essa quantidade. Nesse caso, a atualização pode tornar o <emphasis>sistema inutilizável</emphasis>! Somente se você souber exatamente o que está fazendo (testando com antecedência), poderá ignorar o aviso e continuar a atualização.
    </para>
   </note>

   <sect3 xml:id="sec.update.disk.space">
    <title>Verificando o espaço em disco em sistemas de arquivos não Btrfs</title>
    <para>
     Use o comando <command>df</command> para listar o espaço em disco disponível. Por exemplo, em <xref linkend="aus.update.df"/>, a partição raiz é <filename>/dev/sda3</filename> (montada como <filename>/</filename>).
    </para>
    <example xml:id="aus.update.df">
     <title>Listar com <command>df -h</command></title>

<screen os="sles">Filesystem     Size  Used Avail Use% Mounted on
/dev/sda3       74G   22G   53G  29% /
tmpfs          506M     0  506M   0% /dev/shm
/dev/sda5      116G  5.8G  111G   5% /home
/dev/sda1       44G    4G   40G   9% /data</screen>
    </example>
   </sect3>

   <sect3 xml:id="sec.update.disk.btrfs-on-root">
    <title>Verificando o espaço em disco em sistemas de arquivos de raiz Btrfs</title>
    <para>
     Se você usa o Btrfs como sistema de arquivos raiz em sua máquina, verifique se há espaço suficiente. Na pior das hipóteses, um upgrade precisará do mesmo espaço em disco que o sistema de arquivos raiz atual (sem <filename>/.snapshot</filename>) para um novo instantâneo. Para exibir o espaço em disco disponível, use o comando:
    </para>
<screen><prompt role="root">root # </prompt><command>df</command> -h /</screen>
    <para>
     Verifique também o espaço disponível em todas as outras partições montadas. As recomendações a seguir foram comprovadas:
    </para>
    <itemizedlist>
     <listitem>
      <para>
       Para todos os sistemas de arquivos, incluindo o Btrfs, você precisa de espaço livre suficiente em disco para fazer download e instalar RPMs grandes. O espaço dos RPMs antigos serão liberados apenas depois da instalação dos novos RPMs.
      </para>
     </listitem>
     <listitem>
      <para>
       Para Btrfs com instantâneos, você precisa, no mínimo, do mesmo espaço livre que o espaço usado por sua instalação. Recomendamos ter o dobro de espaço livre da instalação atual.
      </para>
      <para>
       Se você não tiver espaço livre suficiente, poderá tentar apagar instantâneos antigos com o comando <command>snapper</command>:
      </para>
<screen><prompt role="root">root # </prompt><command>snapper</command> list
<prompt role="root">root # </prompt><command>snapper</command> delete NUMBER</screen>
      <para>
       Porém, isso talvez não ajude em todos os casos. Antes da migração, a maioria dos instantâneos ocupa apenas um pouco de espaço.
      </para>
     </listitem>
    </itemizedlist>
   </sect3>
  </sect2>
  <sect2 xml:id="sec.update.prep.multiversion">
   <title>Desabilitando temporariamente o suporte à multiversão do kernel</title>
   <para>
    O <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> permite instalar várias versões do kernel habilitando as respectivas configurações em <filename>/etc/zypp/zypp.conf</filename>. O suporte a esse recurso precisa ser temporariamente desabilitado para fazer upgrade de um pacote de serviço. Quando a atualização for concluída com êxito, o suporte à multiversão poderá ser reabilitado. Para desabilitar o suporte à multiversão, comente as respectivas linhas em <filename>/etc/zypp/zypp.conf</filename>. O resultado deve ser semelhante a:
   </para>
<screen>#multiversion = provides:multiversion(kernel)
#multiversion.kernels = latest,running</screen>
   <para>
    Para reativar esse recurso após a atualização bem-sucedida, remova os sinais de comentário. Para obter mais informações sobre o suporte à multiversão, consulte o <xref linkend="cha.tuning.multikernel.enable"/>.
   </para>
  </sect2>
 </sect1>
 <sect1 xml:id="sec.update.sle.sle12zseries" os="sles">
  <title>Fazendo upgrade em IBM z Systems</title>
  <para>O upgrade de uma instalação do SUSE Linux Enterprise no z Systems requer o parâmetro de kernel <command>Upgrade=1</command>, por exemplo, usando o parmfile. Consulte a <xref linkend="sec.appdendix.parm" xrefstyle="HeadingOnPage"/>.
  </para>
 </sect1>
 <sect1 xml:id="sec.update.prep.ppc_x" os="sles" arch="power">
  <title>IBM POWER: iniciando um servidor X</title>
  <para>
   No SLES 12 para IBM POWER, o gerenciador de exibição é configurado para não iniciar um Servidor X local por padrão. Essa configuração foi revertida no SLES 12 SP1: o gerenciador de exibição agora inicia um Servidor X.
  </para>
  <para>
   Para evitar problemas durante o upgrade, a configuração do <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> não é mudada automaticamente. Para que o gerenciador de exibição inicie um Servidor X após o upgrade, mude a configuração de <envar>DISPLAYMANAGER_STARTS_XSERVER</envar> em <filename>/etc/sysconfig/displaymanager</filename> da seguinte forma:
  </para>
  <screen>DISPLAYMANAGER_STARTS_XSERVER="yes"</screen>
 </sect1>
</chapter>
