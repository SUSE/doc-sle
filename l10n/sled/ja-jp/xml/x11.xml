<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="x11.xml" version="5.0" xml:id="cha-gui-desktop">
 <title>グラフィカルユーザインタフェース</title>
 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:bugtracker/>
   <dm:translation>yes</dm:translation>
  </dm:docmanager>
  <abstract>
   <para>
    <phrase role="productname"><phrase os="sled">SUSE Linux Enterprise Desktop</phrase></phrase>には、X.orgサーバ、<phrase os="sled;osuse">Wayland</phrase>、およびGNOMEデスクトップが含まれています。この章では、すべてのユーザのグラフィカルユーザインタフェースの環境設定について説明します。
   </para>
  </abstract>
 </info>
 <sect1 xml:id="sec-gui-desktop-xorg">
  <title>Xウィンドウシステム</title>
  <para>
   X.orgサーバは、X11プロトコルを実装するための事実上の標準です。Xはネットワークベースであり、あるホスト上で起動されたアプリケーションを、任意のネットワーク(LANやインターネット)を介して接続されている他のホスト上で表示できるようにします。
  </para>
  <para>
   X Window Systemは、ほとんどの場合設定不要です。ハードウェアは、Xの起動時に動的に検出されるため、<filename>xorg.conf</filename>の使用はお勧めしません。それでも、Xの動作を変更するためにカスタムオプションを指定する必要がある場合は、<filename>/etc/X11/xorg.conf.d/</filename>にある設定ファイルを変更できます。
  </para>
  <para os="sled;osuse">
   <phrase role="productname"><phrase os="sled">SUSE Linux Enterprise Desktop</phrase></phrase> <phrase role="productnumber"><phrase os="sles;sled">15 SP6</phrase></phrase>では、X.orgサーバの代替機能としてWaylandが含まれています。この機能はインストール時に選択可能です。
  </para>
  
  <para>
   X11に関する詳細情報を入手するには、<systemitem class="resource">xorg-docs</systemitem>パッケージをインストールしてください。<command>man 5 xorg.conf</command>には、手動設定の形式に関する詳細情報が記載されています(必要な場合)。X11開発の詳細情報は、プロジェクトのホームページ<link xlink:href="https://www.x.org"/>で参照できます。
  </para>

  <para>
   ドライバは、<systemitem>xf86-video-*</systemitem>パッケージにあります(たとえば、<systemitem>xf86-video-ati</systemitem>)。パッケージで配布されるドライバの大半については、関連するマニュアルページに詳細が記載されてます。たとえば、<literal>ati</literal>ドライバを使用する場合は、<command>man 4 ati</command>でドライバの詳細を参照できます。
  </para>

  <para>
   サードパーティのドライバ情報は、<filename>/usr/share/doc/packages/&lt;package_name&gt;</filename>に記載されています。たとえば、<systemitem class="resource">x11-video-nvidiaG03</systemitem>の場合、パッケージのインストール後は、<filename>/usr/share/doc/packages/x11-video-nvidiaG04</filename>でマニュアルを参照できます。
  </para>

  <para>
   サーバに<systemitem class="resource">xrdp</systemitem>パッケージをインストールし、RDPクライアントソフトウェアを使用して、リモートデスクトッププロトコル経由でサーバにアクセスします。
  </para>

 </sect1>
 <xi:include href="x11_fonts.xml"/>
 <sect1 xml:id="sec-gui-desktop-gnome">
  <title>管理者用のGNOME設定</title>

  <sect2 xml:id="sec-gui-desktop-gnome-dconf">
   <title><literal>dconf</literal>システム</title>

   <para>
    GNOMEデスクトップの設定は、<literal>dconf</literal>で管理されます。ユーザが個人用設定を変更し、システム管理者がすべてのユーザ用のデフォルト値または必須値を設定することが可能な階層構造のデータベースまたはレジストリです。GNOME 2の<literal>dconf</literal>システムの代わりに<literal>gconf</literal>が使用されます。
   </para>

   <para>
    グラフィカルユーザインタフェースで<literal>dconf</literal>オプションを表示するには、<command>dconf-editor</command>を使用します。コマンドラインで設定オプションにアクセスして変更を行うには、<command>dconf</command>を使用します。
   </para>

   <para>
    GNOME <literal>Tweaks</literal>ツールは、通常のGNOME設定以外の追加の設定オプション用の使いやすいユーザインタフェースを提供します。このツールは、GNOMEアプリケーションメニューから、またはコマンドラインから<command>gnome-tweak-tool</command>を使用して起動できます。
   </para>
  </sect2>

  <sect2 xml:id="sec-gui-desktop-gnome-global">
   <title>システム全体の設定</title>
   <para>
    グローバル<literal>dconf</literal>設定パラメータは、<filename>/etc/dconf/db/</filename>ディレクトリで設定できます。これには、GDMの設定やユーザ用の特定の設定オプションのロックが含まれます。
   </para>
   <para>
    例として次の手順を使用し、システム全体の設定を作成します。
   </para>
   <procedure>
    <step>
     <para>
      <filename>/etc/dconf/db/</filename>内に<literal>.d</literal>で終わる新しいディレクトリを作成します。このディレクトリには、設定オプションを含む任意の量のテキストファイルを格納することができます。この例では、次の内容のファイル<filename>/etc/dconf/db/network.d/00-proxy</filename>を作成します。
     </para>
     <screen># This is a comment
[system/proxy/http]
host='10.0.0.1'
enabled=true</screen>
    </step>
    <step>
     <para>
      新しい設定ディレクティブをdconfデータベース形式に解析します。
     </para>
     <screen><prompt>&gt; </prompt><command>sudo</command> <command>dconf update</command></screen>
    </step>
    <step>
     <para>
      ファイル<filename>/etc/dconf/profiles/user</filename>を作成して、デフォルトユーザプロファイルに新しい<literal>network</literal>設定データベースを追加します。次に、以下の内容を追加します。
     </para>
     <screen>system-db:network</screen>
     <para>
      ファイル<filename>/etc/dconf/profiles/user</filename>はGNOME(デフォルト)です。他のプロファイルは、環境変数<literal>DCONF_PROFILE</literal>で定義できます。
     </para>
    </step>
    <step>
     <para>
      オプション: ユーザのプロキシ設定をロックするには、ファイル<filename>/etc/dconf/db/network/locks/proxy</filename>を作成します。次に、変更できないキーと共にこのファイルに行を追加します。
     </para>
     <screen>/system/proxy/http/host
/system/proxy/http/enabled</screen>
    </step>
   </procedure>
   <para>
    グラフィカルな<command>dconf-editor</command>を使用して1人のユーザのプロファイルを作成し、次に<command>dconf dump /</command>を使用してすべての設定オプションを一覧表示することができます。この場合、設定オプションは、グローバルプロファイルに格納することができます。
   </para>
   <para>
    グローバル設定の詳細については、<link xlink:href="https://wiki.gnome.org/Projects/dconf/SystemAdministrators"/>を参照してください。
   </para>
  </sect2>
  <sect2 xml:id="sec-gui-desktop-gnome-gtile" os="sled">
    <title>Waylandでのタイリングウィンドウの管理</title>
    <para>
      WaylandでGNOMEデスクトップを実行していて、ウィンドウを隣り合わせで配置したい場合は、<emphasis>gTile</emphasis> GNOME拡張機能を使用することをお勧めします。gTileを使用すると、設定可能なグリッドスキームに基づいてウィンドウを再配置できます。たとえば、6台の端末を起動し、3行2列でデスクトップ領域全体を使用するように配置することができます。
    </para>
    <sect3>
      <title>gTileのインストール</title>
      <important>
        <para>
          gTile GNOME拡張機能を使用するには、GNOMEデスクトップを実行していて、<package>chrome-gnome-shell</package> (<phrase role="productname"><phrase os="sled">SLED</phrase></phrase> 15 SP4以前の場合)または<package>gnome-browser-connector</package> (<phrase role="productname"><phrase os="sled">SLED</phrase></phrase> 15 SP5以降の場合)パッケージがインストールされている必要があります。
        </para>
      </important>
      <procedure>
        <step>
          <para>
            ブラウザで、gTile拡張機能のWebページ(<link xlink:href="https://extensions.gnome.org/extension/28/gtile/"/>)を指定します。ブラウザの拡張機能が見つからないことに関する警告が表示される場合は、そのリンクをクリックして、GNOME Shell拡張機能をインストールして有効にする方法について、Webブラウザの指示に従ってください。
          </para>
          <figure>
            <title>GNOME Shell拡張機能がないことに関する警告</title>
            <mediaobject>
              <imageobject role="fo">
                <imagedata fileref="gtile-browser-warning.png" width="75%"/>
              </imageobject>
              <imageobject role="html">
                <imagedata fileref="gtile-browser-warning.png" width="75%"/>
              </imageobject>
              <textobject role="description">
               <phrase>GNOME Shell拡張機能がないことに関する警告</phrase>
              </textobject>
            </mediaobject>
          </figure>
        </step>
        <step>
          <para>
            GNOME Shell拡張機能がWebブラウザにインストールされると、gTile Webページの右上に<guimenu>OFF</guimenu>ボタンが表示されます。gTile拡張機能を有効にするには、それをクリックして<guimenu>ON</guimenu>に切り替えます。
          </para>
          <figure>
            <title>GNOME gTile拡張機能が有効化されました</title>
            <mediaobject>
              <imageobject role="fo">
                <imagedata fileref="gtile-extension-on.png" width="75%"/>
              </imageobject>
              <imageobject role="html">
                <imagedata fileref="gtile-extension-on.png" width="75%"/>
              </imageobject>
              <textobject role="description"><phrase>GNOME gTile拡張機能が有効化されました</phrase>
              </textobject>
            </mediaobject>
          </figure>
        </step>
        <step>
          <para>
            GNOMEパネルの右側にあるGNOMEトレイにgTileトレイアイコンが表示されます。これを使用して、gTileウィンドウレイアウトを有効にできます。
          </para>
          <figure>
            <title>gTileトレイアイコン</title>
            <mediaobject>
              <imageobject role="fo">
                <imagedata fileref="gtile-tray-icon.png" width="75%"/>
              </imageobject>
              <imageobject role="html">
                <imagedata fileref="gtile-tray-icon.png" width="75%"/>
              </imageobject>
              <textobject role="description"><phrase>gTileトレイアイコン</phrase>
              </textobject>
            </mediaobject>
          </figure>
        </step>
      </procedure>
    </sect3>
    <sect3>
      <title>gTile拡張機能の使用</title>
      <procedure>
        <title>ウィンドウの配置</title>
        <step>
          <para>
            現在フォーカスされているウィンドウのgTileを開くには、<keycombo><keycap function="meta"/><keycap function="enter"/></keycombo>キーを押します。
          </para>
        </step>
        <step>
          <para>
            ウィンドウを配置する列数を設定するには、番号キーを押します。
          </para>
        </step>
        <step>
          <para>
            <guimenu>Autotile Main window sizes</guimenu>設定に従ってウィンドウを自動的にタイル化するには、<keycap>M</keycap>キーを押します。デフォルトでは、初めて<keycap>M</keycap>キーを押すと、現在のウィンドウは画面の半分を使用し、他のすべてのウィンドウは画面の残り半分の列にタイル化されます。<keycap>M</keycap>キーを繰り返し押して、バリエーションを切り替えることができます。これは、大きなメインウィンドウといくつかの小さなセカンダリウィンドウ保持する場合に役立ちます。
          </para>
        </step>
        <step>
          <para>
           現在のウィンドウを画面の事前定義されたタイル内に移動するには、矢印キーを使用します。
          </para>
          <para>
            ウィンドウが占めるタイル数を増減するには、<keycap function="shift"/>キーと矢印キーを使用します。
          </para>
        </step>
        <step>
          <para>
            ウィンドウを隣のウィンドウやデスクトップの端にスナップするには、<keycombo><keycap function="control"/><keycap function="alt"/><keycap>S</keycap></keycombo>キーを押します。
          </para>
        </step>
        <step>
          <para>
            gTileウィンドウを閉じるには、<keycap function="escape"/>キーを押します。
          </para>
        </step>
      </procedure>
      <procedure>
        <title>詳細設定</title>
        <step>
          <para>
            gTile設定を開くには、次のコマンドを実行します：<command>gnome-extensions-app</command>。
          </para>
        </step>
        <step>
          <para>
            gTileを選択し、<guimenu>設定</guimenu>をクリックします。
          </para>
        </step>
        <step>
          <para>
           プリセットとキーの組み合わせを定義して、頻繁に使用するウィンドウレイアウトを簡単に切り替えることができます。
          </para>
          <para>
            gTile拡張機能の設定方法の詳細については、<link xlink:href="https://github.com/gTile/gTile"/>を参照してください。
          </para>
        </step>
      </procedure>
    </sect3>
  </sect2>

  <sect2 xml:id="sec-gui-desktop-gnome-more-info">
   <title>詳細情報</title>
   <para>
    詳細については、<link xlink:href="https://help.gnome.org/admin/"/>を参照してください。
   </para>
  </sect2>
 </sect1>

 <sect1 xml:id="sec-gui-desktop-suse-prime">
  <title>SUSE Primeを使用したIntelとNVIDIA Optimus GPUの切り替え</title>
  <para>
   SUSE Primeは、オンボードIntel Graphics Processing Unit (GPU)と、NVIDIAの切り替え可能グラフィックスOptimusテクノロジーを搭載したNVIDIA GPUを切り替えるためのツールです。Optimusは、オンボードIntel GPUと個別のNVIDIA GPUを簡単に切り替えるためのメカニズムを提供します。Optimusは、省電力モードまたは最大パフォーマンスでラップトップを実行するように設計されています。Intel GPUを節電用に使用し、NVIDIA GPUを3Dアプリケーションに使用します。
  </para>

  <para os="sled">
   SUSE Primeは、SUSE Linux Enterprise Workstation Extension for SUSE Linux Enterprise <phrase role="productnumber"><phrase os="sles;sled">15 SP6</phrase></phrase>に含まれています。
  </para>

  <para>
   SUSE PrimeはWayLandではなく、X11を実行するシステムでのみ動作します。システムでWaylandを実行する場合、SUSE Primeを使用するにはWaylandを無効にして、X11にフォールバックする必要があります(<xref linkend="sec-gui-desktop-suse-prime-prereqs"/>を参照してください)。
  </para>

  <sect2 xml:id="sec-gui-desktop-suse-prime-prereqs">
   <title>前提条件</title>
    
   
   <para os="sle;sled">
    SUSE Linux Enterprise <phrase role="productnumber"><phrase os="sles;sled">15 SP6</phrase></phrase>に含まれているNVIDIAドライバ(<xref linkend="sec-gui-desktop-install-nvidia"/>を参照)を使用して設定され動作するNVIDIA Optimus GPUと、オンボードIntel GPUが必要です。NVIDIA Optimus用の古いスイッチングツールであるBumblebeeはインストールしないでください。
   </para>
   
   <para>
    <filename>/etc/X11/xorg.conf</filename>ファイルは存在してはならず、<filename>/etc/X11/xorg.conf.d</filename>ディレクトリにアクティブな<literal>ServerLayout</literal>、<literal>Device</literal>、または<literal>Screen</literal>セクションが存在してもなりません。
   </para>
   <para>
    SUSE PrimeはX11でのみ動作します。<command>loginctl</command>コマンドを使用して、システムがX11またはWaylandを使用しているかどうかを確認します。
   </para>
<screen><prompt>&gt; </prompt>loginctl
   SESSION        UID USER             SEAT             TTY             
         2       1000 tux             seat0               
<prompt>&gt; </prompt>loginctl show-session 2|grep Type
Type=x11
</screen>
   <para>
    システムがWaylandを使用している場合は、<filename>/etc/gdm/custom.conf</filename>を編集し、<literal>WaylandEnable=false</literal>のコメントを解除して無効にします。次に再起動します。
   </para>
  </sect2>

  <sect2 xml:id="sec-gui-desktop-suse-prime-install">
   <title>SUSE Primeのインストールと使用</title>

    <para>
      NVIDIAグラフィックカードはすでにインストールされ、動作しているはずです。このダイアログボックスが開いていない場合は、<xref linkend="sec-gui-desktop-install-nvidia"/>を参照してください。 
    </para>

   <para>
       <package>suse-prime</package>パッケージをインストールします。
   </para>
       <screen><prompt>&gt; </prompt><command>sudo</command> zypper install suse-prime</screen>
     
   <para>
    GPUを切り替えるには、次のコマンドのいずれかを実行し、ログアウトしてから再度ログインします。
   </para>
<screen><prompt>&gt; </prompt><command>sudo</command> prime-select intel
<prompt>&gt; </prompt><command>sudo</command> prime-select intel2
<prompt>&gt; </prompt><command>sudo</command> prime-select nvidia
</screen>
   <para>
    モード設定ドライバの場合は<command>intel</command>ドライバを使用してください。<command>intel2</command>は、<package>xf86-video-intel</package>ドライバを使用するシステム用です。この情報は<package>inxi</package>をインストールして実行することで得られます。
   </para>
<screen><prompt>&gt; </prompt>inxi -G
Graphics: Device-1: Intel Xeon E3-1200 v3/4th Gen Core Processor Integrated Graphics Controller
          Display Server: x11(X.org 1.20.1 ) drivers: modesetting (unloaded: fbdev, vesa)
          Resolution: 1920x1080@60.00hz
          OpenGL: renderer: Mesa DRI Intel Haswell Desktop version: 4.5 Mesa 18.2.8
      </screen>
   <para>
    どのGPUが現在アクティブですか?
   </para>
<screen><prompt>&gt; </prompt><command>sudo</command> /usr/sbin/prime-select get-current
Driver configured: intel
</screen>
  </sect2>

  <sect2 xml:id="sec-gui-desktop-install-nvidia">
   <title>NVIDIAドライバのインストール</title>
   <para>
    使用するドライバがわかるようにNVIDIAカードを識別する必要がある場合は、次のコマンドを実行します。
</para>
   
<screen><prompt>&gt; </prompt>/sbin/lspci | grep VGA  
</screen>
   
      <para os="sles;sled">
    次の手順に従って、Zypperでドライバをインストールします。
   </para>

   

   <para>
    使用可能なドライバパッケージを一覧表示します。
   </para>
<screen><prompt>&gt; </prompt><command>sudo</command> zypper se nvidia
</screen>
   <para>
    次に、NVIDIAグラフィックカード用ドライバをインストールします。
   </para>
<screen><prompt>&gt; </prompt><command>sudo</command> zypper se <replaceable>packagename</replaceable>
</screen>
  </sect2>
 </sect1>
</chapter>
