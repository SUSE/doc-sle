<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sect1
[
  <!ENTITY % entities SYSTEM "generic-entities.ent">
    %entities;
]>
<chapter xmlns="http://docbook.org/ns/docbook"
       xmlns:xi="http://www.w3.org/2001/XInclude"
       xmlns:xlink="http://www.w3.org/1999/xlink"
       version="5.0"
       xml:id="cha-security-fips">
 <title>Enabling compliance with FIPS 140-3</title>
 <info>
  <abstract>
   <para>
    If your organization does any work for the United States federal
    government, it is likely that your cryptography applications (such as
    openSSL, GnuTLS, and OpenJDK) will be required to be in compliance with
    Federal Information Processing Standards (FIPS) 140-3. FIPS 140-3 is a
    security accreditation program for validating cryptographic modules
    produced by private companies. If your organization is not required by
    compliance rules to run &sle; in FIPS mode, it is most likely best to not
    do it. This chapter provides guidance on enabling FIPS mode, and links to
    resources with detailed information.
   </para>
  </abstract>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:bugtracker></dm:bugtracker>
   <dm:translation>yes</dm:translation>
  </dm:docmanager>
 </info>
 <important>
  <title>&productname; &productnumber; and FIPS 140-3</title>
  <para>
   &productname; &productnumber; is in the process of implementing the FIPS
   140-3 standard. The relevant binaries are undergoing certification, and will
   be updated in the near future.
  </para>
  <para>
   For further details, contact your &suse; sales representative.
  </para>
 </important>
 <sect1 xml:id="sec-fips-concept">
  <title>FIPS overview</title>

  <para>
   Every vendor that develops and maintains cryptographic applications, and
   wants them to be tested for FIPS compliance, must submit them to the
   Cryptographic Module Validation Program (CMVP) (see
   <link xlink:href="https://csrc.nist.gov/projects/cryptographic-module-validation-program"/>).
  </para>

  <para>
   The latest FIPS 140-3 standard was approved in March 2019, and is replacing
   140-2.
  </para>

  <!--taroth 2022-10-17: disabling the following link for now because it
   still is based on FIPS 140-2-->

  <!--<para>
   &suse; maintains a list of certified modules at
   <link xlink:href="https://www.suse.com/support/security/certifications/"/>, along with a lot of other useful information.
   </para>-->
 </sect1>
 <sect1 xml:id="sec-fips-use-case">
  <title>When to enable FIPS mode</title>

  <warning>
   <title>FIPS requires expertise</title>
   <para>
    Administering FIPS is complex and requires significant expertise.
    Implementing it correctly, testing, and troubleshooting all require a high
    degree of knowledge.
   </para>
  </warning>

  <para>
   Run your &productnameshort; in FIPS mode when it is required to meet
   compliance rules, otherwise we do not recommend running your systems in FIPS mode.
  </para>

  <para>
   Below are some of the reasons to not use FIPS mode:
  </para>

  <itemizedlist>
   <listitem>
    <para>
     FIPS is restrictive. It enforces the use of specific validated
     cryptographic algorithms, and specific certified binaries that implement
     these validated algorithms. You must use only the certified binaries.
    </para>
   </listitem>
   <listitem>
    <para>
     Upgrades may break functionality.
    </para>
   </listitem>
   <listitem>
    <para>
     The approval process is very long, so certified binaries are always
     several releases behind the newest release.
    </para>
   </listitem>
   <listitem>
    <para>
     Certified binaries, such as ssh, sshd, and sftp-server, run their own
     self-checks at startup, and run only when these checks succeed. This
     creates some small performance degradation.
    </para>
   </listitem>
   <listitem>
    <para>
     Administering FIPS is complex and requires significant expertise.
    </para>
   </listitem>
  </itemizedlist>
 </sect1>
 <sect1 os="slemicro" xml:id="sec-fips-slemicro-install">
  <title>Installing FIPS</title>

  <para>
   To install the FIPS pattern on a running system, proceed as follows:
  </para>

  <procedure>
   <step>
    <para>
     Install the <literal>patterns-microos-fips</literal> pattern:
    </para>
<screen>&prompt.root;transactional-update pkg install -t pattern microos-fips </screen>
   </step>
   <step>
    <para>
     Reboot your system.
    </para>
   </step>
   <step>
    <para>
     Add the kernel command line parameter <literal>fips=1</literal> to the
     boot loader configuration. To do so edit the file
     <filename>/etc/default/grub</filename> as follows:
    </para>
<screen>GRUB_CMDLINE_LINUX_DEFAULT="... <emphasis role="bold">fips=1</emphasis>...</screen>
   </step>
   <step>
    <para>
     After logging in to the system, run
    </para>
<screen>&prompt.root;transactional-update grub.cfg</screen>
   </step>
   <step>
    <para>
     Reboot your system.
    </para>
   </step>
  </procedure>

  <para>
   Alternatively, you can install the pattern during the manual installation
   under <guimenu>Software</guimenu> in <xref linkend="sec-settings"/>. Then
   just adjust the boot loader configuration as described in the procedure
   above.
  </para>

  <important>
   <title>Unstable Packages</title>
   <para>
    While the relevant binaries are undergoing certification for FIPS 140-3,
    the packages are not stable yet. If you need to enable FIPS mode
    nevertheless, contact your &suse; sales representative.
   </para>
  </important>

  <note>
   <title>Installing and enabling FIPS on a running system</title>
   <para>
    If you install and enable the FIPS mode on a running system, you might need
    to make adjustments, such as regenerating keys, and auditing your setup to
    ensure it is set up correctly.
   </para>
  </note>
 </sect1>
 <sect1 os="sles" xml:id="sec-fips-install">
  <title>Installing FIPS</title>

  <para>
   It is best to install the <package>patterns-base-fips</package> pattern on a
   new installation.
   <!--After the installation is complete, enable FIPS mode
    by running the steps in <xref linkend="sec-fips-enable"/>.-->
  </para>

  <important>
   <title>Unstable Packages</title>
   <para>
    While the relevant binaries are undergoing certification for FIPS 140-3,
    the packages are not stable yet. If you need to enable FIPS mode
    nevertheless, contact your &suse; sales representative.
   </para>
  </important>

  <para>
   You may install <package>patterns-base-fips</package> and enable FIPS mode
   on a running system, but then it is likely you will have to make
   adjustments, such as regenerating keys, and auditing your setup to ensure it
   is set up correctly.
  </para>
 </sect1>
 <!--<sect1 xml:id="sec-fips-enable">
  <title>Enabling FIPS mode</title>
  <para>
  <remark>The file paths for the two READMEs are different than in earlier
  releases. In SLE 15 SP2 and older the path is /usr/share/doc/packages/openssh/
  cschroder Jan 13, 2022</remark>
  Enabling FIPS takes a few steps. First, read the
  <filename>/usr/share/doc/packages/openssh-common/README.FIPS</filename> and
  <filename>/usr/share/doc/packages/openssh-common/README.SUSE</filename>
  files, from the <package>openssh-common</package> package. These contain
  important information about FIPS on &sle;.
  </para>
  <para>
  Check if FIPS is already enabled:
  </para>
  <screen>&prompt.sudo;<command>sysctl -a | grep fips</command>
  crypto.fips_enabled = 0</screen>
  <para>
  <literal>crypto.fips_enabled = 0</literal> indicates that it is not enabled. A return value of 1 means that it is enabled.
  </para>
  <para>
  Then edit <filename>/etc/default/grub</filename>. If
  <filename>/boot</filename> is not on a separate partition, add
  <literal>fips=1</literal> to
  <literal>GRUB_CMDLINE_LINUX_DEFAULT</literal>, like the following
  example:
  </para>
  <screen>GRUB_CMDLINE_LINUX_DEFAULT="splash=silent mitigations=auto quiet fips=1"</screen>
  <para>
  If <filename>/boot</filename> is on a separate partition, specify which
  partition, like the following example, substituting the name of your boot
  partition:
  </para>
  <screen>GRUB_CMDLINE_LINUX_DEFAULT="splash=silent mitigations=auto quiet fips=1 boot=<replaceable>/dev/sda1"</replaceable></screen>
  <para>
  Save your changes, and rebuild your GRUB configuration and initramfs
  image (replace <replaceable>NAME</replaceable>
  with the name of the current initrd and
  <replaceable>KERNELVERSION</replaceable> with the currently running
  kernel):
  </para>
  <screen>&prompt.sudo;<command>grub2-mkconfig -o /boot/grub2/grub.cfg</command>
  &prompt.sudo;<command>/usr/bin/dracut -/-logfile /var/log/YaST2/mkinitrd.log -/-force /boot/$initrd-<replaceable>NAME</replaceable> $<replaceable>KERNELVERSION</replaceable></command></screen>
  <para>
  <remark>
  taroth 2022-10-17: remove the slashes for the options in the screen
  above as soon as this section is enabled again - needed to insert slashes
  temporarily to be able to comment the section
  </remark>
  Reboot, then verify your changes. The following example shows that
  FIPS is enabled:
  </para>
  <screen>&prompt.sudo;<command>sysctl -a | grep fips</command>
  crypto.fips_enabled = 1</screen>
  <para>
  After enabling FIPS it is possible that your system will not boot. If this
  happens, reboot to bring up the GRUB menu. Press <keycap>E</keycap> to edit
  your boot entry, and delete the <literal>fips</literal> entry from the
  <literal>linux</literal> line. Press the <keycap>F10</keycap> key to boot.
  This is a temporary change, and most likely the problem is an error in
  <filename>/etc/default/grub</filename>. Correct it, rebuild GRUB and
  initramfs, then reboot.
  </para>
  </sect1>-->
 <sect1 xml:id="sec-fips-samba-cifs">
  <title>MD5 not supported in Samba/CIFS</title>

  <para>
   According to the FIPS standards, MD5 is not a secure hashing algorithm, and
   it must not be used for authentication. If you run a FIPS-compliant network
   environment, and you have clients or servers that run in FIPS-compliant
   mode, you must use a Kerberos service for authenticating Samba/CIFS users.
   This is necessary as all other Samba authentication modes include MD5.
  </para>

  <para>
   See the &samba; section of the &storage_guide; for more information on
   running a &samba; server.
  </para>
 </sect1>
</chapter>
