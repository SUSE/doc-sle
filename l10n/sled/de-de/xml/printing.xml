<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="printing.xml" version="5.0" xml:id="cha-print">
 <title>Druckerbetrieb</title>
 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:bugtracker/>
   <dm:translation>yes</dm:translation>
  </dm:docmanager>
 </info>
 <para>
  <phrase role="productname"><phrase os="sled">SUSE® Linux Enterprise Desktop</phrase></phrase> unterstützt zahlreiche Druckermodelle (auch entfernte Netzwerkdrucker). Drucker können manuell oder mit YaST konfiguriert werden. Anleitungen zur Konfiguration finden Sie im <xref linkend="sec-yast-hw-print"/>. Grafische Dienstprogramme und Dienstprogramme an der Kommandozeile sind verfügbar, um Druckaufträge zu starten und zu verwalten. Wenn Ihr Drucker nicht wie erwartet verwendet werden kann, lesen Sie die Informationen unter <xref linkend="sec-print-prob"/>.
 </para>
 <para>
  Das Standarddrucksystem in <phrase role="productname"><phrase os="sled">SUSE Linux Enterprise Desktop</phrase></phrase> ist CUPS (Common Unix Printing System).
 </para>
 <para>
  Drucker können nach Schnittstelle, z. B. USB oder Netzwerk, und nach Druckersprache unterschieden werden. Stellen Sie beim Kauf eines Druckers sicher, dass dieser über eine von der Hardware unterstützte Schnittstelle (USB, Ethernet oder WLAN) und über eine geeignete Druckersprache verfügt. Drucker können basierend auf den folgenden drei Klassen von Druckersprachen kategorisiert werden:
 </para>
 <variablelist>
  <varlistentry>
   <term>PostScript-Drucker</term>
   <listitem>
    <para>
     PostScript ist die Druckersprache, in der die meisten Druckaufträge unter Linux und Unix vom internen Drucksystem generiert und verarbeitet werden. Wenn PostScript-Dokumente direkt vom Drucker verarbeitet und im Drucksystem nicht in weiteren Phasen konvertiert werden müssen, reduziert sich die Anzahl der möglichen Fehlerquellen. 
    </para>
    <para>
     Derzeit wird PostScript von PDF als Standardformat für Druckaufträge abgelöst. PostScript+PDF-Drucker, die PDF-Dateien (neben PostScript-Dateien) direkt drucken können, sind bereits am Markt erhältlich. Bei herkömmlichen PostScript-Druckern müssen PDF-Dateien während des Druck-Workflows in PostScript konvertiert werden. 
    </para>
   </listitem>
  </varlistentry>
  <varlistentry>
   <term>Standarddrucker (Sprachen wie PCL und ESC/P)</term>
   <listitem>
    <para>
     Bei den bekannten Druckersprachen kann das Drucksystem PostScript-Druckaufträge mit Ghostscript in die entsprechende Druckersprache konvertieren. Diese Verarbeitungsphase wird als &quot;Interpretieren&quot; bezeichnet. Die gängigsten Sprachen sind PCL (die am häufigsten auf HP-Druckern und ihren Klonen zum Einsatz kommt) und ESC/P (die bei Epson-Druckern verwendet wird). Diese Druckersprachen werden in der Regel von Linux unterstützt und liefern ein adäquates Druckergebnis. Linux ist unter Umständen nicht in der Lage, einige spezielle Druckerfunktionen anzusprechen. Mit Ausnahme von HP und Epson gibt es derzeit keinen Druckerhersteller, der Linux-Treiber entwickeln und sie den Linux-Distributoren unter einer Open-Source-Lizenz zur Verfügung stellen würde.
    </para>
   </listitem>
  </varlistentry>
  <varlistentry xml:id="sec-print-prep-gdi">
   <term>Proprietäre Drucker (auch GDI-Drucker genannt)</term>
   <listitem>
    <para>
     Diese Drucker unterstützen keine der gängigen Druckersprachen. Sie verwenden eigene, undokumentierte Druckersprachen, die geändert werden können, wenn neue Versionen eines Modells auf den Markt gebracht werden. Für diese Drucker sind in der Regel nur Windows-Treiber verfügbar. Weitere Informationen zu diesem Thema finden Sie unter dem Stichwort <xref linkend="sec-print-gdi"/>.
    </para>
   </listitem>
  </varlistentry>
 </variablelist>
 <para>
  Vor dem Kauf eines neuen Druckers sollten Sie anhand der folgenden Quellen prüfen, wie gut der Drucker, den Sie zu kaufen beabsichtigen, unterstützt wird:
 </para>
 <variablelist>
  <varlistentry>
   <term><link xlink:href="http://www.openprinting.org/printers"/>
   </term>
   <listitem>
    <para>
     Die OpenPrinting-Homepage mit der Druckerdatenbank. In der Online-Datenbank wird der neueste Linux-Supportstatus angezeigt. Eine Linux-Distribution kann jedoch immer nur die zur Produktionszeit verfügbaren Treiber enthalten. Demnach ist es möglich, dass ein Drucker, der aktuell als <quote>vollständig unterstützt</quote> eingestuft wird, diesen Status bei der Veröffentlichung der neuesten <phrase role="productname"><phrase os="sled">SUSE Linux Enterprise Desktop</phrase></phrase>-Version nicht aufgewiesen hat. Die Datenbank gibt daher nicht notwendigerweise den richtigen Status, sondern nur eine Annäherung an diesen an.
    </para>
   </listitem>
  </varlistentry>
  <varlistentry>
   <term><link xlink:href="http://pages.cs.wisc.edu/~ghost/"/>
   </term>
   <listitem>
    <para>
     Die Ghostscript-Website
    </para>
   </listitem>
  </varlistentry>
  <varlistentry>
   <term><filename>/usr/share/doc/packages/ghostscript/catalog.devices</filename>
   </term>
   <listitem>
    <para>
     Liste inbegriffener Ghostscript-Treiber.
    </para>
   </listitem>
  </varlistentry>
 </variablelist>
 <sect1 xml:id="sec-print-workflow">
  <title>Der CUPS-Workflow</title>

  <para>
   Der Benutzer erstellt einen Druckauftrag. Der Druckauftrag besteht aus den zu druckenden Daten plus Informationen für den Spooler. Hierzu gehören der Name des Druckers oder der Druckerwarteschlange sowie (optional) Angaben für den Filter, z. B. druckerspezifische Optionen.
  </para>

  <para>
   Mindestens eine zugeordnete Druckerwarteschlange ist für jeden Drucker vorhanden. Der Spooler hält den Druckauftrag in der Warteschlange, bis der gewünschte Drucker bereit ist, Daten zu empfangen. Wenn der Drucker druckbereit ist, sendet der Spooler die Daten über den Filter und das Backend an den Drucker.
  </para>

  <para>
   Der Filter konvertiert die von der Druckanwendung generierten Daten (gewöhnlich PostScript oder PDF, aber auch ASCII, JPEG usw.) in die druckerspezifischen Daten (PostScript, PCL, ESC/P usw). Die Funktionen des Druckers sind in den PPD-Dateien beschrieben. Eine PPD-Datei enthält druckspezifische Optionen mit den Parametern, die erforderlich sind, um die Optionen auf dem Drucker zu aktivieren. Das Filtersystem stellt sicher, dass die vom Benutzer ausgewählten Optionen aktiviert werden.
  </para>

  <para>
   Wenn Sie einen PostScript-Drucker verwenden, konvertiert das Filtersystem die Daten in druckerspezifische PostScript-Daten. Hierzu ist kein Druckertreiber erforderlich. Wenn Sie einen Nicht-PostScript-Drucker verwenden, konvertiert das Filtersystem die Daten in druckerspezifische Daten. Hierzu ist ein für den Drucker geeigneter Druckertreiber erforderlich. Das Back-End empfängt die druckerspezifischen Daten vom Filter und leitet sie an den Drucker weiter.
  </para>
 </sect1>
 <sect1 xml:id="sec-print-method">
  <title>Methoden und Protokolle zum Anschließen von Druckern</title>

  <para>
   Es gibt mehrere Möglichkeiten, einen Drucker an das System anzuschließen. Die Konfiguration von CUPS unterscheidet nicht zwischen einem lokalen Drucker und einem Drucker, der über das Netzwerk an das System angeschlossen ist. Weitere Informationen zum Anschließen von Druckern finden Sie im Beitrag <emphasis>CUPS in aller Kürze</emphasis> unter <link xlink:href="https://en.opensuse.org/SDB:CUPS_in_a_Nutshell"/>.
  </para>

  

  <warning>
   <title>Ändern der Anschlüsse bei einem laufenden System</title>
   <para>
    Vergessen Sie beim Anschließen des Druckers an den Computer nicht, dass während des Betriebs nur USB-Geräte angeschlossen werden können. Um Ihr System oder Ihren Drucker vor Schaden zu bewahren, fahren Sie das System herunter, wenn Sie Verbindungen ändern müssen, die keine USB-Verbindungen sind.
   </para>
  </warning>
 </sect1>
 <sect1 xml:id="sec-print-software">
  <title>Installation der Software</title>

  <para>
   PPD (PostScript Printer Description, PostScript-Druckerbeschreibung) ist die Computersprache, die die Eigenschaften, z. B. die Auflösung und Optionen wie die Verfügbarkeit einer Duplexeinheit, beschreibt. Diese Beschreibungen sind für die Verwendung der unterschiedlichen Druckeroptionen in CUPS erforderlich. Ohne eine PPD-Datei würden die Druckdaten in einem <quote>rohen</quote> Zustand an den Drucker weitergeleitet werden, was in der Regel nicht erwünscht ist. 
  </para>

  <para>
   Um einen PostScript-Drucker zu konfigurieren, sollten Sie sich zunächst eine geeignete PPD-Datei beschaffen. Die Pakete <systemitem>manufacturer-PPDs</systemitem> und <systemitem>OpenPrintingPPDs-postscript</systemitem> enthalten zahlreiche PPD-Dateien. Weitere Informationen hierzu finden Sie unter <xref linkend="sec-print-special-ppd"/> und <xref linkend="sec-print-prob-ppd"/>.
  </para>

  <para>
   Neue PPD-Dateien können im Verzeichnis <filename>/usr/share/cups/model/</filename> gespeichert oder dem Drucksystem mit YaST hinzugefügt werden (siehe <xref linkend="sec-yast-hw-print-local-get-ppd"/>). Die PPD-Dateien lassen sich anschließend während der Druckereinrichtung auswählen.
  </para>

  <para>
   Seien Sie vorsichtig, wenn Sie gleich ein ganzes Software-Paket eines Druckerherstellers installieren sollen. Durch eine solche Installation entfällt die Unterstützung durch <phrase role="productname"><phrase os="sled">SUSE Linux Enterprise Desktop</phrase></phrase>. Außerdem funktionieren die Druckerkommandos unter Umständen anders und das System kann möglicherweise keine Geräte anderer Hersteller mehr adressieren. Aus diesem Grund wird das Installieren von Herstellersoftware nicht empfohlen.
  </para>
 </sect1>
 <sect1 xml:id="sec-print-net">
  <title>Netzwerkdrucker</title>

  <para>
   Ein Netzwerkdrucker kann unterschiedliche Protokolle unterstützen - einige sogar gleichzeitig. Die meisten unterstützten Protokolle sind standardisiert, und doch versuchen einige Hersteller, diesen Standard abzuändern. Treiber werden meist nur für einige wenige Betriebsssysteme angeboten. Linux-Treiber werden leider nur sehr selten zur Verfügung gestellt. Gegenwärtig können Sie nicht davon ausgehen, dass alle Protokolle problemlos mit Linux funktionieren. Um dennoch eine funktionale Konfiguration zu erhalten, müssen Sie daher möglicherweise mit den verschiedenen Optionen experimentieren.
  </para>



  <para>
   CUPS unterstützt die Protokolle <systemitem>socket</systemitem>, <systemitem>LPD</systemitem>, <systemitem>IPP</systemitem> und <systemitem>smb</systemitem>.
  </para>

  <variablelist>
   <varlistentry>
    <term>socket</term>
    <listitem>
     <para>
      <emphasis>Socket</emphasis> bezeichnet eine Verbindung, über die die einfachen Druckdaten direkt an einen TCP-Socket gesendet werden. Einige der am häufigsten verwendeten Socket-Ports sind <option>9100</option> oder <option>35</option>. Die Syntax der Geräte-URI (Uniform Resource Identifier) lautet: socket://<replaceable>IP.FÜR.DEN.DRUCKER</replaceable>:<replaceable>PORT</replaceable>, beispielsweise: <systemitem>socket://192.168.2.202:9100/</systemitem>.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>LPD (Line Printer Daemon)</term>
    <listitem>
     <para>
      Das LDP-Protokoll wird in RFC 1179 beschrieben. Bei diesem Protokoll werden bestimmte auftragsspezifische Daten (z. B. die ID der Druckerwarteschlange) vor den eigentlichen Druckdaten gesendet. Beim Konfigurieren des LDP-Protokolls muss daher eine Druckerwarteschlange angegeben werden. Die Implementierungen diverser Druckerhersteller sind flexibel genug, um beliebige Namen als Druckerwarteschlange zu akzeptieren. Der zu verwendende Name müsste ggf. im Druckerhandbuch angegeben sein. Es werden häufig Bezeichnungen wie LPT, LPT1, LP1 o. ä. verwendet. Die Portnummer für einen LPD-Dienst lautet <option>515</option>. Ein Beispiel für einen Gerät-URI ist <systemitem>lpd://192.168.2.202/LPT1</systemitem>.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>IPP (Internet Printing Protocol)</term>
    <listitem>
     <para>
      IPP basiert auf dem HTTP-Protokoll. Mit IPP können mehr druckauftragsbezogene Daten übertragen werden als mit den anderen Protokollen. CUPS verwendet IPP für die interne Datenübertragung. Um IPP ordnungsgemäß konfigurieren zu können, ist der Name der Druckerwarteschlange erforderlich. Die Portnummer für IPP lautet <literal>631</literal>. Beispiele für Geräte-URIs sind <systemitem>ipp://192.168.2.202/ps</systemitem> und <systemitem>ipp://192.168.2.202/printers/ps</systemitem>.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>SMB (Windows-Freigabe)</term>
    <listitem>
     <para>
      CUPS unterstützt auch das Drucken auf freigegebenen Druckern unter Windows. Das für diesen Zweck verwendete Protokoll ist SMB. SMB verwendet die Portnummern <option>137</option>, <option>138</option> und <option>139</option>. Beispiele für Geräte-URIs sind <systemitem>smb://user:password@workgroup/smb.example.com/printer</systemitem>, <systemitem>smb://user:password@smb.example.com/printer</systemitem> und <systemitem>smb://smb.example.com/printer</systemitem>.
     </para>
    </listitem>
   </varlistentry>
  </variablelist>

  <para>
   Das vom Drucker unterstützte Protokoll muss vor der Konfiguration ermittelt werden. Wenn der Hersteller die erforderlichen Informationen nicht zur Verfügung stellt, können Sie das Protokoll mit dem Kommando <command>nmap</command> ermitteln, das Bestandteil des Pakets <systemitem>nmap</systemitem> ist. <command>nmap</command> überprüft einen Host auf offene Ports. Beispiel:
  </para>

<screen><prompt>&gt; </prompt>nmap -p 35,137-139,515,631,9100-10000 <replaceable>IP.OF.THE.PRINTER</replaceable></screen>
 </sect1>
 <sect1 xml:id="sec-print-net-config-cmdl">
  <title>Konfigurieren von CUPS mit Kommandozeilenwerkzeugen</title>

  <para>
   CUPS kann mit Kommandozeilenwerkzeugen kofiguriert werden, beispielsweise <command>lpinfo</command>, <command>lpadmin</command> oder <command>lpoptions</command>. Sie benötigen einen Geräte-URI, der aus einem Back-End (z. B. USB) und Parametern besteht. Zum Bestimmen von gültigen Geräte- URIs auf Ihrem System verwenden Sie das Kommando <command>lpinfo -v | grep „:/“</command>:
  </para>

<screen><prompt>&gt; </prompt><command>sudo</command> lpinfo -v | grep ":/"
direct usb://ACME/FunPrinter%20XL
network socket://192.168.2.253</screen>

  <para>
   Mit <command>lpadmin</command> kann der CUPS-Serveradministrator Druckerwarteschlangen hinzufügen, entfernen und verwalten. Verwenden Sie die folgende Syntax, um eine Druckerwarteschlange hinzuzufügen:
  </para>

<screen><prompt>&gt; </prompt><command>sudo</command> lpadmin -p <replaceable>QUEUE</replaceable> -v <replaceable>DEVICE-URI</replaceable> -P <replaceable>PPD-FILE</replaceable> -E</screen>

  <para>
   Das Gerät (<option>-v</option>) ist anschließend als <replaceable>WARTESCHLANGE</replaceable> (<option>-p</option>) verfügbar und verwendet die angegebene PPD-Datei (<option>-P</option>). Das bedeutet, dass Sie die PPD-Datei und das Geräte-URI kennen müssen, wenn Sie den Drucker manuell konfigurieren möchten.
  </para>

  <para>
   Verwenden Sie nicht <option>-E</option> als erste Option. Für alle CUPS-Befehle legt die Option <option>-E</option> als erstes Argument die Verwendung einer verschlüsselten Verbindung fest. Zur Aktivierung des Druckers muss die Option <option>-E</option> wie im folgenden Beispiel dargestellt verwendet werden:
  </para>

<screen><prompt>&gt; </prompt><command>sudo</command> lpadmin -p ps -v usb://ACME/FunPrinter%20XL -P \
/usr/share/cups/model/Postscript.ppd.gz -E</screen>

  <para>
   Im folgenden Beispiel wird ein Netzwerkdrucker konfiguriert:
  </para>

<screen><prompt>&gt; </prompt><command>sudo</command> lpadmin -p ps -v socket://192.168.2.202:9100/ -P \
/usr/share/cups/model/Postscript-level1.ppd.gz -E</screen>

  <para>
   Weitere Optionen von <command>lpadmin</command> finden Sie auf der man-Seite von <systemitem>lpadmin(8)</systemitem>.
  </para>

  <para>
   Während der Druckerkonfiguration werden bestimmte Optionen standardmäßig gesetzt. Diese Optionen können (je nach Druckwerkzeug) für jeden Druckauftrag geändert werden. Es ist auch möglich, diese Standardoptionen mit YaST zu ändern. Legen Sie die Standardoptionen mithilfe der Kommandozeilenwerkzeuge wie folgt fest:
  </para>

  <procedure>
   <step>
    <para>
     Zeigen Sie zunächst alle Optionen an:
    </para>
<screen><prompt>&gt; </prompt><command>sudo</command> lpoptions -p <replaceable>QUEUE</replaceable> -l</screen>
    <para>
     Beispiel:
    </para>
<screen>Resolution/Output Resolution: 150dpi *300dpi 600dpi</screen>
    <para>
     Die aktivierte Standardoption wird durch einen vorangestellten Stern (<literal>*</literal>) gekennzeichnet.
    </para>
   </step>
   <step>
    <para>
     Ändern Sie die Option mit <command>lpadmin</command>:
    </para>
<screen><prompt>&gt; </prompt><command>sudo</command> lpadmin -p <replaceable>QUEUE</replaceable> -o Resolution=600dpi</screen>
   </step>
   <step>
    <para>
     Prüfen Sie die neue Einstellung:
    </para>
<screen><prompt>&gt; </prompt><command>sudo</command> lpoptions -p <replaceable>QUEUE</replaceable> -l

Resolution/Output Resolution: 150dpi 300dpi *600dpi</screen>
   </step>
  </procedure>

  <para>
   Wenn ein normaler Benutzer <command>lpoptions</command> ausführt, werden die Einstellungen in <filename>~/.cups/lpoptions</filename> geschrieben. Jedoch werden die <systemitem class="username">root</systemitem>-Einstellungen in to <filename>/etc/cups/lpoptions</filename> geschrieben.
  </para>
 </sect1>
 <sect1 xml:id="sec-print-appl-commandline">
  <title>Drucken über die Kommandozeile</title>

  <para>
   Um den Druckvorgang über die Kommandozeile zu starten, geben Sie <command>lp -d</command>
   <replaceable>NAME_DER WARTESCHLANGE</replaceable> <replaceable>DATEINAME</replaceable> ein und ersetzen Sie die entsprechenden Namen für <replaceable>NAME_DER_WARTESCHLANGE</replaceable> und <replaceable>DATEINAME</replaceable>.
  </para>

  <para>
   Einige Anwendungen erfordern für den Druckvorgang den Befehl <command>lp</command>. Geben Sie in diesem Fall den richtigen Befehl in das Druckdialogfeld der Anwendung ohne Angabe des <replaceable>DATEINAMENS</replaceable> ein, z. B. <command>lp -d</command> <replaceable>NAME_DER_WARTESCHLANGE</replaceable>.
  </para>
 </sect1>
 <sect1 xml:id="sec-print-special">
  <title>Besondere Funktionen in <phrase role="productname"><phrase os="sled">SUSE Linux Enterprise Desktop</phrase></phrase></title>

  <para>
   Mehrere CUPS-Funktionen wurden für <phrase role="productname"><phrase os="sled">SUSE Linux Enterprise Desktop</phrase></phrase> angepasst. Im Folgenden werden einige der wichtigsten Änderungen beschrieben.
  </para>

  <sect2 xml:id="sec-print-special-cupsfire">
   <title>CUPS und Firewall</title>
   <para>
    Nach einer Standardinstallation von <phrase role="productname"><phrase os="sled">SUSE Linux Enterprise Desktop</phrase></phrase> ist <systemitem class="daemon">firewalld</systemitem> aktiv und die Netzwerkschnittstellen werden so konfiguriert, dass sie sich in der <literal>öffentlichen</literal> Zone befinden, die eingehenden Datenverkehr blockiert. 
</para>
   <para>
       Wenn <systemitem class="daemon">firewalld</systemitem> aktiv ist, müssen Sie sie möglicherweise konfigurieren, damit Clients die Netzwerkdrucker durchsuchen können. Aktivieren Sie dazu <literal>mdns</literal> und <literal>ipp</literal> über die interne Netzwerkzone. Die öffentliche Zone sollte niemals Druckerwarteschlangen offenlegen. 
   </para>
   <para>
    (Weitere Informationen zur <systemitem class="daemon">firewalld</systemitem>-Konfiguration finden Sie im <xref linkend="sec-security-firewall-firewalld"/> und <link xlink:href="https://en.opensuse.org/SDB:CUPS_and_SANE_Firewall_settings"/>.)
   </para>
   <sect3 xml:id="sec-print-special-cupsfire-client">
    <title>CUPS-Client</title>
    <para>
     Normalerweise wird der CUPS-Client auf einem normalen Arbeitsplatzrechner ausgeführt, die sich in einer verbürgten Netzwerkumgebung hinter einer Firewall befindet. In diesem Fall empfiehlt es sich, die Netzwerkschnittstelle in der <literal>internen Zone</literal> zu konfigurieren, damit der Arbeitsplatzrechner innerhalb des Netzwerks erreichbar ist.
    </para>
   </sect3>
   <sect3 xml:id="sec-print-special-cupsfire-server">
    <title>CUPS-Server</title>
    <para>
     Wenn der CUPS-Server Teil der durch eine Firewall geschützten verbürgten Netzwerkumgebung ist, sollte die Netzwerkschnittstelle in der <literal>internen Zone</literal> der Firewall konfiguriert sein. Es ist nicht empfehlenswert, einen CUPS-Server in einer nicht verbürgten Netzwerkumgebung einzurichten, es sei denn, Sie sorgen dafür, dass er durch besondere Firewall-Regeln und Sicherheitseinstellungen in der CUPS-Konfiguration geschützt wird.
    </para>
   </sect3>
  </sect2>

  <sect2 xml:id="sec-print-special-browsing">
   <title>Durchsuchen nach Netzwerkdruckern</title>
   <para>
    CUPS-Server geben regelmäßig die Verfügbarkeit und die Statusinformationen von freigegebenen Druckern im Netzwerk bekannt. Die Clients können auf diese Informationen zugreifen und beispielsweise in Druckdialogfeldern eine Liste der verfügbaren Drucker anzeigen. Dies wird als <quote>Browsing</quote> (Durchsuchen) bezeichnet.
   </para>
   <para>
    Die CUPS-Server geben ihre Druckerwarteschlangen entweder über das herkömmliche CUPS-Browsing-Protokoll oder über Bonjour/DND-SD im Netzwerk bekannt. Um Netzwerkdruckerwarteschlangen zu aktivieren, muss der Dienst <systemitem class="daemon">cups-browsed</systemitem> auf allen Clients ausgeführt werden, die über CUPS-Server drucken. <systemitem class="daemon">cups-browsed</systemitem> wird standardmäßig nicht gestartet. Zum Starten für die aktuelle Sitzung führen Sie den Befehl <command>sudo systemctl start cups-browsed</command> aus. Damit der Dienst nach dem Booten automatisch gestartet wird, aktivieren Sie ihn mit dem Befehl <command>sudo systemctl enable cups-browsed</command> auf allen Clients.
   </para>
   <para>
    Falls das Durchsuchen nach dem Starten von <systemitem class="daemon">cups-browsed</systemitem> nicht funktioniert, geben der oder die CUPS-Server die Netzwerkdrucker-Warteschlangen vermutlich über Bonjour/DND-SD bekannt. In diesem Fall müssen Sie zusätzlich das Paket <systemitem class="resource">avahi</systemitem> installieren und den zugehörigen Dienst mit <command>sudo systemctl start avahi-daemon</command> auf allen Clients starten.
   </para>
   <para>
       In <xref linkend="sec-print-special-cupsfire"/> finden Sie Informationen, wie das Durchsuchen von Druckern über <systemitem class="daemon">firewalld</systemitem> zugelassen wird.
   </para>
  </sect2>

  <sect2 xml:id="sec-print-special-ppd">
   <title>PPD-Dateien in unterschiedlichen Paketen</title>
   <para>
    Die YaST-Druckerkonfiguration richtet die Warteschlangen für CUPS auf dem System mit den in <filename>/usr/share/cups/model/</filename> installierten PPD-Dateien ein. Um die geeigneten PPD-Dateien für das Druckermodell zu finden, vergleicht YaST während der Hardware-Erkennung den Hersteller und das Modell mit den Herstellern und Modellen, die in den PPD-Dateien enthalten sind. Zu diesem Zweck generiert die YaST-Druckerkonfiguration eine Datenbank mit den Hersteller- und Modelldaten, die aus den PPD-Dateien extrahiert werden.
   </para>
   <para>
    Die Konfiguration, die nur PPD-Dateien und keine weiteren Informationsquellen verwendet, hat den Vorteil, dass die PPD-Dateien in <filename>/usr/share/cups/model/</filename> beliebig geändert werden können. Wenn Sie beispielsweise PostScript-Drucker nutzen, können die PPD-Dateien direkt in <filename>/usr/share/cups/model/</filename> kopiert werden (wenn sie nicht bereits im Paket <systemitem>manufacturer-PPDs</systemitem> oder <systemitem>OpenPrintingPPDs-postscript</systemitem> vorhanden sind), um eine optimale Konfiguration der Drucker zu erzielen.
   </para>
   <para>
    Weitere PPD-Dateien erhalten Sie mit den folgenden Paketen:
   </para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>
      <systemitem>gutenprint</systemitem>: der Gutenprint-Treiber und zugehörige PPDs
     </para>
    </listitem>
    <listitem>
     <para>
      <systemitem>splix</systemitem>: der Splix-Treiber und zugehörige PPDs
     </para>
    </listitem>
    <listitem>
     <para>
      <systemitem>OpenPrintingPPDs-ghostscript</systemitem>: PPDs für integrierte Ghostscript-Treiber
     </para>
    </listitem>
    <listitem>
     <para>
      <systemitem>OpenPrintingPPDs-hpijs</systemitem>: PPDs für den HPIJS-Treiber für Drucker, die nicht von HP stammen
     </para>
    </listitem>
   </itemizedlist>
  </sect2>
 </sect1>
 <sect1 xml:id="sec-print-prob">
  <title>Fehlersuche</title>

  <para>
   In den folgenden Abschnitten werden einige der am häufigsten auftretenden Probleme mit der Druckerhardware und -software sowie deren Lösungen oder Umgehung beschrieben. Unter anderem werden die Themen GDI-Drucker, PPD-Dateien und Port-Konfiguration behandelt. Darüber hinaus werden gängige Probleme mit Netzwerkdruckern, fehlerhafte Ausdrucke und die Bearbeitung der Warteschlange erläutert.
  </para>

  <sect2 xml:id="sec-print-gdi">
   <title>Drucker ohne Unterstützung für eine Standard-Druckersprache</title>
   <para>
    Diese Drucker unterstützen keine der geläufigen Druckersprachen und können nur mit proprietären Steuersequenzen adressiert werden. Daher funktionieren sie nur mit den Betriebssystemversionen, für die der Hersteller einen Treiber zur Verfügung stellt. GDI ist eine von Microsoft für Grafikgeräte entwickelte Programmierschnittstelle. In der Regel liefert der Hersteller nur Treiber für Windows, und da Windows-Treiber die GDI-Schnittstelle verwenden, werden diese Drucker auch <emphasis>GDI-Drucker</emphasis> genannt. Das eigentliche Problem ist nicht die Programmierschnittstelle, sondern die Tatsache, dass diese Drucker nur mit der proprietären Druckersprache des jeweiligen Druckermodells adressiert werden können.
   </para>
   <para>
    Der Betrieb einiger GDI-Drucker kann sowohl im GDI-Modus als auch in einer der Standard-Druckersprachen ausgeführt werden. Sehen Sie im Druckerhandbuch nach, ob dies möglich ist. Einige Modelle benötigen für diese Umstellung eine spezielle Windows-Software. (Beachten Sie, dass der Windows-Druckertreiber den Drucker immer zurück in den GDI-Modus schalten kann, wenn von Windows aus gedruckt wird). Für andere GDI-Drucker sind Erweiterungsmodule für eine Standarddruckersprache erhältlich.
   </para>
   <para>
    Einige Hersteller stellen für ihre Drucker proprietäre Treiber zur Verfügung. Der Nachteil proprietärer Druckertreiber ist, dass es keine Garantie gibt, dass diese mit dem installierten Drucksystem funktionieren oder für die unterschiedlichen Hardwareplattformen geeignet sind. Im Gegensatz dazu sind Drucker, die eine Standard-Druckersprache unterstützen, nicht abhängig von einer speziellen Drucksystemversion oder einer bestimmten Hardwareplattform.
   </para>
   <para>
    Anstatt viel Zeit darauf aufzuwenden, einen herstellerspezifischen Linux-Treiber in Gang zu bringen, ist es unter Umständen kostengünstiger, einen Drucker zu erwerben, der eine Standarddruckersprache unterstützt (vorzugsweise PostScript). Dadurch wäre das Treiberproblem ein für alle Mal aus der Welt geschafft und es wäre nicht mehr erforderlich, spezielle Treibersoftware zu installieren und zu konfigurieren oder Treiber-Updates zu beschaffen, die aufgrund neuer Entwicklungen im Drucksystem benötigt würden.
   </para>
  </sect2>

  <sect2 xml:id="sec-print-prob-ppd">
   <title>Für einen PostScript-Drucker ist keine geeignete PPD-Datei verfügbar</title>
   <para>
    Wenn das Paket <systemitem>manufacturer-PPDs</systemitem> oder <systemitem>OpenPrintingPPDs-postscript</systemitem> für einen PostScript-Drucker keine geeignete PPD-Datei enthält, sollte es möglich sein, die PPD-Datei von der Treiber-CD des Druckerherstellers zu verwenden oder eine geeignete PPD-Datei von der Webseite des Druckerherstellers herunterzuladen.
   </para>
   <para>
    Wenn die PPD-Datei als Zip-Archiv (.zip) oder als selbstextrahierendes Zip-Archiv <filename>&lt;?dbsbr?&gt;(.exe)</filename> zur Verfügung gestellt wird, entpacken Sie sie mit <command>unzip</command>. Lesen Sie zunächst die Lizenzvereinbarung für die PPD-Datei. Prüfen Sie dann mit dem Dienstprogramm <command>cupstestppd</command>, ob die PPD-Datei den Spezifikationen <quote>Adobe PostScript Printer Description File Format Specification, Version 4.3.</quote> entspricht. Wenn das Dienstprogramm <quote>FAIL</quote> zurückgibt, sind die Fehler in den PPD-Dateien schwerwiegend und werden sehr wahrscheinlich größere Probleme verursachen. Die von <command>cupstestppd</command> protokollierten Problempunkte müssen behoben werden. Fordern Sie beim Druckerhersteller ggf. eine geeignete PPD-Datei an.
   </para>
  </sect2>

  <sect2 xml:id="sec-print-prob-netconnect">
   <title>Netzwerkdrucker-Verbindungen</title>
   <para/>
   <variablelist>
    <varlistentry>
     <term>Netzwerkprobleme identifizieren</term>
     <listitem>
      <para>
       Schließen Sie den Drucker direkt an den Computer an. Konfigurieren Sie den Drucker zu Testzwecken als lokalen Drucker. Wenn dies funktioniert, werden die Probleme netzwerkseitig verursacht.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>TCP/IP-Netzwerk prüfen</term>
     <listitem>
      <para>
       Das TCP/IP-Netzwerk und die Namensauflösung müssen funktionieren.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>Entfernten <command>lpd</command> prüfen
     </term>
     <listitem>
      <para>
       Geben Sie den folgenden Befehl ein, um zu testen, ob zu <command>lpd</command> (Port <literal>515</literal>) auf <replaceable>HOST</replaceable> eine TCP-Verbindung hergestellt werden kann:
      </para>
<screen><prompt>&gt; </prompt>netcat -z <replaceable>HOST</replaceable> 515 &amp;&amp; echo ok || echo failed</screen>
      <para>
       Wenn die Verbindung zu <command>lpd</command> nicht hergestellt werden kann, ist <command>lpd</command> entweder nicht aktiv oder es liegen grundlegende Netzwerkprobleme vor.
      </para>
      <para>
       Vorausgesetzt, dass <command>lpd</command> aktiv ist und der Host Abfragen akzeptiert, rufen Sie mit dem folgenden Befehl (als <systemitem class="username">root</systemitem>) einen Statusbericht für <replaceable>WARTESCHLANGE</replaceable> auf dem Remote-<replaceable>HOST</replaceable> ab:
      </para>
<screen><prompt role="root"># </prompt>echo -e "\004queue" \
| netcat -w 2 -p 722 <replaceable>HOST</replaceable> 515</screen>
      <para>
       Wenn <command>lpd</command> nicht antwortet, ist er entweder nicht aktiv oder es liegen grundlegende Netzwerkprobleme vor. Wenn <command>lpd</command> reagiert, sollte die Antwort zeigen, warum das Drucken in der <literal>queue</literal> auf <literal>host</literal> nicht möglich ist. Wenn Sie eine Antwort erhalten wie in <xref linkend="aus-d-lpd"/> gezeigt, wird das Problem durch den entfernten <command>lpd</command> verursacht.
      </para>
      <example xml:id="aus-d-lpd">
       <title>Fehlermeldung von <command>lpd</command></title>
<screen>lpd: your host does not have line printer access
lpd: queue does not exist
printer: spooling disabled
printer: printing disabled</screen>
      </example>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>Entfernten <command>cupsd</command> prüfen
     </term>
     <listitem>
      <para>
       Ein CUPS-Netzwerkserver kann die Warteschlangen standardmäßig alle 30 Sekunden per Broadcast über den UDP-Port <literal>631</literal> senden. Demzufolge kann mit dem folgenden Kommando getestet werden, ob im Netzwerk ein CUPS-Netzwerkserver mit aktivem Broadcast vorhanden ist. Stoppen Sie unbedingt Ihren lokalen CUPS-Daemon, bevor Sie das Kommando ausführen.
      </para>
<screen><prompt>&gt; </prompt>netcat -u -l -p 631 &amp; PID=$! ; sleep 40 ; kill $PID</screen>
      <para>
       Wenn ein CUPS-Netzwerkserver vorhanden ist, der Informationen über Broadcasting sendet, erscheint die Ausgabe wie in <xref linkend="aus-d-bcast"/> dargestellt.
      </para>
      <example xml:id="aus-d-bcast">
       <title>Broadcast vom CUPS-Netzwerkserver</title>
<screen>ipp://192.168.2.202:631/printers/queue</screen>
      </example>
      
      <para>
       Mit dem folgenden Befehl können Sie testen, ob mit <command>cupsd</command> (Port <literal>631</literal>) auf <replaceable>HOST</replaceable> eine TCP-Verbindung hergestellt werden kann:
      </para>
<screen><prompt>&gt; </prompt>netcat -z <replaceable>HOST</replaceable> 631 &amp;&amp; echo ok || echo failed</screen>
      <para>
       Wenn die Verbindung zu <command>cupsd</command> nicht hergestellt werden kann, ist <command>cupsd</command> entweder nicht aktiv oder es liegen grundlegende Netzwerkprobleme vor. <command>lpstat -h</command> <replaceable>HOST</replaceable> -l -t gibt einen (möglicherweise sehr langen) Statusbericht für alle Warteschlangen auf dem <replaceable>HOST</replaceable> zurück, vorausgesetzt, dass <command>cupsd</command> aktiv ist und der Host Abfragen akzeptiert.
      </para>
      <para>
       Mit dem nächsten Befehl können Sie testen, ob die <replaceable>WARTESCHLANGE</replaceable> auf <replaceable>HOST</replaceable> einen Druckauftrag akzeptiert, der aus einem einzigen CR-Zeichen (Carriage-Return) besteht. In diesem Fall sollte nichts gedruckt werden. Möglicherweise wird eine leere Seite ausgegeben.
      </para>
<screen><prompt>&gt; </prompt>echo -en "\r" \
| lp -d queue -h <replaceable>HOST</replaceable></screen>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>
      Fehlerbehebung für einen Netzwerkdrucker oder eine Print Server Machine
     </term>
     <listitem>
      <para>
       Spooler, die in einer Print Server Machine ausgeführt werden, verursachen gelegentlich Probleme, wenn sie mehrere Druckaufträge bearbeiten müssen. Da dies durch den Spooler in der Print Server Machine verursacht wird, gibt es keine Möglichkeit, dieses Problem zu beheben. Sie haben jedoch die Möglichkeit, den Spooler in der Print Server Machine zu umgehen, indem Sie den an die Print Server Machine angeschlossenen Drucker über den TCP-Socket direkt kontaktieren. Siehe <xref linkend="sec-print-net"/>.
      </para>
      <para>
       Auf diese Weise wird die Print Server Machine auf einen Konvertierer zwischen den unterschiedlichen Formen der Datenübertragung (TCP/IP-Netzwerk und lokale Druckerverbindung) reduziert. Um diese Methode verwenden zu können, müssen Sie den TCP-Port der Print Server Machine kennen. Wenn der Drucker eingeschaltet und an die Print Server Machine angeschlossen ist, kann dieser TCP-Port in der Regel mit dem Dienstprogramm <command>nmap</command> aus dem Paket <systemitem>nmap</systemitem> ermittelt werden, wenn die Print Server Machine einige Zeit eingeschaltet ist. Beispiel: <command>nmap </command> <replaceable>IP-Adresse</replaceable> gibt die folgende Ausgabe für eine Print Server Machine zurück:
      </para>
<screen>Port       State       Service
23/tcp     open        telnet
80/tcp     open        http
515/tcp    open        printer
631/tcp    open        cups
9100/tcp   open        jetdirect</screen>
      <para>
       Diese Ausgabe gibt an, dass der an die Print Server Machine angeschlossenen Drucker über TCP-Socket an Port <literal>9100</literal> angesprochen werden kann. <command>nmap</command> prüft standardmäßig nur einige allgemein bekannte Ports, die in <filename>/usr/share/nmap/nmap-services</filename> aufgeführt sind. Um alle möglichen Ports zu überprüfen, verwenden Sie den Befehl <command>nmap -p</command>
       <replaceable>AUSGANGS-PORT</replaceable>-<replaceable>ZIEL-PORT</replaceable> <replaceable>IP-ADRESSE</replaceable>. Dies kann einige Zeit dauern. Weitere Informationen finden Sie auf der man-Seite zu <command>ypbind</command>.
      </para>
      <para>
       Geben Sie einen Befehl ein wie
      </para>
<screen><prompt>&gt; </prompt>echo -en "\rHello\r\f" | netcat -w 1 IP-address port
cat file | netcat -w 1 IP-address port</screen>
      <para>
       um Zeichenketten oder Dateien direkt an den entsprechenden Port zu senden, um zu testen, ob der Drucker auf diesem Port angesprochen werden kann.
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
  </sect2>

  <sect2 xml:id="sec-print-prob-defective-printouts">
   <title>Fehlerhafte Ausdrucke ohne Fehlermeldung</title>
   <para>
    Für das Drucksystem ist der Druckauftrag abgeschlossen, wenn das CUPS-Back-End die Datenübertragung an den Empfänger (Drucker) abgeschlossen hat. Wenn die weitere Verarbeitung auf dem Empfänger nicht erfolgt (z. B. wenn der Drucker die druckerspezifischen Daten nicht drucken kann), wird dies vom Drucksystem nicht erkannt. Wenn der Drucker die druckerspezifischen Daten nicht drucken kann, wählen Sie eine PPD-Datei, die für den Drucker besser geeignet ist.
   </para>
  </sect2>

  <sect2 xml:id="sec-print-prob-disabled-queues">
   <title>Deaktivierte Warteschlangen</title>
   <para>
    Wenn die Datenübertragung zum Empfänger auch nach mehreren Versuchen nicht erfolgreich ist, meldet das CUPS-Back-End, z. B. <literal>USB</literal> oder <literal>socket</literal>, dem Drucksystem (an <command>cupsd</command>) einen Fehler. Das Backend bestimmt, wie viele erfolglose Versuche angemessen sind, bis die Datenübertragung als unmöglich gemeldet wird. Da weitere Versuche vergeblich wären, deaktiviert <command>cupsd</command> das Drucken für die entsprechende Warteschlange. Nachdem der Systemadministrator das Problem behoben hat, muss er das Drucken mit dem Kommando <command>cupsenable</command> wieder aktivieren.
   </para>
  </sect2>

  <sect2 xml:id="sec-print-prob-deleting-jobs">
   <title>CUPS-Browsing: Löschen von Druckaufträgen</title>
   <para>
    Wenn ein CUPS-Netzwerkserver seine Warteschlangen den Client-Hosts via Browsing bekannt macht und auf den Host-Clients ein geeigneter lokaler <command>cupsd</command> aktiv ist, akzeptiert der Client-<command>cupsd</command> Druckaufträge von Anwendungen und leitet sie an den <command>cupsd</command> auf dem Server weiter. Wenn <command>cupsd</command> auf dem Server einen Druckauftrag akzeptiert, wird diesem eine neue Auftragsnummer zugewiesen. Daher unterscheidet sich die Auftragsnummer auf dem Client-Host von der auf dem Server. Da ein Druckauftrag in der Regel sofort weitergeleitet wird, kann er mit der Auftragsnummer auf dem Client-Host nicht gelöscht werden. Dies liegt daran, dass der Client-<command>cupsd</command> den Druckauftrag als abgeschlossen betrachtet, wenn dieser an den Server-<command>cupsd</command> weitergeleitet wurde.
   </para>
   <para>
    Soll der Druckauftrag auf dem Server gelöscht werden, ermitteln Sie die Auftragsnummer auf dem Server mit einem Kommando wie <command>lpstat -h cups.example.com -o</command>. Hierbei wird vorausgesetzt, dass der Server den Druckauftrag noch nicht erledigt (also noch nicht vollständig an den Drucker gesendet) hat. So löschen Sie den Druckauftrag anhand der abgerufenen Auftragsnummer auf dem Server:
   </para>
<screen><prompt>&gt; </prompt>cancel -h cups.example.com <replaceable>QUEUE-JOBNUMBER</replaceable></screen>
  </sect2>

  <sect2 xml:id="sec-print-prob-brokenjobs">
   <title>Fehlerhafte Druckaufträge und Fehler bei der Datenübertragung</title>
   <para>
    Wenn Sie während des Druckvorgangs den Drucker oder den Computer abschalten, bleiben Druckaufträge in der Warteschlange. Der Druckvorgang wird wieder aufgenommen, sobald der Computer (bzw. der Drucker) wieder eingeschaltet wird. Fehlerhafte Druckaufträge müssen mit <command>cancel</command> aus der Warteschlange entfernt werden.
   </para>
   <para>
    Wenn ein Druckauftrag beschädigt ist oder ein Fehler bei der Datenübertragung zwischen Host und Drucker auftritt, kann der Drucker die Daten nicht ordnungsgemäß verarbeiten und es werden unzählige Blätter mit unlesbaren Zeichen bedruckt. So reparieren Sie dieses Problem:
   </para>
   <procedure>
    <step>
     <para>
      Um den Druckvorgang zu beenden, entfernen Sie das Papier aus Tintenstrahldruckern oder öffnen Sie die Papierzufuhr bei Laserdruckern. Qualitativ hochwertige Drucker sind mit einer Taste zum Abbrechen des aktuellen Druckauftrags ausgestattet.
     </para>
    </step>
    <step>
     <para>
      Der Druckauftrag befindet sich möglicherweise noch in der Warteschlange, da die Aufträge erst dann entfernt werden, wenn sie vollständig an den Drucker übertragen wurden. Geben Sie <command>lpstat -o</command> oder <command>lpstat -h cups.example.com -o</command> ein, um zu prüfen, über welche Warteschlange aktuell gedruckt wird. Löschen Sie den Druckauftrag mit <command>cancel</command>
      <replaceable>WARTESCHLANGE</replaceable>-<replaceable>AUFTRAGSNUMMER</replaceable> oder <command>cancel -h cups.example.com</command>
      <replaceable>WARTESCHLANGE</replaceable>-<replaceable>AUFTRAGSNUMMER</replaceable>.
     </para>
    </step>
    <step>
     <para>
      Auch wenn der Druckauftrag aus der Warteschlange gelöscht wurde, werden einige Daten weiter an den Drucker gesendet. Prüfen Sie, ob ein CUPS-Backend-Prozess für die entsprechende Warteschlange ausgeführt wird und wenn ja, beenden Sie ihn. 
     </para>
    </step>
    <step>
     <para>
      Setzen Sie den Drucker vollständig zurück, indem Sie ihn für einige Zeit ausschalten. Legen Sie anschließend Papier ein und schalten Sie den Drucker wieder ein.
     </para>
    </step>
   </procedure>
  </sect2>

  <sect2 xml:id="sec-print-prob-debugging">
   <title>Fehlersuche für CUPS</title>
   <para>
    Suchen Sie Probleme in CUPS mithilfe des folgenden generischen Verfahrens:
   </para>
   <procedure>
    <step>
     <para>
      Setzen Sie <command>LogLevel debug</command> in <filename>/etc/cups/cupsd.conf</filename>.
     </para>
    </step>
    <step>
     <para>
      Stoppen Sie <command>cupsd</command>.
     </para>
    </step>
    <step>
     <para>
      Entfernen Sie <filename>/var/log/cups/error_log*</filename>, um das Durchsuchen sehr großer Protokolldateien zu vermeiden.
     </para>
    </step>
    <step>
     <para>
      Starten Sie <command>cupsd</command>.
     </para>
    </step>
    <step>
     <para>
      Wiederholen Sie die Aktion, die zu dem Problem geführt hat.
     </para>
    </step>
    <step>
     <para>
      Lesen Sie die Meldungen in <filename>/var/log/cups/error_log*</filename>, um die Ursache des Problems zu identifizieren.
     </para>
    </step>
   </procedure>
  </sect2>

  <sect2 xml:id="sec-print-prob-more-information">
   <title>Weitere Informationen</title>
   <para>
    Ausführliche Informationen zum Drucken unter <phrase role="productname"><phrase os="sled">SUSE Linux Enterprise Desktop</phrase></phrase> finden Sie in der openSUSE-Supportdatenbank unter <link xlink:href="https://en.opensuse.org/Portal:Printing"/>. <phrase os="sles;sled">Lösungen zu vielen spezifischen Problemen finden Sie in der SUSE Knowledgebase (<link xlink:href="https://www.suse.com/support/"/>). Die relevanten Themen finden Sie am schnellsten mittels einer Textsuche nach <literal>CUPS</literal>&#x002E;</phrase>
   </para>
  </sect2>
 </sect1>
</chapter>
