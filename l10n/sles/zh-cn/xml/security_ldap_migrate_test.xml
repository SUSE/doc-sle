<?xml version="1.0" encoding="UTF-8"?>
<sect1 xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="security_ldap_migrate_test.xml" version="5.0" xml:id="sec-security-ldap-migrate">
 <info>
  <title>ä» OpenLDAP è¿ç§»åˆ° 389 Directory Server</title>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:translation>yes</dm:translation>
  </dm:docmanager>
 </info>
   <para>
     <phrase os="sles;sled">ä» SUSE Linux Enterprise 15 SP3 å¼€å§‹</phrase>ï¼ŒOpenLDAP å·²å¼ƒç”¨ä¸”ä¸å†å—æ”¯æŒã€‚å®ƒå·²ç”± 389 Directory Server å–ä»£ã€‚SUSE æä¾›äº† <command>openldap_to_ds</command> å®ç”¨ç¨‹åºç”¨äºå¸®åŠ©è¿ç§»ï¼Œè¯¥å®ç”¨ç¨‹åºéšé™„åœ¨ <package>389-ds</package> è½¯ä»¶åŒ…ä¸­ã€‚
   </para>
   <para>
     <command>openldap_to_ds</command> å®ç”¨ç¨‹åºæ—¨åœ¨å°†å°½å¯èƒ½å¤šçš„è¿ç§»å·¥ä½œè‡ªåŠ¨åŒ–ã€‚ä½†æ˜¯ï¼Œæ¯ä¸ª LDAP éƒ¨ç½²å„ä¸ç›¸åŒï¼Œå› æ­¤æˆ‘ä»¬æ— æ³•ç¼–å†™å‡ºé€‚åˆæ‰€æœ‰æƒ…å†µçš„å·¥å…·ã€‚æ‚¨å¯èƒ½éœ€è¦æ‰§è¡Œä¸€äº›æ‰‹åŠ¨æ­¥éª¤ï¼Œå¹¶åœ¨å°è¯•è¿›è¡Œç”Ÿäº§è¿ç§»ä¹‹å‰å…¨é¢æµ‹è¯•æ‚¨çš„è¿ç§»è¿‡ç¨‹ã€‚
   </para>

  <sect2 xml:id="sec-security-ldap-migrate-test">
  <title>æµ‹è¯•ä» OpenLDAP è¿ç§»</title>
   <para>
     OpenLDAP ä¸ 389 Directory Server çš„å·®å¼‚ç›¸å½“å¤§ï¼Œå¯èƒ½éœ€è¦å¯¹è¿ç§»è¿›è¡Œåå¤æµ‹è¯•å’Œè°ƒæ•´ã€‚æ‰§è¡Œå¿«é€Ÿè¿ç§»æµ‹è¯•å¯èƒ½ä¼šå¾ˆæœ‰å¸®åŠ©ï¼Œè¿™æ ·å¯å¤§è‡´äº†è§£éœ€è¦æ‰§è¡Œå“ªäº›æ­¥éª¤æ‰èƒ½ç¡®ä¿è¿ç§»æˆåŠŸã€‚
   </para>
   <para>
     å…ˆå†³æ¡ä»¶:
   </para>
   <itemizedlist>
    <listitem>
      <para>
        ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„ 389 Directory Server å®ä¾‹ã€‚
     </para>
    </listitem>
    <listitem>
     <para>
       ä¸€ä¸ªé‡‡ç”¨åŠ¨æ€ ldif æ ¼å¼çš„ OpenLDAP <filename>slapd</filename> é…ç½®æ–‡ä»¶æˆ–ç›®å½•ã€‚
     </para>
    </listitem>
    <listitem>
     <para>
        OpenLDAP æ•°æ®åº“çš„ ldif æ–‡ä»¶å¤‡ä»½ã€‚
     </para>
    </listitem>
   </itemizedlist>
   <para>
     å¦‚æœæ‚¨çš„ slapd é…ç½®ä¸æ˜¯åŠ¨æ€ ldif æ ¼å¼ï¼Œè¯·ä½¿ç”¨ <command>slaptest</command> åˆ›å»ºåŠ¨æ€å‰¯æœ¬ã€‚åˆ›å»ºä¸€ä¸ª <filename>slapd.d</filename> ç›®å½•ï¼ˆä¾‹å¦‚ <filename>/root/slapd.d/</filename>ï¼‰ï¼Œç„¶åè¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š
   </para>
   <screen><prompt>&gt; </prompt><command>sudo</command> <command>slaptest -f /etc/openldap/slapd.conf -F /root/slapd.d</command>
     </screen>
     <para>
       è¿™ä¼šç”Ÿæˆå‡ ä¸ªç±»ä¼¼äºä»¥ä¸‹ç¤ºä¾‹çš„æ–‡ä»¶ï¼š
     </para>
     <screen><prompt>&gt; </prompt><command>sudo</command> <command>ls /root/slapd.d/*</command>

/root/slapd.d/cn=config.ldif

/root/slapd.d/cn=config:
cn=module{0}.ldif  cn=schema.ldif                 olcDatabase={0}config.ldif
cn=schema          olcDatabase={-1}frontend.ldif  olcDatabase={1}mdb.ldif
</screen>
   <para>
     ä¸ºæ¯ä¸ªåç¼€åˆ›å»ºä¸€ä¸ª ldif æ–‡ä»¶ã€‚åœ¨ä»¥ä¸‹ç¤ºä¾‹ä¸­ï¼Œåç¼€ä¸º dc=<replaceable>LDAP1</replaceable>,dc=<replaceable>COM</replaceable>ã€‚å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯ <filename>/etc/openldap/slapd.conf</filename> æ ¼å¼ï¼Œè¯·è¿è¡Œä»¥ä¸‹å‘½ä»¤åˆ›å»º ldif å¤‡ä»½æ–‡ä»¶ï¼š
   </para>
   <screen>
<prompt>&gt; </prompt><command>sudo</command> <command>slapcat -f /etc/openldap/slapd.conf -b dc=<replaceable>LDAP1</replaceable>,dc=<replaceable>COM</replaceable></command> \
<command>-l <replaceable>/root/LDAP1-COM</replaceable>.ldif</command>
   </screen>
   <para>
     ä½¿ç”¨ <command>openldap_to_ds</command> åˆ†æé…ç½®å’Œæ–‡ä»¶ï¼Œå¹¶æ˜¾ç¤ºè¿ç§»è®¡åˆ’è€Œä¸æ›´æ”¹ä»»ä½•å†…å®¹ï¼š
   </para>
   <screen><prompt>&gt; </prompt><command>sudo</command> <command>openldap_to_ds <replaceable>LDAP1</replaceable></command>\
<command>/root/slapd.d <replaceable>/root/LDAP1-COM</replaceable>.ldif.ldif</command></screen>
   <para>
     è¿™ä¼šæ‰§è¡Œè¯•è¿è¡Œï¼Œä½†ä¸æ›´æ”¹ä»»ä½•å†…å®¹ã€‚è¾“å‡ºå¦‚ä¸‹æ‰€ç¤ºï¼š
   </para>
   <screen>Examining OpenLDAP Configuration ...
Completed OpenLDAP Configuration Parsing.
Examining Ldifs ...
Completed Ldif Metadata Parsing.
The following migration steps will be performed:
 * Schema Skip Unsupported Attribute -&gt; otherMailbox (0.9.2342.19200300.100.1.22)
 * Schema Skip Unsupported Attribute -&gt; dSAQuality (0.9.2342.19200300.100.1.49)
 * Schema Skip Unsupported Attribute -&gt; singleLevelQuality (0.9.2342.19200300.100.1.50)
 * Schema Skip Unsupported Attribute -&gt; subtreeMinimumQuality (0.9.2342.19200300.100.1.51)
 * Schema Skip Unsupported Attribute -&gt; subtreeMaximumQuality (0.9.2342.19200300.100.1.52)
 * Schema Create Attribute -&gt; suseDefaultBase (SUSE.YaST.ModuleConfig.Attr:2)
 * Schema Create Attribute -&gt; suseNextUniqueId (SUSE.YaST.ModuleConfig.Attr:3)
[...]
 * Schema Create ObjectClass -&gt; suseDhcpConfiguration (SUSE.YaST.ModuleConfig.OC:10)
 * Schema Create ObjectClass -&gt; suseMailConfiguration (SUSE.YaST.ModuleConfig.OC:11)
 * Database Reindex -&gt; dc=example,dc=com
 * Database Import Ldif -&gt; dc=example,dc=com from example.ldif -
excluding entry attributes = [{'structuralobjectclass', 'entrycsn'}]
No actions taken. To apply migration plan, use '--confirm'
</screen>
   <para>
     ä»¥ä¸‹ç¤ºä¾‹ä¼šæ‰§è¡Œè¿ç§»ï¼Œå…¶è¾“å‡ºä¸è¯•è¿è¡Œåçš„è¾“å‡ºä¸åŒï¼š
   </para>
   <screen><prompt>&gt; </prompt><command>sudo</command> <command>openldap_to_ds <replaceable>LDAP1</replaceable> /root/slapd.d <replaceable>/root/LDAP1-COM</replaceable>.ldif --confirm</command>
Starting Migration ... This may take some time ...
migration: 1 / 40 complete ...
migration: 2 / 40 complete ...
migration: 3 / 40 complete ...
[...]
Index task index_all_05252021_120216 completed successfully
post: 39 / 40 complete ...
post: 40 / 40 complete ...
ğŸ‰ Migration complete!
----------------------
You should now review your instance configuration and data:
 * [ ] - Create/Migrate Database Access Controls (ACI)
 * [ ] - Enable and Verify TLS (LDAPS) Operation
 * [ ] - Schedule Automatic Backups
 * [ ] - Verify Accounts Can Bind Correctly
 * [ ] - Review Schema Inconistent ObjectClass -&gt; pilotOrganization (0.9.2342.19200300.100.4.20)
 * [ ] - Review Database Imported Content is Correct -&gt; dc=ldap1,dc=com
</screen>

   <para>
     è¿ç§»å®Œæˆåï¼Œ<command>openldap_to_ds</command> ä¼šåˆ›å»ºå¿…é¡»å®Œæˆçš„è¿ç§»åä»»åŠ¡æ ¸å¯¹æ¸…å•ã€‚æœ€å¥½è®°å½•æ‰€æœ‰è¿ç§»åæ­¥éª¤ï¼Œä»¥ä¾¿å¯ä»¥åœ¨åæœŸç”Ÿäº§è¿‡ç¨‹ä¸­å†ç°è¿™äº›æ­¥éª¤ã€‚ç„¶åæµ‹è¯•å®¢æˆ·ç«¯å’Œåº”ç”¨ç¨‹åºä¸è¿ç§»å 389 Directory Server å®ä¾‹çš„é›†æˆã€‚
   </para>
   <important>
     <title>åˆ¶å®šå›æ»šè®¡åˆ’</title>
     <para>
       å¿…é¡»åˆ¶å®šä¸€ä¸ªå›æ»šè®¡åˆ’ï¼Œä»¥é˜²å‘ç”Ÿä»»ä½•å¤±è´¥ã€‚æ­¤è®¡åˆ’åº”è¯¥å®šä¹‰æˆåŠŸè¿ç§»çš„è¦ç´ ã€ç”¨äºç¡®å®šå“ªäº›æ–¹é¢æ­£å¸¸ä»¥åŠå“ªäº›æ–¹é¢éœ€è¦ä¿®å¤çš„æµ‹è¯•ã€è‡³å…³é‡è¦çš„æ­¥éª¤ã€å¯ä»¥æ¨è¿Ÿçš„äº‹é¡¹ã€å¦‚ä½•ç¡®å®šä½•æ—¶æ’¤æ¶ˆæ›´æ”¹ã€å¦‚ä½•åœ¨å°½é‡å‡å°‘æœåŠ¡ä¸­æ–­çš„æƒ…å†µä¸‹æ’¤æ¶ˆæ›´æ”¹ï¼Œä»¥åŠå…¶ä»–å“ªäº›å›¢é˜Ÿéœ€è¦å‚ä¸è¿ç§»ã€‚
     </para>
   </important>
   <para>
     ç”±äºéƒ¨ç½²çš„å¯å˜æ€§ï¼Œå¾ˆéš¾æä¾›æˆåŠŸè¿›è¡Œç”Ÿäº§è¿ç§»çš„é€šç”¨æ–¹æ³•ã€‚ä¸€æ—¦æ‚¨å…¨é¢æµ‹è¯•äº†è¿ç§»è¿‡ç¨‹å¹¶ç¡®è®¤å¯ä»¥è·å¾—è¾ƒå¥½çš„ç»“æœï¼Œå°±å¯ä»¥é‡‡å–ä¸€äº›æœ‰ç”¨çš„å¸¸è§„æ­¥éª¤ï¼š
   </para>
   <itemizedlist>
    <listitem>
      <para>
        åœ¨åšå‡ºæ›´æ”¹ä¹‹å‰çš„ 48 å°æ—¶å°†æ‰€æœ‰ä¸»æœºå/DNS TTL å‡å°‘è‡³ 5 åˆ†é’Ÿï¼Œä»¥ä¾¿èƒ½å¤Ÿå¿«é€Ÿå›æ»šåˆ°ç°æœ‰çš„ OpenLDAP éƒ¨ç½²ã€‚
      </para>
    </listitem>
    <listitem>
      <para>
        æš‚åœæ‰€æœ‰æ•°æ®åŒæ­¥å’Œä¼ å…¥æ•°æ®è¿›ç¨‹ï¼Œä»¥ç¡®ä¿ OpenLDAP ç¯å¢ƒä¸­çš„æ•°æ®åœ¨è¿ç§»è¿‡ç¨‹ä¸­ä¸ä¼šæ›´æ”¹ã€‚
      </para>
    </listitem>
    <listitem>
      <para>
        åœ¨è¿ç§»ä¹‹å‰å‡†å¤‡å¥½æ‰€æœ‰è¦éƒ¨ç½² 389 Directory Server çš„ä¸»æœºã€‚
      </para>
    </listitem>
    <listitem>
      <para>
        å‡†å¤‡å¥½æµ‹è¯•è¿ç§»æ–‡æ¡£ã€‚
      </para>
    </listitem>
   </itemizedlist>
  </sect2>
 <sect2 xml:id="sec-security-ldap-migrate-plan">
  <title>è§„åˆ’è¿ç§»</title>
  <para>
   ç”±äº OpenLDAP å¦‚åŒä¸€ä¸ª<quote>é›¶ä»¶ç®±</quote>ä¸”é«˜åº¦å¯è‡ªå®šä¹‰ï¼Œå› æ­¤æ— æ³•åˆ¶å®šå‡º<quote>æ”¾ä¹‹å››æµ·çš†å‡†</quote>çš„è¿ç§»è®¡åˆ’ã€‚æœ‰å¿…è¦é’ˆå¯¹ OpenLDAP å’Œå…¶ä»–é›†æˆè¯„ä¼°æ‚¨çš„å½“å‰ç¯å¢ƒå’Œé…ç½®ã€‚è¿™åŒ…æ‹¬ä½†ä¸é™äºï¼š
  </para>
  <itemizedlist>
   <listitem>
    <para>
     å¤åˆ¶æ‹“æ‰‘
    </para>
   </listitem>
   <listitem>
    <para>
     é«˜å¯ç”¨æ€§å’Œè´Ÿè½½å¹³è¡¡å™¨é…ç½®
    </para>
   </listitem>
   <listitem>
    <para>
     å¤–éƒ¨æ•°æ®æµï¼ˆIGAã€HRã€AD ç­‰ï¼‰
    </para>
   </listitem>
   <listitem>
    <para>
     é…ç½®çš„å åŠ ç»„ä»¶ï¼ˆ389 Directory Server ä¸­çš„æ’ä»¶ï¼‰
    </para>
   </listitem>
   <listitem>
    <para>
     å®¢æˆ·ç«¯é…ç½®å’Œé¢„æœŸçš„æœåŠ¡å™¨åŠŸèƒ½
    </para>
   </listitem>
   <listitem>
    <para>
     è‡ªå®šä¹‰çº²è¦
    </para>
   </listitem>
   <listitem>
    <para>
     TLS é…ç½®
    </para>
   </listitem>
  </itemizedlist>
  <para>
   è§„åˆ’ 389 Directory Server éƒ¨ç½²çš„æœ€ç»ˆå¤§è‡´ç»“æœã€‚æ­¤é¡¹è§„åˆ’åŒ…å«çš„å†…å®¹ä¸ä¸Šé¢çš„åˆ—è¡¨ç›¸åŒï¼Œä¸è¿‡éœ€è¦å°†å åŠ ç»„ä»¶æ›¿æ¢ä¸ºæ’ä»¶ã€‚è¯„ä¼°å½“å‰ç¯å¢ƒå¹¶è§„åˆ’æ‚¨çš„ 389 Directory Server ç¯å¢ƒå°†ä¼šæ˜¯ä»€ä¹ˆæ ·ä¹‹åï¼Œä¾¿å¯ä»¥åˆ¶å®šè¿ç§»è®¡åˆ’ã€‚å»ºè®®æ„å»ºä¸ OpenLDAP ç¯å¢ƒå¹¶è¡Œçš„ 389 Directory Server ç¯å¢ƒï¼Œä»¥ä¾¿å¯ä»¥åœ¨ä¸¤è€…ä¹‹é—´åˆ‡æ¢ã€‚
  </para>
  <para>
   ä» OpenLDAP è¿ç§»åˆ° 389 Directory Server å±äºå•å‘è¿ç§»ã€‚ä¸¤è€…ä¹‹é—´çš„å·®å¼‚ç›¸å½“å¤§ï¼Œå› æ­¤å®ƒä»¬ä¸å¯äº’æ“ä½œï¼Œå¹¶ä¸”ä¸å­˜åœ¨ä» 389 Directory Server åˆ° OpenLDAP çš„è¿ç§»è·¯å¾„ã€‚ä¸‹è¡¨é‡ç‚¹æŒ‡å‡ºäº†ä¸¤è€…çš„ä¸»è¦ç›¸ä¼¼å’Œä¸åŒä¹‹å¤„ã€‚
  </para>
  <informaltable>
   <tgroup cols="4">
    <thead>
     <row>
      <entry>åŠŸèƒ½</entry>
      <entry>OpenLDAP</entry>
      <entry>389 Directory Server</entry>
      <entry>å…¼å®¹</entry>
     </row>
    </thead>
    <tbody>
     <row>
      <entry>åŒå‘å¤åˆ¶</entry>
      <entry>SyncREPL</entry>
      <entry>ç‰¹å®šäº 389 DS çš„ç³»ç»Ÿ</entry>
      <entry>å¦</entry>
     </row>
     <row>
      <entry>MemberOf</entry>
      <entry>å åŠ ç»„ä»¶</entry>
      <entry>æ’ä»¶</entry>
      <entry>æ˜¯ï¼Œä»…é™ç®€å•é…ç½®</entry>
     </row>
     <row>
      <entry>å¤–éƒ¨èº«ä»½éªŒè¯</entry>
      <entry>ä»£ç†</entry>
      <entry>-</entry>
      <entry>å¦</entry>
     </row>
     <row>
      <entry>Active Directory åŒæ­¥</entry>
      <entry>-</entry>
      <entry>Winsync æ’ä»¶</entry>
      <entry>å¦</entry>
     </row>
     <row>
      <entry>å†…ç½®çº²è¦</entry>
      <entry>OLDAP çº²è¦</entry>
      <entry>389 Directory Server çº²è¦</entry>
      <entry>æ˜¯ï¼Œå—è¿ç§»å·¥å…·æ”¯æŒ</entry>
     </row>
     <row>
      <entry>è‡ªå®šä¹‰çº²è¦</entry>
      <entry>OLDAP çº²è¦</entry>
      <entry>389 Directory Server çº²è¦</entry>
      <entry>æ˜¯ï¼Œå—è¿ç§»å·¥å…·æ”¯æŒ</entry>
     </row>
     <row>
      <entry>æ•°æ®åº“å¯¼å…¥</entry>
      <entry>LDIF</entry>
      <entry>LDIF</entry>
      <entry>æ˜¯ï¼Œå—è¿ç§»å·¥å…·æ”¯æŒ</entry>
     </row>
     <row>
      <entry>å£ä»¤å“ˆå¸Œ</entry>
      <entry>ä¸ç¡®å®š</entry>
      <entry>ä¸ç¡®å®š</entry>
      <entry>æ˜¯ï¼Œæ”¯æŒé™¤ Argon2 ä»¥å¤–çš„æ‰€æœ‰æ ¼å¼</entry>
     </row>
     <row>
      <entry>OpenLDAP åˆ° 389 DS çš„å¤åˆ¶</entry>
      <entry>-</entry>
      <entry>-</entry>
      <entry>ä¸æä¾›ç”¨äºå¤åˆ¶åˆ° 389 DS çš„æœºåˆ¶</entry>
     </row>
     <row>
      <entry>åŸºäºæ—¶é—´çš„ä¸€æ¬¡æ€§å£ä»¤ (TOTP)</entry>
      <entry>TOTP å åŠ ç»„ä»¶</entry>
      <entry>-</entry>
      <entry>å¦ï¼Œç›®å‰ä¸æ”¯æŒ</entry>
     </row>
     <row>
      <entry>entryUUID</entry>
      <entry>OpenLDAP çš„ç»„æˆéƒ¨åˆ†</entry>
      <entry>æ’ä»¶</entry>
      <entry>æ˜¯</entry>
     </row>
    </tbody>
   </tgroup>
  </informaltable>
 </sect2>
</sect1>
