<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="deployment_image.xml" version="5.0" role="General" xml:id="cha-deployment-clone-image">
 <title>Clonando imagens de disco</title>
 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:bugtracker/>
   <dm:translation>sim</dm:translation>
  </dm:docmanager>
 </info>
 <para>
  Se o <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> estiver instalado em um ambiente virtualizado, a clonagem de uma instalação existente poderá ser o meio mais rápido de implantar outras máquinas. O <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> inclui um script para limpeza de configuração que é exclusivo para cada instalação. Com a introdução do systemd, identificadores exclusivos do sistema são usados e definidos em diferentes arquivos e locais. Portanto, a clonagem não é mais o método recomendado de criação de imagens do sistema. É possível criar imagens com o KIWI. Visite <link xlink:href="https://doc.opensuse.org/projects/kiwi/doc/"/>
 </para>
 <para>
  Para clonar discos de máquinas, consulte a documentação do seu ambiente de virtualização.
 </para>
 <sect1 xml:id="sec-deployment-clone-image-clean">
  <title>Limpando identificadores exclusivos do sistema</title>
  <warning>
   <title>Perda de configuração importante</title>
   <para>
    A execução do procedimento a seguir apaga permanentemente os dados de configuração importante do sistema. Se o sistema de origem para o clone for usado em produção, execute o script de limpeza na imagem clonada.
   </para>
  </warning>
  <para>
   Para limpar todos os identificadores exclusivos do sistema, execute o procedimento a seguir antes ou depois de clonar uma imagem de disco. Se a execução for feita no clone, esse procedimento precisará ser executado em cada clone. Portanto, é recomendável criar uma <literal>imagem mestre</literal> que não seja usada em produção e sirva apenas como fonte para novos clones. A imagem mestre já é limpa, e os clones podem ser usados imediatamente.
  </para>
  <para>
   Por exemplo, o comando <command>clone-master-clean-up</command> remove: 
  </para>
  <itemizedlist>
   <listitem>
    <para>Arquivos de troca (swap)</para>
   </listitem>
   <listitem>
    <para>Repositórios Zypper</para>
   </listitem>
   <listitem>
    <para>Host SSH e chaves de cliente</para>
   </listitem>
   <listitem>
    <para>Diretórios temporários, como <filename>/tmp/*</filename></para>
   </listitem>
   <listitem>
    <para>Dados Postfix</para>
   </listitem>
   <listitem>
    <para>Script de firewall HANA</para>
   </listitem>
   <listitem>
    <para>Diário do systemd</para>
   </listitem>
  </itemizedlist>
  <procedure>
   <step>
    <para>
     Use o <command>zypper</command> para instalar o <package>clone-master-clean-up</package>:
    </para>
    <screen><prompt role="root">root # </prompt><command>zypper</command> install clone-master-clean-up</screen>
   </step>
   <step>
    <para>
     Configure o comportamento do <command>clone-master-clean-up</command> editando o <filename>/etc/sysconfig/clone-master-clean-up</filename>. Esse arquivo de configuração define se os usuários com UID maior do que 1000, o arquivo <filename>/etc/sudoers</filename>, os repositórios Zypper e os instantâneos do Btrfs devem ser removidos.
    </para>
   </step>
   <step>
    <para>
     Para remover a configuração e os identificadores exclusivos existentes, execute o script:
    </para>
    <screen><prompt role="root">root # </prompt><command>clone-master-clean-up</command></screen>
   </step>
  </procedure>
 </sect1>
</chapter>
