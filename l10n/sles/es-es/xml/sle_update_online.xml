<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="sle_update_online.xml" version="5.0" xml:id="cha-upgrade-online">
 <title>Actualización con conexión</title>
 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:bugtracker/>
   <dm:translation>sí</dm:translation>
  </dm:docmanager>
  <abstract>
   <para>
    SUSE ofrece una herramienta gráfica intuitiva y una de línea de comandos sencilla para actualizar un sistema en ejecución a un nuevo paquete de servicio. Proporcionan asistencia para la <quote>revertir</quote> la actualización de los paquetes de servicios y otros elementos. En este capítulo se explica cómo realizar paso a paso una actualización del paquete de servicio con estas herramientas.
   </para>
  </abstract>
 </info>
 <sect1 xml:id="sec-upgrade-online-conceptual-overview">
  <title>Descripción conceptual</title>

  <para>
   SUSE publica nuevos paquetes de servicio para la familia de SUSE Linux Enterprise a intervalos regulares. Para facilitar a los clientes la migración a un nuevo paquete de servicio y reducir el tiempo de inactividad, SUSE admite la migración en línea mientras se esté ejecutando el sistema.
  </para>

  <para>
   A partir de SLE 12, YaST Wagon se ha sustituido por la migración de YaST (GUI) y la migración de Zypper (línea de comandos). Esto presenta las siguientes ventajas:
  </para>

  <itemizedlist>
   <listitem>
    <para>
     El sistema siempre está en un estado definido hasta que se actualiza el primer RPM.
    </para>
   </listitem>
   <listitem>
    <para>
     Es posible cancelar hasta que se actualiza el primer RPM.
    </para>
   </listitem>
   <listitem>
    <para>
     La recuperación es fácil si se produce un error.
    </para>
   </listitem>
   <listitem>
    <para>
     Es posible <quote>realizar una reversión</quote> mediante las herramientas del sistema sin necesidad de hacer copias de seguridad ni restaurarlas.
    </para>
   </listitem>
   <listitem>
    <para>
     Se usan todos los repositorios activos.
    </para>
   </listitem>
   <listitem>
    <para>
     Es posible omitir un paquete de servicio.
    </para>
   </listitem>
  </itemizedlist>

  <warning>
   <title>la migración en línea no es compatible con las versiones principales</title>
   <para>
    La migración en línea <emphasis>solo</emphasis> es compatible con la migración entre paquetes de servicio. La migración en línea <emphasis>no es compatible</emphasis> con la actualización a nuevas versiones principales. Para obtener información, consulte <xref linkend="cha-upgrade-paths"/>.
   </para>
   <para>
    Utilice la migración sin conexión para realizar la actualización a una nueva versión principal. Para obtener información, consulte <xref linkend="cha-upgrade-offline"/>.
   </para>
  </warning>

  <important>
   <title>actualización de clientes de SUSE Manager</title>
   <para>Si el sistema que va a actualizar es un cliente de SUSE Manager, no se puede actualizar mediante la migración en línea de YaST ni mediante la <command>migración de zypper.</command> Utilice en su lugar el procedimiento de <citetitle>migración de cliente.</citetitle> Se describe en la <link xlink:href="https://documentation.suse.com/suma/">
    <citetitle>Guía de actualización de SUSE Manager</citetitle></link>.
   </para>
  </important>

 </sect1>
 <sect1 xml:id="sec-upgrade-online-workflow">
  <title>Flujo de trabajo de migración del paquete de servicio</title>

  <para>
   Es posible ejecutar una migración del paquete de servicio mediante YaST, <command>zypper</command> o AutoYaST.
  </para>

  <para>
   Antes de que pueda iniciar una migración de paquete de servicio, el sistema debe estar registrado en el Centro de servicio al cliente de SUSE o en un servidor RMT local. También puede utilizarse SUSE Manager.
  </para>

  <para>
   Independientemente del método utilizado, la migración de un paquete de servicio consta de los pasos siguientes:
  </para>

  <orderedlist>
   <listitem>
    <para>
     Buscar posibles destinos de migración en los sistemas registrados.
    </para>
   </listitem>
   <listitem>
    <para>
     Seleccionar un destino de migración.
    </para>
   </listitem>
   <listitem>
    <para>
     Pedir y habilitar nuevos repositorios.
    </para>
   </listitem>
   <listitem>
    <para>
     Ejecutar la migración.
    </para>
   </listitem>
  </orderedlist>

  <para>
   La lista de destinos de migración depende de los productos que haya instalado y registrado. Si tiene una extensión instalada para la que aún no haya disponible un paquete de servicio nuevo, puede que no se le ofrezca ningún destino de migración.
  </para>

  <para>
   La lista de destinos de migración disponibles para el host siempre se recupera desde el Centro de servicios al cliente de SUSE y depende de los productos o extensiones instalados.
  </para>
 </sect1>
 <sect1 xml:id="sec-upgrade-online-cancel">
  <title>Cancelación de la migración del paquete de servicio</title>

  <para>
   La migración del paquete de servicio solo se puede cancelar en etapas concretas durante el proceso de migración:
  </para>

  <orderedlist>
   <listitem>
    <para>
     Hasta que se inicia la actualización del paquete, solo hay cambios mínimos en el sistema, como en los servicios y repositorios. Restaure <filename>/etc/zypp/repos.d/*</filename> para revertir el sistema al estado anterior.
    </para>
   </listitem>
   <listitem>
    <para>
     Cuando se inicia la actualización del paquete, puede volver al estado anterior mediante una instantánea de Snapper (consulte <xref linkend="cha-snapper"/>).
    </para>
   </listitem>
   <listitem>
    <para>
     Después de seleccionar el destino de migración, el Centro de servicios al cliente de SUSE cambia los datos del repositorio. Para revertir este estado manualmente, utilice <command>SUSEConnect</command>
     <option> --rollback</option>.
    </para>
   </listitem>
  </orderedlist>
 </sect1>
 <sect1 xml:id="sec-upgrade-online-yast">
  <title>Actualización con la herramienta de migración en línea (YaST)</title>

  <para>
   Para realizar la migración de un paquete de servicio con YaST, use la herramienta <guimenu>Migración en línea</guimenu>. Por defecto, YaST no instala ningún paquete desde repositorios de otros fabricantes. Si se ha instalado un paquete desde un repositorio de otro fabricante, YaST impide que los paquetes se sustituyan por los mismos paquetes provenientes de SUSE.
  </para>

  <note>
   <title>reducción del tamaño de la instalación</title>
   <para>
    Al realizar la migración del paquete de servicio, YaST instala todos los paquetes recomendados. Especialmente en el caso de las instalaciones mínimas personalizadas, esto puede aumentar el tamaño de instalación del sistema considerablemente.
   </para>
   <para>
    Para cambiar este comportamiento por defecto y permitir solo los paquetes necesarios, ajuste la opción <option>solver.onlyRequires</option> en <filename>/etc/zypp/zypp.conf</filename>.
   </para>
<screen>solver.onlyRequires = true</screen>
   <para>
    Además, edite el archivo <filename>/etc/zypp/zypper.conf</filename> y cambie la opción <option>installRecommends</option>.
   </para>
   <screen>installRecommends=false</screen>
   <para>
    Esto cambia el comportamiento de todas las operaciones del paquete, como la instalación de parches o nuevos paquetes. Para cambiar el comportamiento de Zypper para una sola llamada, añada el parámetro <option>--no-recommends</option> en la línea de comandos.
  </para>
</note>

  <para>
   Para iniciar la migración del paquete de servicio, haga lo siguiente:
  </para>

  <procedure xml:id="pro-upgrade-online-yast">
   <step>
    <para>
     Desactive todas las extensiones sin usar del servidor de registro para evitar futuros conflictos de dependencias. Si olvida una extensión, YaST detectará posteriormente los repositorios de extensiones no utilizados y los desactivará.
    </para>
   </step>
   <step>
    <para>
     Si ha entrado en una sesión de GNOME que se esté ejecutando en el equipo que va a actualizar, cambie a una consola de texto. No se recomienda ejecutar la actualización desde una sesión de GNOME. Tenga en cuenta que esto no se aplica cuando se entra desde un equipo remoto (a menos que esté ejecutando una sesión de VNC con GNOME).
    </para>
   </step>
  
   <step>
    <para>
     Ejecute la actualización en línea de YaST para obtener las actualizaciones más recientes del paquete para su sistema.
    </para>
   </step>
   <step>
    <para>
     Instale el paquete
     <package>yast2-migration</package>
     y sus dependencias (en YaST en <menuchoice>
     <guimenu> Software</guimenu> <guimenu> Gestión de software</guimenu>
     </menuchoice>).
    </para>
   </step>
   <step>
    <para>
     Reinicie YaST, o el módulo recién instalado no se mostrará en el Centro de control.
    </para>
   </step>
   <step>
    <para>
     En YaST, seleccione <guimenu>Migración en línea</guimenu> (según la versión de <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> desde la que vaya a actualizar, este módulo se categoriza como <guimenu>Sistema</guimenu> o <guimenu>Software</guimenu>). YaST muestra los destinos de migración posibles y un resumen. Si hay disponible más de un destino de migración para el sistema, seleccione uno en la lista.
    </para>
   </step>
   <step>
    <para>
     Seleccione un destino de migración de la lista y haga clic en <guimenu>Siguiente</guimenu>.
    </para>
   </step>
   <step>
    <para>
     En caso de que la herramienta de migración ofrezca repositorios de actualización, se recomienda continuar haciendo clic en <guimenu>Sí</guimenu>.
    </para>
   </step>
   <step>
    <para>
     <remark>toms 2015-09-09: FATE#319140</remark> Si la herramienta Migración en línea encuentra repositorios obsoletos provenientes del DVD o de un servidor local, se recomienda encarecidamente inhabilitarlos. Los repositorios obsoletos proceden de un paquete de servicio anterior. Los repositorios antiguos del Centro de servicios al cliente de SUSE o de RMT se eliminan automáticamente.
    </para>
   </step>
   <step>
    <para>
     Revise el resumen y haga clic en <guimenu>Siguiente</guimenu> para continuar con la migración. Para confirmar, haga clic en <guimenu>Iniciar actualización</guimenu>.
    </para>
    <remark>toms 2016-07-13: What to do in case of problems?</remark>
   </step>
   <step>
    <para>
     Cuando se complete correctamente la migración, reinicie el sistema.
    </para>
   </step>
  </procedure>
 </sect1>
 <sect1 xml:id="sec-upgrade-online-zypper">
  <title>Actualización con Zypper</title>

  <para>
   Para realizar la migración de un paquete de servicio con Zypper, use la herramienta de línea de comandos <command>zypper</command> <option> migration</option> del paquete
   <package>zypper-migration-plugin</package>.
  </para>

  <note>
   <title>reducción del tamaño de la instalación</title>
   <para>
    Al realizar la migración del paquete de servicio, YaST instala todos los paquetes recomendados. Especialmente en el caso de las instalaciones mínimas personalizadas, esto puede aumentar el tamaño de instalación del sistema considerablemente.
   </para>
   <para>
    Para cambiar este comportamiento por defecto y permitir solo los paquetes necesarios, ajuste la opción <option>solver.onlyRequires</option> en <filename>/etc/zypp/zypp.conf</filename>.
   </para>
<screen>solver.onlyRequires = true</screen>
   <para>
    Además, edite el archivo <filename>/etc/zypp/zypper.conf</filename> y cambie la opción <option>installRecommends</option>.
   </para>
   <screen>installRecommends=false</screen>
   <para>
    Esto cambia el comportamiento de todas las operaciones del paquete, como la instalación de parches o nuevos paquetes. Para cambiar el comportamiento de Zypper para una sola llamada, añada el parámetro <option>--no-recommends</option> en la línea de comandos.
  </para>
</note>

  <para>
   Para iniciar la migración del paquete de servicio, haga lo siguiente:
  </para>

  <procedure xml:id="pro-upgrade-online-zypper">
   <step>
    <para>
     Si ha entrado en una sesión de GNOME que se esté ejecutando en el equipo que va a actualizar, cambie a una consola de texto. No se recomienda ejecutar la actualización desde una sesión de GNOME. Tenga en cuenta que esto no se aplica cuando se entra desde un equipo remoto (a menos que esté ejecutando una sesión de VNC con GNOME).
    </para>
   </step>
   <step>
    <para>
     Si aún no lo ha hecho, registre el equipo en SUSE Linux Enterprise:
    </para>
<screen><prompt>tux &gt; </prompt><command>sudo</command> <command>SUSEConnect</command> --regcode <replaceable>YOUR_REGISTRATION_CODE</replaceable></screen>
   </step>
  
   <step>
    <para>
     Inicie la migración:
    </para>
<screen><prompt>tux &gt; </prompt><command>sudo</command> <command>zypper migration</command></screen>
    <para>
     Notas sobre el proceso de migración:
    </para>
    <itemizedlist>
     <listitem>
      <para>
       Si hay disponible más de un destino de migración para el sistema, Zypper permite seleccionar uno en la lista. Esto es lo mismo que omitir uno o varios paquetes de servicio. Tenga en cuenta que la migración en línea de productos base (SLES y SLED) sigue estando disponible solo entre los paquetes de servicio de una versión principal.
      </para>
     </listitem>
     <listitem>
      <para>
       Por defecto, Zypper usa la opción <option>--no-allow-vendor-change</option>, que se pasa a <command>zypper</command> <option> dup</option>. Si se ha instalado un paquete desde un repositorio de otro fabricante, esta opción impide que los paquetes se sustituyan por los mismos paquetes provenientes de SUSE.
      </para>
     </listitem>
     <listitem>
      <para>
       <remark>toms 2015-09-09: FATE#319140</remark> Si Zypper encuentra repositorios obsoletos provenientes del DVD o de un servidor local, se recomienda encarecidamente inhabilitarlos. Los repositorios antiguos del Centro de servicios al cliente de SUSE o de RMT se eliminan automáticamente.
      </para>
     </listitem>
    </itemizedlist>
   </step>
   <step>
    <para>
     Revise todos los cambios, sobre todo los paquetes que se van a eliminar. Para continuar, escriba <literal>y</literal> (el número exacto de paquetes para actualizar puede variar en su sistema):
    </para>
<screen>266 packages to upgrade, 54 to downgrade, 17 new, 8 to reinstall, 5 to remove, 1 to change arch.
Overall download size: 285.1 MiB. Already cached: 0 B  After the operation, additional 139.8 MiB will be used.
Continue? [y/n/? shows all options] (y):</screen>
    <para>
     Use las teclas <keycombo> <keycap function="shift"/> <keycap function="pageup"/>
     </keycombo>    o <keycombo> <keycap function="shift"/>
     <keycap function="pagedown"/> </keycombo>    para desplazarse por la shell.
    </para>
   </step>
   <step>
    <para>
     Cuando se complete correctamente la migración, reinicie el sistema.
    </para>
   </step>
  </procedure>
 </sect1>
 <sect1 xml:id="sec-upgrade-online-zypper-plain">
  <title>Actualización con Zypper simple</title>

  <para>
   Si el sistema no se registra porque el usuario no tiene acceso a Internet ni a un servidor de registro, no es posible migrar a un nuevo paquete de servicio con la migración de YaST ni con la <command>migración de zypper</command>. En ese caso, puede realizar la migración a un nuevo paquete de servicio con Zypper simple y algunas interacciones manuales.
  </para>

  <important>
   <title>solo para sistemas no registrados</title>
   <para>
    Esta vía de migración a un nuevo paquete de servicio <emphasis>solo</emphasis> se admite en los sistemas no registrados que no tienen acceso a Internet o a un servidor de registro. Por ejemplo, puede ser el caso de equipos que se encuentren en una red especialmente protegida. En caso de que tenga un sistema registrado, utilice la migración de YaST o de Zypper.
   </para>
  </important>

  <important>
   <title>orígenes de instalación</title>
   <para>
    Esta vía de migración requiere que se proporcionen los orígenes de instalación para el nuevo paquete de servicio en una ubicación a la que pueda acceder el equipo que va a migrar. Puede hacerlo, por ejemplo, configurando un servidor RMT o un servidor SLP.
   </para>
   <para>
    También es necesario que el sistema tenga acceso a un repositorio de actualización que esté al día para la versión del producto instalada.
   </para>
  </important>

  <procedure>
   <step>
    <para>
     Si ha entrado en una sesión gráfica que se ejecuta en la máquina que va a migrar, salga y cambie a una consola de texto. No se recomienda ejecutar la actualización desde una sesión gráfica. Tenga en cuenta que esto no se aplica cuando se entra desde un equipo remoto (a menos que esté ejecutando una sesión de VNC con X).
    </para>
   </step>
   <step>
    <para>
     Actualice las herramientas de gestión del paquete con los repositorios de SUSE Linux Enterprise anteriores:
    </para>
<screen><prompt>tux &gt; </prompt><command>sudo</command> <command>zypper</command> patch --updatestack-only</screen>
   </step>
   <step>
    <para>
     Obtenga una lista de los paquetes que no tienen un repositorio asignado actualmente (paquetes huérfanos). Estos paquetes no se migrarán y no se garantiza que funcionen después de la migración (dado que otros paquetes de los que puedan depender hayan cambiado de forma que ya no sean compatibles). Para obtener la lista, ejecute:
    </para>
    <screen><prompt>tux &gt; </prompt><command>sudo</command> zypper packages --orphaned</screen>
    <para>
     Repase cuidadosamente la lista y elimine todos los paquetes huérfanos que ya no sean necesarios. Anote todos los paquetes huérfanos restantes; necesitará esta información más adelante para compararlos.
    </para>
   </step>
   <step>
    <para>
     Obtenga una lista de todos los repositorios a los que está suscrito actualmente el sistema. Para ello, ejecute:
    </para>
    <screen><prompt>tux &gt; </prompt><command>sudo</command> zypper repos -u</screen>
    <para>
     Actualice la URL de cada repositorio para que el número de versión del producto sea <literal>15-SP3</literal>. Por ejemplo, si la URL de un repositorio es
    </para>
<screen>http://rmt.example.com/repo/SUSE/Products/SLE-15-SP2-Product-SLES/x86_64/product/</screen>
    <para>
     cámbiela a
    </para>
<screen>http://rmt.example.com/repo/SUSE/Products/SLE-15-SP3-Product-SLES/x86_64/product/</screen>
    <para>
     Esto debe llevarse a cabo con todos los repositorios habilitados. Puede resultar útil hacerlo también para los repositorios que están inhabilitados, para evitar que haya orígenes de instalación erróneos en el sistema cuando se activen más adelante.
    </para>
    <para>
     Para modificar las URL de los repositorios, tiene las opciones siguientes:
    </para>
    <substeps>
     <step>
      <para>
       Mediante <menuchoice> <guimenu>YaST</guimenu> <guimenu>Software</guimenu>
       <guimenu>Repositorios de software</guimenu></menuchoice>. Seleccione un repositorio y haga clic en <guimenu>Editar</guimenu> para realizar los cambios necesarios. Repita este paso para todos los repositorios.
      </para>
     </step>
     <step>
      <para>
       Mediante Zypper. Elimine el repositorio antiguo ejecutando
      </para>
<screen><prompt>tux &gt; </prompt><command>sudo</command> zypper removerepo <replaceable>OLD_REPO_ID</replaceable></screen>
      <para>
       A continuación, añada el nuevo repositorio correspondiente ejecutando
      </para>
<screen> <prompt>tux &gt; </prompt><command>sudo</command> zypper addrepo -f <replaceable>URL</replaceable> <replaceable>NAME</replaceable>-15-SP3</screen>
      </step>
     <step>
      <para>
       Editando los archivos de configuración del repositorio en <filename>/etc/zypp/repos.d</filename>. Cada repositorio se representa mediante un archivo de configuración. Es necesario cambiar el valor del parámetro <literal>baseurl</literal> en cada archivo.
      </para>
     </step>
    </substeps>
   </step>
   <step>
    <para>
     Revise los cambios ejecutando <command>zypper repos -u</command> y actualice los repositorios con:
    </para>
    <screen><prompt>tux &gt; </prompt><command>sudo</command> zypper refresh -f -s</screen>
    <para>
     En caso de que falle la actualización de un repositorio, compruebe si ha introducido una URL errónea. Si el problema no se puede solucionar, se recomienda inhabilitar el repositorio que falla.
    </para>
    <para>
     Si todos los repositorios están configurados correctamente, ejecute de nuevo:
    </para>
    <screen><prompt>tux &gt; </prompt><command>sudo</command> zypper refresh -f -s</screen>
    <para>
     Así se asegurará de que <emphasis>todos</emphasis> los repositorios están actualizados.
    </para>
   </step>
   <step>
    <para>
     Antes de iniciar la migración, se recomienda realizar una ejecución de prueba:
    </para>
<screen><prompt>tux &gt; </prompt><command>sudo</command> zypper dup -D --no-allow-vendor-change --no-recommends</screen>
    <para>
     El parámetro <option>-D</option> lleva a cabo una ejecución de simulación para probar la migración sin modificar realmente el sistema. Si se producen problemas, corríjalos antes de continuar. En caso de que la ejecución de prueba se realice correctamente, realice la migración real ejecutando:
    </para>
    <screen><prompt>tux &gt; </prompt><command>sudo</command> zypper dup --no-allow-vendor-change --no-recommends</screen>
    <para>
     <option>-no-allow-vendor-change</option> garantiza que los RPM de otros fabricantes no sobrescriban los RPM del sistema base. La opción <option>--no-recommends</option> garantiza que el paquete deseleccionado durante la instalación inicial no se añadirá de nuevo.
    </para>
   </step>
   <step>
    <para>
     Después de que finalice la migración y se haya arrancado el sistema con la nueva versión del paquete de servicio, ejecute de nuevo la comprobación de paquetes huérfanos:
    </para>
    <screen><prompt>tux &gt; </prompt><command>sudo</command> zypper packages --orphaned</screen>
    <para>
     Compare la nueva lista con la que generó antes de iniciar la migración. Si hay nuevos paquetes en la lista, puede deberse a que se hayan trasladado a un módulo diferente en el nuevo paquete de servicio. Si no tenía ese módulo en la instalación anterior, el paquete no se habrá actualizado.
    </para>
    <para>
     Puede comprobar a qué módulo pertenece un paquete en <link xlink:href="https://scc.suse.com/packages"/>. Añada los módulos que faltan con <command>zypper addrepo</command> o con el módulo de repositorios de software de YaST y, después, actualice los paquetes huérfanos ejecutando:
    </para>
    <screen><prompt>tux &gt; </prompt><command>sudo</command> zypper install --no-recommends <replaceable>LIST OF PACKAGES</replaceable></screen>
   </step>
   <step>
    <para>
     Ya ha completado correctamente la migración a un nuevo paquete de servicio.
    </para>
   </step>
  </procedure>
 </sect1>

 <sect1 xml:id="sec-upgrade-online-rollback">
  <title>Reversión de un paquete de servicio</title>

  <para>
   Si un paquete de servicio no funciona, SUSE Linux Enterprise permite revertir el sistema a su estado anterior antes de iniciar la migración. Uno de los requisitos previos es una partición de raíz Btrfs con las instantáneas habilitadas (se trata de la opción por defecto desde SLES 12). Para obtener más información, consulte: <xref linkend="cha-snapper"/>.
  </para>

  <procedure xml:id="pro-upgrade-online-rollback">
   <step>
    <para>
     Obtenga una lista de todas las instantáneas de Snapper:
    </para>
    <screen><prompt>tux &gt; </prompt><command>sudo</command> snapper list</screen>
    <para>
     Revise el resultado para localizar la instantánea que se creó inmediatamente antes de la migración del paquete de servicios. La columna <guimenu>Descripción</guimenu> contiene la instrucción correspondiente y la instantánea está marcada como <literal>importante</literal> en la columna <guimenu>Información del usuario.</guimenu> Memorice el número de la instantánea de la columna <guimenu>n.º</guimenu> y la fecha de la columna <guimenu>Fecha</guimenu>.
    </para>
   </step>
   <step>
    <para>
     Rearranque el sistema. En el menú de arranque, seleccione <guimenu>Iniciar cargador de arranque desde una instantánea de solo lectura</guimenu> y, a continuación, la instantánea con la fecha y el número que memorizó en el paso anterior. Se carga un segundo menú de arranque (el de la instantánea). Seleccione la entrada que empieza por SLES <phrase role="productnumber"><phrase os="sles;sled">15 SP3</phrase></phrase> y arránquela.
    </para>
   </step>
   <step>
    <para>
     El sistema arranca en el estado anterior con la partición de sistema montada como de solo lectura. Entre como usuario <systemitem class="username">root</systemitem> y compruebe si ha elegido la instantánea correcta. Asegúrese también de que todo funciona como se espera. Tenga en cuenta que, ya que el sistema de archivos raíz se monta como de solo lectura, pueden aplicarse restricciones a la funcionalidad.
    </para>
    <para>
     En caso de problemas o si ha arrancado la instantánea equivocada, vuelva a arrancar y elija otra instantánea de arranque: hasta este momento no se han realizado cambios permanentes. Si la instantánea es correcta y funciona como se espera, haga permanente el cambio ejecutando el comando siguiente:
    </para>
    <screen><prompt>tux &gt; </prompt><command>sudo</command> snapper rollback</screen>
    <para>
     A continuación, vuelva a arrancar. En la pantalla de arranque, seleccione la entrada de arranque por defecto para arrancar en el sistema restablecido.
    </para>
   </step>
   <step>
    <para>
     Compruebe si la configuración del repositorio se ha restablecido correctamente. Compruebe también que todos los productos estén correctamente registrados. Si alguno de los elementos anteriores no se cumple, podría darse el caso de que no funcione la actualización del sistema a un momento posterior o que el sistema se actualice con los repositorios de paquetes erróneos.
    </para>
    <para>
     Asegúrese de que el sistema tiene acceso a Internet antes de iniciar este procedimiento.
    </para>
    <substeps>
     <step>
      <para>
       Para actualizar los servicios y los repositorios, ejecute:
      </para>
      <screen><prompt>tux &gt; </prompt><command>sudo</command> zypper ref -fs</screen>
     </step>
     <step>
      <para>
       Para obtener una lista de los repositorios activos, ejecute:
      </para>
      <screen><prompt>tux &gt; </prompt><command>sudo</command> zypper lr</screen>
      <para>
       Compruebe con atención el resultado de este comando. No debería aparecer ningún servicio ni repositorio que se haya añadido para la actualización. Por ejemplo, si realiza una reversión de SLES <phrase role="productnumber"><phrase os="sles;sled">15 SP3</phrase></phrase> a SLES 15 GA, la lista debe contener los repositorios <literal>SLES15-GA</literal>, y no los repositorios <literal>SLES15-SP3</literal>.
      </para>
      <para>
       Si se muestran repositorios incorrectos, suprímalos y, si fuera necesario, sustitúyalos por las versiones que coinciden con su versión de producto o de paquete de servicios. Para obtener una lista de los repositorios para las vías de migración admitidas, consulte la <xref linkend="sec-upgrade-background-modules"/>. Tenga en cuenta que la intervención manual no debería ser necesaria, ya que los repositorios deben haberse actualizado automáticamente; pero se trata de una práctica recomendada para verificar y realizar las correcciones necesarias.
      </para>
     </step>
     <step>
      <para>
       Por último, para comprobar el estado de registro de todos los productos instalados, ejecute:
      </para>
      <screen><prompt>tux &gt; </prompt><command>sudo</command> SUSEConnect --status</screen>
      <para>
       Todos los productos deben mostrarse como <literal>registrados</literal>. Si no fuera el caso, para reparar el registro ejecute:
      </para>
      <screen><prompt>tux &gt; </prompt><command>sudo</command> SUSEConnect --rollback</screen>
     </step>
    </substeps>
   </step>
  </procedure>
  <para>
   Ya ha revertido correctamente el sistema al estado que se capturó inmediatamente antes de que se iniciara la migración del paquete de servicios.
  </para>
 </sect1>

 <sect1 xml:id="sec-upgrade-online-manager">
  <title>Actualización con SUSE Manager</title>

  <para>
   SUSE Manager es una solución de servidor para proporcionar actualizaciones, parches y soluciones de seguridad para los clientes de SUSE Linux Enterprise. Incorpora un conjunto de herramientas y una interfaz de usuario Web para tareas de gestión. Consulte <link xlink:href="https://www.suse.com/products/suse-manager/"/> para obtener más información sobre SUSE Manager.
  </para>

  <para>
   Con este método, puede migrar desde un paquete de servicio (SP) a otro dentro de una versión principal (por ejemplo, de SLES 15 GA a SLES 15 SP3).
  </para>
  
  <para>
  Si el equipo se gestiona mediante SUSE Manager, actualícelo tal y como se describe en la documentación de SUSE Manager. El procedimiento de <citetitle>migración del cliente</citetitle> se describe en la <citetitle>Guía de actualización de SUSE Manager</citetitle>, disponible en <link xlink:href="https://documentation.suse.com/suma/"/>.
 </para>
 </sect1>

 <sect1 xml:id="sec-upgrade-online-leap-to-sle" os="sles">
  <title>Actualización de openSUSE Leap a <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase></title>
  <para>
   Puede actualizar una instalación de openSUSE Leap a <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase>. El procedimiento es similar al de la <xref linkend="sec-upgrade-online-yast"/>, pero requiere algunos pasos adicionales. Antes de ejecutar este procedimiento en el sistema de producción, se recomienda ejecutarlo en un sistema de prueba en el que se replique la configuración de producción.
  </para>
  <para>
   Para averiguar qué versiones de openSUSE Leap son compatibles con la migración, consulte la <xref linkend="sec-upgrade-paths-supported"/>.
  </para>
  <remark>cwickert 2012-02-25: For openSUSE Leap 15.3 and SLE 15 SP3, removing
   packages should not be necessary. Everything should be provided through
   Package Hub. For SP2 and earlier however, orphaned packages should be
   removed.</remark>
  <warning>
   <title>no todos los paquetes de openSUSE se pueden migrar</title>
   <para>
    openSUSE proporciona más paquetes que <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase>. La mayoría de los paquetes adicionales están disponibles a través de SUSE Package Hub y se migrarán. Los paquetes adicionales que no estén disponibles a través de SUSE Package Hub dejarán de recibir actualizaciones después de la migración y, por lo tanto, deberán eliminarse posteriormente.
   </para>
   <para>
    Asegúrese de que todos los paquetes que necesita para que funcione el sistema están disponibles en los repositorios de <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> y de SUSE Package Hub. Para obtener más información sobre SUSE Package Hub, consulte <xref linkend="sec-add-ons-package-hub"/>.
   </para>
  </warning>
  <procedure xml:id="pro-upgrade-online-leap-to-sle">
   <title>Actualización openSUSE Leap a <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase></title>
   <para>
    Para migrar de openSUSE Leap a <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase>, ejecute los siguientes pasos:
   </para>
   <step>
    <para>
     Cambie a un TTY, por ejemplo, pulsando <keycombo><keycap function="control"/>
     <keycap function="alt"/><keycap>F1</keycap></keycombo>. Luego inicie sesión como usuario <systemitem class="username">root</systemitem>.
    </para>
   </step>
   <step>
    <para>
     Instale el paquete <package>yast2-registration</package> y
     <package>rollback-helper</package> :
    </para>
    <screen><prompt role="root">root # </prompt><command>zypper in yast2-registration rollback-helper</command></screen>
   </step>
   
   <step>
    <para>
     Habilite el servicio <systemitem class="service">rollback-helper</systemitem>:
    </para>
    <screen><prompt role="root">root # </prompt><command>systemctl enable rollback</command></screen>
   </step>
   <step>
    <para>
     Registre el sistema en el Centro de servicios al cliente de SUSE:
    </para>
    <screen><prompt role="root">root # </prompt><command>yast2 registration</command></screen>
   </step>
   <step>
    <para>
     Realice la migración:
    </para>
    <screen><prompt role="root">root # </prompt><command>yast2 migration</command></screen>
    <para>
     En caso de conflictos de paquetes, YaST presenta una lista de soluciones entre las que elegir.
    </para>
   </step>
   <step>
    <para>
     Elimine los paquetes huérfanos:
    </para>
    <screen><prompt role="root">root # </prompt><command>zypper rm $(zypper --no-refresh packages --orphaned | gawk '{print $5}' | tail -n +5)</command></screen>
   </step>
   <step>
    <para>
     Rearranque el sistema:
    </para>
    <screen><prompt role="root">root # </prompt><command>reboot</command></screen>
   </step>
  </procedure>
  <para>
   Ha migrado correctamente el sistema a <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase>.
  </para>
  <para>
   Si encuentra algún problema después de la migración, puede revertir la migración como si fuera una actualización de paquete de servicio. Para obtener instrucciones, consulte la <xref linkend="sec-upgrade-online-rollback"/>.
  </para>
 </sect1>
</chapter>
