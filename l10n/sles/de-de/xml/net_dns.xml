<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="net_dns.xml" version="5.0" xml:id="cha-dns">
 <title>Domain Name System (DNS)</title>
 <info>
  <abstract>
   <para>
    DNS (Domain Name System) ist zur Auflösung der Domänen- und Hostnamen in IP-Adressen erforderlich. So wird die IP-Adresse 192.168.2.100 beispielsweise dem Hostnamen <literal>jupiter</literal> zugewiesen. Bevor Sie Ihren eigenen Namenserver einrichten, sollten Sie die allgemeinen Informationen zu DNS in <xref linkend="sec-network-nameres"/> lesen. Die folgenden Konfigurationsbeispiele gelten für BIND, den standardmäßigen DNS-Server.
   </para>
  </abstract>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:bugtracker/>
   <dm:translation>yes</dm:translation>
  </dm:docmanager>
 </info>

 <sect1 xml:id="sec-dns-basic">
  <title> DNS-Terminologie </title>

  <variablelist>
   <varlistentry>
    <term>Zone</term>
    <listitem>
     <para>
      Der Domänen-Namespace wird in Regionen, so genannte Zonen, unterteilt. So ist beispielsweise <literal>example.com</literal> der Bereich (oder die Zone) <literal>example</literal> der Domäne <literal>com</literal>.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>DNS-Server</term>
    <listitem>
     <para>
      Der DNS-Server ist ein Server, auf dem der Name und die IP-Informationen für eine Domäne gespeichert sind. Sie können einen primären DNS-Server für die primäre Zone, einen sekundären Server für die sekundäre Zone oder einen sekundären Server ohne jede Zone für das Caching besitzen.
     </para>
     <variablelist>
      <varlistentry>
       <term>DNS-Server der primären Zone</term>
       <listitem>
        <para>
         Die primäre Zone beinhaltet alle Hosts aus Ihrem Netzwerk und der DNS-Server der primären Zone speichert die aktuellen Einträge für alle Hosts in Ihrer Domäne.
        </para>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term>DNS-Server der sekundären Zone</term>
       <listitem>
        <para>
         Eine sekundäre Zone ist eine Kopie der primären Zone. Der DNS-Server der sekundären Zone erhält seine Zonendaten mithilfe von Zonentransfers von seinem primären Server. Der DNS-Server der sekundären Zone antwortet autorisiert für die Zone, solange er über gültige (nicht abgelaufene) Zonendaten verfügt. Wenn der sekundäre Server keine neue Kopie der Zonendaten erhält, antwortet er nicht mehr für die Zone.
        </para>
       </listitem>
      </varlistentry>
     </variablelist>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Forwarder</term>
    <listitem>
     <para>
      Forwarders sind DNS-Server, an die der DNS-Server Abfragen sendet, die er nicht bearbeiten kann. Zum Aktivieren verschiedener Konfigurationsquellen in einer Konfiguration wird <literal>netconfig</literal> verwendet (siehe auch <command>man 8 netconfig</command>).
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Datensatz</term>
    <listitem>
     <para>
      Der Eintrag besteht aus Informationen zu Namen und IP-Adresse. Die unterstützten Einträge und ihre Syntax sind in der BIND-Dokumentation beschrieben. Einige spezielle Einträge sind beispielsweise:
     </para>
     <variablelist>
      <varlistentry>
       <term>NS-Eintrag</term>
       <listitem>
        <para>
         Ein NS-Eintrag informiert die Namenserver darüber, welche Computer für eine bestimmte Domänenzone zuständig sind.
        </para>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term>MX-Eintrag</term>
       <listitem>
        <para>
         Die MX (Mailaustausch)-Einträge beschreiben die Computer, die für die Weiterleitung von Mail über das Internet kontaktiert werden sollen.
        </para>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term>SOA-Eintrag</term>
       <listitem>
        <para>
         Der SOA (Start of Authority)-Eintrag ist der erste Eintrag in einer Zonendatei. Der SOA-Eintrag wird bei der Synchronisierung von Daten zwischen mehreren Computern über DNS verwendet.
        </para>
       </listitem>
      </varlistentry>
     </variablelist>
    </listitem>
   </varlistentry>
  </variablelist>
 </sect1>

 <sect1 xml:id="sec-dns-install">
  <title>Installation</title>

  <para>
   Zur Installation eines DNS-Servers starten Sie YaST, und wählen Sie <menuchoice><guimenu>Software</guimenu> <guimenu>Software installieren oder löschen</guimenu></menuchoice>. Wählen Sie <menuchoice><guimenu>Ansicht</guimenu> <guimenu>Schemata</guimenu></menuchoice> und schließlich <guimenu>DHCP- und DNS-Server</guimenu> aus. Bestätigen Sie die Installation der abhängigen Pakete, um den Installationsvorgang abzuschließen.
  </para>
  <para>
   Alternativ geben Sie den folgenden Befehl in der Befehlszeile ein:
  </para>
  <screen><prompt>&gt; </prompt><command>sudo</command> zypper in -t pattern dhcp_dns_server</screen>
 </sect1>

 <sect1 xml:id="sec-dns-yast">
  <title>Konfiguration mit YaST</title>

  <para>
   Verwenden Sie das DNS-Modul von YaST, um einen DNS-Server für das lokale Netzwerk zu konfigurieren. Beim ersten Starten des Moduls werden Sie von einem Assistenten aufgefordert, einige grundlegende Entscheidungen hinsichtlich der Serveradministration zu treffen. Mit dieser Ersteinrichtung wird eine grundlegende Serverkonfiguration vorgenommen. Für erweiterte Konfigurationsaufgaben, beispielsweise zum Einrichten von ACLs, für Protokollaufgaben, TSIG-Schlüssel und andere Optionen, verwenden Sie den Expertenmodus.
  </para>

  <sect2 xml:id="sec-dns-yast-wizard">
   <title>Assistentenkonfiguration</title>


   <para>
    Der Assistent besteht aus drei Schritten bzw. Dialogfeldern. An bestimmten Stellen im Dialogfeld können Sie in den Konfigurationsmodus für Experten wechseln.
   </para>
   <procedure>
    <step>
     <para>



      Wenn Sie das Modul zum ersten Mal starten, wird das Dialogfeld <guimenu>Forwarder-Einstellungen</guimenu> (siehe <xref linkend="fig-yast2-dnsinst-forwarders"/>) geöffnet. Die <guimenu>Richtlinie für lokale DNS-Auflösung</guimenu> bietet die folgenden Optionen:
     </para>
     <itemizedlist mark="bullet" spacing="normal">
      <listitem>
       <para>
        <guimenu>Zusammenführen von Forwardern ist deaktiviert</guimenu>

       </para>
      </listitem>
      <listitem>
       <para>
        <guimenu>Automatisches Zusammenführen</guimenu>

       </para>
      </listitem>
      <listitem>


       <para>
        <guimenu>Zusammenführen von Forwardern ist aktiviert</guimenu>

       </para>
      </listitem>
      <listitem>
       <para>

        <guimenu>Benutzerdefinierte Konfiguriation</guimenu> – Wenn die <guimenu>benutzerdefinierte Konfiguriation</guimenu> aktiviert ist, können Sie die <guimenu>benutzerdefinierte Richtlinie</guimenu> angeben. Standardmäßig (Option <guimenu>Automatisches Zusammenführen</guimenu> ist aktiviert) ist die <guimenu>benutzerdefinierte Richtlinie</guimenu> auf <literal>automatisch</literal> eingestellt; hier können Sie die Schnittstellennamen jedoch selbst festlegen oder aus den beiden besonderen Richtliniennamen <literal>STATIC</literal> und <literal>STATIC_FALLBACK</literal> wählen.
       </para>
      </listitem>
     </itemizedlist>

     <para>
      Geben Sie unter <guimenu>Forwarder für lokale DNS-Auflösung</guimenu> den zu verwendenden Service an: <guimenu>System-Nameserver werden verwendet</guimenu>, <guimenu>Dieser Nameserver (Bind)</guimenu> oder <guimenu>Lokaler dnsmasq-Server</guimenu>.
     </para>
     <para>
      Weitere Informationen zu diesen Einstellungen finden Sie auf der man-Seite <command>man 8 netconfig</command>.
     </para>
     <figure xml:id="fig-yast2-dnsinst-forwarders">
      <title>DNS-Server-Installation: Forwarder-Einstellungen</title>
      <mediaobject>
       <imageobject role="fo">
        <imagedata width="75%" fileref="yast2_dns_wiz_forw.png"/>
       </imageobject>
       <imageobject role="html">
        <imagedata width="75%" fileref="yast2_dns_wiz_forw.png"/>
       </imageobject>
      </mediaobject>
     </figure>
     <para>
      Forwarders sind DNS-Server, an die der DNS-Server Abfragen sendet, die er nicht selbst bearbeiten kann. Geben Sie ihre IP-Adresse ein und klicken Sie auf <guimenu>Hinzufügen</guimenu>.
     </para>
    </step>
    <step>
     <para>
      Das Dialogfeld <guimenu>DNS-Zonen</guimenu> besteht aus mehreren Teilen und ist für die Verwaltung von Zonendateien zuständig, wie in <xref linkend="sec-dns-zonefile"/> beschrieben. Bei einer neuen müssen Sie unter <guimenu>Name der Zone</guimenu> einen Namen angeben. Um eine Reverse Zone hinzuzufügen, muss der Name auf <literal>.in-addr.arpa</literal> enden. Wählen Sie zum Schluss den <guimenu>Typ</guimenu> (primär, sekundär oder Forward) aus. Weitere Informationen hierzu finden Sie im <xref linkend="fig-yast2-dnsinst-zones"/>. Klicken Sie auf <guimenu>Bearbeiten</guimenu>, um andere Einstellungen für eine bestehende Zone zu konfigurieren. Zum Entfernen einer klicken Sie auf <guimenu>Zone löschen</guimenu>.
     </para>
     <figure xml:id="fig-yast2-dnsinst-zones">
      <title>DNS-Server-Installation: DNS-Zonen</title>
      <mediaobject>
       <imageobject role="fo">
        <imagedata width="72%" fileref="yast2_dns_wiz_zone.png"/>
       </imageobject>
       <imageobject role="html">
        <imagedata width="75%" fileref="yast2_dns_wiz_zone.png"/>
       </imageobject>
      </mediaobject>
     </figure>
    </step>
    <step>
     <para>
      Im letzten Dialogfeld können Sie den DNS-Port in der Firewall öffnen, indem Sie auf <guimenu>Firewall-Port öffnen</guimenu> klicken. Legen Sie anschließend fest, ob der DNS-Server beim Booten gestartet werden soll (<guimenu>Ein</guimenu> oder <guimenu>Aus</guimenu>). Außerdem können Sie die LDAP-Unterstützung aktivieren. Siehe <xref linkend="fig-yast2-dnsinst-finish"/>.
     </para>
     <figure xml:id="fig-yast2-dnsinst-finish">
      <title>DNS-Server-Installation: Wizard beenden</title>
      <mediaobject>
       <imageobject role="fo">
        <imagedata width="72%" fileref="yast2_dns_wiz_finish.png"/>
       </imageobject>
       <imageobject role="html">
        <imagedata width="75%" fileref="yast2_dns_wiz_finish.png"/>
       </imageobject>
      </mediaobject>
     </figure>
    </step>
   </procedure>
  </sect2>

  <sect2 xml:id="sec-dns-yast-expert">
   <title>Konfiguration für Experten</title>
   <para>
    Nach dem Starten des Moduls öffnet YaST ein Fenster, in dem mehrere Konfigurationsoptionen angezeigt werden. Nach Abschluss dieses Fensters steht eine DNS-Server-Konfiguration mit Grundfunktionen zur Verfügung:
   </para>
   <sect3 xml:id="sec-dns-yast-expert-startup">
    <title>Start</title>
    <para>
     Legen Sie unter <guimenu>Start</guimenu> fest, ob der DNS-Server beim Booten des Systems oder manuell gestartet werden soll. Um den DNS-Server sofort zu starten, klicken Sie auf <guimenu>DNS-Server nun starten</guimenu>. Um den DNS-Server anzuhalten, klicken Sie auf <guimenu>DNS-Server nun anhalten</guimenu>. Zum Speichern der aktuellen Einstellungen wählen Sie <guimenu>Jetzt Einstellungen speichern und DNS-Server neu laden</guimenu>. Sie können den DNS-Anschluss in der Firewall mit <guimenu>Firewall-Port öffnen</guimenu> öffnen und die Firewall-Einstellungen mit <guimenu>Firewall-Details</guimenu> bearbeiten.
    </para>
    <para>
     Wenn Sie <guimenu>LDAP-Unterstützung aktiv</guimenu> wählen, werden die Zone-Dateien von einer LDAP-Datenbank verwaltet. Alle Änderungen an Zonendaten, die in der LDAP-Datenbank gespeichert werden, werden vom DNS-Server erfasst, wenn er neu gestartet oder aufgefordert wird, seine Konfiguration neu zu laden.
    </para>
   </sect3>
   <sect3 xml:id="sec-dns-yast-expert-forwarders">
    <title>Forwarder</title>
    <para>
     Falls Ihr lokaler DNS-Server eine Anforderung nicht beantworten kann, versucht er, diese Anforderung an einen <guimenu>Forwarder</guimenu> weiterzuleiten, falls dies so konfiguriert wurde. Dieser Forwarder kann manuell zur <guimenu>Forwarder-Liste</guimenu> hinzugefügt werden. Wenn der Forwarder nicht wie bei Einwahlverbindungen statisch ist, wird die Konfiguration von <guimenu>netconfig</guimenu> verarbeitet. Weitere Informationen über netconfig finden Sie auf <command>man 8 netconfig</command>.
    </para>
   </sect3>
   <sect3 xml:id="sec-dns-yast-expert-basics">
    <title>Grundlegende Optionen</title>
    <para>
     In diesem Abschnitt werden grundlegende Serveroptionen festgelegt. Wählen Sie im Menü <guimenu>Option</guimenu> das gewünschte Element aus, und geben Sie dann den Wert im entsprechenden Textfeld an. Nehmen Sie den neuen Eintrag auf, indem Sie auf <guimenu>Hinzufügen</guimenu> klicken.
    </para>

   </sect3>
   <sect3 xml:id="sec-dns-yast-expert-logging">
    <title>Protokollierung</title>
    <para>
     Um festzulegen, was und wie der DNS-Server protokollieren soll, wählen Sie <guimenu>Protokollieren</guimenu> aus. Geben Sie unter <guimenu>Protokolltyp</guimenu> an, wohin der DNS-Server die Protokolldaten schreiben soll. Verwenden Sie das systemweite Protokoll durch Auswahl von <guimenu>Systemprotokoll</guimenu>, oder geben Sie durch Auswahl von <guimenu>Datei</guimenu> eine andere Datei an. In letzterem Fall müssen Sie außerdem einen Namen, die maximale Dateigröße in Megabyte und die Anzahl der zu speichernden Versionen von Protokolldateien angeben.
    </para>
    <para>
     Weitere Optionen sind unter <guimenu>Zusätzliches Protokollieren</guimenu> verfügbar. Durch Aktivieren von <guimenu>Alle DNS-Abfragen protokollieren</guimenu> wird <emphasis>jede</emphasis> Abfrage protokolliert. In diesem Fall kann die Protokolldatei extrem groß werden. Daher sollte diese Option nur zur Fehlersuche aktiviert werden. Um den Datenverkehr zu protokollieren, der während Zonenaktualisierungen zwischen dem DHCP- und dem DNS-Server stattfindet, aktivieren Sie <guimenu>Zonen-Updates protokollieren</guimenu>. Um den Datenverkehr während eines Zonentransfers vom primären zum sekundären Server zu protokollieren, aktivieren Sie <guimenu>Zonen-Transfer protokollieren</guimenu>. Siehe <xref linkend="fig-yast2-dns-logging"/>.
    </para>
    <figure xml:id="fig-yast2-dns-logging">
     <title>DNS-Server: Protokollieren</title>
     <mediaobject>
      <imageobject role="fo">
       <imagedata width="75%" fileref="yast2_dns_def_logging.png"/>
      </imageobject>
      <imageobject role="html">
       <imagedata width="75%" fileref="yast2_dns_def_logging.png"/>
      </imageobject>
     </mediaobject>
    </figure>
   </sect3>
   <sect3 xml:id="sec-dns-yast-expert-acls">
    <title>ACLs</title>
    <para>
     In diesem Dialogfeld legen Sie ACLs (Access Control Lists = Zugriffssteuerungslisten) fest, mit denen Sie den Zugriff einschränken. Nach der Eingabe eines eindeutigen Namens unter <guimenu>Name</guimenu> geben Sie unter <guimenu>Wert</guimenu> eine IP-Adresse (mit oder ohne Netzmaske) wie folgt an:
    </para>
<screen>{ 192.168.1/24; }</screen>
    <para>
     Die Syntax der Konfigurationsdatei erfordert, dass die Adresse mit einem Strichpunkt endet und in geschwungenen Klammern steht.
    </para>

   </sect3>
   <sect3 xml:id="sec-dns-yast-expert-tsig">
    <title>TSIG-Schlüssel</title>
    <para>
     Der Hauptzweck von TSIG-Schlüsseln (Transaction Signatures = Transaktionssignaturen) ist die Sicherung der Kommunikation zwischen DHCP- und DNS-Servern. Diese werden unter <xref linkend="sec-dns-tsig"/> beschrieben.
    </para>
    <para>
     Zum Erstellen eines TSIG-Schlüssels geben Sie einen eindeutigen Namen im Feld mit der Beschriftung <guimenu>Schlüssel-ID</guimenu> ein und geben die Datei an, in der der Schlüssel gespeichert werden soll (<guimenu>Dateiname</guimenu>). Bestätigen Sie Ihre Einstellung mit <guimenu>Erzeugen</guimenu>.
    </para>
    <para>
     Wenn Sie einen vorher erstellten Schlüssel verwenden möchten, lassen Sie das Feld <guimenu>Schlüssel-ID </guimenu> leer und wählen die Datei, in der der gewünschte Schlüssel gespeichert wurde, unter <guimenu>Dateiname</guimenu>. Dann bestätigen Sie die Auswahl mit <guimenu>Hinzufügen</guimenu>.
    </para>

   </sect3>
   <sect3 xml:id="sec-dns-yast-expert-add-secondary">
    <title>DNS-Zonen (Hinzufügen einer sekundären Zone)</title>
    <para>
     Wenn Sie eine sekundäre Zone hinzufügen möchten, klicken Sie auf <guimenu>DNS-Zonen</guimenu>, wählen Sie den Zonentyp <guimenu>Secondary</guimenu> (Sekundär) aus, geben Sie den Namen der neuen Zone ein und klicken Sie auf <guimenu>Hinzufügen</guimenu>.
    </para>
    <para>
     Geben Sie im <guimenu>Zonen-Editor</guimenu> unter <guimenu>Primary DNS Server IP</guimenu> (IP des primären DNS-Servers) den primären Server an, von dem der sekundäre Server die Daten abrufen soll. Um den Zugriff auf den Server zu beschränken, wählen Sie eine der ACLs aus der Liste aus.

    </para>

   </sect3>
   <sect3 xml:id="sec-dns-yast-expert-add-primary">
    <title>DNS-Zonen (Hinzufügen einer primären Zone)</title>
    <para>
     Wenn Sie eine primäre Zone hinzufügen möchten, klicken Sie auf <guimenu>DNS-Zonen</guimenu>, wählen Sie den Zonentyp <guimenu>Primary</guimenu> (Primär) aus, geben Sie den Namen der neuen Zone ein und klicken Sie auf <guimenu>Hinzufügen</guimenu>. Beim Hinzufügen einer primären Zone ist auch eine Reverse Zone erforderlich. Wenn Sie beispielsweise die Zone <systemitem>example.com</systemitem> hinzufügen, die auf Hosts in einem Subnetz <literal>192.168.1.0/24</literal> zeigt, sollten Sie auch eine Reverse Zone für den betreffenden IP-Adressbereich erstellen. Per Definition sollte dieser den Namen <literal>1.168.192.in-addr.arpa</literal> erhalten.
    </para>
   </sect3>
   <sect3 xml:id="sec-dns-yast-expert-edit-primary">
    <title>DNS-Zonen (Bearbeiten einer primären Zone)</title>
    <para>
     Wenn Sie eine primäre Zone bearbeiten möchten, klicken Sie auf <guimenu>DNS-Zonen</guimenu>, wählen Sie die primäre Zone in der Tabelle aus und klicken Sie auf <guimenu>Bearbeiten</guimenu>. Dieses Dialogfeld besteht aus mehreren Seiten: <guimenu>Grundlagen</guimenu> (die zuerst geöffnete Seite), <guimenu>DNS-Einträge</guimenu>, <guimenu>MX-Einträge</guimenu>, <guimenu>SOA</guimenu> und <guimenu>Einträge</guimenu>.
    </para>
    <para os="sles;osuse">
     Im grundlegenden Dialogfeld in <xref linkend="fig-yast2-dns-ddns"/> können Sie die Einstellungen für das dynamische DNS festlegen und auf Optionen für Zonentransfers an Clients und sekundäre Nameserver zugreifen. Zum Zulassen dynamischer Aktualisierungen von Zonen wählen Sie <guimenu>Dynamische Updates erlauben</guimenu> und den entsprechenden TSIG-Schlüssel. Der Schlüssel muss definiert werden, bevor die Aktualisierung startet. Zum Aktivieren der Zonentransfers wählen Sie die entsprechenden ACLs. ACLs müssen bereits definiert sein.
    </para>
    <para>
     Wählen Sie im Dialogfeld <guimenu>Grundlagen</guimenu> aus, ob Zonen-Transfers aktiviert werden sollen. Verwenden Sie die aufgelisteten ACLs, um festzulegen, wer Zonen herunterladen kann.
    </para>
    <figure xml:id="fig-yast2-dns-ddns" os="sles;osuse">
     <title>DNS-Server: Zonen-Editor (Grundlagen)</title>
     <mediaobject>
      <imageobject role="fo">
       <imagedata width="65%" fileref="yast2_dns_def_ddns.png"/>
      </imageobject>
      <imageobject role="html">
       <imagedata width="65%" fileref="yast2_dns_def_ddns.png"/>
      </imageobject>
     </mediaobject>
    </figure>
    <variablelist>
     <varlistentry>
      <term>Zonen-Editor (NS-Einträge)</term>
      <listitem>
       <para>
        Im Dialogfeld <guimenu>NS-Einträge</guimenu> können Sie alternative Nameserver für die angegebenen Zonen definieren. Vergewissern Sie sich, dass Ihr eigener Namenserver in der Liste enthalten ist. Um einen Eintrag hinzuzufügen, geben Sie seinen Namen unter <guimenu>Hinzuzufügender Namenserver</guimenu> ein und bestätigen Sie den Vorgang anschließend mit <guimenu>Hinzufügen</guimenu>. Siehe <xref linkend="fig-yast2-dns-nsrec"/>.
       </para>
       <figure xml:id="fig-yast2-dns-nsrec">
        <title>DNS-Server: Zonen-Editor (NS-Einträge)</title>
        <mediaobject>
         <imageobject role="fo">
          <imagedata width="65%" fileref="yast2_dns_def_nsrec.png"/>
         </imageobject>
         <imageobject role="html">
          <imagedata width="65%" fileref="yast2_dns_def_nsrec.png"/>
         </imageobject>
        </mediaobject>
       </figure>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>Zonen-Editor (MX-Einträge)</term>
      <listitem>
       <para>
        Um einen Mailserver für die aktuelle Zone zur bestehenden Liste hinzuzufügen, geben Sie die entsprechende Adresse und den entsprechenden Prioritätswert ein. Bestätigen Sie den Vorgang anschließend durch Auswahl von <guimenu>Hinzufügen</guimenu>. Siehe <xref linkend="fig-yast2-dns-mxrec"/>.
       </para>
       <figure xml:id="fig-yast2-dns-mxrec">
        <title>DNS-Server: Zonen-Editor (MX-Einträge)</title>
        <mediaobject>
         <imageobject role="fo">
          <imagedata width="72%" fileref="yast2_dns_def_mxrec.png"/>
         </imageobject>
         <imageobject role="html">
          <imagedata width="75%" fileref="yast2_dns_def_mxrec.png"/>
         </imageobject>
        </mediaobject>
       </figure>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>Zonen-Editor (SOA)</term>
      <listitem>
       <para>
        Auf dieser Seite können Sie SOA (Start of Authority)-Einträge erstellen. Eine Erklärung der einzelnen Optionen finden Sie in <xref linkend="ex-welt-zone"/>. <phrase os="sles;osuse">Das Ändern von SOA-Datensätzen wird für dynamischen Zonen, die über LDAP verwaltet werden, nicht unterstützt.</phrase>
       </para>
       <figure xml:id="fig-yast2-dns-soa">
        <title>DNS-Server: Zonen-Editor (SOA)</title>
        <mediaobject>
         <imageobject role="fo">
          <imagedata width="75%" fileref="yast2_dns_def_soa.png"/>
         </imageobject>
         <imageobject role="html">
          <imagedata width="75%" fileref="yast2_dns_def_soa.png"/>
         </imageobject>
        </mediaobject>
       </figure>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>Zonen-Editor (Einträge)</term>
      <listitem>
       <para>
        In diesem Dialogfeld wird die Namenauflösung verwaltet. Geben Sie unter <guimenu>Eintragschlüssel</guimenu> den Hostnamen an, und wählen Sie anschließend den Typ aus. Der Typ <guimenu>A</guimenu> bezeichnet den Haupteintrag. Der Wert hierfür sollte eine IP-Adresse (IPv4) sein. Für IPv6-Adressen verwenden Sie <guimenu>AAAA</guimenu>. <guimenu>CNAME</guimenu> ist ein Alias. Verwenden Sie die Typen <guimenu>NS</guimenu> und <guimenu>MX</guimenu> für detaillierte oder partielle Einträge, mit denen die Informationen aus den Registerkarten <guimenu>NS-Einträge</guimenu> und <guimenu>MX-Einträge</guimenu> erweitert werden. Diese drei Typen werden in einen bestehenden <literal>A</literal>-Eintrag aufgelöst. <guimenu>PTR</guimenu> dient für Reverse Zones. Es handelt sich um das Gegenteil eines <literal>A</literal>-Eintrags, wie zum Beispiel:
       </para>
<screen>hostname.example.com. IN A 192.168.0.1
1.0.168.192.in-addr.arpa IN PTR hostname.example.com.</screen>
      </listitem>
     </varlistentry>
    </variablelist>
    <sect4 xml:id="sec-dns-yast-expert-edit-primary-rev">
     <title>Hinzufügen von Reverse Zones</title>
     <para>
      So fügen Sie eine Reverse Zone hinzu:
     </para>
     <procedure>
      <step>
       <para>
        Starten Sie <menuchoice><guimenu>YaST</guimenu><guimenu>DNS-Server</guimenu><guimenu>DNS-Zonen</guimenu></menuchoice>.
       </para>
      </step>
      <step>
       <para>
        Falls Sie noch keine primäre Forward-Zone angelegt haben, holen Sie dies jetzt nach und <guimenu>bearbeiten</guimenu> Sie sie.
       </para>
      </step>
      <step>
       <para>
        Geben Sie auf der Registerkarte <guimenu>Einträge</guimenu> den entsprechenden <guimenu>Eintragsschlüssel</guimenu> und <guimenu>Eintragswert</guimenu> an. Legen Sie dann den Eintrag mit <guimenu>Hinzufügen</guimenu> an und bestätigen Sie den Vorgang mit <guimenu>OK</guimenu>. Wenn YaST eine Meldung ausgibt, dass ein Eintrag für einen Nameserver fehlt, geben Sie diesen Eintrag auf der Registerkarte <guimenu>DNS-Einträge</guimenu> an.
       </para>
       <figure>
        <title>Hinzufügen eines Eintrags für eine primäre Zone</title>
        <mediaobject>
         <imageobject role="fo">
          <imagedata fileref="yast2_dns_revzone1.png" width="70%"/>
         </imageobject>
         <imageobject role="html">
          <imagedata fileref="yast2_dns_revzone1.png" width="70%"/>
         </imageobject>
        </mediaobject>
       </figure>
      </step>
      <step>
       <para>
        Fügen Sie im Fenster <guimenu>DNS-Zonen</guimenu> eine primäre Reverse-Zone hinzu.
       </para>
       <figure>
        <title>Hinzufügen einer Reverse Zone</title>
        <mediaobject>
         <imageobject role="fo">
          <imagedata fileref="yast2_dns_revzone2.png" width="70%"/>
         </imageobject>
         <imageobject role="html">
          <imagedata fileref="yast2_dns_revzone2.png" width="70%"/>
         </imageobject>
        </mediaobject>
       </figure>
      </step>
      <step>
       <para>
        <guimenu>Bearbeiten</guimenu> Sie die Reverse Zone. Auf der Registerkarte <guimenu>Einträge</guimenu> wird der Eintragstyp <guimenu>PTR: Umgekehrte Übersetzung</guimenu> aufgeführt. Geben Sie den entsprechenden <guimenu>Eintragsschlüssel</guimenu> und <guimenu>Eintragswert</guimenu> an, klicken Sie auf <guimenu>Hinzufügen</guimenu> und bestätigen Sie den Vorgang mit <guimenu>OK</guimenu>.
       </para>
       <figure>
        <title>Hinzufügen eines Reverse-Eintrags</title>
        <mediaobject>
         <imageobject role="fo">
          <imagedata fileref="yast2_dns_revzone3.png" width="70%"/>
         </imageobject>
         <imageobject role="html">
          <imagedata fileref="yast2_dns_revzone3.png" width="70%"/>
         </imageobject>
        </mediaobject>
       </figure>
       <para>
        Fügen Sie bei Bedarf einen Nameserver-Eintrag hinzu.
       </para>
      </step>
     </procedure>
     <tip>
      <title>Bearbeiten der Reverse Zone</title>
      <para>
       Wechseln Sie nach dem Hinzufügen einer Forward Zone wieder in das Hauptmenü und wählen Sie die Reverse Zone zur Bearbeitung aus. Markieren Sie im Karteireiter <guimenu>Grundlagen</guimenu> das Kontrollkästchen <guimenu>Einträge automatisch generieren aus</guimenu> und wählen Sie Ihre Forward Zone aus. Auf diese Weise werden alle Änderungen an der Forward Zone automatisch in der Reverse Zone aktualisiert.
      </para>
     </tip>
    </sect4>
   </sect3>
  </sect2>
 </sect1>
 <sect1 xml:id="sec-dns-bind">
  <title>Starten des BIND-Nameservers</title>

  <para>
   Bei <phrase role="productname"><phrase os="sles">SUSE® Linux Enterprise Server</phrase></phrase>-Systemen ist der Namenserver BIND (<emphasis>Berkeley Internet Name Domain</emphasis>) vorkonfiguriert, sodass er problemlos unmittelbar nach der Installation gestartet werden kann. Wenn Sie bereits über eine funktionierende Internetverbindung verfügen und <systemitem class="ipaddress">127.0.0.1</systemitem> als Namenserver-Adresse für <systemitem class="domainname">localhost</systemitem> in <filename>/var/run/netconfig/resolv.conf</filename> eingegeben haben, verfügen Sie normalerweise bereits über eine funktionierende Namensauflösung, ohne dass Ihnen der DNS des Anbieters bekannt sein muss. BIND führt die Namenauflösung über den Root-Namenserver durch. Dies ist ein wesentlich langsamerer Prozess. Normalerweise sollte der DNS des Anbieters zusammen mit der zugehörigen IP-Adresse in die Konfigurationsdatei <filename>/etc/named.conf</filename> unter <systemitem>forwarders</systemitem> eingegeben werden, um eine effektive und sichere Namenauflösung zu gewährleisten. Wenn dies so weit funktioniert, wird der Namenserver als reiner <emphasis>Nur-Cache</emphasis>-Namenserver ausgeführt. Nur wenn Sie seine eigenen Zonen konfigurieren, wird er ein richtiger DNS. Ein einfaches Beispiel zur Veranschaulichung finden Sie unter <filename>/usr/share/doc/packages/bind/config</filename>.
  </para>

  <tip>
   <title>Automatische Anpassung der Nameserverinformationen</title>
   <para>
    Je nach Typ der Internet- bzw. Netzwerkverbindung können die Namenserverinformationen automatisch an die aktuellen Bedingungen angepasst werden. Legen Sie die Variable <systemitem>NETCONFIG_DNS_POLICY</systemitem> in der Datei <filename>/etc/sysconfig/network/config</filename> dazu auf <literal>auto</literal> fest.
   </para>
  </tip>

  <para>
   Richten Sie jedoch erst eine offizielle Domäne ein, wenn Sie eine Domäne von der zuständigen Stelle zugewiesen bekommen. Selbst wenn Sie eine eigene Domäne besitzen und diese vom Anbieter verwaltet wird, sollten Sie sie besser nicht verwenden, da BIND ansonsten keine Anforderungen für diese Domäne weiterleitet. Beispielsweise könnte in diesem Fall für diese Domäne der Zugriff auf den Webserver beim Anbieter nicht möglich sein.
  </para>

  <para>
   Starten Sie den Nameserver mit dem Befehl <command>systemctl start named</command> als <systemitem class="username">root</systemitem>. Prüfen Sie mit <command>systemctl status named</command>, ob der Nameserverprozess „named“ ordnungsgemäß gestartet wurde. Testen Sie den Nameserver umgehend auf dem lokalen System mit den Programmen <command>host</command> oder <command>dig</command>. Sie sollten <systemitem class="domainname">localhost</systemitem> als Standardserver mit der Adresse <systemitem class="ipaddress">127.0.0.1</systemitem> zurückgeben. Ist dies nicht der Fall, enthält <filename>/var/run/netconfig/resolv.conf</filename> wahrscheinlich einen falschen Nameserver-Eintrag oder die Datei ist nicht vorhanden. Geben Sie beim ersten Test <command>host</command> <option>127.0.0.1</option> ein. Dieser Eintrag sollte immer funktionieren. Wenn Sie eine Fehlermeldung erhalten, überprüfen Sie mit <command>systemctl status named</command>, ob der Server tatsächlich ausgeführt wird. Wenn der Nameserver nicht startet oder sich ungewöhnlich verhält, prüfen Sie die Ausgabe von <command>journalctl -e</command>.
  </para>



  <para>
   Um den Namenserver des Anbieters (oder einen bereits in Ihrem Netzwerk ausgeführten Server) als Forwarder zu verwenden, geben Sie die entsprechende IP-Adresse(n) im Abschnitt <systemitem>options</systemitem> unter <systemitem>forwarders</systemitem> ein. Bei den Adressen in <xref linkend="ex-forward"/> handelt es sich lediglich um Beispiele. Passen Sie diese Einträge an Ihr eigenes Setup an.
  </para>

  <example xml:id="ex-forward">
   <title>Weiterleitungsoptionen in named.conf</title>


<screen>options {
        directory "/var/lib/named";
        forwarders { 10.11.12.13; 10.11.12.14; };
        listen-on { 127.0.0.1; 192.168.1.116; };
        allow-query { 127/8; 192.168/16 };
        notify no;
};</screen>
  </example>

  <para>
   Auf den Eintrag <systemitem>options</systemitem> folgen Einträge für die Zone, <systemitem class="domainname">localhost</systemitem> und <systemitem>0.0.127.in-addr.arpa</systemitem>. Der Eintrag <literal>type hint</literal> unter <quote>&#x002E;</quote> muss stets vorhanden sein. Die entsprechenden Dateien müssen nicht bearbeitet werden und sollten so funktionieren, wie sie sind. Achten Sie außerdem darauf, dass jeder Eintrag mit einem <quote>;</quote> abgeschlossen ist und dass sich die geschweiften Klammern an der richtigen Position befinden. Nach dem Ändern der Konfigurationsdatei <filename>/etc/named.conf</filename> oder der Zonendateien müssen Sie BIND anweisen, diese Datei(en) erneut zu lesen. Führen Sie hierzu den Befehl <command>systemctl reload named</command> aus. Dieselbe Wirkung erzielen Sie, wenn Sie den Nameserver mit <command>systemctl restart named</command> anhalten und neu starten. Sie können den Server jederzeit mit <command>systemctl stop named</command> anhalten.
  </para>
 </sect1>
 <sect1 xml:id="sec-dns-named">
  <title>Die Konfigurationsdatei /etc/named.conf</title>

  <para>
   Alle Einstellungen für den BIND-Namenserver selbst sind in der Datei <filename>/etc/named.conf</filename> gespeichert. Die Zonendaten für die zu bearbeitenden Domänen, die aus Hostnamen, IP-Adressen usw. bestehen, sind jedoch in gesonderten Dateien im Verzeichnis <filename>/var/lib/named</filename> gespeichert. Einzelheiten hierzu werden weiter unten beschrieben.
  </para>

  <para>
   <filename>/etc/named.conf</filename> lässt sich grob in zwei Bereiche untergliedern. Der eine ist der Abschnitt <systemitem>options</systemitem> für allgemeine Einstellungen und der zweite besteht aus <systemitem>zone</systemitem>-Einträgen für die einzelnen Domänen. Der Abschnitt <systemitem>logging</systemitem> und die Einträge unter <systemitem>acl</systemitem> (access control list, Zugriffssteuerungsliste) sind optional. Kommentarzeilen beginnen mit <literal>#</literal> oder mit <literal>//</literal>. Eine Minimalversion von <filename>/etc/named.conf</filename> finden Sie in <xref linkend="ex-named-mini"/>.
  </para>

  <example xml:id="ex-named-mini">
   <title>Eine Grundversion von /etc/named.conf</title>
<screen>options {
        directory "/var/lib/named";
        forwarders { 10.0.0.1; };
        notify no;
};

zone "localhost" in {
       type master;
       file "localhost.zone";
};

zone "0.0.127.in-addr.arpa" in {
        type master;
        file "127.0.0.zone";
};

zone "." in {
        type hint;
        file "root.hint";
};</screen>
  </example>

  <sect2 xml:id="sec-dns-named-options">
   <title>Wichtige Konfigurationsoptionen</title>
   <variablelist>
    <varlistentry>
     <term>directory &quot;<replaceable>DATEINAME</replaceable>&quot;;</term>
     <listitem>
      <para>
       Gibt das Verzeichnis an, in dem BIND die Dateien mit den Zonendaten finden kann. In der Regel ist dies <filename>/var/lib/named</filename>.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>forwarders { <replaceable>IP-ADRESSE</replaceable>; };</term>
     <listitem>
      <para>
       Gibt die Namenserver (zumeist des Anbieters) an, an die DNS-Anforderungen weitergeleitet werden sollen, wenn sie nicht direkt aufgelöst werden können. Ersetzen Sie <replaceable>IP-ADRESSE</replaceable> durch eine IP-Adresse wie <literal>192.168.1.116</literal>.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>forward first;</term>
     <listitem>
      <para>
       Führt dazu, dass DNS-Anforderungen weitergeleitet werden, bevor versucht wird, sie über die Root-Namenserver aufzulösen. Anstatt <systemitem>forward only</systemitem> kann <systemitem>forward
       first</systemitem> verwendet werden. Damit werden alle Anforderungen weitergeleitet, ohne dass sie an die Root-Nameserver gesendet werden. Dies ist bei Firewall-Konfigurationen sinnvoll.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>listen-on port 53 { 127.0.0.1; <replaceable>IP-ADRESSE</replaceable>; };</term>
     <listitem>
      <para>
       Informiert BIND darüber, an welchen Netzwerkschnittstellen und Ports Client-Abfragen akzeptiert werden sollen. <literal>port 53</literal> muss nicht explizit angegeben werden, da <literal>53</literal> der Standardport ist. Geben Sie <literal>127.0.0.1</literal> ein, um Anforderungen vom lokalen Host zuzulassen. Wenn Sie diesen Eintrag ganz auslassen, werden standardmäßig alle Schnittstellen verwendet.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>listen-on-v6 port 53 {any; };</term>
     <listitem>
      <para>
       Informiert BIND darüber, welcher Port auf IPv6-Client-Anforderungen überwacht werden soll. Die einzige Alternative zu <literal>any</literal> ist <literal>none</literal>. Bei IPv6 akzeptiert der Server nur Platzhalteradressen.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>query-source address * port 53;</term>
     <listitem>
      <para>
       Dieser Eintrag ist erforderlich, wenn eine Firewall ausgehende DNS-Anforderungen blockiert. Dadurch wird BIND angewiesen, Anforderungen extern von Port 53 und nicht von einem der Ports mit den hohen Nummern über 1024 aufzugeben.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>query-source-v6 address * port 53;</term>
     <listitem>
      <para>
       Informiert BIND darüber, welcher Port für IPv6-Abfragen verwendet werden soll.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>allow-query \{ 127.0.0.1; <replaceable>NETZ</replaceable>; };</term>
     <listitem>
      <para>
       Definiert die Netzwerke, von denen aus Clients DNS-Anforderungen aufgeben können. Ersetzen Sie <replaceable>NETZ</replaceable> durch Adressinformationen wie <literal>192.168.2.0/24</literal>. Der Wert <systemitem>/24</systemitem> am Ende ist ein abgekürzter Ausdruck für die Netzmaske, hier <systemitem class="netmask">255.255.255.0</systemitem>.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>allow-transfer ! *;;</term>
     <listitem>
      <para>
       Legt fest, welche Hosts Zonentransfers anfordern können. Im vorliegenden Beispiel werden solche Anforderungen mit <systemitem>! *</systemitem>. Ohne diesen Eintrag können Zonentransfer ohne Einschränkungen von jedem beliebigen Ort aus angefordert werden.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>statistics-interval 0;</term>
     <listitem>
      <para>
       Ohne diesen Eintrag generiert BIND im Systemjournal mehrere Zeilen mit statistischen Informationen pro Stunde. Setzen Sie diesen Wert auf „0“, um diese Statistiken vollständig zu unterdrücken, oder legen Sie ein Zeitintervall in Minuten fest.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>cleaning-interval 720;</term>
     <listitem>
      <para>
       Diese Option legt fest, in welchen Zeitabständen BIND den Cache leert. Damit wird bei jedem Ausführen dieses Vorgangs ein Eintrag im Systemjournal ausgelöst. Die verwendete Einheit für die Zeitangabe ist Minuten. Der Standardwert ist 60 Minuten.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>interface-interval 0;</term>
     <listitem>
      <para>
       BIND durchsucht die Netzwerkschnittstellen regelmäßig nach neuen oder nicht vorhandenen Schnittstellen. Wenn dieser Wert auf <systemitem>0</systemitem> gesetzt ist, wird dieser Vorgang nicht durchgeführt und BIND überwacht nur die beim Start erkannten Schnittstellen. Anderenfalls wird das Zeitintervall in Minuten angegeben. Der Standardwert ist 60 Minuten.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>notify no;</term>
     <listitem>
      <para>
       <option>no</option> verhindert, dass anderen Namenserver informiert werden, wenn Änderungen an den Zonendaten vorgenommen werden oder wenn der Namenserver neu gestartet wird.
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
   <para>
    Eine Liste der verfügbaren Optionen finden Sie auf der man-Seite <command>man 5 named.conf</command>.
   </para>
  </sect2>

  <sect2 xml:id="sec-dns-named-log">
   <title>Protokollierung</title>
   <para>
    Der Umfang, die Art und Weise und der Ort der Protokollierung kann in BIND extensiv konfiguriert werden. In der Regel dürften die Standardeinstellungen ausreichen. <xref linkend="ex-no-log"/> zeigt die einfachste Form eines solchen Eintrags und unterdrückt die Protokollierung vollständig.
   </para>
   <example xml:id="ex-no-log">
    <title>Eintrag zur Deaktivierung der Protokollierung</title>
<screen>logging {
        category default { null; };
};</screen>
   </example>
  </sect2>

  <sect2 xml:id="sec-dns-named-zones">
   <title>Zoneneinträge</title>
   <example xml:id="ex-meine-domain">
    <title>Zoneneintrag für „example.com“</title>
<screen>zone "example.com" in {
      type master;
      file "example.com.zone";
      notify no;
};</screen>
   </example>
   <para>
    Geben Sie nach <systemitem>zone</systemitem> den Namen der zu verwaltenden Domäne (<systemitem class="domainname">example.com</systemitem>) an, gefolgt von <systemitem>in</systemitem> und einem Block relevanter Optionen in geschweiften Klammern, wie in <xref linkend="ex-meine-domain"/> gezeigt.  Um eine <emphasis>sekundäre Zone</emphasis> zu definieren, ändern Sie den Wert von <systemitem>type</systemitem> in <literal>secondary</literal> und geben Sie einen Nameserver an, der diese Zone als <literal>primary</literal> verwaltet (dieser kann wiederum ein sekundärer Server eines anderen primären Servers sein), wie in <xref linkend="ex-andere-domain"/> gezeigt.
   </para>
   <example xml:id="ex-andere-domain">
    <title>Zoneneintrag für „example.net“</title>
<screen>zone "example.net" in {
      type secondary;
      file "secondary/example.net.zone";
      
      masters { 10.0.0.1; }; 
};</screen>
   </example>
   <para>
    Zonenoptionen:
   </para>
   <variablelist>
    <varlistentry>
     <term>type primary;</term>
     <listitem>
      <para>
       Durch die Angabe <literal>primary</literal> wird BIND darüber informiert, dass der lokale Nameserver für die Zone zuständig ist. Dies setzt voraus, dass eine Zonendatei im richtigen Format erstellt wurde.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>type secondary;</term>
     <listitem>
      <para>
       Diese Zone wird von einem anderen Namenserver übertragen. Sie muss zusammen mit  <systemitem>primary_servers</systemitem>   verwendet werden.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>type hint;</term>
     <listitem>
      <para>
       Die Zone <literal>&#x002E;</literal> vom Typ <literal>hint</literal> wird zur Festlegung der Root-Nameserver verwendet. Diese Zonendefinition kann unverändert beibehalten werden.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>file <filename>example.com.zone</filename> oder file <quote>slave/example.net.zone</quote>;</term>
     <listitem>
      <para>
       In diesem Eintrag wird die Datei angegeben, in der sich die Zonendaten für die Domäne befinden. Diese Datei ist für einen sekundären Server nicht erforderlich, da die betreffenden Daten von einem anderen Nameserver abgerufen werden. Damit die Dateien des primären und des sekundären Servers voneinander unterschieden werden können, verwenden Sie das Verzeichnis <filename>secondary</filename> für die sekundären Dateien.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>primary_servers { <replaceable>SERVER_IP_ADRESSE</replaceable>; };</term>
     <listitem>
      <para>
       Dieser Eintrag ist nur für sekundäre Zonen erforderlich. Er gibt an, von welchem Namenserver die Zonendatei übertragen werden soll.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>allow-update {! *; };</term>
     <listitem>
      <para>
       Mit dieser Option wird der externe Schreibzugriff gesteuert, der Clients das Anlegen von DNS-Einträgen gestatten würde. Dies ist in der Regel aus Sicherheitsgründen nicht erstrebenswert. Ohne diesen Eintrag sind keine Zonenaktualisierungen zulässig. Der oben stehende Eintrag hat dieselbe Wirkung, da <literal>! *</literal> solche Aktivitäten effektiv unterbindet.
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
  </sect2>
 </sect1>
 <sect1 xml:id="sec-dns-zonefile">
  <title>Zonendateien</title>

  <para>
   Zwei Arten von Zonendateien sind erforderlich. Eine Art ordnet IP-Adressen Hostnamen zu, die andere stellt Hostnamen für IP-Adressen bereit.
  </para>

  <tip>
   <title>Verwenden des Punkts in Zonendateien</title>
   <para>
    Der Punkt (<literal>„&#x002E;“</literal>) ist in den Zonendateien von entscheidender Bedeutung. Wenn Hostnamen nicht auf einem Punkt (<literal>&#x002E;</literal>) enden, wird die Zone angefügt. Vollständige Hostnamen, die mit einem vollständigen Domänennamen angegeben werden, müssen mit <literal>&#x002E;</literal> abgeschlossen werden, um zu verhindern, dass die Domäne ein weiteres Mal angefügt wird. Ein fehlender oder falsch platzierter „.“ ist wahrscheinlich die häufigste Ursache von Konfigurationsfehlern bei Nameservern.
   </para>
  </tip>



  <para>
   Der erste zu betrachtende Fall ist die Zonendatei <filename>example.com.zone</filename>, die für die Domäne <filename>example.com</filename> zuständig ist (siehe <xref linkend="ex-welt-zone"/>).
  </para>

  <example xml:id="ex-welt-zone">
   <title>Die Datei /var/lib/named/example.com.zone</title>
   <screen>$TTL 2D <co xml:id="welt-zone-ttl"/>
example.com. IN SOA      dns  root.example.com. ( <co xml:id="welt-zone-soa-start"/>
             2003072441  ; serial <co xml:id="welt-zone-serial-no"/>
             1D          ; refresh <co xml:id="welt-zone-refresh"/>
             2H          ; retry <co xml:id="welt-zone-retry"/>
             1W          ; expiry <co xml:id="welt-zone-expire"/>
             2D )        ; minimum <co xml:id="welt-zone-caching-time"/>

             IN NS       dns <co xml:id="welt-zone-inns"/>
             IN MX       10 mail dns <co xml:id="welt-zone-mx"/>
gate         IN A        192.168.5.1 <co xml:id="welt-zone-ips"/>
             IN A        10.0.0.1
dns          IN A        192.168.1.116
mail         IN A        192.168.3.108
jupiter      IN A        192.168.2.100
venus        IN A        192.168.2.101
saturn       IN A        192.168.2.102
mercury      IN A        192.168.2.103
ntp          IN CNAME    dns <co xml:id="welt-zone-ntp"/>
dns6         IN A6  0    2002:c0a8:174::</screen>

  </example>

  <calloutlist>
   <callout arearefs="welt-zone-ttl">
    <para>
     <systemitem>$TTL</systemitem> legt die Standardlebensdauer fest, die für alle Einträge in dieser Datei gelten soll. In diesem Beispiel sind die Einträge zwei Tage lang gültig (<literal>2 D</literal>).
    </para>
   </callout>
   <callout arearefs="welt-zone-soa-start">
    <para>
     Hier beginnt der SOA (Start of Authority)-Steuereintrag:
    </para>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <para>
       Der Name der zu verwaltenden Domäne ist <literal>example.com</literal> an der ersten Stelle. Dieser Eintrag endet mit <literal>„&#x002E;“</literal>, da andernfalls die Zone ein zweites Mal angefügt würde. Alternativ kann hier <literal>@</literal> eingegeben werden. In diesem Fall wird die Zone aus dem entsprechenden Eintrag in <filename>/etc/named.conf</filename> extrahiert.
      </para>
     </listitem>
     <listitem>
      <para>
       Nach <systemitem>IN SOA</systemitem> befindet sich der Name des Nameservers, der als primärer Server für diese Zone fungiert. Der Name wird von <literal>dns</literal> zu <literal>dns.example.com</literal> erweitert, da er nicht mit <literal>„&#x002E;“</literal> endet.
      </para>
     </listitem>
     <listitem>
      <para>
       Es folgt die Email-Adresse der für diesen Namenserver zuständigen Person. Da das Zeichen <literal>@</literal> bereits eine besondere Bedeutung hat, wird hier <literal>„&#x002E;“</literal> eingegeben. Für <systemitem>root@example.com</systemitem> lautet der Eintrag <systemitem>root.example.com.</systemitem>. Der Punkt (<literal>„&#x002E;“</literal>) am Ende muss stehen, damit nicht die Zone angefügt wird.
      </para>
     </listitem>
     <listitem>
      <para>
       Durch <literal>(</literal> werden alle Zeilen bis einschließlich <literal>)</literal> in den SOA-Eintrag aufgenommen.
      </para>
     </listitem>
    </itemizedlist>
   </callout>
   <callout arearefs="welt-zone-serial-no">
    <para>
     Die Seriennummer (<systemitem>serial number</systemitem>) ist eine zehnstellige Zahl. Sie muss bei jeder Änderung der Datei ebenfalls geändert werden. Sie wird benötigt, um die sekundären Nameserver (sekundäre Server) über Änderungen zu informieren. Dazu ist nun eine 10-stellige Zahl für das Datum und die Laufzeitnummer, geschrieben als YYYYMMDDNN, das übliche Format (YYYY = Jahr, MM = Monat und DD = Tag). NN ist eine Sequenznummer, falls sie an einem Tag mehr als einmal aktualisiert wird).
    </para>
   </callout>
   <callout arearefs="welt-zone-refresh">
    <para>
     Die Aktualisierungsrate (<systemitem>refresh rate</systemitem>) gibt das Zeitintervall an, in dem die sekundären Nameserver die Seriennummer (<systemitem>serial
     number</systemitem>) der Zone überprüfen . In diesem Fall beträgt dieses Intervall einen Tag.
    </para>
   </callout>
   <callout arearefs="welt-zone-retry">
    <para>
     Die Wiederholungsrate (<systemitem>retry rate</systemitem>) gibt das Zeitintervall an, nach dem ein sekundärer Nameserver bei einem Fehler erneut versucht, Kontakt zum primären Server herzustellen. In diesem Fall sind dies zwei Stunden.
    </para>
   </callout>
   <callout arearefs="welt-zone-expire">
    <para>
     Die Ablaufzeit (<systemitem>expiration time</systemitem>) gibt den Zeitraum an, nach dem ein sekundärer Nameserver die im Cache gespeicherten Daten verwirft, wenn er keinen erneuten Kontakt zum primären Server herstellen konnte. Hier eine Woche.
    </para>
   </callout>
   <callout arearefs="welt-zone-caching-time">
    <para>
     Die letzte Angabe im SOA-Eintrag gibt die negative Cache-Lebensdauer <systemitem>negative
     caching TTL</systemitem> an – die Zeitdauer, die Ergebnisse nicht aufgelter DNS-Abfragen von anderen Servern im Cache gespeichert werden knen.
    </para>
   </callout>
   <callout arearefs="welt-zone-inns">
    <para>
     <systemitem>IN NS</systemitem> gibt den für diese Domäne verantwortlichen Namenserver an. <systemitem>dns</systemitem> wird zu <systemitem>dns.example.com</systemitem> erweitert, da der Eintrag nicht mit einem <literal>„„&#x002E;““</literal> endet. Es kann mehrere solche Zeilen geben – eine für den primären und jeweils eine für jeden sekundären Namenserver. Wenn <systemitem>notify</systemitem> in <filename>/etc/named.conf</filename> nicht auf <option>no</option> gesetzt ist, werden alle hier aufgeführten Namenserver über die Änderungen an den Zonendaten informiert.
    </para>
   </callout>
   <callout arearefs="welt-zone-mx">
    <para>
     Der MX-Eintrag gibt den Mailserver an, der Emails für die Domäne <systemitem class="domainname">example.com</systemitem> annimmt, verarbeitet und weiterleitet. In diesem Beispiel ist dies der Host <systemitem class="domainname">mail.example.com</systemitem>. Die Zahl vor dem Hostnamen ist der Präferenzwert. Wenn mehrere MX-Einträge vorliegen, wird zuerst der Mailserver mit dem kleinsten Wert herangezogen. Falls die Emails nicht an diesen Server zugestellt werden können, wird der Eintrag mit dem nächstkleineren Wert verwendet.
    </para>
   </callout>
   <callout arearefs="welt-zone-ips">
    <para>
     Diese und die folgenden Zeilen sind die eigentlichen Adresseinträge, in denen den Hostnamen eine oder mehrere IP-Adressen zugewiesen werden. Die Namen sind hier ohne <literal>„&#x002E;“</literal> aufgeführt, da sie ihre Domäne nicht enthalten. Daher werden sie alle um <systemitem class="domainname">example.com</systemitem> ergänzt. Dem Host <systemitem>gate</systemitem> werden zwei IP-Adressen zugewiesen, da er zwei Netzwerkkarten aufweist. Bei jeder traditionellen Hostadresse (IPv4) wird der Eintrag mit <literal>A</literal> gekennzeichnet. Wenn es sich um eine IPv6-Adresse handelt, wird der Eintrag mit <literal>AAAA</literal> gekennzeichnet.

     </para>


     <note>
      <title>IPv6-Syntax</title>
      <para>
       Die Syntax des IPv6-Eintrags unterscheidet sich geringfügig von der Syntax von IPv4. Aufgrund der Möglichkeit einer Fragmentierung müssen Informationen zu fehlenden Bits vor der Adresse angegeben werden. Um die IPv6-Adresse mit dem erforderlichen Wert <quote>0</quote> auszufüllen, fügen Sie an der korrekten Stelle in der Adresse zwei Doppelpunkte hinzu.

      </para>
<screen>pluto     AAAA 2345:00C1:CA11::1234:5678:9ABC:DEF0
pluto     AAAA 2345:00D2:DA11::1234:5678:9ABC:DEF0</screen>

     </note>
   </callout>
   <callout arearefs="welt-zone-ntp">
    <para>
     Der Alias <literal>ntp</literal> kann zur Adressierung von <literal>dns</literal> (<systemitem>CNAME</systemitem> steht für <emphasis>canonical name</emphasis> (kanonischer Name)) verwendet werden.
    </para>
   </callout>
  </calloutlist>



  <para>
   Die Pseudodomäne <literal>in-addr.arpa</literal> wird für Reverse-Lookups zur Auflösung von IP-Adressen in Hostnamen verwendet. Sie wird in umgekehrter Notation an den Netzwerk-Teil der Adresse angehängt. <systemitem class="ipaddress">192.168</systemitem> wird also in <systemitem>168.192.in-addr.arpa</systemitem> aufgelöst. Siehe <xref linkend="dat-arpa"/>.
  </para>



  <example xml:id="dat-arpa">
   <title>Reverse-Lookup</title>
   <screen>$TTL 2D <co xml:id="data-arpa-ttl"/>
168.192.in-addr.arpa.   IN SOA dns.example.com. root.example.com. ( <co xml:id="data-arpa-soa"/>
                        2003072441      ; serial
                        1D              ; refresh
                        2H              ; retry
                        1W              ; expiry
                        2D )            ; minimum

                        IN NS           dns.example.com. <co xml:id="data-arpa-inns"/>

1.5                     IN PTR          gate.example.com. <co xml:id="data-arpa-ips"/>
100.3                   IN PTR          www.example.com.
253.2                   IN PTR          cups.example.com.</screen>
  </example>

  <calloutlist>
   <callout arearefs="data-arpa-ttl">
    <para>
     $TTL definiert die Standard-TTL, die für alle Einträge hier gilt.
    </para>
   </callout>
   <callout arearefs="data-arpa-soa">
    <para>
     Die Konfigurationsdatei muss Reverse-Lookup für das Netzwerk <systemitem class="ipaddress">192.168</systemitem> aktivieren. Wenn die Zone <systemitem>168.192.in-addr.arpa</systemitem>   heißt, sollte sie nicht zu den Hostnamen hinzugefügt werden. Daher werden alle Hostnamen in ihrer vollständigen Form eingegeben – mit ihrer Domäne und mit einem Punkt (<literal>„&#x002E;“</literal>) am Ende. Die restlichen Einträge entsprechen den im vorherigen Beispiel (<systemitem>example.com</systemitem>) beschriebenen Einträgen.
    </para>
    <para>
     In <xref linkend="ex-welt-zone"/> finden Sie weitere Details zu den Einträgen in diesem Datensatz.
    </para>
   </callout>
   <callout arearefs="data-arpa-inns">
    <para>
     Diese Zeile gibt den für diese Zone verantwortlichen Nameserver an. Diesmal wird der Name allerdings in vollständiger Form mit Domäne und <literal>„&#x002E;“</literal> am Ende eingegeben.
    </para>
   </callout>
   <callout arearefs="data-arpa-ips">
    <para>
     Diese und die folgenden Zeilen sind die Zeiger-Datensätze, die auf die IP-Adressen an den entsprechenden Hosts hinweisen. Am Anfang der Zeile wird nur der letzte Teil der IP-Adresse eingegeben, ohne <literal>„&#x002E;“</literal> am Ende. Wenn daran die Zone angehängt wird (ohne <systemitem>.in-addr.arpa</systemitem>), ergibt sich die vollständige IP-Adresse in umgekehrter Reihenfolge.
    </para>
   </callout>
  </calloutlist>
  <para>
   Normalerweise sollten Zonentransfers zwischen verschiedenen Versionen von BIND problemlos möglich sein.
  </para>
 </sect1>

 <sect1 xml:id="sec-dns-dynupdate">
  <title>Dynamische Aktualisierung von Zonendaten</title>

  <para>
   Der Ausdruck <emphasis>dynamische Aktualisierung</emphasis> bezieht sich auf Vorgänge, bei denen Einträge in den Zonendateien eines primären Servers  hinzugefügt, geändert oder gelöscht werden. Dieser Mechanismus wird in RFC 2136 beschrieben. Die dynamische Aktualisierung wird einzeln für jeden Zoneneintrag konfiguriert; hierzu wird eine optionale Regel <systemitem>allow-update</systemitem> oder <systemitem>update-policy</systemitem> eingefügt. Dynamisch zu aktualisierende Zonen sollten nicht von Hand bearbeitet werden.
  </para>

  <para>
   Die zu aktualisierenden Einträge werden mit dem Befehl <command>nsupdate</command> an den Server übermittelt. Die genaue Syntax dieses Befehls können Sie der man-Seite für nsupdate (<command>man</command><option>8 nsupdate</option>) entnehmen. Aus Sicherheitsgründen sollten solche Aktualisierungen mithilfe von TSIG-Schlüsseln durchgeführt werden, wie in <xref linkend="sec-dns-tsig"/> beschrieben.
  </para>
 </sect1>
 <sect1 xml:id="sec-dns-tsig">
  <title>Sichere Transaktionen</title>

  <para>
   Sichere Transaktionen können mit Transaktionssignaturen (TSIGs) durchgeführt werden, die auf gemeinsam genutzten geheimen Schlüsseln (auch TSIG-Schlüssel genannt) beruhen. In diesem Abschnitt wird die Erstellung und Verwendung solcher Schlüssel beschrieben.
  </para>

  <para>
   Sichere Transaktionen werden für die Kommunikation zwischen verschiedenen Servern und für die dynamische Aktualisierung von Zonendaten benötigt. Die Zugriffssteuerung von Schlüsseln abhängig zu machen, ist wesentlich sicherer, als sich lediglich auf IP-Adressen zu verlassen.
  </para>

  <para>
   Erstellen Sie mit dem folgenden Befehl einen TSIG-Schlüssel (genauere Informationen finden Sie unter <command>man</command> <option>tsig-keygen</option>):
  </para>

<screen><prompt>&gt; </prompt><command>sudo</command> tsig-keygen -a hmac-md5 host1-host2 &gt; host1-host2.key</screen>

  <para>
   Hiermit wird eine Datei mit dem Namen <filename>host1-host2.key</filename> erstellt, deren Inhalt etwa wie folgt aussieht:
  </para>

<screen>key "host1-host2" {                       |
    algorithm hmac-md5;
    secret "oHpBLgtcZso6wxnRTWdJMA==";
};</screen>

  <para>
   Die Datei muss auf den Remote-Host übertragen werden, nach Möglichkeit auf sichere Weise (z. B. mit scp). Damit die sichere Kommunikation zwischen <literal>host1</literal> und <literal>host2</literal> gewährleistet ist, muss der Schlüssel sowohl auf dem lokalen Server als auch auf dem Remote-Server in die Datei <filename>/etc/named.conf</filename> aufgenommen werden.
  </para>

<screen>key host1-host2 {
 algorithm hmac-md5;
 secret "ejIkuCyyGJwwuN3xAteKgg==";
};</screen>

  <warning>
   <title>Dateiberechtigungen von <filename>/etc/named.conf</filename></title>
   <para>
    Vergewissern Sie sich, dass die Berechtigungen von <filename>/etc/named.conf</filename> ordnungsgemäß eingeschränkt sind. Der Standardwert für diese Datei lautet <literal>0640</literal>, mit <systemitem class="username">root</systemitem> als Eigentümer und <systemitem class="username">named</systemitem> als Gruppe. Alternativ können Sie die Schlüssel in eine gesonderte Datei mit speziell eingeschränkten Berechtigungen verschieben, die dann aus <filename>/etc/named.conf</filename> eingefügt werden. Zum Einschließen einer externen Datei verwenden Sie:
   </para>
<screen>include  "filename"</screen>
   <para>
    Ersetzen Sie <option>filename</option> durch einen absoluten Pfad zu Ihrer Datei mit den Schlüsseln.
   </para>
  </warning>

  <para>





   Damit Server <literal>host1</literal> den Schlüssel für <literal>host2</literal> verwenden kann (in diesem Beispiel mit der Adresse <literal>10.1.2.3</literal>), muss die Datei <filename>/etc/named.conf</filename> des Servers folgende Regel enthalten:
  </para>

<screen>server 10.1.2.3 {
  keys { host1-host2. ;};
};</screen>

  <para>
   Analoge Einträge müssen in die Konfigurationsdateien von <literal>host2</literal> aufgenommen werden.
  </para>

  <para>
   Fügen Sie TSIG-Schlüssel für alle ACLs (Access Control Lists, Zugriffssteuerungslisten, nicht zu verwechseln mit Dateisystem-ACLs) hinzu, die für IP-Adressen und -Adressbereiche definiert sind, um Transaktionssicherheit zu gewährleisten. Der entsprechende Eintrag könnte wie folgt aussehen:
  </para>

<screen>allow-update { key host1-host2. ;};</screen>

  <para>
   Dieses Thema wird eingehender im <emphasis>Referenzhandbuch für BIND-Administratoren</emphasis> (unter <literal>update-policy</literal>) erörtert.
  </para>
 </sect1>
 <sect1 xml:id="sec-dns-dnssec">
  <title>DNS-Sicherheit</title>

  <para>
   DNSSEC, also die DNS-Sicherheit, wird in RFC 2535 beschrieben. Die verfügbaren Werkzeuge für DNSSEC werden im BIND-Handbuch erörtert.
  </para>

  <para>
   Einer als sicher betrachteten Zone müssen ein oder mehrere Zonenschlüssel zugeordnet sein. Diese werden mit <command>dnssec-keygen</command> erstellt, genau wie die Host-Schlüssel. Zurzeit wird der DSA-Verschlüsselungsalgorithmus zum Erstellen dieser Schlüssel verwendet. Die generierten öffentlichen Schlüssel sollten mithilfe einer <systemitem>$INCLUDE</systemitem>-Regel in die entsprechende Zonendatei aufgenommen werden.
  </para>

  <para>
   Mit dem Kommando <command>dnssec-signzone</command> können Sie Sets von generierten Schlüsseln (<literal>keyset-</literal>Dateien) erstellen, sie auf sichere Weise in die übergeordnete Zone übertragen und sie signieren. Auf diese Weise werden die Dateien generiert, die in die einzelnen Zonen in <filename>/etc/named.conf</filename> aufgenommen werden sollen.
  </para>


 </sect1>
 <sect1 xml:id="sec-dns-info">
  <title>Weitere Informationen</title>

  <para>
   Weitere Informationen können Sie dem <emphasis>Referenzhandbuch für BIND-Administratoren</emphasis> im Paket <systemitem class="resource">bind-doc</systemitem> entnehmen, das unter <filename>/usr/share/doc/packages/bind/arm</filename> installiert ist. Außerdem könnten Sie die RFCs zurate ziehen, auf die im Handbuch verwiesen wird, sowie die in BIND enthaltenen man-Seiten. <filename>/usr/share/doc/packages/bind/README.SUSE</filename> enthält aktuelle Informationen zu BIND in <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase>.
  </para>
 </sect1>
</chapter>
