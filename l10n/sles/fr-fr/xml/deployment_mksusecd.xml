<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="deployment_mksusecd.xml" version="5.0" role="General" xml:id="cha-deployment-prep-mksusecd">
 <title>Personnalisation des images d'installation avec mksusecd</title>
 <info>
  <abstract>
   <para>
    <command>mksusecd</command> est un outil très utile pour créer une image d'installation personnalisée. Utilisez-le pour modifier les images d'installation SUSE Linux Enterprise standard : ajoutez et supprimez des fichiers, créez une image d'installation réseau minimale, personnalisez les options de démarrage et de dépôt, et créez une image de démarrage minimale en tant qu'alternative pour le démarrage d'un système à partir d'un serveur PXE.
   </para>
  </abstract>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:bugtracker/>
   <dm:translation>oui</dm:translation>
  </dm:docmanager>
 </info>
 <sect1 xml:id="sec-deployment-install-mksusecd">
  <title>Installation de mksusecd</title>

  <para>
   Sous SLE 15, <command>mksusecd</command> se trouve dans le module des outils de développement <literal>Development Tools Module</literal>. Si vous n'avez pas activé ce module, vous devez l'activer. Recherchez d'abord le nom de module exact avec <command>zypper</command> :
  </para>

<screen><prompt>tux &gt; </prompt>zypper search-packages mksusecd
Following packages were found in following modules:

Package               Module or Repository
--------------------  -----------------------------------------------------------------
mksusecd              Development Tools Module (sle-module-development-tools/15/x86_64)
mksusecd-debuginfo    Development Tools Module (sle-module-development-tools/15/x86_64)
mksusecd-debugsource  Development Tools Module (sle-module-development-tools/15/x86_64)
mksusecd              Available
srcpackage:mksusecd   Available

To activate the respective module or product, use SUSEConnect --product.
Use SUSEConnect --help for more details.</screen>

  <para>
   Activez-le avec SUSEConnect :
  </para>

<screen><prompt>tux &gt; </prompt><command>sudo</command> SUSEConnect -p sle-module-development-tools/15/x86_64</screen>

  <para>
   Sous SLE 15.1 et versions ultérieures, il se trouve dans le <literal>Dépôt principal de mise à jour</literal>, qui est activé par défaut.
  </para>

  <para>
   Installez <command>mksusecd</command> de la façon habituelle :
  </para>

<screen><prompt>tux &gt; </prompt><command>sudo</command> zypper se mksusecd</screen>

  <para>
   Exécutez <command>mksusecd --help</command> pour afficher la liste de toutes les commandes.
  </para>

  <para>
   Après avoir créé votre image personnalisée, gravez-la sur un support CD/DVD à l'aide de votre programme d'écriture de disque préféré, tel que Brasero ou <command>mybashburn</command>, ou créez une clé USB à mémoire flash de démarrage à l'aide de la commande <command>dd</command>. Assurez-vous que le périphérique n'est pas monté, puis exécutez la commande suivante :
  </para>

<screen><prompt role="root">root # </prompt><command>dd</command> if=<replaceable>min-install.iso</replaceable> of=/dev/<replaceable>SDB</replaceable> bs=4M</screen>

  <para>
   Votre nouveau périphérique de démarrage est prêt à l'emploi.
  </para>
 </sect1>
 <sect1 xml:id="sec-deployment-prep-boot-mksusecd">
  <title>Création d'une image de démarrage minimale</title>

  <para>
   Utilisez <command>mksusecd</command> pour créer un image de démarrage minimale afin de démarrer les machines clientes à partir d'un CD/DVD ou d'une clé USB à mémoire flash, au lieu de les lancer à partir d'un serveur de démarrage PXE. L'image de démarrage minimale lance le kernel et initrd, puis les fichiers d'installation restants sont récupérés à partir d'un serveur NFS local (voir <xref linkend="sec-deployment-instserver-sles9"/>).
  </para>

  <para>
   Exécutez la commande suivante pour créer l'image ISO minimale :
  </para>

<screen><prompt>tux &gt; </prompt><command>sudo</command> <command>mksusecd</command> --create <replaceable>min-install.iso</replaceable> \
--net=nfs://<replaceable>192.168.1.1:/srv/install/</replaceable><replaceable>ARCH</replaceable>/<replaceable>OS_VERSION</replaceable>/<replaceable>SP_VERSION</replaceable>/cd1  \
/srv/tftpboot/EFI/<replaceable>ARCH</replaceable>/boot</screen>

  <para>
   Remplacez l'adresse du serveur NFS par la vôtre. Remplacez <replaceable>ARCH</replaceable> par le répertoire correspondant à l'architecture du système cible. Remplacez également <replaceable>OS_version</replaceable> (Version_SE) et <replaceable>SP_VERSION</replaceable> (VERSION_SP) en fonction de vos chemins comme indiqué à la <xref linkend="sec-deployment-instserver-sles9"/>.
  </para>



  


 </sect1>
 
 <sect1 xml:id="sec-deployment-custom-image-boot">
  <title>Définition des paramètres de démarrage du kernel par défaut</title>

  <para>
   Plutôt que d'attendre un invite d'amorçage pour entrer vos paramètres de démarrage du kernel personnalisés, configurez-les dans une image <command>mksusecd</command> personnalisée :
  </para>

<screen><prompt>tux &gt; </prompt><command>sudo</command> mksusecd --create <replaceable>install.iso</replaceable> \
--boot "<replaceable>textmode=1 splash=silent mitigations=auto</replaceable>"</screen>

  <para>
   Vérifiez que vos paramètres personnalisés sont chargés correctement après le démarrage en interrogeant <filename>/proc</filename> :
  </para>

<screen><prompt>tux &gt; </prompt>cat /proc/cmdline</screen>
 </sect1>
 <sect1 xml:id="sec-deployment-custom-modules">
  <title>Personnalisation des modules, extensions et dépôts</title>

  <para>
   SUSE Linux Enterprise 15 prend en charge des modules (à ne pas confondre avec les modules de kernel) et extensions pour différents composants du produit. Il s'agit de modules complémentaires au module Basesystem (Système de base) par défaut, comme Development Tools, Desktop Applications et SUSE Linux Enterprise Live Patching. Pour plus d'informations, reportez-vous au manuel <citetitle>Modules and Extensions Quick Start</citetitle> (Démarrage rapide des modules et extensions).
  </para>

  <para>
   <command>mksusecd</command> vous permet de créer un image d'installation contenant tous les modules et extensions supplémentaires de votre choix. Commencez par interroger les images existantes, comme dans cet exemple pour SUSE Linux Enterprise <phrase role="productnumber"><phrase os="sles;sled">15 SP3</phrase></phrase> :
  </para>

  <screen><prompt>tux &gt; </prompt><command>sudo</command> mksusecd --list-repos SLE-15-SP3-Full-<replaceable>ARCH</replaceable>-GM-media1.iso
Repositories:
  SLES15-SP3 [15.3-0]
  SLES15 [15.3-0]
  Basesystem-Module [15.3-0]
  SUSE-CAP-Tools-Module [15.3-0]
  Containers-Module [15.3-0]
  Desktop-Applications-Module [15.3-0]
  Development-Tools-Module [15.3-0]
</screen>

  <para>
   Créez une image d'installation constituée à partir des modules, extensions et dépôts que vous sélectionnez, et activez-les automatiquement :
  </para>

<screen><prompt>tux &gt; </prompt><command>sudo</command> mksusecd --create <replaceable>myinstaller.iso</replaceable>\
  --enable-repos auto --include-repos <replaceable>Basesystem-Module,Desktop-Applications-Module</replaceable> \
  SLE-15-SP3-Online-<replaceable>ARCH</replaceable>-GM-media1.iso \
  SLE-15-SP3-Full-<replaceable>ARCH</replaceable>-GM-media1.iso
  </screen>

  <para>
   Cela crée et ajoute le fichier <filename>add_on_products.xml</filename> à la nouvelle image. Remplacez <command>--enable-repos auto</command> par <command>--enable-repos ask</command> afin que le programme d'installation affiche une boîte de dialogue permettant de choisir les modules.
  </para>

  <note>
   <title>fichier de contrôle AutoYaST</title>
   <para>
    Si vous utilisez AutoYaST pour configurer vos installations, il n'est pas nécessaire de répertorier ces modules dans le fichier de contrôle AutoYaST lorsque vous utilisez l'option <command>‑‑enable-repos</command>.
   </para>
  </note>
 </sect1>
 <sect1 xml:id="sec-deployment-custom-netinstall">
  <title>Création d'une image ISO Netinstall minimale</title>

  <para>
   Pour créer un image d'installation minimale afin de lancer une installation réseau, utilisez l'option <command>--nano</command> :
  </para>

<screen><prompt>tux &gt; </prompt><command>sudo</command> mksusecd --create <replaceable>netinstall.iso</replaceable> \
--nano SLE-15-SP3-Online-<replaceable>ARCH</replaceable>-GM-media1.iso</screen>
 </sect1>
 <sect1 xml:id="sec-deployment-custom-repo">
  <title>Modification du dépôt par défaut</title>

  <para>
   Pour définir un autre dépôt, tel que votre propre dépôt local, utilisez l'option <command>--net</command> :
  </para>

<screen><prompt>tux &gt; </prompt><command>sudo</command> mksusecd --create <replaceable>localinstall.iso</replaceable> \
--net "https://example.com/local" SLE-15-SP3-Online-<replaceable>ARCH</replaceable>-GM-media1.iso</screen>
 </sect1>
</chapter>
