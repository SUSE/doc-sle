<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="troubleshooting.xml" version="5.0" xml:id="cha-trouble">
 <title>一般問題和解決方案</title>
 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:bugtracker/>
   <dm:translation>yes</dm:translation>
  </dm:docmanager>
 </info>
 <para>
  本章介紹一些可能會發生的問題及其解決方案。即使這裡沒有與您完全相同的情況，或許可以從類似情況中獲得一些提示，來解決您遇到的問題。
 </para>
 <sect1 xml:id="sec-trouble-info">
  <title>尋找並收集資訊</title>

  <para>
   Linux 會非常詳細地報告事件。當系統發生問題時，可以從幾個地方查看相關資訊，主要是 Linux 系統的標準記錄檔案，也有與 <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> 系統相關的記錄檔案。大部分記錄檔案都可以透過 YaST (<menuchoice>
   <guimenu>其他</guimenu> <guimenu> 檢視開機記錄</guimenu>
   </menuchoice> 」) 進行檢視。
  </para>



  <para>
   使用 YaST 可以收集支援團隊所需的所有系統資訊。使用<menuchoice>

   <guimenu>其他</guimenu> <guimenu>支援</guimenu> </menuchoice>，然後選取問題類別。在收集到所有資訊之後，將此份資訊連結到您的支援要求。
  </para>

  <para>
   以下是最常查看的記錄檔案清單，以及它們各自的一般用途。包含 <filename>~</filename> 的路徑表示目前使用者的主目錄。
  </para>

  <table xml:id="tab-trouble-info">
   <title>記錄檔案</title>
   <tgroup cols="2">
    <thead>
     <row>
      <entry>
       <para>
        Log File
       </para>
      </entry>
      <entry>
       <para>
        描述
       </para>
      </entry>
     </row>
    </thead>
    <tbody>
     <row>
      <entry>
       <para>
        <filename>~/.xsession-errors</filename>
       </para>
      </entry>
      <entry>
       <para>
        來自目前執行中桌上應用程式的訊息。
       </para>
      </entry>
     </row>
     <row>
      <entry>
       <para>
        <filename>/var/log/apparmor/</filename>
       </para>
      </entry>
      <entry>
       <para>
        來自 AppArmor 的記錄檔案，請參閱<xref linkend="part-apparmor"/> 以獲得詳細資訊。
       </para>
      </entry>
     </row>
     <row>
      <entry>
       <para>
        <filename>/var/log/audit/audit.log</filename>
       </para>
      </entry>
      <entry>
       <para>
        來自 Audit 的記錄檔案，可追蹤對檔案、目錄或系統資源的存取，並追蹤系統呼叫。請參閱<xref linkend="part-audit"/>以獲得詳細資訊。
       </para>
      </entry>
     </row>

     <row>
      <entry>
       <para>
        <filename>/var/log/mail.*</filename>
       </para>
      </entry>
      <entry>
       <para>
        來自郵件系統的訊息。
       </para>
      </entry>
     </row>

     <row>
      <entry>
       <para>
        <filename>/var/log/NetworkManager</filename>
       </para>
      </entry>
      <entry>
       <para>
        NetworkManager 中的記錄檔案，用於收集網路連接性的問題
       </para>
      </entry>
     </row>
     <row>
      <entry>
       <para>
        <filename>/var/log/samba/</filename>
       </para>
      </entry>
      <entry>
       <para>
        目錄包含 Samba 伺服器和用戶端記錄訊息。
       </para>
      </entry>
     </row>
     <row>
      <entry>
       <para>
        <filename>/var/log/warn</filename>
       </para>
      </entry>
      <entry>
       <para>
        來自核心和系統記錄精靈的所有訊息，均為<quote>警告</quote>或以上等級。
       </para>
      </entry>
     </row>
     <row>
      <entry>
       <para>
        <filename>/var/log/wtmp</filename>
       </para>
      </entry>
      <entry>
       <para>
        二進位檔案包含使用者對於目前機器工作階段的登入記錄。請以 <command>last</command> 檢視。
       </para>
      </entry>
     </row>
     <row>
      <entry>
       <para>
        <filename>/var/log/Xorg.*.log</filename>
       </para>
      </entry>
      <entry>
       <para>
        來自 X Window System 的多種啟動和執行時期記錄檔案。對於 X 啟動失敗的除錯非常實用。
       </para>
      </entry>
     </row>
     <row>
      <entry>
       <para>
        <filename>/var/log/YaST2/</filename>
       </para>
      </entry>
      <entry>
       <para>
        目錄包含 YaST 的動作和其結果。
       </para>
      </entry>
     </row>
     <row>
      <entry>
       <para>
        <filename>/var/log/zypper.log</filename>
       </para>
      </entry>
      <entry>
       <para>
        Zypper 的記錄檔案。
       </para>
      </entry>
     </row>
    </tbody>
   </tgroup>
  </table>

  <para>
   與記錄檔不同的是，您的機器亦提供您執行中系統的資訊。請參閱<xref linkend="tab-trouble-system" xrefstyle="select:label title nopage"/>
  </para>

  <table xml:id="tab-trouble-system">
   <title><filename>/proc</filename> 檔案系統的系統資訊</title>
   <tgroup cols="2">
    <thead>
     <row>
      <entry>
       <para>
        檔案
       </para>
      </entry>
      <entry>
       <para>
        描述
       </para>
      </entry>
     </row>
    </thead>
    <tbody>
     <row>
      <entry>
       <para>
        <filename>/proc/cpuinfo</filename>
       </para>
      </entry>
      <entry>
       <para>
        包含處理器資訊，如類型、廠商、型號與效能。
       </para>
      </entry>
     </row>
     <row>
      <entry>
       <para>
        <filename>/proc/dma</filename>
       </para>
      </entry>
      <entry>
       <para>
        顯示目前使用的 DMA 頻道。
       </para>
      </entry>
     </row>
     <row>
      <entry>
       <para>
        <filename>/proc/interrupts</filename>
       </para>
      </entry>
      <entry>
       <para>
        顯示使用中的岔斷，以及每種岔斷正在使用的數量。
       </para>
      </entry>
     </row>
     <row>
      <entry>
       <para>
        <filename>/proc/iomem</filename>
       </para>
      </entry>
      <entry>
       <para>
        顯示 I/O (輸入/輸出) 記憶體的狀態。
       </para>
      </entry>
     </row>
     <row>
      <entry>
       <para>
        <filename>/proc/ioports</filename>
       </para>
      </entry>
      <entry>
       <para>
        顯示此時正在使用的 I/O 連接埠。
       </para>
      </entry>
     </row>
     <row>
      <entry>
       <para>
        <filename>/proc/meminfo</filename>
       </para>
      </entry>
      <entry>
       <para>
        顯示記憶體狀態。
       </para>
      </entry>
     </row>
     <row>
      <entry>
       <para>
        <filename>/proc/modules</filename>
       </para>
      </entry>
      <entry>
       <para>
        顯示個別模組。
       </para>
      </entry>
     </row>
     <row>
      <entry>
       <para>
        <filename>/proc/mounts</filename>
       </para>
      </entry>
      <entry>
       <para>
        顯示目前掛接的裝置。
       </para>
      </entry>
     </row>
     <row>
      <entry>
       <para>
        <filename>/proc/partitions</filename>
       </para>
      </entry>
      <entry>
       <para>
        顯示所有硬碟的分割區。
       </para>
      </entry>
     </row>
     <row>
      <entry>
       <para>
        <filename>/proc/version</filename>
       </para>
      </entry>
      <entry>
       <para>
        顯示目前的 Linux 版本。
       </para>
      </entry>
     </row>
    </tbody>
   </tgroup>
  </table>

  <para>
   除了 <filename>/proc</filename> 檔案系統，Linux 核心還會輸出 <literal>sysfs</literal> 模組 (記憶體內檔案系統) 的相關資訊。此模組代表核心物件及其屬性和關係。如需有關 <literal>sysfs</literal> 的詳細資訊，請參閱<xref linkend="cha-udev"/> 中 udev 的相關內容。<xref linkend="tab-trouble-sysfs" xrefstyle="select:label nopage"/> 提供了 <filename>/sys</filename> 下最常用目錄的綜覽。
  </para>

  <table xml:id="tab-trouble-sysfs">
   <title><filename>/sys</filename> 檔案系統的系統資訊</title>
   <tgroup cols="2">
    <thead>
     <row>
      <entry>
       <para>
        檔案
       </para>
      </entry>
      <entry>
       <para>
        描述
       </para>
      </entry>
     </row>
    </thead>
    <tbody>
     <row>
      <entry>
       <para>
        <filename>/sys/block</filename>
       </para>
      </entry>
      <entry>
       <para>
        包含系統中探查到之每個區塊裝置的子目錄。一般情況下，大部分裝置都是磁碟類型的裝置。
       </para>
      </entry>
     </row>
     <row>
      <entry>
       <para>
        <filename>/sys/bus</filename>
       </para>
      </entry>
      <entry>
       <para>
        包含每種實體匯流排類型的子目錄。
       </para>
      </entry>
     </row>
     <row>
      <entry>
       <para>
        <filename>/sys/class</filename>
       </para>
      </entry>
      <entry>
       <para>
        包含組合為功能型裝置 (如圖形、網路和印表機等) 的多個子目錄
       </para>
      </entry>
     </row>
     <row>
      <entry>
       <para>
        <filename>/sys/device</filename>
       </para>
      </entry>
      <entry>
       <para>
        包含全域裝置階層。
       </para>
      </entry>
     </row>
    </tbody>
   </tgroup>
  </table>

  <para>
   Linux 隨附多種工具可進行系統分析和監控。請參閱 <xref linkend="cha-util"/> 以取得用於系統診斷最重要的選項。
  </para>

  <para>
   下面的每種情境所採用的編排順序是，先在標題中描述問題，隨後用一兩個段落提供建議的解決方案、詳細解決方案的參考資料，以及對其他相關情境的交叉參照。
  </para>
 </sect1>

 <sect1 xml:id="sec-trouble-boot">
  <title>開機問題</title>

  <para>
   開機問題指的是您的系統無法正常開機的狀況 (無法開機進入預期的目標和登入螢幕)。
  </para>

  <sect2 xml:id="sec-trouble-boot-nogrub">
   <title>GRUB 2 開機載入程式無法載入</title>
   <para>
    若硬體運作正常，則可能是開機載入程式已損毀，Linux 無法在機器上啟動。若是這樣的話，必須修復開機載入程式。為此，您需要依<xref linkend="sec-trouble-data-recover-rescue"/>中所述啟動救援系統，然後遵照<xref linkend="sec-trouble-data-recover-rescue-grub"/>中的指示。
   </para>
   <para>
    此外，您可以依照以下方式使用救援系統來修復開機載入程式。從安裝媒體將機器開機。在開機螢幕中，選擇<menuchoice><guimenu>更多</guimenu> <guimenu>將 Linux 系統開機</guimenu></menuchoice>。使用預設核心選項選取包含所安裝系統和核心的磁碟。
   </para>

   

   <para>
    系統開機後，啟動 YaST 並切換到<menuchoice><guimenu>系統</guimenu> <guimenu>開機載入程式</guimenu></menuchoice>。確定啟用了<guimenu>將一般開機碼寫入 MRB</guimenu> 選項，然後按一下<guimenu>確定</guimenu>。如此會透過重寫來修復損毀的開機載入程式，或者安裝缺失的開機載入程式。
   </para>

   <para>
    另一個機器無法開機的原因可能跟 BIOS 有關︰
   </para>
   <variablelist>
    <varlistentry>
     <term>BIOS 設定</term>
     <listitem>
      <para>
       檢查與您硬碟相關的 BIOS 設定。若在目前的 BIOS 設定下找不到硬碟本身，則可能只是未啟動 GRUB 2。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>BIOS 開機順序</term>
     <listitem>
      <para>
       檢查您系統的開機順序是否包含硬碟。若未啟用硬碟選項，您的系統可能已正確安裝，但在需要存取硬碟時無法開機。
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
  </sect2>

  

  <sect2 xml:id="sec-trouble-boot-prompt">
   <title>沒有圖形登入</title>
   <para>
    如果機器能啟動，但無法開機進入圖形登入管理員，則問題可能出在預設的 systemd 目標選項或 X Window System 的組態上。若要檢查目前的 systemd 預設目標，請執行指令 <command>sudo systemctl get-default</command>。如果傳回的值為 <emphasis>not</emphasis>
    <literal> graphical.target</literal>，請執行指令 <command>sudo systemctl isolate graphical.target</command>。如果圖形登入螢幕已啟動，請登入並啟動<menuchoice> <guimenu>YaST</guimenu>
    <guimenu> 系統</guimenu> <guimenu> 服務管理員</guimenu></menuchoice>，然後將<guimenu>預設系統目標</guimenu>設定為<guimenu>圖形介面</guimenu>。此後，系統應該能夠開機進入圖形登入螢幕。
   </para>
   <para>
    如果即使已開機或者切換到圖形目標，圖形登入螢幕也不啟動，則原因可能是您的桌面或 X Window 軟體設定錯誤或者已毀損。請檢查 <filename>/var/log/Xorg.*.log</filename> 中的記錄檔，以瞭解 X 伺服器嘗試啟動時的訊息。如果啟動期間桌面發生錯誤，可能會在系統日誌中記錄錯誤訊息，您可以使用指令 <command>journalctl</command> 查詢該日誌 (如需詳細資訊，請參閱<xref linkend="cha-journalctl"/>)。若這些錯誤訊息指出 X 伺服器中有組態問題，請嘗試修復這些問題。若仍然未出現圖形系統，請考慮重新安裝圖形桌面。
   </para>

  </sect2>

  <sect2 xml:id="sec-trouble-boot-btrfs">
   <title>無法掛接 Btrfs 根分割區</title>
   <para>
    如果 <systemitem class="filesystem">btrfs</systemitem> 根分割區已毀損，請嘗試以下選項︰
   </para>
   <itemizedlist>
    <listitem>
     <para>
      使用 <option>-o recovery</option> 選項掛接該分割區。
     </para>
    </listitem>
    <listitem>
     <remark>toms 2014-03-12: According to FATE#315126: "this one is open to debate, it might do more harm than good.."</remark>
     <para>
      如果不起作用，請在您的根分割區上執行 <command>btrfs-zero-log</command>。
     </para>
    </listitem>
   </itemizedlist>
  </sect2>

  <sect2 xml:id="sec-trouble-boot-forcecheck">
   <title>強制檢查根分割區</title>
   <remark>toms 2016-05-18: FATE#320126</remark>
   <para>
    如果根分割區已損毀，請在開機提示字元中使用參數 
    <parameter>forcefsck</parameter> 。如此即可將選項 <option>-f</option> (force) 傳遞給 <command>fsck</command> 指令。
   </para>
  </sect2>
 </sect1>
 <sect1 xml:id="sec-trouble-login">
  <title>登入問題</title>

  <para>
   登入問題是指機器雖然開機到預期的歡迎畫面或登入提示畫面，卻拒絕接受使用者名稱和密碼，或者雖然接受了使用者名稱和密碼，但是行為異常 (無法啟動圖形桌面、發生錯誤或轉到了指令行等)。
  </para>

  <sect2 xml:id="sec-trouble-login-no">
   <title>有效的使用者名稱和密碼組合失敗</title>
   <para>
    這種情形常發生於系統設定為使用網路驗證或目錄服務時，且基於某些原因，會無法從其所設定的伺服器取得結果。身為唯一的本地使用者，<systemitem class="username">根</systemitem>使用者是唯一仍可登入這些機器的使用者。下面是機器看似運作良好卻無法正確執行登入的一些常見原因︰
   </para>
   <itemizedlist>
    <listitem>
     <para>
      網路未作用。如須對此情況的進一步指示，請參閱<xref linkend="sec-trouble-netconfig"/>。
     </para>
    </listitem>
    <listitem>
     <para>
      DNS 此時未運作（這樣會阻礙 GNOME 運作，也會妨礙系統驗證安全伺服器的要求）。若機器花費過久的時間回應任何動作的話，表示可能是這種情況。如需此主題的詳細資訊，請參閱<xref linkend="sec-trouble-netconfig"/>。
     </para>
    </listitem>
    <listitem>
     <para>
      若系統設定為使用 Kerberos，則系統的本地時間有可能超過了 Kerberos 伺服器時間所容許的時間差 (一般為 300 秒)。若 NTP (網路時間協定) 未正確運作，或本地 NTP 伺服器未運作，則 Kerberos 驗證會停止作用，因為它必須仰賴網路上同步的共同時脈才可運作。
     </para>
    </listitem>
    <listitem>
     <para>
      系統的驗證組態設定錯誤。請檢查 PAM 組態檔案是否有錯字或指示詞順序錯誤。如需關於 PAM 和所包含組態檔案語法的其他背景資料，請參閱<xref linkend="cha-pam"/>。
     </para>
    </listitem>
    <listitem>
     <para>
      主分割區已加密。如需此主題的詳細資訊，請參閱<xref linkend="sec-trouble-login-encrypted"/>。
     </para>
    </listitem>
   </itemizedlist>
   <para>
    對於所有非外部網路造成的問題，解決方案就是重新開機進入單一使用者模式，並修復組態後再次開機進入操作模式，以嘗試重新登入。若要開機進入單一使用者模式︰
   </para>
   <procedure xml:id="proc-trouble-login-no">
    <step>
     <para>
      重新啟動系統。會出現開機畫面及提示。
     </para>
    </step>

    <step>
     <para>
      按 <keycap function="escape"/> 離開開頭顯示畫面，並前往 GRUB 2 文字式功能表。
     </para>
    </step>
    <step>
     <para>
      按 <keycap>B</keycap> 進入 GRUB 2 編輯器。
     </para>
    </step>
    <step>
     <para>
      將以下參數新增到包含核心參數的行中︰
     </para>
<screen>systemd.unit=rescue.target</screen>
    </step>
    <step>
     <para>
      按<keycap>「F10」</keycap>。
     </para>
    </step>
    <step>
     <para>
      輸入 <systemitem class="username">root</systemitem> 的使用者名稱與密碼。
     </para>
    </step>
    <step>
     <para>
      進行必要的所有變更。
     </para>
    </step>
    <step>
     <para>
      在指令行中輸入 <command>systemctl isolate graphical.target</command>，開機進入完整多重使用者及網路模式。
     </para>
    </step>
   </procedure>
  </sect2>

  <sect2 xml:id="sec-trouble-login-pw">
   <title>有效的使用者名稱和密碼不被接受</title>
   <para>
    這顯然是使用者最常遇到的問題，其發生的原因有很多。根據您使用本地使用者管理和驗證，或使用網路驗證，會有不同原因造成登入失敗。
   </para>
   <para>
    本地使用者管理可能因為下列原因而失敗︰
   </para>
   <itemizedlist>
    <listitem>
     <para>
      使用者輸入的密碼有誤。
     </para>
    </listitem>
    <listitem>
     <para>
      使用者包含桌面組態檔的主目錄損毀或有防寫保護。
     </para>
    </listitem>
    <listitem>
     <para>
      X Window System 可能無法驗證此特定使用者，尤其是在安裝目前版本的 Linux 之前，此使用者的主目錄已用於其他 Linux 版本的情況下。
     </para>
    </listitem>
   </itemizedlist>
   <para>
    若要找出本地登入失敗的原因，請執行下列步驟︰
   </para>
   <procedure>
    <step>
     <para>
      開始進行整個驗證機制的偵錯之前，先確認使用者可以正確記住密碼。若使用者無法正確記住密碼，請使用 YaST 使用者管理模組變更使用者的密碼。請注意 <keycap>Caps Lock</keycap> 鍵的使用，並根據需要進行切換。
     </para>
    </step>
    <step>
     <para>
      以 <systemitem class="username">root</systemitem> 身分登入，並使用 <command>journalctl -e</command> 檢查系統日誌，找出登入程序和 PAM 的錯誤訊息。
     </para>
    </step>
    <step>
     <para>
      嘗試從主控台登入 (使用 <keycombo>
      <keycap function="control"/> <keycap function="alt"/> <keycap>F1</keycap>
      </keycombo>)。如果成功，表示問題不在 PAM，因為它能夠在此機器上驗證此使用者。嘗試找出 X Window System 或 GNOME 桌面的任何問題。若需更多資訊，請參閱<xref linkend="sec-trouble-login-dk"/>。
     </para>
    </step>
    <step>
     <para>
      若使用者的主目錄已由其他 Linux 版本使用，請移除使用者主目錄中的 <filename>Xauthority</filename> 檔案。使用主控台透過 <keycombo>
      <keycap function="control"/> <keycap function="alt"/> <keycap>F1</keycap>
      </keycombo> 登入，並以此使用者身份執行 <command>rm .Xauthority</command>。這樣應可排除此使用者的 X 驗證問題。重新嘗試圖形登入。
     </para>
    </step>

    <step>
     <para>
      若由於組態檔案毀損導致桌面無法啟動，請繼續執行<xref linkend="sec-trouble-login-dk"/>。
     </para>
    </step>
   </procedure>
   <para>
    下面列出了特定使用者在特定機器上網路驗證失敗的一些常見原因︰
   </para>
   <itemizedlist>
    <listitem>
     <para>
      使用者輸入的密碼有誤。
     </para>
    </listitem>
    <listitem>
     <para>
      機器的本地驗證檔案中已存在使用者名稱，但網路驗證系統也提供了，兩者產生了衝突。
     </para>
    </listitem>
    <listitem>
     <para>
      主目錄是存在的，但損毀或無法使用。或許此目錄設為防止寫入，或位於此時無法存取的伺服器上。
     </para>
    </listitem>
    <listitem>
     <para>
      使用者沒有登入驗證系統特定主機的許可。
     </para>
    </listitem>
    <listitem>
     <para>
      機器的主機名稱已因某種原因而變更，而使用者沒有登入該主機的許可。
     </para>
    </listitem>
    <listitem>
     <para>
      機器無法聯繫驗證伺服器，或是含有使用者資訊的目錄伺服器。
     </para>
    </listitem>
    <listitem>
     <para>
      X Window System 可能無法驗證此特定使用者，尤其是在安裝目前版本的 Linux 之前，此使用者的主目錄已用於其他 Linux 版本的情況下。
     </para>
    </listitem>
   </itemizedlist>
   <para>
    若要找出登入發生網路驗證失敗的原因，請執行下列步驟︰
   </para>
   <procedure xml:id="proc-trouble-login-pw">
    <step>
     <para>
      進行整個驗證機制的除錯之前，請先確認使用者所記的密碼正確無誤。
     </para>
    </step>
    <step>
     <para>
      確定機器賴以進行驗證的目錄伺服器，並確定該伺服器已啟動且正在執行，而且能夠與其他機器正常進行通訊。
     </para>
    </step>
    <step>
     <para>
      確定使用者的使用者名稱和密碼可以在其他機器上使用，以確定其驗證資料存在，而且已正確配送。
     </para>
    </step>
    <step>
     <para>
      再看看在運作不正常的機器上，可否讓其他使用者登入。若其他使用者可以正常登入，或 <systemitem class="username">root</systemitem> 可以登入的話，請登入並使用 <command>journalctl -e</command>&gt; 檔案檢驗系統日誌。找出嘗試登入所對應的時間戳記，並判斷 PAM 是否已產生任何錯誤訊息。
     </para>
    </step>
    <step>
     <para>
      嘗試從主控台登入 (使用 <keycombo>
      <keycap function="control"/> <keycap function="alt"/> <keycap>F1</keycap>
      </keycombo>)。若是成功，說明問題不是出在 PAM 或使用者主目錄所在的目錄伺服器，因為能夠在此機器上驗證此使用者。嘗試找出 X Window System 或 GNOME 桌面的任何問題。若需更多資訊，請參閱<xref linkend="sec-trouble-login-dk"/>。
     </para>
    </step>
    <step>
     <para>
      若使用者的主目錄已由其他 Linux 版本使用，請移除使用者主目錄中的 <filename>Xauthority</filename> 檔案。使用主控台透過 <keycombo>
      <keycap function="control"/> <keycap function="alt"/> <keycap>F1</keycap>
      </keycombo> 登入，並以此使用者身份執行 <command>rm .Xauthority</command>。這樣應可排除此使用者的 X 驗證問題。重新嘗試圖形登入。
     </para>
    </step>

    <step>
     <para>
      若由於組態檔案毀損導致桌面無法啟動，請繼續執行<xref linkend="sec-trouble-login-dk"/>。
     </para>
    </step>
   </procedure>
  </sect2>

  <sect2 xml:id="sec-trouble-login-encrypted">
   <title>無法登入加密的主分割區</title>
   <para>
    建議對筆記型電腦使用加密的主分割區。如果無法登入您的筆記型電腦，通常只是因為無法解除鎖定您的分割區。
   </para>
   <para>
    開機期間，您需要輸入密碼片語以解除鎖定加密的分割區。如果不輸入密碼片語，則開機程序會繼續，但分割區將處於鎖定狀態。
   </para>
   <para>
    若要解除鎖定加密的分割區，請執行以下步驟︰
   </para>
   <procedure>
    <step>
     <para>
      按 <keycombo> <keycap function="control"/>
      <keycap function="alt"/> <keycap>   F1</keycap> </keycombo>  切換到文字主控台。
     </para>
    </step>
    <step>
     <para>
      以 <systemitem class="username">root</systemitem> 使用者身分登入。
     </para>
    </step>
    <step>
     <para>
      使用以下指令重新啟動解除鎖定程序︰
     </para>
<screen><prompt role="root">root # </prompt>systemctl restart home.mount</screen>
    </step>
    <step>
     <para>
      輸入可解除鎖定加密分割區的密碼片語。
     </para>
    </step>
    <step>
     <para>
      按 <keycombo>
      <keycap function="alt"/> <keycap>   F7</keycap> </keycombo>  離開文字主控台並切換回登入畫面。
     </para>
    </step>
    <step>
     <para>
      像往常一樣登入。
     </para>
    </step>
   </procedure>
  </sect2>

  <sect2 xml:id="sec-trouble-login-dk">
   <title>登入成功但 GNOME 桌面失敗</title>
   <para>
    若出現此狀況，可能是 GNOME 組態檔案已損毀。其他症狀還包括鍵盤無法工作、畫面幾何錯亂，甚至畫面呈現空白的灰色區塊。此問題最重要的區隔是，若其他使用者可以登入，則此機器是正常運作的。此類問題或許可以較快解決，只要將使用者的 GNOME 組態目錄移到新的位置，讓 GNOME 啟始化新的組態目錄即可。雖然這樣算是強制使用者重新設定 GNOME，但並沒有資料因此遺失。
   </para>
   <procedure xml:id="proc-trouble-login-dk">
    <step>
     <para>
      按<keycombo>
      <keycap function="control"/> <keycap function="alt"/> <keycap>   F1</keycap>
      </keycombo> 切換到文字主控台。
     </para>
    </step>
    <step>
     <para>
      使用您的使用者名稱登入。
     </para>
    </step>
    <step>
     <para>
      將使用者的 GNOME 組態目錄移到一個暫時位置︰
     </para>
<screen><prompt>tux &gt; </prompt>mv .gconf  .gconf-ORIG-RECOVER
<prompt>tux &gt; </prompt>mv .gnome2 .gnome2-ORIG-RECOVER</screen>
    </step>
    <step>
     <para>
      登出。
     </para>
    </step>
    <step>
     <para>
      再次登入，勿執行任何應用程式。
     </para>
    </step>
    <step>
     <para>
      依照下列方式將 <filename>~/.gconf-ORIG-RECOVER/apps/</filename> 目錄複製回新的 <filename>~/.gconf</filename> 目錄，修復您的個別應用程式組態資料 (包括 Evolution 電子郵件用戶端資料)︰
     </para>
<screen><prompt>tux &gt; </prompt>cp -a .gconf-ORIG-RECOVER/apps .gconf/</screen>
     <para>
      若這樣導致登入問題，請嘗試僅修復重要的應用程式資料，並重新設定其他的應用程式。
     </para>
    </step>
   </procedure>
  </sect2>
 </sect1>
 <sect1 xml:id="sec-trouble-netconfig">
  <title>網路問題</title>

  <para>
   您系統的許多問題可能都與網路有關，但可能一開始看不出來。例如，系統不允許使用者登入，可能就是某種網路問題所致。本節會介紹簡單的檢查清單，可讓您用來辨識所遇到網路問題的原因。
  </para>

  <procedure xml:id="proc-trouble-config-net">
   <title>如何識別網路問題</title>
   <para>
    檢查機器網路連接時，請如下執行︰
   </para>
   <step>
    <para>
     若使用乙太網路連線，請先檢查硬體。確認您的網路線正確插在電腦和路由器 (或集線器等) 上。正常情況下，乙太網路連接器旁的兩個控制燈都會亮起。
    </para>
    <para>
     若連接失敗，請檢查網路線在其他機器上可否使用。若可以的話，就是您的網路卡造成的問題。若您的網路設定中包含集線器或交換器，也可能是這些裝置的問題。
    </para>
   </step>
   <step>
    <para>
     若使用無線連接的話，請檢查可否由其他機器建立無線連結。若無法建立，請聯絡無線網路管理員。
    </para>
   </step>
   <step>
    <para>
     完成對基本網路連接性的檢查後，請嘗試找出無回應的服務。收集您設定中所需所有網路伺服器的位址資訊。您可在適當的 YaST 模組中查詢，或詢問您的系統管理員。下列清單提供了設定中所包含的一些基本的網路伺服器，以及其故障的症狀。
    </para>
    <variablelist>
     <varlistentry>
      <term>DNS (名稱服務)</term>
      <listitem>
       <para>
        名稱服務損壞或故障會從許多方面影響網路的運作。如果本地機器依賴任意網路伺服器進行驗證，而這些伺服器由於名稱解析問題而無法找到，則使用者甚至還不能登入。網路中由故障名稱伺服管理的機器將無法<quote>看到</quote>彼此，也不能相互通訊。
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>NTP (時間服務)</term>
      <listitem>
       <para>
        NTP 服務的損壞或完全故障會影響 Kerberos 驗證以及 X 伺服器的功能。
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>NFS (檔案服務)</term>
      <listitem>
       <para>
        若應用程式所需的資料儲存於掛接 NFS 的目錄中，萬一此服務關閉或設定錯誤，該應用程式將無法啟動或無法正常運作。最糟糕的情況是，如果因 NFS 伺服器出現故障，而找不到包含 <filename>.gconf</filename> 子目錄的使用者主目錄，則使用者的個人桌面組態將無法起作用。
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>Samba (檔案服務)</term>
      <listitem>
       <para>
        若應用程式所需的資料儲存於出現故障之 Samba 伺服器的目錄中，該應用程式將無法啟動或無法正常運作。
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>NIS (使用者管理)</term>
      <listitem>
       <para>
        若您的 <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> 系統依賴出現故障之 NIS 伺服器提供使用者資料，使用者將無法登入這部機器。
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>LDAP (使用者管理)</term>
      <listitem>
       <para>
        若您的 <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> 系統依賴出現故障之 LDAP 伺服器提供使用者資料，使用者將無法登入這部機器。
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>Kerberos (驗證)</term>
      <listitem>
       <para>
        不進行驗證，也無法登入任何機器。
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>CUPS (網路列印)</term>
      <listitem>
       <para>
        使用者無法列印。
       </para>
      </listitem>
     </varlistentry>
    </variablelist>
   </step>
   <step>
    <para>
     請檢查網路伺服器是否運作，且您的網路設定可否讓您建立連接︰
    </para>
    <important>
     <title>限制</title>
     <para>
      下述偵錯程序只適用於不涉及任何內部路由的簡易網路伺服器/用戶端設定。假設伺服器和用戶端都是相同子網路的成員，不需要其他路由。
     </para>
    </important>
    <substeps performance="required">
     <step>
      <para>
       使用 <command>ping</command>
       <replaceable>IP_ADDRESS/HOSTNAME</replaceable> (以伺服器的主機名稱或 IP 位址取代該項) 來檢查各伺服器是否在正常運作，且能夠回應網路。若此指令成功的話，就會告知您的主機您正在尋找並執行它，且您網路的名稱服務設定是正確的。
      </para>
      <para>
       若 ping 的結果失敗且傳回 <literal>destination host unreachable</literal> (無法聯繫目的地主機)，則您的系統或想找的伺服器可能設定錯誤或故障。從另一部機器執行 <command>ping</command> <replaceable>IP address</replaceable> 或 <replaceable>YOUR_HOSTNAME</replaceable> 指令，以檢查是否可連接您的系統。如果您可以從另一台機器存取您的機器，可能是伺服器未執行或設定錯誤。
      </para>
      <para>
       若 ping 失敗且傳回 <literal>unknown host</literal>，則是名稱服務設定錯誤，或使用的主機名稱不正確。如須對此問題做進一步檢查，請參閱<xref linkend="st-trouble-config-net-host" xrefstyle="StepOnPage"/>。若 ping 仍然失敗，則是您的網路卡未設定正確，或網路硬體故障。
      </para>
     </step>
     <step xml:id="st-trouble-config-net-host">
      <para>
       請使用 <command>host </command> <replaceable>HOSTNAME</replaceable> 來檢查您嘗試連接的伺服器的主機名稱是否正確地轉譯為 IP 位址，反之亦然。若此指令傳回主機的 IP 位址，則名稱服務是啟動且執行中的。如果 <command>host</command> 指令失敗，請在您的主機上檢查所有與名稱及位址解析有關的網路組態檔案︰
      </para>
      <variablelist>
       <varlistentry>
        <term><filename>/etc/resolv.conf</filename>
        </term>
        <listitem>
         <para>
          此檔案用於追蹤您目前使用的名稱伺服器與領域。您可以手動修改此檔案，或以 YaST 或 DHCP 自動調整。建議您採用自動調整。然而，請確定此檔案的結構如下，且所有的網路位址與領域名稱均正確︰
         </para>
<screen>search <replaceable>FULLY_QUALIFIED_DOMAIN_NAME</replaceable>
nameserver <replaceable>IPADDRESS_OF_NAMESERVER</replaceable></screen>
         <para>
          此檔案會包含多個名稱伺服器位址，其中至少有一個必須是正確的，才能為您的主機提供名稱解析。需要時，請使用 YaST 的「網路設定」模組 (「主機名稱/DNS」索引標籤) 調整此檔案。
         </para>
         <para>
          若您是透過 DHCP 處理網路連接的，請在 YaST 的「網路設定」模組 (「主機名稱/DNS」索引標籤) 中選取<guimenu>透過 DHCP 設定主機名稱</guimenu> (可針對所有介面全域設定，也可以逐個介面設定) 和<guimenu>透過 DHCP 更新名稱伺服器和搜尋清單</guimenu>，以允許 DHCP 變更主機名稱和名稱服務資訊。
         </para>
        </listitem>
       </varlistentry>
       <varlistentry>
        <term><filename>/etc/nsswitch.conf</filename>
        </term>
        <listitem>
         <para>
          此檔案會告知 Linux 何處可找到名稱服務資訊。其內容如下︰
         </para>
<screen> ...
hosts: files dns
networks: files dns
...</screen>
         <para>
          <option>dns</option> 項目是必備的。這會告訴 Linux 使用外部名稱伺服器。正常情況下，YaST 會自動管理這些項目，但檢查很謹慎。
         </para>
         <para>
          若主機上所有相關的項目都正確的話，請要求您的系統管理員檢查 DNS 伺服器組態是否具備正確的時區資訊。<phrase os="sles;osuse">如需關於 DNS 的詳細資訊，請參閱<xref linkend="cha-dns"/>。</phrase>若您確定主機和 DNS 伺服器的 DNS 組態正確物誤，請繼續檢查網路組態和網路裝置。
         </para>
        </listitem>
       </varlistentry>
      </variablelist>
     </step>
     <step>
      <para>
       若您的系統無法建立與網路伺服器的連接，且您已經從問題可能原因清單中排除名稱服務的問題，則請檢查網路卡的組態。
      </para>
      <para>
       使用 <command>ip addr show </command>
       <replaceable>NETWORK_DEVICE</replaceable> 指令來檢查是否已正確設定此裝置。確定已正確設定帶有網路遮罩 (<literal>/<replaceable>MASK</replaceable></literal>) 的 <option>inet address</option>。IP 位址有錯誤或網路遮罩有位元遺失的話，都可能造成網路組態無法使用。必要的話，請一併於伺服器上執行此檢查。
      </para>
     </step>
     <step>
      <para>
       如果已正確設定且正在執行名稱服務和網路硬體，但有些外部網路連接仍然長時間逾時或完全失敗，請使用 <command>traceroute</command>
       <replaceable>FULLY_QUALIFIED_DOMAIN_NAME</replaceable> 指令 (以 <systemitem class="username">root</systemitem> 使用者的身分執行) 來追蹤這些要求所採用的網路路由。此指令會列出請求從您機器傳送到其目的地所經的所有閘道 (躍程)。其會列出各躍程的回應時間，以及是否可連接此躍程。請使用 traceroute 加上 ping 找出問題的原因，並告知管理員。
      </para>
     </step>
    </substeps>
   </step>
  </procedure>

  <para>
   當您確定了網路故障的原因後，便可自行解決 (如果問題出在您自己的機器上)，或告訴網路系統管理員您的發現，以便其重新設定服務或修復必要的系統。
  </para>

  <sect2 xml:id="sec-trouble-networkmanager">
   <title>NetworkManager 問題</title>
   <remark>This is a bit small, needs more text.</remark>
   <para>
    若您有網路連接的問題，請依<xref linkend="proc-trouble-config-net"/>所述將範圍調窄。若 NetworkManager 似乎有問題，請執行下列步驟，取得 NetworkManager 故障原因的提示記錄︰
   </para>
   <procedure>
    <step>
     <para>
      開啟外圍程序並以 <systemitem class="username">root</systemitem> 身份登入。
     </para>
    </step>
    <step>
     <para>
      重新啟動 NetworkManager︰
     </para>
<screen><prompt>tux &gt; </prompt><command>sudo</command> systemctl restart NetworkManager</screen>
    </step>
    <step>
     <para>
      以一般使用者身分開啟網頁，例如 <link xlink:href="http://www.opensuse.org"/>，看看是否可以連接。
     </para>
    </step>
    <step>
     <para>
      在 <filename>/var/log/NetworkManager</filename> 中收集 NetworkManager 狀態的所有相關資訊。
     </para>
    </step>
   </procedure>
   <para>
    如需關於 NetworkManager 的詳細資訊，請參閱<xref linkend="cha-nm"/>。
   </para>
  </sect2>
 </sect1>
 <sect1 xml:id="sec-trouble-data">
  <title>資料問題</title>

  <para>
   資料問題是指，機器或許可以 (或無法) 正確開機，但系統上有著明顯的資料損毀，且需要修復。遇到這些情況時，需要用到您重要資料的備份檔案，以讓您的系統回復到故障前的狀態。
  </para>

  <sect2 xml:id="sec-trouble-data-partitions">
   <title>管理分割區影像</title>
   <para>
    有時，您需要對整個分割區甚至是硬碟執行備份。Linux 附帶 <command>dd</command> 工具，可為磁碟建立完全一致的副本。結合 <command>gzip</command>，還能為您節省一些空間。
   </para>
   <procedure>
    <title>備份和還原硬碟</title>
    <step>
     <para>
      以 <systemitem class="username">root</systemitem> 使用者身分啟動外圍程序。
     </para>
    </step>
    <step>
     <para>
      選取來源裝置。一般類似 <filename>/dev/sda</filename> (標示為 <replaceable>SOURCE</replaceable>)。
     </para>
    </step>
    <step>
     <para>
      決定要儲存影像 (標示為 <replaceable>BACKUP_PATH</replaceable>) 的位置。此位置必須不同於來源裝置的位置。換言之，如果您對 <filename>/dev/sda</filename> 進行備份，就不能將影像檔案儲存在 <filename>/dev/sda</filename> 下。
     </para>
    </step>
    <step>
     <para>
      執行以下指令建立壓縮影像檔︰
     </para>
<screen><prompt role="root">root # </prompt>dd if=/dev/<replaceable>SOURCE</replaceable> | gzip &gt; /<replaceable>BACKUP_PATH</replaceable>/image.gz </screen>
    </step>
    <step>
     <para>
      使用以下指令還原硬碟︰
     </para>
<screen><prompt role="root">root # </prompt>gzip -dc /<replaceable>BACKUP_PATH</replaceable>/image.gz | dd of=/dev/<replaceable>SOURCE</replaceable></screen>
    </step>
   </procedure>
   <para>
    如果您只需備份分割區，請使用各個分割區取代指令中預留的 <replaceable>SOURCE</replaceable>。如此，您的影像檔便會存放於同一個硬碟的不同分割區中。
   </para>
  </sect2>





  <xi:include href="system_repair.xml"/>
 </sect1>
 <xi:include href="zseries_rescue_initrd.xml"/>
</chapter>
