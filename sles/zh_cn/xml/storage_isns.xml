<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="storage_isns.xml" version="5.0" xml:id="cha.isns" xml:lang="zh-cn">
 <title>iSNS for Linux</title>
 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:bugtracker/>
   <dm:translation>yes</dm:translation>
  </dm:docmanager>
 </info>
 <para>
  储存区域网络 (SAN) 可包含分布在复杂网络间的许多磁盘驱动器。这会使设备发现和设备所有权变得复杂。iSCSI 发起程序必须能够识别 SAN 中的储存资源，并确定是否可对其进行访问。
 </para>
 <para>
  因特网储存名称服务 (iSNS) 是一项基于标准的服务，使用它可简化 TCP/IP 网络上 iSCSI 设备的自动发现、管理和配置。与光纤通道网络中的服务相比，iSNS 可提供智能的储存发现和管理服务。
 </para>
 <important>
  <title>安全考虑因素</title>
  <para>
   只有在安全的内部网络中，才应使用 iSNS。
  </para>
 </important>
 <sect1 xml:id="sec.isns.overview">
  <title>iSNS 的工作原理</title>

  <para>
   iSCSI 发起程序要发现 iSCSI 目标，需要识别网络中的哪些设备是储存资源以及访问这些资源需要哪些 IP 地址。对 iSNS 服务器的查询会返回发起程序有权访问的一个 iSCSI 目标和 IP 地址的列表。
  </para>

  <para>
   通过使用 iSNS，您创建 iSNS 发现域，随后将 iSCSI 目标和发起程序分组或组织到这些域中。通过将储存节点划分到域，您可以将每个主机的发现进程限制为在 iSNS 中注册的最合适的目标子集，这使得储存网络可通过降低不必要的发现数和限制每个主机在建立发现关系时花费的时间而按比例缩放。这使您可以控制和简化必须发现的目标和发起程序的数目。
  </para>

  <figure>
   <title>iSNS 发现域</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="isns_a.png" width="80%" format="PNG"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="isns_a.png" width="100%" format="PNG"/>
    </imageobject>
   </mediaobject>
  </figure>

  <para>
   iSCSI 目标和 iSCSI 发起程序都使用 iSNS 客户端启动通过 iSNS 协议与 iSNS 服务器的事务。然后，它们在公共发现域中注册设备属性信息、下载有关其他注册客户端的信息，以及接收出现在其发现域中的事件的异步通知。
  </para>

  <para>
   iSNS 服务器响应由 iSNS 客户端使用 iSNS 协议作出的 iSNS 协议查询和请求。iSNS 服务器启动 iSNS 协议状态更改通知，并正确储存由 iSNS 数据库中的注册请求提交的身份验证信息。
  </para>

  <para>
   适用于 Linux 的 iSNS 提供的优点包括：
  </para>

  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>
     提供信息设备以供注册、发现和管理联网储存资产。
    </para>
   </listitem>
   <listitem>
    <para>
     与 DNS 基础结构集成。
    </para>
   </listitem>

   <listitem>
    <para>
     统一 iSCSI 储存的注册、发现和管理。
    </para>
   </listitem>
   <listitem>
    <para>
     简化储存管理实施。
    </para>
   </listitem>
   <listitem>
    <para>
     与其他发现方法相比，改进了可伸缩性。
    </para>
   </listitem>
  </itemizedlist>

  <para>
   以下情境可以帮助您更好地理解 iSNS 的优点：
  </para>



  <para>
   假定您拥有一家配有 100 个 iSCSI 发起程序和 100 个 iSCSI 目标的公司。根据您的配置，所有 iSCSI 发起程序都可能尝试发现并连接到 100 个 iSCSI 目标的任一个。这将造成发现和连接出现问题。通过将发起程序和目标分组到发现域，您可以阻止某个部门的 iSCSI 发起程序发现其他部门的 iSCSI 目标。这会导致特定部门中的 iSCSI 发起程序仅会发现属于该部门发现域的 iSCSI 目标。
  </para>
 </sect1>
 <sect1 xml:id="sec.isns.install">
  <title>安装 iSNS Server for Linux</title>

  <para>
   iSNS Server for Linux 随附于 <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase>，但默认不会对其加以安装或设置。您需要安装包 <systemitem class="resource">open-isns</systemitem> 并设置 iSNS 服务。
  </para>



  <note>
   <title>iSNS 和 iSCSI 在同一服务器上</title>
   <para>
    可以在安装了 iSCSI 目标或 iSCSI 发起程序软件的同一服务器上安装 iSNS。不支持在同一服务器上同时安装 iSCSI 目标软件和 iSCSI 发起程序软件。
   </para>
  </note>

  <para>
   安装 iSNS for Linux：
  </para>

  <procedure>
   <step>
    <para>
     启动 YaST 并选择<menuchoice><guimenu>网络服务</guimenu>
     <guimenu>iSNS 服务器</guimenu></menuchoice>。
    </para>
   </step>
   <step>
    <para>
     如果尚未安装 <systemitem class="resource">open-isns</systemitem>，则系统现在会提示您进行安装。通过单击<guimenu>安装</guimenu>确认安装。
    </para>
   </step>
   <step>
    <para>
     “iSNS 服务”配置对话框会自动打开并显示<guimenu>服务</guimenu>选项卡。
    </para>
    <informalfigure>
     <mediaobject>
      <imageobject role="fo">
       <imagedata fileref="isns_config_a.png" width="80%" format="PNG"/>
      </imageobject>
      <imageobject role="html">
       <imagedata fileref="isns_config_a.png" width="100%" format="PNG"/>
      </imageobject>
     </mediaobject>
    </informalfigure>
   </step>

   <step>
    <para>
     在<guimenu>启动服务</guimenu>中，选择以下选项之一：
    </para>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <formalpara>
       <title>引导时：</title>
       <para>
        iSNS 服务在服务器启动时自动启动。
       </para>
      </formalpara>
     </listitem>
     <listitem>
      <formalpara>
       <title>手动（默认）：</title>
       <para>
        必须在用于安装 iSNS 服务的服务器的控制台中手动输入 <command>sudo systemctl start isnsd</command> 来启动 iSNS 服务。
       </para>
      </formalpara>
     </listitem>
    </itemizedlist>
   </step>
   <step>
    <para>
     指定以下防火墙设置：
    </para>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <formalpara>
       <title>打开防火墙中的端口：</title>
       <para>
        选中该复选框以打开防火墙，并允许从远程计算机访问该服务。默认情况下，防火墙端口是关闭的。
       </para>
      </formalpara>
     </listitem>
     <listitem>
      <formalpara>
       <title>防火墙细节：</title>
       <para>
        如果打开防火墙端口，默认情况下会在所有网络接口上打开该端口。单击<guimenu>防火墙细节</guimenu>以选择要打开该端口的接口，选择要使用的网络接口，然后单击<guimenu>确定</guimenu>。
       </para>
      </formalpara>
     </listitem>
    </itemizedlist>
   </step>
   <step>
    <para>
     单击<guimenu>确定</guimenu>可应用配置设置并完成安装。
    </para>
   </step>
   <step>
    <para>
     继续<xref linkend="sec.isns.domains" xrefstyle="SectTitleOnPage"/>。
    </para>
   </step>
  </procedure>
 </sect1>
 <sect1 xml:id="sec.isns.domains">
  <title>配置 iSNS 发现域</title>

  <para>
   要让 iSCSI 发起端和目标使用 iSNS 服务，它们必须属于某个发现域。
  </para>

  <important>
   <title>iSNS 服务必须处于使用中状态</title>
   <para>
    必须已安装并运行 iSNS 服务，才能设置 iSNS 发现域。有关信息，请参见<xref linkend="sec.isns.start" xrefstyle="SectTitleOnPage"/>。
   </para>
  </important>

  <sect2 xml:id="sec.isns.domains.ddcreate">
   <title>创建 iSNS 发现域</title>
   <para>
    安装 iSNS 服务时，将会自动创建一个名为<guimenu>默认 DD</guimenu> 的默认发现域。已配置为使用 iSNS 的现有 iSCSI 目标和发起程序会自动添加到默认的发现域。
   </para>
   <para>
    创建新的发现域：
   </para>
   <procedure>
    <step>
     <para>
      启动 YaST，然后在<guimenu>网络服务</guimenu>下选择 <guimenu>iSNS 服务器</guimenu>。
     </para>
    </step>
    <step>
     <para>
      单击<guimenu>发现域</guimenu>选项卡。
     </para>
     <para>
      <guimenu>发现域</guimenu>区域列出了所有现有的发现域。您可以<guimenu>创建发现域</guimenu>，或<guimenu>删除</guimenu>现有的发现域。删除域会从域中去除成员，但不会删除iSCSI 节点成员。
     </para>
     <para>
      <guimenu>发现域成员</guimenu>区域列出指派给所选发现域的所有 iSCSI 节点。选择不同的发现域会使用该发现域的成员刷新该列表。您可以在所选发现域中添加和删除 iSCSI 节点。删除 iSCSI 节点会从域中删除该节点，但不会删除该 iSCSI 节点。
     </para>
     <para>
      <guimenu>创建 iSCSI 节点成员</guimenu>允许将尚未注册的节点添加为发现域成员。当 iSCSI 发起程序或目标注册该节点时，它会成为该域的一部分。
     </para>
     <para role="intro">
      当 iSCSI 发起程序执行发现请求时，iSNS 服务会返回作为同一发现域成员的所有 iSCSI 节点目标。
     </para>
     <informalfigure>
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="isns_discdomains_a.png" width="80%" format="PNG"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="isns_discdomains_a.png" width="100%" format="PNG"/>
       </imageobject>
      </mediaobject>
     </informalfigure>
    </step>
    <step>
     <para>
      单击<guimenu>创建发现域</guimenu>按钮。
     </para>
     <para>
      还可以选择现有发现域，然后单击<guimenu>删除</guimenu>按钮删除该发现域。
     </para>
    </step>
    <step>
     <para>
      指定创建的发现域的名称，然后单击<guimenu>确定</guimenu>。
     </para>
    </step>
    <step>
     <para>
      继续<xref linkend="sec.isns.domains.iscsi_nodes" xrefstyle="SectTitleOnPage"/>。
     </para>
    </step>
   </procedure>
  </sect2>

  <sect2 xml:id="sec.isns.domains.iscsi_nodes">
   <title>向发现域添加 iSCSI 节点</title>
   <procedure>
    <step>
     <para>
      启动 YaST，然后在<guimenu>网络服务</guimenu>下选择 <guimenu>iSNS 服务器</guimenu>。
     </para>
    </step>
    <step>
     <para>
      单击 <guimenu>iSCSI 节点</guimenu>选项卡。
     </para>
     <informalfigure>
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="isns_iscsinodes_a.png" width="80%" format="PNG"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="isns_iscsinodes_a.png" width="100%" format="PNG"/>
       </imageobject>
      </mediaobject>
     </informalfigure>
    </step>
    <step>
     <para>
      检查节点列表以确保列出了要使用 iSNS 服务的 iSCSI 目标和发起程序。
     </para>
     <para>
      如果未列出 iSCSI 目标或发起程序，可能需要在节点上重启动 iSCSI 服务。为此，您可以运行
     </para>
<screen>sudo systemctl restart iscsid.socket
sudo systemctl restart iscsi</screen>
     <para>
      重启动发起端，或运行
     </para>
<screen>sudo systemctl restart target-isns</screen>
     <para>
      重启动目标。
     </para>
     <para>
      可以选择某 iSCSI 节点，然后单击<guimenu>删除</guimenu>按钮从 iSNS 数据库中删除该节点。如果不再使用某 iSCSI 节点或已对其重命名，这十分有用。
     </para>
     <para>
      除非删除或注释掉 iSCSI 配置文件的 iSNS 部分，否则，在重启动 iSCSI 服务或重引导服务器时，iSCSI 节点将再次自动添加到列表（iSNS 数据库）。
     </para>
    </step>
    <step>
     <para>
      单击<guimenu>发现域</guimenu>选项卡并选择所需的发现域。
     </para>
    </step>
    <step>
     <para>
      单击<guimenu>添加现有 iSCSI 节点</guimenu>，选择要添加到域中的节点，然后单击<guimenu>添加节点</guimenu>。
     </para>
    </step>
    <step>
     <para>
      为添加至发现域的节点重复上一步，当您完成添加节点时，再单击<guimenu>完成</guimenu>。
     </para>
     <para>
      请注意，一个 iSCSI 节点可属于多个发现域。
     </para>
    </step>
   </procedure>
  </sect2>
 </sect1>
 <sect1 xml:id="sec.isns.start">
  <title>启动 iSNS 服务</title>

  <para>
   必须在安装 iSNS 的服务器上启动它。如果您未将它设置为在引导时启动（有关细节，请参见<xref linkend="sec.isns.install"/>），请在终端控制台中输入以下命令：
  </para>

<screen>sudo systemctl start isnsd</screen>

  <para>
   您还可以对 iSNS 使用 <command>stop</command>、<command>status</command> 和 <command>restart</command> 选项。
  </para>
 </sect1>
 <sect1 xml:id="sec.isns.info">
  <title>更多信息</title>

  <para>
   相关信息请参见 <citetitle>Linux iSNS for iSCSI project</citetitle>（Linux iSNS for iSCSI 项目，网址：<link xlink:href="http://sourceforge.net/projects/linuxisns/"/>）。此项目的电子邮件列表可在 <link xlink:href="http://sourceforge.net/mailarchive/forum.php?forum_name=linuxisns-discussion"/> 中找到。
  </para>

  <para>
   有关 iSNS 的一般信息，请参见 <citetitle>RFC 4171: Internet Storage Name Service</citetitle>（RFC 4171：因特网储存设备名称服务，网址：<link xlink:href="http://www.ietf.org/rfc/rfc4171"/>）。
  </para>
 </sect1>
</chapter>
