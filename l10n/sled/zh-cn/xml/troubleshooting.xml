<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="troubleshooting.xml" version="5.0" xml:id="cha-trouble">
 <title>常见问题及其解决方案</title>
 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:bugtracker/>
   <dm:translation>yes</dm:translation>
  </dm:docmanager>
 </info>
 <para>
  本章将描述一系列可能发生的问题及其解决方法。即使您的情况并未精确地列在这里，也可能有足够相似的情况可提供解决您的问题的方法提示。
 </para>
 <sect1 xml:id="sec-trouble-info">
  <title>查找和收集信息</title>

  <para>
   Linux 报告情况时是很详细的。当您的系统发生问题时，可以从几个位置查看，通常大多数是 Linux 系统的标准日志，有一些是与 <phrase role="productname"><phrase os="sled">SUSE Linux Enterprise Desktop</phrase></phrase> 系统相关的日志。多数日志文件可以用 YaST（<menuchoice>
   <guimenu>杂项</guimenu> <guimenu> 启动日志</guimenu>
   </menuchoice>）查看。
  </para>



  <para>
   使用 YaST 可以收集支持团队所需的所有系统信息。使用<menuchoice>

   <guimenu>其他</guimenu> <guimenu>支持</guimenu> </menuchoice>，然后选择问题类别。当所有信息都被集合后，将其附加在您的支持请求。
  </para>

  <para>
   将出现最常检查的日志文件的列表，并附有其典型用途说明。包含 <filename>~</filename> 的路径是指当前用户的用户主目录。
  </para>

  <table xml:id="tab-trouble-info">
   <title>日志文件</title>
   <tgroup cols="2">
    <thead>
     <row>
      <entry>
       <para>
        日志文件
       </para>
      </entry>
      <entry>
       <para>
        说明
       </para>
      </entry>
     </row>
    </thead>
    <tbody>
     <row>
      <entry>
       <para>
        <filename>~/.xsession-errors</filename>
       </para>
      </entry>
      <entry>
       <para>
        来自当前运行的桌面应用程序的消息。
       </para>
      </entry>
     </row>
     <row>
      <entry>
       <para>
        <filename>/var/log/apparmor/</filename>
       </para>
      </entry>
      <entry>
       <para>
        来自 AppArmor 的日志文件，详细信息请参见<xref linkend="part-apparmor"/>。
       </para>
      </entry>
     </row>
     <row>
      <entry>
       <para>
        <filename>/var/log/audit/audit.log</filename>
       </para>
      </entry>
      <entry>
       <para>
        来自审计的日志文件，用来跟踪对系统的文件、目录或资源的任何访问，并跟踪系统调用。有关详细信息，请参见<xref linkend="part-audit"/>。
       </para>
      </entry>
     </row>

     <row>
      <entry>
       <para>
        <filename>/var/log/mail.*</filename>
       </para>
      </entry>
      <entry>
       <para>
        来自邮件系统的消息。
       </para>
      </entry>
     </row>
     <row>
      <entry>
       <para>
        <filename>/var/log/NetworkManager</filename>
       </para>
      </entry>
      <entry>
       <para>
        来自 NetworkManager 的日志文件通过网络连接收集问题
       </para>
      </entry>
     </row>
     <row>
      <entry>
       <para>
        <filename>/var/log/samba/</filename>
       </para>
      </entry>
      <entry>
       <para>
        包含 Samba 服务器及客户端日志消息的目录。
       </para>
      </entry>
     </row>
     <row>
      <entry>
       <para>
        <filename>/var/log/warn</filename>
       </para>
      </entry>
      <entry>
       <para>
        所有来自内核与系统日志守护程序的消息为<quote>警告</quote>或更高级别。
       </para>
      </entry>
     </row>
     <row>
      <entry>
       <para>
        <filename>/var/log/wtmp</filename>
       </para>
      </entry>
      <entry>
       <para>
        包含当前计算机会话的用户登录记录的二进制文件。可使用 <command>last</command> 查看它。
       </para>
      </entry>
     </row>
     <row>
      <entry>
       <para>
        <filename>/var/log/Xorg&#x002E;*&#x002E;log</filename>
       </para>
      </entry>
      <entry>
       <para>
        来自 X Window 系统的各种启动和运行时日志文件。在调试失败的 X 启动时，该日志很有用。
       </para>
      </entry>
     </row>
     <row>
      <entry>
       <para>
        <filename>/var/log/YaST2/</filename>
       </para>
      </entry>
      <entry>
       <para>
        包含 YaST 操作及其结果的目录。
       </para>
      </entry>
     </row>
     <row>
      <entry>
       <para>
        <filename>/var/log/zypper.log</filename>
       </para>
      </entry>
      <entry>
       <para>
        Zypper 的日志文件。
       </para>
      </entry>
     </row>
    </tbody>
   </tgroup>
  </table>

  <para>
   除了日志文件外，您的计算机还可提供关于运行中的系统的信息。请参见<xref linkend="tab-trouble-system" xrefstyle="select:label title nopage"/>
  </para>

  <table xml:id="tab-trouble-system">
   <title><filename>/proc</filename> 文件系统的系统信息</title>
   <tgroup cols="2">
    <thead>
     <row>
      <entry>
       <para>
        文件
       </para>
      </entry>
      <entry>
       <para>
        说明
       </para>
      </entry>
     </row>
    </thead>
    <tbody>
     <row>
      <entry>
       <para>
        <filename>/proc/cpuinfo</filename>
       </para>
      </entry>
      <entry>
       <para>
        包含处理器信息，包括处理器类型、制造商、型号和性能。
       </para>
      </entry>
     </row>
     <row>
      <entry>
       <para>
        <filename>/proc/dma</filename>
       </para>
      </entry>
      <entry>
       <para>
        显示当前使用的 DMA 通道。
       </para>
      </entry>
     </row>
     <row>
      <entry>
       <para>
        <filename>/proc/interrupts</filename>
       </para>
      </entry>
      <entry>
       <para>
        显示正在使用的中断和已使用的中断数量。
       </para>
      </entry>
     </row>
     <row>
      <entry>
       <para>
        <filename>/proc/iomem</filename>
       </para>
      </entry>
      <entry>
       <para>
        显示 I/O（输入/输出）内存的状态。
       </para>
      </entry>
     </row>
     <row>
      <entry>
       <para>
        <filename>/proc/ioports</filename>
       </para>
      </entry>
      <entry>
       <para>
        显示当时正在使用的 I/O 端口。
       </para>
      </entry>
     </row>
     <row>
      <entry>
       <para>
        <filename>/proc/meminfo</filename>
       </para>
      </entry>
      <entry>
       <para>
        显示内存状态。
       </para>
      </entry>
     </row>
     <row>
      <entry>
       <para>
        <filename>/proc/modules</filename>
       </para>
      </entry>
      <entry>
       <para>
        显示各个模块。
       </para>
      </entry>
     </row>
     <row>
      <entry>
       <para>
        <filename>/proc/mounts</filename>
       </para>
      </entry>
      <entry>
       <para>
        显示当前挂载的设备。
       </para>
      </entry>
     </row>
     <row>
      <entry>
       <para>
        <filename>/proc/partitions</filename>
       </para>
      </entry>
      <entry>
       <para>
        显示所有硬盘的分区。
       </para>
      </entry>
     </row>
     <row>
      <entry>
       <para>
        <filename>/proc/version</filename>
       </para>
      </entry>
      <entry>
       <para>
        显示当前的 Linux 版本。
       </para>
      </entry>
     </row>
    </tbody>
   </tgroup>
  </table>

  <para>
   除了 <filename>/proc</filename> 文件系统外，Linux 内核还可通过 <literal>sysfs</literal> 模块（一个内存内的文件系统）导出信息。该模块表示了内核对象及其属性以及关系。有关 <literal>sysfs</literal> 的更多信息，请参见<xref linkend="cha-udev"/> 中 udev 的环境。<xref linkend="tab-trouble-sysfs" xrefstyle="select:label nopage"/> 包含 <filename>/sys</filename> 下最常见目录的概述。
  </para>

  <table xml:id="tab-trouble-sysfs">
   <title><filename>/sys</filename> 文件系统的系统信息</title>
   <tgroup cols="2">
    <thead>
     <row>
      <entry>
       <para>
        文件
       </para>
      </entry>
      <entry>
       <para>
        说明
       </para>
      </entry>
     </row>
    </thead>
    <tbody>
     <row>
      <entry>
       <para>
        <filename>/sys/block</filename>
       </para>
      </entry>
      <entry>
       <para>
        包含系统中发现的每个块设备的子目录。通常多数是磁盘类设备。
       </para>
      </entry>
     </row>
     <row>
      <entry>
       <para>
        <filename>/sys/bus</filename>
       </para>
      </entry>
      <entry>
       <para>
        包含每个物理总线类型的子目录。
       </para>
      </entry>
     </row>
     <row>
      <entry>
       <para>
        <filename>/sys/class</filename>
       </para>
      </entry>
      <entry>
       <para>
        包含组合为功能型设备（如图形、网络、打印机等）的子目录
       </para>
      </entry>
     </row>
     <row>
      <entry>
       <para>
        <filename>/sys/device</filename>
       </para>
      </entry>
      <entry>
       <para>
        包含全局设备层次结构。
       </para>
      </entry>
     </row>
    </tbody>
   </tgroup>
  </table>

  <para>
   Linux 自带了几个用于系统分析和监视的工具。请参见<xref linkend="cha-util"/>以选择在系统诊断中使用的最重要的工具。
  </para>

  <para>
   以下包含的每个情景都以一个描述问题的标题开头，后跟一两段内容，提供建议的解决方案、解决方案详细信息的参考，以及对其他可能相关的情景的交叉引用。
  </para>
 </sect1>

 <sect1 xml:id="sec-trouble-boot">
  <title>引导问题</title>

  <para>
   引导问题是指系统不能正确引导时出现的情况（不能引导到预期的目标和登录屏幕）。
  </para>

  <sect2 xml:id="sec-trouble-boot-nogrub">
   <title>GRUB 2 引导加载程序无法装载</title>
   <para>
    如果硬件运行正常，则可能是由于引导加载程序已损坏而使 Linux 无法在计算机上启动。在这种情况下，需要修复引导加载程序。为此，您需要按<xref linkend="sec-trouble-data-recover-rescue"/>中所述启动救援系统，然后根据<xref linkend="sec-trouble-data-recover-rescue-grub"/>中的说明操作。
   </para>
   <para>
    另外，您可以按以下方式使用救援系统来修复引导加载程序。从安装媒体引导计算机。在引导屏幕中，选择<menuchoice><guimenu>更多</guimenu> <guimenu>引导 Linux 系统</guimenu></menuchoice>。使用默认内核选项选择包含已安装的系统和内核的磁盘。
   </para>

   

   <para>
    系统引导后，启动 YaST 并切换到<menuchoice><guimenu>系统</guimenu> <guimenu>引导加载程序</guimenu></menuchoice>。确保启用了<guimenu>将通用引导代码写入主引导记录</guimenu>选项，然后单击<guimenu>确定</guimenu>。如此会通过重写来修复损坏的引导加载程序，或者安装缺失的引导加载程序。
   </para>

   <para>
    其他导致计算机无法引导的原因可能与 BIOS 相关：
   </para>
   <variablelist>
    <varlistentry>
     <term>BIOS 设置</term>
     <listitem>
      <para>
       检查与硬盘相关的 BIOS 设置。如果在当前的 BIOS 设置中找不到硬盘本身，GRUB 2 可能就不能启动。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>BIOS 引导顺序</term>
     <listitem>
      <para>
       请检查您的系统引导顺序中是否包含硬盘。如果未启用硬盘选项，即使系统正确安装，在访问所需的硬盘时仍可能无法引导。
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
  </sect2>

  <sect2 xml:id="sec-trouble-boot-hang" os="sled;osuse">
   <title>不显示登录或提示界面</title>
   <para>
    这种情况通常在内核更新失败后发生，称为 <emphasis>kernel panic</emphasis>，原因是该过程中最后阶段有时可以在系统控制台上的错误类型。如果实际上计算机刚刚在软件更新后重引导，则当前目标是使用旧的经过验证的 Linux 版本内核和关联文件重引导。引导过程中，可以在 GRUB 引导加载程序屏幕中通过以下方式来实现此目的：
   </para>
   <procedure>
    <step>
     <para>
      用重设置按钮重引导计算机，或关闭它之后再打开。
     </para>
    </step>
    <step>
     <para>
      当 GRUB 2 引导屏幕显示时，选择<guimenu>高级选项</guimenu>这一项，然后从菜单中选择之前的内核。计算机将使用内核的前一个版本及其关联文件引导。
     </para>
    </step>
    <step xml:id="st-trouble-boot-hang-modify-grub">
     <para>
      在引导过程完成后，使用 YaST 的<guimenu>引导加载程序</guimenu>模块去除新安装的内核，并根据需要将默认引导项设置为原先的内核。有关详细信息，请参见<xref linkend="sec-grub2-yast2-config"/>。不过，这可能并不是必须要进行的操作，因为回滚过程中自动更新工具通常会为您修改它。
     </para>
    </step>
    <step>
     <para>
      重引导。
     </para>
    </step>
   </procedure>
   <para>
    如果这样不能修复问题，请使用安装媒体引导计算机。计算机引导之后，继续至<xref linkend="st-trouble-boot-hang-modify-grub" xrefstyle="StepOnPage"/>。
   </para>
  </sect2>

  <sect2 xml:id="sec-trouble-boot-prompt">
   <title>无图形登录</title>
   <para>
    如果计算机能够启动，但是无法引导进入图形登录管理器，则问题可能出在默认的 systemd 目标选项或 X Window 系统的配置上。要检查当前的 systemd 默认目标，请运行命令 <command>sudo systemctl get-default</command>。如果返回的值为 <emphasis>not</emphasis>
    <literal> graphical.target</literal>，请运行命令 <command>sudo systemctl isolate graphical.target</command>。如果图形登录屏幕已启动，请登录并启动 <menuchoice> <guimenu>YaST</guimenu>
    <guimenu> 系统</guimenu> <guimenu> 服务管理器</guimenu></menuchoice>，然后将<guimenu>默认系统目标</guimenu>设置为<guimenu>图形界面</guimenu>。此后，系统应该能够引导进入图形登录屏幕。
   </para>
   <para>
    如果即使已引导或者切换到图形目标，图形登录屏幕也不启动，则原因可能是您的桌面或 X Window 软件设置错误或者已损坏。检查 <filename>/var/log/Xorg&#x002E;*&#x002E;log</filename> 中的日志文件，以了解 X 服务器尝试启动时发出的详细消息。如果桌面在启动期间发生错误，可能会在系统日志中记录错误消息，您可以使用命令 <command>journalctl</command> 查询该日志（有关详细信息，请参见<xref linkend="cha-journalctl"/>）。如果这些错误消息指出问题出在 X 服务器中的配置上，请尝试修正这些问题。如果图形系统仍无法启动，请考虑重安装图形桌面。
   </para>

  </sect2>

  <sect2 xml:id="sec-trouble-boot-btrfs">
   <title>无法挂载 Btrfs 根分区</title>
   <para>
    如果 <systemitem class="filesystem">btrfs</systemitem> 根分区已损坏，请尝试以下选项：
   </para>
   <itemizedlist>
    <listitem>
     <para>
      使用 <option>-o recovery</option> 选项挂载该分区。
     </para>
    </listitem>
    <listitem>
     <remark>toms 2014-03-12: According to FATE#315126: "this one is open to
      debate, it might do more harm than good.."</remark>
     <para>
      如果不起使用，请在您的根分区上运行 <command>btrfs-zero-log</command>。
     </para>
    </listitem>
   </itemizedlist>
  </sect2>

  <sect2 xml:id="sec-trouble-boot-forcecheck">
   <title>强制检查根分区</title>
   <remark>toms 2016-05-18: FATE#320126</remark>
   <para>
    如果根分区被破坏，请在引导提示符处使用 <parameter>forcefsck</parameter> 参数：这样会将选项 <option>-f</option> (force) 传递给 <command>fsck</command> 命令。
   </para>
  </sect2>
  
  <sect2 xml:id="sec-trouble-boot-disable-swap">
      <title>禁用交换以启用引导</title>
      <para>
          当某个交换设备不可用且系统在引导期间无法启用该设备时，引导可能会失败。通过将以下选项追加到内核命令行，来尝试禁用所有交换设备：
      </para>
      <screen>systemd.device_wants_unit=off systemd.mask=swap.target</screen>
      <para>
          您也可以尝试禁用特定的交换设备：
      </para>
      <screen>systemd.mask=dev-sda1.swap</screen>
  </sect2>
  
  <sect2 xml:id="sec-trouble-boot-dual-boot">
   <title>GRUB 2 在双引导系统上重引导时失败</title>
   <remark>jufa 2021-06-09: bsc#1185274</remark>
   <para>
    如果 GRUB 2 在重引导期间失败，请禁用 BIOS 中的<option>快速引导</option>设置。
     </para>
   
  </sect2>
 </sect1>
 
 <sect1 xml:id="sec-trouble-login">
  <title>登录问题</title>

  <para>
   登录问题是指计算机虽然引导到预期的欢迎屏幕或登录提示界面，却拒绝接受用户名和口令，或者虽然接受了用户名和口令，但是行为异常（无法启动图形桌面、发生错误或转到了命令行等）。
  </para>

  <sect2 xml:id="sec-trouble-login-no">
   <title>有效的用户名和口令组合失败</title>
   <para>
    如果系统配置为使用网络身份验证或目录服务，但出于某些原因无法从为其配置的服务器上检索到结果，通常就会发生此问题。只有作为唯一本地用户的 <systemitem class="username">root</systemitem> 用户仍能登录到这些计算机。以下是计算机看似能够运行但无法正确处理登录的常见原因：
   </para>
   <itemizedlist>
    <listitem>
     <para>
      网络出现故障。有关此问题的进一步说明，请转到<xref linkend="sec-trouble-netconfig"/>。
     </para>
    </listitem>
    <listitem>
     <para>
      DNS 在当时不起作用（这使得 GNOME 不起作用，并使系统无法向安全服务器发出经验证的请求）。如果是这种情况，则表现为计算机对任何操作的响应都需要极其长的时间。有关该主题的详细信息，请参见<xref linkend="sec-trouble-netconfig"/>。
     </para>
    </listitem>
    <listitem>
     <para>
      如果将系统配置为使用 Kerberos，则系统的本地时间与 Kerberos 服务器时间之间的差异可能超过了可接受的值（通常为 300 秒）。如果 NTP（网络时间协议）未正确地起作用，或者本地 NTP 服务器不起作用，则 Kerberos 身份验证将不再工作，因为该身份验证依赖于整个网络的通用时钟同步。
     </para>
    </listitem>
    <listitem>
     <para>
      系统的身份验证配置不正确。请对相关的 PAM 配置文件进行检查以确定是否存在指令输入错误或排序错误。有关 PAM 的其他背景信息及相关配置文件的语法，请参见<xref linkend="cha-pam"/>。
     </para>
    </listitem>
    <listitem>
     <para>
      主分区是加密的。有关该主题的详细信息，请参见<xref linkend="sec-trouble-login-encrypted"/>。
     </para>
    </listitem>
   </itemizedlist>
   <para>
    在不涉及外部网络问题的所有情况下，解决方法是将系统重引导到单用户方式并修复配置，然后再次引导到操作方式并重试登录。要引导到单用户方式，请执行以下操作：
   </para>
   <procedure xml:id="proc-trouble-login-no">
    <step>
     <para>
      重新启动系统。此时将出现引导屏幕，其中显示一个提示。
     </para>
    </step>

    <step>
     <para>
      按 <keycap function="escape"/> 退出启动屏幕，并转到 GRUB 2 基于文本的菜单。
     </para>
    </step>
    <step>
     <para>
      按 <keycap>B</keycap> 进入 GRUB 2 编辑器。
     </para>
    </step>
    <step>
     <para>
      在包含内核参数的行中添加以下参数：
     </para>
<screen>systemd.unit=rescue.target</screen>
    </step>
    <step>
     <para>
      按 <keycap>F10</keycap>。
     </para>
    </step>
    <step>
     <para>
      输入 <systemitem class="username">root</systemitem> 的用户名与口令。
     </para>
    </step>
    <step>
     <para>
      进行必要的一切更改。
     </para>
    </step>
    <step>
     <para>
      在命令行中输入 <command>systemctl isolate graphical.target</command>，以引导进入完全的多用户和网络模式。
     </para>
    </step>
   </procedure>
  </sect2>

  <sect2 xml:id="sec-trouble-login-pw">
   <title>有效的用户名和口令不被接受</title>
   <para>
    这是到目前为止用户最常遇到的问题，因为有许多原因可能引起该问题。登录失败可由多种原因造成，取决于您是使用本地用户管理和身份验证，还是使用网络身份验证。
   </para>
   <para>
    本地用户管理失败可由以下原因造成：
   </para>
   <itemizedlist>
    <listitem>
     <para>
      用户可能输入了错误的口令。
     </para>
    </listitem>
    <listitem>
     <para>
      用户包含桌面配置文件的主目录已损坏或被写保护。
     </para>
    </listitem>
    <listitem>
     <para>
      验证该特定用户的 X Window 系统可能存在问题，尤其是在安装当前版本之前，该用户的主目录已被其他 Linux 分发版使用时。
     </para>
    </listitem>
   </itemizedlist>
   <para>
    要找到本地登录失败的原因，请执行如下操作：
   </para>
   <procedure>
    <step>
     <para>
      在尝试调试整个身份验证机制之前，请检查用户所记的口令是否正确。如果用户记错了口令，请使用“YaST 用户管理”模块更改其口令。注意 <keycap>Caps Lock</keycap> 键，如果需要请解锁。
     </para>
    </step>
    <step>
     <para>
      以 <systemitem class="username">root</systemitem> 身份登录，并使用 <command>journalctl -e</command> 检查系统日志，找出登录过程和 PAM 的错误消息。
     </para>
    </step>
    <step>
     <para>
      尝试从控制台登录（使用 <keycombo>
      <keycap function="control"/> <keycap function="alt"/> <keycap>F1</keycap>
      </keycombo>）。如果成功了，则问题不在 PAM 上，因为可以在该计算机上身份验证此用户。尝试找出与 X Window 系统或 GNOME 桌面相关的任何问题。有关详细信息，请参见<xref linkend="sec-trouble-login-dk"/>。
     </para>
    </step>
    <step>
     <para>
      如果用户的主目录被其他 Linux 产品所使用，请将该用户主目录中的 <filename>Xauthority</filename> 文件删除。使用控制台登录（通过 <keycombo>
      <keycap function="control"/> <keycap function="alt"/> <keycap>F1</keycap>
      </keycombo>），然后以该用户的身份运行 <command>rm .Xauthority</command>。这样应该可以消除该用户的 X 身份验证问题。然后再次尝试图形登录。
     </para>
    </step>

    <step>
     <para>
      如果桌面由于配置文件损坏而无法启动，请参见<xref linkend="sec-trouble-login-dk"/>。
     </para>
    </step>
   </procedure>
   <para>
    下面列出了在特定的计算机上对特定用户进行的网络身份验证可能失败的常见原因：
   </para>
   <itemizedlist>
    <listitem>
     <para>
      用户可能输入了错误的口令。
     </para>
    </listitem>
    <listitem>
     <para>
      用户名存在于计算机的本地身份验证文件中，但同时网络身份验证系统也提供了该用户名，从而引起冲突。
     </para>
    </listitem>
    <listitem>
     <para>
      主目录存在，但已损坏或不可用。该目录可能处于写保护状态或位于此刻无法访问的服务器上。
     </para>
    </listitem>
    <listitem>
     <para>
      用户无权登录到身份验证系统中的该特定主机。
     </para>
    </listitem>
    <listitem>
     <para>
      计算机出于某种原因更改了主机名，而用户无权登录到该主机。
     </para>
    </listitem>
    <listitem>
     <para>
      计算机无法访问包含该用户信息的身份验证服务器或目录服务器。
     </para>
    </listitem>
    <listitem>
     <para>
      验证该特定用户的 X Window 系统可能存在问题，尤其是在安装当前办法之前，该用户的主目录已被其他 Linux 分发版使用时。
     </para>
    </listitem>
   </itemizedlist>
   <para>
    要通过网络身份验证找到登录问题的原因，请执行以下步骤：
   </para>
   <procedure xml:id="proc-trouble-login-pw">
    <step>
     <para>
      在尝试调试整个身份验证机制之前，请检查用户所记的口令是否正确。
     </para>
    </step>
    <step>
     <para>
      确定计算机在身份验证时要依赖的目录服务器，并确保计算机在正常运行且与其他计算机正常通讯。
     </para>
    </step>
    <step>
     <para>
      确定该用户的用户名和口令在其他计算机上是否有效，以确保存在该用户的身份验证数据且已正确分发。
     </para>
    </step>
    <step>
     <para>
      确定其他用户是否可以登录到该故障计算机。如果其他用户可以正常登录，或 <systemitem class="username">root</systemitem> 可以登录的话，请登录并使用 <command>journalctl -e</command>&gt; 文件检查系统日志。找到与登录尝试相对应的时间戳记，然后确定 PAM 是否生成了任何错误消息。
     </para>
    </step>
    <step>
     <para>
      尝试从控制台登录（使用 <keycombo>
      <keycap function="control"/> <keycap function="alt"/> <keycap>F1</keycap>
      </keycombo>）。如果成功，则问题不在用户主目录中的 PAM 或目录服务器上，因为可以在该计算机上验证此用户。尝试找出与 X Window 系统或 GNOME 桌面相关的任何问题。有关详细信息，请参见<xref linkend="sec-trouble-login-dk"/>。
     </para>
    </step>
    <step>
     <para>
      如果用户的主目录被其他 Linux 产品所使用，请将该用户主目录中的 <filename>Xauthority</filename> 文件删除。使用控制台登录（通过 <keycombo>
      <keycap function="control"/> <keycap function="alt"/> <keycap>F1</keycap>
      </keycombo>），然后以该用户的身份运行 <command>rm .Xauthority</command>。这样应该可以消除该用户的 X 身份验证问题。然后再次尝试图形登录。
     </para>
    </step>

    <step>
     <para>
      如果桌面由于配置文件损坏而无法启动，请参见<xref linkend="sec-trouble-login-dk"/>。
     </para>
    </step>
   </procedure>
  </sect2>

  <sect2 xml:id="sec-trouble-login-encrypted">
   <title>登录至加密的主分区失败</title>
   <para>
    对于便携式计算机建议使用加密的主分区。如果无法登录到您的便携式计算机，原因通常很简单：您的分区无法解锁。
   </para>
   <para>
    在引导时，需要输入通行口令来解锁加密的分区。如果不输入它，引导进程继续，但保持分区锁定。
   </para>
   <para>
    要解锁您的加密分区，请如下操作：
   </para>
   <procedure>
    <step>
     <para>
      按 <keycombo> <keycap function="control"/>
      <keycap function="alt"/> <keycap>F1</keycap> </keycombo> 切换到文本控制台。
     </para>
    </step>
    <step>
     <para>
      以 <systemitem class="username">root</systemitem> 用户身份登录。
     </para>
    </step>
    <step>
     <para>
      用以下步骤重启动解锁进程：
     </para>
<screen><prompt role="root"># </prompt>systemctl restart home.mount</screen>
    </step>
    <step>
     <para>
      输入您的通行口令以解锁加密的分区。
     </para>
    </step>
    <step>
     <para>
      用 <keycombo>
      <keycap function="alt"/> <keycap>F7</keycap> </keycombo> 退出文本控制台并切换回登录屏幕。
     </para>
    </step>
    <step>
     <para>
      如常登录。
     </para>
    </step>
   </procedure>
  </sect2>

  <sect2 xml:id="sec-trouble-login-dk">
   <title>GNOME 桌面有问题</title>
   <para>
     如果您遇到 GNOME 桌面问题，可以使用几种方法对行为异常的图形桌面环境进行查错。下面所述的建议过程提供了修复损坏的 GNOME 桌面的最安全选项。
   </para>
   <procedure>
     <title>GNOME 查错</title>
     <step>
       <para>
	 启动 YaST 并切换到<guimenu>安全和用户</guimenu>。
       </para>
     </step>
     <step>
       <para>
	 打开<guimenu>用户和组管理</guimenu>对话框并单击<guimenu>添加</guimenu>。
       </para>
     </step>
     <step>
       <para>
	 填写必填字段，然后单击<guimenu>确定</guimenu>以创建新用户。
       </para>
     </step>
     <step>
       <para>
	 注销并以新用户身份登录。这将为您提供一个全新的 GNOME 环境。
       </para>
     </step>
     <step>
       <para>
	 将旧用户帐户的 <filename>~/.local/</filename> 和 <filename>~/.config/</filename> 目录中的单个子目录复制到新用户帐户的对应目录。
       </para>
       <para>
	 每次复制操作之后，注销并以新用户身份再次登录，以检查 GNOME 是否仍正常工作。
       </para>
     </step>
     <step>
       <para>
	 重复上一步，直到找到破坏 GNOME 的配置文件。
       </para>
     </step>
     <step>
       <para>
	 以旧用户身份登录，并将有问题的配置文件移到其他位置。注销并以旧用户身份再次登录。
       </para>
     </step>
     <step>
       <para>
	 删除之前创建的用户。
       </para>
     </step>
   </procedure>
  </sect2>

 </sect1>
 <sect1 xml:id="sec-trouble-netconfig">
  <title>网络问题</title>

  <para>
   系统的许多问题可能都与网络相关，即使初看起来不是这样。例如，系统不允许用户登录可能是某种网络问题造成的。本节介绍一个简单的核对表，您可以使用它来确定任何所遇到的网络问题的原因。
  </para>

  <procedure xml:id="proc-trouble-config-net">
   <title>如何识别网络问题</title>
   <para>
    在检查计算机的网络连接时，请执行如下操作：
   </para>
   <step>
    <para>
     如果使用的是以太网连接，请首先检查硬件。确保您的网络电缆已正确插入计算机和路由器（或集线器等）。以太网连接器旁边的控制灯通常应全部激活。
    </para>
    <para>
     如果连接失败，请检查网线在别的计算机上是否正常。如果正常，则可能是网卡引起了该问题。如果您的网络设置中有集线器或交换机，它们也可能有故障。
    </para>
   </step>
   <step>
    <para>
     如果使用的是无线连接，请检查是否可与其他计算机建立此无线链接。如果没有，请联系无线网络的管理员。
    </para>
   </step>
   <step>
    <para>
     完成对基本网络连通性的检查后，请尝试找出没有响应的服务。收集设置中所需的所有网络服务器的地址信息。在相应的 YaST 模块中查找这些信息，或者询问您的系统管理员。下面列出了设置中涉及的一些典型网络服务器以及服务中断的症状。
    </para>
    <variablelist>
     <varlistentry>
      <term>DNS（名称服务）</term>
      <listitem>
       <para>
        名称服务中断或发生故障会在许多方面影响网络运行。如果本地计算机依赖于任一网络服务器进行身份验证，而这些服务器由于名称解析问题而无法找到，则用户甚至还不能登录。网络中由中断的名称服务管理的计算机将无法<quote>看到</quote>彼此且不能通信。
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>NTP（时间服务）</term>
      <listitem>
       <para>
        NTP 服务发生故障或完全中断可能会影响 Kerberos 身份验证和 X 服务器功能。
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>NFS（文件服务）</term>
      <listitem>
       <para>
        如果任何应用程序所需的数据储存在 NFS 挂载目录中，则一旦此服务停止或配置错误，应用程序便无法启动或正常运行。最坏的情况是，如果由于 NFS 服务器发生故障而无法找到包含 <filename>.gconf</filename> 子目录的用户主目录，则该用户主目录所属的用户的个人桌面配置将无法启动。
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>Samba（文件服务）</term>
      <listitem>
       <para>
        如果任何应用程序需要的数据储存在有故障的 Samba 服务器上的某个目录中，它便无法启动或正常运行。
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>NIS（用户管理）</term>
      <listitem>
       <para>
        如果您的 <phrase role="productname"><phrase os="sled">SUSE Linux Enterprise Desktop</phrase></phrase> 系统依赖有故障的 NIS 服务器提供用户数据，用户将无法登录此计算机。
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>LDAP（用户管理）</term>
      <listitem>
       <para>
        如果您的 <phrase role="productname"><phrase os="sled">SUSE Linux Enterprise Desktop</phrase></phrase> 系统依赖有故障的 LDAP 服务器提供用户数据，用户将无法登录此计算机。
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>Kerberos（身份验证）</term>
      <listitem>
       <para>
        身份验证无法进行，登录至任何计算机都会失败。
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>CUPS（网络打印）</term>
      <listitem>
       <para>
        用户无法打印。
       </para>
      </listitem>
     </varlistentry>
    </variablelist>
   </step>
   <step>
    <para>
     请检查网络服务器是否正在运行并且您的网络设置是否允许您建立连接：
    </para>
    <important>
     <title>限制</title>
     <para>
      下面介绍的调试步骤只适用于简单的网络服务器/客户端设置，不涉及任何内部路由。假设服务器和客户端都是同一子网的成员，不需要额外的路由。
     </para>
    </important>
    <substeps performance="required">
     <step>
      <para>
       使用 <command>ping</command>
       <replaceable>IP_ADDRESS/HOSTNAME</replaceable>（用服务器的主机名或 IP 地址替换）来检查各台服务器是否正在运行，且能够对网络作出响应。如果此命令成功，表示您所查找的主机在正常运行，并且网络的名称服务配置正确。
      </para>
      <para>
       如果 ping 命令失败，同时显示消息<literal>目标主机不可访问</literal>，则表明您的系统或期望的服务器未正确配置或已宕机。从另一台计算机运行 <command>ping</command> <replaceable>IP address</replaceable> 或 <replaceable>YOUR_HOSTNAME</replaceable> 命令，来检查是否可连接您的系统。如果可以从其他计算机访问您的计算机，则表明该服务器未运行或未正确配置。
      </para>
      <para>
       如果 ping 命令失败且返回 <literal>unknown host</literal>，则表示名称服务未正确配置或使用的主机名不正确。要对该问题进行进一步的检查，请参见<xref linkend="st-trouble-config-net-host" xrefstyle="StepOnPage"/>。如果 ping 命令仍然失败，则可能网卡未正确配置或网络硬件存在故障。
      </para>
     </step>
     <step xml:id="st-trouble-config-net-host">
      <para>
       请使用 <command>host </command> <replaceable>HOSTNAME</replaceable> 来检查您尝试连接的服务器的主机名是否正确地转译为 IP 地址，反之亦然。如果此命令返回了该主机的 IP 地址，则名称服务已在正常运行。如果 <command>host</command> 命令失败，请检查您主机上所有与名称和地址解析相关的网络配置文件：
      </para>
      <variablelist>
       <varlistentry>
        <term><filename>/var/run/netconfig/resolv.conf</filename>
        </term>
        <listitem>
         <para>
          此文件用于对当前使用的名称服务器和域进行跟踪。它是 <filename>/run/netconfig/resolv.conf</filename> 的符号链接，YaST 或 DHCP 通常会自动对其进行调整。请确保此文件采用以下结构，并且所有的网络地址和域名都正确无误：
         </para>
<screen>search <replaceable>FULLY_QUALIFIED_DOMAIN_NAME</replaceable>
nameserver <replaceable>IPADDRESS_OF_NAMESERVER</replaceable></screen>
         <para>
          此文件中可以包含多个名称服务器地址，但是其中必须至少有一个能够对您的主机提供正确的名称解析。如果需要，请使用 YaST 的“网络设置”模块（“主机名/DNS”选项卡）调整此文件。
         </para>
         <para>
          如果您的网络连接是通过 DHCP 处理的，请在 YaST 的“网络设置”模块（“主机名/DNS”选项卡）中选择<guimenu>通过 DHCP 设置主机名</guimenu>（可针对所有接口全局设置，也可以逐个接口设置）和<guimenu>通过 DHCP 更新名称服务器和搜索列表</guimenu>，以允许 DHCP 更改主机名和名称服务信息。
         </para>
        </listitem>
       </varlistentry>
       <varlistentry>
        <term><filename>/etc/nsswitch.conf</filename>
        </term>
        <listitem>
         <para>
          此文件告诉 Linux 到何处查找名称服务信息。它应显示为：
         </para>
<screen> ...
hosts: files dns
networks: files dns
...</screen>
         <para>
          <option>dns </option>条目是必需的。它告诉 Linux 要使用外部名称服务器。通常这些项是 YaST 自动管理的，但最好谨慎地检查。
         </para>
         <para>
          如果主机上的所有相关条目均正确，请让系统管理员检查 DNS 服务器配置，以确定时区信息是否正确。如果确信主机和 DNS 服务器的 DNS 配置正确，请检查网络和网络设备的配置。
         </para>
        </listitem>
       </varlistentry>
      </variablelist>
     </step>
     <step>
      <para>
       如果系统无法与网络服务器建立连接，并且已排除了名称服务出现问题的可能，则请检查网卡的配置。
      </para>
      <para>
       使用 <command>ip addr show </command>
       <replaceable>NETWORK_DEVICE</replaceable> 命令来检查此设备是否已正确配置。确保已正确设置带网络掩码 (<literal>/<replaceable>MASK</replaceable></literal>) 的 <option>inet address</option>。如果 IP 地址中出现错误或网络掩码中缺少一位，将使您的网络配置无法使用。如有必要，也在服务器上执行该检查。
      </para>
     </step>
     <step>
      <para>
       如果名称服务和网络硬件已正确配置且正在运行，但有些外部网络连接仍然长时间超时或完全失败，请使用 <command>traceroute</command>
       <replaceable>FULLY_QUALIFIED_DOMAIN_NAME</replaceable> 命令（以 <systemitem class="username">root</systemitem> 用户的身份执行）来跟踪这些请求所经过的网络路由。此命令将列出某一请求从您的计算机传递到其目标所经过的所有网关（跳跃）。其中列出了每个跃点的响应时间以及此跃点是否可访问。请将 traceroute 和 ping 结合使用以确定故障原因并通知管理员。
      </para>
     </step>
    </substeps>
   </step>
  </procedure>

  <para>
   确定了网络故障的原因后，就可以自行解决（如果问题出在您自己的机器上），或告诉网络系统管理员您的发现，以便其重新配置服务或修复必要的系统。
  </para>

  <sect2 xml:id="sec-trouble-networkmanager">
   <title>NetworkManager 问题</title>
   <remark>This is a bit small, needs more text.</remark>
   <para>
    如果网络连接有问题，请按<xref linkend="proc-trouble-config-net"/> 中所述缩小范围。如果 NetworkManager 看上去有问题，请执行以下步骤，以获取相关的日志来找出 NetworkManager 失败原因的线索：
   </para>
   <procedure>
    <step>
     <para>
      以 <systemitem class="username">root</systemitem> 用户身份打开外壳并登录。
     </para>
    </step>
    <step>
     <para>
      重启动 NetworkManager：
     </para>
<screen><prompt>&gt; </prompt><command>sudo</command> systemctl restart NetworkManager</screen>
    </step>
    <step>
     <para>
      以普通用户身份打开一个网页，例如 <link xlink:href="http://www.opensuse.org"/>，看看是否可以连接。
     </para>
    </step>
    <step>
     <para>
      收集 <filename>/var/log/NetworkManager</filename> 中有关 NetworkManager 状态的任何信息。
     </para>
    </step>
   </procedure>
   <para>
    有关 NetworkManager 的更多信息，请参考<xref linkend="cha-nm"/>。
   </para>
  </sect2>
 </sect1>
 <sect1 xml:id="sec-trouble-data">
  <title>数据问题</title>

  <para>
   数据问题是指无论计算机是否能够正确引导，有一点是明确的，即系统上的数据损坏并且系统需要恢复。这些情况下需要对关键数据进行备份，以便您能够在系统出现故障时恢复故障前的状态。
  </para>

  <sect2 xml:id="sec-trouble-data-partitions">
   <title>管理分区映像</title>
   <para>
    有时您需要从整个分区甚至硬盘来执行备份。Linux 附带了 <command>dd</command> 工具，该工具可用于创建磁盘的精确副本。与 <command>gzip</command> 一起使用可节约一些空间。
   </para>
   <procedure>
    <title>备份和恢复硬盘</title>
    <step>
     <para>
      以 <systemitem class="username">root</systemitem> 用户身份启动外壳。
     </para>
    </step>
    <step>
     <para>
      选择源设备。通常形如 <filename>/dev/sda</filename>（标记为 <replaceable>SOURCE</replaceable>）。
     </para>
    </step>
    <step>
     <para>
      确定要把您的映像储存在何处（标记为 <replaceable>BACKUP_PATH</replaceable>）。它不能与您的源设备相同。换句话说：如果从 <filename>/dev/sda</filename> 备份，则映像文件不得储存在 <filename>/dev/sda</filename> 下。
     </para>
    </step>
    <step>
     <para>
      运行以下命令创建压缩映像文件：
     </para>
<screen><prompt role="root"># </prompt>dd if=/dev/<replaceable>SOURCE</replaceable> | gzip &gt; /<replaceable>BACKUP_PATH</replaceable>/image.gz </screen>
    </step>
    <step>
     <para>
      用以下命令恢复硬盘：
     </para>
<screen><prompt role="root"># </prompt>gzip -dc /<replaceable>BACKUP_PATH</replaceable>/image.gz | dd of=/dev/<replaceable>SOURCE</replaceable></screen>
    </step>
   </procedure>
   <para>
    如果只需备份某个分区，请将 <replaceable>SOURCE</replaceable> 占位符替换为相应的分区。在这种情况下，映像文件可以位于同一硬盘上不同的分区中。
   </para>
  </sect2>





  <xi:include href="system_repair.xml"/>
 </sect1>
 
 
</chapter>
