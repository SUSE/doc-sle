<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="storage_fs-resizing.xml" version="5.0" xml:id="cha-resize-fs" xml:lang="zh-tw">
 <title>調整檔案系統的大小</title>
 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:bugtracker/>
   <dm:translation>yes</dm:translation>
  </dm:docmanager>
 </info>
 <para>
  調整檔案系統大小 (不要與調整分割區或磁碟區大小混淆) 可用於將實體磁碟區上的空間變為可用狀態，或使用實體磁碟區上其他可用的空間。
 </para>
 <sect1 xml:id="sec-resize-fs-usecases">
  <title>使用案例</title>

  <para>
   強烈建議您使用 YaST 磁碟分割程式來調整分割區或邏輯磁碟區的大小。如此，檔案系統將自動調整為分割區或磁碟區的新大小。不過，在某些情況下，您需要手動調整檔案系統的大小，因為 YaST 不支援它們：
  </para>

  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>
     調整虛擬機器客體的虛擬磁碟大小之後。
    </para>
   </listitem>
   <listitem>
    <para>
     調整網路附加儲存中的磁碟區大小之後。
    </para>
   </listitem>
   <listitem>
    <para>
     手動調整分割區 (例如透過使用 <command>fdisk</command> 或 <command>parted</command>) 或邏輯磁碟區 (例如透過使用 <command>lvresize</command>) 的大小之後。
    </para>
   </listitem>
   <listitem>
    <para>
     要縮小 Btrfs 檔案系統的大小時 (從 <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> 12 開始，YaST 僅支援增大 Btrfs 檔案系統)。
    </para>
   </listitem>
  </itemizedlist>
 </sect1>
 <sect1 xml:id="sec-resize-fs-guidelines">
  <title>調整大小準則</title>

  <para>
   調整任何檔案系統的大小都存在一定的風險，可能會造成資料遺失。
  </para>

  <warning>
   <title>備份資料</title>
   <para>
    若要避免資料遺失，在開始執行調整大小任務之前，請務必備份資料。
   </para>
  </warning>

  <para>
   計劃調整檔案系統大小時，請考慮以下準則。
  </para>

  <sect2 xml:id="sec-resize-fs-guidelines-support">
   <title>支援調整大小的檔案系統</title>
   <para>
    檔案系統必須支援調整大小才能利用為磁碟區增加的可用空間。<phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> 中提供了可用於檔案系統 Ext2、Ext3 和 Ext4 的檔案系統調整大小公用程式。該公用程式支援增加和減少大小，如下所述：
   </para>
   <table>
    <title>檔案系統調整大小支援</title>
    <tgroup cols="4">
     <colspec colnum="1" colname="1" colwidth="2500*"/>
     <colspec colnum="2" colname="2" colwidth="2500*"/>
     <colspec colnum="3" colname="3" colwidth="2500*"/>
     <colspec colnum="4" colname="4" colwidth="2500*"/>
     <thead>
      <row>
       <entry>
        <para>
         檔案系統
        </para>
       </entry>
       <entry>
        <para>
         公用程式
        </para>
       </entry>
       <entry>
        <para>
         增加大小 (增大)
        </para>
       </entry>
       <entry>
        <para>
         減少大小 (縮減)
        </para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row>
       <entry>
        <para>
         Btrfs
        </para>
       </entry>
       <entry>
        <para>
         <command>btrfs filesystem resize</command>
        </para>
       </entry>
       <entry>
        <para>
         線上
        </para>
       </entry>
       <entry>
        <para>
         線上
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         XFS
        </para>
       </entry>
       <entry>
        <para>
         <command>xfs_growfs</command>
        </para>
       </entry>
       <entry>
        <para>
         線上
        </para>
       </entry>
       <entry>
        <para>
         不支援
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         Ext2
        </para>
       </entry>
       <entry>
        <para>
         <command>resize2fs</command>
        </para>
       </entry>
       <entry>
        <para>
         線上或離線
        </para>
       </entry>
       <entry>
        <para>
         僅限離線
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         Ext3
        </para>
       </entry>
       <entry>
        <para>
         <command>resize2fs</command>
        </para>
       </entry>
       <entry>
        <para>
         線上或離線
        </para>
       </entry>
       <entry>
        <para>
         僅限離線
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         Ext4
        </para>
       </entry>
       <entry>
        <para>
         <command>resize2fs</command>
        </para>
       </entry>
       <entry>
        <para>
         線上或離線
        </para>
       </entry>
       <entry>
        <para>
         僅限離線
        </para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </table>
  </sect2>

  <sect2 xml:id="sec-resize-fs-guidelines-increase">
   <title>增加檔案系統的大小</title>
   <para>
    您可以將檔案系統增大到裝置的最大可用空間，或指定一個精確值。請務必先增大裝置或邏輯磁碟區的大小，然後再嘗試增大檔案系統大小。
   </para>
   <para>
    為檔案系統指定精確大小時，請確保新大小符合以下條件：
   </para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>
      新大小必須大於現有資料的大小；否則資料會遺失。
     </para>
    </listitem>
    <listitem>
     <para>
      新的大小不得超過目前裝置的大小，因為檔案系統大小不能超過可用空間大小。
     </para>
    </listitem>
   </itemizedlist>
  </sect2>

  <sect2 xml:id="sec-resize-fs-guidelines-decrease">
   <title>減小檔案系統的大小</title>
   <para>
    當要減少裝置上檔案系統的大小時，請確定新大小滿足下列條件：
   </para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>
      新大小必須大於現有資料的大小；否則資料會遺失。
     </para>
    </listitem>
    <listitem>
     <para>
      新的大小不得超過目前裝置的大小，因為檔案系統大小不能超過可用空間大小。
     </para>
    </listitem>
   </itemizedlist>
   <para>
    如果另外還想減少代管檔案系統之邏輯磁碟區的大小，請先減少檔案系統的大小，然後再嘗試減少裝置或邏輯磁碟區的大小。
   </para>
   <important>
    <title>XFS</title>
    <para>
     XFS 格式檔案系統的大小無法減少，因為 XFS 不支援此功能。
    </para>
   </important>
  </sect2>
 </sect1>
 <sect1 xml:id="sec-resize-fs-btrfs">
  <title>變更 Btrfs 檔案系統的大小</title>

  <para>
   掛接 Btrfs 檔案系統後，您可以使用 <command>btrfs filesystem resize</command> 指令來變更該檔案系統的大小。掛接了檔案系統時，增加和減少大小均受支援。
  </para>

  <procedure>
   <step>
    <para>
     開啟終端機主控台。
    </para>
   </step>
   <step>
    <para>
     確定您要變更的檔案系統已掛接。
    </para>
   </step>
   <step>
    <para>
     使用 <command>btrfs filesystem resize</command> 指令透過下列其中一種方法變更檔案系統的大小：
    </para>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <para>
       若要將檔案系統的大小擴充至裝置的最大可用大小，請輸入
      </para>
<screen><prompt>&gt; </prompt><command>sudo</command> btrfs filesystem resize max /mnt</screen>
     </listitem>
     <listitem>
      <para>
       若要將檔案系統擴充至指定大小，請輸入
      </para>
<screen><prompt>&gt; </prompt><command>sudo</command> btrfs filesystem resize <replaceable>SIZE</replaceable> /mnt</screen>
      <para>
       以所需大小 (以位元組計) 取代 <replaceable>SIZE</replaceable>。您也可以指定值的單位，例如 50000K (KB)、250M (MB) 或 2G (GB)。您也可以在值前面加上加號 (<literal>+</literal>) 或減號 (<literal>-</literal>)，分別指定增加或減少至目前的大小：
      </para>
<screen><prompt>&gt; </prompt><command>sudo</command> btrfs filesystem resize +<replaceable>SIZE</replaceable> /mnt
sudo btrfs filesystem resize -<replaceable>SIZE</replaceable> /mnt</screen>
     </listitem>
    </itemizedlist>
   </step>
   <step>
    <para>
     請輸入以下指令，以檢查在已掛接檔案系統上調整大小的效果：
    </para>
<screen><prompt>&gt; </prompt>df -h</screen>
    <para>
     可用磁碟空間 (<command>df</command>) 指令可顯示磁碟的總大小、使用的區塊數以及檔案系統上可用的區塊數。-h 選項會以可辨識的格式列印大小，如 1K、234M 或 2G。
    </para>
   </step>
  </procedure>
 </sect1>
 <sect1 xml:id="sec-resize-fs-xfs">
  <title>變更 XFS 檔案系統的大小</title>

  <para>
   掛接 XFS 檔案系統後，您可以使用 <command>xfs_growfs</command> 指令來增加該檔案系統的大小。XFS 檔案系統的大小無法減少。
  </para>

  <procedure>
   <step>
    <para>
     開啟終端機主控台。
    </para>
   </step>
   <step>
    <para>
     確定您要變更的檔案系統已掛接。
    </para>
   </step>
   <step>
    <para>
     使用 <command>xfs_growfs</command> 指令增加檔案系統的大小。下面的範例會將檔案系統的大小擴充為適用的最大值。請參閱 <command>man 8 xfs_growfs</command> 瞭解更多選項。
    </para>
<screen><prompt>&gt; </prompt><command>sudo</command> xfs_growfs -d /mnt</screen>
   </step>
   <step>
    <para>
     請輸入以下指令，以檢查在已掛接檔案系統上調整大小的效果：
    </para>
<screen><prompt>&gt; </prompt>df -h</screen>
    <para>
     可用磁碟空間 (<command>df</command>) 指令可顯示磁碟的總大小、使用的區塊數以及檔案系統上可用的區塊數。-h 選項會以可辨識的格式列印大小，如 1K、234M 或 2G。
    </para>
   </step>
  </procedure>
 </sect1>
 <sect1 xml:id="sec-resize-fs-ext">
  <title>變更 ext2、ext3 或 ext4 檔案系統的大小</title>

  <para>
   不論是否掛接了相應的分割區，都可以使用 <command>resize2fs</command> 指令來增大 Ext2、Ext3 和 Ext4 檔案系統的大小。若要減少 Ext 檔案系統的大小，需要將其卸載。
  </para>

  <procedure>
   <step>
    <para>
     開啟終端機主控台。
    </para>
   </step>
   <step>
    <para>
     如果應減小檔案系統的大小，請將它卸載。
    </para>
   </step>
   <step>
    <para>
     使用下列方法之一變更檔案系統的大小：
    </para>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <para>
       若要將檔案系統的大小擴充至名為 <filename>/dev/sda1</filename> 之裝置的最大可用大小，請輸入
      </para>
<screen><prompt>&gt; </prompt><command>sudo</command> resize2fs /dev/sda1</screen>
      <para>
       如果未指定大小參數，則預設大小為分割區的大小。
      </para>
     </listitem>
     <listitem>
      <para>
       若要將檔案系統變更為特定大小，請輸入
      </para>
<screen><prompt>&gt; </prompt><command>sudo</command> resize2fs /dev/sda1 <replaceable>SIZE</replaceable></screen>
      <para>
       <replaceable>SIZE</replaceable> 參數指定為檔案系統要求的新大小。如果未指定單位，則大小參數的單位即為檔案系統的區塊大小。也可以選擇在大小參數後面加上下列其中一種單位指示項：<literal>s</literal> 表示 512 位元組磁區；<literal>K</literal> 表示 KB (1 KB 為 1024 位元組)；<literal>M</literal> 表示 MB；<literal>G</literal> 表示 GB。
      </para>
     </listitem>
    </itemizedlist>
    <para>
     請等候直至完成大小調整，然後再繼續。
    </para>
   </step>
   <step>
    <para>
     如果未掛接檔案系統，請立即掛接。
    </para>
   </step>
   <step>
    <para>
     請輸入以下指令，以檢查在已掛接檔案系統上調整大小的效果：
    </para>
<screen><prompt>&gt; </prompt>df -h </screen>
    <para>
     可用磁碟空間 (<command>df</command>) 指令可顯示磁碟的總大小、使用的區塊數以及檔案系統上可用的區塊數。-h 選項會以可辨識的格式列印大小，如 1K、234M 或 2G。
    </para>
   </step>
  </procedure>
 </sect1>
</chapter>
