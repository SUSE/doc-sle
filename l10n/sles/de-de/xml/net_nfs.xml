<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="net_nfs.xml" version="5.0" xml:id="cha-nfs">
 <title>Verteilte Nutzung von Dateisystemen mit NFS</title>
 <info>
  <abstract>
   <para>
    Das <emphasis>NFS</emphasis>-Protokoll (<emphasis>Network File System</emphasis>) sorgt für den Zugriff auf Dateien auf einem Server, der ähnlich wie der Zugriff auf lokale Dateien erfolgt.
   </para>
  </abstract>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:bugtracker/>
   <dm:translation>Ja</dm:translation>
  </dm:docmanager>
 </info>

 <sect1 xml:id="sec-nfs-overview">
  <title>Überblick</title>
  <para>
   Über das standardisierte, erprobte und weithin unterstützte NFS-Netzwerkprotokoll (<emphasis>Network File System</emphasis>) können Dateien durch separate Hosts gemeinsam genutzt werden.
  </para>
  <para>
   Über den NIS (<emphasis>Network Information Service</emphasis>) lässt sich eine zentrale Benutzerverwaltung im Netzwerk einrichten. Die Kombination aus NFS und NIS sorgt für die Zugriffskontrolle im Netzwerk anhand von Datei- und Verzeichnisrechten. NFS mit NIS macht ein Netzwerk für den Benutzer transparent.
  </para>
  <para>
   In der Standardkonfiguration vertraut NFS dem Netzwerk uneingeschränkt – und damit auch jedem Computer, der mit einem vertrauenswürdigen Netzwerk verbunden ist. Alle Benutzer mit Administratorrechen auf einem Computer mit physischem Zugriff auf ein Netzwerk, dem der NFS-Server vertraut, können auf sämtliche Dateien zugreifen, die der Server zur Verfügung stellt.
  </para>
  <para>
   Diese Sicherheitsstufe reicht oft aus, beispielsweise wenn das vertrauenswürdige Netzwerk tatsächlich vollständig privat ist, das Netzwerk sich in einem einzigen Schrank oder Computerraum befindet und kein unbefugter Zugriff möglich ist. In anderen Fällen ist die Notwendigkeit, einem ganzen Teilnetz als einer einzigen Einheit zu vertrauen, dagegen restriktiv und es besteht Bedarf an einem feiner abgestuften Vertrauensverhältnis. Für diese Fälle unterstützt NFS verschiedene Sicherheitsstufen mithilfe der <emphasis>Kerberos</emphasis>Infrastruktur. Für Kerberos ist NFSv4 erforderlich, wobei diese Version standardmäßig verwendet wird. Weitere Informationen finden Sie im <xref linkend="cha-security-kerberos"/>.
  </para>

  <para>
   Die folgenden Begriffe werden im YaST-Modul verwendet.
  </para>

  <variablelist>
   <varlistentry>
    <term>Exporte</term>
    <listitem>
     <para>
      Ein von einem NFS-Server <emphasis>exportiertes</emphasis> Verzeichnis, das von Clients in ihr System integriert werden kann.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>NFS-Client</term>
    <listitem>
     <para>
      Der NFS-Client ist ein System, das NFS-Dienste eines NFS-Servers über das NFS-Protokoll verwendet. Das TCP/IP-Protokoll ist bereits in den Linux-Kernel integriert, weshalb keine zusätzliche Software installiert werden muss.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>NFS-Server</term>
    <listitem>
     <para>
      Der NFS-Server stellt NFS-Dienste für Clients bereit. Ein laufender Server ist von den folgenden Daemons abhängig: <systemitem class="daemon">nfsd</systemitem> (Worker), <systemitem class="daemon">idmapd</systemitem> (ID-Name-Zuordnung für NFSv4, nur für bestimmte Szenarien), <systemitem class="daemon">statd</systemitem> (Dateisperren) und <systemitem class="daemon">mountd</systemitem> (Einhängeanforderungen).
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>NFSv3</term>
    <listitem>
     <para>
      NFSv3 ist die Implementierungsversion 3, die <quote>alte</quote> zustandslose NFS, die die Clientauthentifizierung unterstützt.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>NFSv4</term>
    <listitem>
     <para>
      NFSv4 ist die neue Implementationsversion 4, die die sichere Benutzerauthentifizierung über Kerberos unterstützt. Für NFSv4 ist nur ein einzelner Port erforderlich; diese Version eignet sich daher besser für Umgebungen hinter einer Firewall als NFSv3.
     </para>
     <para>
      Das Protokoll wird als <link xlink:href="https://datatracker.ietf.org/doc/html/rfc3530/"/> angegeben.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>pNFS</term>
    <listitem>
     <para>
      Parallel NFS, eine Protokollerweiterung für NFSv4. Alle pNFS-Clients können direkt auf die Daten auf einem NFS-Server zugreifen.
     </para>
    </listitem>
   </varlistentry>
  </variablelist>
  <important os="sles;osuse">
   <title>DNS-Bedarf</title>
   <para>
    Im Prinzip können alle Exporte allein mit IP-Adressen vorgenommen werden. Es ist ratsam, über ein funktionierendes DNS-System zu verfügen, um Zeitüberschreitungen zu vermeiden. DNS ist zumindest für die Protokollierung erforderlich, weil der mountd-Daemon Reverse-Lookups ausführt.
   </para>
  </important>
 </sect1>

 

 <sect1 os="sles;osuse" xml:id="sec-nfs-installation">
  <title>Installieren des NFS-Servers</title>

  <para>
   Der NFS-Server ist kein Bestandteil der Standardinstallation. Zum Installieren des NFS-Servers mit YaST wählen Sie <menuchoice> <guimenu>Software</guimenu>
   <guimenu>Software installieren oder löschen</guimenu></menuchoice>, wählen Sie <guimenu>Schemata</guimenu> und aktivieren Sie die Option <guimenu>Dateiserver</guimenu> im Abschnitt <guimenu>Serverfunktionen</guimenu>. Klicken Sie auf <guimenu>Übernehmen</guimenu>. Die erforderlichen Pakete werden installiert.
  </para>
  <para>
   Wie NIS ist NFS ein Client-Server-System. Ein Rechner kann jedoch beides gleichzeitig sein – er kann Dateisysteme im Netzwerk zur Verfügung stellen (exportieren) und Dateisysteme anderer Hosts mounten (importieren).
  </para>

  <note>

   <title>Lokales Einhängen von NFS-Volumes auf dem exportierenden Server</title>
   <para>
    Das lokale Einhängen von NFS-Volumes auf dem exportierenden Server wird in <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> nicht unterstützt.
   </para>
  </note>
 </sect1>
 <sect1 xml:id="sec-nfs-configuring-nfs-server" os="sles;osuse">
  <title>Konfigurieren des NFS-Servers</title>

  <para>
   Die Konfiguration eines NFS-Servers kann über YaST oder manuell erfolgen. NFS kann für die Authentifizierung auch mit Kerberos kombiniert werden.
  </para>

  <sect2 xml:id="sec-nfs-export-yast2">
   <title>Exportieren von Dateisystemen mit YaST</title>
   <para>
    Mit YaST können Sie einen Computer im Netzwerk als NFS-Server bereitstellen. Dies ist ein Server, der Verzeichnisse und Dateien an alle Hosts, die ihm Zugriff gewähren, oder an alle Mitglieder einer Gruppe exportiert. Der Server kann so außerdem Anwendungen bereitstellen, ohne dass die Anwendungen auf allen Hosts lokal installiert sein müssen.
   </para>
   <para>
    Verfahren Sie wie folgt, um einen solchen Server einzurichten:
   </para>
   <procedure xml:id="pro-nfs-export-yast2-nfs">
    <title>Einrichten eines NFS-Servers</title>
    <step>
     <para>
      Starten Sie YaST, und wählen Sie <menuchoice> <guimenu>Netzwerkdienste</guimenu>
      <guimenu>NFS-Server</guimenu> </menuchoice>  (siehe <xref linkend="fig-inst-nfsserver1"/>). Sie werden ggf. aufgefordert, weitere Software zu installieren.
     </para>

     <figure xml:id="fig-inst-nfsserver1">
      <title>Konfiguration des NFS-Servers</title>
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="yast2_inst_nfsserver1.png" width="75%" format="PNG" os="sles;sled"/>
        
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="yast2_inst_nfsserver1.png" width="75%" format="PNG" os="sles;sled"/>
        
       </imageobject>
      </mediaobject>
     </figure>

    </step>
    <step>
     <para>
      Aktivieren Sie das Optionsfeld <guimenu>Start</guimenu>.
     </para>
    </step>
    <step>
     <para>
      Wenn eine Firewall im System aktiv ist (SuSEfirewall2), aktivieren Sie die Option <guimenu>Firewall-Ports öffnen</guimenu>. YaST aktiviert den <systemitem class="service">nfs</systemitem>-Service und passt so die Konfiguration für den NFS-Server an.
     </para>
    </step>
    <step>
     <para>
      Überlegen Sie, ob die Verwendung der Option <guimenu>NFSv4 aktivieren</guimenu> angebracht ist. Wenn Sie NFSv4 deaktivieren, unterstützt YaST lediglich NFSv3. Informationen zum Aktivieren von NFSv2 finden Sie in <xref linkend="sec-nfs-export-manual-nsfv2"/>.
     </para>
     <substeps performance="required">
      <step>
       <para>
        Ist NFSv4 aktiviert, geben Sie außerdem den entsprechenden NFSv4-Domänennamen ein. Dieser Parameter gilt für den <systemitem class="daemon">idmapd</systemitem>-Daemon, der für Kerberos-Einrichtungen oder für Fälle, in denen die Clients nicht mit numerischen Benutzernamen arbeiten können, erforderlich ist. Behalten Sie den Wert <literal>localdomain</literal> (den Standardwert) bei, wenn Sie <systemitem class="daemon">idmapd</systemitem> nicht ausführen oder keine speziellen Anforderungen haben. Weitere Informationen zum <systemitem class="daemon">idmapd</systemitem>-Daemon finden Sie unter <xref linkend="var-nfs-export-manual-idmapd"/>.
       </para>
      </step>
     </substeps>
    </step>
    <step>
     <para>
      Klicken Sie auf <guimenu>GSS-Sicherheit aktivieren</guimenu>, wenn Sie einen sicheren Zugriff auf den Server benötigen. Als Voraussetzung hierfür muss Kerberos in der Domäne installiert sein und sowohl der Server als auch der Client müssen kerberisiert sein. <remark>emap 2011-0824: A reference to a Kerberos chapter
      would be good.</remark> Mit <guimenu>Weiter</guimenu> wechseln Sie zum nächsten Konfigurationsdialogfeld.
     </para>
    </step>
    <step>
     <para>
      Klicken Sie im oberen Bereich des Dialogfelds auf <guimenu>Verzeichnis hinzufügen</guimenu>. Das Verzeichnis wird exportiert.
     </para>
    </step>
    <step>
     <para>
      Falls Sie die zulässigen Hosts nicht bereits konfiguriert haben, wird automatisch ein weiteres Dialogfeld geöffnet, in dem Sie die Client-Informationen und Optionen angeben. Geben Sie den Platzhalter für den Host ein. (In der Regel können Sie die Standardeinstellungen beibehalten).
     </para>

     <para>
      Es gibt vier mögliche Typen von Platzhalterzeichen für den Host, die für jeden Host festgelegt werden können: ein einzelner Host (Name oder IP-Adresse), Netzgruppen, Platzhalterzeichen (wie <literal>*</literal>, womit angegeben wird, dass alle Computer auf den Server zugreifen können) und IP-Netzwerke.
     </para>
     <para>
      Weitere Informationen zu diesen Optionen finden Sie auf der man-Seite zu <literal>exports</literal>.
     </para>
    </step>
    <step>
     <para>
      Klicken Sie zum Beenden der Konfiguration auf <guimenu>Beenden</guimenu>.
     </para>
    </step>
   </procedure>
  </sect2>



  <sect2 xml:id="sec-nfs-export-manual" os="sles;osuse">
   <title>Manuelles Exportieren von Dateisystemen</title>
   <para>
    Die Konfigurationsdateien für den NFS-Exportdienst lauten <filename>/etc/exports</filename> und <filename>/etc/sysconfig/nfs</filename>. Neben diesen Dateien ist <filename>/etc/idmapd.conf</filename> für die NFSv4-Serverkonfiguration mit kerberisiertem NFS oder für Fälle, in denen die Clients keine numerischen Benutzernamen verarbeiten können, erforderlich.
   </para>
   <para>
    Führen Sie den Start bzw. Neustart der Dienste mit dem Befehl <command>systemctl restart nfsserver.service</command> aus. Hiermit wird auch der RPC-Portmapper neu gestartet, der vom NFS-Server benötigt wird.
   </para>
   <para>
    Damit der NFS-Server bei jedem Booten gestartet wird, führen Sie <command>sudo systemctl enable nfsserver</command> aus.
   </para>
   <note>
    <title>NFSv4</title>
    <para>
     NFSv4 ist die aktuelle Version des NFS-Protokolls für <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase>. Die Verzeichnisse werden nunmehr in NFSv4 auf dieselbe Weise für das Exportieren vorbereitet wie in NFSv3.
    </para>
    <para>
     In <phrase os="sles;sled">SUSE Linux Enterprise Server 11</phrase> war das Einhängen mit Einbindung in <filename>/etc/exports</filename> obligatorisch. Dies wird weiterhin unterstützt, ist jedoch überholt.
    </para>
   </note>
   <variablelist>
    <varlistentry>
     <term><filename>/etc/exports</filename></term>
     <listitem>
      <para>
       Die Datei <filename>/etc/exports</filename> enthält eine Liste mit Einträgen. Mit jedem Eintrag wird ein Verzeichnis angegeben, das freigegeben wird. Zudem wird angegeben, wie das Verzeichnis freigegeben wird. Ein typischer Eintrag in <filename>/etc/exports</filename> besteht aus:
      </para>
<screen>/<replaceable>SHARED</replaceable>/<replaceable>DIRECTORY</replaceable>   <replaceable>HOST</replaceable>(<replaceable>OPTION_LIST</replaceable>)</screen>
      <para>
       Beispiel:
      </para>
<screen>/export/data   192.168.1.2(rw,sync)</screen>
      <para>
       Hier wird die IP-Adresse <literal>192.168.1.2</literal> verwendet, um den erlaubten Client zu identifizieren. Sie können auch den Namen des Hosts, ein Platzhalterzeichen, mit dem mehrere Hosts angegeben werden (<literal>*.abc.com</literal>, <literal>*</literal> usw.) oder Netzwerkgruppen (<literal>@my-hosts</literal>) verwenden).
      </para>
      <para>
       Eine detaillierte Erläuterung aller Optionen und der entsprechenden Bedeutungen finden Sie auf der man-Seite zu <filename>/etc/exports</filename> (<command>man exports</command>).
      </para>
      <para>
       Falls Sie <filename>/etc/exports</filename> bei laufendem NFS-Server geändert haben, müssen Sie den Server neu starten, damit die Änderungen in Kraft treten: <command>sudo systemctl restart nfsserver</command>.
      </para>

     </listitem>
    </varlistentry>
    <varlistentry>
     <term><filename>/etc/sysconfig/nfs</filename></term>
     <listitem>
      <para>
       Die Datei <filename>/etc/sysconfig/nfs</filename> enthält einige Parameter, die das Verhalten des NFSv4-Server-Daemon bestimmen. Der Parameter <systemitem>NFS4_SUPPORT</systemitem> muss dabei auf <literal>yes</literal> (Standard) gesetzt werden. Der Parameter <systemitem>NFS4_SUPPORT</systemitem> bestimmt, ob der NFS-Server NFSv4-Exporte und -Clients unterstützt.
      </para>
      <para>
       Falls Sie <filename>/etc/sysconfig/nfs</filename> bei laufendem NFS-Server geändert haben, müssen Sie den Server neu starten, damit die Änderungen in Kraft treten: <command>sudo systemctl restart nfsserver</command>.
      </para>
      <tip>
       <title>Einhängeoptionen</title>
       <para>
        In <phrase os="sles;sled">SUSE Linux Enterprise Server 11</phrase> war das Einhängen mit <option>--bind</option> in <filename>/etc/exports</filename> obligatorisch. Dies wird weiterhin unterstützt, ist jedoch überholt. Die Verzeichnisse werden nunmehr in NFSv4 auf dieselbe Weise für das Exportieren vorbereitet wie in NFSv3.
       </para>
      </tip>
      <note xml:id="sec-nfs-export-manual-nsfv2">

       <title>NFSv2</title>
       <para>
        Wenn NFS-Clients weiterhin von NFSv2 abhängig sind, aktivieren Sie es auf dem Server in <filename>/etc/sysconfig/nfs</filename>, indem Sie Folgendes festlegen:
       </para>
<screen>NFSD_OPTIONS="-V2"
MOUNTD_OPTIONS="-V2"</screen>
       <para>
        Überprüfen Sie nach Neustart des Diensts mit dem folgenden Kommando, ob Version 2 verfügbar ist:
       </para>
<screen><prompt>tux &gt; </prompt>cat /proc/fs/nfsd/versions
+2 +3 +4 +4.1 -4.2</screen>
      </note>
     </listitem>
    </varlistentry>
    <varlistentry xml:id="var-nfs-export-manual-idmapd">
     <term><filename>/etc/idmapd.conf</filename></term>
     <listitem>
      <para>
       Ab SLE 12 SP1 ist der <systemitem class="daemon">idmapd</systemitem>-Daemon nur dann erforderlich, wenn die Kerberos-Authentifizierung verwendet wird oder die Clients keine numerischen Benutzernamen verarbeiten können. Linux-Clients können numerische Benutzernamen seit dem Linux-Kernel 2.6.39 verarbeiten. Der <systemitem class="daemon">idmapd</systemitem>-Daemon führt die Name-ID-Zuordnung für NFSv4-Anforderungen an den Server aus und schickt Antworten an den Client.
      </para>
      <para>
       Falls <systemitem class="daemon">idmapd</systemitem> erforderlich ist, muss dieser Daemon auf dem NFSv4-Server ausgeführt werden. Die Name-ID-Zuordnung auf dem Client erfolgt mit <command>nfsidmap</command> das vom Paket bereitgestellt wird.
       <package>nfs-client</package>.
      </para>
      <para>
       Stellen Sie sicher, dass Benutzernamen und IDs (uid) Benutzern auf eine einheitliche Weise auf allen Rechnern zugewiesen werden, auf denen möglicherweise Dateisysteme mit NFS freigegeben werden. Dies kann mit NIS, LDAP oder einem beliebigen einheitlichen Domänenauthentifizierungsmechanismus in Ihrer Domäne erreicht werden.
      </para>
      <para>
       Der Parameter <literal>Domain</literal> muss in der Datei <filename>/etc/idmapd.conf</filename> für den Client und den Server identisch festgelegt sein. Wenn Sie sich nicht sicher sind, belassen Sie die Domäne in den Server- und den Clientdateien als <literal>localdomain</literal>. Eine Beispielkonfigurationsdatei sieht folgendermaßen aus:
      </para>
<screen>[General]
Verbosity = 0
Pipefs-Directory = /var/lib/nfs/rpc_pipefs
Domain = localdomain

[Mapping]
Nobody-User = nobody
Nobody-Group = nobody</screen>
      <para>
       Starten Sie den <systemitem class="daemon">idmapd</systemitem>-Daemon mit <command>systemctl start nfs-idmapd</command>. Falls Sie <filename>/etc/idmapd.conf</filename> bei laufendem Daemon geändert haben, müssen Sie den Daemon neu starten, damit die Änderungen in Kraft treten: <command>systemctl start nfs-idmapd</command>.
      </para>
      <para>
       Weitere Informationen finden Sie auf den man-Seiten zu <literal>idmapd</literal> und <literal>idmapd.conf</literal> (<literal>man idmapd</literal> und <literal>man idmapd.conf</literal>).
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
  </sect2>



  <sect2 xml:id="sec-nfs-kerberos">
   <title>NFS mit Kerberos</title>
   <para>
    Wenn die Kerberos-Authentifizierung für NFS verwendet werden soll, muss die GSS-Sicherheit (Generic Security Services) aktiviert werden. Wählen Sie im ersten YaST-NFS-Server-Dialogfeld die Option <guimenu>GSS-Sicherheit aktivieren</guimenu>. Zur Verwendung dieser Funktion muss ein funktionierender Kerberos-Server zur Verfügung stehen. YaST richtet diesen Server nicht ein, sondern nutzt lediglich die über den Server bereitgestellten Funktionen. Soll die Authentifizierung mittels Kerberos verwendet werden, müssen Sie zusätzlich zur YaST-Konfiguration mindestens die nachfolgend beschriebenen Schritte ausführen, bevor Sie die NFS-Konfiguration ausführen:
   </para>
   <procedure>
    <step>
     <para>
      Stellen Sie sicher, dass sich Server und Client in derselben Kerberos-Domäne befinden. Beide müssen auf denselben KDC-Server (Key Distribution Center) zugreifen und die Datei <filename>krb5.keytab</filename> gemeinsam verwenden (der Standardspeicherort auf allen Rechnern lautet <filename>/etc/krb5.keytab</filename>). Weitere Informationen zu Kerberos finden Sie unter <xref linkend="cha-security-kerberos"/>.
     </para>
    </step>
    <step>
     <para>
      Starten Sie den gssd-Dienst auf dem Client mit <command>systemctl start rpc-gssd.service</command>.
     </para>
    </step>
    <step os="sles;osuse">
     <para>
      Starten Sie den svcgssd-Dienst auf dem Server mit <command>systemctl start rpc-svcgssd.service</command>.
     </para>
    </step>
   </procedure>
   <para>
    Bei der Kerberos-Authentifizierung muss der <systemitem class="daemon">idmapd</systemitem>-Daemon ebenfalls auf dem Server ausgeführt werden. Weitere Informationen finden Sie unter <xref linkend="var-nfs-export-manual-idmapd"/>.
   </para>
   <para>
    Weitere Informationen zum Konfigurieren eines kerberisierten NFS finden Sie über die Links in <xref linkend="sec-nfs-info" xrefstyle="SectTitleOnPage"/>.
   </para>
  </sect2>
 </sect1>
 <sect1 xml:id="sec-nfs-configuring-nfs-clients">
  <title>Konfigurieren der Clients</title>

  <para>
   Wenn Sie Ihren Host als NFS-Client konfigurieren möchten, müssen Sie keine zusätzliche Software installieren. Alle erforderlichen Pakete werden standardmäßig installiert.
  </para>

  <sect2 xml:id="sec-nfs-import-yast2">
   <title>Importieren von Dateisystemen mit YaST</title>
   <para>
    Autorisierte Benutzer können NFS-Verzeichnisse eines NFS-Servers über das YaST-NFS-Clientmodul in den lokalen Dateibaum einhängen. Führen Sie dazu die folgenden Schritte aus:
   </para>
   <procedure xml:id="pro-nfs-import-yast2">
    <title>Importieren von NFS-Verzeichnissen</title>
    <step>
     <para>
      Starten Sie das YaST-NFS-Client-Modul.
     </para>
    </step>

    <step>
     <para>
      Klicken Sie auf dem Karteireiter <guimenu>NFS-Freigaben</guimenu> auf <guimenu>Hinzufügen</guimenu>. Geben Sie den Hostnamen des NFS-Servers, das zu importierende Verzeichnis und den Einhängepunkt an, an dem das Verzeichnis lokal eingehängt werden soll.
     </para>
    </step>


    <step>
     <para>
      Wenn Sie NFSv4 verwenden, wählen Sie die Option <guimenu>NFSv4 aktivieren</guimenu> auf der Registerkarte <guimenu>Einstellungen</guimenu>. Der <guimenu>NFSv4-Domainname</guimenu> muss zudem denselben Wert aufweisen, der beim NFSv4-Server verwendet wird. Die Standarddomäne ist <literal>localdomain</literal>.
     </para>
    </step>
    <step>
     <para>
      Wenn die Kerberos-Authentifizierung für NFS verwendet werden soll, muss die GSS-Sicherheit aktiviert werden. Wählen Sie <guimenu>GSS-Sicherheit aktivieren</guimenu>.
     </para>
    </step>
    <step>
     <para>
      Wenn Sie eine Firewall nutzen und den Zugriff auf den Dienst von Ferncomputern aus zulassen möchten, aktivieren Sie auf dem Karteireiter <guimenu>NFS-Einstellungen</guimenu> die Option <guimenu>Firewall-Port öffnen</guimenu>. Der Status der Firewall wird neben dem Kontrollkästchen angezeigt.
     </para>
    </step>

    <step>
     <para>
      Klicken Sie zum Speichern der Änderungen auf <guimenu>OK</guimenu>.
     </para>
    </step>
   </procedure>
   <para>
    Die Konfiguration wird in <filename>/etc/fstab</filename> geschrieben und die angegebenen Dateisysteme werden eingehängt. Wenn Sie den YaST-Konfigurationsclient zu einem späteren Zeitpunkt starten, wird auch die vorhandene Konfiguration aus dieser Datei gelesen.
   </para>
   <tip>
    <title>NFS als Root-Dateisystem</title>
    <para>
     Auf (festplattenlosen) Systemen, in denen die Stammpartition über das Netzwerk als NFS-Freigabe eingehängt ist, müssen Sie beim Konfigurieren des Netzwerkgeräts, über das die NFS-Freigabe erreichbar ist, besonders vorsichtig vorgehen.
    </para>
    <para>
     Wenn Sie das System herunterfahren oder neu booten, werden in der standardmäßigen Reihenfolge zunächst die Netzwerkverbindungen deaktiviert und anschließend die Stammpartition ausgehängt. Bei einem NFS-Root kann dies zu Problemen führen: Die Stammpartition kann nicht fehlerfrei ausgehängt werden, da die Netzwerkverbindung zur NFS-Freigabe schon nicht mehr aktiviert ist. Damit das System nicht das relevante Netzwerkgerät deaktiviert, öffnen Sie die Registerkarte gemäß <xref linkend="sec-network-yast-change-start"/> und wählen Sie unter <guimenu>Geräteaktivierung</guimenu> die Option <guimenu>Bei NFSroot</guimenu>.
    </para>
   </tip>

  </sect2>

  <sect2 xml:id="sec-nfs-import">
   <title>Manuelles Importieren von Dateisystemen</title>


   <para>
    Voraussetzung für den manuellen Import eines Dateisystems von einem NFS-Server ist ein aktiver RPC-Port-Mapper. Der Start des <option>nfs</option>-Dienstes erfordert einige Vorsicht; starten Sie ihn daher mit <command>systemctl start nfs</command> als <systemitem class="username">root</systemitem>. Danach können ferne Dateisysteme mit <command>mount</command> wie lokale Partitionen in das Dateisystem eingehängt werden:
   </para>
<screen><prompt>tux &gt; </prompt><command>sudo</command> mount <replaceable>HOST</replaceable>:<replaceable>REMOTE-PATH</replaceable><replaceable>LOCAL-PATH</replaceable></screen>
   <para>
    Geben Sie zum Beispiel zum Import von Benutzerverzeichnissen vom <systemitem>nfs.example.com</systemitem>-Rechner folgendes Kommando ein:
   </para>
<screen><prompt>tux &gt; </prompt><command>sudo</command> mount nfs.example.com:/home /home</screen>
   <sect3 xml:id="sec-nfs-automount">
    <title>Verwenden des Diensts zum automatischen Einhängen</title>
    <para>
     Ferne Dateisysteme können mit dem autofs-Daemon automatisch eingehängt werden. Fügen Sie den folgenden Eintrag in der Datei <filename>/etc/auto.master</filename> hinzu:
    </para>
<screen>/nfsmounts /etc/auto.nfs</screen>
    <para>
     Nun fungiert das Verzeichnis <filename>/nfsmounts</filename> als Root-Verzeichnis für alle NFS-Einhängungen auf dem Client, sofern die Datei <filename>auto.nfs</filename> entsprechend ausgefüllt wurde. Der Name <filename>auto.nfs</filename> wurde nur der Einfachheit halber ausgewählt – Sie können einen beliebigen Namen auswählen. Fügen Sie der Datei <filename>auto.nfs</filename> wie folgt Einträge für alle NFS-Einhängungen hinzu:
    </para>
<screen>localdata -fstype=nfs server1:/data
nfs4mount -fstype=nfs4 server2:/</screen>
    <para>
     Aktivieren Sie die Einstellungen mit <command>systemctl start autofs</command> als <systemitem class="username">root</systemitem>. In diesem Beispiel wird <filename>/nfsmounts/localdata</filename>, das Verzeichnis <filename>/data</filename> von <systemitem>server1</systemitem>, mit NFS eingehängt und <filename>/nfsmounts/nfs4mount</filename> von <systemitem>server2</systemitem> wird mit NFSv4 eingehängt. 
    </para>
    <para>
     Wenn die Datei <filename>/etc/auto.master</filename> während der Ausführung des autofs-Diensts bearbeitet wird, muss die automatische Einhängung mit <command>systemctl restart autofs</command> erneut gestartet werden, damit die Änderungen wirksam werden.
    </para>
   </sect3>
   <sect3 xml:id="sec-nfs-fstab">
    <title>Manuelles Bearbeiten von <filename>/ect/fstab</filename></title>
    <para>
     Ein typischer NFSv3-Einhängeeintrag in <filename>/etc/fstab</filename> sieht folgendermaßen aus:
    </para>
<screen>nfs.example.com:/data /local/path nfs rw,noauto 0 0</screen>
    <para>
     Bei NFSv4-Einhängepunkten geben Sie <literal>nfs4</literal> statt <literal>nfs</literal> in die dritte Spalte ein:
    </para>
<screen>nfs.example.com:/data /local/pathv4 nfs4 rw,noauto 0 0</screen>
    <para>
     Mit der Option <literal>noauto</literal> wird verhindert, dass das Dateisystem beim Starten automatisch eingehängt wird. Wenn Sie das jeweilige Dateisystem manuell einhängen möchten, können Sie das Einhängekommando auch kürzen, indem Sie nur den Einhängepunkt angeben:
    </para>
<screen><prompt>tux &gt; </prompt><command>sudo</command> mount /local/path</screen>
    <note>
     <title>Einhängen beim Starten</title>
     <para>
      Wenn die Option <literal>noauto</literal> nicht angegeben ist, wird das Einhängen dieser Dateisysteme beim Start durch die init-Skripte des Systems geregelt.
     </para>
    </note>
   </sect3>
  </sect2>

  <sect2 xml:id="sec-nfs-pnfs">
   <title>pNFS (paralleles NFS)</title>
   <para>
    NFS wurde in den 1980er-Jahren entwickelt und gehört damit zu den ältesten Protokollen. Zum Freigeben kleinerer Dateien ist NFS völlig ausreichend. Wenn Sie dagegen große Dateien übertragen möchten oder wenn zahlreiche Clients auf die Daten zugreifen sollen, wird ein NFS-Server rasch zu einer Engstelle, die die Systemleistungen erheblich beeinträchtigt. Dies liegt daran, dass die Dateien rasch größer werden, wobei die relative Ethernet-Geschwindigkeit nicht ganz mithalten kann.
   </para>
   <para>
    Wenn Sie eine Datei von einem normalen NFS-Server anfordern, werden die Metadaten der Datei nachgeschlagen, die Daten dieser Datei werden zusammengestellt und die Datei wird schließlich über das Netzwerk an den Client übertragen. Der Leistungsengpass wird jedoch in jedem Fall ersichtlich, unabhängig davon, wie groß oder klein die Dateien sind:
   </para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>
      Bei kleinen Dateien dauert das Sammeln der Metadaten am längsten..
     </para>
    </listitem>
    <listitem>
     <para>
      Bei großen Dateien dauert das Übertragen der Daten vom Server auf den Client am längsten.
     </para>
    </listitem>
   </itemizedlist>
   <para>
    pNFS (paralleles NFS) trennt die Metadaten des Dateisystems vom Speicherort der Daten und überwindet so diese Einschränkungen. Für pNFS sind dabei zwei Arten von Servern erforderlich:
   </para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>
      Ein <emphasis>Metadaten-</emphasis> oder <emphasis>Steuerungsserver</emphasis>, der den gesamten verbleibenden Verkehr (nicht den Datenverkehr) abwickelt
     </para>
    </listitem>
    <listitem>
     <para>
      Mindestens ein <emphasis>Speicherserver</emphasis>, auf dem sich die Daten befinden
     </para>
    </listitem>
   </itemizedlist>
   <para>
    Der Metadatenserver und die Speicherserver bilden gemeinsam einen einzigen logischen NFS-Server. Wenn ein Client einen Lese- oder Schreibvorgang startet, teilt der Metadatenserver dem NFSv4-Client mit, auf welchem Speicherserver der Client auf die Dateiblöcke zugreifen soll. Der Client kann direkt auf dem Server auf die Daten zugreifen.
   </para>
   <para>
    <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> unterstützt pNFS nur auf der Clientseite.
   </para>
   <sect3 xml:id="sec-nfs-pnfs-yast">
    <title>Konfigurieren eines pNTP-Clients mit YaST</title>
    <para>
     Befolgen Sie die Anweisungen unter <xref linkend="pro-nfs-import-yast2"/>; aktivieren Sie jedoch das Kontrollkästchen <guimenu>pNFS (v4.1)</guimenu> und (optional) <guimenu>NFSv4-Freigabe</guimenu>. YaST führt alle erforderlichen Schritte aus und schreibt die erforderlichen Optionen in die Datei <filename>/etc/exports</filename>. <remark>toms 2013-02-15:
           Is that enough? Any other files for pNFS?</remark>
    </para>
   </sect3>
   <sect3 xml:id="sec-nfs-pnfs-manual">
    <title>Manuelles Konfigurieren eines pNTP-Clients</title>
    <para>
     Beginnen Sie gemäß <xref linkend="sec-nfs-import"/>. Der Großteil der Konfiguration wird durch den NFSv4-Server ausgeführt. Der einzige Unterschied für pNFS besteht darin, dass die Option <option>minorversion</option> und der Metadatenserver <replaceable>MDS_SERVER</replaceable> in das Kommando <command>mount</command> eingefügt werden:
    </para>
<screen><prompt>tux &gt; </prompt><command>sudo</command> mount -t nfs4 -o minorversion=1 <replaceable>MDS_SERVER</replaceable> <replaceable>MOUNTPOINT</replaceable></screen>
    <para>
     Als Hilfe für die Fehlersuche ändern Sie den Wert im Dateisystem <filename>/proc</filename>:
    </para>
<screen><prompt>tux &gt; </prompt><command>sudo</command> echo 32767 &gt; /proc/sys/sunrpc/nfsd_debug
<prompt>tux &gt; </prompt><command>sudo</command> echo 32767 &gt; /proc/sys/sunrpc/nfs_debug</screen>
   </sect3>
  </sect2>
 </sect1>
 <sect1 xml:id="sec-nfs-info">
  <title>Weiterführende Informationen</title>
  <para>
   Außer auf den man-Seiten zu <command>exports</command>, <command>nfs</command> und <command>mount</command> stehen Informationen zum Konfigurieren eines NFS-Servers und -Clients unter <filename>/usr/share/doc/packages/nfsidmap/README</filename> zur Verfügung. Weitere Online-Dokumentation finden Sie auf folgenden Websites:
  </para>

  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>
     Die detaillierte technische Dokumentation finden Sie online unter <link xlink:href="http://nfs.sourceforge.net/">SourceForge</link>.
    </para>
   </listitem>
   <listitem>
    <para>
     Anweisungen zum Einrichten eines kerberisierten NFS finden Sie unter <link xlink:href="http://www.citi.umich.edu/projects/nfsv4/linux/krb5-setup.html">NFS Version 4 Open Source Reference Implementation</link>.
    </para>
   </listitem>
   <listitem>
    <para>
     Falls Sie Fragen zu NFSv4 haben, lesen Sie die <link xlink:href="http://www.citi.umich.edu/projects/nfsv4/linux/faq/">Linux NFSv4-FAQ</link>.
    </para>
   </listitem>
  </itemizedlist>
 </sect1>
</chapter>
