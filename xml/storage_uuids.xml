<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE chapter PUBLIC "-//Novell//DTD NovDoc XML V1.0//EN" "novdocx.dtd" [
  <!ENTITY % NOVDOC.DEACTIVATE.IDREF "INCLUDE">
  <!ENTITY % entities SYSTEM "entity-decl.ent">
  %entities;
]>
<chapter conformance="sles11,Novell,no,0,80" id="uuid" lang="en" revision="03/15/10">
  <title>Using UUIDs to Mount Devices</title>
  <para>
   This section describes the optional use of UUIDs instead of device names
   to identify file system devices in the boot loader file and the
   <filename>/etc/fstab</filename> file.
  </para>
  <itemizedlist role="subtoc">
   <listitem>
    <para>
     <xref linkend="udev" xrefstyle="SectTitleOnPage"/>
    </para>
   </listitem>
   <listitem>
    <para>
     <xref linkend="understanduuid" xrefstyle="SectTitleOnPage"/>
    </para>
   </listitem>
   <listitem>
    <para>
     <xref linkend="uuidbootx86" xrefstyle="SectTitleOnPage"/>
    </para>
   </listitem>
   <listitem>
    <para>
     <xref linkend="uuidbootia64" xrefstyle="SectTitleOnPage"/>
    </para>
   </listitem>
   <listitem>
    <para>
     <xref linkend="uuidmoreinfo" xrefstyle="SectTitleOnPage"/>
    </para>
   </listitem>
  </itemizedlist>
  <sect1 id="udev">
   <title>Naming Devices with udev</title>

   <para>
    In the Linux 2.6 and later kernel, <command>udev</command> provides a
    userspace solution for the dynamic <filename>/dev</filename> directory,
    with persistent device naming. As part of the hotplug system,
    <command>udev</command> is executed if a device is added to or removed
    from the system.
   </para>

   <para>
    A list of rules is used to match against specific device attributes. The
    <command>udev</command> rules infrastructure (defined in the
    <filename>/etc/udev/rules.d</filename> directory) provides stable names
    for all disk devices, regardless of their order of recognition or the
    connection used for the device. The <command>udev</command> tools
    examine every appropriate block device that the kernel creates to apply
    naming rules based on certain buses, drive types, or file systems. For
    information about how to define your own rules for
    <command>udev</command>, see
    <ulink url="http://reactivated.net/writing_udev_rules.html"><citetitle>Writing
    udev Rules</citetitle></ulink>.
   </para>

   <para>
    Along with the dynamic kernel-provided device node name,
    <command>udev</command> maintains classes of persistent symbolic links
    pointing to the device in the <filename>/dev/disk</filename> directory,
    which is further categorized by the <filename>by-id</filename>,
    <filename>by-label</filename>, <filename>by-path</filename>, and
    <filename>by-uuid</filename> subdirectories.
   </para>

   <note>
    <para>
     Other programs besides <command>udev</command>, such as LVM or
     <command>md</command>, might also generate UUIDs, but they are not
     listed in <filename>/dev/disk</filename>.
    </para>
   </note>
  </sect1>
  <sect1 id="understanduuid">
   <title>Understanding UUIDs</title>

   <para>
    A UUID (Universally Unique Identifier) is a 128-bit number for a file
    system that is unique on both the local system and across other systems.
    It is a randomly generated with system hardware information and time
    stamps as part of its seed. UUIDs are commonly used to uniquely tag
    devices.
   </para>

   <itemizedlist role="subtoc">
    <listitem>
     <para>
      <xref linkend="usinguuid" xrefstyle="SectTitleOnPage"/>
     </para>
    </listitem>
    <listitem>
     <para>
      <xref linkend="findinguuid" xrefstyle="SectTitleOnPage"/>
     </para>
    </listitem>
   </itemizedlist>

   <sect2 id="usinguuid">
    <title>Using UUIDs to Assemble or Activate File System Devices</title>
    <para>
     The UUID is always unique to the partition and does not depend on the
     order in which it appears or where it is mounted. With certain SAN
     devices attached to the server, the system partitions are renamed and
     moved to be the last device. For example, if root
     (<filename>/</filename>) is assigned to <filename>/dev/sda1</filename>
     during the install, it might be assigned to
     <filename>/dev/sdg1</filename> after the SAN is connected. One way to
     avoid this problem is to use the UUID in the boot loader and
     <filename>/etc/fstab</filename> files for the boot device.
    </para>
    <para>
     The device ID assigned by the manufacturer for a drive never changes,
     no matter where the device is mounted, so it can always be found at
     boot. The UUID is a property of the file system and can change if you
     reformat the drive. In a boot loader file, you typically specify the
     location of the device (such as <filename>/dev/sda1</filename>) to
     mount it at system boot. The boot loader can also mount devices by
     their UUIDs and administrator-specified volume labels. However, if you
     use a label and file location, you cannot change the label name when
     the partition is mounted.
    </para>
    <para>
     You can use the UUID as criterion for assembling and activating
     software RAID devices. When a RAID is created, the
     <command>md</command> driver generates a UUID for the device, and
     stores the value in the <filename>md</filename> superblock.
    </para>
   </sect2>

   <sect2 id="findinguuid">
    <title>Finding the UUID for a File System Device</title>
    <para>
     You can find the UUID for any block device in the
     <filename>/dev/disk/by-uuid</filename> directory. For example, a UUID
     looks like this:
    </para>
<screen>
e014e482-1c2d-4d09-84ec-61b3aefde77a 
</screen>
   </sect2>
  </sect1>
  <sect1 id="uuidbootx86">
   <title>Using UUIDs in the Boot Loader and /etc/fstab File (x86)</title>

   <para>
    After the install, you can optionally use the following procedure to
    configure the UUID for the system device in the boot loader and
    <filename>/etc/fstab</filename> files for your x86 system.
   </para>

   <para>
    Before you begin, make a copy of <filename>/etc/default/grub</filename>
    file and the <filename>/etc/fstab</filename> file.
   </para>

   <procedure id="b4pdcrj">
    <step id="b4pdcrk">
     <para>
      Install the &productname; for x86 with no SAN devices
      connected.
     </para>
    </step>
    <step id="b4pde5j">
     <para>
      After the install, boot the system.
     </para>
    </step>
    <step id="b4pdeci">
     <para>
      Open a terminal console as the &rootuser; user or
      equivalent.
     </para>
    </step>
    <step id="b4pdejm">
     <para>
      Navigate to the <filename>/dev/disk/by-uuid</filename> directory to
      find the UUID for the device where you installed
      <filename>/boot</filename>, <filename>/root</filename>, and
      <filename>swap</filename>.
     </para>
     <substeps>
      <step id="b4pdgjc">
       <para>
        At the terminal console prompt, enter
       </para>
<screen>
cd /dev/disk/by-uuid
</screen>
      </step>
      <step id="b4pdhde">
       <para>
        List all partitions by entering
       </para>
<screen>
ll
</screen>
      </step>
      <step id="b4pdhy7">
       <para>
        Find the UUID, such as
       </para>
<screen>
e014e482-1c2d-4d09-84ec-61b3aefde77a —&gt; /dev/sda1
</screen>
      </step>
     </substeps>
    </step>
    <step id="b4pdk3y">
     <para>
      Edit the boot loader configuration using the <guimenu>Boot
      Loader</guimenu> option in &yast;.
     </para>
     <para>
      For example, change
     </para>
<screen>
kernel /boot/vmlinuz root=/dev/sda1
</screen>
     <para>
      to
     </para>
<screen>
kernel /boot/vmlinuz root=/dev/disk/by-uuid/e014e482-1c2d-4d09-84ec-61b3aefde77a
</screen>
     <important>
      <para>
       If you make a mistake, you can boot the server without the SAN
       connected, and fix the error by using the backup copy of the
       <filename>/boot/grub2/grub.cfg</filename> file as a guide.
      </para>
     </important>
     <para>
      When you use &yast; to change the way that the root
      (<filename>/</filename>) device is mounted (such as by UUID or by
      label), the boot loader configuration needs to be saved again to make
      the change effective for the boot loader.
     </para>
    </step>
    <step id="b4pdl03">
     <para>
      As the &rootuser; user or equivalent, do one of the
      following to place the UUID in the <filename>/etc/fstab</filename>
      file:
     </para>
     <itemizedlist>
      <listitem>
       <para>
        Launch &yast; as the &rootuser; user, select
        <menuchoice>
        <guimenu>System</guimenu><guimenu>Partitioner</guimenu></menuchoice>,
        select the device of interest, then modify <guimenu>Fstab
        Options</guimenu>.
       </para>
      </listitem>
      <listitem>
       <para>
        Edit the <filename>/etc/fstab</filename> file to modify the system
        device from the location to the UUID.
       </para>
       <para>
        For example, if the root (<filename>/</filename>) volume has a
        device path of <filename>/dev/sda1</filename> and its UUID is
        <filename>e014e482-1c2d-4d09-84ec-61b3aefde77a</filename>, change
        line entry from
       </para>
<screen>
/dev/sda1   /            reiserfs   acl,user_xattr        1 1
</screen>
       <para>
        to
       </para>
<screen>
UUID=e014e482-1c2d-4d09-84ec-61b3aefde77a   /   reiserfs   acl,user_xattr        1 1 
</screen>
       <important>
        <para>
         Do not leave stray characters or spaces in the file.
        </para>
       </important>
      </listitem>
     </itemizedlist>
    </step>
   </procedure>
  </sect1>
  <sect1 id="uuidbootia64">
   <title>Using UUIDs in the Boot Loader and /etc/fstab File (IA64)</title>

   <para>
    After the install, use the following procedure to configure the UUID for
    the system device in the boot loader and <filename>/etc/fstab</filename>
    files for your IA64 system. IA64 uses the EFI BIOS. Its file system
    configuration file is <filename>/boot/efi/SuSE/elilo.conf</filename>
    instead of <filename>/etc/fstab</filename>.
   </para>

   <para>
    Before you begin, make a copy of the
    <filename>/boot/efi/SuSE/elilo.conf</filename> file.
   </para>

   <procedure id="b4pec1b">
    <step id="b4pec1c">
     <para>
      Install the &productname; for IA64 with no SAN devices
      connected.
     </para>
    </step>
    <step id="b4pec1d">
     <para>
      After the install, boot the system.
     </para>
    </step>
    <step id="b4pec1e">
     <para>
      Open a terminal console as the &rootuser; user or
      equivalent.
     </para>
    </step>
    <step id="b4pec1f">
     <para>
      Navigate to the <filename>/dev/disk/by-uuid</filename> directory to
      find the UUID for the device where you installed
      <filename>/boot</filename>, <filename>/root</filename>, and
      <filename>swap</filename>.
     </para>
     <substeps>
      <step id="b4pec1h">
       <para>
        At the terminal console prompt, enter
       </para>
<screen>
cd /dev/disk/by-uuid
</screen>
      </step>
      <step id="b4pec1i">
       <para>
        List all partitions by entering
       </para>
<screen>
ll
</screen>
      </step>
      <step id="b4pec1j">
       <para>
        Find the UUID, such as
       </para>
<screen>
e014e482-1c2d-4d09-84ec-61b3aefde77a —&gt; /dev/sda1
</screen>
      </step>
     </substeps>
    </step>
    <step id="b4pec1k">
     <para>
      Edit the boot loader file, using the Boot Loader option in &yast;.
     </para>
     <para>
      For example, change
     </para>
<screen>
root=/dev/sda1
</screen>
     <para>
      to
     </para>
<screen>
root=/dev/disk/by-uuid/e014e482-1c2d-4d09-84ec-61b3aefde77a
</screen>
    </step>
    <step id="b4pec1l">
     <para>
      Edit the <filename>/boot/efi/SuSE/elilo.conf</filename> file to modify
      the system device from the location to the UUID.
     </para>
     <para>
      For example, change
     </para>
<screen>
/dev/sda1   /   reiserfs   acl,user_xattr        1 1
</screen>
     <para>
      to
     </para>
<screen>
UUID=e014e482-1c2d-4d09-84ec-61b3aefde77a   /   reiserfs   acl,user_xattr        1 1
</screen>
     <important>
      <para>
       Do not leave stray characters or spaces in the file.
      </para>
     </important>
    </step>
   </procedure>
  </sect1>
  <sect1 id="uuidmoreinfo">
   <title>Additional Information</title>

   <para>
    For more information about using <command>udev(8)</command> for managing
    devices, see <xref linkend="cha.udev"/>
   </para>

   <para>
    For more information about <command>udev(8)</command> commands, see its
    man page. Enter the following at a terminal console prompt:
   </para>

<screen>
man 8 udev
</screen>
  </sect1>
 </chapter>
