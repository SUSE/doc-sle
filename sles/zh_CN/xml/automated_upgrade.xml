<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="automated_upgrade.xml" version="5.0" xml:id="cha.update.auto" os="sles">
 <title>从 SUSE Linux Enterprise 11 SP2 自动升级到 11 SP3</title>
 <info>
      <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
        <dm:bugtracker>
        </dm:bugtracker>
        <dm:translation>yes</dm:translation>
      </dm:docmanager>
    </info>
    <para>
  以下过程提供了一种以无人照管的方式从 SUSE Linux Enterprise 11 SP2 到 SUSE Linux Enterprise 11 SP3 的批量升级方法。为了创建合适的 AutoYaST 配置文件，需要执行若干个准备步骤。AutoYaST 最后会执行升级过程。
 </para>
 <sect1 xml:id="sec.update.auto.prep_autoyast">
  <title>准备 AutoYaST 配置文件</title>

  <para>
   自动升级的 AutoYaST 配置文件使用与 AutoYaST 安装相同的文件格式。有关 AutoYaST 的详细信息，请参见<xref linkend="cha.deployment.autoinst"/>和<xref linkend="book.autoyast"/>。
  </para>

  <para>
   但是，系统的某些部分（例如，分区）在升级过程中是不需要进行配置的。另一方面，通过 AutoYaST 配置文件设置升级特定的选项则很有用。
  </para>

  <sect2>
   <title>升级</title>
   <para>
    升级选项定义依赖性解析程序在升级过程中的行为：
   </para>
<screen>&lt;upgrade&gt;
  &lt;only_installed_packages
    config:type="boolean"&gt;false&lt;/only_installed_packages&gt;
  &lt;stop_on_solver_conflict
    config:type="boolean"&gt;true&lt;/stop_on_solver_conflict&gt;
&lt;/upgrade&gt;</screen>
   <variablelist>
    <varlistentry>
     <term><literal>only_installed_packages</literal>
     </term>
     <listitem>
      <para>
       对于基于包的升级（若升级到相同产品的下一个服务包，建议采用这种升级）设置为 <literal>true</literal>，对于基于模式的升级（若为一个产品的两个版本之间的升级，例如从 SLES10 升级到 SLES11，建议采用这种升级）设置为 <literal>false</literal>。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>stop_on_solver_conflict</literal>
     </term>
     <listitem>
      <para>
       定义未能解析包的相互依赖性时是否显示建议（建议设置为 <literal>true</literal>，但这可能会产生交互过程，在该过程中用户需要手动解决冲突）。
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
  </sect2>

  <sect2>
   <title>软件选择</title>
   <para>
    软件选择选项定义除解析程序结果外要选择或取消选择哪些组件：
   </para>
<screen>&lt;software&gt;
  &lt;packages config:type="list"&gt;
    &lt;package&gt;autoyast2-installation&lt;/package&gt;
    &lt;package&gt;apparmor-profile-editor&lt;/package&gt;
  &lt;/packages&gt;
  &lt;patterns config:type="list"&gt;
    &lt;pattern&gt;base&lt;/pattern&gt;
  &lt;/patterns&gt;
  &lt;remove-packages config:type="list"/&gt;
  &lt;remove-patterns config:type="list"/&gt;
&lt;/software&gt;</screen>
   <para>
    这对于设置要选择或取消选择的包或模式以解决包冲突，并因而避免交互式干扰尤其重要。升级完成后，新建的 <filename>autoupg_updated.xml</filename> 文件包含这些包和模式，以及因任何其他原因而选择或取消选择的那些包和模式。
   </para>
  </sect2>

  <sect2>
   <title>升级前备份</title>
   <para>
    升级前备份选项与升级建议中的这些功能相匹配。
   </para>
<screen>&lt;backup&gt;
  &lt;sysconfig config:type="boolean"&gt;true&lt;/sysconfig&gt;
  &lt;modified config:type="boolean"&gt;true&lt;/modified&gt;
  &lt;remove_old config:type="boolean"&gt;false&lt;/remove_old&gt;
&lt;/backup&gt;</screen>
   <variablelist>
    <varlistentry>
     <term><literal>sysconfig</literal>
     </term>
     <listitem>
      <para>
       定义升级前是否备份 sysconfig。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>modified</literal>
     </term>
     <listitem>
      <para>
       定义升级前是否备份修改过的配置文件。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>remove_old</literal>
     </term>
     <listitem>
      <para>
       定义是否从以前的升级中删除旧备份。
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
  </sect2>
 </sect1>
 <sect1 xml:id="sec.update.auto.run">
  <title>运行自动升级</title>

  <para>
   要启动自动升级，请引导安装媒体，并向其传递 AutoYaST 配置文件。有两种方式可以将配置文件传递给系统：
  </para>

  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>
     将配置文件传递给内核命令行，与安装 AutoYaST 的方式相同（使用 <literal>autoupgrade=1</literal> <filename>autoyast=http://host/path/profile.xml</filename> 参数）。对于系统 z，这是唯一可行的办法。
    </para>
   </listitem>
   <listitem>
    <para>
     将 <literal>autoupgrade=1</literal> 参数传递给内核命令行。启动升级之前，将配置文件复制到 <filename>/root/autoupg.xml</filename>。这样就不需要任何其他内核参数。
    </para>
   </listitem>
  </itemizedlist>

  <para>
   后一种方法允许您对于不同的计算机使用单个安装内核命令行 － 只需将各自的配置文件复制到其文件系统即可。
  </para>

  <para>
   只要计算机上仅安装了一个 SUSE Linux Enterprise 系统，就不会发生包冲突，而且，您若没有在升级建议中将配置文件设置为停止，整个过程将以非交互方式进行。在输入升级建议的情况下，则可以修改升级设置。
  </para>

  <para>
   升级完成后，YaST 将编写 <filename>/root/autoupg-updated.xml</filename> 文件，其中包含应用了建议中完成的软件选择更改的配置文件。这对用相同的包选择来大批量升级计算机特别有用。这样，一台计算机的冲突解决方式可以轻松地应用到另一台计算机中，因此这些冲突将会自动解决，而且升级过程本身也将是非交互式的。
  </para>

  <para>
   如果计算机上安装了多个 SUSE Linux Enterprise 系统，总是会询问您升级哪个系统 － 这个问题无法预先做出选择。
  </para>
 </sect1>
 <sect1 xml:id="sec.update.auto.grub">
  <title>引导到升级过程的 GRUB 2 菜单部分</title>

  <remark condition="clarity">
   2014-02-10 - fs: FIXME: This entry needs to be adjusted to GRUB 2. ATM I
                           have no clue how to do it in GRUB 2.
  </remark>

  <para>
   引导系统的一个备用方式是在 GRUB 2 菜单中再创建一个部分（与其他引导加载程序和其他体系结构类似），用此部分启动安装。以下示例假设系统中有一个单独的 <filename>/boot</filename> 分区，该分区在 GRUB 2 中称为 <literal>(hd 0,0)</literal>：
  </para>

<screen>title Upgrade
    root (hd0,0)
    kernel /upgrade/linux
    install=<replaceable>inst_source_url</replaceable> autoupgrade=1
    autoyast=<replaceable>autoyast_profile_url</replaceable> vga=0x314
    initrd /upgrade/initrd
  </screen>

  <para>
   以上示例假设安装内核和安装 <systemitem>initrd</systemitem> 位于 <filename>/boot/upgrade</filename> 目录中。
  </para>

  <para>
   在系统 z 上，您必须向 PARM 文件中添加该参数 — 使用与执行 AutoYaST 驱动型安装时所采用的相同方法继续。
  </para>
 </sect1>
 <sect1 xml:id="sec.update.auto.2nd-stage">
  <title>升级的第二个阶段</title>

  <para>
   自动升级默认情况下不会在升级的第二个阶段执行配置更改。唯一的例外是网络配置，其需要在 AutoYaST 升级配置文件中设置为保留。
  </para>

  <para>
   如果升级后需要对某些系统区域作配置调整（例如，配置新服务），请将相关部分添加到 AutoYaST 的升级配置文件中，这样所选系统区域的配置就会在升级过程中得到保存。
  </para>

  <warning>
   <title>AutoYaST 提供的配置会替换现有配置</title>
   <para>
    请注意，AutoYaST 配置会替换并破坏该系统区域的现有配置。
   </para>
  </warning>

  <para>
   通常，AutoYaST 配置文件中应有的唯一配置调整是向 Subscription Management Tool (SMT) 或 SUSE Customer Center (SCC) 注册系统。如果缺少此过程，系统将无法获取更新储存库，只能在稍后再次配置后才能进行更新。
  </para>
 </sect1>
 <sect1 xml:id="sec.update.auto.limitations">
  <title>限制和提示</title>

  <para/>

  <sect2>
   <title>NetworkManager 和注册</title>
   <para>
    如果使用 NetworkManager 管理网络设备和网络连接，在升级的第二个阶段将无法进行网络连接。从而使系统不能进行注册。
   </para>
  </sect2>

  <sect2>
   <title>清理升级设置</title>
   <para>
    如果为触发升级过程对系统进行了更改（例如，将新部分添加到引导加载程序菜单），则在完成升级后可能要删除此类更改。
   </para>
   <para>
    <remark condition="clarity">
     2014-02-10 - fs: FIXME: Check if such a script still exists for GRUB 2
     and/or ELILO
    </remark>您可以使用安装后脚本自动删除它。可在<xref linkend="createprofile.scripts"/>中找到示例。<filename>autoupg.xml</filename> 样本文件中包含清理 GRUB 2 的 <filename>menu.lst</filename> 的样本脚本。确保脚本与您的特定设置匹配，且不删除实际要保留的内容！
   </para>
  </sect2>

  <sect2>
   <title>更多信息</title>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>
      Linuxrc 文档：<link xlink:href="http://en.opensuse.org/SDB:Linuxrc"/>
     </para>
    </listitem>
   </itemizedlist>
  </sect2>
 </sect1>
</chapter>
