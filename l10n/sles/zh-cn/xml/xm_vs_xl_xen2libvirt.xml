<?xml version="1.0" encoding="UTF-8"?>
<sect1 xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="xm_vs_xl_xen2libvirt.xml" version="5.0" xml:id="xen-xen2libvirt">
 <title>将 Xen 域配置导入 <systemitem class="library">libvirt</systemitem></title>

 <info>
      <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
        <dm:bugtracker>
        </dm:bugtracker>
	<dm:translation>yes</dm:translation>
      </dm:docmanager>
    </info>
    <para>
  <command>xen2libvirt</command> 是用于将旧式 Xen 域配置导入 <systemitem class="library">libvirt</systemitem> 虚拟化库的命令行工具。有关 <systemitem class="library">libvirt</systemitem> 的详细信息，请参见《The Virtualization》（虚拟化）一书。使用 xen2libvirt 可以轻松将已弃用的 <command>xm</command>/xend 工具堆栈所管理的域导入新的 <systemitem class="library">libvirt</systemitem>/libxl 工具堆栈中。使用此工具的 <option>--recursive mode</option> 模式可以一次性导入多个域
 </para>

 <para>
  <command>xen2libvirt</command> 包含在 <systemitem>xen-tools</systemitem> 软件包中。如果需要，请使用以下命令安装该软件包
 </para>

<screen><prompt>&gt; </prompt><command>sudo</command> zypper install xen-tools</screen>

 <para>
  <command>xen2libvirt</command> 的一般语法为
 </para>

<screen>xen2libvirt &lt;options&gt; <replaceable>/path/to/domain/config</replaceable></screen>

 <para>
  其中，<option>options</option> 可以是：
 </para>

 <variablelist>
  <varlistentry>
   <term><option>-h</option>，<option>--help</option>
   </term>
   <listitem>
    <para>
     列显有关 <command>xen2libvirt</command> 用法的简短信息。
    </para>
   </listitem>
  </varlistentry>
  <varlistentry>
   <term><option>-c</option>，<option>--convert-only</option>
   </term>
   <listitem>
    <para>
     将域配置转换为 <systemitem class="library">libvirt</systemitem> XML 格式，但不将配置导入 <systemitem class="library">libvirt</systemitem>。
    </para>
   </listitem>
  </varlistentry>
  <varlistentry>
   <term><option>-r</option>，<option>--recursive</option>
   </term>
   <listitem>
    <para>
     从指定的路径开始，以递归方式转换并/或导入所有域配置。
    </para>
   </listitem>
  </varlistentry>
  <varlistentry>
   <term><option>-f</option>，<option>--format</option>
   </term>
   <listitem>
    <para>
     指定源域配置的格式。可以是 <literal>xm</literal> 或 <literal>sexpr</literal>（S 表达式格式）。
    </para>
   </listitem>
  </varlistentry>
  <varlistentry>
   <term><option>-v</option>，<option>--verbose</option>
   </term>
   <listitem>
    <para>
     列显有关导入过程的更详细的信息。
    </para>
   </listitem>
  </varlistentry>
 </variablelist>

 <example>
  <title>将 Xen 域配置转换为 <systemitem class="library">libvirt</systemitem></title>
  <para>
   假设您有一个通过 <command>xm</command> 管理的 Xen 域，<filename>/etc/xen/sle12.xm</filename> 中保存了该域的以下配置：
  </para>
<screen>kernel = "/boot/vmlinuz-2.6-xenU"
  memory = 128
  name = "SLE12"
  root = "/dev/hda1 ro"
  disk = [ "file:/var/xen/sle12.img,hda1,w" ]</screen>
  <para>
   将此配置转换为 <systemitem class="library">libvirt</systemitem> XML 而不导入，然后查看其内容：
  </para>
<screen><prompt>&gt; </prompt><command>sudo</command> xen2libvirt -f xm -c /etc/xen/sle12.xm &gt; /etc/libvirt/qemu/sles12.xml
  # cat /etc/libvirt/qemu/sles12.xml
  &lt;domain type='xen'&gt;
  &lt;name&gt;SLE12&lt;/name&gt;
  &lt;uuid&gt;43e1863c-8116-469c-a253-83d8be09aa1d&lt;/uuid&gt;
  &lt;memory unit='KiB'&gt;131072&lt;/memory&gt;
  &lt;currentMemory unit='KiB'&gt;131072&lt;/currentMemory&gt;
  &lt;vcpu placement='static'&gt;1&lt;/vcpu&gt;
  &lt;os&gt;
  &lt;type arch='x86_64' machine='xenpv'&gt;linux&lt;/type&gt;
  &lt;kernel&gt;/boot/vmlinuz-2.6-xenU&lt;/kernel&gt;
  &lt;/os&gt;
  &lt;clock offset='utc' adjustment='reset'/&gt;
  &lt;on_poweroff&gt;destroy&lt;/on_poweroff&gt;
  &lt;on_reboot&gt;restart&lt;/on_reboot&gt;
  &lt;on_crash&gt;restart&lt;/on_crash&gt;
  &lt;devices&gt;
  &lt;disk type='file' device='disk'&gt;
  &lt;driver name='file'/&gt;
  &lt;source file='/var/xen/sle12.img'/&gt;
  &lt;target dev='hda1' bus='xen'/&gt;
  &lt;/disk&gt;
  &lt;console type='pty'&gt;
  &lt;target type='xen' port='0'/&gt;
  &lt;/console&gt;
  &lt;/devices&gt;
  &lt;/domain&gt;</screen>
  <para>
   要将域导入 <systemitem class="library">libvirt</systemitem>，可以运行不带 <option>-c</option> 选项的相同 <command>xen2libvirt</command> 命令，或者使用导出的文件 <filename>/etc/libvirt/qemu/sles12.xml</filename>，并通过 <command>virsh</command> 定义新的 Xen 域：
  </para>
<screen><prompt>&gt; </prompt><command>sudo</command> virsh define /etc/libvirt/qemu/sles12.xml</screen>
 </example>
</sect1>
