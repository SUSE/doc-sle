<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="storage_raid_troubleshooting.xml" version="5.0" xml:id="cha-raidtroubleshooting" xml:lang="zh-tw">
 <title>軟體 RAID 疑難排解</title>
 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:bugtracker/>
   <dm:translation>yes</dm:translation>
  </dm:docmanager>
 </info>
  <para>
   檢查 <filename>/proc/mdstat</filename> 檔案以確定 RAID 分割區是否已損毀。磁碟出現故障時，請關閉 Linux 系統並使用以相同方式磁碟分割的新硬碟來更換損壞的硬碟。然後重新啟動系統，並輸入 <command>mdadm /dev/mdX --add /dev/sdX</command> 指令。使用特定的裝置識別碼取代 <literal>X</literal>。這會自動將硬碟整合到 RAID 系統中，並將其完全重構 (適用於 RAID 0 以外的所有 RAID 層級)。
  </para>

  <para>
   雖然您可以在重建期間存取所有資料，但是在完全重建 RAID 之前，可能會遇到一些效能問題。
  </para>

  <sect1 xml:id="sec-raid-trouble-autorecovery">
   <title>修復故障磁碟之後進行還原</title>
   <para>
    RAID 陣列中的磁碟可能會出於多種原因而發生故障。下面列出了最常見的原因：
   </para>
   <itemizedlist>
    <listitem>
     <para>
      磁碟媒體出現問題。
     </para>
    </listitem>
    <listitem>
     <para>
      磁碟機控制器發生故障。
     </para>
    </listitem>
    <listitem>
     <para>
      與磁碟的連接斷開。
     </para>
    </listitem>
   </itemizedlist>
   <para>
    在發生磁碟媒體或控制器故障時，需要更換或維修裝置。如果未在 RAID 中設定熱備用，則需要手動干預。
   </para>
   <para>
    對於後一種情況，可以在修復連接 (可能會自動修復) 之後，使用 <command>mdadm</command> 指令自動重新加入發生故障的裝置。
   </para>
   <para>
    <command>md</command>/<command>mdadm</command> 不能可靠地判斷磁碟故障的原因，它會臆測發生了嚴重的磁碟錯誤，並一直將任何有故障的裝置視為有故障，直到明確獲知該裝置可靠。
   </para>
   <para>
    在某些情況下 (例如，儲存裝置包含內部 RAID 陣列)，連接問題往往是裝置發生故障的原因。在這種情況下，您可以告知 <command>mdadm</command>，在裝置出現後，可以放心地使用 <option>--re-add</option> 自動重新加入該裝置。為此，您可以將以下行新增到 <filename>/etc/mdadm.conf</filename> 中：
   </para>
<screen>POLICY action=re-add</screen>
   <para>
    請注意，僅當 <systemitem>udev</systemitem> 規則導致 <command>mdadm -I <replaceable>DISK_DEVICE_NAME</replaceable></command> 在自發性出現的任何裝置上執行 (預設行為)，並且已設定 write-intent 點陣圖 (預設已設定) 時，才會在裝置重新出現後自動重新加入該裝置。
   </para>
   <para>
    如果您希望此規則只會套用至某些裝置而不會套用至其他一些裝置，可以將 <literal>path=</literal> 選項新增到 <filename>/etc/mdadm.conf</filename> 中的 <literal>POLICY</literal> 行，以限制為只對所選裝置執行非預設動作。可以使用萬用字元來識別裝置群組。如需詳細資訊，請參閱 <command>man 5 mdadm.conf</command>。
   </para>
  
 </sect1>
 
 </chapter>
