<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="vnc.xml" version="5.0" xml:id="cha-vnc"> <title>Sessões gráficas remotas com VNC</title>
 <info>
      <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
        <dm:bugtracker/>
        <dm:translation>yes</dm:translation>
      </dm:docmanager>
      <abstract>
        <para>
    O VNC (Virtual Network Computing) permite acessar um computador remoto por meio de uma área de trabalho gráfica e executar aplicativos gráficos remotos. O VNC é independente de plataforma e acessa a máquina remota de qualquer sistema operacional. Este capítulo descreve como se conectar a um servidor VNC com os clientes de área de trabalho vncviewer e Remmina e como operar um servidor VNC.
   </para>
        <para>
    O <phrase role="productname"><phrase os="sled">SUSE Linux Enterprise Desktop</phrase></phrase> suporta dois tipos diferentes de sessões VNC: sessões únicas, que permanecem <quote>ativas</quote> enquanto a conexão VNC do cliente está ativada, e sessões persistentes, que permanecem <quote>ativas</quote> até serem explicitamente terminadas.
   </para>
        <para>
   Um servidor VNC é capaz de oferecer ambos os tipos de sessões simultaneamente em portas diferentes, mas uma sessão aberta não pode ser convertida de um tipo em outro.
  </para>
      </abstract>
    </info>
    <sect1 xml:id="sec-vnc-viewer">
  <title>Cliente <command>vncviewer</command></title>
 

  <para>
   Para se conectar a um serviço VNC fornecido por um servidor, é necessário um cliente. O padrão no <phrase role="productname"><phrase os="sled">SUSE Linux Enterprise Desktop</phrase></phrase> é o <command>vncviewer</command>, incluído no pacote <systemitem class="resource">tigervnc</systemitem>.
  </para>

  <sect2 xml:id="sec-vnc-viewer-connectcli">
   <title>Conexão por meio da CLI do vncviewer</title>
   <para>
    Para iniciar o viewer do VNC e começar uma sessão com o servidor, use o comando:
   </para>
<screen><prompt>tux &gt; </prompt>vncviewer jupiter.example.com:1</screen>
   <para>
    Em vez do número de exibição do VNC, você também pode especificar o número da porta com dois-pontos duplos:
   </para>
<screen><prompt>tux &gt; </prompt>vncviewer jupiter.example.com::5901</screen>
   <note>
    <title>Número de exibição e de porta</title>
    <para>
     O número real de exibição ou de porta especificado no cliente VNC deve ser igual ao número selecionado pelo comando <command>vncserver</command> na máquina de destino. Consulte a <xref linkend="sec-vnc-persistent"/> para obter mais informações.
    </para>
   </note>
  </sect2>

  <sect2 xml:id="sec-vnc-viewer-connectgui">
   <title>Conexão por meio da GUI do vncviewer</title>
   <para>
    Ao executar o <command>vncviewer</command> sem especificar <command>--listen</command> nem um host ao qual se conectar, será exibida uma janela solicitando detalhes da conexão. Informe o host no campo <guimenu>Servidor VNC</guimenu>, conforme mostrado na <xref linkend="sec-vnc-viewer-connectcli"/>, e clique em <guimenu>Conectar</guimenu>.
   </para>
   <figure xml:id="fig-vnc-viewer-connectgui">
    <title>vncviewer</title>
    <mediaobject>
     <textobject role="description"><phrase>vncviewer solicitando detalhes da conexão</phrase>
     </textobject>
     <imageobject role="html">
      <imagedata fileref="vnc_connect.png" format="PNG"/>
     </imageobject>
     <imageobject role="fo">
      <imagedata fileref="vnc_connect.png" format="PNG"/>
     </imageobject>
    </mediaobject>
   </figure>
  </sect2>

  <sect2 xml:id="sec-vnc-viewer-encrypt">
   <title>Notificação de conexões não criptografadas</title>
   <para>
    O protocolo VNC suporta diferentes tipos de conexões criptografadas, o que não deve ser confundido com autenticação de senha. Se uma conexão não usar TLS, o texto <quote>(Conexão não criptografada)!</quote> poderá aparecer no título da janela do viewer do VNC.
   </para>
  </sect2>
 </sect1>

 <sect1 xml:id="vnc-remmina">
  <title>Remmina: o cliente de área de trabalho remota</title>

  <para>
   Remmina é um cliente de área de trabalho remota moderno e cheio de recursos. Ele suporta vários métodos de acesso, por exemplo VNC, SSH, RDP e Spice.
  </para>

  <sect2 xml:id="vnc-remmina-install">
   <title>Instalação</title>
   <para>
    Para usar o Remmina, verifique se o pacote <package>remmina</package> está instalado no sistema e, se não estiver, instale-o. Lembre-se também de instalar o plug-in VNC para Remmina:
   </para>
<screen>
<prompt role="root">root # </prompt>zypper in remmina remmina-plugin-vnc
</screen>
  </sect2>

  <sect2 xml:id="vnc-remmina-usage">
   <title>Janela principal</title>
   <para>
    Execute o Remmina digitando o comando <command>remmina</command>.
   </para>
   <figure>
    <title>Janela principal do Remmina</title>
    <mediaobject>
     <imageobject role="fo">
      <imagedata fileref="remmina.png" width="50%" format="PNG"/>
     </imageobject>
     <imageobject role="html">
      <imagedata fileref="remmina.png" width="50%" format="PNG"/>
     </imageobject>
    </mediaobject>
   </figure>
   <para>
    A janela principal do aplicativo mostra a lista de sessões remotas armazenadas. Nela, você pode adicionar e gravar uma nova sessão remota, iniciar rapidamente uma nova sessão sem gravá-la, iniciar uma sessão que já foi gravada ou definir as preferências globais do Remmina.
   </para>
  </sect2>

  <sect2 xml:id="vnc-remmina-addnew">
   <title>Adicionando sessões remotas</title>
   <para>
    Para adicionar e gravar uma nova sessão remota, clique em <inlinemediaobject><textobject role="description"><phrase>Adicionar nova sessão</phrase></textobject><imageobject role="fo"><imagedata fileref="remmina_plus.png" width="1.2em" format="PNG"/></imageobject><imageobject role="html"><imagedata fileref="remmina_plus.png" width="1.2em" format="PNG"/></imageobject></inlinemediaobject> na parte superior esquerda da janela principal. A janela <guimenu>Preferência da Área de Trabalho Remota</guimenu> é aberta.
   </para>
   <figure>
    <title>Preferência da área de trabalho remota</title>
    <mediaobject>
     <imageobject role="fo">
      <imagedata fileref="remmina_session_details.png" width="80%" format="PNG"/>
     </imageobject>
     <imageobject role="html">
      <imagedata fileref="remmina_session_details.png" width="80%" format="PNG"/>
     </imageobject>
    </mediaobject>
   </figure>
   <para>
    Preencha os campos que especificam o perfil da sessão remota recém-adicionada. Os mais importantes são:
   </para>
   <variablelist>
    <varlistentry>
     <term>Nome</term>
     <listitem>
      <para>
       Nome do perfil. Ele será listado na janela principal.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>Protocolo</term>
     <listitem>
      <para>
       O protocolo a ser usado na conexão com a sessão remota. Por exemplo, VNC.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>Servidor</term>
     <listitem>
      <para>
       O endereço IP ou DNS e o número de exibição do servidor remoto.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>Nome de usuário, senha</term>
     <listitem>
      <para>
       As credenciais que serão usadas para autenticação remota. Deixe vazio para nenhuma autenticação.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>Profundidade de cores, qualidade</term>
     <listitem>
      <para>
       Selecione as melhores opções de acordo com a velocidade e a qualidade da conexão.
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
   <para>
    Selecione a guia <guimenu>Avançado</guimenu> para inserir configurações mais específicas.
   </para>
   <tip>
    <title>Desabilitar criptografia</title>
    <para>
     Se a comunicação entre o cliente e o servidor remoto não for criptografada, ative <guimenu>Desabilitar Criptografia</guimenu>; do contrário, haverá falha na conexão.
    </para>
   </tip>
   <para>
    Selecione a guia <guimenu>SSH</guimenu> para opções avançadas de autenticação e túnel SSH.
   </para>
   <para>
    Confirme com <guimenu>Salvar</guimenu>. Seu novo perfil será listado na janela principal.
   </para>
  </sect2>

  <sect2 xml:id="vnc-remmina-start">
   <title>Iniciando sessões remotas</title>
   <para>
    Você pode iniciar uma sessão que já foi gravada ou iniciar rapidamente uma sessão remota sem gravar os detalhes da conexão.
   </para>
   <sect3 xml:id="vnc-remmina-quickstart">
    <title>Iniciando sessões remotas rapidamente</title>
    <para>
     Para iniciar uma sessão remota rapidamente, sem adicionar e gravar os detalhes da conexão, use a caixa suspensa e a caixa de texto na parte superior da janela principal.
    </para>
    <figure>
     <title>Iniciando rapidamente</title>
     <mediaobject>
      <imageobject role="fo">
       <imagedata fileref="remmina_quickstart.png" width="40%" format="PNG"/>
      </imageobject>
      <imageobject role="html">
       <imagedata fileref="remmina_quickstart.png" width="40%" format="PNG"/>
      </imageobject>
     </mediaobject>
    </figure>
    <para>
     Selecione o protocolo de comunicação na caixa suspensa (por exemplo, “VNC”) e digite o endereço DNS ou IP do servidor VNC seguido de uma vírgula e de um número de exibição. Em seguida, pressione <keycap function="enter"/> para confirmar.
    </para>
   </sect3>
   <sect3>
    <title>Abrindo sessões remotas gravadas</title>
    <para>
     Para abrir uma sessão remota específica, clique duas vezes nela na lista de sessões.
    </para>
   </sect3>
   <sect3>
    <title>Janela de sessões remotas</title>
    <para>
     As sessões remotas são abertas nas guias de uma janela separada. Cada guia hospeda uma sessão. A barra de ferramentas à esquerda da janela permite gerenciar as janelas/sessões, como alternar para o modo de tela cheia, redimensionar a janela para corresponder ao tamanho de tela da sessão, enviar toques específicos para a sessão, fazer capturas de tela da sessão ou definir a qualidade da imagem.
    </para>
    <figure>
     <title>Vendo sessão remota no Remmina</title>
     <mediaobject>
      <imageobject role="fo">
       <imagedata fileref="remmina_sle15inside.png" width="80%" format="PNG"/>
      </imageobject>
      <imageobject role="html">
       <imagedata fileref="remmina_sle15inside.png" width="80%" format="PNG"/>
      </imageobject>
     </mediaobject>
    </figure>
   </sect3>
  </sect2>

  <sect2 xml:id="vnc-remmina-edit-delete-clone">
   <title>Editando, copiando e apagando sessões gravadas</title>
   <para>
    Para <emphasis>editar</emphasis> uma sessão remota gravada, clique o botão direito do mouse no nome dela na janela principal do Remmina e selecione <guimenu>Editar</guimenu>. Consulte a <xref linkend="vnc-remmina-addnew"/> para ver a descrição dos campos relevantes.
   </para>
   <para>
    Para <emphasis>copiar</emphasis> uma sessão remota gravada, clique o botão direito do mouse no nome dela na janela principal do Remmina e selecione <guimenu>Copiar</guimenu>. Na janela <guimenu>Preferência da Área de Trabalho Remota</guimenu>, mude o nome do perfil, ajuste as opções relevantes (opcional) e clique em <guimenu>Gravar</guimenu> para confirmar.
   </para>
   <para>
    Para <emphasis>apagar</emphasis> uma sessão remota gravada, clique o botão direito do mouse no nome dela na janela principal do Remmina e selecione <guimenu>Apagar</guimenu>. Na caixa de diálogo, clique em <guimenu>Sim</guimenu> para confirmar.
   </para>
  </sect2>

  <sect2 xml:id="vnc-remmina-cmdline">
   <title>Executando sessões remotas da linha de comando</title>
   <para>
    Se você precisar abrir uma sessão remota da linha de comando ou de um arquivo de lote sem primeiro abrir a janela principal do aplicativo, use a seguinte sintaxe:
   </para>
<screen>
 <prompt>tux &gt; </prompt>remmina -c <replaceable>profile_name</replaceable>.remmina
</screen>
   <para>
    Os arquivos de perfil do Remmina são armazenados no diretório <filename>.local/share/remmina/</filename> em seu diretório pessoal. Para determinar qual arquivo de perfil pertence à sessão que você deseja abrir, execute o Remmina, clique no nome da sessão na janela principal e leia o caminho para o arquivo de perfil na linha de status da janela na parte inferior.
   </para>
   <figure>
    <title>Lendo o caminho para o arquivo de perfil</title>
    <mediaobject>
     <imageobject role="fo">
      <imagedata fileref="remmina_status.png" width="50%" format="PNG"/>
     </imageobject>
     <imageobject role="html">
      <imagedata fileref="remmina_status.png" width="50%" format="PNG"/>
     </imageobject>
    </mediaobject>
   </figure>
   <para>
    Enquanto o Remmina não estiver em execução, você poderá renomear o arquivo de perfil para um nome de arquivo mais apropriado, como <filename>sle15.remmina</filename>. Você pode até copiar o arquivo de perfil para o seu diretório personalizado e executá-lo usando o comando <command>remmina -c</command> nesse diretório.
   </para>
  </sect2>
 </sect1>
 
 <sect1 xml:id="sec-vnc-one-time">
  <title>Configurando sessões únicas no servidor VNC</title>

  <para>
   Uma sessão única é iniciada por um cliente remoto. Ela inicia uma tela gráfica de login no servidor. Desse modo, você pode escolher o usuário que inicia a sessão e, se suportado pelo gerenciador de login, o ambiente de área de trabalho. Quando você terminar a conexão do cliente com essa sessão VNC, todos os aplicativos iniciados nessa sessão também serão terminados. Sessões VNC únicas não podem ser compartilhadas, mas é possível ter várias sessões em um único host ao mesmo tempo.
  </para>

  <procedure xml:id="pro-vnc-one-time-activate">
   <title>Habilitando sessões VNC únicas</title>
   <step>
    <para>
     Inicie o <menuchoice> <guimenu> YaST</guimenu> <guimenu> Serviços de Rede</guimenu> <guimenu> Administração Remota (VNC)</guimenu>
     </menuchoice>.
    </para>
   </step>
   <step>
    <para>
     Marque <guimenu>Permitir Administração Remota sem Gerenciamento de Sessões</guimenu>.
    </para>
   </step>
   <step>
    <para>
     Ative <guimenu>Permitir acesso usando um browser da Web</guimenu> se você pretende acessar a sessão VNC em uma janela do browser da Web.
    </para>
   </step>
   <step>
    <para>
     Se necessário, marque também <guimenu>Abrir Porta no Firewall</guimenu> (por exemplo, quando a interface de rede estiver configurada para ficar na Zona Externa). Se você tem mais de uma interface de rede, restrinja a abertura de portas no firewall a uma interface específica em <guimenu>Detalhes do Firewall</guimenu>.
    </para>
   </step>
   <step>
    <para>
     Confirme as configurações com <guimenu>Próximo</guimenu>.
    </para>
   </step>
   <step>
    <para>
     Caso nem todos os pacotes necessários já estejam disponíveis, aprove a instalação dos pacotes ausentes.
    </para>
    <tip>
     <title>Reiniciar o gerenciador de exibição</title>
     <para>
      O YaST faz mudanças nas configurações do gerenciador de exibição. Você precisará efetuar logout da sessão gráfica atual e reiniciar o gerenciador de exibição para que as mudanças entrem em vigor.
     </para>
    </tip>
   </step>
  </procedure>

  <figure>
   <title>Administração remota</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="vnc_nosession.png" width="70%" format="PNG"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="vnc_nosession.png" width="70%" format="PNG"/>
    </imageobject>
   </mediaobject>
  </figure>

  <sect2 xml:id="sec-vnc-one-time-configs">
   <title>Configurações disponíveis</title>
   <para>
    A configuração padrão no <phrase role="productname"><phrase os="sled">SUSE Linux Enterprise Desktop</phrase></phrase> confere às sessões uma resolução de 1024 x 768 pixels com profundidade de cores de 16 bits. As sessões estão disponíveis nas portas <systemitem class="resource">5901</systemitem> para viewers VNC <quote>regulares</quote> (equivalente à exibição VNC <literal>1</literal>) e na porta <systemitem class="resource">5801</systemitem> para browsers da Web.
   </para>
   <para>
    É possível disponibilizar outras configurações em portas diferentes.<phrase os="sled"> Peça os detalhes ao administrador do sistema, se você precisar modificar a configuração.</phrase>
   </para>
   <para>
    Os números de exibição VNC e os números de exibição X são independentes nas sessões únicas. Um número de exibição VNC é atribuído manualmente a todas as configurações suportadas pelo servidor (:1 no exemplo acima). Sempre que uma sessão VNC é iniciada com uma das configurações, ela recebe automaticamente um número de exibição X livre.
   </para>
   <para>
    Por padrão, tanto o cliente quanto o servidor VNC tentam se comunicar de forma segura por meio de um certificado SSL autoassinado, que será gerado após a instalação. É possível usar o padrão ou substituí-lo pelo seu próprio certificado. Ao usar o certificado autoassinado, você precisa confirmar sua assinatura antes da primeira conexão, tanto no viewer do VNC quanto no browser da web.
   </para>
  </sect2>

  <sect2 xml:id="sec-vnc-one-time-connect">
   <title>Iniciando uma sessão VNC única</title>
   <para>
    Para conectar-se a uma sessão VNC única, é necessário instalar o viewer do VNC. Consulte também a <xref linkend="sec-vnc-viewer"/>. Se preferir, use um browser da Web compatível com JavaScript para ver a sessão VNC digitando o seguinte URL: <literal>http://jupiter.example.com:5801</literal>
   </para>
  </sect2>

  <sect2 xml:id="sec-vnc-one-time-config">
   <title>Configurando sessões VNC únicas</title>
   <para>
    Você poderá ignorar esta seção se não precisar nem desejar modificar a configuração padrão.
   </para>
   <para>
    As sessões VNC únicas são iniciadas pelo <systemitem class="daemon">systemd</systemitem> soquete <systemitem>xvnc.socket</systemitem>. Por padrão, ele oferece seis blocos de configuração: três para viewers do VNC (<literal>vnc1</literal> a <literal>vnc3</literal>) e três que atendem a um cliente JavaScript (<literal>vnchttpd1</literal> a <literal>vnchttpd3</literal>). Por padrão, apenas <literal>vnc1</literal> e <literal>vnchttpd1</literal> estão ativos.
   </para>
   <para>
    Para ativar o soquete do servidor VNC no momento da inicialização, execute o seguinte comando:
   </para>
<screen><prompt>tux &gt; </prompt><command>sudo</command>  systemctl enable xvnc.socket</screen>
   <para>
    Para iniciar o soquete imediatamente, execute:
   </para>
<screen><prompt>tux &gt; </prompt><command>sudo</command>  systemctl start xvnc.socket</screen>
   <para>
    O servidor <command>Xvnc</command> pode ser configurado por meio da opção <literal>server_args</literal>. Para obter uma lista de opções, consulte <command>Xvnc --help</command>.
   </para>
   <para>
    Ao adicionar configurações padrão, certifique-se de que elas não usem portas já em uso por outras configurações, outros serviços ou sessões VNC persistentes existentes no mesmo host.
   </para>
   <para>
    Ative as mudanças na configuração digitando o seguinte comando:
   </para>
<screen><prompt>tux &gt; </prompt><command>sudo</command> systemctl reload xvnc.socket</screen>
   <important>
    <title>Firewall e portas VNC</title>
    <para>
     Ao ativar a Administração Remota conforme descrito no <xref linkend="pro-vnc-one-time-activate"/>, as portas <systemitem class="resource">5801</systemitem> e <systemitem class="resource">5901</systemitem> são abertas no firewall. Se a interface de rede que atende às sessões VNC for protegida por firewall, será necessário abrir manualmente as respectivas portas ao ativar portas adicionais para as sessões VNC. Consulte a <xref linkend="cha-security-firewall"/> para obter instruções.
    </para>
   </important>
  </sect2>
 </sect1>
 
 <sect1 xml:id="sec-vnc-persistent">
  <title>Configurando sessões persistentes do servidor VNC</title>

  <para>
   É possível acessar uma sessão persistente de vários clientes ao mesmo tempo. Isso é ideal para fins de demonstração em que um cliente tem acesso total, e todos os outros têm acesso apenas exibição. Outro caso de uso são sessões de treinamento em que o instrutor pode precisar acessar a área de trabalho do aluno.
  </para>

  <tip xml:id="sec-vnc-persistent-connect">
   <title>Conectando-se a uma sessão VNC persistente</title>
   <para>
    Para conectar-se a uma sessão VNC persistente, é preciso instalar o viewer do VNC. Consulte a <xref linkend="sec-vnc-viewer"/> para obter mais detalhes. Se preferir, use um browser da Web compatível com JavaScript para ver a sessão VNC digitando o seguinte URL: <literal>http://jupiter.example.com:5801</literal>
   </para>
  </tip>

  <para>
   Há dois tipos de sessões VNC persistentes:
  </para>

  <itemizedlist>
   <listitem>
    <para>
     <xref linkend="vnc-persistent-vncserver" xrefstyle="select:title"/>
    </para>
   </listitem>
   <listitem>
    <para>
     <xref linkend="vnc-persistent-vncmanager" xrefstyle="select:title"/>
    </para>
   </listitem>
  </itemizedlist>

  <sect2 xml:id="vnc-persistent-vncserver">
   <title>Sessão VNC iniciada usando <systemitem>vncserver</systemitem></title>
   <para>
    Esse tipo de sessão VNC persistente é iniciado no servidor. A sessão e todos os aplicativos iniciados nessa sessão são executados independentemente das conexões do cliente até a sessão ser terminada. O acesso às sessões persistentes é protegido por dois tipos de senhas possíveis:
   </para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>
      uma senha regular que permite acesso total ou
     </para>
    </listitem>
    <listitem>
     <para>
      uma senha opcional apenas exibição que permite acesso não interativo (apenas exibição).
     </para>
    </listitem>
   </itemizedlist>
   <para>
    Uma sessão pode ter várias conexões de cliente de ambos os tipos de uma só vez.
   </para>
   <procedure xml:id="pro-vnc-persistent-activate">
    <title>Iniciando uma sessão VNC persistente pelo <command>vncserver</command></title>
    <step>
     <para>
      Abra um shell e verifique se você está conectado como o usuário proprietário da sessão VNC.

     </para>
    </step>
    <step>
     <para>
      Se a interface de rede que atende às sessões VNC for protegida por firewall, será necessário abrir manualmente a porta usada pela sessão no firewall. Se você iniciar várias sessões, poderá também abrir uma faixa de portas. Consulte o <xref linkend="cha-security-firewall"/> para obter os detalhes sobre como configurar o firewall.
     </para>
     <para>
      O <command>vncserver</command> usa as portas <systemitem class="resource">5901</systemitem> para exibição <literal>:1</literal>, <systemitem class="resource">5902</systemitem> para exibição <literal>:2</literal>, e assim por diante. Para sessões persistentes, a exibição VNC e a exibição X geralmente têm o mesmo número.
     </para>
    </step>
    <step>
     <para>
      Para iniciar uma sessão com resolução de 1024 x 768 pixels e profundidade de cores de 16 bits, digite o seguinte comando:
     </para>
<screen>vncserver -alwaysshared -geometry 1024x768 -depth 16</screen>
     <para>
      O comando <command>vncserver</command> escolhe um número de exibição não usado quando nenhum número é especificado e imprime essa escolha. Consulte <command>man 1 vncserver</command> para ver mais opções.
     </para>
    </step>
   </procedure>
   <para>
    Quando o <command>vncserver</command> é executado pela primeira vez, ele pede uma senha para acesso total à sessão. Se necessário, forneça também uma senha de acesso apenas exibição à sessão.
   </para>
   <para>
    A(s) senha(s) inserida(s) aqui também será(ão) usada(s) em sessões futuras iniciadas pelo mesmo usuário. Elas podem ser modificadas com o comando <command>vncpasswd</command>.
   </para>
   <important>
    <title>Considerações de segurança</title>
    <para>
     Verifique se está usando senhas avançadas de tamanho significativo (oito ou mais caracteres). Não compartilhe essas senhas.
    </para>
   </important>
   <para>
    Para terminar a sessão, encerre o ambiente de área de trabalho executado na sessão VNC pelo viewer do VNC, da mesma forma que você encerra uma sessão X local regular.
   </para>
   <para>
    Se preferir terminar a sessão manualmente, abra um shell no servidor VNC e certifique-se de estar conectado como o usuário que possui a sessão VNC que deseja terminar. Execute o seguinte comando para terminar a sessão em execução na exibição <literal>:1</literal>: <command>vncserver -kill :1</command>
   </para>
   <sect3 xml:id="sec-vnc-persistent-configure">
    <title>Configurando sessões VNC persistentes</title>
    <para>
     É possível configurar as sessões VNC persistentes editando <filename>$HOME/.vnc/xstartup</filename>. Por padrão, o script shell inicia o mesmo gerenciador de janelas/GUI do qual ele foi iniciado. No <phrase role="productname"><phrase os="sled">SUSE Linux Enterprise Desktop</phrase></phrase>, pode ser o GNOME ou o IceWM. Para iniciar a sessão com um gerenciador de janelas de sua escolha, defina a variável <envar>WINDOWMANAGER</envar>:
    </para>
<screen>WINDOWMANAGER=gnome vncserver -geometry 1024x768
WINDOWMANAGER=icewm vncserver -geometry 1024x768</screen>
    <note>
     <title>Uma configuração para cada usuário</title>
     <para>
      Sessões VNC persistentes são configuradas em uma única configuração por usuário. Várias sessões iniciadas pelo mesmo usuário utilizarão todos os mesmos arquivos de inicialização e senha.
     </para>
    </note>
   </sect3>
  </sect2>

  <sect2 xml:id="vnc-persistent-vncmanager">
   <title>Sessão VNC iniciada usando <systemitem>vncmanager</systemitem></title>
   <para/>
   <procedure xml:id="vnc-persistent-vncmanager-enable">
    <title>Habilitando sessões VNC persistentes</title>
    <step>
     <para>
      Inicie o <menuchoice> <guimenu> YaST</guimenu> <guimenu> Serviços de Rede</guimenu> <guimenu> Administração Remota (VNC)</guimenu>
      </menuchoice>.
     </para>
    </step>
    <step>
     <para>
      Ative <guimenu>Permitir Administração Remota com Gerenciamento de Sessões</guimenu>.
     </para>
    </step>
    <step>
     <para>
      Ative <guimenu>Permitir acesso usando um browser da Web</guimenu> se você pretende acessar a sessão VNC em uma janela do browser da Web.
     </para>
    </step>
    <step>
     <para>
      Se necessário, marque também <guimenu>Abrir Porta no Firewall</guimenu> (por exemplo, quando a interface de rede estiver configurada para ficar na Zona Externa). Se você tem mais de uma interface de rede, restrinja a abertura de portas no firewall a uma interface específica em <guimenu>Detalhes do Firewall</guimenu>.
     </para>
    </step>
    <step>
     <para>
      Confirme as configurações com <guimenu>Próximo</guimenu>.
     </para>
    </step>
    <step>
     <para>
      Caso nem todos os pacotes necessários já estejam disponíveis, aprove a instalação dos pacotes ausentes.
     </para>
     <tip>
      <title>Reiniciar o gerenciador de exibição</title>
      <para>
       O YaST faz mudanças nas configurações do gerenciador de exibição. Você precisará efetuar logout da sessão gráfica atual e reiniciar o gerenciador de exibição para que as mudanças entrem em vigor.
      </para>
     </tip>
    </step>
   </procedure>
   <sect3 xml:id="vnc-persistent-vncmanager-configure">
    <title>Configurando sessões VNC persistentes</title>
    <para>
     Após habilitar o gerenciamento de sessões VNC conforme descrito no <xref linkend="vnc-persistent-vncmanager-enable"/>, você poderá conectar-se normalmente ao seu viewer do VNC favorito, como <command>vncviewer</command> ou Remmina. Você verá a tela de login. Depois que você efetuar login, o ícone “VNC” será exibido na bandeja do sistema do ambiente de área de trabalho. Clique no ícone para abrir a janela <guimenu>Sessão VNC</guimenu>. Se ele não aparecer ou se o seu ambiente de área de trabalho não oferecer suporte a ícones na bandeja do sistema, execute <command>vncmanager-controller</command> manualmente.
    </para>
    <figure>
     <title>Configurações de sessão VNC</title>
     <mediaobject>
      <imageobject role="fo">
       <imagedata fileref="vncmanager_session.png" width="85%" format="PNG"/>
      </imageobject>
      <imageobject role="html">
       <imagedata fileref="vncmanager_session.png" width="85%" format="PNG"/>
      </imageobject>
     </mediaobject>
    </figure>
    <para>
     Há várias configurações que afetam o comportamento da sessão VNC:
    </para>
    <variablelist>
     <varlistentry>
      <term><guimenu>Não persistente, particular</guimenu>
      </term>
      <listitem>
       <para>
        Isso é equivalente a uma sessão única. Ela não fica visível a outros usuários e será terminada depois que você se desconectar. Consulte o <xref linkend="sec-vnc-one-time"/> para obter mais informações.
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term><guimenu>Persistente, visível</guimenu>
      </term>
      <listitem>
       <para>
        A sessão fica visível a outros usuários e continuará em execução mesmo depois que você se desconectar.
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term><guimenu>Nome da sessão</guimenu>
      </term>
      <listitem>
       <para>
        Aqui você pode especificar o nome da sessão persistente para que ela seja facilmente identificada ao reconectar-se.
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term><guimenu>Senha não é obrigatória</guimenu>
      </term>
      <listitem>
       <para>
        A sessão será livremente acessível sem necessidade de efetuar login com credenciais de usuário.
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term><guimenu>Exigir login de usuário</guimenu>
      </term>
      <listitem>
       <para>
        Você precisa efetuar login com um nome de usuário e uma senha válidos para acessar a sessão. Lista os nomes válidos de usuário na caixa de texto <guimenu>Usuários permitidos</guimenu>.
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term><guimenu>Permitir um cliente por vez</guimenu>
      </term>
      <listitem>
       <para>
        Impede que vários usuários ingressem na sessão ao mesmo tempo.
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term><guimenu>Permitir vários clientes por vez</guimenu>
      </term>
      <listitem>
       <para>
        Permite que vários usuários ingressem na sessão persistente ao mesmo tempo. Um recurso útil para apresentações ou sessões de treinamento remotas.
       </para>
      </listitem>
     </varlistentry>
    </variablelist>
    <para>
     Confirme com <guimenu>OK</guimenu>.
    </para>
   </sect3>
   <sect3 xml:id="vnc-persistent-vncmanager-join">
    <title>Ingressando em sessões VNC persistentes</title>
    <para>
     Após configurar uma sessão VNC persistente, conforme descrito na <xref linkend="vnc-persistent-vncmanager-configure"/>, você poderá ingressar nela com o viewer do VNC. Depois que o cliente VNC conectar-se ao servidor, será solicitado que você escolha se deseja criar uma nova sessão ou ingressar em uma existente:
    </para>
    <figure>
     <title>Ingressando em uma sessão VNC persistente</title>
     <mediaobject>
      <imageobject role="fo">
       <imagedata fileref="vncmanager_whether.png" width="80%" format="PNG"/>
      </imageobject>
      <imageobject role="html">
       <imagedata fileref="vncmanager_whether.png" width="80%" format="PNG"/>
      </imageobject>
     </mediaobject>
    </figure>
    <para>
     Após clicar no nome da sessão existente, talvez você tenha que inserir as credenciais de login, dependendo das configurações de sessão persistente.
    </para>
   </sect3>
  </sect2>
 </sect1>
 
 <sect1 xml:id="sec-vnc-encrypt">
  <title>Configurando a criptografia no servidor VNC</title>

  <para>
   Se o servidor VNC estiver configurado apropriadamente, todas as comunicações entre o cliente e o servidor VNC serão criptografadas. A autenticação ocorre no início da sessão. A transferência real dos dados começa somente depois.
  </para>

  <para>
   Seja para uma sessão VNC única ou persistente, as opções de segurança são configuradas por meio do parâmetro <option>-securitytypes</option> do comando <command>/usr/bin/Xvnc</command> localizado na linha <literal>server_args</literal>. O parâmetro <option>-securitytypes</option> seleciona tanto o método de autenticação quanto a criptografia. Ele tem as seguintes opções:
  </para>

  <variablelist>
   <title>Autenticações</title>
   <varlistentry>
    <term>None, TLSNone, x509None</term>
    <listitem>
     <para>
      Nenhuma autenticação.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>VncAuth, TLSVnc, x509Vnc</term>
    <listitem>
     <para>
      Autenticação com senha personalizada.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Plain, TLSPlain, x509Plain</term>
    <listitem>
     <para>
      Autenticação que usa PAM para verificar a senha do usuário.
     </para>
    </listitem>
   </varlistentry>
  </variablelist>

  <variablelist>
   <title>Criptografias</title>
   <varlistentry>
    <term>None, vncAuth, plain</term>
    <listitem>
     <para>
      Sem criptografia.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>TLSNone, TLSVnc, TLSPlain</term>
    <listitem>
     <para>
      Criptografia TLS anônima. Tudo é criptografado, mas não há nenhuma verificação do host remoto. Portanto, você está protegido contra invasores passivos, mas não contra invasores man-in-the-middle.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>X509None, x509Vnc, x509Plain</term>
    <listitem>
     <para>
      Criptografia TLS com certificado. Se você usar um certificado autoassinado, será solicitado a verificá-lo na primeira conexão. Nas conexões subsequentes, você será avisado apenas se o certificado for mudado. Portanto, você está protegido contra tudo, exceto man-in-the-middle na primeira conexão (similar ao uso comum de SSH). Se você usar um certificado assinado por uma autoridade de certificação que corresponde ao nome da máquina, terá segurança total (similar ao uso comum de HTTPS).
     </para>
     <tip>
      <title>Caminho para certificado e chave</title>
      <para>
       Com a criptografia baseada em X509, você precisa especificar o caminho para o certificado e a chave X509 com as opções <option>-X509Cert</option> e <option>-X509Key</option>.
      </para>
     </tip>
    </listitem>
   </varlistentry>
  </variablelist>

  <para>
   Se você selecionar vários tipos de segurança separados por vírgula, o primeiro que for suportado e permitido pelo cliente e pelo servidor será utilizado. Dessa forma, você pode configurar criptografia oportunista no servidor. Isso é útil se você precisa suportar clientes VNC que não aceitam criptografia.
  </para>

  <para>
   No cliente, você também pode especificar os tipos de segurança permitidos para impedir ataque de instalação de uma versão menos eficiente, se estiver conectando-se a um servidor que você sabe que tem a criptografia habilitada (embora nosso vncviewer o avisará com a mensagem "Conexão não criptografada!” nesse caso).
  </para>
 </sect1>
</chapter>
