<?xml version="1.0" encoding="UTF-8"?>
<sect1 xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="ay_registration_extensions.xml" version="5.0" xml:id="CreateProfile-Register">
 <title>System registration and extension selection</title>

 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:bugtracker/>
   <dm:translation>yes</dm:translation>
  </dm:docmanager>
 </info>

 <para>
  Registering the system with the registration server can be configured within
  the <literal>suse_register</literal> resource. The following example
  registers the system with the SUSE Customer Center. In case your organization provides its
  own registration server, you need to specify the required data with the
  <literal>reg_server*</literal> properties. Refer to the list below for
  details.
 </para>

<screen>&lt;suse_register&gt;
  &lt;do_registration config:type="boolean"&gt;true&lt;/do_registration&gt;
  &lt;email&gt;tux@example.com&lt;/email&gt;
  &lt;reg_code&gt;<replaceable>MY_SECRET_REGCODE</replaceable>&lt;/reg_code&gt;
  &lt;install_updates config:type="boolean"&gt;true&lt;/install_updates&gt;
  &lt;slp_discovery config:type="boolean"&gt;false&lt;/slp_discovery&gt;
  &lt;--! optionally register some add-ons --&gt;
  &lt;addons config:type="list"&gt;
    &lt;addon&gt;
      &lt;name&gt;sle-module-basesystem&lt;/name&gt;
      &lt;version&gt;15.4&lt;/version&gt;
      &lt;arch&gt;<replaceable>x86_64</replaceable>&lt;/arch&gt;
    &lt;/addon&gt;
  &lt;/addons&gt;
&lt;/suse_register&gt;
 </screen>

 <para>
  It is recommended to at least register the Basesystem Module to have access
  to the updates for the base system (the Linux kernel, the system libraries
  and services).
 </para>

 <para>
  As an alternative to the fully automated registration, AutoYaST can also be
  configured to start the YaST registration module during the installation.
  This offers the possibility to enter the registration data manually. The
  following XML code is required:
 </para>

<screen>&lt;general&gt;
 &lt;semi-automatic config:type="list"&gt;
   &lt;semi-automatic_entry&gt;scc&lt;/semi-automatic_entry&gt;
 &lt;/semi-automatic&gt;
&lt;/general&gt;</screen>

 

 <variablelist>
  <title><literal>suse_register Values</literal></title>
  <varlistentry>
   <term>do_registration</term>
   <listitem>
    <para>
     Boolean
    </para>
<screen>&lt;do_registration config:type="boolean"&gt;true&lt;/do_registration&gt;</screen>
    <para>
     Specify whether the system should be registered or not. If set to
     <literal>false</literal> all other options are ignored and the system is
     not registered.
    </para>
   </listitem>
  </varlistentry>
  <varlistentry>
   <term>e-mail</term>
   <listitem>
    <para>
     E-mail address
    </para>
<screen>&lt;email&gt;tux@example.com&lt;/email&gt;</screen>
    <para>
     Optional. The e-mail address matching the registration code.
    </para>
   </listitem>
  </varlistentry>
  <varlistentry>
   <term>reg_code</term>
   <listitem>
    <para>
     Text
    </para>
<screen>&lt;reg_code&gt;<replaceable>SECRET_REGCODE</replaceable>&lt;/reg_code&gt;</screen>
    <para>
     Required. Registration code.
    </para>
   </listitem>
  </varlistentry>
  <varlistentry>
   <term>install_updates</term>
   <listitem>
    <para>
     Boolean
    </para>
<screen>&lt;install_updates config:type="boolean"&gt;true&lt;/install_updates&gt;</screen>
    <para>
     Optional. Determines if updates from the Updates channels should be
     installed. The default value is to not install them
     (<literal>false</literal>).
    </para>
   </listitem>
  </varlistentry>
  <varlistentry>
   <term>slp_discovery</term>
   <listitem>
    <para>
     Boolean
    </para>
<screen>&lt;slp_discovery config:type="boolean"&gt;true&lt;/slp_discovery&gt;</screen>
    <para>
     Optional. Search for a registration server via SLP. The default value is
     <literal>false</literal>.
    </para>
    <para>
     Expects to find a single server. If more than one server is found, the
     installation will fail. In case there is more than one registration server
     available, you need to specify one with <literal>reg_server</literal>.
    </para>
    <para>
     If neither <literal>slp_discovery</literal> nor
     <literal>reg_server</literal> are set, the system is registered with the
     SUSE Customer Center.
    </para>
    <para>
     This setting also affects the self-update feature: If it is disabled, no
     SLP search will be performed.
    </para>
   </listitem>
  </varlistentry>
  <varlistentry>
   <term>reg_server</term>
   <listitem>
    <para>
     URL
    </para>
<screen>&lt;reg_server&gt;https://smt.example.com&lt;/reg_server&gt;</screen>
    <para>
     Optional. RMT server URL. If neither <literal>slp_discovery</literal>
     nor <literal>reg_server</literal> are set, the system is registered with
     the SUSE Customer Center.
    </para>
    <para>
     The RMT server is queried for a URL of the self-update repository. So if
     <literal>self_update_url</literal> is not set, the RMT server influences
     where the self-updates are downloaded from. Check the <citetitle>Deployment Guide</citetitle> to find
     further information about this feature.
    </para>
   </listitem>
  </varlistentry>
  <varlistentry>
   <term>reg_server_cert_fingerprint_type</term>
   <listitem>
    <para>
     <literal>SHA1</literal> or <literal>SHA256</literal>
    </para>
<screen>&lt;reg_server_cert_fingerprint_type&gt;SHA1&lt;/reg_server_cert_fingerprint_type&gt;</screen>
    <para>
     Optional. Requires a checksum value provided with
     <literal>reg_server_cert_fingerprint</literal>. Using the fingerprint is
     recommended, since it ensures the SSL certificate is verified. The
     matching certificate will be automatically imported when the SSL
     communication fails because of a verification error.
    </para>
   </listitem>
  </varlistentry>
  <varlistentry>
   <term>reg_server_cert_fingerprint</term>
   <listitem>
    <para>
     Server Certificate Fingerprint value in hexadecimal notion
     (case-insensitive).
    </para>
<screen>&lt;reg_server_cert_fingerprint&gt;<replaceable>01:AB...:EF</replaceable>&lt;/reg_server_cert_fingerprint&gt;</screen>
    <para>
     Optional. Requires a fingerprint type value provided with
     <literal>reg_server_cert_fingerprint_type</literal>. Using the fingerprint
     is recommended, since it ensures the SSL certificate is verified. The
     matching certificate will be automatically imported when SSL communication
     fails because of a verification error.
    </para>
   </listitem>
  </varlistentry>
  <varlistentry>
   <term>reg_server_cert</term>
   <listitem>
    <para>
     URL
    </para>
<screen>&lt;reg_server_cert&gt;http://smt.example.com/smt.crt&lt;/reg_server_cert&gt;</screen>
    <para>
     Optional. URL of the SSL certificate on the server. Using this option is
     not recommended, since the certificate that is downloaded is not verified.
     Use <literal>reg_server_cert_fingerprint</literal> instead.
    </para>
   </listitem>
  </varlistentry>
  <varlistentry>
   <term>addons</term>
   <listitem>
    <para>
     Add-ons list
    </para>
    
    <para os="slemicro">
     Specifies the kernel live patching extension from the registration server
     that should be added to the installation repositories. See
     <xref linkend="CreateProfile-Register-Extension"/> for details.
    </para>
   </listitem>
  </varlistentry>
 </variablelist>

 <tip>
  <title>Obtaining a server certificate fingerprint</title>
  <para>
   To obtain a server certificate fingerprint for use with the
   <literal>reg_server_cert_fingerprint</literal> entry, run the following
   command on the SMT server (edit the default path to the
   <filename>smt.crt</filename> file, if needed):
  </para>
<screen>openssl x509 -noout -in /srv/www/htdocs/smt.crt -fingerprint -sha256</screen>
  <para>
   To retrieve a fingerprint from the SMT server, use the following command:
  </para>
<screen>curl --insecure -v https://scc.suse.com/smt.crt 2&gt; /dev/null | openssl \
      x509 -noout -fingerprint -sha256</screen>
  <para>
   Replace <literal>scc.suse.com</literal> with your server.
  </para>
  <para>
   <emphasis>Note:</emphasis> This can be used in a trusted network only! In a
   non-trusted network, for example the Internet, you should get the
   fingerprint directly from the server by other means. Fingerprints can be
   fetched via SSH, a saved server configuration and other sources.
   Alternatively, you can verify that the downloaded certificate is identical
   on the server.
  </para>
 </tip>

 <sect2 xml:id="CreateProfile-Register-Extension">
  <title>Extensions</title>
  
  
  <para>
   With <command>SUSEConnect --list-extensions</command> you can list all
   available extensions in a registered system, and the commands to activate
   and disable them.
  </para>
  <para>
   The following example shows which extensions are already activated, and
   labels the extensions that require their own registration codes:
  </para>

<screen os="slemicro">
   AVAILABLE EXTENSIONS AND MODULES
   
   SUSE Linux Enterprise Live Patching 15 SP3 x86_64
   Activate with: transactional-update register -p sle-module-live-patching/15.3/x86_64 -r ADDITIONAL REGCODE
   
   [...] 
   </screen>
  <para>
   The <option>-p</option> argument (in the above example) displays the
   <replaceable>NAME/VERSION/ARCH</replaceable> values that can be used in the
   AutoYaST profile.
  </para>
  <para>
   The following example shows how to configure a list of extensions. These go
   in the <literal>suse_register</literal> block:
  </para>
<screen>&lt;suse_register&gt;
  &lt;do_registration config:type="boolean"&gt;true&lt;/do_registration&gt;
  &lt;email&gt;tux@example.com&lt;/email&gt;
  &lt;reg_code&gt;MY_SECRET_REGCODE&lt;/reg_code&gt;
  &lt;install_updates config:type="boolean"&gt;true&lt;/install_updates&gt;
  &lt;slp_discovery config:type="boolean"&gt;false&lt;/slp_discovery&gt;
  
  &lt;--! optionally register some add-ons --&gt;   
 &lt;addons config:type="list"&gt;
   &lt;addon&gt;
    &lt;!-- Development Tools Module --&gt;
    &lt;!-- Depends on: Desktop Applications Module --&gt;     
    &lt;name&gt;sle-module-development-tools&lt;/name&gt;
    &lt;version&gt;15.3&lt;/version&gt;
    &lt;arch&gt;x86_64&lt;/arch&gt;
   &lt;/addon&gt;
 
   &lt;addon&gt;
    &lt;!-- SUSE CaaS Platform (BETA) --&gt;
    &lt;!-- Depends on: Containers Module --&gt;
    &lt;name&gt;caasp&lt;/name&gt;
    &lt;version&gt;4.0&lt;/version&gt;
    &lt;arch&gt;x86_64&lt;/arch&gt;
    &lt;reg_code&gt;REG_CODE_REQUIRED&lt;/reg_code&gt;
   &lt;/addon&gt;

   &lt;addon&gt;
    &lt;!-- SUSE Enterprise Storage --&gt;
    &lt;!-- Depends on: Server Applications Module --&gt;
    &lt;name&gt;ses&lt;/name&gt;
    &lt;version&gt;6&lt;/version&gt;
    &lt;arch&gt;x86_64&lt;/arch&gt;
    &lt;reg_code&gt;REG_CODE_REQUIRED&lt;/reg_code&gt;
   &lt;/addon&gt;

   &lt;addon&gt;
    &lt;!-- SUSE Linux Enterprise High Availability Extension --&gt;
    &lt;!-- Depends on: Server Applications Module --&gt;
    &lt;name&gt;sle-ha&lt;/name&gt;
    &lt;version&gt;15.3&lt;/version&gt;
    &lt;arch&gt;x86_64&lt;/arch&gt;
    &lt;reg_code&gt;REG_CODE_REQUIRED&lt;/reg_code&gt;
   &lt;/addon&gt; 
 &lt;/addons&gt;
&lt;/suse_register&gt;</screen>
  <para>
   You may also see all available modules and extensions at
   <link xlink:href="https://scc.suse.com/packages"/>. Select your product and
   architecture, then click the In Module form to see a list of all extensions.
  </para>
  
 </sect2>
</sect1>
