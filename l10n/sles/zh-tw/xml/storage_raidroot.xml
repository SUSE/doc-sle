<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="storage_raidroot.xml" version="5.0" xml:id="cha-raidroot" xml:lang="zh-tw">
 <title>設定根分割區的軟體 RAID</title>
 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:bugtracker/>
   <dm:translation>yes</dm:translation>
  </dm:docmanager>
 </info>
 <para>
  在 <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> 中，裝置對應程式 RAID 工具已整合到 YaST 磁碟分割程式中。您可以在安裝時使用磁碟分割程式，為包含根 (<filename>/</filename>) 分割區的系統裝置建立一個軟體 RAID。不能將 <filename>/boot</filename> 分割區儲存在除 RAID 1 以外的 RAID 分割區上。
 </para>
 <sect1 xml:id="sec-raidroot-require">
  <title>
   將軟體 RAID 裝置用於根分割區的先決條件
  </title>

  <para>
   確保您的組態符合下列要求：
  </para>

  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>
     您需要兩個硬碟來建立 RAID 1 鏡像裝置。這兩個硬碟的大小應相似。RAID 假設為較小磁碟機的大小。區塊儲存裝置可以是本地 (機器中或直接連接到機器上)、光纖通道儲存子系統或 iSCSI 儲存子系統的任意組合。
    </para>
   </listitem>
   <listitem>
    <para>
     如果在 MBR 中安裝開機載入程式，則不需要為 <filename>/boot</filename> 建立獨立分割區。如果無法在 MBR 中安裝開機載入程式，則 <filename>/boot</filename> 需要位於獨立的分割區上。
    </para>
   </listitem>
   <listitem>
    <para>
     對於 UEFI 機器，需要設定專用的 <filename>/boot/efi</filename> 分割區。該分割區需格式化為 VFAT，可以位於 RAID 1 裝置上，以防止使用 <filename>/boot/efi</filename> 的實體磁碟發生故障時出現開機問題。
    </para>
   </listitem>
   <listitem>
    <para>
     如果您使用的是硬體 RAID 裝置，請不要嘗試在其上執行軟體 RAID。
    </para>
   </listitem>
   <listitem>
    <para>
     如果您使用的是 iSCSI 目標裝置，則需要先啟用 iSCSI 啟動器支援，然後再建立 RAID 裝置。
    </para>
   </listitem>
   <listitem>
    <para>
     如果儲存子系統在伺服器與要用於軟體 RAID 的裝置 (直接附加的本地裝置、光纖通道裝置或 iSCSI 裝置) 之間提供了多重 I/O 路徑，則需要先啟用多重路徑支援，然後才能建立 RAID 裝置。
    </para>
   </listitem>
  </itemizedlist>
 </sect1>
 <sect1 xml:id="sec-raidroot-setup">
  <title>
   為根 (<filename>/</filename>) 分割區設定具有軟體 RAID 裝置的系統
  </title>

  <procedure>
   <step>
    <para>
     使用 YaST 啟動安裝並依照<xref linkend="cha-install"/>所述操作，直到<guimenu>建議的分割方式</guimenu>步驟為止。
    </para>
   </step>
   <step>
    <para>
     按一下<guimenu>進階磁碟分割程式</guimenu>開啟該自訂分割工具。您可以使用建議的方案，也可以使用現有方案。 
    </para>
   </step>
   <step>
    <para>
     (選擇性) 如果有要使用的 iSCSI 目標裝置，則需要從螢幕左上方的區段中選擇<menuchoice><guimenu>系統</guimenu> 
     <guimenu>設定</guimenu> <guimenu>設定 iSCSI</guimenu>
     </menuchoice>，以啟用 iSCSI 啟動器軟體。如需更多詳細資料，請參閱<xref linkend="cha-iscsi"/>。 
    </para>
   </step>
   <step>
    <para>
     (選擇性) 如果有要使用的 FCoE 目標裝置，則需要按一下螢幕左上方區段中的<menuchoice><guimenu>系統</guimenu> 
     <guimenu>設定</guimenu> <guimenu>設定 FCoE</guimenu>
     </menuchoice> 來設定介面。 
    </para>
   </step>
   <step>
   	<para>
   	(選擇性) 如果您需要丟棄分割變更，請按一下<menuchoice><guimenu>系統</guimenu><guimenu>重新掃描裝置</guimenu></menuchoice>。 
   	</para>
   </step>
   
   
   

   <step>
    <para>
     為要用於軟體 RAID 的每台裝置設定 <guimenu> Linux RAID</guimenu> 格式。應該為 <filename>/</filename>、<filename>/boot/efi</filename> 或交換分割區使用 RAID。
    </para>
    <substeps performance="required">
     <step>
      <para>
       在左側面板中，選取<guimenu>硬碟</guimenu>，然後選取要使用的裝置，再按一下<guimenu>新增分割區</guimenu>。
      </para>
     </step>     
     <step>
      <para>
       在<guimenu>新分割區大小</guimenu>下，指定要使用的大小，然後按<guimenu>下一步</guimenu>。
      </para>
     </step>
     <step>
      <para>
       在<guimenu>角色</guimenu>下，選擇<guimenu>原始磁碟區 (未格式化)</guimenu>。
      </para>
     </step>
     <step>
      <para>
       選取<guimenu>不格式化</guimenu>和<guimenu>不掛接</guimenu>，並將<guimenu>分割區 ID</guimenu> 設定為 <guimenu>Linux RAID</guimenu>。
      </para>
     </step>
     <step>
      <para>
       按一下<guimenu>下一步</guimenu>，然後對第二個分割區重複這些指示。
      </para>
      <informalfigure>
       <mediaobject>
        <imageobject role="fo">
         <imagedata fileref="raid_yast_install2_a.png" width="80%"/>
        </imageobject>
        <imageobject role="html">
         <imagedata fileref="raid_yast_install2_a.png" width="100%"/>
        </imageobject>
       </mediaobject>
      </informalfigure>
     </step>
    </substeps>
   </step>
   <step>
    <para>
     為 <filename>/</filename> 分割區建立 RAID 裝置。
    </para>
    <substeps performance="required">
     <step>
      <para>
       在左側面板中，選取 <guimenu>RAID</guimenu>，然後選取<guimenu>新增 RAID</guimenu>。
      </para>
     </step>
     <step>
      <para>
       為 <filename>/</filename> 分割區設定所需的 <guimenu>RAID 類型</guimenu>，並將 <guimenu>RAID 名稱</guimenu>設為 <literal>system</literal>。
      </para>
     </step>
     <step>
      <para>
       從<guimenu>可用的裝置</guimenu>區段中選取您在上一步中準備的兩個 RAID 裝置，並<guimenu>新增</guimenu>它們。
      </para>
      <informalfigure>
       <mediaobject>
        <imageobject role="fo">
         <imagedata fileref="raid_yast_install3_a.png" width="80%"/>
        </imageobject>
        <imageobject role="html">
         <imagedata fileref="raid_yast_install3_a.png" width="100%"/>
        </imageobject>
       </mediaobject>
      </informalfigure>
      <para>
       按<guimenu>繼續</guimenu>以繼續。
      </para>
     </step>
     <step>
      <para>
       從下拉式方塊中選取區塊大小。保留預設值是安全的做法。
      </para>
     </step>
     <step>
     <para>
     	在左側面板中，按一下 <guimenu>RAID</guimenu>。在<guimenu>裝置綜覽</guimenu>索引標籤中，選取新 RAID 並按一下<guimenu>編輯</guimenu>。
     </para>
     <informalfigure>
       <mediaobject>
        <imageobject role="fo">
         <imagedata fileref="raid_yast_install_editraid.png" width="80%"/>
        </imageobject>
        <imageobject role="html">
         <imagedata fileref="raid_yast_install_editraid.png" width="100%"/>
        </imageobject>
       </mediaobject>
      </informalfigure>
     </step>
     <step>
      <para>
       在<guimenu>角色</guimenu>下選取<guimenu>作業系統</guimenu>，然後按一下<guimenu>下一步</guimenu>以繼續。
      </para>
     </step>
     <step>
      <para>
       選取<guimenu>檔案系統</guimenu>並將掛接點設為 <filename>/</filename>。按一下<filename>下一步</filename>結束該對話方塊。
      </para>
      <informalfigure>
       <mediaobject>
        <imageobject role="fo">
         <imagedata fileref="raid_yast_install_filesystem.png" width="80%"/>
        </imageobject>
        <imageobject role="html">
         <imagedata fileref="raid_yast_install_filesystem.png" width="100%"/>
        </imageobject>
       </mediaobject>
      </informalfigure>
     </step>

    </substeps>
   </step>
   <step>
    <para>
     該軟體 RAID 裝置便會受裝置對應程式的管理，並會在 <filename>/dev/md/system</filename> 路徑下建立一個裝置。
    </para>
   </step>
   <step>
   	<para>
   	 (選擇性) 您可以在 RAID 中建立交換分割區。使用與上述類似的步驟，只不過要在<guimenu>角色</guimenu>下選取<guimenu>交換</guimenu>。如下所示選取檔案系統和掛接點。按<guimenu>下一步</guimenu>。
   	</para>
   	<informalfigure>
       <mediaobject>
        <imageobject role="fo">
         <imagedata fileref="raid_yast_install_swap.png" width="80%"/>
        </imageobject>
        <imageobject role="html">
         <imagedata fileref="raid_yast_install_swap.png" width="100%"/>
        </imageobject>
       </mediaobject>
      </informalfigure>
   </step>
   <step>
    <para>
     (選擇性) 對於 UEFI 機器，請使用類似的步驟來建立 <filename>/boot/efi</filename> 掛接分割區。請記住，<filename>/boot/efi</filename> 僅支援 RAID 1，需要使用 FAT32 檔案系統來格式化該分割區。
    </para>
    <informalfigure>
       <mediaobject>
        <imageobject role="fo">
         <imagedata fileref="raid_yast_install_boot.png" width="80%"/>
        </imageobject>
        <imageobject role="html">
         <imagedata fileref="raid_yast_install_boot.png" width="100%"/>
        </imageobject>
       </mediaobject>
      </informalfigure>
      <para>分割如下所示：</para>
    <informalfigure>
      <mediaobject>
      <imageobject role="fo">
       <imagedata fileref="raid_yast_install3_b.png" width="70%"/>
      </imageobject>
      <imageobject role="html">
       <imagedata fileref="raid_yast_install3_b.png" width="70%"/>
      </imageobject>
     </mediaobject>
    </informalfigure>
   </step>
   <step>
    <para>
     按一下<guimenu>接受</guimenu>結束磁碟分割程式。
    </para>
    <para>
     新建議會出現在<guimenu>建議的分割方式</guimenu>頁面上。
    </para>
   </step>
   <step>
    <para>
     繼續安裝。對於包含獨立 <filename>/boot/efi</filename> 分割區的 UEFI 機器，請在<guimenu>安裝設定</guimenu>畫面上按一下<guimenu>開機</guimenu>，然後將<guimenu>開機載入程式</guimenu>設定為 <guimenu>GRUB2 for EFI</guimenu>。檢查<guimenu>啟用安全開機支援</guimenu>選項是否已啟用。
    </para>
    <para>
     每次將伺服器重新開機時，都會在開機時啟動裝置對應程式，以便讓系統能夠自動辨識軟體 RAID，並啟動根 (<literal>/</literal>) 分割區上的作業系統。
    </para>
   </step>
  </procedure>
 </sect1>
</chapter>
