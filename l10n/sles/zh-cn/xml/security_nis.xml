<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="security_nis.xml" version="5.0" xml:id="cha-nis">
 <title>使用 NIS</title>
 <info>
      <abstract>
        <para>
    当网络中的多个 Unix 系统都要访问公共资源时，所有用户和组身份对于该网络中的所有计算机而言是否相同就显得极其重要。网络应该对用户透明：不管用户实际正在使用哪台计算机，其环境都不应该有变化。可以通过 NIS 和 NFS 服务完成此操作。<phrase os="sles">NFS 通过网络分发文件系统，详细信息请参见<xref linkend="cha-nfs"/>。</phrase>
   </para>
        <para>
    NIS（网络信息服务）可以说是一种数据库式服务，用于跨网络访问 <filename>/etc/passwd</filename>、<filename>/etc/shadow</filename> 和 <filename>/etc/group</filename> 的内容。NIS 也可用于其他目的（如提供 <filename>/etc/hosts</filename> 或 <filename>/etc/services</filename> 之类文件的内容），但这里不作介绍。人们常把 NIS 称作 <emphasis>YP</emphasis>，也就是网络中的<quote>电话黄页</quote>。
        </para>
      </abstract>
      <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
        <dm:bugtracker>
        </dm:bugtracker>
	<dm:translation>yes</dm:translation>
      </dm:docmanager>
    </info>

 
 <sect1 xml:id="sec-nis-server" os="sles;osuse">
  <title>配置 NIS 服务器</title>

  <para>
   要想通过网络分发 NIS 信息，请安装一台服务器（<emphasis>主服务器</emphasis>）管理所有客户端，或者安装多台 NIS 从属服务器用于向主服务器请求此信息，然后将信息中继到各自的客户端。
  </para>

  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>
     要只为网络配置一台 NIS 服务器，请参见<xref linkend="sec-nis-server-master"/>继续操作。
    </para>
   </listitem>
   <listitem>
    <para>
     如果您的 NIS 主服务器需将其数据导出到从属服务器，请按<xref linkend="sec-nis-server-master"/>中所述设置主服务器，按<xref linkend="sec-nis-server-slave"/>中所述在子网中设置从属服务器。
    </para>
   </listitem>
  </itemizedlist>

  <sect2 xml:id="sec-nis-server-master">
   <title>配置 NIS 主服务器</title>
   <para>
    要使用 YaST 管理 NIS 服务器功能，请以 root 身份运行 <command>zypper in yast2-nis-server</command> 命令来安装 <systemitem class="resource">yast2-nis-server</systemitem> 软件包。要为网络配置 NIS 主服务器，请按如下所示继续：
   </para>
   <procedure>
    <step>
     <para>
      启动 <menuchoice> <guimenu>YaST</guimenu> <guimenu>网络服务</guimenu> <guimenu>NIS 服务器</guimenu> </menuchoice>.
     </para>
    </step>
    <step>
     <para>
      如果网络中只需要一台 NIS 服务器，或者此服务器将充当更低级别 NIS 从属服务器的主服务器，请选择<guimenu>安装并设置 NIS 主服务器</guimenu>。YaST 将安装需要的程序包。
     </para>
     <tip>
      <title>已安装的 NIS 服务器软件</title>
      <para>
       如果 NIS 服务器软件已安装在机器上，请通过单击<guimenu>创建 NIS 主服务器</guimenu>来创建 NIS 主服务器。
      </para>
     </tip>
     <figure xml:id="fig-inst-nisserver1">
      <title>NIS 服务器设置</title>
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="yast2_nis1_no_nis_installed.png" width="75%" format="PNG" os="sles;sled"/>
        
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="yast2_nis1_no_nis_installed.png" width="75%" format="PNG" os="sles;sled"/>
        
       </imageobject>
      </mediaobject>
     </figure>
    </step>
    <step>
     <para>
      确定基本 NIS 设置选项：
     </para>
     <substeps performance="required">
      <step>
       <para>
        输入 NIS 域名。
       </para>
      </step>
      <step>
       <para>
        通过选择<guimenu>这台主机也是一个 NIS 客户端</guimenu>，定义该主机是否也应该是 NIS 客户端（使用户能够从该 NIS 服务器登录并访问数据）。
       </para>
      </step>
      <step>
       <para>
        如果 NIS 服务器需要充当其他子网中的 NIS 从属服务器的主服务器，请选择<guimenu>活动的从属 NIS 服务器存在</guimenu>。
       </para>
       <para>
        <guimenu>快速映射分发</guimenu>选项只能与<guimenu>活动的从属 NIS 服务器存在</guimenu>搭配使用。它可以加速将映射传输到从属服务器的过程。
       </para>
      </step>
      <step>
       <para>
        选择<guimenu>允许更改口令</guimenu>以允许网络中的用户（本地用户和通过 NIS 服务器管理的用户）更改其在 NIS 服务器上的口令（使用命令 <command>yppasswd</command>）。这会相应激活<guimenu>允许更改 GECOS 字段</guimenu>和<guimenu>允许更改登录 Shell</guimenu> 选项。<quote>GECOS</quote>意味着用户还可以使用命令 <command>ypchfn</command> 更改其名称和地址设置。<quote>外壳</quote>允许用户使用命令 <command>ypchsh</command> 更改其默认外壳（例如从 Bash 切换到 sh）。新外壳必须是 <filename>/etc/shells</filename> 中预定义的其中一项。
       </para>
      </step>
      <step>
       <para>
        选择<guimenu>在防火墙中打开端口</guimenu>使 YaST 适应 NIS 服务器的防火墙设置。
       </para>
       <figure xml:id="fig-yast-nis-master">
        <title>主服务器设置</title>
        <mediaobject>
         <imageobject role="fo">
          <imagedata fileref="yast2_nis_master.png" width="75%" format="PNG" os="sles;sled"/>
          
         </imageobject>
         <imageobject role="html">
          <imagedata fileref="yast2_nis_master.png" width="75%" format="PNG" os="sles;sled"/>
          
         </imageobject>
        </mediaobject>
       </figure>
      </step>
      <step>
       <para>
        单击<guimenu>下一步</guimenu>退出此对话框，或单击<guimenu>其他全局设置</guimenu>进行其他设置。
       </para>
       <para>
        <guimenu>其他全局设置</guimenu>包括更改 NIS 服务器的源目录（默认为 <filename>/etc</filename>）。此外，也可以在此合并口令。该设置应设为<guimenu>是</guimenu>才能基于系统身份验证文件 <filename>/etc/passwd</filename>、<filename>/etc/shadow</filename> 和 <filename>/etc/group</filename> 创建用户数据库。此外，请确定 NIS 应提供的最小用户和组 ID。单击<guimenu>确定</guimenu>来确认设置并返回上一个屏幕。
       </para>
       <figure xml:id="fig-inst-nisserver2">
        <title>更改 NIS 服务器目录并同步文件</title>
        <mediaobject>
         <imageobject role="fo">
          <imagedata fileref="yast2_inst_nisserver2.png" width="75%" format="PNG" os="sles;sled"/>
          
         </imageobject>
         <imageobject role="html">
          <imagedata fileref="yast2_inst_nisserver2.png" width="75%" format="PNG" os="sles;sled"/>
          
         </imageobject>
        </mediaobject>
       </figure>
      </step>
     </substeps>
    </step>
    <step>
     <para>
      如果先前启用了<guimenu>存在活动的从属 NIS 服务器</guimenu>，则输入用作从属服务器的主机的名称，然后单击<guimenu>下一步</guimenu>。如果不存在任何从属服务器，将跳过此配置步骤。
     </para>
    </step>
    <step>
     <para>
      继续在对话框中进行数据库配置。指定 <emphasis>NIS 服务器映射</emphasis>，即要从 NIS 服务器传输至客户端的部分数据库。默认设置通常就足够了。选择<guimenu>下一步</guimenu>可退出此对话框。
     </para>
    </step>
    <step>
     <para>
      选择可用映射，然后单击<guimenu>下一步</guimenu>继续。
     </para>
     <figure xml:id="fig-yast-nis-maps">
      <title>NIS 服务器映射设置</title>
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="yast2_nis_maps.png" width="75%" format="PNG" os="sles;sled"/>
        
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="yast2_nis_maps.png" width="75%" format="PNG" os="sles;sled"/>
        
       </imageobject>
      </mediaobject>
     </figure>
    </step>
    <step>
     <para>
      确定可以查询 NIS 服务器的主机。可通过单击相应的按钮来添加、编辑或删除主机。指定可以向 NIS 服务器发送来自哪个网络的请求。通常为内部网络。在当前情况下，应有以下两项：
     </para>
<screen>255.0.0.0     127.0.0.0
0.0.0.0       0.0.0.0</screen>
     <para>
      第一项允许从您自己的主机（即 NIS 服务器）连接。第二项允许所有主机向服务器发送请求。
     </para>
     <figure xml:id="fig-inst-nisserver3">
      <title>为 NIS 服务器设置请求权限</title>
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="yast2_nis_hosts.png" width="75%" format="PNG" os="sles;sled"/>
        
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="yast2_nis_hosts.png" width="75%" format="PNG" os="sles;sled"/>
        
       </imageobject>
      </mediaobject>
     </figure>
    </step>
    <step>
     <para>
      单击<guimenu>完成</guimenu>以保存更改并退出设置。
     </para>
    </step>
   </procedure>
  </sect2>

  <sect2 xml:id="sec-nis-server-slave">
   <title>配置 NIS 从属服务器</title>
   <para>
    要在网络中配置其他 NIS <emphasis>从属服务器</emphasis>，请按如下所示继续：
   </para>
   <procedure>
    <step>
     <para>
      启动 <menuchoice> <guimenu>YaST</guimenu> <guimenu>网络服务</guimenu> <guimenu>NIS 服务器</guimenu> </menuchoice>.
     </para>
    </step>
    <step>
     <para>
      选择<guimenu>安装并设置 NIS 从属服务器</guimenu>，然后单击<guimenu>下一步</guimenu>。
     </para>
     <tip>
      <para>
       如果 NIS 服务器软件已安装在计算机上，则请通过单击<guimenu>创建 NIS 从属服务器</guimenu>来创建 NIS 从属服务器。
      </para>
     </tip>
    </step>
    <step>
     <para>
      完成 NIS 从属服务器的基本设置：
     </para>
     <substeps performance="required">
      <step>
       <para>
        输入 NIS 域。
       </para>
      </step>
      <step>
       <para>
        输入主服务器的主机名或 IP 地址。
       </para>
      </step>
      <step>
       <para>
        如果要允许用户登录此服务器，请设置<guimenu>这台主机也是一个 NIS 客户端</guimenu>。
       </para>
      </step>
      <step>
       <para>
        通过<guimenu>打开防火墙中的端口</guimenu>来调整防火墙设置。
       </para>
      </step>
      <step>
       <para>
        单击<guimenu>下一步</guimenu>。
       </para>
      </step>
     </substeps>
    </step>
    <step>
     <para>
      输入可以查询 NIS 服务器的主机。可通过单击相应的按钮来添加、编辑或删除主机。指定可从中向 NIS 服务器发送请求的所有网络。如果可从所有网络发送请求，请使用以下配置：
     </para>
<screen>255.0.0.0     127.0.0.0
0.0.0.0       0.0.0.0</screen>
     <para>
      第一项允许从您自己的主机（即 NIS 服务器）连接。第二项允许所有可访问同一网络的主机向服务器发送请求。
     </para>
    </step>
    <step>
     <para>
      单击<guimenu>完成</guimenu>，保存更改并退出设置。
     </para>
    </step>
   </procedure>
  </sect2>
 </sect1>
 <sect1 xml:id="sec-nis-client">
  <title>配置 NIS 客户端</title>

  <para>
   要在工作站上使用 NIS，请执行以下操作：
  </para>

  <procedure>
   <step>
    <para>
     启动 <menuchoice> <guimenu>YaST</guimenu> <guimenu>网络服务</guimenu> <guimenu>NIS 客户端</guimenu> </menuchoice>。
    </para>
   </step>
   <step>
    <para>
     激活<guimenu>使用 NIS</guimenu> 按钮。
    </para>
   </step>
   <step>
    <para>
     输入 NIS 域。这通常是由管理员指定的域名或 DHCP 收到的静态 IP 地址。<phrase os="sles;osuse">有关 DHCP 的信息，请参见<xref linkend="cha-dhcp"/>。</phrase>
    </para>
    <figure xml:id="fig-inst-nisclient">
     <title>设置 NIS 服务器的域和地址</title>
     <mediaobject>
      <imageobject role="fo">
       <imagedata fileref="yast2_inst_nisclient.png" width="75%" format="PNG"/>
      </imageobject>
      <imageobject role="html">
       <imagedata fileref="yast2_inst_nisclient.png" width="75%" format="PNG"/>
      </imageobject>
     </mediaobject>
    </figure>
   </step>
   <step>
    <para>
     输入您的 NIS 服务器并以空格分隔其地址。如果您不知道 NIS 服务器的地址，请单击<guimenu>查找</guimenu>让 YaST 搜索您域中的所有 NIS 服务器。根据本地网络的大小，此过程有可能会耗费很长时间。<guimenu>广播</guimenu>可在指定的服务器没有响应后，在本地网络中寻找 NIS 服务器。
    </para>
   </step>
   <step>
    <para>
     根据本地安装，您可能还想激活 automounter。如果需要，此选项还会安装其它软件。
    </para>
   </step>
   <step>
    <para>
     如果您不希望其他主机能够查询您的客户端正在使用的服务器，请转到<guimenu>专家</guimenu>设置并禁用<guimenu>回答远程主机</guimenu>。通过选中<guimenu>断开的服务器</guimenu>，客户端将能够接收通过非特权端口通讯的服务器的答复。有关进一步信息，请参见 <command>man</command><option>ypbind</option>。
    </para>
   </step>
   <step>
    <para>
     单击<guimenu>完成</guimenu>以保存配置并返回到 YaST 控制中心。现在，您的客户端上已配置好 NIS。
    </para>
   </step>
  </procedure>
 </sect1>
</chapter>
