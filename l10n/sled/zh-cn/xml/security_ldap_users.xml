<?xml version="1.0" encoding="UTF-8"?>
<sect1 xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="security_ldap_users.xml" version="5.0" xml:id="sec-security-ldap-server-users">
 <info>
  <title>管理 LDAP 用户和组</title>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:translation>yes</dm:translation>
  </dm:docmanager>
 </info>
 <para>
  使用 <command>dsidm</command> 命令创建、去除和管理用户与组。
 </para>

 <sect2 xml:id="sec-security-ldap-list-users-groups">
 <title>查询现有的 LDAP 用户和组</title>
 <para>
  以下示例演示如何列出现有的用户和组。这些示例使用实例名称 <replaceable>LDAP1</replaceable>。请将此名称替换为您的实例名称：
 </para>

<screen><prompt>&gt; </prompt><command>sudo</command> <command>dsidm <replaceable>LDAP1</replaceable> user list</command>
<prompt>&gt; </prompt><command>sudo</command> <command>dsidm <replaceable>LDAP1</replaceable> group list</command></screen>

 <para>
  列出有关单个用户的所有信息：
 </para>

<screen><prompt>&gt; </prompt><command>sudo</command> <command>dsidm <replaceable>LDAP1</replaceable> user get <replaceable>USER</replaceable></command></screen>

 <para>
  列出有关单个组的所有信息：
 </para>

<screen><prompt>&gt; </prompt><command>sudo</command> <command>dsidm <replaceable>LDAP1</replaceable> group get <replaceable>GROUP</replaceable></command></screen>

 <para>
  列出组的成员：
 </para>

<screen><prompt>&gt; </prompt><command>sudo</command> <command>dsidm <replaceable>LDAP1</replaceable> group members <replaceable>GROUP</replaceable></command></screen>
</sect2>

<sect2 xml:id="sec-security-ldap-create-users-passwords">
  <title>创建用户和管理口令</title>

 <para>
  在以下示例中，我们将创建一个用户，即 <systemitem class="username">wilber</systemitem>。示例服务器实例名为 <replaceable>LDAP1</replaceable>，该实例的后缀为 <replaceable>dc=LDAP1,dc=COM</replaceable>。
 </para>

 <procedure xml:id="pro-security-ldap-server-users">
  <title>创建 LDAP 用户</title>
  <para>
   以下示例在您的 389 DS 实例上创建用户 Wilber Fox：
  </para>
  <step>
<screen><prompt>&gt; </prompt><command>sudo</command> <command>dsidm <replaceable>LDAP1</replaceable> user create --uid wilber \</command>
  <command>--cn wilber --displayName 'Wilber Fox' --uidNumber 1001 --gidNumber 101 \</command>
 <command> --homeDirectory /home/wilber</command></screen>
  </step>
  <step>
   <para>
    通过查询新用户的<literal>distinguished name</literal>（目录对象的完全限定名称，能够确保唯一）进行校验：
   </para>
<screen><prompt>&gt; </prompt><command>sudo</command> <command>dsidm <replaceable>LDAP1</replaceable> user get wilber</command>
dn: <replaceable>uid=wilber,ou=people,dc=LDAP1,dc=COM</replaceable>
[...]</screen>
   <para>
    执行更改用户口令等操作时需要用到判别名。
   </para>
  </step>
  <step>
   <para>
    为新用户 <systemitem class="username">wilber</systemitem> 创建口令：
   </para>
   <substeps>
    <step>
<screen><prompt>&gt; </prompt><command>sudo</command> <command>dsidm <replaceable>LDAP1</replaceable> account reset_password \</command>
  <command>uid=<replaceable>wilber,ou=people,dc=LDAP1,dc=COM</replaceable></command></screen>
    </step>
    <step>
     <para>
      输入 <systemitem class="username">wilber</systemitem> 的新口令两次。
     </para>
     <para>
      如果操作成功，您将看到以下消息：
     </para>
<screen>
reset password for uid=<replaceable>wilber,ou=people,dc=LDAP1,dc=COM</replaceable>
</screen>
     <para>
      使用相同的命令更改现有口令。
     </para>
    </step>
   </substeps>
  </step>
  <step>
   <para>
    校验用户的口令是否有效：
   </para>
<screen>
<prompt>&gt; </prompt><command>ldapwhoami -D <replaceable>uid=wilber,ou=people,dc=LDAP1,dc=COM</replaceable> -W</command>
Enter LDAP Password: <replaceable>PASSWORD</replaceable>
dn: <replaceable>uid=wilber,ou=people,dc=LDAP1,dc=COM</replaceable>
    </screen>
  </step>
 </procedure>
</sect2>

<sect2 xml:id="sec-security-ldap-create-groups">
  <title>创建和管理组</title>
  <para>
    创建用户后，您可以创建组，然后将用户指派到这些组。在以下示例中，我们将创建 <replaceable>server_admins</replaceable> 组，并将 <systemitem class="username">wilber</systemitem> 用户指派到此组。示例服务器实例名为 <replaceable>LDAP1</replaceable>，该实例的后缀为 <replaceable>dc=LDAP1,dc=COM</replaceable>。
  </para>
 <procedure xml:id="pro-security-ldap-server-groups">
  <title>创建 LDAP 组并将用户指派到其中</title>
  <step>
   <para>
    创建组：
   </para>
<screen><prompt>&gt; </prompt><command>sudo</command> <command>dsidm <replaceable>LDAP1</replaceable> group create</command></screen>
   <para>
    系统会提示您输入组名。输入您选择的组名，在以下示例中为 <replaceable>SERVER_ADMINS</replaceable>：
   </para>
<screen>Enter value for cn : <replaceable>SERVER_ADMINS</replaceable></screen>
  </step>
  <step>
   <para>
     将用户 <systemitem class="username">wilber</systemitem>（在<xref linkend="pro-security-ldap-server-users"/>中创建）添加到组中：
   </para>
<screen>
<prompt>&gt; </prompt><command>sudo</command> <command>dsidm <replaceable>LDAP1</replaceable> group add_member <replaceable>SERVER_ADMINS</replaceable></command> \
<command>uid=wilber,<replaceable>ou=people,dc=LDAP1,dc=COM</replaceable></command>
added member: uid=<replaceable>wilber,ou=people,dc=LDAP1,dc=COM</replaceable></screen>
  </step>
 </procedure>
</sect2>

<sect2 xml:id="sec-security-ldap-delete-users-groups">
  <title>删除用户和组、从组中去除用户</title>
 <para>
   使用 <command>dsidm</command> 命令可以删除用户、从组中去除用户，以及删除组。以下示例从 server_admins 组中去除示例用户 wilber：
 </para>
 <screen><prompt>&gt; </prompt><command>sudo</command> <command>dsidm <replaceable>LDAP1</replaceable> group remove_member <replaceable>SERVER_ADMINS</replaceable></command> \
<command>uid=<replaceable>wilber,ou=people,dc=LDAP1,dc=COM</replaceable></command></screen>
 <para>
   删除用户：
 </para>
 <screen><prompt>&gt; </prompt><command>sudo</command> <command>dsidm <replaceable>LDAP1</replaceable> user delete</command> \
<command><replaceable>uid=wilber,ou=people,dc=LDAP1,dc=COM</replaceable></command></screen>
   <para>
     删除组:
   </para>
   <screen><prompt>&gt; </prompt><command>sudo</command> <command>dsidm <replaceable>LDAP1</replaceable> group delete <replaceable>SERVER_ADMINS</replaceable></command></screen>
</sect2>
</sect1>
