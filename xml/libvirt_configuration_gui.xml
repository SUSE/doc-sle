<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE chapter
[
  <!ENTITY % entities SYSTEM "entity-decl.ent">
    %entities;
]>

<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" version="5.0" xml:id="cha.libvirt.config_gui">
 <title>Configuring Virtual Machines with Virtual Machine Manager</title>
 <info>
  <abstract>
   <para>
    &vmm;'s <guimenu>Details</guimenu> view offers in-depth information
    about the &vmguest;'s complete configuration and hardware equipment.
    Using this view, you can also change the guest configuration or add and
    modify virtual hardware. To access this view, open the guest's console
    in &vmm; and either choose <menuchoice> <guimenu>View</guimenu>
    <guimenu>Details</guimenu> </menuchoice> from the menu, or click
    <guimenu>Show virtual hardware details</guimenu> in the toolbar.
   </para>
  </abstract>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:bugtracker></dm:bugtracker>
  </dm:docmanager>
 </info>
 <para/>
 <figure>
  <title><guimenu>Details</guimenu> View of a &vmguest;</title>
  <mediaobject>
   <imageobject role="fo">
    <imagedata fileref="libvirt_vmm_details.png" width="75%" format="PNG"/>
   </imageobject>
   <imageobject role="html">
    <imagedata fileref="libvirt_vmm_details.png" width="75%" format="PNG"/>
   </imageobject>
  </mediaobject>
 </figure>
 <para>
  The left panel of the window lists &vmguest; overview and already
  installed hardware. After clicking an item in the list, you can access its
  detailed settings in the details view. You can change the hardware
  parameters to match your needs, then click <guimenu>Apply</guimenu> to
  confirm them. Some changes take effect immediately, while others need a
  reboot of the machine&mdash;and <systemitem>virt-manager</systemitem>
  warns you about that fact.
 </para>
 <para>
  To remove installed hardware from a &vmguest;, select the appropriate list
  entry in the left panel and then click <guimenu>Remove</guimenu> in the
  bottom right of the window.
 </para>
 <para>
  To add new hardware, click <guimenu>Add Hardware</guimenu> below the left
  panel, then select the type of the hardware you want to add in the
  <guimenu>Add New Virtual Hardware</guimenu> window. Modify its parameters
  and confirm with <guimenu>Finish</guimenu>.
 </para>
 <para>
  The following sections describe configuration options for the specific
  hardware type <emphasis>being added</emphasis>. They do not focus on
  modifying an existing piece of hardware as the options are identical.
 </para>
 <sect1 xml:id="sec.libvirt.config.machine_setup">
  <title>Machine Setup</title>

  <para>
   This section describes the setup of the virtualized processor and memory
   hardware. These components are vital to a &vmguest;, therefore you cannot
   remove them. It also shows how to view the overview and performance
   information, and how to change boot parameters.
  </para>

  <sect2>
   <title>Overview</title>
   <para>
    <guimenu>Overview</guimenu> shows basic details about &vmguest; and the
    hypervisor.
   </para>
   <figure>
    <title>Overview details</title>
    <mediaobject>
     <imageobject role="fo">
      <imagedata fileref="libvirt_vmm_overview.png" width="70%" format="PNG"/>
     </imageobject>
     <imageobject role="html">
      <imagedata fileref="libvirt_vmm_overview.png" width="70%" format="PNG"/>
     </imageobject>
    </mediaobject>
   </figure>
   <para>
    <guimenu>Name</guimenu>, <guimenu>Title</guimenu>, and
    <guimenu>Description</guimenu> are editable and help you identify
    &vmguest; in the <guimenu>Virtual Machine Manager</guimenu> list of
    machines.
   </para>
   <figure>
    <title>&vmguest; Title and Description</title>
    <mediaobject>
     <imageobject role="fo">
      <imagedata fileref="libvirt_vmm_desc.png" width="40%" format="PNG"/>
     </imageobject>
     <imageobject role="html">
      <imagedata fileref="libvirt_vmm_desc.png" width="40%" format="PNG"/>
     </imageobject>
    </mediaobject>
   </figure>
   <para>
    <guimenu>UUID</guimenu> shows the universally unique identifier of the
    virtual machine, while <guimenu>Status</guimenu> shows its current
    status&mdash;<guimenu>Running</guimenu>, <guimenu>Paused</guimenu>, or
    <guimenu>Shutoff</guimenu>.
   </para>
   <para>
    The <guimenu>Hypervisor Details</guimenu> section shows the hypervisor
    type, CPU architecture, used emulator, and chipset type. None of the
    hypervisor parameters can be changed.
   </para>
  </sect2>

  <sect2>
   <title>Performance</title>
   <para>
    <guimenu>Performance</guimenu> shows regularly updated charts of CPU and
    memory usage, and disk and network I/O.
   </para>
   <figure>
    <title>Performance</title>
    <mediaobject>
     <imageobject role="fo">
      <imagedata fileref="libvirt_vmm_performance.png" width="70%" format="PNG"/>
     </imageobject>
     <imageobject role="html">
      <imagedata fileref="libvirt_vmm_performance.png" width="70%" format="PNG"/>
     </imageobject>
    </mediaobject>
   </figure>
   <tip>
    <title>Enabling Disabled Charts</title>
    <para>
     Not all the charts in the <guimenu>Graph</guimenu> view are
     enabled by default. To enable these charts, go to
     <menuchoice><guimenu>File</guimenu><guimenu>View
     Manager</guimenu></menuchoice>, then select
     <menuchoice><guimenu>Edit</guimenu><guimenu>Preferences</guimenu>
     <guimenu>Polling</guimenu></menuchoice>, and check the
     charts that you want to see regularly updated.
    </para>
   </tip>
   <figure>
    <title>Statistics Charts</title>
    <mediaobject>
     <imageobject role="fo">
      <imagedata fileref="libvirt_vmm_polling_charts.png" width="40%" format="PNG"/>
     </imageobject>
     <imageobject role="html">
      <imagedata fileref="libvirt_vmm_polling_charts.png" width="40%" format="PNG"/>
     </imageobject>
    </mediaobject>
   </figure>
  </sect2>

  <sect2>
   <title>Processor</title>
   <para>
    <guimenu>Processor</guimenu> includes detailed information about
    &vmguest; processor configuration.
   </para>
   <figure>
    <title>Processor View</title>
    <mediaobject>
     <imageobject role="fo">
      <imagedata fileref="libvirt_vmm_processor.png" width="70%" format="PNG"/>
     </imageobject>
     <imageobject role="html">
      <imagedata fileref="libvirt_vmm_processor.png" width="70%" format="PNG"/>
     </imageobject>
    </mediaobject>
   </figure>
   <para>
    In the <guimenu>CPUs</guimenu> section, you can configure several
    parameters related to the number of allocated CPUs.
   </para>
   <variablelist>
    <varlistentry>
     <term><guimenu>Logical host CPUs</guimenu>
     </term>
     <listitem>
      <para>
       The real number of CPUs installed on &vmhost;.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><guimenu>Current allocation</guimenu>
     </term>
     <listitem>
      <para>
       The number of currently allocated CPUs. You can hotplug more CPUs by
       increasing this value up to the <guimenu>Maximum allocation</guimenu>
       value.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><guimenu>Maximum allocation</guimenu>
     </term>
     <listitem>
      <para>
       Maximum number of allocable CPUs for the current session. Any change
       to this value will take effect after the next &vmguest; reboot.
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
   <para>
    The <guimenu>Configuration</guimenu> section lets you configure the CPU
    model and topology.
   </para>
   <para>
    When activated, the <guimenu>Copy host CPU configuration</guimenu>
    option uses the host CPU model for &vmguest;. Otherwise you need to
    specify the CPU model from the drop-down box.
   </para>
   <para>
    After you activate <guimenu>Manually set CPU topology</guimenu>, you can
    specify a custom number of sockets, cores and threads for the CPU.
   </para>
  </sect2>

  <sect2>
   <title>Memory</title>
   <para>
    <guimenu>Memory</guimenu> contains information about the memory that is
    available to &vmguest;.
   </para>
   <figure>
    <title>Memory View</title>
    <mediaobject>
     <imageobject role="fo">
      <imagedata fileref="libvirt_vmm_memory.png" width="70%" format="PNG"/>
     </imageobject>
     <imageobject role="html">
      <imagedata fileref="libvirt_vmm_memory.png" width="70%" format="PNG"/>
     </imageobject>
    </mediaobject>
   </figure>
   <variablelist>
    <varlistentry>
     <term><guimenu>Total host memory</guimenu>
     </term>
     <listitem>
      <para>
       Total amount of memory installed on &vmhost;.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><guimenu>Current allocation</guimenu>
     </term>
     <listitem>
      <para>
       The amount of memory currently available to &vmguest;. You can
       hotplug more memory by increasing this value up to the value of
       <guimenu>Maximum allocation</guimenu>.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><guimenu>Maximum allocation</guimenu>
     </term>
     <listitem>
      <para>
       The maximum value to which you can hotplug the currently available
       memory. Any change to this value will take effect after the next
       &vmguest; reboot.
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
  </sect2>

  <sect2>
   <title>Boot Options</title>
   <para>
    <guimenu>Boot Options</guimenu> introduces options affecting the
    &vmguest; boot process.
   </para>
   <figure>
    <title>Boot Options</title>
    <mediaobject>
     <imageobject role="fo">
      <imagedata fileref="libvirt_vmm_boot.png" width="70%" format="PNG"/>
     </imageobject>
     <imageobject role="html">
      <imagedata fileref="libvirt_vmm_boot.png" width="70%" format="PNG"/>
     </imageobject>
    </mediaobject>
   </figure>
   <para>
    In the <guimenu>Autostart</guimenu> section, you can specify whether the
    virtual machine should automatically start during the &vmhost; boot phase.
   </para>
   <para>
    In the <guimenu>Boot device order</guimenu>, activate the devices that
    will be used for booting &vmguest;. You can change their order with the
    up and down arrow buttons on the right side of the list. To choose
    from a list of bootable devices on &vmguest; start, activate
    <guimenu>Enable boot menu</guimenu>.
   </para>
   <para>
    To boot a different kernel than the one on the boot device, activate
    <guimenu>Enable direct kernel boot</guimenu> and specify the paths to the
    alternative kernel and initrd placed on the &vmhost; file system. You
    can also specify kernel arguments that will be passed to the loaded
    kernel.
   </para>
  </sect2>
 </sect1>
 <sect1 xml:id="sec.libvirt.config.storage">
  <title>Storage</title>

  <para>
   This section gives you a detailed description of configuration options for
   storage devices. It includes both hard disks and removable media, such as
   USB or CD-ROM drives.
  </para>

  <procedure>
   <title>Adding a New Storage Device</title>
   <step>
    <para>
     Click <guimenu>Add Hardware</guimenu> below the left panel, then select
     <guimenu>Storage</guimenu> from the <guimenu>Add New Virtual
     Hardware</guimenu> window.
    </para>
    <figure>
     <title>Add a New Storage</title>
     <mediaobject>
      <imageobject role="fo">
       <imagedata fileref="libvirt_vmm_storage1.png" width="70%" format="PNG"/>
      </imageobject>
      <imageobject role="html">
       <imagedata fileref="libvirt_vmm_storage1.png" width="70%" format="PNG"/>
      </imageobject>
     </mediaobject>
    </figure>
   </step>
   <step>
    <para>
     To create a <literal>qcow2</literal> disk image in the default location,
     activate <guimenu>Create a disk image for the virtual
     machine</guimenu> and specify its size in gigabytes.
    </para>
    <para>
     To gain more control over the disk image creation, activate
     <guimenu>Select or create custom storage</guimenu> and click
     <guimenu>Manage</guimenu> to manage storage pools and images.
     The window <guimenu>Choose Storage Volume</guimenu> opens which has almost
     identical functionality as the <guimenu>Storage</guimenu> tab
     described in <xref linkend="sec.libvirt.storage.vmm"/>.
    </para>
    <tip>
     <title>Supported Storage Formats</title>
     <para>
      &suse; only supports the following storage formats:
      <literal>raw</literal>, <literal>qcow2</literal>, and
      <literal>qed</literal>.
     </para>
    </tip>
   </step>
   <step>
    <para>
     After you manage to create and specify the disk image file, specify the
     <guimenu>Device type</guimenu>. It can be one of the following options:
    </para>
    <itemizedlist>
     <listitem>
      <para>
       <guimenu>Disk device</guimenu>
      </para>
     </listitem>
     <listitem>
      <para>
       <guimenu>CDROM device</guimenu>: Does not allow using <guimenu>Create a
       disk image for the virtual machine</guimenu>.
      </para>
     </listitem>
     <listitem>
      <para>
       <guimenu>Floppy device</guimenu>: Does not allow using <guimenu>Create a
       disk image for the virtual machine</guimenu>.
      </para>
     </listitem>
     <listitem>
      <para>
       <guimenu>LUN Passthrough</guimenu>: Required to use an existing SCSI
       storage directly without adding it into a storage pool.
      </para>
     </listitem>
    </itemizedlist>
   </step>
   <step>
    <para>
     Select the <guimenu>Bus type</guimenu> for your device. The list of
     available options depends on the device type you selected in the
     previous step. The types based on <guimenu>VirtIO</guimenu> use
     paravirtualized drivers.
    </para>
   </step>
   <step>
    <para>
     In the <guimenu>Advanced options</guimenu> section, select the
     preferred <guimenu>Cache mode</guimenu>. For more information on cache
     modes, see <xref linkend="cha.cachemodes"/>.
    </para>
   </step>
   <step>
    <para>
     Confirm your settings with <guimenu>Finish</guimenu>. A new storage
     device appears in the left panel.
    </para>
   </step>
  </procedure>
 </sect1>
 <sect1 xml:id="sec.libvirt.config.controllers">
  <title>Controllers</title>

  <para>
   This section focuses on adding and configuring new controllers.
  </para>

  <procedure>
   <title>Adding a New Controller</title>
   <step>
    <para>
     Click <guimenu>Add Hardware</guimenu> below the left panel, then select
     <guimenu>Controller</guimenu> from the <guimenu>Add New Virtual
     Hardware</guimenu> window.
    </para>
    <figure>
     <title>Add a New Controller</title>
     <mediaobject>
      <imageobject role="fo">
       <imagedata fileref="libvirt_vmm_controller.png" width="70%" format="PNG"/>
      </imageobject>
      <imageobject role="html">
       <imagedata fileref="libvirt_vmm_controller.png" width="70%" format="PNG"/>
      </imageobject>
     </mediaobject>
    </figure>
   </step>
   <step>
    <para>
     Select the type of the controller. You can choose from
     <guimenu>IDE</guimenu>, <guimenu>Floppy</guimenu>,
     <guimenu>SCSI</guimenu>, <guimenu>SATA</guimenu>, <guimenu>VirtIO
     Serial</guimenu> (paravirtualized), <guimenu>USB</guimenu>, or
     <guimenu>CCID</guimenu> (smart card devices).
    </para>
   </step>
   <step>
    <para>
     Optionally, in the case of a USB or SCSI controller, select a controller
     model.
    </para>
   </step>
   <step>
    <para>
     Confirm your settings with <guimenu>Finish</guimenu>. A new controller
     appears in the left panel.
    </para>
   </step>
  </procedure>
 </sect1>
 <sect1 xml:id="sec.libvirt.config.networking">
  <title>Networking</title>

  <para>
   This section describes how to add and configure new network devices.
  </para>

  <procedure>
   <title>Adding a New Network Device</title>
   <step>
    <para>
     Click <guimenu>Add Hardware</guimenu> below the left panel, then select
     <guimenu>Network</guimenu> from the <guimenu>Add New Virtual
     Hardware</guimenu> window.
    </para>
    <figure>
     <title>Add a New Controller</title>
     <mediaobject>
      <imageobject role="fo">
       <imagedata fileref="libvirt_vmm_network.png" width="70%" format="PNG"/>
      </imageobject>
      <imageobject role="html">
       <imagedata fileref="libvirt_vmm_network.png" width="70%" format="PNG"/>
      </imageobject>
     </mediaobject>
    </figure>
   </step>
   <step>
    <para>
     From the <guimenu>Network source</guimenu> list, select the source for
     the network connection. The list includes &vmhost;'s available physical
     network interfaces, network bridges, or network bonds. You can also
     assign the &vmguest; to an already defined virtual network. See
     <xref linkend="cha.libvirt.networks"/> for more information on setting
     up virtual networks with &vmm;.
    </para>
   </step>
   <step>
    <para>
     Specify a <guimenu>MAC address</guimenu> for the network device. While
     &vmm; pre-fills a random value for your convenience, it is recommended
     to supply a MAC address appropriate for your network environment to
     avoid network conflicts.
    </para>
   </step>
   <step>
    <para>
     Select a device model from the list. You can either leave the
     <guimenu>Hypervisor default</guimenu>, or specify one of
     <guimenu>e1000</guimenu>,
     <guimenu>rtl8139</guimenu>, or <guimenu>virtio</guimenu> models. Note
     that <emphasis>virtio</emphasis> uses paravirtualized drivers.
    </para>
   </step>
   <step>
    <para>
     Confirm your settings with <guimenu>Finish</guimenu>. A new network
     device appears in the left panel.
    </para>
   </step>
  </procedure>
 </sect1>
 
 <sect1 xml:id="sec.libvirt.config.input">
  <title>Input Devices</title>
	<para>
		This section focuses on adding and configuring new input devices such as Mouse, Keyboard or Tablet.
	</para>
  <procedure>
   <title>Adding a New Input Device</title>
   <step>
    <para>
     Click <guimenu>Add Hardware</guimenu> below the left panel, then select
     <guimenu>Input</guimenu> from the <guimenu>Add New Virtual
     Hardware</guimenu> window.
    </para>
    <figure>
     <title>Add a New Input Device</title>
     <mediaobject>
      <imageobject role="fo">
       <imagedata fileref="libvirt_vmm_input.png" width="70%" format="PNG"/>
      </imageobject>
      <imageobject role="html">
       <imagedata fileref="libvirt_vmm_input.png" width="70%" format="PNG"/>
      </imageobject>
     </mediaobject>
    </figure>
   </step>
   <step>
    <para>
     Select a device type from the list.
    </para>
   </step>
   <step>
    <para>
     Confirm your settings with <guimenu>Finish</guimenu>. A new input
     device appears in the left panel.
    </para>
   </step>
  </procedure>

  <para>
   Adding a tablet has the additional advantage of synchronizing the mouse
   pointer movement between &vmhost; and &vmguest; when using a graphical
   environment on the guest. When you click within a &vmguest;'s console with the mouse, 
   the pointer is captured by the console window and cannot be used outside the console
   unless it is explicitly released (by pressing <keycombo>
   <keycap function="alt"/> <keycap function="control"/> </keycombo>).
   With no tablet configured on the guest, you
   will often see two pointers with one dragging behind the other.
  </para>

 </sect1>

 <sect1 xml:id="sec.libvirt.config.video">
  <title>Video</title>

  <para>
    This section describes how to add and configure new video devices.
  </para>
    <procedure>
      <title>Adding a Video device</title>
      <step>
        <para>
          Click <guimenu>Add Hardware</guimenu> below the left panel, then select
          <guimenu>Video</guimenu> from the <guimenu>Add New Virtual
          Hardware</guimenu> window. 
        </para>
      </step>
      <step>
      <figure>
      <title>Add a New Video Device</title>
      <mediaobject>
        <imageobject role="fo">
        <imagedata fileref="libvirt_vmm_video.png" width="70%" format="PNG"/>
        </imageobject>
        <imageobject role="html">
        <imagedata fileref="libvirt_vmm_video.png" width="70%" format="PNG"/>
        </imageobject>
      </mediaobject>
      </figure>
      </step>
      <step>
        <para>
        Select a model from the list. You can choose from:</para>
          <itemizedlist>
            <listitem>
              <para>Cirrus</para>
            </listitem>
            <listitem>
              <para>QXL</para>
            </listitem>
            <listitem>
              <para>VGA</para>
            </listitem>
            <listitem>
              <para>Virtio</para>
            </listitem>
            <listitem>
              <para>VMVGA</para>
            </listitem>
            <listitem>
              <para>Xen</para>
            </listitem>
          </itemizedlist>
          <tip>
            <title>Notes about secondary video devices</title>
            <para>
              Only <guimenu>QXL</guimenu> and <guimenu>Virtio</guimenu> can be added as secondary video device.
            </para>
          </tip>
      </step>
   <step>
    <para>
     Confirm your settings with <guimenu>Finish</guimenu>. A new video device appears in the left panel.
    </para>
   </step>
    </procedure>

 </sect1>

 <sect1 xml:id="sec.libvirt.config.usb_redirectors">
  <title>USB Redirectors</title>

  <para>
  USB devices, which are connected to the client machine can be redirected to the VM Guest by using <guimenu>USB Redirectors</guimenu>.
  </para>

  <para>
   To add a USB Redirector to your &vmguest;, proceed as follows:
  </para>

  <procedure>
   <title>Adding a USB Redirector</title>
   <step>
    <para>
     Click <guimenu>Add Hardware</guimenu> below the left panel, then select
     <guimenu>USB Redirection</guimenu> from the <guimenu>Add New Virtual
     Hardware</guimenu> window.
    </para>
    <figure>
     <title>Add a New USB Redirector</title>
     <mediaobject>
      <imageobject role="fo">
       <imagedata fileref="libvirt_vmm_usb_redirector.png" width="70%" format="PNG"/>
      </imageobject>
      <imageobject role="html">
       <imagedata fileref="libvirt_vmm_usb_redirector.png" width="70%" format="PNG"/>
      </imageobject>
     </mediaobject>
    </figure>
   </step>
   <step>
    <para>
     Select a device type from the list. You can either choose a <guimenu>Spice channel</guimenu>
     or a <guimenu>TCP</guimenu> redirector.
    </para>
   </step>
   <step>
    <para>
     Confirm your settings with <guimenu>Finish</guimenu>. A new USB redirector appears in the left panel.
    </para>
   </step>
  </procedure>

 </sect1>

 <sect1 xml:id="sec.libvirt.config.miscellaneous">
  <title>Miscellaneous</title>

  <variablelist>
    <varlistentry>
      <term>Smartcard</term>
      <listitem>
      <para>  
        Smartcard functionality can be added via the <guimenu>Smartcard</guimenu> element.
        A physical USB smartcard reader can then be passed through to the VM Guest.
      </para>
      </listitem>
    </varlistentry>
  
    <varlistentry>
      <term>Watchdog</term>
      <listitem>
      <para>
        Virtual Watchdog devices are also supported. They can be created via the <guimenu>Watchdog</guimenu> 
        element. The model as well as the action of the device can be specified.
      </para>
        <tip>
          <title>Note on virtual Watchdog devices</title>
          <para>
            Please note that a virtual watchdog device requires a specific driver and daemon installed in the VM Guest.
            Otherwise the virtual Watchdog device does not work.
          </para>
        </tip>
      </listitem>
    </varlistentry>

    <varlistentry>
      <term>TPM</term>
      <listitem>
      <para>
        You can use the Host TPM device in the VM Guest by adding TPM functionality via the <guimenu>TPM</guimenu>
        element.</para>
        <tip>
          <title>Note on virtual TPMs</title>
          <para>
          Please note that the Host TPM can only be used in one VM Guest at a time.
          </para>
        </tip>
      </listitem>
    </varlistentry>
  </variablelist>
 </sect1>
 
 <sect1 xml:id="sec.libvirt.config.cdrom" condition="kvm4x86">
  <title>Adding a CD/DVD-ROM Device with &vmm;</title>

  <para>
   &kvm; supports CD or DVD-ROMs in &vmguest; either by directly accessing a
   physical drive on the &vmhost; or by accessing ISO images. To create an
   ISO image from an existing CD or DVD, use <command>dd</command>:
  </para>

<screen>&prompt.sudo;dd if=/dev/<replaceable>CD_DVD_DEVICE</replaceable> of=my_distro.iso bs=2048</screen>

  <para>
   To add a CD/DVD-ROM device to your &vmguest;, proceed as follows:
  </para>

  <procedure>
   <step>
    <para>
     Double-click a &vmguest; entry in the &vmm; to open its console and
     switch to the <guimenu>Details</guimenu> view with <menuchoice>
     <guimenu>View</guimenu> <guimenu>Details</guimenu> </menuchoice>.
    </para>
   </step>
   <step>
    <para>
     Click <guimenu>Add Hardware</guimenu> and choose
     <guimenu>Storage</guimenu> in the pop-up window.
    </para>
   </step>
   <step>
    <para>
     Change the <guimenu>Device Type</guimenu> to <guimenu>IDE
     CDROM</guimenu>.
    </para>
   </step>
   <step>
    <para>
     Select <guimenu>Select or create custom storage</guimenu>.
    </para>
    <substeps performance="required">
     <step>
      <para>
       To assign the device to a physical medium, enter the path to the
       &vmhost;'s CD/DVD-ROM device (for example,
       <filename>/dev/cdrom</filename>) next to
       <guimenu>Manage</guimenu>. Alternatively, use
       <guimenu>Manage</guimenu> to open a file browser and then
       click <guimenu>Browse Local</guimenu> to select the device. Assigning
       the device to a physical medium is only possible when the &vmm; was
       started on the &vmhost;.
      </para>
     </step>
     <step>
      <para>
       To assign the device to an existing image, click
       <guimenu>Manage</guimenu> to choose an image from a storage pool. If
       the &vmm; was started on the &vmhost;, alternatively choose
       an image from another location on the file system by clicking
       <guimenu>Browse Local</guimenu>. Select an image and close the file
       browser with <guimenu>Choose Volume</guimenu>.
      </para>
     </step>
    </substeps>
   </step>
   <step>
    <para>
     Save the new virtualized device with <guimenu>Finish</guimenu>.
    </para>
   </step>
   <step>
    <para>
     Reboot the &vmguest; to make the new device
     available.<phrase condition="kvm4x86"> For more information, see
     <xref linkend="sec.libvirt.config.cdrom.media_change"/>.</phrase>
    </para>
   </step>
  </procedure>
 </sect1>
 <sect1 xml:id="sec.libvirt.config.floppy" condition="kvm4x86">
  <title>Adding a Floppy Device with &vmm;</title>

  <para>
   Currently &kvm; only supports the use of floppy disk images&mdash;using a
   physical floppy drive is not supported. Create a floppy disk image from
   an existing floppy using <command>dd</command>:
  </para>

<screen>&prompt.sudo;dd if=/dev/fd0 of=/var/lib/libvirt/images/floppy.img</screen>

  <para>
   To create an empty floppy disk image use one of the following commands:
  </para>

  <variablelist>
   <varlistentry>
    <term>Raw Image</term>
    <listitem>
<screen>&prompt.sudo;dd if=/dev/zero of=/var/lib/libvirt/images/floppy.img bs=512 count=2880</screen>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>FAT Formatted Image</term>
    <listitem>
<screen>&prompt.sudo;mkfs.msdos -C /var/lib/libvirt/images/floppy.img 1440</screen>
    </listitem>
   </varlistentry>
  </variablelist>

  <para>
   To add a floppy device to your &vmguest;, proceed as follows:
  </para>

  <procedure>
   <step>
    <para>
     Double-click a &vmguest; entry in the &vmm; to open its console and
     switch to the <guimenu>Details</guimenu> view with <menuchoice>
     <guimenu>View</guimenu> <guimenu>Details</guimenu> </menuchoice>.
    </para>
   </step>
   <step>
    <para>
     Click <guimenu>Add Hardware</guimenu> and choose
     <guimenu>Storage</guimenu> in the pop-up window.
    </para>
   </step>
   <step>
    <para>
     Change the <guimenu>Device Type</guimenu> to <guimenu>Floppy
     Disk</guimenu>.
    </para>
   </step>
   <step>
    <para>
     Choose <guimenu>Select or create custom storage</guimenu> and
     click <guimenu>Manage</guimenu> to choose an existing image from a
     storage pool. If &vmm; was started on the &vmhost;,
     alternatively choose an image from another location on the file system
     by clicking <guimenu>Browse Local</guimenu>. Select an image and close
     the file browser with <guimenu>Choose Volume</guimenu>.
    </para>
   </step>
   <step>
    <para>
     Save the new virtualized device with <guimenu>Finish</guimenu>.
    </para>
   </step>
   <step>
    <para>
     Reboot the &vmguest; to make the new device
     available.<phrase condition="kvm4x86"> For more information, see
     <xref linkend="sec.libvirt.config.cdrom.media_change"/>.</phrase>
    </para>
   </step>
  </procedure>
 </sect1>
 <sect1 xml:id="sec.libvirt.config.cdrom.media_change" condition="kvm4x86">
  <title>Ejecting and Changing Floppy or CD/DVD-ROM Media with &vmm;</title>

  <para>
   Whether you are using the &vmhost;'s physical CD/DVD-ROM
   device or an ISO/floppy image: Before you can change the media or image
   of an existing device in the &vmguest;, you first need to
   <literal>disconnect</literal> the media from the guest.
  </para>

  <procedure>
   <step>
    <para>
     Double-click a &vmguest; entry in the &vmm; to open its console and
     switch to the <guimenu>Details</guimenu> view with <menuchoice>
     <guimenu>View</guimenu> <guimenu>Details</guimenu> </menuchoice>.
    </para>
   </step>
   <step>
    <para>
     Choose the Floppy or CD/DVD-ROM device and <quote>eject</quote> the
     medium by clicking <guimenu>Disconnect</guimenu>.
    </para>
   </step>
   <step>
    <para>
     To <quote>insert</quote> a new medium, click <guimenu>Connect</guimenu>.
    </para>
    <substeps performance="required">
     <step>
      <para>
       If using the &vmhost;'s physical CD/DVD-ROM device, first change the
       media in the device (this may require unmounting it on the &vmhost;
       before it can be ejected). Then choose <guimenu>CD-ROM or
       DVD</guimenu> and select the device from the drop-down box.
      </para>
     </step>
     <step>
      <para>
       If you are using an ISO image, choose <guimenu>ISO image
       Location</guimenu> and select an image by clicking
       <guimenu>Manage</guimenu>. When connecting from a remote host, you may
       only choose images from existing storage pools.
      </para>
     </step>
    </substeps>
   </step>
   <step>
    <para>
     Click <guimenu>OK</guimenu> to finish. The new media can now be
     accessed in the &vmguest;.
    </para>
   </step>
  </procedure>
 </sect1>
 
 <sect1 xml:id="sec.libvirt.config.pci">
  <title>Assigning a Host PCI Device to a &vmguest;</title>

  <para>
   You can directly assign host-PCI devices to guests (PCI pass-through).
   When the PCI device is assigned to one &vmguest;, it cannot be used on
   the host or by another &vmguest; unless it is re-assigned. A prerequisite for
   this feature is a &vmhost; configuration as described in
   <xref linkend="ann.vt.io.require"/>.
  </para>

  <sect2 xml:id="sec.libvirt.config.pci.vmm">
   <title>Adding a PCI Device with &vmm;</title>
   <para>
    The following procedure describes how to add a PCI device to a &vmguest;
    using &vmm;:
   </para>
   <procedure>
    <step>
     <para>
      Double-click a &vmguest; entry in the &vmm; to open its console and
      switch to the <guimenu>Details</guimenu> view with <menuchoice>
      <guimenu>View</guimenu> <guimenu>Details</guimenu> </menuchoice>.
     </para>
    </step>
    <step>
     <para>
      Click <guimenu>Add Hardware</guimenu> and choose the <guimenu>PCI Host
      Device</guimenu> category in the left panel. A list of available PCI
      devices appears in the right part of the window.
     </para>
     <figure>
      <title>Adding a PCI Device</title>
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="virt_add_pcidevice.png" width="75%" format="PNG"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="virt_add_pcidevice.png" width="75%" format="PNG"/>
       </imageobject>
      </mediaobject>
     </figure>
    </step>
    <step>
     <para>
      From the list of available PCI devices, choose the one you want to
      pass to the guest. Confirm with <guimenu>Finish</guimenu>.
     </para>
    </step>
   </procedure>
   <tip>
    <title>Assigning a PCI Device Requires a &vmguest; Shutdown</title>
    <para>
     Although it is possible to assign a PCI device to a running &vmguest;
     as described above, the device will not become available until you shut
     down the &vmguest; and reboot it afterward.
    </para>
   </tip>
  </sect2>

 </sect1>
 <sect1 xml:id="sec.libvirt.config.usb">
  <title>Assigning a Host USB Device to a &vmguest;</title>

  <para>
   Analogous to assigning host PCI devices (see <xref
    linkend="sec.libvirt.config.pci"/>), you can directly assign host USB devices to guests.
   When the USB device is assigned to one &vmguest;, it cannot be used on
   the host or by another &vmguest; unless it is re-assigned.
  </para>

  <sect2 xml:id="sec.libvirt.config.usb.vmm">
   <title>Adding a USB Device with &vmm;</title>
   <para>
    To assign a host USB device to &vmguest; using &vmm;, follow these steps:
    </para>
    <procedure>
    <step>
     <para>
      Double-click a &vmguest; entry in the &vmm; to open its console and
      switch to the <guimenu>Details</guimenu> view with <menuchoice>
      <guimenu>View</guimenu> <guimenu>Details</guimenu> </menuchoice>.
     </para>
    </step>
    <step>
     <para>
      Click <guimenu>Add Hardware</guimenu> and choose the <guimenu>USB Host
      Device</guimenu> category in the left panel. A list of available USB
      devices appears in the right part of the window.
     </para>
     <figure>
      <title>Adding a USB Device</title>
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="virt_add_usbdevice.png" width="75%" format="PNG"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="virt_add_usbdevice.png" width="75%" format="PNG"/>
       </imageobject>
      </mediaobject>
     </figure>
    </step>
    <step>
     <para>
      From the list of available USB devices, choose the one you want to
      pass to the guest. Confirm with <guimenu>Finish</guimenu>.
      The new USB device appears in the left pane of the
      <guimenu>Details</guimenu> view.
     </para>
     <tip>
      <title>USB Device Removal</title>
      <para>
       To remove the host USB device assignment, click it in the left pane of
       the <guimenu>Details</guimenu> view and confirm with
       <guimenu>Remove</guimenu>.
      </para>
     </tip>
    </step>
   </procedure>
  </sect2>
 </sect1>

 <sect1 xml:id="sec.libvirt.config.direct">
  <title>Using Macvtap to Share &vmhost; Network Interfaces</title>

  <para>
   Macvtap provides direct attachment of a &vmguest; virtual interface
   to a host network interface. The macvtap-based interface extends the
   &vmhost; network interface and has its own MAC address on the same
   Ethernet segment. Typically, this is used to make both the &vmguest;
   and the &vmhost; show up directly on the switch that the &vmhost; is
   connected to.
  </para>

  <note>
   <title>Macvtap Cannot Be Used with a Linux Bridge</title>
   <para>
    Macvtap cannot be used with network interfaces already connected
    to a Linux bridge. Before attempting to create the macvtap interface,
    remove the interface from the bridge.
   </para>
  </note>
  <note>
   <title>&vmguest; to &vmhost; Communication with Macvtap</title>
   <para>
    When using macvtap, a &vmguest; can communicate with other
    &vmguest;s, and with other external hosts on the network. But it
    cannot communicate with the &vmhost; on which the &vmguest; runs.
    This is the defined behavior of macvtap, because of the way the
    &vmhost;'s physical Ethernet is attached to the macvtap bridge.
    Traffic from the &vmguest; into that bridge that is forwarded to
    the physical interface cannot be bounced back up to the &vmhost;'s
    IP stack. Similarly, traffic from the &vmhost;'s IP stack that is
    sent to the physical interface cannot be bounced back up to the
    macvtap bridge for forwarding to the &vmguest;.
   </para>
  </note>

  <para>
   Virtual network interfaces based on macvtap are supported by libvirt
   by specifying an interface type of <literal>direct</literal>. For example:
  </para>

  <screen>&lt;interface type='direct'&gt;
  &lt;mac address='aa:bb:cc:dd:ee:ff'/&gt;
  &lt;source dev='eth0' mode='bridge'/&gt;
  &lt;model type='virtio'/&gt;
  &lt;/interface&gt;</screen>

  <para>
   The operation mode of the macvtap device can be controlled with
   the <literal>mode</literal> attribute. The following lists show its possible
   values and a description for each:
  </para>
  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>
     <literal>vepa</literal>: All &vmguest; packets are sent to an external bridge. Packets
     whose destination is a &vmguest; on the same &vmhost; as where the
     packet originates from are sent back to the &vmhost; by the VEPA
     capable bridge (today's bridges are typically not VEPA capable).
    </para>
   </listitem>
   <listitem>
    <para>
     <literal>bridge</literal>: Packets whose destination is on the same
     &vmhost; as where they originate from are directly delivered to the target
     macvtap device. Both origin and destination devices need to be in
     <literal>bridge</literal> mode for direct delivery. If either one of them
     is in <literal>vepa</literal> mode, a VEPA capable bridge is required.
    </para>
   </listitem>
   <listitem>
    <para>
     <literal>private</literal>: All packets are sent to the external bridge and will only
     be delivered to a target &vmguest; on the same &vmhost; if they are
     sent through an external router or gateway and that device sends
     them back to the &vmhost;. This procedure is followed if either the
     source or destination device is in private mode.
    </para>
   </listitem>
   <listitem>
    <para>
     <literal>passthrough</literal>: A special mode that gives more power to the network
     interface. All packets will be forwarded to the interface, allowing
     virtio &vmguest;s to change the MAC address or set promiscuous mode
     to bridge the interface or create VLAN interfaces on top
     of it. Note that a network interface is not shareable in <literal>passthrough</literal>
     mode. Assigning an interface to a &vmguest; will disconnect it from
     the &vmhost;. For this reason SR-IOV virtual functions are often
     assigned to the &vmguest; in <literal>passthrough</literal> mode.
    </para>
   </listitem>
  </itemizedlist>
 </sect1>
</chapter>
