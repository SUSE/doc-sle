<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sect1 PUBLIC "-//Novell//DTD NovDoc XML V1.0//EN" "novdocx.dtd">
<!--
*********************************
Please see LICENSE.txt for this document's license.
*********************************
-->
<sect1 xml:base="lvm.xml" id="sec.yast2.system.lvm">
 <title>LVM 配置</title><indexterm> <primary>YaST</primary> <secondary>LVM</secondary></indexterm><indexterm> <primary>LVM</primary> <secondary>YaST</secondary></indexterm><indexterm> <primary>逻辑卷管理器</primary> <see>LVM</see></indexterm>

 <para>
  本节简要介绍逻辑卷管理器 (LVM) 背后的原理，以及它的多功能特性。在<xref linkend="sec.yast2.system.lvm.yast"/>中，将学习如何用 YaST 设置 LVM。
 </para>

 <warning>
  <title>备份数据</title>
  <para>
   使用 LVM 有时会增加一些风险，例如数据丢失。这些风险还包括应用程序崩溃、电源故障及有问题的命令。在实施 LVM 或重配置卷前，请保存数据。决不要在没有备份的情况下工作。
  </para>
 </warning>

 <sect2 id="sec.yast2.system.lvm.explained">
  <title>逻辑卷管理器</title>
  <para>
   LVM 支持在多个文件系统上灵活分配硬盘空间。开发逻辑卷管理器是因为有时只有在初始分区完成后才需要更改硬盘空间的分段。因为在运行的系统中修改分区比较困难，LVM 提供了内存空间的虚拟池（卷组，简称 VG），如果需要，可以从中生成逻辑卷 (LV)。操作系统访问这些逻辑卷而不是物理分区。卷组可以占据多个磁盘，这样多个磁盘或部分磁盘可以构成一个 VG。LVM 以这种方式提供了一种对物理磁盘空间的抽象，从而能够以比物理分区更方便、更安全的方式更改硬盘空间的分段。<xref linkend="sec.IB.part.typen"/>和<xref linkend="sec.yast2.i_y2_part_expert"/>中提供了有关物理分区的背景信息。
  </para>
  <figure id="fig.lvm.explained.schematic">
   <title>物理分区与 LVM</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="lvm.svg" width="75%" format="SVG"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="lvm.png" width="75%" format="PNG"/>
    </imageobject>
   </mediaobject>
  </figure>
  <para>
   <xref linkend="fig.lvm.explained.schematic"/>比较物理分区（左）和 lvm 分段（右）。在左侧，将一个磁盘分成 3 个物理分区 (PART)，每个分区指派了一个安装点 (MP)，以便操作系统可以访问它们。在右侧，有两个磁盘，一个磁盘分为 2 个物理分区，另一个磁盘分为 3 个物理分区。定义了两个 LVM 卷组（VG1 和 VG2）。VG1 包含 DISK1 中的 2 个分区和 DISK2 中的 1 个分区。VG2 包含 DISK2 中剩余的 2 个分区。在 LVM 中，将卷组中包含的物理磁盘分区称为物理卷 (PV)。在卷组中，定义了 4 个 LV（LV 1 至 LV 4）。操作系统可以通过关联的安装点使用它们。不同 LV 之间的边界不需要按任何分区边界对齐。请参见本示例中 LV 1 和 LV 2 之间的边界。
  </para>
  <para>
   LVM 功能：
  </para>
  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>
     可以将多块硬盘或多个分区合并为一个较大的逻辑卷。
    </para>
   </listitem>
   <listitem>
    <para>
     如果配置合适，当可用空间用完后，可以扩大 LV（例如 <filename>/usr</filename>）。
    </para>
   </listitem>
   <listitem>
    <para>
     通过使用 LVM，可以在正在运行的系统中添加硬盘或 LV。但是，此操作需要使用可热插拔的硬件。
    </para>
   </listitem>
   <listitem>
    <para>
     可以激活将 LV 的数据流分布在多个 PV 上的“条带化模式”。如果这些 PV 位于不同磁盘，则可以提高读写性能（类似于 RAID 0）。
    </para>
   </listitem>
   <listitem>
    <para>
     使用快照功能可以在正在运行的系统中执行一致的备份（尤其适合服务器）。
    </para>
   </listitem>
  </itemizedlist>
  <para>
   由于具有这些功能，LVM 可用于频繁使用的家用个人计算机或小型服务器。LVM 非常适合于数据储存量不断增长的用户（例如，用于数据库、音乐存档或用户目录）。此工具支持您使用大于物理硬盘的文件系统。LVM 的另一个优点是最多可以添加 256 个 LV。但是，使用 LVM 不同于使用传统的分区。位于 <ulink url="http://tldp.org/HOWTO/LVM-HOWTO/"/> 的官方 LVM HOWTO 提供了有关配置 LVM 的说明和详细信息。
  </para>
  <para>
   从内核版本 2.6 开始，便可以使用 LVM 版本 2，该版本向后兼容以前的 LVM，从而使您能继续管理以前的卷组。在创建新卷组时，决定是使用新格式还是使用向后兼容的版本。LVM 2 不需要任何内核增补程序。它利用集成在内核 2.6 中的设备映射程序。该内核只支持 LVM V2。因此本章说到 LVM 时总是指 LVM V2。
  </para>
  <sect3 id="sec.yast2.system.lvm.explained.thin">
   <title>精简配置</title>
   <para>
    从内核版本 3.4 开始，LVM 支持精简配置。精简配置卷具有虚拟容量和实际容量。<emphasis>虚拟</emphasis>容量是指主机可使用的卷存储容量。<emphasis>实际</emphasis>容量则指从存储池分配给卷副本的存储容量。在完全分配的卷中，虚拟容量与实际容量相同。但是，在精简配置卷中，虚拟容量可以远远大于实际容量。如果精简配置卷没有足够的实际容量以供写操作，该卷会脱机，由系统记录错误。
   </para>
   <para>
    有关更多常规信息，请参见 <ulink url="http://wikibon.org/wiki/v/Thin_provisioning"/>。
   </para>
  </sect3>
 </sect2>

 <sect2 id="sec.yast2.system.lvm.yast">
  <title>使用 YaST 配置 LVM</title>
  <para>
   YaST LVM 配置可以通过 YaST 专家分区程序（请参见<xref linkend="sec.yast2.i_y2_part_expert"/>）中<guimenu>系统视图</guimenu>窗格内的<guimenu>卷管理</guimenu>项目来访问。专家分区程序用于编辑和删除现有分区，还可创建需要用于 LVM 的新分区。第一个任务是创建用于向卷组提供空间的 PV：
  </para>
  <procedure>
   <step performance="required">
    <para>
     从<guimenu>硬盘</guimenu>中选择一个硬盘。
    </para>
   </step>
   <step performance="required">
    <para>
     更改到<guimenu>分区</guimenu>选项卡。
    </para>
   </step>
   <step performance="required">
    <para>
     单击<guimenu>添加</guimenu>，并输入该磁盘上 PV 所需的大小。
    </para>
   </step>
   <step performance="required">
    <para>
     选择<guimenu>不格式化分区</guimenu>，并将<guimenu>文件系统 ID</guimenu> 更改为 <guimenu>0x8E Linux LVM</guimenu>。不要装入该分区。
    </para>
   </step>
   <step performance="required">
    <para>
     重复此过程，直到您在可用磁盘上定义了所有所需物理卷。
    </para>
   </step>
  </procedure>
  <sect3 id="sec.yast2.system.lvm.yast.volume_groups">
   <title>创建卷组</title>
   <para>
    如果系统上不存在卷组，则您必须添加一个（请参见<xref linkend="fig.lvm.yast.volgrp"/>）。可以通过在<guimenu>系统视图</guimenu>窗格中单击<guimenu>卷管理</guimenu>，然后单击<guimenu>添加卷组</guimenu>来创建其他组。通常一个卷组就已足够。
   </para>
   <procedure>
    <step performance="required">
     <para>
      输入 VG 的名称，如 <literal>system</literal>。
     </para>
    </step>
    <step performance="required">
     <para>
      选择所需的<guimenu>物理区域大小</guimenu>。该值定义了卷组中物理块的大小。卷组中的所有磁盘空间都是按此大小的块来处理的。
     </para>
    </step>
    <step performance="required">
     <para>
      通过选择设备，然后单击<guimenu>添加</guimenu>将准备好的 PV 添加到 VG。选择设备时按住 <keycap function="control"/>，可同时选择几个设备。
     </para>
    </step>
    <step performance="required">
     <para>
      选择<guimenu>完成</guimenu>使 VG 可用于以后的配置步骤。
     </para>
    </step>
   </procedure>
   <figure id="fig.lvm.yast.volgrp">
    <title>创建卷组</title>
    <mediaobject>
     <imageobject role="fo">
      <imagedata fileref="yast2_lvm4.png" width="75%" format="PNG"/>
     </imageobject>
     <imageobject role="html">
      <imagedata fileref="yast2_lvm4.png" width="75%" format="PNG"/>
     </imageobject>
    </mediaobject>
   </figure>
   <para>
    如果您定义了多个卷组，且希望添加或删除 PV，请在<guimenu>卷管理</guimenu>列表中选择卷组，并单击<guimenu>调整大小</guimenu>。在以下窗口中，您可以在已选的卷组中添加或删除 PV。
   </para>
  </sect3>
  <sect3 id="sec.yast2.system.lvm.yast.logical_vol">
   <title>配置逻辑卷</title>
   <para>
    在用 PV 填充卷组后，请定义操作系统应在下一个对话框中使用的 LV。选择当前卷组，然后切换到<guimenu>逻辑卷</guimenu>选项卡。根据需要<guimenu>添加</guimenu>、<guimenu>编辑</guimenu><guimenu>删除</guimenu> LV 以及对 LV <guimenu>调整大小</guimenu>，直到卷组中的所有空间都用完为止。请为每个卷组至少指派一个 LV。
   </para>
   <figure id="fig.lvm.yast.mgmt">
    <title>逻辑卷管理</title>
    <mediaobject>
     <imageobject role="fo">
      <imagedata fileref="yast2_lvm6.png" width="75%" format="PNG"/>
     </imageobject>
     <imageobject role="html">
      <imagedata fileref="yast2_lvm6.png" width="75%" format="PNG"/>
     </imageobject>
    </mediaobject>
   </figure>
   <para>
    单击<guimenu>添加</guimenu>，然后完成打开的类似向导的弹出窗口：
   </para>
   <orderedlist spacing="normal">
    <listitem>
     <para>
      输入 LV 名称。对于应装入到 <filename>/home</filename> 的分区，可以使用类似于 <literal>HOME</literal> 的名称。
     </para>
    </listitem>
    <listitem>
     <para>
      选择 LV 类型。可以为<guimenu>普通卷</guimenu>、<guimenu>精简池</guimenu>或<guimenu>精简卷</guimenu>。注意：您必须先创建可存储单独精简卷的精简池。
     </para>
    </listitem>
    <listitem>
     <para>
      选择 LV 条带的大小和数量。如果您只有一个 PV，选择多个条带是没用的。
     </para>
     <tip>
      <para>
       精简配置的最大优势在于，存储于精简池的所有精简卷可超过精简池本身的大小。
      </para>
     </tip>
    </listitem>
    <listitem>
     <para>
      请选择要在 LV 上使用的文件系统及安装点。
     </para>
    </listitem>
   </orderedlist>
   <para>
    通过使用条带，可以在多个 PV 间分布 LV 中的数据流（条带化）。但是，对卷分段只能通过不同 PV 执行，每个 PV 至少提供卷的空间量。条带的最大数等于 PV 数，其中条带数“1”表示“不分段”。分段仅对不同硬盘上的 PV 有效，否则会降低性能。
   </para>
   <warning>
    <title>分段</title>
    <para>
     YaST 无法在此时验证关于分段的输入是否正确。这里所犯的任何错误只有以后在磁盘上实施 LVM 时才能显现。
    </para>
   </warning>
   <para>
    如果您已在系统上配置 LVM，则可以使用现有的逻辑卷。在继续前，请将适当的安装点指派给这些 LV。单击<guimenu>完成</guimenu>返回 YaST 专家分区程序，并在此完成工作。
   </para>
  </sect3>
 </sect2>


</sect1>
