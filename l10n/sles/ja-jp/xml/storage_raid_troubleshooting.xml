<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="storage_raid_troubleshooting.xml" version="5.0" xml:id="cha-raidtroubleshooting" xml:lang="ja">
 <title>ソフトウェアRAIDのトラブルシューティング</title>
 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:bugtracker/>
   <dm:translation>yes</dm:translation>
  </dm:docmanager>
 </info>
  <para>
   <filename>/proc/mdstat</filename>ファイルをチェックして、RAIDパーティションが破損しているかどうかを調べます。ディスク障害が発生した場合は、Linuxシステムをシャットダウンして、問題のあるハードディスクを、同じ方法でパーティション分割されている新しいハードディスクで置き換えます。次に、システムを再起動して、<command>mdadm /dev/mdX --add /dev/sdX</command>コマンドを入力します。<literal>「X」</literal>を特定のデバイス識別子に置き換えてください。これにより、ハードディスクがRAIDシステムに自動的に統合され、そのRAIDシステムが完全に再構築されます(RAID 0を除くすべてのRAIDレベル)。
  </para>

  <para>
   再構築中もすべてのデータにアクセスできますが、RAIDが完全に再構築されるまでは、パフォーマンスに問題が発生する場合があります。
  </para>

  <sect1 xml:id="sec-raid-trouble-autorecovery">
   <title>ディスク障害復旧後の回復</title>
   <para>
    RAIDアレイに含まれているディスクが障害を起こす理由はいくつかあります。最も一般的な理由を一覧にしました。
   </para>
   <itemizedlist>
    <listitem>
     <para>
      ディスクメディアに問題が発生
     </para>
    </listitem>
    <listitem>
     <para>
      ディスクドライブコントローラに障害発生
     </para>
    </listitem>
    <listitem>
     <para>
      ディスクへの接続に障害発生
     </para>
    </listitem>
   </itemizedlist>
   <para>
    ディスクメディアまたはディスクコントローラの障害の場合、デバイスを交換または修理する必要があります。RAID内でホットスペアが設定されていない場合、手動による介入作業が必要です。
   </para>
   <para>
    最後の接続障害の場合、接続の修復後(自動的に修復する場合もあります)、<command>mdadm</command>コマンドによって、障害が発生したデバイスは、自動的に再度追加されます。
   </para>
   <para>
    <command>md</command>/<command>mdadm</command>は、ディスク障害の原因を正確に判断できないため、デバイスが正常であると明示的に指示されるまで、ディスクエラーを深刻なエラーと判断し、障害が発生しているデバイスを異常と見なします。
   </para>
   <para>
    内部RAIDアレイを持つストレージデバイスなど、環境によっては、デバイス障害の原因の多くを接続の問題が占める場合があります。このような場合、<command>mdadm</command>に対して、デバイスが表示されたら、そのデバイスを<option>--re-add</option>によって自動的に再度追加しても問題ないと指示することができます。これには、以下の行を<filename>/etc/mdadm.conf</filename>に追加します。
   </para>
<screen>POLICY action=re-add</screen>
   <para>
    再表示されたらそのデバイスを自動的に再度追加できるのは、<systemitem>udev</systemitem>ルールによって、<command>mdadm -I <replaceable>DISK_DEVICE_NAME</replaceable></command>が、自動的に表示されたあらゆるデバイスで実行されるように設定されている場合(デフォルトの動作)、およびwrite-intentビットマップが設定されている場合(デフォルトの設定)に限られることに注意してください。
   </para>
   <para>
    このポリシーを特定のデバイスにのみ適用し、他には適用しない場合、<literal>path=</literal>オプションを<filename>/etc/mdadm.conf</filename>内の<literal>POLICY</literal>行に追加して、選択したデバイスにのみデフォルトでないアクションを限定することができます。ワイルドカードを使用して、デバイスのグループを指定することができます。詳しくは、<command>man 5 mdadm.conf</command>を参照してください。
   </para>
  
 </sect1>
 
 </chapter>
