<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sect1 PUBLIC "-//Novell//DTD NovDoc XML V1.0//EN" "novdocx.dtd">
<!--
*********************************
Please see LICENSE.txt for this document's license.
*********************************
-->
<sect1 xml:base="lvm.xml" id="sec.yast2.system.lvm">
 <title>Configuration de LVM</title><indexterm> <primary>YaST</primary> <secondary>LVM</secondary></indexterm><indexterm> <primary>LVM</primary> <secondary>YaST</secondary></indexterm><indexterm> <primary>Gestionnaire de volume logique (LVM - Logical Volume Manager)</primary> <see>LVM</see></indexterm>

 <para>
  Cette section décrit brièvement les bases du gestionnaire de volume logique (LVM - Logical Volume Manager) et ses fonctionnalités polyvalentes. Pour plus d'informations sur la configuration de LVM avec YaST, reportez-vous à la <xref linkend="sec.yast2.system.lvm.yast"/>.
 </para>

 <warning>
  <title>sauvegarde des données</title>
  <para>
   L'utilisation de LVM peut induire une augmentation des risques, notamment en ce qui concerne la perte de données. Mais les risques comprennent également le crash des applications, les pannes de courant ou les commandes défectueuses. Aussi, avant d'implémenter LVM ou de reconfigurer des volumes, enregistrez vos données. Ne travaillez jamais sans avoir au préalable fait une sauvegarde.
  </para>
 </warning>

 <sect2 id="sec.yast2.system.lvm.explained">
  <title>Gestionnaire de volume logique</title>
  <para>
   Le gestionnaire de volume logique (LVM) permet de distribuer de manière flexible de l'espace disque dur sur plusieurs systèmes de fichiers. La raison de son développement est liée au fait que, parfois, ce n'est qu'après le partitionnement qu'il faut modifier cette segmentation initiale de l'espace disque dur. Parce qu'il est difficile de modifier des partitions sur un système en cours d'exécution, LVM propose une réserve virtuelle (un groupe de volumes [VG]) d'espace mémoire, que vous pouvez utiliser au besoin pour créer des volumes logiques (LV). Le système d'exploitation accède à ces volumes logiques au lieu d'accéder aux partitions physiques. Les groupes de volumes pouvant s'étendre sur plusieurs disques, différents disques ou portions de disque peuvent donc constituer un seul et même groupe de volumes. De cette façon, LVM propose en quelque sorte un espace disque physique abstrait qui permet d'en modifier la segmentation avec beaucoup plus de facilité et de sécurité que le repartitionnement physique. Pour obtenir des informations de base sur le partitionnement physique, reportez-vous à la <xref linkend="sec.IB.part.typen"/> et à la <xref linkend="sec.yast2.i_y2_part_expert"/>.
  </para>
  <figure id="fig.lvm.explained.schematic">
   <title>Partitionnement physique VS LVM</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="lvm.svg" width="75%" format="SVG"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="lvm.png" width="75%" format="PNG"/>
    </imageobject>
   </mediaobject>
  </figure>
  <para>
   <xref linkend="fig.lvm.explained.schematic"/> Appuyez-vous sur la  pour comparer le partitionnement physique (à gauche) et la segmentation LVM (à droite). À gauche, un seul disque a été divisé en trois partitions physiques (PART), dotées chacune d'un point de montage (MP) qui permet au système d'exploitation d'accéder à ces partitions. À droite, les deux disques ont été divisés respectivement en deux et trois partitions physiques. Deux groupes de volumes LVM (VG 1 et VG 2) ont été définis. Le groupe de volumes VG 1 comporte les deux partitions du disque DISK 1 et une partition du disque DISK 2. Le groupe de volumes VG 2 contient les deux partitions restantes du disque DISK 2. Dans LVM, les partitions des disques physiques incorporées dans un groupe de volumes sont appelées « volumes physiques » (ou PV pour Physical Volume). Parmi les groupes de volumes, quatre volumes logiques (de LV 1 à LV 4) ont été définis. Il peuvent être utilisés par le système d'exploitation via les points de montage associés. La limite entre les différents LV n'a pas besoin d'être alignée sur la limite d'une partition. Reprenez dans cet exemple la limite entre LV 1 et LV 2.
  </para>
  <para>
   Fonctions de LVM :
  </para>
  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>
     Plusieurs disques durs ou partitions peuvent être combinés au sein d'un même volume logique de grande ampleur.
    </para>
   </listitem>
   <listitem>
    <para>
     Si la configuration est adaptée, il est possible d'agrandir un volume logique (tel que <filename>/usr</filename>) lorsque l'espace libre vient à manquer.
    </para>
   </listitem>
   <listitem>
    <para>
     Grâce à LVM, vous pouvez même ajouter des disques durs ou des volumes logiques sur un système en cours d'exécution. Pour ce faire, vous devez néanmoins disposer d'un matériel pouvant être connecté à chaud.
    </para>
   </listitem>
   <listitem>
    <para>
     Il est possible d'activer un « mode segmentation » qui distribue le flux de données d'un LV sur plusieurs PV. Si les PV résident sur différents disques, la performance de lecture et d'écriture s'en trouve améliorée, comme avec RAID 0.
    </para>
   </listitem>
   <listitem>
    <para>
     La fonction d'instantané assure l'homogénéisation des sauvegardes (notamment pour les serveurs) du système en cours d'exécution.
    </para>
   </listitem>
  </itemizedlist>
  <para>
   Ces fonctionnalités rendent LVM totalement adapté à une utilisation sur les ordinateurs privés ou les petits serveurs très sollicités. Si votre stock de données croît en permanence (comme avec les bases de données, les archives de musique ou les répertoires utilisateur), LVM est exactement l'outil qu'il vous faut. En effet, il permet de disposer de systèmes de fichiers plus volumineux que le disque dur physique. Un autre avantage de LVM est que vous pouvez ajouter jusqu'à 256 volumes logiques. Toutefois, l'utilisation de LVM diffère de celle de partitions conventionnelles. Pour obtenir des instructions, ainsi que d'autres informations relatives à la configuration de LVM, reportez-vous aux HOWTO (guides pratiques) officiels de LVM, disponibles à l'adresse suivante : <ulink url="http://tldp.org/HOWTO/LVM-HOWTO/"/>.
  </para>
  <para>
   À partir du kernel version 2.6, LVM version 2 est disponible, garantissant une compatibilité descendante avec la précédente version de LVM, ainsi que la gestion continue des anciens groupes de volumes. Lorsque vous créez de nouveaux groupes de volumes, vous pouvez utiliser soit le nouveau format de LVM, soit sa version à compatibilité descendante. LVM 2 ne requiert aucun correctif de kernel. Il utilise le système de transfert du périphérique intégré au kernel 2.6. Ce kernel ne prend en charge que LVM version 2. Par conséquent, lorsque LVM est mentionné dans cette section, cela correspond systématiquement à LVM version 2.
  </para>
  <sect3 id="sec.yast2.system.lvm.explained.thin">
   <title>Allocation fine et dynamique (Thin Provisioning)</title>
   <para>
    Depuis la version 3.4 du kernel, LVM prend en charge l'allocation fine et dynamique. Un volume alloué de manière fine et dynamique possède une capacité virtuelle et une capacité réelle. La capacité <emphasis>virtuelle</emphasis> est la capacité de stockage du volume disponible pour un hôte. La capacité <emphasis>réelle</emphasis> est la capacité de stockage allouée à une copie de volume à partir d'une réserve (pool) de stockage. Dans un volume entièrement alloué, la capacité virtuelle et la capacité réelle sont identiques. Cependant, dans un volume à allocation dynamique, la capacité virtuelle peut être largement supérieure à la capacité réelle. Si un volume à allocation dynamique ne dispose pas de suffisamment de capacité réelle pour une opération d'écriture, il est mis hors ligne et une erreur est consignée.
   </para>
   <para>
    Pour plus d'informations, reportez-vous à l'adresse <ulink url="http://wikibon.org/wiki/v/Thin_provisioning"/>.
   </para>
  </sect3>
 </sect2>

 <sect2 id="sec.yast2.system.lvm.yast">
  <title>Configuration de LVM avec YaST</title>
  <para>
   Pour configurer LVM avec YaST, utilisez le partitionneur en mode expert de YaST (voir <xref linkend="sec.yast2.i_y2_part_expert"/>), option <guimenu>Gestion du volume</guimenu> du volet <guimenu>Vue système</guimenu>. Cet outil de partitionnement permet de modifier et de supprimer des partitions existantes, mais également d'en créer de nouvelles, destinées à LVM. La première tâche à accomplir consiste à créer des PV qui fournissent de l'espace à un groupe de volumes :
  </para>
  <procedure>
   <step performance="required">
    <para>
     Sélectionnez un disque dur dans <guimenu>Disques durs</guimenu>.
    </para>
   </step>
   <step performance="required">
    <para>
     Placez-vous sur l'onglet <guimenu>Partitions</guimenu>.
    </para>
   </step>
   <step performance="required">
    <para>
     Cliquez sur <guimenu>Ajouter</guimenu> et indiquez la taille du PV souhaitée sur le disque.
    </para>
   </step>
   <step performance="required">
    <para>
     Cliquez sur <guimenu>Ne pas formater la partition</guimenu> et remplacez l'<guimenu>ID du système de fichiers</guimenu> par <guimenu>0x8E Linux LVM</guimenu>. Ne montez pas cette partition.
    </para>
   </step>
   <step performance="required">
    <para>
     Répétez cette procédure jusqu'à ce que vous ayez défini tous les volumes physiques souhaités sur les disques disponibles.
    </para>
   </step>
  </procedure>
  <sect3 id="sec.yast2.system.lvm.yast.volume_groups">
   <title>Création de groupes de volumes</title>
   <para>
    Si votre système ne comprend aucun groupe de volumes, vous devrez en ajouter un (reportez-vous à la <xref linkend="fig.lvm.yast.volgrp"/>). Il est possible de créer des groupes supplémentaires en cliquant sur l'option <guimenu>Gestion du volume</guimenu> du volet <guimenu>Vue système</guimenu>, puis sur <guimenu>Ajouter un groupe de volumes</guimenu>. En règle générale, un seul groupe de volumes suffit.
   </para>
   <procedure>
    <step performance="required">
     <para>
      Entrez un nom pour le VG, par exemple <literal>système</literal>.
     </para>
    </step>
    <step performance="required">
     <para>
      Sélectionnez la <guimenu>Taille des étendues physiques</guimenu> souhaitée. Cette valeur définit la taille d'un bloc physique dans un groupe de volumes. Tout l'espace disque d'un groupe de volumes est géré par l'intermédiaire de blocs de cette taille.
     </para>
    </step>
    <step performance="required">
     <para>
      Ajoutez les PV préparés au VG en sélectionnant le périphérique, puis en cliquant sur <guimenu>Ajouter</guimenu>. Vous pouvez sélectionner plusieurs périphériques à la fois. Pour ce faire, appuyez sur <keycap function="control"/> tout en sélectionnant les périphériques.
     </para>
    </step>
    <step performance="required">
     <para>
      Sélectionnez <guimenu>Terminer</guimenu> pour que le groupe de volumes soit disponible lors des prochaines étapes de la configuration.
     </para>
    </step>
   </procedure>
   <figure id="fig.lvm.yast.volgrp">
    <title>Création d'un groupe de volumes</title>
    <mediaobject>
     <imageobject role="fo">
      <imagedata fileref="yast2_lvm4.png" width="75%" format="PNG"/>
     </imageobject>
     <imageobject role="html">
      <imagedata fileref="yast2_lvm4.png" width="75%" format="PNG"/>
     </imageobject>
    </mediaobject>
   </figure>
   <para>
    Si plusieurs groupes de volumes sont définis et si vous souhaitez ajouter ou supprimer des PV, sélectionnez le groupe de volumes dans la liste <guimenu>Gestion du volume</guimenu>, puis cliquez sur <guimenu>Redimensionner</guimenu>. Le fenêtre suivante permet d'ajouter ou de supprimer des PV dans le groupe de volumes sélectionné. 
   </para>
  </sect3>
  <sect3 id="sec.yast2.system.lvm.yast.logical_vol">
   <title>Configuration des volumes logiques</title>
   <para>
    Une fois le groupe de volumes peuplé de volumes physiques, définissez les volumes logiques que le système d'exploitation doit utiliser dans la boîte de dialogue suivante. Choisissez le groupe de volumes actuel et accédez à l'onglet <guimenu>Volumes logiques</guimenu>. Utilisez les options <guimenu>Ajouter</guimenu>, <guimenu>Modifier</guimenu>, <guimenu>Redimensionner</guimenu> et <guimenu>Supprimer</guimenu> des volumes logiques si nécessaire, jusqu'à épuisement de l'espace du groupe de volumes. Assignez au moins un LV à chaque groupe de volumes.
   </para>
   <figure id="fig.lvm.yast.mgmt">
    <title>Gestion des volumes logiques</title>
    <mediaobject>
     <imageobject role="fo">
      <imagedata fileref="yast2_lvm6.png" width="75%" format="PNG"/>
     </imageobject>
     <imageobject role="html">
      <imagedata fileref="yast2_lvm6.png" width="75%" format="PNG"/>
     </imageobject>
    </mediaobject>
   </figure>
   <para>
    Cliquez sur <guimenu>Ajouter</guimenu> et placez-vous sur la fenêtre contextuelle qui s'ouvre (elle ressemble à un assistant) :
   </para>
   <orderedlist spacing="normal">
    <listitem>
     <para>
      Entrez le nom du LV. Pour une partition à monter dans <filename>/home</filename>, vous pouvez utiliser un nom tel que <literal>HOME</literal>.
     </para>
    </listitem>
    <listitem>
     <para>
      Sélectionnez le type du volume logique. Il peut s'agir de <guimenu>Volume normal</guimenu>, <guimenu>Pool à allocation dynamique</guimenu> ou <guimenu>Volume à allocation dynamique</guimenu>. Notez que vous devez d'abord créer un pool à allocation dynamique, lequel peut stocker des volumes à allocation dynamique.
     </para>
    </listitem>
    <listitem>
     <para>
      Sélectionnez la taille et le nombre de segments du LV. Si vous n'avez qu'un seul PV, il est inutile de sélectionner plusieurs segments.
     </para>
     <tip>
      <para>
       L'allocation fine et dynamique présente un avantage de taille : la somme totale de tous les volumes à allocation dynamique stockés dans un pool de ce type peut, en effet, dépasser la taille du pool proprement dit.
      </para>
     </tip>
    </listitem>
    <listitem>
     <para>
      Choisissez le système de fichiers à utiliser sur le volume logique, ainsi que le point de montage.
     </para>
    </listitem>
   </orderedlist>
   <para>
    L'utilisation de segments permet de distribuer le flux de données du LV parmi plusieurs PV (segmentation). Toutefois, la segmentation d'un volume ne peut être exécutée que sur des PV différents, chacun d'entre eux disposant au moins de l'espace du volume. Le nombre maximum de blocs est égal au nombre de PV, avec le bloc 1 signifiant « pas de segmentation ». La segmentation n'est utile que si les PV se trouvent sur différents disques durs, faute de quoi les performances risquent de s'affaiblir.
   </para>
   <warning>
    <title>segmentation</title>
    <para>
     À ce stade, YaST ne peut pas vérifier l'exactitude de vos entrées relatives à la segmentation. Toute erreur à ce stade ne sera visible qu'au moment de l'implémentation de LVM sur le disque.
    </para>
   </warning>
   <para>
    Si vous avez déjà configuré LVM sur votre système, vous pouvez également utiliser les volumes logiques existants. Avant de poursuivre, assignez à ces volumes logiques les points de montage appropriés. Cliquez sur <guimenu>Terminer</guimenu> pour revenir au partitionneur en mode expert de YaST et terminer vos opérations grâce à cet outil.
   </para>
  </sect3>
 </sect2>


</sect1>
