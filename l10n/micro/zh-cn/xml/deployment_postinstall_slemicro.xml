<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="deployment_postinstall_slemicro.xml" version="5.0" xml:id="cha-postintall-registration">
 <title>部署后步骤</title>
 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:bugtracker/>
   <dm:translation>yes</dm:translation>
  </dm:docmanager>
  <abstract>
   <para>
    本章介绍如何注册 SLE Micro 以及适用于 SLE Micro 的扩展。
   </para>
  </abstract>
 </info>

 <sect1 xml:id="sec-images-registration">
  <title>注册</title>

  <para>
   可以使用 <command>transactional-update register</command> 命令从命令行注册系统。如果所需的信息超出了本节的范畴，请使用 <command>SUSEConnect --help</command> 查看内联文档。
  </para>

  <procedure>
   <title>使用 SUSEConnect 注册产品</title>
   <step>
    <para>
     要在 SUSE Customer Center 中注册 <phrase role="productname"><phrase os="slemicro">SUSE Linux Enterprise Micro</phrase></phrase>，请按如下所示运行 <command>transactional-update
     register</command>：
    </para>
<screen><prompt role="root"># </prompt>transactional-update register -r <replaceable>REGISTRATION_CODE</replaceable> -e <replaceable>EMAIL_ADDRESS</replaceable></screen>
    <para>
     要在本地注册服务器中注册，另请提供该服务器的 URL：
    </para>
<screen><prompt role="root"># </prompt>transactional-update register -r <replaceable>REGISTRATION_CODE</replaceable> -e <replaceable>EMAIL_ADDRESS</replaceable> \
--url "https://suse_register.example.com/"</screen>
    <para>
     将 <replaceable>REGISTRATION_CODE</replaceable> 替换为随您的 <phrase role="productname"><phrase os="slemicro">SUSE Linux Enterprise Micro</phrase></phrase> 一起收到的注册码。将 <replaceable>EMAIL_ADDRESS</replaceable> 替换为与您或贵组织管理订阅时所用 SUSE 帐户关联的电子邮件地址。
    </para>
   </step>
   <step>
    <para>
     重引导您的系统以切换到最新的快照。
    </para>
   </step>
   <step>
    <para>
     <phrase role="productname"><phrase os="slemicro">SUSE Linux Enterprise Micro</phrase></phrase> 现已注册完毕。
    </para>
   </step>
  </procedure>
 </sect1>
 <sect1 xml:id="sec-adding-extension">
  <title>管理扩展</title>

  <para>
   SLE Micro 提供了以下扩展：
  </para>
<variablelist>
    <varlistentry>
        <term><literal>SUSE Linux Enterprise Live Patching</literal></term>
        <listitem>
            <para>
               该扩展仅适用于 x86（实时内核除外）和 IBM Z 体系结构。请注意，您可能需要额外订阅该扩展。
            </para>
        </listitem>
    </varlistentry>
    <varlistentry>
        <term><literal>Package Hub</literal></term>
        <listitem>
            <para>
                该免费模块可用于访问社区维护的软件包。Package Hub 中的软件包已经 SUSE 批准用于 SUSE Linux Enterprise Server 上，因此这些软件包可能无法安装在 SLE Micro 上。
            </para>
        </listitem>
    </varlistentry>
</variablelist>
   <para>
   由于该扩展的激活或停用以 <command>transactional-update</command> 命令方式进行，因而会创建新的快照，您需要重启动系统以引导到新的快照来应用更改。
  </para>

  <sect2 xml:id="sec-slemicro-live-patching">
   <title>激活扩展</title>
   <para>
    要激活扩展，请执行以下操作：
   </para>
   <procedure>
    <step>
     <para>
      运行以下命令列出可用扩展：
     </para>
<screen><prompt role="root"># </prompt>transactional-update --quiet register -list-extensions</screen>
    </step>
    <step>
     <para>
      输出中会提供用于激活扩展的命令，例如，对于 <literal>SUSE Linux Enterprise Live Patching</literal>，激活命令为：
     </para>
<screen>
<prompt role="root"># </prompt>transactional-update register -p sle-module-live-patching/15.4/x86_64 \
  -r <replaceable>registration code</replaceable>
</screen>
    </step>
</procedure>
<para>
    如果您激活了 <literal>SUSE Linux Enterprise Live Patching</literal> 扩展，则需要按下文所述执行额外的步骤：
    </para>

    <procedure xml:id="pro-completing-KLP-activation">
        <title>完成 <literal>SUSE Linux Enterprise Live Patching</literal> 的激活</title>
    <step>
     <para>
      按如下所示在 <filename>/etc/zypp/zypp.conf</filename> 文件中配置 <literal>libzypp</literal>：
     </para>
     <variablelist>
      <varlistentry>
       <term><literal>multiversion = provides:multiversion(kernel)</literal></term>
       <listitem>
        <para>
         这会在增补系统的同时，确保当前内核保持运行状态，否则，在应用内核更新时可能会发生依赖项冲突。
        </para>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term><literal>multiversion.kernels = latest</literal></term>
       <listitem>
        <para>
         这会在应用在线补丁后在新快照中执行内核清理。如果未设置此命令，快照将保留之前的内核，并且也会在之前的内核上执行内核更新。
        </para>
       </listitem>
      </varlistentry>
     </variablelist>
    </step>
    <step>
     <para>
      此外，在 <filename>/etc/sysconfig/livepatching</filename> 文件中设置 <literal>LIVEPATCH_KERNEL='always'</literal>。
     </para>
     <note>
      <title>确保 <literal>kernel-default-livepatch</literal> 的版本与内核匹配</title>
      <para>
       为了确保内核升级后仍会安装在线补丁，请安装匹配版本的 <literal>kernel-default-livepatch</literal> 软件包。
      </para>
     </note>
    </step>
    <step>
     <para>
      现在，运行以下命令安装该扩展：
     </para>
<screen><prompt role="root"># </prompt>transactional-update pkg install kernel-default-livepatch</screen>
    </step>
    <step>
     <para>
      重引导您的系统以切换到新快照。
     </para>
    </step>
   </procedure>
  </sect2>

  <sect2 xml:id="sec-disable-live-patching">
   <title>停用扩展</title>
   <para>
    要停用该扩展，请运行以下命令：
   </para>
   <screen>
<prompt role="root"># </prompt>transactional-update register -d \
  -p <replaceable>EXTENSION_NAME</replaceable>
</screen>

   <para>
    例如，对于 <literal>SUSE Linux Enterprise Live Patching</literal> 扩展，相应命令如下：
   </para>
<screen>
<prompt role="root"># </prompt>transactional-update register -d \
  -p sle-module-live-patching/15.4/x86_64
</screen>
  </sect2>
 </sect1>
</chapter>
