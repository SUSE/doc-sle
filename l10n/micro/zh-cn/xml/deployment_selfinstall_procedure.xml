<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="deployment_selfinstall_procedure.xml" version="5.0" xml:id="cha-selfinstal-procedure">
 <title>部署自行安装映像</title>
 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:bugtracker/>
   <dm:translation>yes</dm:translation>
  </dm:docmanager>
  <abstract>
   <para>
    本章介绍如何通过自行安装预构建 ISO 映像部署 SLE Micro。
   </para>
  </abstract>
 </info>
 <para>
  <phrase role="productname"><phrase os="slemicro">SUSE Linux Enterprise Micro</phrase></phrase> 提供自行安装 ISO 映像，可让您将 SLE Micro 部署到计算机（虚拟机或裸机）并在首次引导时配置系统。
 </para>
 <para>
  要准备设置，您需要以下设备：
 </para>
 <itemizedlist>
  <listitem>
   <para>
    用于运行 SLE Micro 的磁盘（物理或虚拟）
   </para>
  </listitem>
  <listitem>
   <para>
    存放自行安装 ISO 的可引导设备（例如 USB 磁盘）
   </para>
  </listitem>
  <listitem>
   <para>
    （可选）充当配置媒体的设备。要准备配置设备，请按<xref linkend="pro-selfinstall-configuration-device"/>中的步骤操作
   </para>
  </listitem>
 </itemizedlist>
 <para>
  如果您在安装期间未连接配置设备，首次引导期间将会启动 <emphasis>jeos-firstboot</emphasis>。此工具可用于完成 SLE Micro 的极简配置。相关过程请参见<xref linkend="sec-jeos-firstboot-selfinstall"/>。如果您需要更复杂的配置，则需要使用配置媒体。
 </para>
 <para>
  要安装 SLE Micro，请按照<xref linkend="proc-selfinstall-installation"/>中所述操作。
 </para>
 <important>
  <title>配置设备必须在首次引导期间插入。</title>
  <para>
   请注意，配置设备（如果使用）必须在首次引导时的整个配置过程中都插入系统。建议在启动安装过程前插入该设备。但如果您的固件不支持在引导时挂接两个或更多 USB 磁盘，您可以在启动配置过程前更换 USB 磁盘。
  </para>
 </important>
 <note>
    <title>使用自行安装 ISO 映像进行安装不会创建引导 EFI 项。</title>
    <para>
     在部署自行安装 ISO 期间会将系统映像复制到所选磁盘，因此不会创建 EFI 引导项（就像一般情况下使用安装程序部署系统时一样）。您可能需要使用 EFI 外壳选择 SLE Micro 引导加载器来手动引导您的系统。首次引导后，可以使用 <command>efibootmgr</command> 创建引导项。部署的映像中默认会提供 <command>efibootmgr</command>。
    </para>
   </note>
 <procedure xml:id="proc-selfinstall-installation">
  <title>SLE Micro 安装</title>
  <step>
   <para>
    如果需要，请按照<xref linkend="pro-selfinstall-configuration-device"/>中所述准备配置设备。
   </para>
  </step>
  <step>
   <para>
    使用挂接的自行安装 ISO 引导计算机。
   </para>
  </step>
  <step>
   <para>
    选择<guimenu>安装 SUSE Linux Enterprise Micro</guimenu> 启动安装过程。
   </para>
  </step>
  <step>
   <para>
    选择将安装 SLE Micro 的磁盘并确认要删除该磁盘上的数据。SLE Micro 映像随后会复制到该磁盘。
   </para>
  </step>
  <step>
   <para>
    通过使用 <command>kexec</command>，您的系统会重引导并随后为配置过程做好准备。
   </para>
  </step>
  <step>
   <para>
    选择 <guimenu>SUSE Linux Enterprise Micro</guimenu> 启动配置过程。系统即会根据配置设备上提供的指示配置 SLE Micro，或者启动 <emphasis>jeos-firstboot</emphasis>。
   </para>
  </step>
  <step>
   <para>
    （可选）按照<xref linkend="sec-jeos-firstboot-selfinstall"/>中所述使用 <emphasis>jeos-firstboot</emphasis> 配置系统。
   </para>
  </step>
   <step>
   <para>
    首次引导之后，您可以使用 <command>transactional-update</command> 命令注册 SLE Micro 实例。有关细节，请参见<xref linkend="sec-images-registration"/>。
   </para>
   <para>
    SLE Micro 提供了多个扩展。要使用其中的一些扩展，您需要从安装的系统将扩展添加到您的订阅中。有关细节，请参见<xref linkend="sec-adding-extension"/>。
   </para>
  </step>
 </procedure>
 <section xml:id="sec-selfinstall-conf-device">
  <title>准备配置设备</title>
  <para>
   下面的过程说明如何准备配置设备：
  </para>
  <procedure xml:id="pro-selfinstall-configuration-device">
  <title>准备配置设备</title>
  <step>
   <para>
    将磁盘格式化为 SLE Micro 支持的任何文件系统：Ext3、Ext4 等：
   </para>
<screen>
<prompt>&gt; </prompt>sudo mkfs.ext4 /dev/sd<replaceable>Y</replaceable>
</screen>
  </step>
  <step>
   <para>
    将设备标签设置为 <literal>ignition</literal>（使用 Ignition 或 时）或 <literal>combustion</literal>combustion（仅使用 Combustion 时）。对于 Ext4 文件系统：
   </para>
<screen><prompt>&gt; </prompt>sudo e2label /dev/sd<replaceable>Y</replaceable> ignition</screen>
   <para>
    您可以使用您的虚拟化系统或硬件支持的任何类型的配置存储媒体：ISO 映像、USB 闪存盘等。
   </para>
  </step>
  <step>
   <para>
    挂载设备：
   </para>
<screen>
<prompt>&gt; </prompt>sudo mount /dev/sdY /mnt
</screen>
  </step>
  <step>
   <para>
    创建<xref linkend="cha-images-ignition"/>或<xref linkend="cha-images-combustion"/>中所述的目录结构，具体取决于使用的配置工具：
   </para>
<screen>
<prompt>&gt; </prompt>sudo mkdir -p /mnt/ignition/
</screen>
   <para>
    或：
   </para>
<screen>
<prompt>&gt; </prompt>sudo mkdir -p /mnt/combustion/
</screen>
  </step>
  <step>
   <para>
    在首次引导前，准备 <xref linkend="cha-images-ignition" xrefstyle="template:Ignition"/> 或 <xref linkend="cha-images-combustion" xrefstyle="template:Combustion"/> 将要使用的配置的所有元素。要登录系统，您需要提供 <systemitem class="username">root</systemitem> 的口令或设置无口令身份验证，否则首次引导后将无法访问系统。
   </para>
  </step>
</procedure>
 </section>
 <section xml:id="sec-jeos-firstboot-selfinstall">
  <title>极简初始配置</title>
  <para>
   如果您未挂接任何配置媒体，<emphasis>jeos-firstboot</emphasis> 将会启动，您可以按如下方式执行系统的极简配置：
  </para>
  <procedure>
   <title>使用 <emphasis>jeos-firstboot</emphasis> 配置系统</title>
   <step>
    <para>
     确认配置。
    </para>
    <informalfigure>
     <mediaobject>
      <imageobject role="fo">
       <imagedata fileref="slemicro_jeos_start.png" width="100%"/>
      </imageobject>
      <imageobject role="html">
       <imagedata fileref="slemicro_jeos_start.png" width="100%"/>
      </imageobject>
      <textobject role="description"><phrase>jeos first boot</phrase>
      </textobject>
     </mediaobject>
    </informalfigure>
   </step>
   <step>
    <para>
     选择键盘布局并确认所做的选择。
    </para>
    <informalfigure>
     <mediaobject>
      <imageobject role="fo">
       <imagedata fileref="slemicro_jeos_keyboard.png" width="100%"/>
      </imageobject>
      <imageobject role="html">
       <imagedata fileref="slemicro_jeos_keyboard.png" width="100%"/>
      </imageobject>
      <textobject role="description"><phrase>jeos keyboard selection</phrase>
      </textobject>
     </mediaobject>
    </informalfigure>
   </step>
   <step>
    <para>
     阅读并接受许可协议。
    </para>
    <informalfigure>
     <mediaobject>
      <imageobject role="fo">
       <imagedata fileref="slemicro_jeos_eula.png" width="100%"/>
      </imageobject>
      <imageobject role="html">
       <imagedata fileref="slemicro_jeos_eula.png" width="100%"/>
      </imageobject>
      <textobject role="description"><phrase>jeos EULA</phrase>
      </textobject>
     </mediaobject>
    </informalfigure>
   </step>
   <step>
    <para>
     选择您所在的时区。
    </para>
    <informalfigure>
     <mediaobject>
      <imageobject role="fo">
       <imagedata fileref="slemicro_jeos_timezone.png" width="100%"/>
      </imageobject>
      <imageobject role="html">
       <imagedata fileref="slemicro_jeos_timezone.png" width="100%"/>
      </imageobject>
      <textobject role="description"><phrase>jeos time zone selection</phrase>
      </textobject>
     </mediaobject>
    </informalfigure>
   </step>
   <step>
    <para>
     输入 <systemitem class="username">root</systemitem> 的口令。
    </para>
    <informalfigure>
     <mediaobject>
      <imageobject role="fo">
       <imagedata fileref="slemicro_jeos_password.png" width="100%"/>
      </imageobject>
      <imageobject role="html">
       <imagedata fileref="slemicro_jeos_password.png" width="100%"/>
      </imageobject>
      <textobject role="description"><phrase>root password</phrase>
      </textobject>
     </mediaobject>
    </informalfigure>
   </step>
   <step>
    <para>
     确认 <systemitem class="username">root</systemitem> 口令。
    </para>
    <informalfigure>
     <mediaobject>
      <imageobject role="fo">
       <imagedata fileref="slemicro_jeos_password_confirm.png" width="100%"/>
      </imageobject>
      <imageobject role="html">
       <imagedata fileref="slemicro_jeos_password_confirm.png" width="100%"/>
      </imageobject>
      <textobject role="description"><phrase>root password confirmation</phrase>
      </textobject>
     </mediaobject>
    </informalfigure>
   </step>
   <step>
    <para>
     接受关于 SLE Micro 注册的声明。
    </para>
    <informalfigure>
     <mediaobject>
      <imageobject role="fo">
       <imagedata fileref="slemicro_jeos_statement.png" width="100%"/>
      </imageobject>
      <imageobject role="html">
       <imagedata fileref="slemicro_jeos_statement.png" width="100%"/>
      </imageobject>
      <textobject role="description"><phrase>root password</phrase>
      </textobject>
     </mediaobject>
    </informalfigure>
   </step>
  </procedure>
 </section>
</chapter>
