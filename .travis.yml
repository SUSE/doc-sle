sudo: required
language: bash
env:
  global:
    - LD_PRELOAD=/lib/x86_64-linux-gnu/libSegFault.so
    - CACHE="$HOME/.cache/entities"
    - XML_CATALOG_FILES="catalog.xml"
    - GITHUB_URL="https://raw.githubusercontent.com/openSUSE/doc-ci/master/travis/travis.sh"

cache:
  directories:
    - $CACHE

addons:
  apt:
    packages:
      - libxml2-utils
      - libxml2-dev
      - libxml2

services:
  - docker

before_install:
  - 'if [ "$TRAVIS_PULL_REQUEST" != "false" ]; then docker build -t sle-doc-image .; docker run --rm -it sle-doc-image rpm -qa | sort; fi'
  - 'if [ "$TRAVIS_PULL_REQUEST" = "false" ]; then cat /etc/os-release; echo $TRAVIS_COMMIT; sudo apt-get install -y libxml2-utils; xmllint --version; wget $GITHUB_URL && chmod +x travis.sh; fi'


script:
  - 'if [ "$TRAVIS_PULL_REQUEST" != "false" ]; docker run --rm -it sle-doc-image find . -maxdepth 1 -name 'DC-*' -exec echo "Validating {}..." \; -exec daps -d \{\} validate --remarks \; fi'
  - 'if [ "$TRAVIS_PULL_REQUEST" = "false" ]; ./travis.sh xml/*.xml; fi'

branches:
  except:
    - trans/*
