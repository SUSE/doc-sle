<?xml version="1.0" encoding="UTF-8"?>
<sect1 xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="security_ldap_sssd.xml" version="5.0" xml:id="sec-security-ldap-server-sssd">
  <title>设置 SSSD</title>
  <info>
   <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
    <dm:translation>yes</dm:translation>
   </dm:docmanager>
  </info>
  <para>
   SSSD（系统安全服务守护程序）是一个与远程身份提供者通讯并允许 <literal>pam</literal> 和 <literal>nsswitch</literal> 使用该数据的守护程序。SSSD 可以有多个后端，可缓存用户和组并提供 SSH 密钥分发等功能。
  </para>
  <procedure>
   <step>
     <para>在单独的服务器上安装 <systemitem>sssd</systemitem> 和 <systemitem>sssd-ldap</systemitem> 软件包：
     </para>
    <screen><prompt>tux &gt; </prompt><command>sudo</command> zypper in sssd sssd-ldap</screen>
   </step>
   <step>
    <para>
     禁用并停止 <systemitem class="daemon">nscd</systemitem> 守护程序，因为它与 <systemitem class="daemon">sssd</systemitem> 相冲突：
    </para>
    <screen><prompt>tux &gt; </prompt><command>sudo</command> systemctl disable nscd &amp;&amp; systemctl stop nscd</screen>
   </step>
   <step>
    <para>
     创建 SSSD 配置，并仅允许我们在<xref linkend="pro-security-ldap-server-groups" xrefstyle="select:label"/> 中创建的 <systemitem class="groupname">server_admins</systemitem> 组的成员登录：
    </para>
    <tip>
     <para>
      需要启用 <literal>memberOf</literal> 插件，以使客户端能够登录和授权（参见<xref linkend="sec-security-ldap-modules"/>）。
     </para>
    </tip>
    <screen><prompt>tux &gt; </prompt><command>sudo</command> dsidm localhost client_config sssd.conf server_admins</screen>
   </step>
   <step>
    <para>
     查看输出并将其粘贴（或重定向）到 <filename>/etc/sssd/sssd.conf</filename>。必要时，请根据需要编辑配置文件。
    </para>
   </step>
   <step>
    <para>
     要在您的客户端上配置证书，请将 LDAP 服务器中的 <filename>ca.crt</filename> 复制到您的客户端：</para>
    <screen><prompt>tux &gt; </prompt><command>sudo</command> mkdir -p /etc/openldap/certs
cp [...]&gt;/ca.crt /etc/openldap/certs/
/usr/bin/c_rehash /etc/openldap/certs</screen>
   </step>
   <step>
    <para>
     启用并启动 SSSD：
    </para>
    <screen><prompt>tux &gt; </prompt><command>sudo</command> systemctl enable sssd
systemctl start sssd</screen>
   </step>
   <step>
    <para>
     为确保 SSSD 成为 PAM 和 NSS 的一部分，请遵照 <link xlink:href="https://www.port389.org/docs/389ds/howto/howto-sssd.html"/> 上“<citetitle>Configure PAM (SUSE)</citetitle>”（配置 PAM (SUSE)）和“<citetitle>Configure NSS (SUSE)</citetitle>”（配置 NSS (SUSE)）章节中的说明操作。
    </para>
   </step>
   <step>
    <para>
     您的用户必须拥有自己的 SSH 密钥对，并可通过 SSH 访问您的 SSSD 服务器。如果所有设置均正确无误，<systemitem class="username">wilber</systemitem> 可以通过与安装并配置了 SSSD 的计算机所建立的 SSH 连接访问 389 目录服务器实例。但 <systemitem class="username">geeko</systemitem> 做不到这一点，因为 <systemitem class="username">geeko</systemitem> 不属于我们在<xref linkend="pro-security-ldap-server-groups" xrefstyle="select:label"/> 中配置的 <literal>server_admins</literal> 组。
    </para>
   </step>
  </procedure>
</sect1>
