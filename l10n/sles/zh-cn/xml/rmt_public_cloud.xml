<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="rmt_public_cloud.xml" version="5.0" xml:id="rmt-public-cloud">
  <title>部署 SUSE Linux Enterprise Server 实例以支持公有云中的 RMT</title>
  <info>
    <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
      <dm:translation>yes</dm:translation>
    </dm:docmanager>
  </info>
  <para>
您可以部署 SUSE Linux Enterprise Server 实例，以支持 Amazon Web Services (AWS )、Google Cloud Platform (GCP) 和 Microsoft Azure 中的 RMT。从 SLES 15 版开始便集成了 RMT。</para>
  <para>
  以下示例显示了 RMT 部署的通用云体系结构。您的部署可能会有所不同，这取决于您的网络要求。</para>
  <figure>
    <title>RMT 部署的云体系结构示例</title>
    <mediaobject>
      <imageobject role="fo">
        <imagedata fileref="rmt-architecture-example.png" width="70%"/>
      </imageobject>
        </mediaobject>
  </figure>
  <sect1 xml:id="sec-rmt-byos-image">
<title>使用自带订阅映像</title>
<para>
SUSE 为 Amazon Web Services、Google Cloud 和 Microsoft Azure 提供适用的 SLES 映像。提供的映像有两种类型：PAYG（随用随付）和 BYOS（自带订阅）。这些映像会定期更新，建议您基于最新版映像部署新实例，以确保应用最新的安全更新。为支持 RMT 部署，我们建议从 BYOS 映像部署 RMT 实例。
</para>
<sect2 xml:id="sec-rmt-byos-image-where">
  <title>在云市场中查找映像 </title>
  <para>相关映像在各云提供商中的位置如下所示：</para>
  <figure>
    <title>Google Cloud</title>
    <mediaobject>
      <imageobject role="fo">
        <imagedata fileref="gcp-launch-sles-instance-cloud-rmt-marketplace.png" width="70%"/>
      </imageobject>
       </mediaobject>
  </figure>
  <figure>
    <title>Amazon Web Services</title>
    <mediaobject>
      <imageobject role="fo">
        <imagedata fileref="aws-launch-sles-instance-cloud-rmt-marketplace.png" width="70%"/>
      </imageobject>
       </mediaobject>
  </figure>
  <figure>
    <title>Microsoft Azure</title>
    <mediaobject>
      <imageobject role="fo">
        <imagedata fileref="azure-launch-sles-instance-cloud-rmt-marketplace.png" width="70%"/>
      </imageobject>
       </mediaobject>
  </figure>
  <para>建议从至少配备两个 vCPU 和 8 GB RAM 的实例类型开始，以支持 RMT 部署。例如，Amazon EC2 上的 <literal>t3.large</literal> 实例类型以及 Microsoft Azure 中的 <literal>B2as_v2</literal>。可根据实际需求调整实例规格，具体配置取决于 RMT 服务器所管理和更新的客户端数量。
    </para>
</sect2>
<sect2 xml:id="sec-rmt-byos-image-registration">
  <title>注册 SLES 实例</title>
  <para>部署 SLES 实例后，必须在 SUSE Customer Center 注册该实例。</para>
  <note>
    <title>SUSE 帐户</title>
    <para>
     需有一个 SUSE 帐户才能在 SUSE Customer Center 中注册。如果您没有 SUSE 帐户，请前往 SUSE Customer Center 主页 (<link xlink:href="https://scc.suse.com/"></link>) 创建一个帐户。
    </para>
   </note>
   <para>要连接您的实例，请使用以下命令：</para>
   <para>AWS：</para>
   <screen><prompt>&gt; </prompt> <command>ssh -i <replaceable>SSH_KEY</replaceable> <replaceable>EC2_USER_ID</replaceable>@<replaceable>SERVER_IP</replaceable></command></screen>
   <para>Google Cloud：</para>
   <screen><prompt>&gt; </prompt> <command>gcloud compute ssh <replaceable>GCE_INSTANCE_IP</replaceable></command></screen>
   <para>Azure：</para>
   <screen><prompt>&gt; </prompt> <command>ssh <replaceable>AZURE_USER_ID</replaceable>@<replaceable>SERVER_IP</replaceable></command></screen>
  <para>要在 SCC 中注册 SLES 实例，请使用以下命令：</para>
  <screen><prompt>&gt; </prompt><command>sudo</command>  <command>SUSEConnect -e <replaceable>EMAIL_ADDRESS</replaceable> -r <replaceable>REGISTRATION_CODE </replaceable></command></screen>
  <para>登录 SCC 后，注册代码即可使用。</para>
</sect2>
</sect1>
<sect1><title>使用 RMT 时的注意事项</title>
  <para>使用 RMT 时必须注意以下要求：</para>
<variablelist>
  <varlistentry>
    <term>磁盘空间</term>
    <listitem>
      <para>
        RMT 服务器需要足够的磁盘空间来镜像储存库。下载的软件包位于 <filename>/var/lib/rmt/public/repo/</filename>。磁盘空间取决于镜像的储存库数量。建议至少配备所有已启用储存库总大小的 1.5 倍。最佳实践是置备一个额外的磁盘卷来支持这一要求。您可以在创建实例时将卷挂载到 <filename>/var/lib/rmt/public/repo/</filename>，或在启动实例后立即执行该操作。在 Azure 上，它会作为额外的磁盘卷。在 AWS 上，它会作为 Amazon EBS 卷，而在 GCP 上，则是作为永久磁盘卷。
              </para>
         </listitem>
  </varlistentry>
  <varlistentry>
    <term>IP 或 DNS 解析</term>
    <listitem>
      <para>
        客户端连接到 RMT 服务器时需要静态 IP 地址或 DNS 名称。在 Azure、AWS 和 GCP 中，当实例启动时，会分配云服务提供商 (CSP) 提供的 DNS。如果重新创建实例，此 IP 或 DNS 可能会更改。对于 Azure，建议使用静态 IP 地址为客户端提供一致的连接点。在 AWS 中，应为弹性 IP 或 Route53。在 GCP 中，应为使用静态 IP 地址的云 DNS 记录。
        </para>
         </listitem>
  </varlistentry>
  <varlistentry>
    <term>RMT 服务器的连接</term>
    <listitem>
      <para>
      RMT 服务器可以通过端口 80 和 443 连接到 SCC。提供连接的方法有很多。例如，在 AWS 中，可以通过 AWS Internet Gateway、AWS NAT Gateway 或通过本地数据中心 (VPN/DX Connection) 提供到 SCC 的连接，具体取决于 RMT 实例是在公共子网还是在专用子网中。GCP 通过 VPC 路由或云 NAT 服务提供直接访问互联网的途径。Azure 也提供类似的服务。
        </para>
         </listitem>
  </varlistentry>
  <varlistentry>
    <term>客户端的连接</term>
    <listitem>
      <para>
        客户端可以通过端口 80 和 443 连接到 RMT。启动支持 RMT 的 SLES 实例时，请检查网络连接是否允许从客户端 (HTTP/HTTPS) 入站访问 RMT 服务器。对于 AWS，当启动 SLES 实例以支持 RMT 时，可以使用现有的 AWS 安全组或新建的 AWS 安全组。安全组必须配置为允许从客户端入站访问 RMT 服务器。对于 GCP，防火墙规则必须配置为允许从客户端入站访问 RMT 服务器。
   </para>
         </listitem>
  </varlistentry>
</variablelist>
</sect1>
<sect1>
  <title>更多信息</title>
   <itemizedlist mark="bullet" spacing="normal">
      <listitem>
       <para>
        <link xlink:href="https://documentation.suse.com/sles/15-SP6/html/SLES-all/cha-rmt-mirroring.html#sec-rmt-mirroring-credentials"></link> 用于创建 SUSE Linux Enterprise 储存库的本地镜像的组织身份凭证。
       </para>
      </listitem>
      <listitem>
       <para>
        <link xlink:href="https://documentation.suse.com/sles/15-SP6/html/SLES-all/cha-register-sle.html#sec-register-sle-installation"></link> 将 SUSE Linux Enterprise Server 注册到 SUSE Customer Center 并激活。
       </para>
      </listitem>
        </itemizedlist>
</sect1>

</chapter>
