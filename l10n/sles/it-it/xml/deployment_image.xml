<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="deployment_image.xml" version="5.0" role="General" xml:id="cha-deployment-clone-image">
 <title>Clonazione delle immagini dei dischi</title>
 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:bugtracker/>
   <dm:translation>sì</dm:translation>
  </dm:docmanager>
 </info>
 <para>
  Se <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> è installato in un ambiente virtualizzato, il metodo più rapido per eseguire la distribuzione di altri computer può consistere nella clonazione di un'installazione esistente. <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> fornisce uno script per ripulire la configurazione univoca per ciascuna installazione. Con l'introduzione di systemd, vengono utilizzati e impostati identificatori univoci del sistema in ubicazioni e file diversi. Pertanto, la clonazione non è più un metodo consigliato per costruire immagini di sistema. È possibile creare immagini con KIWI, vedere <link xlink:href="https://doc.opensuse.org/projects/kiwi/doc/"/>.
 </para>
 <para>
  Per clonare dischi di computer, fare riferimento alla documentazione relativa all'ambiente di virtualizzazione.
 </para>
 <sect1 xml:id="sec-deployment-clone-image-clean">
  <title>Pulizia di identificatori di sistema univoci</title>
  <warning>
   <title>perdita di dati di configurazione importanti</title>
   <para>
    L'esecuzione della procedura seguente comporta l'eliminazione di dati di configurazione del sistema importanti. Se in produzione si utilizza il sistema di origine per il clone, eseguire lo script di pulizia nell'immagine clonata.
   </para>
  </warning>
  <para>
   Per ripulire tutti gli identificatori di sistema univoci, eseguire la procedura seguente prima o dopo la clonazione di un'immagine del disco. Se viene eseguita sul clone, è necessario eseguire questa procedura su ciascun clone. Si consiglia pertanto di creare una <literal>golden image</literal> che non viene utilizzata in produzione e serve solo come origine per i nuovi cloni. La golden image è già ripulita ed è possibile utilizzare immediatamente i cloni.
  </para>
  <para>
   Ad esempio, con il comando <command>clone-master-clean-up</command> si rimuovono: 
  </para>
  <itemizedlist>
   <listitem>
    <para>File di scambio</para>
   </listitem>
   <listitem>
    <para>Archivi Zypper</para>
   </listitem>
   <listitem>
    <para>Chiavi host e client SSH</para>
   </listitem>
   <listitem>
    <para>Directory temporanee, come <filename>/tmp/*</filename></para>
   </listitem>
   <listitem>
    <para>Dati di Postfix</para>
   </listitem>
   <listitem>
    <para>Script del firewall HANA</para>
   </listitem>
   <listitem>
    <para>Journal di systemd</para>
   </listitem>
  </itemizedlist>
  <procedure>
   <step>
    <para>
     Utilizzare <command>zypper</command> per installare <package>clone-master-clean-up</package>:
    </para>
    <screen><prompt role="root">root # </prompt><command>zypper</command> install clone-master-clean-up</screen>
   </step>
   <step>
    <para>
     Configurare il comportamento di <command>clone-master-clean-up</command> modificando <filename>/etc/sysconfig/clone-master-clean-up</filename>. Questo file di configurazione definisce se è necessario rimuovere gli utenti il cui UID è più grande di 1000, il file <filename>/etc/sudoers</filename>, gli archivi Zypper e gli snapshot Btrfs.
    </para>
   </step>
   <step>
    <para>
     Rimuovere la configurazione esistente e gli identificatori univoci eseguendo lo script:
    </para>
    <screen><prompt role="root">root # </prompt><command>clone-master-clean-up</command></screen>
   </step>
  </procedure>
 </sect1>
</chapter>
