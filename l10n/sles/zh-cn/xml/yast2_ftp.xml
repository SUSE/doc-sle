<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="yast2_ftp.xml" version="5.0" xml:id="cha-ftp">
 <title>使用 YaST 设置 FTP 服务器</title>
 <info>
  <abstract>
   <para>
    使用 YaST <guimenu>FTP 服务器</guimenu>模块，可以将计算机配置为 FTP（文件传输协议）服务器。匿名用户和/或经身份验证的用户可以连接到您的计算机并使用 FTP 协议下载文件。根据配置，可能还可以将文件上载到 FTP 服务器。YaST 使用 vsftpd（非常安全的 FTP 守护程序）。
   </para>
  </abstract>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:bugtracker/>
   <dm:translation>yes</dm:translation>
  </dm:docmanager>
 </info>
 <para>
  如果 YaST FTP 服务器模块在您的系统中不可用，请安装 <systemitem class="resource">yast2-ftp-server</systemitem> 软件包。（有关如何从命令行管理 FTP 服务器，请参见<xref linkend="sec-yast-ftp-server"/>。）
 </para>
 <para>
  要使用 YaST 配置 FTP 服务器，请执行以下步骤：
 </para>
 <procedure>
  <step>
   <para>
    打开 YaST 控制中心并选择<menuchoice> <guimenu>网络服务</guimenu> <guimenu> FTP 服务器</guimenu> </menuchoice>，或以 <systemitem class="username">root</systemitem> 身份运行 <command>yast2 ftp-server</command> 命令。
   </para>
  </step>
  <step>
   <para>
    如果您的系统未安装任何 FTP 服务器，YaST FTP 服务器模块启动时将询问您要安装哪个服务器。选择 vsftpd 服务器并确认该对话框中。
   </para>
  </step>
  <step>
   <para>
    在<guimenu>启动</guimenu>对话框中，配置 FTP 服务器的启动选项。有关详细信息，请参见<xref linkend="sec-ftp-start"/>。
   </para>
   <para>
    在<guimenu>常规</guimenu>对话框中，配置 FTP 目录、欢迎消息、文件创建掩码和其他参数。有关详细信息，请参见<xref linkend="sec-ftp-general"/>。
   </para>
   <para>
    在<guimenu>性能</guimenu>对话框中，设置会影响 FTP 服务器负载的参数。有关详细信息，请参见<xref linkend="sec-ftp-performance"/>。
   </para>
   <para>
    在<guimenu>身份验证</guimenu>对话框中，设置匿名用户和/或已通过身份验证的用户是否可以使用 FTP 服务器。有关详细信息，请参见<xref linkend="sec-ftp-auth"/>。
   </para>
   <para>
    在<guimenu>专家设置</guimenu>对话框中，配置 FTP 服务器的操作模式、SSL 连接和防火墙设置。有关详细信息，请参见<xref linkend="sec-ftp-expert"/>。
   </para>
  </step>
  <step>
   <para>
    单击<guimenu>完成</guimenu>以保存配置。
   </para>
  </step>
 </procedure>
 <sect1 xml:id="sec-ftp-start">
  <title>启动 FTP 服务器</title>

  <para>
   在 <guimenu>FTP 启动</guimenu>对话框的<guimenu>服务启动</guimenu>框架中，设置 FTP 的启动方式。可以在系统引导期间自动启动服务器和手动启动服务器之间选择。如果 FTP 服务器应该在收到 FTP 连接请求后才启动，请选择<guimenu>通过套接字</guimenu>。
  </para>

  <para>
   FTP 服务器的当前状态显示在 <guimenu>FTP 启动</guimenu>对话框的<guimenu>打开和关闭</guimenu>框架中。通过单击<guimenu>立即启动 FTP</guimenu> 来启动 FTP 服务器。要停止服务器，请单击<guimenu>立即停止 FTP</guimenu>。更改服务器设置后，单击<guimenu>立即保存设置并重启动 FTP</guimenu>。使用<guimenu>完成</guimenu>离开配置模块也将保存您的配置。
  </para>

  <figure xml:id="fig-yast2-ftp-start-up">
   <title>FTP 服务器配置 — 启动</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="yast2_ftp-start-up.png" width="75%"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="yast2_ftp-start-up.png" width="75%"/>
    </imageobject>
   </mediaobject>
  </figure>
 </sect1>
 <sect1 xml:id="sec-ftp-general">
  <title>FTP 常规设置</title>

  <para>
   在 <guimenu>FTP 常规设置</guimenu>对话框的<guimenu>常规设置</guimenu>框架中，可以设置连接到 FTP 服务器后会显示的<guimenu>欢迎消息</guimenu>。
  </para>

  <para>
   如果选中 <guimenu>Chroot 任何人</guimenu>选项，登录后会将所有本地用户放入其用户主目录的 chroot jail 中。此选项会牵涉到安全性问题，尤其是在用户拥有上载许可权限或进行外壳访问时，所以启用此选项时请务必小心。
  </para>

  <para>
   如果选中<guimenu>详细日志记录</guimenu>选项，就会将所有 FTP 请求和响应记录在日志中。
  </para>

  <para>
   可以限制由匿名用户和/或已通过身份验证的用户使用 umask 创建的文件的许可权限。在<guimenu>匿名 Umask</guimenu> 中为匿名用户设置文件创建掩码，在<guimenu>已通过身份验证的用户的 Umask</guimenu> 中为已通过身份验证的用户设置文件创建掩码。掩码应输入为带有前导零的八进制数字。有关 umask 的更多信息，请参见 umask 手册页 (<command>man 1p umask</command>)。
  </para>

  <para>
   在 <guimenu>FTP 目录</guimenu>框架中，设置用于匿名用户和已通过身份验证的用户的目录。按<guimenu>浏览</guimenu>可以从本地文件系统选择要使用的目录。匿名用户的默认 FTP 目录为 <filename>/srv/ftp</filename>。请注意，vsftpd 并未允许所有用户都可对此目录进行写操作。将改为创建带有匿名用户的写许可权限的子目录 <filename>upload</filename>。
  </para>
 </sect1>
 <sect1 xml:id="sec-ftp-performance">
  <title>FTP 性能设置</title>

  <para>
   在<guimenu>性能</guimenu>对话框中，设置会影响 FTP 服务器负载的参数。<guimenu>最大闲置时间</guimenu>是远程客户端在 FTP 命令间可能会花费的最长时间（以分钟为单位）。如果长时间处于非活动状态，远程客户端会断开。<guimenu>单 IP 最大连接数</guimenu>确定了可从单个 IP 地址连接的最大客户端数。<guimenu>最大用户数</guimenu>确定了可连接的最大客户端数。任何其他客户端都将收到错误消息。
  </para>

  <para>
   最大数据传送速度（以 KB/s 为单位）分别是在本地已通过身份验证的用户的<guimenu>本地最大速度</guimenu>和匿名客户端的<guimenu>匿名用户最高速度</guimenu>中设置的。速度设置的默认值为 <literal>0</literal>，表示数据传送速度不受限制。
  </para>
 </sect1>
 <sect1 xml:id="sec-ftp-auth">
  <title>身份验证</title>

  <para>
   在<guimenu>身份验证</guimenu>对话框的<guimenu>启用/禁用匿名用户和本地用户</guimenu>框架中，可以设置允许访问您的 FTP 服务器的用户。您可以在以下选项中选择：仅为匿名用户授予访问权限、仅为经身份验证的用户授予访问权限或为两种类型的用户授予访问权限。
  </para>

  <para>
   要允许用户将文件上载到 FTP 服务器，请选中<guimenu>身份验证</guimenu>对话框<guimenu>上载</guimenu>框架中的<guimenu>启用上载</guimenu>。在此处选中相应的框，您就可以允许包括匿名用户在内的用户上载或创建目录。
  </para>

  <note>
   <title>vsftp — 允许匿名用户上载文件</title>
   <para>
    如果使用的是 vsftpd 服务器且希望匿名用户可以上载文件或创建目录，则需要在匿名 FTP 目录中创建所有用户都有写权限的子目录。
   </para>
  </note>
 </sect1>
 <sect1 xml:id="sec-ftp-expert">
  <title>专家设置</title>

  <para>
   FTP 服务器可以在主动或被动模式下运行。默认情况下，服务器在被动模式下运行。要切换到主动模式中，请取消选择<guimenu>专家设置</guimenu>对话框中的<guimenu>启用被动模式</guimenu>选项。也可更改服务器上用于数据流的端口范围，方法是：调整<guimenu>被动模式最小端口</guimenu>和<guimenu>被动模式最大端口</guimenu>选项。
  </para>

  <para>
   如果您想在客户端与服务器之间使用加密通讯，可以<guimenu>启用 SSL</guimenu>，并额外<guimenu>启用 TLS</guimenu>。指定用于 SSL 加密连接的 RSA 证书。
  </para>

  <important>
   <para>
    新版本的 <systemitem class="daemon">vsftpd
    </systemitem> 守护程序默认会禁用早于版本 1.2 的 TLS 协议。如果使用的 FTP 客户端需要较早版本的 TLS 协议，则需要将以下配置添加到 <filename>/etc/vsftpd.conf</filename> 文件中：
   </para>
<screen>
ssl_tlsv1 = YES
ssl_tlsv1_1 = YES
</screen>
   <para>
    然后重启动 <systemitem class="daemon">vsftpd</systemitem> 守护程序以重新读取配置：
   </para>
<screen><prompt>&gt; </prompt><command>sudo</command> systemctl restart vsftpd.service</screen>
  </important>

  <para>
   如果您的系统受到防火墙的保护，请选中<guimenu>打开防火墙中的端口</guimenu>以启用至 FTP 服务器的连接。
  </para>
 </sect1>
 <sect1 xml:id="sec-ftp-info">
  <title>更多信息</title>

  <para>
   有关 FTP 服务器的更多信息，请参见 <command>vsftpd</command> 和 <command>vsftpd.conf</command> 的手册页。
  </para>
 </sect1>
</chapter>
