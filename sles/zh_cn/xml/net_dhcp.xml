<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="net_dhcp.xml" version="5.0" xml:id="cha.dhcp">

 <title>DHCP</title>
 <info>
  <abstract>
   <para>
    <emphasis>动态主机配置协议</emphasis> (DHCP) 用于从服务器集中指派网络设置，如此就不必在每个工作站本地配置这些设置。被配置为使用 DHCP 的主机不能控制它自己的静态地址。DHCP 使它能够根据服务器的指示完全且自动地对自身进行配置。如果在客户端使用 NetworkManager，则无需配置客户端。在更改了环境并且一次只能使用一个活动的接口时，它才有用。请勿在运行 DHCP 服务器的机器上使用 NetworkManager。
   </para>
  </abstract>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:bugtracker/>
   <dm:translation>yes</dm:translation>
  </dm:docmanager>
 </info>
<indexterm class="startofrange" xml:id="idx.DHCP">
 <primary>DHCP</primary></indexterm><indexterm>
 <primary>网络</primary>
 <secondary>DHCP</secondary></indexterm><indexterm>
 <primary>IP 地址</primary>
 <secondary>动态指派</secondary></indexterm>
 <tip arch="zseries" os="sles">
  <title>IBM z Systems：DHCP 支持</title>
  <para>
   在 IBM z Systems 平台上，DHCP 仅在使用 OSA 和 OSA Express 网卡的接口上起作用。现在只有这些网卡具有 MAC，因为需要 MAC 来实现 DHCP 自动配置功能。
  </para>
 </tip>
 <para>
  配置 DHCP 服务器的方法之一是使用网卡的硬件地址（在大多数情况下应是固定的）来标识每个客户端，然后在客户端每次连接到服务器时为它提供相同的设置。另一种方法是对 DHCP 进行配置，从为此设置的地址池来为每个相关客户端动态指派地址。在后一种情况下，DHCP 服务器每次在收到客户端请求时都会尝试向它指派相同的地址，即使相隔较长的时间也是如此。只有在网络中包含的客户端数不超过地址数时，它才生效。
 </para>
 <para>
  DHCP 简化了系统管理员的工作。与地址和网络配置相关的任何更改（甚至是较大的更改）一般都可以通过编辑服务器的配置文件来集中完成。这比重配置众多工作站要方便得多。此外，还可以更方便地将计算机（尤其是新计算机）集成到网络中，因为现在可以从池中为它们指派 IP 地址。如果经常在不同的网络中使用便携式计算机，则从 DHCP 服务器检索适当的网络设置特别有用。
 </para>
 <para>
  在本章中，DHCP 服务器将在工作站所在的子网内运行，即 <systemitem class="ipaddress">192.168.2.0/24</systemitem>（网关为 <systemitem class="ipaddress">192.168.2.1</systemitem>）。它具有固定的 IP 地址 <systemitem class="ipaddress">192.168.2.254</systemitem>，并提供两个地址范围：<systemitem class="ipaddress">192.168.2.10</systemitem> 至 <systemitem class="ipaddress">192.168.2.20</systemitem>，<systemitem class="ipaddress">192.168.2.100</systemitem> 至 <systemitem class="ipaddress">192.168.2.200</systemitem>。
 </para>
 <para>
  DHCP 服务器不仅提供了 IP 地址和网络掩码，还提供了客户机要使用的主机名、域名、网关和名称服务器地址。此外，DHCP 还允许您集中配置多个其他参数，例如客户端可能从中巡回检测当前时间的时间服务器，甚至是打印服务器。
 </para>
 <sect1 xml:id="sec.dhcp.yast">
  <title>使用 YaST 配置 DHCP 服务器</title>

<indexterm>

  <primary>YaST</primary>

  <secondary>DHCP</secondary></indexterm><indexterm>

  <primary>DHCP使用 YaST 配置</primary>

  <secondary/></indexterm>

  <para>
   要安装 DHCP 服务器，请启动 YaST 并选择<menuchoice><guimenu>软件</guimenu> <guimenu> 软件管理</guimenu></menuchoice>。选择<menuchoice><guimenu>过滤器</guimenu>
   <guimenu> 模式</guimenu></menuchoice>，然后选择 <guimenu>DHCP 和 DNS 服务器</guimenu>。确认安装相关的包来完成安装进程。
  </para>

  <important>
   <title>LDAP 支持</title>
   <para>
    可以将 YaST DHCP 模块设置为在本地储存服务器配置（即运行 DHCP 服务器的主机上），或使其配置数据由 LDAP 服务器管理。如果要使用 LDAP，请在配置 DHCP 服务器前设置 LDAP 环境。
   </para>
   <para>
    有关 LDAP 的更多信息，请参见<xref linkend="cha.security.ldap"/>。
   </para>
  </important>

  <para>
   使用 YaST DHCP 模块 (<systemitem>yast2-dhcp-server</systemitem>) 可将自己的 DHCP 服务器设置用于本地网络。此模块能以向导模式或专家配置模式运行。
  </para>

  <sect2 xml:id="sec.dhcp.yast.init">
   <title>初始配置（向导）</title>
   <para>
    第一次启动此模块时，向导启动，提示您做出一些有关服务器管理的基本决定。完成此初始设置将生成一个非常基本的服务器配置，此配置可以使服务器在各基本方面正常工作。专家方式可用于处理更高级的配置任务。按如下所示继续：
   </para>
   <remark>
   It has changed in the meantime.  DHCP Server Configuration ("expert mode")
   now allows more detailed configuration.  2010-06-22, ke.
  </remark>
   <procedure xml:id="pro.dhcp.yast.init">
    <step>
     <para>
      从该列表中选择 DHCP 服务器应侦听的接口，然后单击<guimenu>选择</guimenu>。随后，请选择<guimenu>针对所选接口打开防火墙</guimenu>打开此接口的防火墙，单击<guimenu>下一步</guimenu>。请参见<xref linkend="fig.yast2.dhcp.wiz1"/>。
     </para>
     <figure xml:id="fig.yast2.dhcp.wiz1">
      <title>DHCP 服务器：卡选择</title>
      <mediaobject>
       <imageobject role="fo">
        <imagedata width="75%" fileref="yast2_dhcp_wiz1.png" format="PNG"/>
       </imageobject>
       <imageobject role="html">
        <imagedata width="75%" fileref="yast2_dhcp_wiz1.png" format="PNG"/>
       </imageobject>
      </mediaobject>
     </figure>
    </step>
    <step>
     <para>
      使用此复选框来确定是否由 LDAP 服务器自动储存您的 DHCP 设置。在文本框中，提供 DHCP 服务器应管理的所有客户端的网络细节。这些细节包括域名、时间服务器地址、主名称服务器和二级名称服务器的地址、打印和 WINS 服务器的地址（对于同时包含 Windows 和 Linux 客户端的混合网络）、网关地址和租用时间。请参见<xref linkend="fig.yast2.dhcp.wiz2"/>。
     </para>
     <figure xml:id="fig.yast2.dhcp.wiz2">
      <title>DHCP 服务器：全局设置</title>
      <mediaobject>
       <imageobject role="fo">
        <imagedata width="75%" fileref="yast2_dhcp_wiz2.png" format="PNG"/>
       </imageobject>
       <imageobject role="html">
        <imagedata width="75%" fileref="yast2_dhcp_wiz2.png" format="PNG"/>
       </imageobject>
      </mediaobject>
     </figure>
    </step>
    <step>
     <para>
      配置如何为客户端指派动态 IP 地址。为此，应首先指定服务器为 DHCP 客户端指派地址时使用的 IP 范围。所有这些地址必须由同一个网络掩码来覆盖。还要指定租用时间，在此期间客户端可以保留它的 IP 地址，而无需请求续期。也可以选择指定最长租用时间，这是服务器为特定客户端保留某个 IP 地址的时间。请参见<xref linkend="fig.yast2.dhcp.wiz3"/>。
     </para>
     <figure xml:id="fig.yast2.dhcp.wiz3">
      <title>DHCP 服务器：动态 DHCP</title>
      <mediaobject>
       <imageobject role="fo">
        <imagedata width="75%" fileref="yast2_dhcp_wiz3.png" format="PNG"/>
       </imageobject>
       <imageobject role="html">
        <imagedata width="75%" fileref="yast2_dhcp_wiz3.png" format="PNG"/>
       </imageobject>
      </mediaobject>
     </figure>
    </step>
    <step>
     <para>
      定义 DHCP 服务器应如何启动。指定 DHCP 服务器是在引导系统时自动启动还是在需要时（例如进行测试时）手动启动。单击<guimenu>完成</guimenu>以完成对服务器的配置。请参见<xref linkend="fig.yast2.dhcp.start"/>。

     </para>
     <figure xml:id="fig.yast2.dhcp.start">
      <title>DHCP 服务器：启动</title>
      <mediaobject>
       <imageobject role="fo">
        <imagedata width="75%" fileref="yast2_dhcp_start.png" format="PNG"/>
       </imageobject>
       <imageobject role="html">
        <imagedata width="75%" fileref="yast2_dhcp_start.png" format="PNG"/>
       </imageobject>
      </mediaobject>
     </figure>
    </step>
    <step os="sles;osuse">
     <para>
      除了按上文所述方式使用动态 DHCP 之外，您也可以将服务器配置为以准静态方式指派地址。使用窗口下部提供的文本框来指定要以此方式管理的一组客户端。具体地说就是提供客户端的<guimenu>名称</guimenu>和 <guimenu>IP 地址</guimenu>，以及<guimenu>硬件地址</guimenu>和<guimenu>网络类型</guimenu>（令牌环或以太网）。使用<guimenu>添加</guimenu>、<guimenu>编辑</guimenu>和<guimenu>从列表中删除</guimenu>来修改在窗口上部显示的客户端列表。请参见<xref linkend="fig.yast2.dhcp.statdhcp"/>。
     </para>
     <figure xml:id="fig.yast2.dhcp.statdhcp">
      <title>DHCP 服务器：主机管理</title>
      <mediaobject>
       <imageobject role="fo">
        <imagedata width="75%" fileref="yast2_dhcp_statdhcp.png" format="PNG"/>
       </imageobject>
       <imageobject role="html">
        <imagedata width="75%" fileref="yast2_dhcp_statdhcp.png" format="PNG"/>
       </imageobject>
      </mediaobject>
     </figure>
    </step>
   </procedure>
  </sect2>

  <sect2 xml:id="sec.dhcp.yast.expert" os="sles;osuse">
   <title>DHCP 服务器配置（专家）</title>
   <para>
    除了前面介绍的配置方法外，还有一种专家配置方式，用于从方方面面精确调整 DHCP 服务器设置。单击<guimenu>启动</guimenu>对话框中的 <guimenu>DHCP 服务器专家配置</guimenu>（参见<xref linkend="fig.yast2.dhcp.start"/>）以启动专家配置。
   </para>
   <variablelist>
    <varlistentry>
     <term>Chroot 环境和声明</term>
     <listitem>
      <para>
       在第一个对话框中，选择<guimenu>启动 DHCP 服务器</guimenu>，使现有的配置可编辑。DHCP 服务器的行为的一个重要功能就是它能够在 chroot 环境或 chroot jail 中运行，以保证服务器主机的安全。如果 DHCP 服务器受到了外部攻击，则攻击者仍将被封锁在 chroot jail 中，从而阻止他们进入系统的其他部分。对话框的下部显示了一个树视图，列出了已经定义的声明。请使用<guimenu>添加</guimenu>、<guimenu>删除</guimenu>和<guimenu>编辑</guimenu>来修改它们。如果选择<guimenu>高级</guimenu>，就会进入其他专家对话框。参见 <xref linkend="fig.yast2.dhcp.chroot"/>。选择<guimenu>添加</guimenu>后，请定义要添加的声明的类型。使用<guimenu>高级</guimenu>，可查看服务器的日志文件、配置 TSIG 密钥管理以及根据 DHCP 服务器的设置调整防火墙的配置。
      </para>
      <figure xml:id="fig.yast2.dhcp.chroot">
       <title>DHCP 服务器：Chroot Jail 和声明</title>
       <mediaobject>
        <imageobject role="fo">
         <imagedata width="75%" fileref="yast2_dhcp_chroot.png" format="PNG"/>
        </imageobject>
        <imageobject role="html">
         <imagedata width="75%" fileref="yast2_dhcp_chroot.png" format="PNG"/>
        </imageobject>
       </mediaobject>
      </figure>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>选择声明类型</term>
     <listitem>
      <para>
       DHCP 服务器的<guimenu>全局选项</guimenu>由若干声明组成。使用此对话框可设置声明类型<guimenu>子网</guimenu>、<guimenu>主机</guimenu>、<guimenu>共享网络</guimenu>、<guimenu>组</guimenu>、<guimenu>地址池</guimenu>和<guimenu>类别</guimenu>。此示例显示了新子网的选择（请参见<xref linkend="fig.yast2.dhcp.newdec"/>）。
      </para>
      <figure xml:id="fig.yast2.dhcp.newdec">
       <title>DHCP 服务器：选择声明类型</title>
       <mediaobject>
        <imageobject role="fo">
         <imagedata width="75%" fileref="yast2_dhcp_newdec.png" format="PNG"/>
        </imageobject>
        <imageobject role="html">
         <imagedata width="75%" fileref="yast2_dhcp_newdec.png" format="PNG"/>
        </imageobject>
       </mediaobject>
      </figure>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>子网配置</term>
     <listitem>
      <para>
       此对话框用于指定新子网的 IP 地址和网络掩码。在对话框的中部，使用<guimenu>添加</guimenu>、<guimenu>编辑</guimenu>和<guimenu>删除</guimenu>修改所选子网的 DHCP 服务器启动选项。要为子网设置动态 DNS，请选择<guimenu>动态 DNS</guimenu>。
      </para>
      <figure xml:id="fig.yast2.dhcp.sub">
       <title>DHCP 服务器：配置子网</title>
       <mediaobject>
        <imageobject role="fo">
         <imagedata width="75%" fileref="yast2_dhcp_sub.png" format="PNG"/>
        </imageobject>
        <imageobject role="html">
         <imagedata width="75%" fileref="yast2_dhcp_sub.png" format="PNG"/>
        </imageobject>
       </mediaobject>
      </figure>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>TSIG 密钥管理</term>
     <listitem>
      <para>
       如果在前面的对话框中选择了配置动态 DNS，现在就可以配置密钥管理来实现安全区域传送。选择<guimenu>确定</guimenu>将进入另一个对话框，在其中可以配置动态 DNS 的接口（请参见<xref linkend="fig.yast2.dhcp.dyndns"/>）。
      </para>
      <figure xml:id="fig.yast2.dhcp.tsig">
       <title>DHCP 服务器：TSIG 配置</title>
       <mediaobject>
        <imageobject role="fo">
         <imagedata width="75%" fileref="yast2_dhcp_tsig.png" format="PNG"/>
        </imageobject>
        <imageobject role="html">
         <imagedata width="75%" fileref="yast2_dhcp_tsig.png" format="PNG"/>
        </imageobject>
       </mediaobject>
      </figure>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>动态 DNS：接口配置</term>
     <listitem>
      <para>
       通过选择<guimenu>为此子网启用动态 DNS</guimenu>，可以为子网激活动态 DNS。完成激活后，请使用下拉框来激活正向和反向区域的 TSIG 密钥，确保为 DNS 和 DHCP 服务器选择相同密钥。使用<guimenu>更新全局动态 DNS 设置</guimenu>，您可以根据动态 DNS 环境自动更新和调节全局 DHCP 服务器设置。最后需要定义每个动态 DNS 应更新哪些正向和反向区域，同时分别为两个区域指定主名称服务器的名称。选择<guimenu>确定</guimenu>返回子网配置对话框（请参见<xref linkend="fig.yast2.dhcp.sub"/>）。再次选择<guimenu>确定</guimenu>将返回最初的专家配置对话框。
      </para>
      <figure xml:id="fig.yast2.dhcp.dyndns">
       <title>DHCP 服务器：动态 DNS 的接口配置</title>
       <mediaobject>
        <imageobject role="fo">
         <imagedata width="75%" fileref="yast2_dhcp_dyndns.png" format="PNG"/>
        </imageobject>
        <imageobject role="html">
         <imagedata width="75%" fileref="yast2_dhcp_dyndns.png" format="PNG"/>
        </imageobject>
       </mediaobject>
      </figure>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>网络接口配置</term>
     <listitem>
      <para>
       要定义 DHCP 服务器应侦听的接口并调整防火墙配置，请从专家配置对话框中选择<menuchoice>
       <guimenu> 高级</guimenu> <guimenu> 接口配置</guimenu>
       </menuchoice> 。从所显示的接口列表中，选择一个或多个应由 DHCP 服务器处理的接口。如果希望使所有子网中的客户端都能够与服务器通讯，同时如果服务器主机也运行防火墙，则相应调整防火墙。要执行此操作，选择<guimenu>修改防火墙设置</guimenu>。然后，YaST 将按照新的条件调整 SuSEFirewall2 的规则（请参见<xref linkend="fig.yast2.dhcp.fire"/>），之后您可以通过选择<guimenu>确定</guimenu>返回到原始对话框。
      </para>
      <figure xml:id="fig.yast2.dhcp.fire">
       <title>DHCP 服务器：网络接口和防火墙</title>
       <mediaobject>
        <imageobject role="fo">
         <imagedata width="75%" fileref="yast2_dhcp_fire.png" format="PNG"/>
        </imageobject>
        <imageobject role="html">
         <imagedata width="75%" fileref="yast2_dhcp_fire.png" format="PNG"/>
        </imageobject>
       </mediaobject>
      </figure>
     </listitem>
    </varlistentry>
   </variablelist>
   <para>
    在完成所有配置步骤后，选择<guimenu>确定</guimenu>关闭对话框。服务器现在将以新配置启动。
   </para>
  </sect2>
 </sect1>
 <sect1 xml:id="sec.dhcp.soft">
  <title>DHCP 软件包</title><indexterm>

  <primary> DHCP</primary>

  <secondary>包</secondary></indexterm> 

  <para>
   DHCP 服务器和 DHCP 客户端都适用于 SUSE Linux Enterprise Server。可用的 DHCP 服务器是 <systemitem class="daemon">dhcpd</systemitem>（由因特网系统联盟发布）。客户端提供了 <systemitem>dhcp-client</systemitem>（ISC 中也有提供）及 <systemitem>wicked</systemitem> 包附带的工具。
  </para>

  <para>
   默认情况下，<systemitem>wicked</systemitem> 工具会连同 <systemitem>wickedd-dhcp4</systemitem> 和 <systemitem>wickedd-dhcp6</systemitem> 服务一起安装。系统每次引导时，会自动启动它们，以监视 DHCP 服务器。它们不需要配置文件来执行操作，可以直接用在大多数标准设置中。对于更复杂的情况，请使用 ISC <systemitem>dhcp-client</systemitem>，它是通过配置文件 <filename>/etc/dhclient.conf</filename> 和 <filename>/etc/dhclient6.conf</filename> 来控制的。<indexterm>
   <primary>配置文件</primary>
   <secondary> dhclient.conf</secondary>
   </indexterm>
  </para>
 </sect1>
 <sect1 xml:id="sec.dhcp.server">
  <title>DHCP 服务器 dhcpd</title>

<indexterm>

  <primary>配置文件</primary>

  <secondary>dhcpd.conf</secondary></indexterm><indexterm class="startofrange" xml:id="idx.dhcp_server">

  <primary>DHCP</primary>

  <secondary>服务器</secondary></indexterm><indexterm class="startofrange" xml:id="idx.dhcp_dhcpd">

  <primary>DHCP</primary>

  <secondary>dhcpd</secondary></indexterm>

  <para>
   任何 DHCP 系统的核心都是动态主机配置协议守护程序。根据配置文件 <filename>/etc/dhcpd.conf</filename> 中定义的设置，此服务器<emphasis>租出</emphasis>地址并监视它们的使用。通过更改此文件中的参数和值，系统管理员可以在许多方面影响程序的行为。让我们看一下<xref linkend="dat.dhcp.conf"/>中的基本示例 <filename>/etc/dhcpd.conf</filename> 文件。
  </para>

  <example xml:id="dat.dhcp.conf">
   <title>配置文件 /etc/dhcpd.conf</title>
<screen>
default-lease-time 600;         # 10 minutes
max-lease-time 7200;            # 2  hours

option domain-name "example.com";
option domain-name-servers 192.168.1.116;
option broadcast-address 192.168.2.255;
option routers 192.168.2.1;
option subnet-mask 255.255.255.0;

subnet 192.168.2.0 netmask 255.255.255.0
 {
  range 192.168.2.10 192.168.2.20;
  range 192.168.2.100 192.168.2.200;
 }
</screen>
  </example>

  <para>
   这个简单的配置文件足以使 DHCP 服务器在网络中指派 IP 地址。确保在每行末尾插入一个分号，否则将不能启动 dhcpd。
  </para>

  <para>
   示例文件可以分为三部分。第一部分定义了将 IP 地址租出给请求它的客户端的默认秒数 (<literal>default-lease-time</literal>)，超过此时间就应申请续期。此部分还包含一个最大期限语句，在此期限内计算机可以保留 DHCP 服务器指派的 IP 地址而无需申请续期 (<literal>max-lease-time</literal>)。
  </para>

  <para>
   第二部分在全局级别上定义了一些基本网络参数：
  </para>

  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>
     <literal>option domain-name</literal> 行用于定义网络的默认域。
    </para>
   </listitem>
   <listitem>
    <para>
     使用 <literal>option domain-name-servers</literal> 项，最多可指定三个 DNS 服务器值，用来将 IP 地址解析为主机名，或将主机名解析为 IP 地址。理想情况下，应在设置 DHCP 之前在您的计算机上或网络中的其他位置配置一个名称服务器。这个名称服务器应为每个动态地址定义一个主机名（反之亦然）。要了解如何配置您自己的名称服务器，请参见<xref linkend="cha.dns"/>。
    </para>
   </listitem>
   <listitem>
    <para>
     行 <literal>option broadcast-address</literal> 定义了请求客户端应该使用的广播地址。
    </para>
   </listitem>
   <listitem>
    <para>
     <literal>option routers</literal> 用于设置服务器在无法将数据包发送到本地网络上的主机时应将其发送到的位置（根据所提供的源和目标主机地址以及子网掩码）。通常情况下，尤其是在较小的网络中，此路由器与因特网网关完全相同。
    </para>
   </listitem>
   <listitem>
    <para>
     <literal>option subnet-mask</literal> 用于指定为客户端指派的网络掩码。
    </para>
   </listitem>
  </itemizedlist>

  <para>
   文件的最后一部分用于定义网络，其中包含子网掩码。最后指定一个地址范围，DHCP 守护程序将使用此范围来向相关的客户端指派 IP 地址。在<xref linkend="dat.dhcp.conf"/>中，可以为客户端分配 <literal>192.168.2.10</literal> 到 <literal>192.168.2.20</literal> 之间或 <literal>192.168.2.100</literal> 到 <literal>192.168.2.200</literal> 之间的任何地址。
  </para>

  <para>
   编辑这些行后，便可以使用命令 <command>systemctl start dhcpd</command> 来激活 DHCP 守护程序。随后将可以立即使用它。使用命令 <command>rcdhcpd</command> <option>check-syntax</option> 来执行简单的语法检查。如果配置时出现任何意外问题（例如服务器由于错误而中止或在启动时不返回 <literal>done</literal>），您可以使用命令 <command>journalctl</command> 查询主系统日志中的信息，找出问题所在（有关更多信息，请参见<xref linkend="cha.journalctl"/>）。
  </para>

  <para>
   在默认的 <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> 系统上，出于安全考虑，将在 chroot 环境中启动 DHCP 守护程序。必须将配置文件复制到 chroot 环境，以便守护程序能够找到它们。通常情况下无需担心这一点，因为命令 <command>systemctl start dhcpd</command> 会自动复制这些文件。
  </para><indexterm class="endofrange" startref="idx.dhcp_server"/><indexterm class="endofrange" startref="idx.dhcp_dhcpd"/>

  <sect2 xml:id="sec.dhcp.statip">
   <title>具有固定 IP 地址的客户端</title><indexterm>
   <primary> DHCP</primary>
   <secondary>静态地址指派</secondary></indexterm> 
   <para>
    DHCP 可用来向特定客户端指派预定义的静态地址。显式指派的地址始终优先于来自地址池的动态地址。静态地址永远不会像动态地址那样过期。例如，对于动态地址而言，如果没有足够的地址可用，服务器需要在客户端之间重新分发这些地址。
   </para>
   <para>
    要标识使用静态地址配置的客户端，dhcpd 会使用硬件地址（这是一个全球唯一的固定数字代码，其中包含 6 对八位组），用于标识所有网络设备（例如 <literal>00:30:6E:08:EC:80</literal>）。如果将相应的各行（如<xref linkend="dat.dhcp.conf.add"/>中的行）添加到<xref linkend="dat.dhcp.conf"/>的配置文件，DHCP 守护程序会将相同的一组数据指派到相应的客户端。
   </para>
   <example xml:id="dat.dhcp.conf.add">
    <title>配置文件的添加项</title>
<screen>host jupiter {
hardware ethernet 00:30:6E:08:EC:80;
fixed-address 192.168.2.100;
}</screen>
   </example>
   <para>
    在第一行输入相应客户端的名称（<literal>host</literal>
    <replaceable> 主机名</replaceable>，在本例中为 <systemitem>jupiter</systemitem>），在第二行输入 MAC 地址。在 Linux 主机上，使用命令 <command>ip </command>
    <option>link show</option> 后跟网络设备（例如 <literal>eth0</literal>）来查找 MAC 地址。输出应包含如下内容：
   </para>
<screen>link/ether 00:30:6E:08:EC:80</screen>
   <para>
    在上面的示例中，会为网卡的 MAC 地址为 <literal>00:30:6E:08:EC:80</literal> 的客户端自动指派 IP 地址 <systemitem class="ipaddress">192.168.2.100</systemitem> 和主机名 <literal>jupiter</literal>。虽然也支持在 IBM 系统上常见的 <literal>token-ring</literal>，但在几乎所有情况下，要输入的硬件类型都是 <literal>以太网</literal>，
   </para>
  </sect2>

  <sect2 xml:id="sec.dhcp.sle">
   <title><phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> 版本</title>
   <para>
    为了提高安全性，<phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> 版本的 ISC DHCP 服务器已应用了 Ari Edelkind 的 non-root/chroot 增补程序。这使得 dhcpd 能够使用用户 ID <systemitem class="username">nobody</systemitem> 来运行，并可以在 chroot 环境 (<filename>/var/lib/dhcp</filename>) 中运行。要实现这一点，必须使配置文件 <filename>dhcpd.conf</filename> 位于 <filename>/var/lib/dhcp/etc</filename> 中。init 脚本在启动时会自动将文件复制到此目录。
   </para>
   <para>
    通过文件 <filename>/etc/sysconfig/dhcpd</filename> 中的项来控制与此特性相关的服务器的行为。如果不希望在 chroot 环境中运行 dhcpd，请将 <filename>/etc/sysconfig/dhcpd</filename> 中的变量 <systemitem>DHCPD_RUN_CHROOTED</systemitem> 设置为 <quote>no</quote>。
   </para>
   <para>
    为了使 dhcpd 甚至能够解析来自 chroot 环境的主机名，还必须复制其他一些配置文件：
   </para>
   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>
      <filename>/etc/localtime</filename>
     </para>
    </listitem>
    <listitem>
     <para>
      <filename>/etc/host.conf</filename>
     </para>
    </listitem>
    <listitem>
     <para>
      <filename>/etc/hosts</filename>
     </para>
    </listitem>
    <listitem>
     <para>
      <filename>/etc/resolv.conf</filename>
     </para>
    </listitem>
   </itemizedlist>
   <para>
    在启动 init 脚本时，将把这些文件复制到 <filename>/var/lib/dhcp/etc/</filename>。如果通过 <filename>/etc/ppp/ip-up</filename> 这样的脚本动态修改这些文件，则无论这些文件需要任何更改，都必须同时考虑这些副本。但是，如果配置文件仅指定 IP 地址（而不是主机名），就不需要担心这一点。
   </para>
   <para>
    如果您的配置中包含应复制到 chroot 环境中的其他文件，请在文件 <filename>etc/sysconfig/dhcpd</filename> 中的变量 <systemitem>DHCPD_CONF_INCLUDE_FILES</systemitem> 下设置它们。为了确保 DHCP 日志记录功能即使在 syslog 守护程序重启动后仍然起作用，文件 <systemitem>/etc/sysconfig/syslog</systemitem> 中必须有附加项 <filename>SYSLOGD_ADDITIONAL_SOCKET_DHCP</filename>。
   </para>
  </sect2>
 </sect1>
 <sect1 xml:id="sec.dhcp.addinfo">
  <title>更多信息</title>

  <para>
   有关 DHCP 的更多信息，请访问<emphasis>因特网系统联盟</emphasis>网站 (<link xlink:href="http://www.isc.org/products/DHCP/"/>)。也可在 <option>dhcpd</option>、<option>dhcpd.conf</option>、<option>dhcpd.leases</option> 和 <option>dhcp-options</option> 手册页中获得相关信息。
  </para><indexterm class="endofrange" startref="idx.DHCP"/>
 </sect1>
</chapter>
