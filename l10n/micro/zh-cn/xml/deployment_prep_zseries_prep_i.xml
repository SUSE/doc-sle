<?xml version="1.0" encoding="UTF-8"?>
<sect1 xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="deployment_prep_zseries_prep_i.xml" version="5.0" xml:id="sec-zseries-prep">
 <title>安装准备工作</title>

 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:bugtracker/>
   <dm:translation>yes</dm:translation>
  </dm:docmanager>
 </info>

 <para>
  本章介绍如何提供安装所需的数据、如何使用不同的方法安装 <phrase role="productname"><phrase os="slemicro">SUSE Linux Enterprise Micro</phrase></phrase>，以及如何准备和使用 <phrase role="productname"><phrase os="slemicro">SUSE Linux Enterprise Micro</phrase></phrase> 安装系统的 IPL。本章还提供有关网络配置和网络安装的信息。
 </para>

 <sect2 xml:id="sec-prep-makeavail">
  <title>提供安装数据</title>
  <para>
   本节详细说明如何提供 <phrase role="productname"><phrase os="slemicro">SUSE Linux Enterprise Micro</phrase></phrase> IBM Z 安装所需的安装数据。根据您的计算机环境和系统环境，选择 NFS 或 FTP 安装。如果您的环境中运行的是 Microsoft Windows 工作站，您可以使用 Windows 网络（包括 SMB 协议）在 IBM Z 系统上安装 <phrase role="productname"><phrase os="slemicro">SUSE Linux Enterprise Micro</phrase></phrase>。
  </para>
  <tip>
   <title>从 DVD 进行 IPL 操作</title>
   <para>
    可以从 DVD 执行 IPL，并使用 DVD 作为安装媒体。如果在设置通过网络提供安装媒体的安装服务器方面有限制，这会非常方便。前提是 FCP 挂接式 SCSI DVD 驱动器。
   </para>
  </tip>
  <note>
   <title>无法从硬盘安装</title>
   <para>
    不能通过将 DVD 内容放入 DASD 上的分区来从硬盘执行安装。
   </para>
  </note>
  <sect3 xml:id="sec-prep-makeavail-linuxws">
   <title>使用 Linux 工作站或 <phrase role="productname"><phrase os="slemicro">SUSE Linux Enterprise Micro</phrase></phrase> DVD</title>
   <para>
    可以在计算机环境中使用一个 Linux 工作站，以通过 NFS 或 FTP 将安装数据提供给 IBM Z 安装过程。
   </para>
   <important>
    <title>通过 NFS 导出已挂载设备</title>
    <para>
     导出文件系统根目录 (<filename>/</filename>) 不会自动导出挂载的设备（如 DVD）。因此，需要在 <filename>/etc/exports</filename> 中明确指定挂载点：
    </para>
<screen>/media/dvd  *(ro)</screen>
    <para>
     修改此文件后,使用 <command>sudo systemctl restart nfsserver</command> 重新启动 NFS 服务器。
    </para>
   </important>
   <para>
    要在 Linux 系统上设置 FTP 服务器，需要安装并配置服务器软件，例如 <package>vsftpd</package>。不支持通过匿名登录方式下载安装数据，因此您需要配置 FTP 服务器以支持用户身份验证。
   </para>
   <sect4 xml:id="sec-prep-makeavail-linuxws-oncd">
    <title>DVD 中的 <phrase role="productname"><phrase os="slemicro">SUSE Linux Enterprise Micro</phrase></phrase></title>
    <para>
     <phrase role="productname"><phrase os="slemicro">SUSE Linux Enterprise Micro</phrase></phrase> for IBM Z 的第一个安装媒体中包含一个用于基于 Intel 的工作站的可引导 Linux 映像，以及一个用于 IBM Z 的映像。
    </para>
    <para>
     对于基于 Intel 的工作站，请从此媒体引导。出现提示时，请选择所需的应答语言和键盘布局，然后选择<guimenu>启动救援系统</guimenu>。这个操作至少需要 64 MB RAM。不需要任何磁盘空间，因为整个救援系统驻留在工作站的 RAM 中。此方法需要手动设置工作站的网络。
    </para>
    <para>
     对于 IBM Z，请按<xref linkend="sec-prep-ipling-lpar-dvd"/>中所述从此媒体对 LPAR/VM guest 执行 IPL 操作。输入网络参数之后，安装系统会将该媒体视为安装数据的来源。由于 IBM Z 不能直接挂接支持 X11 的终端，因此请选择要执行 VNC 还是 SSH 安装。SSH 还提供一种图形安装，方式是使用 <command>ssh -X</command> 通过 SSH 为 X 连接提供隧道。
    </para>
   </sect4>
  </sect3>
  <sect3 xml:id="sec-prep-makeavail-windowsws">
   <title>使用 Microsoft Windows 工作站</title>
   <para>
    可以使用网络中的 Microsoft Windows 工作站来使安装媒体可用。为此，最简单的方法是使用 SMB 协议。请务必激活 <guimenu>SMB over TCP/IP</guimenu>，这样才能将 SMB 软件包封装到 TCP/IP 软件包中。有关详细信息，请参见 Windows 联机帮助或其他有关 Windows 并含网络内容的文档。
   </para>
   <sect4 xml:id="sec-prep-makeavail-windowsws-smb">
    <title>使用 SMB</title>
    <para>
     要使安装媒体可以配合 SMB 使用，请将包含 SLE-15-SP5-Online-<replaceable>ARCH</replaceable>-GM-media1.iso 的 USB 闪存盘插入 Windows 工作站的 USB 端口。然后，使用 USB 闪存盘盘符创建一个新的共享，并使其对网络中的每个人可用。
    </para>
    
    <para>
     YaST 中的安装路径可以是：
    </para>
<screen>smb://<replaceable>DOMAIN</replaceable>;<replaceable>USER</replaceable>:<replaceable>PW</replaceable>@<replaceable>SERVERNAME</replaceable>/<replaceable>SHAREPATH</replaceable></screen>
    <para>
     其中各占位符的含义如下：
    </para>
    <variablelist>
     <varlistentry>
      <term><replaceable>DOMAIN</replaceable></term>
      <listitem>
       <para>
        可选工作组或活动的目录域。
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term><replaceable>USER</replaceable></term>
      <term><replaceable>PW</replaceable></term>
      <listitem>
       <para>
        可以访问此服务器及其共享的用户的可选用户名和口令。
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term><replaceable>SERVERNAME</replaceable></term>
      <listitem>
       <para>
        共享内容所在的服务器的名称。
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term><replaceable>SHAREPATH</replaceable></term>
      <listitem>
       <para>
        共享内容的路径。
       </para>
      </listitem>
     </varlistentry>
    </variablelist>
    <para/>
   </sect4>
   <sect4 xml:id="sec-prep-makeavail-windowsws-nfs">
    <title>通过 NFS</title>
    <para>
     参见为 Windows 工作站激活 NFS 服务器服务的第三方产品的文档。包含 SLE-15-SP5-Online-<replaceable>ARCH</replaceable>-GM-media1.iso 媒体的 USB 闪存盘必须位于可用的 NFS 路径。
    </para>
   </sect4>
   <sect4 xml:id="sec-prep-makeavail-windowsws-ftp">
    <title>使用 FTP</title>
    <para>
     参考用于在 Windows 工作站上启用 FTP 服务器服务的第三方产品随附的文档。包含 SLE-15-SP5-Online-<replaceable>ARCH</replaceable>-GM-media1.iso 媒体的 USB 闪存盘必须位于可用的 FTP 路径。
    </para>
    <para>
     某些 Microsoft Windows 版本捆绑提供的 FTP 服务器仅实施了一部分 FTP 命令，不适合用来提供安装数据。在这种情况下，请使用能够提供所需功能的第三方 FTP 服务器。
    </para>
   </sect4>
   <sect4 xml:id="sec-prep-makeavail-windowsws-scsi">
    <title>使用通过 FCP 挂接的 SCSI DVD 驱动器</title>
    <para>
     如<xref linkend="sec-prep-ipling-lpar-dvd"/>所述从 SCSI DVD 进行 IPL 操作之后，安装系统即使用 DVD 作为安装媒体。在这种情况下，FTP、NFS 或 SMB 服务器上不需要安装媒体。但您需要有 <phrase role="productname"><phrase os="slemicro">SUSE Linux Enterprise Micro</phrase></phrase> 的网络配置数据，因为在安装期间必须设置网络，以通过 VNC 或 X 执行图形安装。
    </para>
   </sect4>
  </sect3>
  <sect3 xml:id="sec-prep-makeavail-zpxe-cobbler">
   <title>针对 zPXE 使用 Cobbler 服务器</title>
   <para>
    若要从网络实现 IPL 操作，则要求 Cobbler 服务器提供内核、initrd 和安装数据。Cobbler 服务器的准备工作包括以下步骤：
   </para>
   <itemizedlist>
    <listitem>
     <para>
      <xref xrefstyle="select:label nopage" linkend="sec-prep-makeavail-zpxe-cobbler-import"/>
     </para>
    </listitem>
    <listitem>
     <para>
      <xref xrefstyle="select:label nopage" linkend="sec-prep-makeavail-zpxe-cobbler-add-distro"/>
     </para>
    </listitem>
    <listitem>
     <para>
      <xref xrefstyle="select:label nopage" linkend="sec-prep-makeavail-zpxe-cobbler-profile"/>
     </para>
    </listitem>
    <listitem>
     <para>
      <xref xrefstyle="select:label nopage" linkend="sec-prep-makeavail-zpxe-cobbler-system"/>
     </para>
    </listitem>
   </itemizedlist>
   <sect4 xml:id="sec-prep-makeavail-zpxe-cobbler-import">
    <title>导入安装数据</title>
    <para>
     要导入媒体，在 Cobbler 服务器上必须可以使用安装源，不论该源是 USB 闪存盘还是网络源。运行以下命令以导入数据：
    </para>
<screen><prompt>&gt; </prompt><command>sudo</command> cobbler import --path=<replaceable>PATH</replaceable><co xml:id="co-cobbler-import-path"/> --name=<replaceable>IDENTIFIER</replaceable><co xml:id="co-cobbler-import-dirname"/> --arch=s390x</screen>
    <calloutlist>
     <callout arearefs="co-cobbler-import-path">
      <para>
       安装数据的挂载点。
      </para>
     </callout>
     <callout arearefs="co-cobbler-import-dirname">
      <para>
       用于标识已导入产品的字符串，例如 <quote>sles15_s390x</quote>。该字符串用作安装数据所复制到的子目录的名称。在 SUSE Linux Enterprise 上运行的 Cobbler 服务器上，此为 <filename>/srv/www/cobbler/ks_mirror/<replaceable>IDENTIFIER</replaceable></filename>。如果 Cobbler 运行在其他操作系统上，此路径可能会稍有不同。
      </para>
     </callout>
    </calloutlist>
   </sect4>
   <sect4 xml:id="sec-prep-makeavail-zpxe-cobbler-add-distro">
    <title>添加发行套件</title>
    <para>
     添加发行套件可让 Cobbler 通过 zPXE 提供所需的内核和 initrd 来实现 IPL。在 Cobbler 服务器上运行以下命令，可添加 <phrase role="productname"><phrase os="slemicro">SUSE Linux Enterprise Micro</phrase></phrase> for IBM Z：
    </para>
<screen><prompt>&gt; </prompt><command>sudo</command> cobbler distro add --arch=s390 --breed=suse --name="<replaceable>IDENTIFIER</replaceable>"<co xml:id="co-cobbler-add-identifier"/> \
  --os-version=<phrase os="slemicro">slemicro5.2</phrase><co xml:id="co-cobbler-add-os"/> \
  --initrd=/srv/www/cobbler/ks_mirror/<replaceable>IDENTIFIER</replaceable>/boot/s390x/initrd<co xml:id="co-cobbler-add-initrd"/> \
  --kernel=/srv/www/cobbler/ks_mirror/<replaceable>IDENTIFIER</replaceable>/boot/s390x/linux<co xml:id="co-cobbler-add-kernel"/> \
  --kopts="install=http://cobbler.example.com/cobbler/ks_mirror/<replaceable>IDENTIFIER</replaceable>"<co xml:id="co-cobbler-add-server"/>
    </screen>    
    <calloutlist>
     <callout arearefs="co-cobbler-add-identifier">
      
      <para os="slemicro">
       发行套件的唯一标识符，例如<quote>SLE Micro <phrase role="productnumber"><phrase os="slemicro">5.5</phrase></phrase> IBM Z</quote>。
      </para>
     </callout>
     <callout arearefs="co-cobbler-add-os">
      <para>
       操作系统标识符。使用 <literal>sles15</literal>.
      </para>
     </callout>
     <callout arearefs="co-cobbler-add-initrd">
      <para>
       initrd 的路径。该路径的第一部分 (<filename>/srv/www/cobbler/ks_mirror/<replaceable>IDENTIFIER</replaceable>/</filename>) 取决于导入数据的位置以及您在导入安装数据时选择的子目录名称。
      </para>
     </callout>
     <callout arearefs="co-cobbler-add-kernel">
      <para>
       内核的路径。该路径的第一部分 (<filename>/srv/www/cobbler/ks_mirror/<replaceable>IDENTIFIER</replaceable>/</filename>) 取决于导入数据的位置以及您在导入安装数据时选择的子目录名称。
      </para>
     </callout>
     <callout arearefs="co-cobbler-add-server">
      <para>
       Cobbler 服务器上安装目录的 URL。
      </para>
     </callout>
    </calloutlist>
   </sect4>
   <sect4 xml:id="sec-prep-makeavail-zpxe-cobbler-profile">
    <title>调整配置文件</title>
    <para>
     添加发行套件（请参见<xref linkend="sec-prep-makeavail-zpxe-cobbler-add-distro"/>）会自动生成具有相应 <replaceable>IDENTIFIER</replaceable> 的配置文件。使用以下命令可以进行一些必要的调整：
    </para>
<screen><prompt>&gt; </prompt><command>sudo</command> cobbler distro edit \
--name=<replaceable>IDENTIFIER</replaceable><co xml:id="co-cobbler-profile-name"/> --os-version=sles10<co xml:id="co-cobbler-profile-os"/> --ksmeta=""<co xml:id="co-cobbler-profile-meta"/>
--kopts="install=http://cobbler.example.com/cobbler/ks_mirror/<replaceable>IDENTIFIER</replaceable>"<co xml:id="co-cobbler-profile-opts"/></screen>
    <calloutlist>
     <callout arearefs="co-cobbler-profile-name">
      <para>
       配置文件的标识符。使用添加发行套件时指定的字符串。
      </para>
     </callout>
     <callout arearefs="co-cobbler-profile-os">
      <para>
       操作系统版本。配置文件应该应用到的分发包。使用导入步骤中的 <option>--name=<replaceable>IDENTIFIER</replaceable></option> 指定的字符串。
      </para>
     </callout>
     <callout arearefs="co-cobbler-profile-meta">
      <para>
       创建 Kickstart 文件模板需要使用的选项。在 SUSE 中不使用此选项，因此请将其留空。
      </para>
     </callout>
     <callout arearefs="co-cobbler-profile-opts">
      <para>
       内核参数的空格分隔列表。它必须至少包含 <literal>install</literal> 参数。
      </para>
     </callout>
    </calloutlist>
   </sect4>
   <sect4 xml:id="sec-prep-makeavail-zpxe-cobbler-system">
    <title>添加系统</title>
    <para>
     最后一步是将系统添加到 Cobbler 服务器。必须针对应该通过 zPXE 引导的每个 IBM Z guest 执行此步骤。各 guest 通过其 z/VM 用户 ID 来标识（在以下示例中，ID 为 <quote>linux01</quote>）。请注意，该 ID 必须小写。要添加一个系统，请运行以下命令：
    </para>
<screen><prompt>&gt; </prompt><command>sudo</command> cobbler system add --name=linux01 --hostname=linux01.example.com \
--profile=<replaceable>IDENTIFIER</replaceable> --interface=qdio \
--ip-address=192.168.2.103 --subnet=192.168.2.255 --netmask=255.255.255.0 \
--name-servers=192.168.1.116 --name-servers-search=example.com \
--gateway=192.168.2.1 --kopts="<replaceable>KERNEL_OPTIONS</replaceable>"</screen>
    <para>
     使用 <option>--kopts</option> 选项可以指定通常在 parmfile 中指定的内核和安装参数。使用以下格式指定参数：<replaceable>PARAMETER1=VALUE1 PARAMETER2=VALUE2</replaceable>。安装程序将提示指定缺少的参数。要实现完全自动化的安装，需要指定网络和 DASD 的所有参数，并提供一个 AutoYaST 文件。下面是一个 guest 示例，该 guest 具备 OSA 接口，采用的网络参数与上文相同。
    </para>
<screen>--kopts=" \
AutoYaST=http://192.168.0.5/autoinst.xml \
Hostname=linux01.example.com \
Domain=example.com \
HostIP=192.168.2.103 \
Gateway=192.168.2.1 \
Nameserver=192.168.1.116 \
Searchdns=example.com \
InstNetDev=osa; \
Netmask=255.255.255.0 \
Broadcast=192.168.2.255 \
OsaInterface=qdio \
Layer2=0 \
PortNo=0 \
ReadChannel=0.0.0700 \
WriteChannel=0.0.0701 \
DataChannel=0.0.0702 \
DASD=600"</screen>
   </sect4>
  </sect3>
  <sect3 xml:id="sec-prep-makeavail-dvd-usb-hmc">
   <title>从 HMC 的 USB 闪存盘安装</title>
   <para>
    在 IBM Z 服务器上安装 <phrase role="productname"><phrase os="slemicro">SUSE Linux Enterprise Micro</phrase></phrase> 通常需要有网络安装源。如果无法满足此要求，SUSE Linux Enterprise Server 允许您使用硬件管理控制台 (HMC) 的 USB 闪存盘作为安装源，在 LPAR 上完成安装。
   </para>
   <para>
    要从 HMC 的 USB 闪存盘执行安装，请执行以下操作：
   </para>
   <itemizedlist>
    <listitem>
     <para>
      将 <option>install=hmc:/</option> 添加到 <filename>parmfile</filename>（请参见<xref linkend="sec-appdendix-parm"/>）或内核选项。
     </para>
    </listitem>
    <listitem>
     <para>
      使用 <filename>linuxrc</filename> 以手动模式执行安装时，依次选择<emphasis role="italic">开始安装</emphasis>、<emphasis role="italic">安装</emphasis>、<emphasis role="italic">硬件管理控制台</emphasis>。安装媒体必须在 HMC 中。
     </para>
    </listitem>
   </itemizedlist>
   <important>
    <title>配置网络</title>
    <para>
     开始安装之前，请在 <filename>linuxrc</filename> 中指定网络配置。无法通过引导参数执行此操作，并且您很可能需要访问网络。在 <filename>linuxrc</filename> 中，转到<emphasis role="italic">开始安装</emphasis>，然后选择<emphasis role="italic">网络设置</emphasis>。
    </para>
   </important>
   <important>
    <title>Linux 系统必须先引导</title>
    <para>
     请先等到 Linux 系统开始引导，再授予对 HMC 的 USB 闪存盘中媒体的访问权限。IPL 操作可能会中断 HMC 与 LPAR 之间的连接。如果第一次尝试使用所述方法失败，您可以授予访问权限，然后再重试 <option>HMC</option> 选项。
    </para>
   </important>
   <note>
    <title>安装储存库</title>
    <para>
     USB 闪存盘不会作为安装储存库保留，因为安装是一次性的过程。如果您需要安装储存库，请注册并使用联机储存库。
    </para>
   </note>
  </sect3>
 </sect2>

 <sect2 xml:id="sec-prep-inst-types">
  <title>安装类型</title>
  <para>
   本节介绍使用每种安装模式安装 <phrase role="productname"><phrase os="slemicro">SUSE Linux Enterprise Micro</phrase></phrase> 的步骤。完成前面章节所述的准备步骤后，请遵循所需安装模式的概述。
  </para>
  <para>
   根据<xref linkend="sec-prep-makeavail"/>中所述，IBM Z 上的 Linux 有三种不同的安装模式：LPAR、z/VM 和 KVM guest 安装。
  </para>
  <procedure xml:id="pro-prep-inst-types-lpar">
   <title>LPAR 安装概述</title>
   <step>
    <para>
     准备安装所需设备。请参见<xref linkend="sec-prep-prep-ipl-natlpar"/>。
    </para>
   </step>
   <step>
    <para>
     对安装系统进行 IPL 操作。请参见<xref linkend="sec-prep-ipling-lpar"/>。
    </para>
   </step>
   <step>
    <para>
     配置网络。请参见<xref linkend="sec-prep-netcfg"/>。
    </para>
   </step>
   <step>
    <para>
     连接到 <phrase role="productname"><phrase os="slemicro">SUSE Linux Enterprise Micro</phrase></phrase> 安装系统。请参见<xref linkend="sec-prep-connect"/>。
    </para>
   </step>
   <step>
    <para>
     使用 YaST 开始安装，然后对安装好的系统执行 IPL。请参见<xref linkend="cha-install"/>。
    </para>
   </step>
  </procedure>
  <procedure xml:id="pro-prep-inst-types-vm">
   <title>z/VM 安装概述</title>
   <step>
    <para>
     准备安装所需设备。请参见<xref linkend="sec-prep-prep-ipl-vm-linux-guest"/>。
    </para>
   </step>
   <step>
    <para>
     对安装系统进行 IPL 操作。请参见<xref linkend="sec-prep-ipling-vm"/>。
    </para>
   </step>
   <step>
    <para>
     配置网络。请参见<xref linkend="sec-prep-netcfg"/>。
    </para>
   </step>
   <step>
    <para>
     连接到 <phrase role="productname"><phrase os="slemicro">SUSE Linux Enterprise Micro</phrase></phrase> 安装系统。请参见<xref linkend="sec-prep-connect"/>。
    </para>
   </step>
   <step>
    <para>
     使用 YaST 开始安装，然后对安装好的系统执行 IPL。请参见<xref linkend="cha-install"/>。
    </para>
   </step>
  </procedure>
  <procedure xml:id="pro-prep-inst-types-kvm">
   <title>KVM Guest 安装概述</title>
   <step>
    <para>
     创建虚拟磁盘映像并写入域 XML 文件。请参见<xref linkend="sec-prep-prep-ipl-kvm"/>。
    </para>
   </step>
   <step>
    <para>
     准备安装目标并对 VM Guest 执行 IPL。请参见<xref linkend="sec-prep-ipling-kvm"/>。
    </para>
   </step>
   <step>
    <para>
     <xref linkend="sec-prep-netcfg-data"/>。
    </para>
   </step>
   <step>
    <para>
     连接到 <phrase role="productname"><phrase os="slemicro">SUSE Linux Enterprise Micro</phrase></phrase> 安装系统。请参见<xref linkend="sec-prep-connect"/>。
    </para>
   </step>
   <step>
    <para>
     使用 YaST 开始安装，然后对安装好的系统执行 IPL。请参见<xref linkend="cha-install"/>。
    </para>
   </step>
  </procedure>
 </sect2>

 <sect2 xml:id="sec-prep-prep-ipl">
  <title><phrase role="productname"><phrase os="slemicro">SUSE Linux Enterprise Micro</phrase></phrase> 安装系统的 IPL 准备工作</title>
  <para/>
  <sect3 xml:id="sec-prep-prep-ipl-natlpar">
   <title>LPAR 安装的 IPL 准备工作</title>
   <para>
    通过相应的激活配置文件和 IOCDS，将 IBM Z 系统配置为以 ESA/S390 模式或仅限 Linux 模式启动。有关更多信息，请参见 IBM 文档。根据<xref linkend="sec-prep-ipling-lpar"/>中所述继续操作。
   </para>
  </sect3>
  <sect3 xml:id="sec-prep-prep-ipl-vm">
   <title>z/VM 安装的 IPL 准备工作</title>
   <para/>
   <sect4 xml:id="sec-prep-prep-ipl-vm-linux-guest">
    <title>使用 dirMaint 添加 Linux Guest</title>
    <para>
     第一步是在系统中挂接和格式化一个或多个要由 z/VM 中 Linux guest 系统使用的 DASD。下一步，在 z/VM 中创建一个新用户。该示例显示了具有以下配置的 <literal>LINUX1</literal> 用户（口令为 <literal>LINPWD</literal>）的目录：1 GB 内存（最多可扩展为 2 GB）、多个微型磁盘 (MDISK)、两个 CPU 以及一个 OSA QDIO 设备。
    </para>
    <tip>
     <title>为 z/VM Guest 分配内存</title>
     <para>
      为 z/VM Guest 指派内存时，请确保内存大小对于首选安装类型足够（如<xref linkend="sec-zseries-requirements-hw-mem"/>中所述）。要将内存大小设置为 1 GB，请使用 <command>CP DEFINE STORAGE 1G</command> 命令。完成安装之后，将内存大小重设置为所需值。
     </para>
    </tip>
    <example xml:id="ex-prep-prep-ipl-vm-linux-guest-config">
     <title>z/VM 目录的配置</title>
<screen>USER LINUX1 LINPWD 1024M 2048M G
*____________________________________________
* LINUX1
*____________________________________________
* This VM Linux guest has two CPUs defined.

CPU 01 CPUID 111111
CPU 02 CPUID 111222
IPL CMS PARM AUTOCR
IUCV ANY
IUCV ALLOW
MACH ESA 10
OPTION MAINTCCW RMCHINFO
SHARE RELATIVE 2000
CONSOLE 01C0 3270 A
SPOOL 000C 2540 READER *
SPOOL 000D 2540 PUNCH A
SPOOL 000E 3203 A
* OSA QDIO DEVICE DEFINITIONS
DEDICATE 9A0 9A0
DEDICATE 9A1 9A1
DEDICATE 9A2 9A2
*
LINK MAINT 0190 0190 RR
LINK MAINT 019E 019E RR
LINK MAINT 019D 019D RR
* MINIDISK DEFINITIONS
MDISK 201 3390 0001 0050 DASD40 MR ONE4ME TWO4ME THR4ME
MDISK 150 3390 0052 0200 DASD40 MR ONE4ME TWO4ME THR4ME
MDISK 151 3390 0253 2800 DASD40 MR ONE4ME TWO4ME THR4ME</screen>
    </example>
    <para>
     此示例使用了 201 迷你磁盘作为 guest 系统主盘。有 200 个柱面的 150 迷你磁盘是 Linux 交换设备。有 2800 柱面的 151 磁盘保存 Linux 安装。
    </para>
    <para>
     以 <systemitem class="username">MAINT</systemitem> 用户身份使用 <command>DIRM FOR LINUX1 ADD</command> 将 Guest 添加到用户目录。输入 Guest 名称 (<literal>LINUX1</literal>)，然后按 <keycap>F5</keycap> 键。设置用户环境的方法：
    </para>
<screen>DIRM DIRECT
DIRM USER WITHPASS</screen>
    <para>
     最后一个命令返回一个读者文件编号。此号码用于下一步命令：
    </para>
<screen>RECEIVE &lt;number&gt; USER DIRECT A (REPL)</screen>
    <para>
     现在可以作为用户 <systemitem class="username">LINUX1</systemitem> 登录 guest 系统了。
    </para>
    <para>
     如果 <literal>dirmaint</literal> 选项不可用，请参见 IBM 文档了解如何设置此用户。
    </para>
    <para>
     继续<xref linkend="sec-prep-ipling-vm"/>。
    </para>
   </sect4>
  </sect3>
  <sect3 xml:id="sec-prep-prep-ipl-kvm">
   <title>KVM Guest 安装的 IPL 准备工作</title>
   <para>
    KVM guest 安装需要使用一个指定虚拟机的域 XML 文件，以及至少一个用于安装的虚拟磁盘映像。
   </para>
   <sect4 xml:id="sec-prep-prep-ipl-kvm-disk">
    <title>创建虚拟磁盘映像</title>
    <para>
     默认情况下，libvirt 会在 VM 主机服务器的 <filename>/var/lib/libvirt/images/</filename> 中搜索磁盘映像。虽然映像可以存储在文件系统上的任何位置，但建议您将所有映像都存储在同一个位置，以方便维护。要创建映像，请登录到 KVM 主机服务器并运行以下命令：
    </para>
<screen>qemu-img create -f qcow2 /var/lib/libvirt/images/s12lin_qcow2.img 10G</screen>
    <para>
     这会在 <filename>/var/lib/libvirt/images/</filename> 中创建一个大小为 10 GB 的 qcow2 映像。
    </para>
   </sect4>
   <sect4 xml:id="sec-prep-prep-ipl-kvm-domain">
    <title>编写域 XML 文件</title>
    <para>
     域 XML 文件用于定义 VM Guest。要创建域 XML 文件，请使用编辑器打开空文件 <filename>s15-1.xml</filename>，并创建如下例所示的文件。
    </para>
    <example>
     <title>域 XML 文件示例</title>
     <para>
      下面的示例会创建一个采用单一 CPU、1 GB RAM 和上一节（<xref linkend="sec-prep-prep-ipl-kvm-disk"/>）中创建的虚拟磁盘映像的 VM Guest。假设虚拟服务器已挂接到主机网络接口 <literal>bond0</literal>。将源设备元素更改为与您的网络设置相匹配。
     </para>
<screen>&lt;domain type="kvm"&gt;
 &lt;name&gt;s15-1&lt;/name&gt;
 &lt;description&gt;Guest-System SUSE SLES15&lt;/description&gt;
 &lt;memory&gt;1048576&lt;/memory&gt;
 &lt;vcpu&gt;1&lt;/vcpu&gt;
 &lt;os&gt;
  &lt;type arch="s390x" machine="s390-ccw-virtio"&gt;hvm&lt;/type&gt;
  &lt;!-- Boot kernel - remove 3 lines after successful installation --&gt;
  &lt;kernel&gt;/var/lib/libvirt/images/s15-kernel.boot&lt;/kernel&gt;
  &lt;initrd&gt;/var/lib/libvirt/images/s15-initrd.boot&lt;/initrd&gt;
  &lt;cmdline&gt;linuxrcstderr=/dev/console&lt;/cmdline&gt;
 &lt;/os&gt;
 &lt;iothreads&gt;1&lt;/iothreads&gt;
 &lt;on_poweroff&gt;destroy&lt;/on_poweroff&gt;
 &lt;on_reboot&gt;restart&lt;/on_reboot&gt;
 &lt;on_crash&gt;preserve&lt;/on_crash&gt;
 &lt;devices&gt;
  &lt;emulator&gt;/usr/bin/qemu-system-s390x&lt;/emulator&gt;
  &lt;disk type="file" device="disk"&gt;
   &lt;driver name="qemu" type="qcow2" cache="none" iothread="1" io="native"/&gt;
   &lt;source file="/var/lib/libvirt/images/s15lin_qcow2.img"/&gt;
   &lt;target dev="vda" bus="virtio"/&gt;
  &lt;/disk&gt;
  &lt;interface type="direct"&gt;
   &lt;source dev="bond0" mode="bridge"/&gt;
   &lt;model type="virtio"/&gt;
  &lt;/interface&gt;
  &lt;console type="pty"&gt;
   &lt;target type="sclp"/&gt;
  &lt;/console&gt;
 &lt;/devices&gt;
&lt;/domain&gt;</screen>
    </example>
   </sect4>
  </sect3>
 </sect2>

 <sect2 xml:id="sec-prep-ipling">
  <title>对 <phrase role="productname"><phrase os="slemicro">SUSE Linux Enterprise Micro</phrase></phrase> 安装系统执行 IPL</title>
  <para/>
  <sect3 xml:id="sec-prep-ipling-lpar">
   <title>对 LPAR 安装执行 IPL</title>
   <para>
    可通过不同的方法对 <phrase role="productname"><phrase os="slemicro">SUSE Linux Enterprise Micro</phrase></phrase> 执行 IPL，以将其装载到 LPAR 中。最好使用 SE 或 HMC 的<guimenu>从 CD-ROM 或服务器装载</guimenu>功能。
   </para>
   <sect4 xml:id="sec-prep-ipling-lpar-cdrom">
    <title>从 DVD-ROM 进行 IPL 操作</title>
    <para>
     标记要安装的 LPAR，然后选择<guimenu>从 CD-ROM 或服务器装载</guimenu>。将文件位置字段留空，或输入第一个 DVD-ROM 的根目录路径，然后选择<guimenu>继续</guimenu>。保留显示的选项列表中的默认选择。此时，<guimenu>操作系统消息</guimenu>应该显示内核引导消息。
    </para>
   </sect4>
   <sect4 xml:id="sec-prep-ipling-lpar-dvd">
    <title>从通过 FCP 挂接的 SCSI DVD 执行 IPL</title>
    <para>
     您可以选择 <guimenu>SCSI</guimenu> 作为<guimenu>装载类型</guimenu>使用<guimenu>装载</guimenu>过程，以从 SCSI 进行 IPL。输入 SCSI 网桥或存储设备提供的 WWPN（全球端口名称）和 LUN（逻辑单元号，16 位数，不要省略尾部的 0）。引导程序选择器必须为 2。请使用您的 FCP 适配器作为<guimenu>装载地址</guimenu>并执行 IPL。
    </para>
   </sect4>
  </sect3>
  <sect3 xml:id="sec-prep-ipling-vm">
   <title>对 z/VM 安装执行 IPL</title>
   <para>
    本节介绍如何对安装系统执行 IPL，以便在 z/VM 系统上安装 <phrase role="productname"><phrase os="slemicro">SUSE Linux Enterprise Micro</phrase></phrase> for IBM Z。
   </para>
   <sect4 xml:id="sec-prep-ipling-vm-reader">
    <title>从 z/VM 阅览器 IPL</title>
    <para>
     在新定义的 z/VM guest 中需要有效的 TCP/IP 连接和 FTP 客户端程序，以通过 FTP 传送安装系统。为 z/VM 设置 TCP/IP 不在本手册的讨论范围内。请参考相关的 IBM 文档。
    </para>
    <para>
     作为 z/VM Linux guest 系统登录并 IPL。在您的网络中，通过 FTP 提供统一安装程序（媒体 1）的 <filename>/boot/s390x</filename> 目录内容。从此目录中，获取文件 <filename>linux</filename>、<filename>initrd</filename>、<filename>parmfile</filename> 和 <filename>sles.exec</filename>。用固定的 80 字符的块大小来传送文件。用 FTP 命令 <command>locsite fix 80</command> 来指定它。<filename>linux</filename>（Linux 内核）和 <filename>initrd</filename>（安装映像）必须以二进制文件格式复制，因此请使用 <literal>binary</literal> 传输模式。<filename>parmfile</filename> 和 <filename>sles.exec</filename> 需要在 ASCII 模式下传送。
    </para>
    <para>
     以下示例演示了所需的步骤。此特定情形假设可以从 IP 地址为 <literal>192.168.0.3</literal> 的 FTP 服务器使用登录名 <systemitem class="username">lininst</systemitem> 访问所需文件。
    </para>
    <example xml:id="ex-prep-ipling-vm-reader-ftp-ftptrans">
     <title>通过 FTP 传输二进制文件</title>
<screen>FTP 192.168.0.3
VM TCP/IP FTP Level 530
Connecting to 192.168.0.3, port 21
220 ftpserver FTP server (Version wu-2.4.2-academ[BETA-18](1)
Thu Feb 11 16:09:02 GMT 2010) ready.
USER
lininst
331 Password required for lininst
PASS
******
230 User lininst logged in.
Command:
binary
200 Type set to I
Command:
locsite fix 80
Command:
get /media/dvd1/boot/s390x/linux sles.linux
200 PORT Command successful
150 Opening BINARY mode data connection for /media/dvd1/boot/s390x/linux
(10664192 bytes)
226 Transfer complete.
10664192 bytes transferred in 13.91 seconds.
Transfer rate 766.70 Kbytes/sec.
Command:
get /media/dvd1/boot/s390x/initrd sles.initrd
200 PORT Command successful
150 Opening BINARY mode data connection for /media/dvd1/boot/s390x/initrd
(21403276 bytes)
226 Transfer complete.
21403276 bytes transferred in 27.916 seconds.
Transfer rate 766.70 Kbytes/sec.
Command:
ascii
200 Type set to A
Command:
get /media/dvd1/boot/s390x/parmfile sles.parmfile
150 Opening ASCII mode data connection for /media/dvd1/boot/s390x/parmfile
(5 bytes)
226 Transfer complete.
5 bytes transferred in 0.092 seconds.
Transfer rate 0.05 Kbytes/sec.
Command:
get /media/dvd1/boot/s390x/sles.exec sles.exec
150 Opening ASCII mode data connection for /media/dvd1/boot/s390x/sles.exec
(891 bytes)
226 Transfer complete.
891 bytes transferred in 0.097 seconds.
Transfer rate 0.89 Kbytes/sec.
Command:
quit</screen>
    </example>
    <para>
     使用下载的 REXX 脚本 sles.exec 对 Linux 安装系统执行 IPL。此脚本装载用于 IPL 的内核、parmfile 及 初始 RAM 磁盘到阅读器。
    </para>
    <example xml:id="ex-prep-ipling-vm-reader-startscript-slesexec">
     <title>sles.exec</title>
<screen>/* REXX LOAD EXEC FOR SUSE LINUX S/390 VM GUESTS       */
/* LOADS SUSE LINUX S/390 FILES INTO READER            */
SAY ''
SAY 'LOADING SLES FILES INTO READER...'
'CP CLOSE RDR'
'PURGE RDR ALL'
'SPOOL PUNCH * RDR'
'PUNCH SLES LINUX A (NOH'
'PUNCH SLES PARMFILE A (NOH'
'PUNCH SLES INITRD A (NOH'
'IPL 00C'</screen>
    </example>
    <para>
     使用该脚本可以通过 <phrase role="productname"><phrase os="slemicro"> 命令对 </phrase></phrase>SUSE Linux Enterprise Micro<command>sles</command> 安装系统执行 IPL。然后，Linux 内核将会启动并输出其引导消息。
    </para>
    <para>
     要继续安装，请转至<xref linkend="sec-prep-netcfg"/>。
    </para>
   </sect4>
   <sect4 xml:id="sec-prep-ipling-vm-dvd">
    <title>从通过 FCP 挂接的 SCSI DVD 执行 IPL</title>
    <para>
     要在 z/VM 中进行 IPL 操作，请通过使用 SET LOADDEV 参数准备 SCSI IPL 过程。
    </para>
<screen>SET LOADDEV PORTNAME 200400E8 00D74E00 LUN 00020000 00000000 BOOT 2</screen>
    <para>
     用相应值设置 LOADDEV 参数后，对您的 FCP 适配器进行 IPL 操作，例如：
    </para>
<screen>IPL FC00</screen>
    <para>
     要继续安装，请转至<xref linkend="sec-prep-netcfg"/>。
    </para>
   </sect4>
   <sect4 xml:id="sec-prep-ipling-vm-zpxe">
    <title>使用 zPXE 从 Cobbler 服务器执行 IPL</title>
    <para>
     要使用 zPXE 从 Cobbler 服务器执行 IPL，需要通过 FTP 将 <filename>zpxe.rexx</filename> 脚本从 Cobbler 服务器传送到 z/VM Guest。为此，z/VM guest 需要使用正在运行的 TCP/IP 连接和 FTP 客户端程序。
    </para>
    <para>
     以 z/VM Linux guest 的身份登录，并将脚本以 ASCII 模式固定在 80 个字符的大小内进行 IPL 和传送（相关示例请参见<xref linkend="ex-prep-ipling-vm-reader-ftp-ftptrans"/>）。统一安装程序 DVD 上的 <filename>/boot/s390x/zpxe.rexx</filename> 中或 SLE Cobbler 服务器上的 <filename>/usr/share/doc/packages/s390-tools/zpxe.rexx</filename> 中提供了 <filename>zpxe.rexx</filename> 脚本。
    </para>
    <para>
     <filename>zpxe.rexx</filename> 用来替换您的 Guest 的 <filename>PROFILE EXEC</filename>。备份现有的 <filename>PROFILE EXEC</filename>，然后将 <filename>ZPXE
     REXX</filename> 重命名为 <filename>PROFILE EXEC</filename>。或者，在现有的 <filename>PROFILE
     EXEC</filename> 中添加 <literal>'ZPXE REXX'</literal> 一行从中调用 <filename>ZPXE REXX</filename>。
    </para>
    <para>
     最后一步是创建配置文件 <filename>ZPXE
     CONF</filename>，指示 <filename>ZPXE REXX</filename> 要联系哪个 Cobbler 服务器，以及对哪个磁盘执行 IPL。运行 <command>xedit zpxe
     conf a</command> 并创建包含以下内容的 <filename>ZPXE CONF</filename>（请根据实际情况替换示例数据）：
    </para>
<screen>HOST cobbler.example.com
IPLDISK 600</screen>
    <para>
     这样，当您下次登录到 z/VM Guest 时，就会连接 Cobbler 服务器。如果在 Cobbler 服务器上安排了安装计划，则会按计划执行。若要安排安装计划，请在 Cobbler 服务器上运行以下命令。
    </para>
<screen><prompt>&gt; </prompt><command>sudo</command> cobbler system edit --name <replaceable>ID</replaceable><co xml:id="co-cobbler-sysedit-id"/> --netboot-enabled 1<co xml:id="co-cobbler-sysedit-netboot"/> --profile <replaceable>PROFILENAME</replaceable><co xml:id="co-cobbler-sysedit-profile"/></screen>
    <calloutlist>
     <callout arearefs="co-cobbler-sysedit-id">
      <para>
       z/VM 用户 ID。
      </para>
     </callout>
     <callout arearefs="co-cobbler-sysedit-netboot">
      <para>
       启用从网络实现 IPL 的功能。
      </para>
     </callout>
     <callout arearefs="co-cobbler-sysedit-profile">
      <para>
       现有的配置文件名称，请参见<xref linkend="sec-prep-makeavail-zpxe-cobbler-profile"/>。
      </para>
     </callout>
    </calloutlist>
   </sect4>
  </sect3>
  <sect3 xml:id="sec-prep-ipling-kvm">
   <title>对 KVM Guest 安装执行 IPL</title>
   <para>
    要启动 Guest 安装，需要先启动<xref linkend="sec-prep-prep-ipl-kvm-disk"/>中定义的 VM Guest。在开始之前，请确保内核和 initrd 可用于 IPL。
   </para>
   <sect4 xml:id="sec-prep-ipling-kvm-prep">
    <title>准备安装源</title>
    <para>
     需要将安装系统的内核和 initrd 复制到 VM 主机服务器上，才能将 VM Guest IPL 到安装系统中。
    </para>
    <procedure>
     <step>
      <para>
       登录 KVM 主机，并确保您可以连接到提供安装源的远程主机或设备。
      </para>
     </step>
     <step>
      <para>
       将以下两个文件从安装源复制到 <filename>/var/lib/libvirt/images/</filename>。如果数据由远程主机提供，请使用 <command>ftp</command>、<command>sftp</command> 或 <command>scp</command> 传输文件：
      </para>
      <simplelist><member><filename>/boot/s390x/initrd</filename></member><member><filename>/boot/s390x/cd.ikr</filename></member>
      </simplelist>
     </step>
     <step>
      <para>
       重命名 KVM 主机上的文件：
      </para>
<screen><prompt>&gt; </prompt><command>sudo</command> cd /var/lib/libvirt/images/
<prompt>&gt; </prompt><command>sudo</command> mv initrd s15-initrd.boot
<prompt>&gt; </prompt><command>sudo</command> mv cd.ikr s15-kernel.boot</screen>
     </step>
    </procedure>
   </sect4>
   <sect4 xml:id="sec-prep-ipling-kvm-guest">
    <title>对 VM Guest 执行 IPL</title>
    <para>
     要对 VM Guest 执行 IPL，请登录 KVM 主机并运行以下命令：
    </para>
<screen><prompt>&gt; </prompt>virsh  create s15-1.xml --console</screen>
    <para>
     当 VM Guest 启动并运行时，安装过程将会开始，您应会看到以下消息：
    </para>
<screen>Domain s15-1 started
Connected to domain s15-1
Escape character is ^]
Initializing cgroup subsys cpuset
Initializing cgroup subsys cpu
Initializing
cgroup subsys cpuacct
.
.
Please make sure your installation medium is available.
Retry?
0) &lt;-- Back &lt;--
1) Yes
2) No</screen>
    <para>
     回答 <guimenu>2) No</guimenu> 并在下一步中选择<guimenu>安装</guimenu>。按<xref linkend="sec-prep-netcfg-data"/>中所述操作。
    </para>
   </sect4>
  </sect3>
 </sect2>

 <sect2 xml:id="sec-prep-netcfg">
  <title>网络配置</title>
  <para>
   耐心等待，直到内核已经完成其启动例程。如果您以基本模式或在 LPAR 中执行安装，请在 HMC 或 SE 上打开<guimenu>操作系统消息</guimenu>。
  </para>
  <para>
   首先，在 <filename>linuxrc</filename> 主菜单中选择<guimenu>开始安装</guimenu>。然后选择<guimenu>开始安装或更新</guimenu>以启动安装过程。选择<guimenu>网络</guimenu>作为安装媒体，然后选择用于安装的网络协议类型。<xref linkend="sec-prep-makeavail"/>描述了如何为各种网络连接类型提供安装数据。目前支持 <guimenu>FTP</guimenu>、 <guimenu>HTTP</guimenu>、<guimenu>NFS</guimenu> 和 <guimenu>SMB/CIFS</guimenu>（Windows 文件共享）。
  </para>
  <para>
   在可用设备的列表中，选择用于接收安装数据的 OSA 或 HiperSockets 网络设备。尽管该列表可能包含 CTC、ESCON 或 IUCV 设备，但 <phrase role="productname"><phrase os="slemicro">SUSE Linux Enterprise Micro</phrase></phrase> 不再支持这些设备。
  </para>
  <sect3 xml:id="sec-prep-netcfg-hypersockets">
   <title>配置 HiperSockets 接口</title>
   <para>
    从网络设备列表中选择 HiperSocket 设备。然后，输入读取、写入和数据通道的值：
   </para>
   <example xml:id="ex-appdendix-inst-netcontypes-types">
    <title>支持的网络连接类型和驱动程序参数</title>
<screen>Choose the network device.

 1) IBM parallel CTC Adapter (0.0.0600)
 2) IBM parallel CTC Adapter (0.0.0601)
 3) IBM parallel CTC Adapter (0.0.0602)
 4) IBM Hipersocket (0.0.0800)
 5) IBM Hipersocket (0.0.0801)
 6) IBM Hipersocket (0.0.0802)
 7) IBM OSA Express Network card (0.0.0700)
 8) IBM OSA Express Network card (0.0.0701)
 9) IBM OSA Express Network card (0.0.0702)
10) IBM OSA Express Network card (0.0.f400)
11) IBM OSA Express Network card (0.0.f401)
12) IBM OSA Express Network card (0.0.f402)
13) IBM IUCV

&gt; 4

Device address for read channel. (Enter '+++' to abort).
[0.0.0800]&gt; 0.0.0800

Device address for write channel. (Enter '+++' to abort).
[0.0.0801]&gt; 0.0.0801

Device address for data channel. (Enter '+++' to abort).
[0.0.0802]&gt; 0.0.0802</screen>
   </example>
  </sect3>
  <sect3 xml:id="sec-prep-netcfg-osa">
   <title>配置 OSA Express 设备</title>
   <para>
    从网络设备列表中选择一个 OSA Express 设备，并指定端口号。输入读取、写入和数据通道的值。选择是否启用 OSI Layer 2 支持。
   </para>
   <para>
    新的双端口 OSA Express 3 网络设备需要端口号。如果不使用 OSA Express 3 设备，请输入 <literal>0</literal>。OSA Express 网卡还可以在 <quote>OSI 第 2 层支持</quote>模式或较旧但更常用的<quote>第 3 层</quote>模式下运行。网卡模式影响共享该设备的所有系统，包括其他 LPAR 上的系统。如果不确定，请指定 <literal>2</literal> 以与其他操作系统（例如 z/VM 和 z/OS）使用的默认模式兼容。有关这些选项的更多信息，请咨询硬件管理员。
   </para>
   <example xml:id="ex-appdendix-inst-netcontypes-gigabit-param">
    <title>网络设备驱动程序参数</title>
<screen>Choose the network device.

 1) IBM parallel CTC Adapter (0.0.0600)
 2) IBM parallel CTC Adapter (0.0.0601)
 3) IBM parallel CTC Adapter (0.0.0602)
 4) IBM Hipersocket (0.0.0800)
 5) IBM Hipersocket (0.0.0801)
 6) IBM Hipersocket (0.0.0802)
 7) IBM OSA Express Network card (0.0.0700)
 8) IBM OSA Express Network card (0.0.0701)
 9) IBM OSA Express Network card (0.0.0702)
10) IBM OSA Express Network card (0.0.f400)
11) IBM OSA Express Network card (0.0.f401)
12) IBM OSA Express Network card (0.0.f402)
13) IBM IUCV

&gt; 7

Enter the relative port number. (Enter '+++' to abort).
&gt; 0

Device address for read channel. (Enter '+++' to abort).
[0.0.0700]&gt; 0.0.0700

Device address for write channel. (Enter '+++' to abort).
[0.0.0701]&gt; 0.0.0701

Device address for data channel. (Enter '+++' to abort).
[0.0.0702]&gt; 0.0.0702

Enable OSI Layer 2 support?

0) &lt;-- Back &lt;--
1) Yes
2) No

&gt; 1

MAC address. (Enter '+++' to abort).
&gt; +++</screen>
   </example>
  </sect3>
  <sect3 xml:id="sec-prep-netcfg-data">
   <title>设置网络并选择安装源</title>
   <para>
    输入所有网络设备参数后，相关的驱动程序即会安装到系统中，而您将会看到相应的内核消息。
   </para>
   <para>
    接下来，需要指定是否使用 DHCP 自动配置来设置网络接口参数。由于 DHCP 只能在少数设备上工作，并且需要特殊的硬盘配置设置，因此请选择 <guimenu>NO</guimenu>。然后，系统会提示您指定以下网络参数：
   </para>
   <itemizedlist>
    <listitem>
     <para>
      要安装的系统的 IP 地址
     </para>
    </listitem>
    <listitem>
     <para>
      对应的网络掩码（如果未随 IP 地址指定）
     </para>
    </listitem>
    <listitem>
     <para>
      用于连接服务器的网关的 IP 地址
     </para>
    </listitem>
    <listitem>
     <para>
      域名服务器 (DNS) 涵盖的搜索域列表
     </para>
    </listitem>
    <listitem>
     <para>
      域名服务器的 IP 地址
     </para>
    </listitem>
   </itemizedlist>
   <example xml:id="ex-prep-netcfg-vm-network-setup">
    <title>网络参数</title>
<screen>Automatic configuration via DHCP?

0) &lt;-- Back &lt;--
1) Yes
2) No

&gt; 2

Enter your IP address with network prefix.

You can enter more than one, separated by space, if necessary.
Leave empty for autoconfig.

Examples: 192.168.5.77/24 2001:db8:75:fff::3/64. (Enter '+++' to abort).
&gt; 192.168.0.20/24

Enter your name server IP address.

You can enter more than one, separated by space, if necessary.
Leave empty if you don't need one.

Examples: 192.168.5.77 2001:db8:75:fff::3. (Enter '+++' to abort).
&gt; 192.168.0.1

Enter your search domains, separated by a space:. (Enter '+++' to abort).
&gt; example.com

Enter the IP address of your name server. Leave empty if you do not need one. (En
ter '+++' to abort).
&gt; 192.168.0.1</screen>
   </example>
   <para>
    最后，请提供有关安装服务器的所需信息，例如 IP 地址、包含安装数据的目录，以及登录身份凭证。提供所需的信息后，即会装载安装系统。
   </para>
  </sect3>
 </sect2>

 <sect2 xml:id="sec-prep-connect">
  <title>连接到 <phrase role="productname"><phrase os="slemicro">SUSE Linux Enterprise Micro</phrase></phrase> 安装系统</title>
  <para>
   装载安装系统后，linuxrc 会提示您选择用来控制安装过程的显示类型。可用的选项包括 <literal>Remote X11</literal>（X Window 系统）、<literal>VNC</literal>（虚拟网络计算协议）、<literal>SSH</literal>（文本模式或通过安全外壳进行 X11 安装）、<literal>Text-based UI</literal> 和 <literal>Graphical UI</literal>。最后一个选项会在本地图形显示器（如存在）上以图形模式启动 YaST。在 s390x 体系结构上，可以使用 QEMU 和 <systemitem>virtio-gpu</systemitem> 驱动程序来实现本地图形显示器。
   </para>
   <para>
   建议的选项为 <literal>VNC</literal> 或 <literal>SSH</literal>。
   </para>
  <para>
   如果选择了 <literal>Text-based UI</literal> 选项，YaST 将以文本模式启动，您可以直接在终端中执行安装。只有在安装到 LPAR 中时，<literal>Text-based UI</literal> 选项才可用。
  </para>
  <note>
   <title>基于文本的 UI 的终端模拟</title>
   <para>
    要在文本模式下使用 YaST，需要在具有 VT220/Linux 仿真功能的终端（也称为 <literal>Text-based UI</literal>）中运行该程序。
   </para>
  </note>
  <sect3 xml:id="sec-inst-connect-vnc-inst">
   <title>初始化 VNC 安装</title>
   <para>
    要通过 VNC 远程控制安装，请执行以下步骤：
   </para>
   <procedure>
    <step>
     <para>
      选择 <literal>VNC</literal> 选项会启动 VNC 服务器。控制台中的简短说明显示了用于连接 vncviewer 的 IP 地址和显示编号。
     </para>
    </step>
    <step>
     <para>
      出现提示后，输入 <phrase role="productname"><phrase os="slemicro">SUSE Linux Enterprise Micro</phrase></phrase> 安装系统的 IP 地址和显示编号。
     </para>
    </step>
    <step>
     <para>
      出现提示后，输入 <phrase role="productname"><phrase os="slemicro">SUSE Linux Enterprise Micro</phrase></phrase> 安装系统的 IP 地址和显示编号。
     </para>
<screen>http://&lt;IP address of installation system&gt;:5801/</screen>
    </step>
    <step>
     <para>
      建立连接后，使用 YaST 安装 <phrase role="productname"><phrase os="slemicro">SUSE Linux Enterprise Micro</phrase></phrase>。
     </para>
    </step>
   </procedure>
  </sect3>
  <sect3 xml:id="sec-inst-connect-x">
   <title>初始化 X Window 系统安装</title>
   <important>
    <title>X 身份验证机制</title>
    <para>
     使用 X Window 系统直接安装时，需依赖于一个基于主机名的身份验证机制。此机制在最新的 <phrase role="productname"><phrase os="slemicro">SUSE Linux Enterprise Micro</phrase></phrase> 版本中已禁用。我们建议使用 SSH 或 VNC 执行安装。
    </para>
   </important>
   <para>
    要通过 X 转发远程控制安装，请执行以下步骤：
   </para>
   <procedure>
    <step>
     <para>
      确保 X 服务器允许客户端（已安装的系统）连接。在 <filename>/etc/sysconfig/displaymanager</filename> 文件中设置 <command>DISPLAYMANAGER_XSERVER_TCP_PORT_6000_OPEN="yes"</command> 变量。重启动 X 服务器，并使用 <command>xhost
      <replaceable>CLIENT_IP_ADDRESS</replaceable></command> 允许客户端绑定到服务器。
     </para>
    </step>
    <step>
     <para>
      如果安装系统提示，则输入运行 X 服务器的计算机的 IP 地址。
     </para>
    </step>
    <step>
     <para>
      等到 YaST 打开，然后开始安装。
     </para>
    </step>
   </procedure>
  </sect3>
  <sect3 xml:id="sec-inst-connect-ssh">
   <title>初始化 SSH 安装</title>
   <para>
    要通过 SSH 连接到名为 <literal>earth</literal> 的安装系统，请使用 <command>ssh -X
    earth</command> 命令。如果您的工作站在 Microsoft Windows 上运行，请使用 <link xlink:href="http://www.chiark.greenend.org.uk/~sgtatham/putty/"/> 中提供的 Putty 工具。在 Putty 中的<menuchoice>
    <guimenu>连接</guimenu> <guimenu>SSH</guimenu> <guimenu>X11</guimenu>
    </menuchoice> 下设置<guimenu>启用 X11 转发</guimenu>。
   </para>
   <para>
    如果使用另一个操作系统，请执行 <command>ssh -X
    earth</command> 以连接到名为 <systemitem>earth</systemitem> 的安装系统。如果您有可用的本地 X 服务器，则支持通过 SSH 的 X-Forwarding。否则，YaST 会通过 ncurses 提供一个文本接口。
   </para>
   <para>
    出现提示时，请输入 <literal>root</literal> 用户名，然后使用您的口令登录。输入 <command>yast.ssh</command> 启动 YaST。然后，YaST 将引导您完成安装。
   </para>
   <important>
    <title>解决通过 SSH 运行 YaST 时的问题</title>
    <para>
     在某些情况下，使用 X 转发通过 SSH 运行 YaST 的 GUI 版本可能会失败，并显示以下错误消息：
    </para>
<screen>XIO: fatal IO error 11 (Resource temporarily unavailable) on X server "localhost:11.0"</screen>
    <para>
     在这种情况下，您有两种选择：
    </para>
    <itemizedlist>
     <listitem>
      <para>
       使用 <option>QT_XCB_GL_INTEGRATION=none</option> 选项运行 YaST，例如：
      </para>
<screen>QT_XCB_GL_INTEGRATION=none yast.ssh
QT_XCB_GL_INTEGRATION=none yast2 disk</screen>
     </listitem>
     <listitem>
      <para>
       通过禁用 X 转发或将 ncurses 指定为所需 UI，来运行 YaST 应用程序的 ncurses 版本。要执行后一种操作，请使用 <command>yast2 disk --ncurses</command> 或 <command>YUI_PREFERED_BACKEND=ncurses yast2 disk</command> 命令。
      </para>
     </listitem>
    </itemizedlist>
   </important>
   <para>
    继续执行<xref linkend="cha-install"/>中所述的安装过程。
   </para>
  </sect3>
 </sect2>

 <sect2 xml:id="sec-prep-boot-procedure">
  <title>IBM Z 上 <phrase role="productname"><phrase os="slemicro">SUSE Linux Enterprise Micro</phrase></phrase> 的引导过程</title>
  <para>
   在 SLES 10 和 11 上，引导过程由 zipl 引导加载器处理。为了实现从 Btrfs 分区引导并支持使用 Snapper 进行系统回滚，在 IBM Z 上引导 <phrase role="productname"><phrase os="slemicro">SUSE Linux Enterprise Micro</phrase></phrase> 的方式已发生变化。
  </para>
  <para>
   GRUB 2 取代了 <phrase role="productname"><phrase os="slemicro">SUSE Linux Enterprise Micro</phrase></phrase> for IBM Z 上的 zipl。AMD64/Intel 64 体系结构上的 GRUB 2 包含固件级别的设备驱动程序，用于访问文件系统。大型机上没有固件，将 <literal>ccw</literal> 添加到 GRUB 2 不仅任务繁重，而且还需要在 GRUB 2 中重新实施 zipl。因此，<phrase role="productname"><phrase os="slemicro">SUSE Linux Enterprise Micro</phrase></phrase> 使用两阶段方案：
  </para>
  <variablelist>
   <varlistentry>
    <term>阶段一：</term>
    <listitem>
     <para>
      将一个包含内核和 initrd 的单独分区挂载到 <filename>/boot/zipl</filename> 中。使用 <filename>/boot/zipl/config</filename> 中的配置通过 zipl 装载此内核和 initrd。
     </para>
     <para>
      此配置会将关键字 <literal>initgrub</literal> 添加到内核命令行。内核与 initrd 装载好后，initrd 将激活挂载根文件系统所需的设备（请参见 <filename>/boot/zipl/active_devices.txt</filename>）。然后，GRUB 2 用户空间程序将会启动，读取 <filename>/boot/grub2/grub.cfg</filename>。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>阶段二：</term>
    <listitem>
     <para>
      通过 <command>kexec</command> 启动 <filename>/boot/grub2/grub.cfg</filename> 中指定的内核与 initrd。<filename>/boot/zipl/active_devices.txt</filename> 中所列的、启动磁盘中系统所需的设备便会激活。该列表中的其他设备将会加入白名单，但未列出的设备将被忽略。将会挂载根文件系统，引导过程将会继续，就如同在其他体系结构中一样。
     </para>
    </listitem>
   </varlistentry>
  </variablelist>
  
 </sect2>
</sect1>
