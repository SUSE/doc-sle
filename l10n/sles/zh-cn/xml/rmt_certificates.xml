<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="rmt_certificates.xml" version="5.0" xml:id="cha-manage-certificates">
 <info>
  <title>管理 TLS/SSL 证书</title>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:translation>yes</dm:translation>
  </dm:docmanager>
 </info>
 <sect1 xml:id="cha-manage-certificates-https">
  <title>重新生成 HTTPS 证书</title>
  <para>
   在 HTTPS 证书失效之前，或者若要包含其他通用备用名称，应重新生成该证书。如果只是重新生成 HTTPS 证书，则无需在已注册到 RMT 服务器的客户端计算机上执行其他操作。
  </para>
  <procedure>
   <step>
    <para>
     停止 nginx 和 rmt-server 服务：
    </para>
<screen><prompt role="root"># </prompt><command>systemctl stop nginx</command>
<prompt role="root"># </prompt><command>systemctl stop rmt-server</command></screen>
    </step>
    <step>
     <para>
      去除之前生成的证书。
     </para>
     <screen><prompt role="root"># </prompt><command>rm /etc/rmt/ssl/rmt-server.*</command></screen>
    </step>
    <step>
     <para>
      按<xref linkend="sec-rmt-installation-yast-configuration"/>中所述运行 <command>yast rmt</command> 模块。
     </para>
    </step>
  </procedure>
 </sect1>

 <sect1 xml:id="cha-manage-certificates-ca">
  <title>重新生成 CA 证书和 HTTPS 证书</title>
  <para>
   CA 证书失效后或者发生安全问题时，可以重新生成该证书。
  </para>
  <warning>
   <title>在所有客户端上导入 CA 证书</title>
   <para>
    必须在已注册到 RMT 服务器的所有客户端上导入新生成的 CA 证书。可以按<xref linkend="sec-rmt-client-clientsetupscript"/>中所述在客户端计算机上运行 <command>rmt-client-setup</command> 脚本来完成此操作。
   </para>
  </warning>
  <procedure>
   <step>
    <para>
     停止 nginx 和 rmt-server 服务。
    </para>
<screen><prompt role="root"># </prompt><command>systemctl stop nginx</command>
<prompt role="root"># </prompt><command>systemctl stop rmt-server</command></screen>
    </step>
    <step>
     <para>
      去除之前生成的 CA 和 HTTPS 证书。
     </para>
<screen><prompt role="root"># </prompt><command>rm /etc/rmt/ssl/rmt-ca.*</command>
<prompt role="root"># </prompt><command>rm /etc/rmt/ssl/rmt-server.*</command></screen>
    </step>
    <step>
     <para>
      按<xref linkend="sec-rmt-installation-yast-configuration"/>中所述运行 <command>yast rmt</command> 模块。
     </para>
    </step>
  </procedure>
 </sect1>
</chapter>
