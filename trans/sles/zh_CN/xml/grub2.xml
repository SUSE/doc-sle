<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE chapter PUBLIC "-//Novell//DTD NovDoc XML V1.0//EN" "novdocx.dtd">
<!--
*********************************
Please see LICENSE.txt for this document's license.
*********************************
-->
<chapter xml:base="grub2.xml" id="cha.grub2">
 <title>引导加载程序 GRUB 2</title><indexterm> <primary>引导</primary> <secondary>GRUB 2</secondary></indexterm><indexterm> <primary>GRUB 2</primary></indexterm>
 <abstract>
  <para>
   本章介绍如何配置 <phrase role="productname"><phrase os="sles">SUSE® Linux Enterprise Server</phrase></phrase> 中使用的引导加载程序 GRUB 2。GRUB 2 是传统 GRUB 引导加载程序（现在称作 <quote>GRUB 2 Legacy</quote>）的后继产品。从 <phrase role="productname"><phrase os="sles">SUSE® Linux Enterprise Server</phrase></phrase> 版本 12 开始，系统中使用 GRUB 2 作为默认的引导加载程序。产品中提供了一个 YaST 模块来配置最重要的设置。<xref linkend="cha.boot"/> 中将引导过程作为一个整体进行了介绍。有关 UEFI 计算机的安全引导支持的细节，请参见<xref linkend="cha.uefi"/>。
  </para>
 </abstract>
 <sect1 id="sec.grub2.new.features">
  <title>GRUB Legacy 与 GRUB 2 之间的主要差异</title>

  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>
     配置储存在不同的文件中。
    </para>
   </listitem>
   <listitem>
    <para>
     支持更多的文件系统（例如 Btrfs）。
    </para>
   </listitem>
   <listitem>
    <para>
     可以直接读取 LVM 或 RAID 设备上储存的文件。
    </para>
   </listitem>
   <listitem>
    <para>
     用户界面可翻译，并可以改变主题。
    </para>
   </listitem>
   <listitem>
    <para>
     包含一个用于装载模块的机制，以支持更多功能，例如文件系统等。
    </para>
   </listitem>
   <listitem>
    <para>
     自动搜索和生成其他内核与操作系统（例如 Windows）的引导项。
    </para>
   </listitem>
   <listitem>
    <para>
     包含一个类似于 Bash 的精简控制台。
    </para>
   </listitem>
  </itemizedlist>
 </sect1>
 <sect1 id="sec.grub2.file_structure">
  <title>配置文件结构</title>

  <para>
   GRUB 2 的配置基于以下文件：
  </para>

  <variablelist>
   <varlistentry>
    <term><filename>/boot/grub2/grub.cfg</filename> <indexterm> <primary>GRUB 2</primary> <secondary>grub.cfg</secondary></indexterm></term>
    <listitem>
     <para>
      此文件包含 GRUB 2 菜单项的配置。它替代了 GRUB Legacy 中的 <filename>menu.lst</filename>。<filename>grub.cfg</filename> 由 <xref linkend="vle.grub2.mkconfig"/> 命令自动生成，不应对其进行编辑。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><filename>/boot/grub2/custom.cfg</filename> <indexterm> <primary>GRUB 2</primary> <secondary>custom.cfg</secondary></indexterm></term>
    <listitem>
     <para>
      此可选文件在引导时由 <filename>grub.cfg</filename> 直接检索，可用于向引导菜单添加自定义项。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><filename>/etc/default/grub</filename> <indexterm> <primary>GRUB 2</primary> <secondary>/etc/default/grub</secondary></indexterm></term>
    <listitem>
     <para>
      此文件控制 GRUB 2 的用户设置，通常包含背景和主题等其他环境设置。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><filename>/etc/grub.d/</filename> 下的脚本<indexterm> <primary>GRUB 2</primary> <secondary>/etc/grub.d/</secondary></indexterm></term>
    <listitem>
     <para>
      在执行 <xref linkend="vle.grub2.mkconfig"/> 命令期间将读取此目录中的脚本。主配置文件 <filename>/boot/grub/grub.cfg</filename> 中集成了这些脚本的说明。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry id="vle.grub2.sysconfig">
    <term><filename>/etc/sysconfig/bootloader</filename> <indexterm> <primary>GRUB 2</primary> <secondary>sysconfig/bootloader</secondary></indexterm></term>
    <listitem>
     <para>
      在使用 YaST 配置引导加载程序时以及每次安装新内核时会用到此配置文件。它将经过 perl 引导加载程序的评估，该程序会相应地修改引导加载程序配置文件（例如，GRUB 2 对应的配置文件 <filename>/boot/grub/menu.lst</filename>）。<filename>/etc/sysconfig/bootloader</filename> 不是特定于 GRUB 2 的配置文件，其值会应用于 <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> 上安装的任何引导加载程序。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><filename arch="x86_64">/boot/grub2/x86_64-efi</filename>、<filename arch="power">/boot/grub2/power-ieee1275、</filename><filename arch="zseries">/boot/grub2/s390x</filename>
    </term>
    <listitem>
     <para>
      这些配置文件包含特定于体系结构的选项。
     </para>
    </listitem>
   </varlistentry>
  </variablelist>

  <para>
   可以通过多种方式控制 GRUB 2。可以在图形菜单（启动屏幕）中选择现有配置的引导项。配置从文件 <filename>/boot/grub2/grub.cfg</filename> 装载，而该文件是基于其他配置文件编译的（参见下文）。所有 GRUB 2 配置文件都被视为系统文件，编辑这些配置文件需要拥有 <systemitem class="username">root</systemitem> 特权。
  </para>

  <note>
   <title>激活配置更改</title>
   <para>
    手动编辑 GRUB 2 配置文件后，您需要运行 <xref linkend="vle.grub2.mkconfig"/> 以激活更改。但使用 YaST 更改配置时就不需要如此，因为 YaST 会自动运行 <xref linkend="vle.grub2.mkconfig"/>。
   </para>
  </note>

  <sect2 id="sec.grub2.cfg">
   <title>文件 <filename>/boot/grub2/grub.cfg</filename></title><indexterm> <primary>配置文件</primary> <secondary>grub.cfg</secondary></indexterm><indexterm> <primary>GRUB 2</primary> <secondary>引导菜单</secondary></indexterm><indexterm> <primary>GRUB 2</primary> <secondary>grub.cfg</secondary></indexterm>
   <para>
    带有引导菜单的图形启动屏幕内容由 GRUB 2 配置文件 <filename>/boot/grub2/grub.cfg</filename> 控制，该文件包含有关可以通过菜单引导的所有分区或操作系统的信息。
   </para>
   <para>
    每次引导系统时，GRUB 2 将直接从文件系统装载菜单文件。因此，在更改配置文件后不需要重新安装 GRUB 2。安装或去除内核后，系统会自动重构建 <filename>grub.cfg</filename>。
   </para>
   <para>
    <filename>grub.cfg</filename> 由 <xref linkend="vle.grub2.mkconfig"/> 基于 <filename>/etc/default/grub</filename> 文件以及 <filename>/etc/grub.d/</filename> 目录中的脚本编译。因此，切勿手动编辑该文件，而应该编辑相关的源文件，或者根据<xref linkend="sec.grub2.yast2.config"/>中所述，使用 YaST <guimenu>引导加载程序</guimenu>模块来修改配置。
   </para>
  </sect2>

  <sect2 id="sec.grub2.etc_default_grub">
   <title>文件 <filename>/etc/default/grub</filename></title><indexterm> <primary>配置文件</primary> <secondary>/etc/default/grub</secondary></indexterm><indexterm> <primary>GRUB 2</primary> <secondary>/etc/default/grub</secondary></indexterm>
   <para>
    此文件包含 GRUB 2 的其他常规选项，例如，显示菜单的时间，或者要引导的默认操作系统。要列出所有可用选项，请查看以下命令的输出：
   </para>
<screen>grep "export GRUB_DEFAULT" -A50 /usr/sbin/grub2-mkconfig | grep GRUB_</screen>
   <para>
    除了已定义的变量外，用户还可以引入自己的变量，以后在 <filename>/etc/grub.d</filename> 目录中的脚本内使用。
   </para>
   <para>
    编辑 <filename>/etc/default/grub</filename> 后，请运行 <xref linkend="vle.grub2.mkconfig"/> 以更新主配置文件。
   </para>
   <note>
    <title>范围</title>
    <para>
     此文件中设置的所有选项是会影响所有引导项的常规选项。可通过 GRUB_*_XEN_* 配置选项设置 Xen 内核或 Xen 超级管理程序的特定选项。有关细节，请参见下文。
    </para>
   </note>
   <variablelist>
    <varlistentry>
     <term><literal>GRUB_DEFAULT</literal>
     </term>
     <listitem>
      <para>
       设置默认会引导的引导菜单项。它的值可以是数字值、菜单项的完整名称或<quote>saved</quote>。
      </para>
      <para>
       <literal>GRUB_DEFAULT=2</literal> 引导第三个（从零开始计数）引导菜单项。
      </para>
      <para>
       <literal>GRUB_DEFAULT="2&gt;0"</literal> 引导第三个顶级菜单项的第一个子菜单项。
      </para>
      <para>
       <literal>GRUB_DEFAULT="Example boot menu entry"</literal> 引导标题为<quote>Example boot menu entry</quote>的菜单项。
      </para>
      <para>
       <literal>GRUB_DEFAULT=saved</literal> 引导 <command>grub2-reboot</command> 或 <command>grub2-set-default</command> 命令指定的项。<command>grub2-reboot</command> 只设置下一次重引导的默认引导项，而 <command>grub2-set-default</command> 设置发生更改之前的默认引导项。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>GRUB_HIDDEN_TIMEOUT</literal>
     </term>
     <listitem>
      <para>
       等待用户按某个键的指定秒数。在此期间，除非用户按下某个键，否则不显示菜单。如果用户在指定的时间内未按任何键，控制权将转交给 <literal>GRUB_TIMEOUT</literal>。<literal>GRUB_HIDDEN_TIMEOUT=0</literal> 首先会检查是否已按下 <keycap function="shift"/>，如果是，则显示引导菜单，否则会立即引导默认的菜单项。如果 GRUB 2 只识别了一个可引导操作系统，则默认行为就是如此。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>GRUB_HIDDEN_TIMEOUT_QUIET</literal>
     </term>
     <listitem>
      <para>
       如果指定 <literal>false</literal>，则在激活了 <literal>GRUB_HIDDEN_TIMEOUT</literal> 功能时，会在一个空白屏幕上显示倒数计时器。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>GRUB_TIMEOUT</literal>
     </term>
     <listitem>
      <para>
       在自动引导默认引导项之前，显示引导菜单的期限（以秒为单位）。如果按下某个键，则会取消超时，GRUB 2 将等待您手动完成选择。如果指定 <literal>GRUB_TIMEOUT=-1</literal>，则在您手动选择引导项之前，会一直显示菜单。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>GRUB_CMDLINE_LINUX</literal>
     </term>
     <listitem>
      <para>
       此行中的项将添加到正常和恢复模式的引导项的末尾。使用它可以向引导项添加内核参数。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>GRUB_CMDLINE_LINUX_DEFAULT</literal>
     </term>
     <listitem>
      <para>
       与 <literal>GRUB_CMDLINE_LINUX</literal> 一样，但只能在正常模式下追加项。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>GRUB_CMDLINE_LINUX_RECOVERY</literal>
     </term>
     <listitem>
      <para>
       与 <literal>GRUB_CMDLINE_LINUX</literal> 一样，但只能在恢复模式下追加项。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>GRUB_CMDLINE_LINUX_XEN_REPLACE</literal>
     </term>
     <listitem>
      <para>
       此项将完全替代所有 Xen 引导项的 <literal>GRUB_CMDLINE_LINUX</literal> 参数。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>GRUB_CMDLINE_LINUX_XEN_REPLACE_DEFAULT</literal>
     </term>
     <listitem>
      <para>
       与 <literal>GRUB_CMDLINE_LINUX_XEN_REPLACE</literal> 一样，但只会替代 <literal>GRUB_CMDLINE_LINUX_DEFAULT</literal> 的参数。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>GRUB_CMDLINE_XEN</literal>
     </term>
     <listitem>
      <para>
       此项只为 Xen guest 内核指定内核参数 — 工作原理与 <literal>GRUB_CMDLINE_LINUX</literal> 相同。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>GRUB_CMDLINE_XEN_DEFAULT</literal>
     </term>
     <listitem>
      <para>
       与 <literal>GRUB_CMDLINE_XEN</literal> 一样 — 工作原理与 <literal>GRUB_CMDLINE_LINUX_DEFAULT</literal> 相同。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>GRUB_TERMINAL</literal>
     </term>
     <listitem>
      <para>
       启用和指定输入/输出终端设备。可以是 <literal>console</literal>（PC BIOS 和 EFI 控制台）、<literal>serial</literal>（串行终端）、<literal>ofconsole</literal>（开放式固件控制台）或默认值 <literal>gfxterm</literal>（图形模式输出）。用引号括住所需的选项可以启用多个设备，例如 <literal>GRUB_TERMINAL="console serial"</literal>。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>GRUB_GFXMODE</literal>
     </term>
     <listitem>
      <para>
       <literal>gfxterm</literal> 图形终端使用的分辨率。请注意，您只能使用您的图形卡 (VBE) 支持的模式。默认值为“auto”，即尝试选择首选的分辨率。在 GRUB 2 命令行中键入 <command>vbeinfo</command> 可以显示 GRUB 2 可用的屏幕分辨率。GRUB 2 引导菜单屏幕显示后，键入 <keycap>c</keycap> 即可访问命令行。
      </para>
      <para>
       您还可以指定颜色深度，方法是将其值追加到分辨率设置的后面，例如 <literal>GRUB_GFXMODE=1280x1024x24</literal>。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>GRUB_BACKGROUND</literal>
     </term>
     <listitem>
      <para>
       设置 <literal>gfxterm</literal> 图形终端的背景图像。该图像必须是 GRUB 2 在引导时可读的文件，并且必须以 <literal>.png</literal>、<literal>.tga</literal>、<literal>.jpg</literal> 或 <literal>.jpeg</literal> 后缀结尾。必要时，系统会缩放该图像以适合屏幕。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>GRUB_DISABLE_OS_PROBER</literal>
     </term>
     <listitem>
      <para>
       如果将此选项设置为 <literal>true</literal>，将禁用自动搜索其他操作系统的功能。系统只会检测 <filename>/boot/</filename> 中的内核映像，以及 <filename>/etc/grub.d/</filename> 中您自己的脚本内的选项。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>SUSE_BTRFS_SNAPSHOT_BOOTING</literal>
     </term>
     <listitem>
      <para>
       如果将此选项设置为 <literal>true</literal>，GRUB 2 可直接引导至 Snapper 快照。有关更多信息，请参见<xref linkend="sec.snapper.snapshot-boot"/>。
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
   <note>
    <para>
     所有 <literal>*_DEFAULT</literal> 参数都可以手动或者使用 YaST 处理。
    </para>
   </note>
   <para>
    有关选项的完整列表，请参见 <ulink url="http://www.gnu.org/software/grub/manual/grub.html#Simple-configuration">GNU GRUB 手册</ulink>。有关可用参数的完整列表，请参见 <ulink url="http://en.opensuse.org/Linuxrc"/>。
   </para>
  </sect2>

  <sect2 id="sec.grub2.etc_grub_d">
   <title><filename>/etc/grub.d</filename> 中的脚本</title>
   <para>
    在执行 <xref linkend="vle.grub2.mkconfig"/> 命令期间，将读取此目录中的脚本，并且这些脚本的说明已整合到 <filename>/boot/grub2/grub.cfg</filename> 中。<filename>grub.cfg</filename> 中菜单项的顺序由此目录中文件的运行顺序来决定。具有前导编号的文件先执行，从最小的编号开始。<filename>00_header</filename> 在 <filename>10_linux</filename> 之前运行，而后者又在 <filename>40_custom</filename> 之前运行。如果存在采用字母名称的文件，这些文件将在采用编号命名的文件后面执行。在执行 <command>grub2-mkconfig</command> 期间，只有可执行文件才能在 <filename>grub.cfg</filename> 中生成输出。默认情况下，<filename>/etc/grub.d</filename> 目录中的所有文件都是可执行文件。最重要的脚本包括：
   </para>
   <variablelist>
    <varlistentry>
     <term><filename>00_header</filename>
     </term>
     <listitem>
      <para>
       设置环境变量，例如系统文件位置、显示设置、主题和以前保存的项。它还可以导入 <filename>/etc/default/grub</filename> 中储存的首选项。通常，不需要对此文件进行更改。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><filename>10_linux</filename>
     </term>
     <listitem>
      <para>
       识别根设备上的 Linux 内核，并创建相关的菜单项。这包括关联的恢复模式选项（如果已启用）。主菜单页中只显示最新内核，其他内核包含在子菜单中。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><filename>30_os-prober</filename>
     </term>
     <listitem>
      <para>
       此脚本使用 <command>OS-prober</command> 来搜索 Linux 和其他操作系统，并将结果放入 GRUB 2 菜单。其中的某些部分可以识别其他特定操作系统，例如 Windows 或 OS X。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><filename>40_custom</filename>
     </term>
     <listitem>
      <para>
       使用此文件可以方便地在 <filename>grub.cfg</filename> 中包含自定义引导项。切勿更改开头的 <literal>exec tail -n +3 $0</literal> 部分。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><filename>90_persistent</filename>
     </term>
     <listitem>
      <para>
       这是一个特殊脚本，它可以复制 <filename>grub.cfg</filename> 文件的相应部分，并按原样输出其内容。这样，您便可以直接修改 <filename>grub.cfg</filename> 的相应部分，并且所做的更改在执行 <xref linkend="vle.grub2.mkconfig"/> 后可以保留下来。
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
   <para>
    处理顺序根据前导编号确定，编号最小的脚本最先执行。如果多个脚本的前导编号相同，则根据整个名称的字母顺序来决定执行顺序。
   </para>
  </sect2>

  <sect2 id="sec.grub2.map">
   <title>BIOS 驱动器与 Linux 设备之间的映射</title><indexterm> <primary>GRUB 2</primary> <secondary>device.map</secondary></indexterm>
   <para>
    在 GRUB Legacy 中，<filename>device.map</filename> 配置文件用于基于 BIOS 驱动器号派生 Linux 设备名称。不一定总能正确猜测出 BIOS 驱动器与 Linux 设备之间的映射。例如，如果 IDE 和 SCSI 驱动器的引导顺序在 BIOS 配置中被交换，则 GRUB Legacy 就会发生顺序错误。
   </para>
   <para>
    GRUB 2 在生成 <filename>grub.cfg</filename> 时使用设备 ID 字符串 (UUID) 或文件系统标签，因此避免了此问题。GRUB 2 实用程序会即时创建一个临时设备映射，这通常足以满足需要，在单磁盘系统中尤其如此。
   </para>
   <para>
    但是，如果您需要覆盖 GRUB 2 的自动设备映射机制，请创建自定义映射文件 <filename>/boot/grub2/device.map</filename>。以下示例将更改映射，使 <literal>DISK 3</literal> 成为引导磁盘。请注意，GRUB 2 分区编号以 <literal>1</literal> 开始，而不是像 GRUB Legacy 中那样以 <literal>0</literal> 开始。
   </para>
<screen>(hd1)  /dev/disk-by-id/<replaceable>DISK3 ID</replaceable>
(hd2)  /dev/disk-by-id/<replaceable>DISK1 ID</replaceable>
(hd3)  /dev/disk-by-id/<replaceable>DISK2 ID</replaceable></screen>
  </sect2>

  <sect2 id="sec.grub2.menu_change">
   <title>在引导过程中编辑菜单项</title><indexterm> <primary>GRUB</primary> <secondary>菜单编辑器</secondary></indexterm>
   <para>
    当系统由于配置错误而不再能够引导时，如果能够直接编辑菜单项，就会很有帮助。使用菜单编辑器还可以在不更改系统配置的情况下测试新设置。
   </para>
   <procedure>
    <step performance="required">
     <para>
      在图形引导菜单中，使用方向键选择要编辑的项。
     </para>
    </step>
    <step performance="required">
     <para>
      按 <keycap>E</keycap> 打开基于文本的编辑器。
     </para>
    </step>
    <step performance="required">
     <para>
      使用方向键移到您要编辑的行。
     </para>
     <figure id="fig.grub2.boot.editor">
      <title>GRUB 2 引导编辑器</title>
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="grub2_edit_config.png" width="75%" format="PNG"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="grub2_edit_config.png" width="75%" format="PNG"/>
       </imageobject>
      </mediaobject>
     </figure>
     <para>
      现在，您可以采取以下两种做法：
     </para>
     <substeps performance="required">
      <step performance="required">
       <para>
        将用空格分隔的参数添加到以 <literal>linux</literal> 或 <literal>linuxefi</literal> 开头的行的末尾，以编辑内核参数。<ulink url="http://en.opensuse.org/Linuxrc"/> 上提供了完整的参数列表。
       </para>
      </step>
      <step performance="required">
       <para>
        或者编辑常规选项，以更改内核版本等。按 <keycap function="tab"/> 键会显示所有可能的补全建议。
       </para>
      </step>
     </substeps>
    </step>
    <step performance="required">
     <para>
      按 <keycap>F10</keycap> 使用您所做的更改引导系统，或者按 <keycap function="escape"/> 放弃您的编辑，并返回到 GRUB 2 菜单。
     </para>
    </step>
   </procedure>
   <para>
    通过这种方式进行的更改仅会应用到当前引导过程，而不会永久保存。
   </para>
   <important>
    <title>引导过程中的键盘布局</title>
    <para>
     US 键盘布局是引导时唯一可用的键盘布局。请参见<xref linkend="fig.trouble.install.keyboard_us"/>。
    </para>
   </important>
   <note arch="x86_64">
    <title>安装媒体中的引导加载程序</title>
    <para>
     在使用传统 BIOS 的系统上，安装媒体中的引导加载程序仍是 GRUB Legacy。要添加引导选项，请选择一个项，然后开始键入。在安装引导项中添加的选项将永久保存在安装的系统中。
    </para>
   </note>
   <note arch="zseries">
    <title>在 System z 上编辑 GRUB 2 菜单项</title>
    <para>
     IBM System z 上的光标移动操作和编辑命令有所不同 — 有关细节，请参见<xref linkend="sec.grub2.zseries"/>。
    </para>
   </note>
  </sect2>

  <sect2 id="sec.grub2.password">
   <title>设置引导密码</title><indexterm> <primary>GRUB 2</primary> <secondary>引导口令</secondary></indexterm>
   <para>
    即使是在引导操作系统之前，GRUB 2 也支持对文件系统的访问。没有 root 权限的用户可以访问 Linux 系统中的文件，而在引导系统后，他们将无权访问这些文件。要阻止此类访问或防止用户引导某些菜单项，请设置引导口令。
   </para>
   <important>
    <title/>
    <para>
     如果设置了引导口令，则每次引导时都需要输入该口令，这意味着系统不会自动引导。
    </para>
   </important>
   <para>
    按如下步骤设置引导口令。或者使用 YaST（<xref linkend="vle.grub2.yast2.boot.password"/>）。
   </para>
   <procedure>
    <step performance="required">
     <para>
      使用 <command>grub2-mkpasswd-pbkdf2</command> 来加密口令：
     </para>
<screen><prompt role="user">tux &gt; </prompt> sudo grub2-mkpasswd-pbkdf2
Password: ****
Reenter password: ****
PBKDF2 hash of your password is grub.pbkdf2.sha512.10000.9CA4611006FE96BC77A...
</screen>
    </step>
    <step performance="required">
     <para>
      将生成的字符串连同 <command>set superusers</command> 命令一起粘贴到文件 <filename>/etc/grub.d/40_custom</filename> 中。
     </para>
<screen>set superusers="root"
password_pbkdf2 root grub.pbkdf2.sha512.10000.9CA4611006FE96BC77A...</screen>
    </step>
    <step performance="required">
     <para>
      运行 <xref linkend="vle.grub2.mkconfig"/> 将更改导入到主配置文件中。
     </para>
     <para>
      在重引导后，当您尝试引导某个菜单项时，系统会提示您输入用户名和口令。输入 <literal>root</literal> 以及您在执行 <command>grub2-mkpasswd-pbkdf2</command> 命令期间键入的口令。如果身份凭证正确，系统将引导选定的引导项。
     </para>
    </step>
   </procedure>
  </sect2>
 </sect1>
 <xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="grub2_yast_i.xml" parse="xml"/>
 <sect1 id="sec.grub2.zseries">
  <title>System z 上终端使用方式的差异</title>

  <para>
   在 3215 和 3270 终端上，光标的移动方式以及在 GRUB 2 中发出编辑命令的方式存在一些差异和限制。
  </para>

  <sect2 id="sec.grub2.zseries.limitations">
   <title>限制</title>
   <variablelist>
    <varlistentry>
     <term>交互能力</term>
     <listitem>
      <para>
       交互性存在严重的限制。键入时通常不能获得直观的反馈。要查看光标所在的位置，请键入下划线 (<keycap>_</keycap>)。
      </para>
      <note>
       <para>
        与 3215 终端相比，3270 终端在显示和刷新屏幕方面要好得多。
       </para>
      </note>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>光标的移动</term>
     <listitem>
      <para>
       无法进行<quote>传统的</quote>光标移动操作。<keycap function="alt"/>、<keycap function="meta"/>、<keycap function="control"/> 和光标键不起作用。要移动光标，请使用<xref linkend="sec.grub2.zseries.keys"/>中列出的组合键。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>加字符</term>
     <listitem>
      <para>
       插入符 (<keycap>^</keycap>) 用作控制字符。要键入文本 <keycap>^</keycap> 后再键入一个字母，请键入 <keycap>^</keycap>、<keycap>^</keycap> 和<replaceable>字母</replaceable>。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>输入</term>
     <listitem>
      <para>
       <keycap function="enter"/> 键不起作用，请改用 <keycombo><keycap>^</keycap> <keycap>j</keycap></keycombo>。
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
  </sect2>

  <sect2 id="sec.grub2.zseries.keys">
   <title>组合键</title>
   <informaltable>
    <tgroup cols="3">
     <tbody>
      <row>
       <entry morerows="2" valign="top">
        <para>
         常用的替代键
        </para>
       </entry>
       <entry>
        <para>
         <keycombo><keycap>^</keycap> <keycap>J</keycap></keycombo>
        </para>
       </entry>
       <entry>
        <para>
         确认（<quote>Enter</quote>）
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <keycombo><keycap>^</keycap><keycap>L</keycap></keycombo>
        </para>
       </entry>
       <entry>
        <para>
         中止，返回前一<quote>状态</quote>
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <keycombo><keycap>^</keycap><keycap>I</keycap></keycombo>
        </para>
       </entry>
       <entry>
        <para>
         Tab 键补全（在编辑模式与外壳模式下）
        </para>
       </entry>
      </row>
      <row>
       <entry morerows="8" valign="top">
        <para>
         菜单模式下可用的键：
        </para>
       </entry>
       <entry>
        <para>
         <keycombo><keycap>^</keycap><keycap>A</keycap></keycombo>
        </para>
       </entry>
       <entry>
        <para>
         移到第一项
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <keycombo><keycap>^</keycap><keycap>E</keycap></keycombo>
        </para>
       </entry>
       <entry>
        <para>
         移到最后一项
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <keycombo><keycap>^</keycap><keycap>P</keycap></keycombo>
        </para>
       </entry>
       <entry>
        <para>
         移到上一项
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <keycombo><keycap>^</keycap><keycap>N</keycap></keycombo>
        </para>
       </entry>
       <entry>
        <para>
         移到下一项
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <keycombo><keycap>^</keycap><keycap>G</keycap></keycombo>
        </para>
       </entry>
       <entry>
        <para>
         上移一页
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <keycombo><keycap>^</keycap><keycap>C</keycap></keycombo>
        </para>
       </entry>
       <entry>
        <para>
         下移一页
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <keycombo><keycap>^</keycap><keycap>F</keycap></keycombo>
        </para>
       </entry>
       <entry>
        <para>
         引导选定的项或进入子菜单（与 <keycombo><keycap>^</keycap><keycap>J</keycap></keycombo> 相同）
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <keycombo><keycap>E</keycap></keycombo>
        </para>
       </entry>
       <entry>
        <para>
         编辑选定的项
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <keycombo><keycap>c</keycap></keycombo>
        </para>
       </entry>
       <entry>
        <para>
         进入 GRUB-Shell
        </para>
       </entry>
      </row>
      <row>
       <entry morerows="13" valign="top">
        <para>
         编辑模式下可用的键：
        </para>
       </entry>
       <entry>
        <para>
         <keycombo><keycap>^</keycap><keycap>P</keycap></keycombo>
        </para>
       </entry>
       <entry>
        <para>
         上移一行
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <keycombo><keycap>^</keycap><keycap>N</keycap></keycombo>
        </para>
       </entry>
       <entry>
        <para>
         下移一行
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <keycombo><keycap>^</keycap><keycap>B．</keycap></keycombo>
        </para>
       </entry>
       <entry>
        <para>
         向左移一个字符
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <keycombo><keycap>^</keycap><keycap>F</keycap></keycombo>
        </para>
       </entry>
       <entry>
        <para>
         向右移一个字符
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <keycombo><keycap>^</keycap><keycap>A</keycap></keycombo>
        </para>
       </entry>
       <entry>
        <para>
         移到行首
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <keycombo><keycap>^</keycap><keycap>E</keycap></keycombo>
        </para>
       </entry>
       <entry>
        <para>
         移到行尾
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <keycombo><keycap>^</keycap><keycap>H</keycap></keycombo>
        </para>
       </entry>
       <entry>
        <para>
         退格
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <keycombo><keycap>^</keycap><keycap>D</keycap></keycombo>
        </para>
       </entry>
       <entry>
        <para>
         删除
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <keycombo><keycap>^</keycap><keycap>K</keycap></keycombo>
        </para>
       </entry>
       <entry>
        <para>
         删除光标起当前行
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <keycombo><keycap>^</keycap><keycap>Y</keycap></keycombo>
        </para>
       </entry>
       <entry>
        <para>
         复制
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <keycombo><keycap>^</keycap><keycap>O</keycap></keycombo>
        </para>
       </entry>
       <entry>
        <para>
         插入空行
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <keycombo><keycap>^</keycap><keycap>L</keycap></keycombo>
        </para>
       </entry>
       <entry>
        <para>
         刷新屏幕
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <keycombo><keycap>^</keycap><keycap>X</keycap></keycombo>
        </para>
       </entry>
       <entry>
        <para>
         引导项
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <keycombo><keycap>^</keycap><keycap>C</keycap></keycombo>
        </para>
       </entry>
       <entry>
        <para>
         进入 GRUB-Shell
        </para>
       </entry>
      </row>
      <row>
       <entry morerows="10" valign="top">
        <para>
         命令行模式下可用的键：
        </para>
       </entry>
       <entry>
        <para>
         <keycombo><keycap>^</keycap><keycap>P</keycap></keycombo>
        </para>
       </entry>
       <entry>
        <para>
         上一个命令
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <keycombo><keycap>^</keycap><keycap>N</keycap></keycombo>
        </para>
       </entry>
       <entry>
        <para>
         历史中的下一个命令
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <keycombo><keycap>^</keycap><keycap>A</keycap></keycombo>
        </para>
       </entry>
       <entry>
        <para>
         移到行首
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <keycombo><keycap>^</keycap><keycap>E</keycap></keycombo>
        </para>
       </entry>
       <entry>
        <para>
         移到行尾
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <keycombo><keycap>^</keycap><keycap>B</keycap></keycombo>
        </para>
       </entry>
       <entry>
        <para>
         向左移一个字符
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <keycombo><keycap>^</keycap><keycap>F</keycap></keycombo>
        </para>
       </entry>
       <entry>
        <para>
         向右移一个字符
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <keycombo><keycap>^</keycap><keycap>H</keycap></keycombo>
        </para>
       </entry>
       <entry>
        <para>
         退格
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <keycombo><keycap>^</keycap><keycap>D</keycap></keycombo>
        </para>
       </entry>
       <entry>
        <para>
         删除
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <keycombo><keycap>^</keycap><keycap>K</keycap></keycombo>
        </para>
       </entry>
       <entry>
        <para>
         删除光标起当前行
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <keycombo><keycap>^</keycap><keycap>U</keycap></keycombo>
        </para>
       </entry>
       <entry>
        <para>
         删除行
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <keycombo><keycap>^</keycap><keycap>Y</keycap></keycombo>
        </para>
       </entry>
       <entry>
        <para>
         复制
        </para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>
 </sect1>
 <sect1 id="sec.grub2.commands">
  <title>有用的 GRUB 2 命令</title>

  <variablelist>
   <varlistentry id="vle.grub2.mkconfig">
    <term><command>grub2-mkconfig</command>
    </term>
    <listitem>
     <para>
      基于 <filename>/etc/default/grub</filename> 以及 <filename>/etc/grub.d/</filename> 中的脚本生成新的 <filename>/boot/grub2/grub.cfg</filename>。
     </para>
     <example>
      <title>grub2-mkconfig 用法</title>
<screen>grub2-mkconfig -o /boot/grub2/grub.cfg</screen>
     </example>
     <tip>
      <title>语法检查</title>
      <para>
       运行不带任何参数的 <command>grub2-mkconfig</command> 会将配置打印到 STDOUT 中供用户查看。在写入 <filename>/boot/grub2/grub.cfg</filename> 后使用 <xref linkend="vle.grub2.script_check"/> 可以检查其语法。
      </para>
     </tip>
    </listitem>
   </varlistentry>
   <varlistentry id="vle.grub2.mkrescue">
    <term><command>grub2-mkrescue</command>
    </term>
    <listitem>
     <para>
      为安装的 GRUB 2 配置创建一个可引导的救援映像。
     </para>
     <example>
      <title>grub2-mkrescue 用法</title>
<screen>grub2-mkrescue -o save_path/name.iso iso</screen>
     </example>
    </listitem>
   </varlistentry>
   <varlistentry id="vle.grub2.script_check">
    <term><command>grub2-script-check</command>
    </term>
    <listitem>
     <para>
      检查给定文件中有无语法错误。
     </para>
     <example>
      <title>grub2-script-check 用法</title>
<screen>grub2-check-config /boot/grub2/grub.cfg</screen>
     </example>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><command>grub2-once</command>
    </term>
    <listitem>
     <para>
      仅设置下次引导的默认引导项。要获取可用引导项的列表，请使用 <option>--list</option> 选项。
     </para>
     <example>
      <title>grub2-once 用法</title>
<screen>grub2-once number_of_the_boot_entry</screen>
     </example>
     <tip>
      <para>
       不使用任何选项调用该程序可以获取所有可用选项的完整列表。
      </para>
     </tip>
    </listitem>
   </varlistentry>
  </variablelist>
 </sect1>
 <sect1 id="sec.grub2.info">
  <title>更多信息</title>

  <para>
   <ulink url="http://www.gnu.org/software/grub/"/> 上提供了有关 GRUB 2 的大量信息。还请参见 <command>grub</command> 信息页面。您也可以在位于 <ulink url="http://www.suse.com/support"/> 的支持数据库中搜索关键字 <quote>GRUB 2</quote> 来获取有关特殊问题的信息。
  </para>
 </sect1>
</chapter>
