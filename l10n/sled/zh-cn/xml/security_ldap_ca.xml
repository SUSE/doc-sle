<?xml version="1.0" encoding="UTF-8"?>
<sect1 xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="security_ldap_ca.xml" version="5.0" xml:id="sec-security-ldap-server-ca"> <title>使用 TSL 的 CA 证书</title>
 <info>
      <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
        <dm:translation>yes</dm:translation>
      </dm:docmanager>
    </info>
    <para>
  您可以使用以下命令行工具管理 389 目录服务器的 CA 证书：<command>certutil</command>、<command>openssl</command> 和 <command>pk12util</command>。
 </para>
 <para>
  如要进行测试，您可以使用 <command>dscreate</command> 创建一个自我签名证书。该证书储存在 <filename>/etc/dirsrv/slapd-localhost/ca.crt</filename> 中。如要进行远程管理，需将该证书复制到某个可读取的位置。对于生产环境，请联系您的组织所选的 CA 机构，并请求服务器证书、客户端证书和根证书。
 </para>
 <para>
 在执行以下过程之前，请确保符合下述要求：
 </para>
 <itemizedlist>
  <listitem>
   <para>
    您拥有可用于建立 TLS 连接的服务器证书和私用密钥。
   </para>
  </listitem>
  <listitem>
   <para>
    已设置 NSS（网络安全服务）数据库（例如，使用 <command>certutil</command> 命令设置）。
   </para>
  </listitem>
 </itemizedlist>

 <procedure>
  <para>
  在可将现有私用密钥和证书导入 NSS（网络安全服务）数据库之前，需要创建私用密钥和服务器证书的捆绑包。这会生成一个 <filename>*.p12</filename> 文件。
  </para>
  <important>
  <title><filename>*.p12</filename> 文件和友好名称</title>
  <para>
   在创建 PKCS12 捆绑包时，必须将 <filename>*.p12</filename> 文件中的友好名称进行编码。
  </para>
  <para>
   请务必使用 <literal>Server-Cert</literal> 作为友好名称，否则 TLS 连接将会失败，因为 389 目录服务器只会搜索此字符串。
  </para>
  <para>
    请注意，将 <filename>*.p12</filename> 文件导入 NSS 数据库后，就无法更改该友好名称。
  </para>
 </important>
 <step>
  <para>
   使用下面的命令可创建包含所需友好名称的 PKCS12 捆绑包：
  </para>
 <screen><prompt role="root">root # </prompt>openssl pkcs12 -export -in <replaceable>SERVER.crt</replaceable> \
  -inkey <replaceable>SERVER.key</replaceable> -out <replaceable>SERVER.p12</replaceable> \
  -name Server-Cert</screen>
  <para>
   请将 <replaceable>SERVER.crt</replaceable> 替换为服务器证书，将 <replaceable>SERVER.key</replaceable> 替换为要捆绑的私用密钥。使用 <option>-out</option> 指定 <filename>*.p12</filename> 文件的名称。使用 <option>-name</option> 设置要使用的友好名称：<literal>Server-Cert</literal>。
  </para>
 </step>
 <step>
   <para>
     在可将该文件导入 NSS 数据库之前，需获取该文件的口令。为此，请使用下面的命令：
   </para>
<screen>pk12util -i <replaceable>PATH_TO_SERVER.p12</replaceable> -d sql:PATH_TO_NSS_DB -n Server-cert -W <replaceable>SERVER.p12_PASSWORD</replaceable></screen>
   <para>
     然后，您便可在 <replaceable>PATH_TO_NSS_DB</replaceable> 目录下的 <filename>pwdfile.txt</filename> 文件中找到该口令。
   </para>
 </step>
 <step>
  <para>
   现在，将 <replaceable>SERVER.p12</replaceable> 文件导入 NSS 数据库：
  </para>
  <screen>pk12util -i <replaceable>SERVER.p12</replaceable> -d <replaceable>PATH_TO_NSS_DB</replaceable></screen>
 </step>
 </procedure>
 </sect1>
