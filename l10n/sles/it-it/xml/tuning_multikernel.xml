<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="tuning_multikernel.xml" version="5.0" xml:id="cha-tuning-multikernel">
 <title>Installazione di più versioni del kernel</title>
 <info>
  <abstract>
   <para>
    <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> supporta l'installazione parallela di più versioni del kernel. Quando si installa un secondo kernel, vengono creati automaticamente una voce di avvio e un disco initrd, pertanto non è necessaria alcuna ulteriore configurazione manuale. Al riavvio del computer, il kernel appena aggiunto è disponibile come parametro di avvio aggiuntivo.
   </para>

   <para>
    Utilizzando questa funzionalità, è possibile verificare in modo sicuro gli aggiornamenti del kernel avendo sempre la possibilità di tornare al kernel precedente. A questo scopo, non utilizzare gli strumenti di aggiornamento (come YaST Online Update o l'applet del programma di aggiornamento), ma seguire la procedura descritta in questo capitolo.
   </para>
  </abstract>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:bugtracker/>
   <dm:translation>sì</dm:translation>
  </dm:docmanager>
 </info>
 <warning os="sles;sled">

  <title>diritto al supporto</title>
  <para>
   È importante essere consapevoli che, quando si installa un kernel autocompilato o di terze parti, si perdono tutti i diritti al supporto. Sono supportati solo i kernel forniti con <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> e quelli distribuiti tramite i canali di aggiornamento ufficiali per <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase>.
  </para>
 </warning>
 <tip>
  <title>verificare il kernel di configurazione del boot loader</title>
  <para>
   Dopo l'installazione di un kernel aggiuntivo, è consigliabile verificare la configurazione del boot loader per impostare la voce di avvio di default preferita. Per ulteriori informazioni, vedere <xref linkend="sec-grub2-yast2-config"/>.
  </para>
 </tip>
 <sect1 xml:id="sec-tuning-multikernel-enable">
  <title>Abilitazione e configurazione del supporto multiversione</title>



  <para>
   L'installazione di più versioni di un pacchetto software (supporto multiversione) è abilitata per impostazione predefinita a partire da <phrase os="sles;sled">SUSE Linux Enterprise Server 12</phrase>. Per verificare l'impostazione, procedere come segue:
  </para>

  <procedure>
   <step>
    <para>
     Aprire <filename>/etc/zypp/zypp.conf</filename> con l'editor preferito come <systemitem class="username">root</systemitem>.
    </para>
   </step>
   <step>
    <para>
     Cercare la stringa <literal>multiversion</literal>. Se è abilitata la funzione multiversione per tutti i pacchetti kernel che la supportano, viene visualizzata la riga seguente priva di commenti:
    </para>
<screen>multiversion = provides:multiversion(kernel)</screen>
   </step>
   <step>
    <para>
     Per limitare il supporto multiversione solo a determinati tipi di kernel, aggiungere l'elenco dei nomi dei pacchetti separati da virgole all'opzione <literal>multiversion</literal> in <filename>/etc/zypp/zypp.conf</filename>, ad esempio
    </para>
<screen>multiversion = kernel-default,kernel-default-base,kernel-source
</screen>
   </step>
   <step>
    <para>
     Salvare le modifiche apportate.
    </para>
   </step>
  </procedure>

  <warning>
   <title>Kernel Module Package (KMP)</title>
   <para>
    Accertarsi i moduli kernel necessari forniti dal fornitore (Kernel Module Package) siano installati anche per il nuovo kernel aggiornato. Durante il processo di aggiornamento del kernel non si riceverà alcun avviso in merito a eventuali moduli kernel mancanti perché i requisiti del pacchetto vengono ancora soddisfatti dal kernel precedente tuttora presente nel sistema.
   </para>
  </warning>

  <sect2 xml:id="sec-tuning-multikernel-enable-keep">
   <title>Eliminazione automatica dei kernel non utilizzati</title>
   <para>
    Quando viene eseguito frequentemente il test dei nuovi kernel con supporto multiversione abilitato, nel menu di avvio si genera rapidamente confusione. Poiché nella partizione <filename>/boot</filename> generalmente lo spazio disponibile è limitato, potrebbe verificarsi anche un problema di overflow. Sebbene sia possibile eliminare manualmente le versioni del kernel non utilizzate con YaST o Zypper (come descritto di seguito), è anche possibile configurare <systemitem class="library">libzypp</systemitem> in modo che i kernel non più utilizzati vengano eliminati automaticamente. Per default i kernel non vengono eliminati.
   </para>
   <procedure>
    <step>
     <para>
      Aprire <filename>/etc/zypp/zypp.conf</filename> con l'editor preferito come <systemitem class="username">root</systemitem>.
     </para>
    </step>
    <step>
     <para>
      Cercare la stringa <literal>multiversion.kernels</literal> e attivare questa opzione rimuovendo il commento dalla riga. Per questa opzione è disponibile un elenco dei valori seguenti separati da virgola:
     </para>
     <formalpara>
      <title><literal><replaceable>5.3.18-53.3</replaceable></literal>:</title>
      <para>
       conservare il kernel con il numero di versione specificato
      </para>
     </formalpara>
     <formalpara>
      <title><literal>latest</literal>:</title>
      <para>
       conservare il kernel con il numero di versione più alto
      </para>
     </formalpara>
     <formalpara>
      <title><literal>latest-N</literal>:</title>
      <para>
       conservare il kernel con l'ennesimo numero di versione più alto
      </para>
     </formalpara>
     <formalpara>
      <title><literal>running</literal>:</title>
      <para>
       conservare il kernel in esecuzione
      </para>
     </formalpara>
     <formalpara>
      <title><literal>oldest</literal>:</title>
      <para>
       conservare il kernel con il numero di versione più basso (quello originariamente fornito con <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase>)
      </para>
     </formalpara>
     <formalpara>
      <title><literal>oldest+N</literal>:</title>
      <para>
       conservare il kernel con l'ennesimo numero di versione più basso
      </para>
     </formalpara>
     <para>
      Di seguito sono riportati alcuni esempi
     </para>
     <variablelist>
      <varlistentry>
       <term><literal>multiversion.kernels = latest,running</literal>
       </term>
       <listitem>
        <para>
         Conservare il kernel più recente e quello correntemente in esecuzione. Questa situazione è analoga alla disabilitazione del supporto di più versioni, ma in questo caso il kernel precedente viene rimosso <emphasis>dopo il successivo riavvio</emphasis> e non immediatamente dopo l'installazione.
        </para>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term><literal>multiversion.kernels = latest,latest-1,running </literal>
       </term>
       <listitem>
        <para>
         Conservare gli ultimi due kernel e quello correntemente in esecuzione.
        </para>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term><literal>multiversion.kernels = latest,running,<replaceable>5.3.18-53.3 </replaceable></literal>
       </term>
       <listitem>
        <para>
         Conservare il kernel più recente, quello attualmente in esecuzione e <replaceable>5.3.18-53.3</replaceable>.
        </para>
       </listitem>
      </varlistentry>
     </variablelist>
     <tip>
      <title>conservare il kernel in esecuzione</title>
      <para>
       A meno che non si utilizzi un determinato programma di installazione, mantenere sempre il kernel contrassegnato come <literal>in esecuzione</literal>.
      </para>
      <para>
       Se non si mantiene in esecuzione il kernel, questo viene eliminato durante l'aggiornamento. Di conseguenza, ciò significa che vengono eliminati anche tutti i moduli del kernel in esecuzione e non sarà più possibile caricarli.
      </para>
      <para>
       Se si decide di mantenere in esecuzione il kernel, per evitare problemi con i moduli, riavviare sempre il sistema subito dopo l'upgrade del kernel.
      </para>
     </tip>
    </step>
   </procedure>
  </sect2>
  <sect2 xml:id="sec-tuning-multikernel-deleteoldkernel">
   <title>Caso d'uso: eliminazione di un kernel precedente solo dopo il riavvio</title>
   <para>
    Si supponga di voler essere sicuri che il kernel precedente venga eliminato solo dopo aver riavviato il sistema con il nuovo kernel.
   </para>
   <para>
    Modificare la riga che segue in <filename>/etc/zypp/zypp.conf</filename>:
   </para>
<screen>multiversion.kernels = latest,running</screen>
   <para>
    I parametri precedenti indicano al sistema di conservare il kernel più recente e quello in esecuzione solo se sono diversi tra loro.
   </para>
  </sect2>

  <sect2 xml:id="sec-tuning-multikernel-fallback">
   <title>Caso d'uso: conservazione dei kernel precedenti come fallback</title>
   <para>
    Si supponga di voler conservare una o più versioni di kernel per avere uno o più kernel <quote>di ricambio</quote>.
   </para>
   <para>
    Questo caso d'uso può risultare utile quando servono kernel per eseguire dei test. In caso di problemi, ad esempio se il computer non si avvia, è comunque possibile utilizzare una o più versioni di kernel notoriamente valide.
   </para>
   <para>
    Modificare la riga che segue in <filename>/etc/zypp/zypp.conf</filename>:
   </para>
<screen>multiversion.kernels = latest,latest-1,latest-2,running</screen>
   <para>
    Quando si riavvia il sistema dopo aver installato un nuovo kernel, nel sistema rimangono tre kernel: quello attuale (configurato come <literal>latest,running</literal>) e i due immediati predecessori (configurati rispettivamente come <literal>latest-1</literal> e <literal>latest-2</literal>).
   </para>
  </sect2>

  <sect2 xml:id="sec-tuning-multikernel-specificversion">
   <title>Caso d'uso: mantenimento di una versione specifica del kernel</title>
   <para>
    L'utente effettua regolarmente aggiornamenti di sistema e installa nuove versioni di kernel. Tuttavia l'utente compila anche una versione personalizzata del kernel e vuole essere sicuro che il sistema la mantenga.
   </para>
   <para>
    Modificare la riga che segue in <filename>/etc/zypp/zypp.conf</filename>:
   </para>
<screen>multiversion.kernels = latest,5.3.18-53.3,running</screen>
   <para>
    Quando si riavvia il sistema dopo l'installazione di un nuovo kernel, il sistema conserverà due kernel: quello nuovo in esecuzione (configurato come <literal>latest,running</literal>) e quello autocompilato (configurato come <literal>5.3.18-53.3</literal>).
   </para>
  </sect2>
 </sect1>
 <sect1 xml:id="sec-tuning-multikernel-yast">
  <title>Installazione/rimozione di più versioni del kernel con YaST</title>
  <para>
   È possibile installare o rimuovere più kernel con YaST:
  </para>
  <procedure>
   <step>
    <para>
     Avviare YaST e aprire il programma di gestione del software da <menuchoice>
     <guimenu>Software</guimenu> <guimenu>Gestione pacchetti</guimenu>
     </menuchoice>.
    </para>
   </step>
   <step>
    <para>
     Elencare tutti i pacchetti in grado di fornire più versioni scegliendo <menuchoice> <guimenu>Visualizza</guimenu> <guimenu>Gruppi di pacchetti</guimenu>
     <guimenu> Pacchetti multiversione</guimenu> </menuchoice>.
    </para>
    <figure>
     <title>Programma di gestione del software YaST: visualizzazione multiversione</title>
     <mediaobject>
      <imageobject role="fo">
       <imagedata fileref="yast2_sw_multiversion.png" width="90%" format="PNG"/>
      </imageobject>
      <imageobject role="html">
       <imagedata fileref="yast2_sw_multiversion.png" width="90%" format="PNG"/>
      </imageobject>
     </mediaobject>
    </figure>
   </step>
   <step>
    <para>
     Selezionare un pacchetto e aprire la rispettiva scheda <guimenu>Versione</guimenu> nel riquadro in basso a sinistra.
    </para>
   </step>
   <step>
    <para>
     Per installare un pacchetto, fare clic sulla casella di controllo corrispondente. Un segno di spunta verde indica che il pacchetto è selezionato per l'installazione.
    </para>
    <para>
     Per rimuovere un pacchetto già installato (contrassegnato da un segno di spunta bianco), fare clic sulla casella di controllo corrispondente fino a visualizzare una <literal>X</literal> rossa che indica che il pacchetto è selezionato per la rimozione.
    </para>
   </step>
   <step>
    <para>
     Fare clic su <guimenu>Accetta</guimenu> per avviare l'installazione.
    </para>
   </step>
  </procedure>
 </sect1>
 <sect1 xml:id="sec-tuning-multikernel-zypper">
  <title>Installazione/rimozione di più versioni del kernel con Zypper</title>
  <para>
   È possibile installare o rimuovere più kernel con <command>zypper</command>:
  </para>
  <procedure>
   <step>
    <para>
     Utilizzare il comando <command>zypper se -s 'kernel*'</command> per visualizzare un elenco di tutti i pacchetti di kernel disponibili:
    </para>
<screen><?dbsuse-fo font-size="7pt"?>


S  | Name                 | Type    | Version           | Arch   | Repository
---+----------------------+---------+-------------------+--------+---------------------------------
i+ | kernel-default       | package | 5.3.18-53.3       | x86_64 | (System Packages)
i+ | kernel-default       | package | 5.3.18-54.2       | x86_64 | SLE-Module-Basesystem15-SP3-Pool
   | kernel-default-base  | package | 5.3.18-54.2.16.15 | x86_64 | SLE-Module-Basesystem15-SP3-Pool
   | kernel-default-devel | package | 5.3.18-54.2       | x86_64 | SLE-Module-Basesystem15-SP3-Pool
   | kernel-devel         | package | 5.3.18-54.2       | noarch | SLE-Module-Basesystem15-SP3-Pool
i  | kernel-firmware      | package | 20210208-2.4      | noarch | SLE-Module-Basesystem15-SP3-Pool
   | kernel-macros        | package | 5.3.18-54.2       | noarch | SLE-Module-Basesystem15-SP3-Pool
   | kernel-preempt       | package | 5.3.18-54.2       | x86_64 | SLE-Module-Basesystem15-SP3-Pool
</screen>
   </step>
   <step>
    <para>
     Specificare l'esatta versione durante l'installazione:
    </para>
<screen><prompt>tux &gt; </prompt><command>sudo</command> zypper in kernel-default-5.3.18-53.3</screen>
   </step>
   <step>
    <para>
     Quando si disinstalla un kernel, utilizzare i comandi <command>zypper se -si 'kernel*'</command> per elencare tutti i kernel installati e <command>zypper rm</command> <replaceable>PACKAGENAME-VERSION</replaceable> per rimuovere il pacchetto.
    </para>
   </step>
  </procedure>
 </sect1>
 
</chapter>
