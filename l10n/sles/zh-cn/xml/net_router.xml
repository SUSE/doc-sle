<?xml version="1.0" encoding="UTF-8"?>
<sect1 xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="net_router.xml" version="5.0" xml:id="sec-network-router">
 <title>路由器基本设置</title>



 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:bugtracker/>
   <dm:translation>yes</dm:translation>
  </dm:docmanager>
 </info>

 <para>
  路由器是一种联网设备，可收发往来于多个网络的数据（网络包）。路由器常用于将本地网络连接到远程网络（互联网）或连接多个本地网段。通过 <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase>，您可以构建一个具备 NAT（网络地址转换）或高级防火墙等功能的路由器。
 </para>



 <para>
  下面是将 <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> 转变为路由器的基本步骤。
 </para>

 <procedure>
  <step>
   <para>
    例如，在 <filename>/etc/sysctl.d/50-router.conf</filename> 中启用转发
   </para>
<screen>net.ipv4.conf.all.forwarding = 1
net.ipv6.conf.all.forwarding = 1</screen>
   <para>
    然后提供接口的静态 IPv4 和 IPv6 IP 设置。启用转发会禁用多种机制，例如，IPv6 不再接受 IPv6 RA（路由器广告），这也会阻止创建默认路由。
   </para>
  </step>
  <step>
   <para>
    在许多情况下，例如，当您可以通过多个接口连接同一个网络，或者通常使用的是 VPN（已位于<quote>常规多宿主主机</quote>上）时，必须禁用 IPv4 反向路径过滤（此功能当前不适用于 IPv6）：
   </para>
<screen>net.ipv4.conf.all.rp_filter = 0</screen>
   <para>
    您也可以改为通过防火墙设置进行过滤。
   </para>
  </step>
  <step>
   <para>
    要从外部、上行或 ISP 接口上的路由器接受 IPv6 RA 并重新创建默认（或者更具特定性）的 IPv6 路由，请设置：
   </para>
<screen>net.ipv6.conf.${ifname}.accept_ra = 2
net.ipv6.conf.${ifname}.autoconf = 0</screen>
   <para>
    （注意：在以点分隔的 sysfs 路径中，<quote><literal>eth0.42</literal></quote>需写成 <literal>eth0/42</literal>。）
   </para>
  </step>
 </procedure>

 <para>
  有关更多路由器行为和转发依赖项的信息，请参见 <link xlink:href="https://www.kernel.org/doc/Documentation/networking/ip-sysctl.txt">https://www.kernel.org/doc/Documentation/networking/ip-sysctl.txt</link>。
 </para>

 <para>
  要在内部 (DMZ) 接口上提供 IPv6 并将您自己通告为 IPv6 路由器，同时为客户端<quote>自动配置网络</quote>，请安装 <systemitem class="daemon">radvd</systemitem> 并在 <filename>/etc/radvd.conf</filename> 中进行配置，例如：
 </para>

<screen>interface eth0
{
    IgnoreIfMissing on;         # do not fail if interface missed

    AdvSendAdvert on;           # enable sending RAs
    AdvManagedFlag on;          # IPv6 addresses managed via DHCPv6
    AdvOtherConfigFlag on;      # DNS, NTP... only via DHCPv6

    AdvDefaultLifetime 3600;    # client default route lifetime of 1 hour

    prefix 2001:db8:0:1::/64    # (/64 is default and required for autoconf)
    {
        AdvAutonomous off;         # Disable address autoconf (DHCPv6 only)

        AdvValidLifetime 3600;     # prefix (autoconf addr) is valid 1 h
        AdvPreferredLifetime 1800; # prefix (autoconf addr) is prefered 1/2 h
    }
}</screen>

 <para>
  配置防火墙，以通过 NAT 掩蔽从 LAN 进入 WAN 的通讯，并在 WAN 接口上阻止入站通讯：
 </para>
<screen><prompt>&gt; </prompt><command>sudo</command> <command>firewall-cmd</command> --permanent --zone=external --change-interface=<replaceable>WAN_INTERFACE</replaceable>
<prompt>&gt; </prompt><command>sudo</command> <command>firewall-cmd</command> --permanent --zone=external --add-masquerade
<prompt>&gt; </prompt><command>sudo</command> <command>firewall-cmd</command> --permanent --zone=internal --change-interface=<replaceable>LAN_INTERFACE</replaceable>
<prompt>&gt; </prompt><command>sudo</command> <command>firewall-cmd</command> --reload</screen>
</sect1>
