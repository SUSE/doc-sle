<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="net_dns.xml" version="5.0" xml:id="cha-dns">
 <title>ドメインネームシステム</title>
 <info>
  <abstract>
   <para>
    DNS (ドメインネームシステム)は、ドメイン名とホスト名をIPアドレスに解決するために必要です。これにより、たとえばIPアドレス192.168.2.100がホスト名<literal>jupiter</literal>に割り当てられます。独自のネームサーバをセットアップする前に、<xref linkend="sec-network-nameres"/>でDNSに関する一般的な説明を参照してください。次の設定例は、デフォルトのDNSサーバであるBINDについて示しています。
   </para>
  </abstract>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:bugtracker/>
   <dm:translation>yes</dm:translation>
  </dm:docmanager>
 </info>

 <sect1 xml:id="sec-dns-basic">
  <title> DNS 用語 </title>

  <variablelist>
   <varlistentry>
    <term>ゾーン</term>
    <listitem>
     <para>
      ドメインのネームスペースは、ゾーンと呼ばれる領域に分割されます。たとえば、<literal>example.com</literal>の場合は、<literal>com</literal>ドメインの<literal>example</literal>セクション(つまりゾーン)を表します。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>DNSサーバ</term>
    <listitem>
     <para>
      DNSサーバは、ドメインの名前とIP情報を管理するサーバです。プライマリゾーン用にプライマリDNSサーバ、セカンダリゾーン用にセカンダリサーバ、またはキャッシュ用にいずれのゾーンも持たないセカンダリサーバを持つことできます。
     </para>
     <variablelist>
      <varlistentry>
       <term>プライマリゾーンのDNSサーバ</term>
       <listitem>
        <para>
         プライマリゾーンにはネットワークからのすべてのホストが含まれ、DNSサーバのプライマリゾーンにはドメイン内のすべてのホストに関する最新のレコードが格納されます。
        </para>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term>セカンダリゾーンのDNSサーバ</term>
       <listitem>
        <para>
         セカンダリゾーンはプライマリゾーンのコピーです。セカンダリゾーンのDNSサーバは、ゾーン転送操作によりプライマリサーバからゾーンデータを取得します。セカンダリゾーンのDNSサーバは、有効なゾーンデータがある(期限切れでない)場合、ゾーンに適切に応答します。セカンダリサーバがゾーンデータの新規コピーを取得できない場合、ゾーンへの応答を停止します。
        </para>
       </listitem>
      </varlistentry>
     </variablelist>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>フォワーダ</term>
    <listitem>
     <para>
      フォワーダは、DNSサーバがクエリに回答できない場合に、そのクエリの転送先になるDNSサーバです。1つの環境設定内で複数の設定ソースを有効にするには、<literal>netconfig</literal>を使用します(<command>man 8 netconfig</command>も参照)。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>レコード</term>
    <listitem>
     <para>
      レコードは、名前とIPアドレスに関する情報です。サポートされているレコードおよびその構文は、BINDのドキュメントで説明されています。以下は、特別なレコードの一部です。
     </para>
     <variablelist>
      <varlistentry>
       <term>NSレコード</term>
       <listitem>
        <para>
         NSレコードは、指定のドメインゾーンの担当\&apos;83\&apos;7dシンをネームサーバに指定します。
        </para>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term>MXレコード</term>
       <listitem>
        <para>
         MX(メール交換)レコードは、インターネット上でメールを転送する際に通知する\&apos;83\&apos;7dシンを説明します。
        </para>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term>SOAレコード</term>
       <listitem>
        <para>
         SOA (Start of Authority)レコードは、ゾーンファイル内で最初のレコードです。SOAレコードは、DNSを使用して複数のコンピュータ間でデータを同期化する際に使用されます。
        </para>
       </listitem>
      </varlistentry>
     </variablelist>
    </listitem>
   </varlistentry>
  </variablelist>
 </sect1>

 <sect1 xml:id="sec-dns-install">
  <title>インストール</title>

  <para>
   DNSサーバをインストールするには、YaSTを起動してから、<menuchoice><guimenu>ソフトウェア</guimenu> <guimenu>ソフトウェア管理</guimenu></menuchoice>の順に選択します。<menuchoice><guimenu>表示</guimenu> <guimenu>パターン</guimenu></menuchoice>の順に選択して、<guimenu>DHCPおよびDNSサーバ</guimenu>を選択します。依存関係のあるパッケージのインストールを確認して、インストールプロセスを完了します。
  </para>
  <para>
   または、コマンドラインで次のコマンドを使用します。
  </para>
  <screen><prompt>&gt; </prompt><command>sudo</command> zypper in -t pattern dhcp_dns_server</screen>
 </sect1>

 <sect1 xml:id="sec-dns-yast">
  <title>YaSTでの設定</title>

  <para>
   YaST DNSモジュールを使用して、ローカルネットワーク用にDNSサーバを設定します。このモジュールを初めて起動すると、サーバ管理に関して2、3の決定を行うように要求されます。この初期セットアップを完了すると、基本的なサーバ設定が生成されます。エキスパートモードを使用すると、より詳細な設定タスク(ACLのセットアップ、ロギング、TSIGキーなどのオプション)を処理できます。
  </para>

  <sect2 xml:id="sec-dns-yast-wizard">
   <title>ウィザードによる設定</title>


   <para>
    ウィザードは3つのステップ(ダイアログ)で構成されています。各ダイアログの適切な箇所でエキスパート環境設定モードに入ることができます。
   </para>
   <procedure>
    <step>
     <para>



      モジュールを初めて起動すると、<xref linkend="fig-yast2-dnsinst-forwarders"/>のような<guimenu>フォワーダの設定</guimenu>ダイアログが表示されます。<guimenu>ローカルDNS解決ポリシー</guimenu>を使用して、次のオプションを設定できます。
     </para>
     <itemizedlist mark="bullet" spacing="normal">
      <listitem>
       <para>
        <guimenu>フォワーダのマージは無効です</guimenu>

       </para>
      </listitem>
      <listitem>
       <para>
        <guimenu>自動マージ</guimenu>

       </para>
      </listitem>
      <listitem>


       <para>
        <guimenu>フォワーダのマージは有効です</guimenu>

       </para>
      </listitem>
      <listitem>
       <para>

        <guimenu>カスタム設定</guimenu>—<guimenu>カスタム設定</guimenu>をオンにした場合は、<guimenu>カスタムポリシー</guimenu>を指定できます。デフォルトでは(<guimenu>自動マージ</guimenu>が選択されている場合)、<guimenu>カスタムポリシー</guimenu>は［<literal>auto (自動)</literal>］に設定されますが、ここで、インタフェース名を設定したり、2つの特殊なポリシー名<literal>STATIC</literal>および<literal>STATIC_FALLBACK</literal>の一方を選択したりできます。
       </para>
      </listitem>
     </itemizedlist>

     <para>
      <guimenu>ローカルDNS解決フォワーダ</guimenu>で、使用するサービスとして、<guimenu>システムネームサーバを使用しています</guimenu>、<guimenu>このネームサーバ(バインド)</guimenu>、または<guimenu>ローカルdnsmasqサーバ</guimenu>のいずれかを指定します。
     </para>
     <para>
      これらのすべての設定の詳細については、<command>man 8 netconfig</command>を参照してください。
     </para>
     <figure xml:id="fig-yast2-dnsinst-forwarders">
      <title>DNSサーバのインストール: フォワーダの設定</title>
      <mediaobject>
       <imageobject role="fo">
        <imagedata width="75%" fileref="yast2_dns_wiz_forw.png"/>
       </imageobject>
       <imageobject role="html">
        <imagedata width="75%" fileref="yast2_dns_wiz_forw.png"/>
       </imageobject>
      </mediaobject>
     </figure>
     <para>
      フォワーダは、ご使用のDNSサーバが回答できないクエリの送信先とするDNSサーバです。フォワーダのIPアドレスを入力して、<guimenu>追加</guimenu>をクリックします。
     </para>
    </step>
    <step>
     <para>
      <guimenu>DNSゾーン</guimenu>ダイアログは、複数の部分で構成されており、<xref linkend="sec-dns-zonefile"/>で説明するゾーンファイルの管理に関する項目を設定します。新しいゾーンの場合は、<guimenu>名前</guimenu>にゾーン名を入力します。逆引きゾーンを追加する場合は、<literal>.in-addr.arpa</literal>で終わる名前を入力しなければなりません。最後に、<guimenu>タイプ</guimenu>(プライマリ、セカンダリ、または転送)を選択します。<xref linkend="fig-yast2-dnsinst-zones"/>を参照してください。既存のゾーンのその他の項目を設定するには、<guimenu>Edit</guimenu>をクリックします。ゾーンを削除するには、<guimenu>Delete</guimenu>をクリックします。
     </para>
     <figure xml:id="fig-yast2-dnsinst-zones">
      <title>DNSサーバのインストール: DNSゾーン</title>
      <mediaobject>
       <imageobject role="fo">
        <imagedata width="72%" fileref="yast2_dns_wiz_zone.png"/>
       </imageobject>
       <imageobject role="html">
        <imagedata width="75%" fileref="yast2_dns_wiz_zone.png"/>
       </imageobject>
      </mediaobject>
     </figure>
    </step>
    <step>
     <para>
      最後のダイアログでは、<guimenu>ファイアウォールで開いているポート</guimenu>をクリックして、ファイアウォールのDNSポートを開くことができます。次に、ブート時にDNSサーバ を起動するかどうか(<guimenu>オン</guimenu>か、<guimenu>オフ</guimenu>か)を決定します。LDAPサポートを有効にすることもできます。<xref linkend="fig-yast2-dnsinst-finish"/>を参照してください。
     </para>
     <figure xml:id="fig-yast2-dnsinst-finish">
      <title>DNSサーバのインストール: 完了ウィザード</title>
      <mediaobject>
       <imageobject role="fo">
        <imagedata width="72%" fileref="yast2_dns_wiz_finish.png"/>
       </imageobject>
       <imageobject role="html">
        <imagedata width="75%" fileref="yast2_dns_wiz_finish.png"/>
       </imageobject>
      </mediaobject>
     </figure>
    </step>
   </procedure>
  </sect2>

  <sect2 xml:id="sec-dns-yast-expert">
   <title>エキスパート設定</title>
   <para>
    YaSTのモジュールを起動するとウィンドウが開き、複数の設定オプションが表示されます。設定を完了すると、基本的な機能が組み込まれたDNSサーバ設定が作成されます。
   </para>
   <sect3 xml:id="sec-dns-yast-expert-startup">
    <title>起動</title>
    <para>
     <guimenu>起動</guimenu>では、DNSサーバをシステムのブート中に起動するか、それとも手動で起動するか指定します。DNSサーバをすぐに起動するには、<guimenu>今すぐDNSサーバを起動する</guimenu>を選択します。DNSサーバを停止するには、<guimenu>今すぐDNSサーバを停止する</guimenu>を選択します。現在の設定を保存するには、<guimenu>設定を保存して、今すぐDNSサーバをリロードする</guimenu>を選択します。ファイアウォールのDNSポートを開くには<guimenu>ファイアウォール内でポートを開く</guimenu>を、ファイアウォールの設定を変更するには<guimenu>Firewall Details</guimenu>をクリックします。
    </para>
    <para>
     <guimenu>LDAPサポートを有効にする</guimenu>を選択すると、ゾーンファイルがLDAPデータベースによって管理されるようになります。ゾーンデータを変更してそれがLDAPデータベースに書き込まれると、設定を再ロードするように要求されます。DNSサーバを再起動すると、変更が反映されます。
    </para>
   </sect3>
   <sect3 xml:id="sec-dns-yast-expert-forwarders">
    <title>フォワーダ</title>
    <para>
     ローカルDNSサーバは、要求に応答できない場合、要求を<guimenu>フォワーダ</guimenu>に転送しようとします(そのように設定されている場合)。このフォワーダは、手動で、<guimenu>Forwarder List</guimenu>に追加できます。フォワーダが、ダイアルアップ接続でのように静的でない場合は、<guimenu>netconfig</guimenu>が設定を処理します。netconfigの詳細については、<command>man 8 netconfig</command>を参照してください。
    </para>
   </sect3>
   <sect3 xml:id="sec-dns-yast-expert-basics">
    <title>基本的なオプション</title>
    <para>
     このセクションでは、基本的なサーバオプションを設定します。<guimenu>オプション</guimenu>メニューから目的の項目を選択して、対応するテキストボックスに値を指定します。新しいエントリを追加するには、<guimenu>追加</guimenu>を選択してください。
    </para>

   </sect3>
   <sect3 xml:id="sec-dns-yast-expert-logging">
    <title>ログ記録</title>
    <para>
     DNSサーバがログに記録する内容とログの方法を設定するには、<guimenu>ログ記録</guimenu>を選択します。<guimenu>Log Type</guimenu>に、DNSサーバがログデータを書き込む場所を指定します。システム全体のログを使用する場合は<guimenu>システムログ</guimenu>を、別のファイルを指定する場合は<guimenu>ファイル</guimenu>を選択します。別のファイルを指定する場合は、ログファイルの名前、最大サイズ(メガバイト(MB))、および保管するバージョンの数も指定します。
    </para>
    <para>
     <guimenu>追加ログ</guimenu>には、さらに詳細なオプションが用意されています。<guimenu>すべてのDNSクエリをログに記録</guimenu>を有効にすると、<emphasis>すべての</emphasis>クエリがログに記録されるため、ログファイルが非常に大きくなる可能性があります。ですから、このオプションを有効にするのはデバッグ時だけにすることをお勧めします。DHCPサーバとDNSサーバ間でのゾーン更新時のデータトラフィックをログに記録するには、<guimenu>ゾーン更新をログに記録</guimenu>を有効にします。プライマリからセカンダリサーバへのゾーン転送時のデータトラフィックをログに記録するには、<guimenu>ゾーン転送をログに記録</guimenu>を有効にします。<xref linkend="fig-yast2-dns-logging"/>を参照してください。
    </para>
    <figure xml:id="fig-yast2-dns-logging">
     <title>DNSサーバ: ログの記録</title>
     <mediaobject>
      <imageobject role="fo">
       <imagedata width="75%" fileref="yast2_dns_def_logging.png"/>
      </imageobject>
      <imageobject role="html">
       <imagedata width="75%" fileref="yast2_dns_def_logging.png"/>
      </imageobject>
     </mediaobject>
    </figure>
   </sect3>
   <sect3 xml:id="sec-dns-yast-expert-acls">
    <title>ACL</title>
    <para>
     このダイアログでは、アクセス制限を強制するACL(アクセス制御リスト)を定義します。<guimenu>名前</guimenu>に個別名を入力したら、次の形式で、<guimenu>値</guimenu>にIPアドレス(ネットマスクは省略可)を指定します。
    </para>
<screen>{ 192.168.1/24; }</screen>
    <para>
     設定ファイルの\&apos;8d\&apos;5c文に従って、アドレスの末尾にはセミコロンを付け、中カッコで囲む必要があります。
    </para>

   </sect3>
   <sect3 xml:id="sec-dns-yast-expert-tsig">
    <title>TSIGキー</title>
    <para>
     TSIG (トランザクションシグネチャー)の主な目的は、DHCPおよびDNSサーバ間で安全な通信を行うことです。<xref linkend="sec-dns-tsig"/>を参照してください。
    </para>
    <para>
     TSIGキーを生成するには、<guimenu>キーID</guimenu>フィールドに個別名を入力し、キーを格納するファイルを<guimenu>ファイル名</guimenu>フィールドに入力します。<guimenu>生成</guimenu>をクリックすると、選択内容が確定されます。
    </para>
    <para>
     作成済みのキーを使用するには、<guimenu>キーID</guimenu>フィールドを空白のままにして、<guimenu>ファイル名</guimenu>で、そのキーが保存されているファイルを選択します。その後、<guimenu>追加</guimenu>をクリックすると、入力内容が確定されます。
    </para>

   </sect3>
   <sect3 xml:id="sec-dns-yast-expert-add-secondary">
    <title>DNSゾーン(セカンダリゾーンの追加)</title>
    <para>
     セカンダリゾーンを追加するには、<guimenu>DNSゾーン</guimenu>を選択し、ゾーンタイプに<guimenu>セカンダリ</guimenu>を選択し、新規ゾーンの名前を書き込み、<guimenu>追加</guimenu>をクリックします。
    </para>
    <para>
     <guimenu>プライマリDNSサーバのIP</guimenu>の下の<guimenu>ゾーンエディタ</guimenu>サブダイアログで、セカンダリサーバがデータをプルするプライマリサーバを指定します。サーバへのアクセスを制限するために、リストから定義済みのACLを1つ選択します。

    </para>

   </sect3>
   <sect3 xml:id="sec-dns-yast-expert-add-primary">
    <title>DNSゾーン(プライマリリゾーンの追加)</title>
    <para>
     プライマリゾーンを追加するには、<guimenu>DNSゾーン</guimenu>を選択し、ゾーンタイプに<guimenu>プライマリ</guimenu>を選択し、新規ゾーンの名前を書き込み、<guimenu>追加</guimenu>をクリックします。プライマリゾーンの追加時には、逆引きゾーンも必要です。たとえば、ゾーン<systemitem>example.com</systemitem>(サブネット<literal>192.168.1.0/24</literal>内のホストをポイントするゾーン)を追加する際には、カバーされるIPアドレス範囲の逆引きゾーンも追加する必要があります。定義上、このゾーンの名前は、<literal>1.168.192.in-addr.arpa</literal>となります。
    </para>
   </sect3>
   <sect3 xml:id="sec-dns-yast-expert-edit-primary">
    <title>DNSゾーン(プライマリリゾーンの編集)</title>
    <para>
     プライマリゾーンを編集するには、<guimenu>DNSゾーン</guimenu>を選択し、テーブルからプライマリゾーンを選択し、<guimenu>編集</guimenu>をクリックします。このダイアログには、<guimenu>基本</guimenu>(最初に表示される)、<guimenu>NSレコード</guimenu>、<guimenu>MXレコード</guimenu>、<guimenu>SOA</guimenu>、および<guimenu>レコード</guimenu>のページがあります。
    </para>
    <para os="sles;osuse">
     <xref linkend="fig-yast2-dns-ddns"/>に示す基本ダイアログを使用すると、ダイナミックDNSの設定と、クライアントおよびセカンダリネームサーバへのゾーン転送に関するアクセスオプションを定義できます。ゾーンの動的更新を許可するには、<guimenu>動的アップデートの許可</guimenu>および対応するTSIGキーを選択します。このキーは、更新アクションの開始前に定義しておく必要があります。ゾーン転送を有効にするには、対応するACLを選択します。ACLは事前に定義しておく必要があります。
    </para>
    <para>
     <guimenu>基本</guimenu>ダイアログで、ゾーン転送を有効にするかどうか選択します。リストされたACLを使用して、ゾーンをダウンロードできるユーザを定義します。
    </para>
    <figure xml:id="fig-yast2-dns-ddns" os="sles;osuse">
     <title>DNSサーバ: ゾーンエディタ(基本)</title>
     <mediaobject>
      <imageobject role="fo">
       <imagedata width="65%" fileref="yast2_dns_def_ddns.png"/>
      </imageobject>
      <imageobject role="html">
       <imagedata width="65%" fileref="yast2_dns_def_ddns.png"/>
      </imageobject>
     </mediaobject>
    </figure>
    <variablelist>
     <varlistentry>
      <term>ゾーンエディタ(NSレコード)</term>
      <listitem>
       <para>
        <guimenu>レコード</guimenu>ダイアログでは、指定したゾーンの代替ネームサーバを定義できます。リストに自分が使用しているネームサーバが含まれていることを確認してください。レコードを追加するには、<guimenu>追加するネームサーバ</guimenu>にレコード名を入力し、<guimenu>追加</guimenu>をクリックして確定します。<xref linkend="fig-yast2-dns-nsrec"/>を参照してください。
       </para>
       <figure xml:id="fig-yast2-dns-nsrec">
        <title>DNSサーバ: ゾーンエディタ(NSレコード)</title>
        <mediaobject>
         <imageobject role="fo">
          <imagedata width="65%" fileref="yast2_dns_def_nsrec.png"/>
         </imageobject>
         <imageobject role="html">
          <imagedata width="65%" fileref="yast2_dns_def_nsrec.png"/>
         </imageobject>
        </mediaobject>
       </figure>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>ゾーンエディタ(MXレコード)</term>
      <listitem>
       <para>
        現行ゾーンのメールサーバを既存のリストに追加するには、対応するアドレスと優先順位の値を入力します。その後、<guimenu>追加</guimenu>を選択して確定します。<xref linkend="fig-yast2-dns-mxrec"/>を参照してください。
       </para>
       <figure xml:id="fig-yast2-dns-mxrec">
        <title>DNSサーバ: ゾーンエディタ(MXレコード)</title>
        <mediaobject>
         <imageobject role="fo">
          <imagedata width="72%" fileref="yast2_dns_def_mxrec.png"/>
         </imageobject>
         <imageobject role="html">
          <imagedata width="75%" fileref="yast2_dns_def_mxrec.png"/>
         </imageobject>
        </mediaobject>
       </figure>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>ゾーンエディタ(SOA)</term>
      <listitem>
       <para>
        このページでは、SOA (start of authority)レコードを作成できます。個々のオプションについては、<xref linkend="ex-welt-zone"/>を参照してください。<phrase os="sles;osuse">LDAPを介して管理される動的ゾーンの場合、SOAレコードの変更がサポートされないので注意してください。</phrase>
       </para>
       <figure xml:id="fig-yast2-dns-soa">
        <title>DNSサーバ: ゾーンエディタ(SOA)</title>
        <mediaobject>
         <imageobject role="fo">
          <imagedata width="75%" fileref="yast2_dns_def_soa.png"/>
         </imageobject>
         <imageobject role="html">
          <imagedata width="75%" fileref="yast2_dns_def_soa.png"/>
         </imageobject>
        </mediaobject>
       </figure>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>ゾーンエディタ(レコード)</term>
      <listitem>
       <para>
        このダイアログでは、名前解決を管理します。<guimenu>レコードキー</guimenu>では、ホスト名を入力してレコードタイプを選択します。<guimenu>A</guimenu>タイプは、メインエントリを表します。この値はIPアドレス(IPv4)でなければなりません。IPv6アドレスの場合は、<guimenu>AAAA</guimenu>を使用します。<guimenu>CNAME</guimenu>はエイリアスです。<guimenu>NS</guimenu>および<guimenu>MX</guimenu>の各タイプを指定すると、<guimenu>NSレコード</guimenu>および<guimenu>MXレコード</guimenu>の各タブで提供される情報に基づいて、詳細レコードまたは部分レコードが展開されます。この3つのタイプのは、既存の<literal>A</literal>レコードに解決されます。<guimenu>PTR</guimenu>は逆引きゾーン用レコードです。これは、次の例のように、<literal>A</literal>レコードとは反対です。
       </para>
<screen>hostname.example.com. IN A 192.168.0.1
1.0.168.192.in-addr.arpa IN PTR hostname.example.com.</screen>
      </listitem>
     </varlistentry>
    </variablelist>
    <sect4 xml:id="sec-dns-yast-expert-edit-primary-rev">
     <title>逆引きゾーンの追加</title>
     <para>
      逆引きゾーンを追加するには、以下の手順を実行します。
     </para>
     <procedure>
      <step>
       <para>
        <menuchoice><guimenu>YaST</guimenu><guimenu>DNSサーバ</guimenu><guimenu>DNSゾーン</guimenu></menuchoice>を開始します。
       </para>
      </step>
      <step>
       <para>
        プライマリ転送ゾーンを追加していない場合は、追加して、<guimenu>編集</guimenu>します。
       </para>
      </step>
      <step>
       <para>
        <guimenu>レコード</guimenu>タブで、対応する<guimenu>レコードキー)</guimenu>と<guimenu>値</guimenu>を入力し、<guimenu>追加</guimenu>でレコードを追加してから、<guimenu>OK</guimenu>で確認します。YaSTからネームサーバで存在しないレコードがある旨通知された場合、<guimenu>NS Records(NSレコード)</guimenu>タブで追加します。
       </para>
       <figure>
        <title>プライマリゾーンのレコードを追加</title>
        <mediaobject>
         <imageobject role="fo">
          <imagedata fileref="yast2_dns_revzone1.png" width="70%"/>
         </imageobject>
         <imageobject role="html">
          <imagedata fileref="yast2_dns_revzone1.png" width="70%"/>
         </imageobject>
        </mediaobject>
       </figure>
      </step>
      <step>
       <para>
        <guimenu>DNSゾーン</guimenu>ウィンドウに戻り、逆引きプライマリゾーンを追加します。
       </para>
       <figure>
        <title>逆引きゾーンの追加</title>
        <mediaobject>
         <imageobject role="fo">
          <imagedata fileref="yast2_dns_revzone2.png" width="70%"/>
         </imageobject>
         <imageobject role="html">
          <imagedata fileref="yast2_dns_revzone2.png" width="70%"/>
         </imageobject>
        </mediaobject>
       </figure>
      </step>
      <step>
       <para>
        逆引きゾーンを<guimenu>編集</guimenu>すると、<guimenu>レコード</guimenu>タブに、<guimenu>PTR: Reverse translation（PTR逆変換)</guimenu>レコードタイプが表示されます。対応する<guimenu>レコードキー</guimenu>と<guimenu>値</guimenu>を追加してから、<guimenu>追加</guimenu>でレコードを追加し、<guimenu>OK</guimenu>で確認します。
       </para>
       <figure>
        <title>逆引きレコードの追加</title>
        <mediaobject>
         <imageobject role="fo">
          <imagedata fileref="yast2_dns_revzone3.png" width="70%"/>
         </imageobject>
         <imageobject role="html">
          <imagedata fileref="yast2_dns_revzone3.png" width="70%"/>
         </imageobject>
        </mediaobject>
       </figure>
       <para>
        必要に応じて、ネームサーバレコードを追加します。
       </para>
      </step>
     </procedure>
     <tip>
      <title>逆引きゾーンの編集</title>
      <para>
       正引きゾーンの追加後、メインメニューに戻って、編集用の逆引きゾーンを選択します。次に、タブ<guimenu>基本</guimenu>で、チェックボックス<guimenu>Automatically Generate Records From</guimenu>にチェック印を入れ、正引きゾーンを選択します。これにより、正引きゾーンでのすべての変更が、逆引きゾーンで自動的に更新されます。
      </para>
     </tip>
    </sect4>
   </sect3>
  </sect2>
 </sect1>
 <sect1 xml:id="sec-dns-bind">
  <title>BINDネームサーバの起動</title>

  <para>
   <phrase role="productname"><phrase os="sles">SUSE® Linux Enterprise Server</phrase></phrase>システムでは、ネームサーバBIND (<emphasis>Berkeley Internet Name Domain</emphasis>)は、事前設定されて提供されるので、インストールが正常に完了すればただちに起動できます。通常、すでにインターネットに接続し、<filename>/var/run/netconfig/resolv.conf</filename>の<systemitem class="domainname">localhost</systemitem>にネームサーバアドレス<systemitem class="ipaddress">127.0.0.1</systemitem>が入力されている場合、プロバイダのDNSを知らなくても、既に機能する名前解決メカニズムが存在します。この場合、BINDは、ルートネームサーバを介して名前の解決を行うため、処理が非常に遅くなります。通常、効率的で安全な名前解決を実現するには、<systemitem>forwarders</systemitem>の下の設定ファイル<filename>/etc/named.conf</filename>にプロバイダのDNSとそのIPアドレスを入力する必要があります。いままでこれが機能している場合、ネームサーバは、純粋な<emphasis>キャッシュ専用</emphasis>ネームサーバとして動作しています。ネームサーバは、そのゾーンを設定してはじめて、正しいDNSにすることができます。簡単な例については、<filename>/usr/share/doc/packages/bind/config</filename>のドキュメントを参照してください。
  </para>

  <tip>
   <title>ネームサーバ情報の自動適合</title>
   <para>
    インターネット接続やネットワーク接続のタイプによっては、ネームサーバ情報を自動的に現在の状態に適合させることができます。これを行うには、<filename>/etc/sysconfig/network/config</filename>ファイル内の<systemitem>NETCONFIG_DNS_POLICY</systemitem>変数を <literal>auto</literal>に設定します。
   </para>
  </tip>

  <para>
   ただし、公式のドメインは、その1つが責任のある機関によって割り当てられるまで、セットアップしないでください。独自のドメインを持っていて、プロバイダがそれを管理している場合でも、BINDはそのドメインに対する要求を転送しないので、そのドメインを使用しないほうが賢明です。たとえば、プロバイダのWebサーバは、このドメインからはアクセスできません。
  </para>

  <para>
   ネームサーバを起動するには、<command>systemctl start name</command>ユーザとして、<systemitem class="username">root</systemitem>dコマンドを入力します。<command>systemctl status named</command>を使用して、ネームサーバ(呼びだされたネームサーバプロセス)が正常に起動したかどうかを確認します。サーバが正常に起動したらすぐに、<command>host</command>または<command>dig</command>プログラムを用いてローカルシステム上でネームサーバをテストしてください。デフォルトサーバ<systemitem class="domainname">localhost</systemitem>とそのアドレス<systemitem class="ipaddress">127.0.0.1</systemitem>が返されるはずです。これが返されない場合は、<filename>/var/run/netconfig/resolv.conf</filename>に含まれているネームサーバエントリが誤っているか、同ファイルが存在しないかのいずれかです。最初のテストとして、「<command>host</command><option>127.0.0.1</option>」を入力します。これは常に機能するはずです。エラーメッセージが表示された場合は、<command>systemctl status named</command>コマンドを使用して、サーバが実際に起動されていることを確認します。ネームサーバが起動しないか、予期しない動作をする場合は、<command>journalctl -e</command>の出力を確認します。
  </para>



  <para>
   プロバイダのネームサーバ(またはすでにネットワーク上で動作しているネームサーバ)をフォワーダとして使用する場合は、<systemitem>forwarders</systemitem>の下の<systemitem>options</systemitem>セクションに、対応するIPアドレスまたはアドレスを入力します。<xref linkend="ex-forward"/>に含まれているアドレスは、単なる例です。各自サイトの設定に合わせて変更してください。
  </para>

  <example xml:id="ex-forward">
   <title>named.confファイルの転送オプション</title>


<screen>options {
        directory "/var/lib/named";
        forwarders { 10.11.12.13; 10.11.12.14; };
        listen-on { 127.0.0.1; 192.168.1.116; };
        allow-query { 127/8; 192.168/16 };
        notify no;
};</screen>
  </example>

  <para>
   <systemitem>options</systemitem>エントリの後には、ゾーン用のエントリ、<systemitem class="domainname">localhost</systemitem>と<systemitem>0.0.127.in-addr.arpa</systemitem>が続きます。<quote>&#x002E;</quote>の下の<literal>type hint</literal>エントリは常に存在する必要があります。対応するファイルは、変更する必要がなく、そのままで機能します。また、各エントリの末尾が<quote>;</quote>で閉じられ、中カッコが適切な位置にあることを確認してください。環境設定ファイル<filename>/etc/named.conf</filename>またはゾーンファイルを変更したら、<command>systemctl reload named</command>を使用して、BINDにそれらを再ロードさせます。または、<command>systemctl restart named</command>を使用してネームサーバを停止してから再起動しても同じ結果が得られます。サーバは<command>systemctl stop named</command>を入力していつでも停止することができます。
  </para>
 </sect1>
 <sect1 xml:id="sec-dns-named">
  <title>/etc/named.conf環境設定ファイル</title>

  <para>
   BINDネームサーバ自体のすべての設定は、<filename>/etc/named.conf</filename>ファイルに格納されます。ただし、処理するドメインのゾーンデータ(ホスト名、IPアドレスなどで構成されている)は、<filename>/var/lib/named</filename>ディレクトリ内の個別のファイルに格納されます。この詳細については、後述します。
  </para>

  <para>
   <filename>/etc/named.conf</filename>ファイルは、大きく2つのエリアに分けられます。1つは一般的な設定用の<systemitem>options</systemitem>セクション、もう1つは個々のドメインの<systemitem>zone</systemitem>エントリで構成されるセクションです。<systemitem>logging</systemitem>セクションと<systemitem>acl</systemitem> (アクセス制御リスト)エントリは省略可能です。コメント行は、行頭に<literal>#</literal>記号または<literal>//</literal>を指定します。最も基本的な<filename>/etc/named.conf</filename>ファイルの例を、<xref linkend="ex-named-mini"/>に示します。
  </para>

  <example xml:id="ex-named-mini">
   <title>基本的な/etc/named.confファイル</title>
<screen>options {
        directory "/var/lib/named";
        forwarders { 10.0.0.1; };
        notify no;
};

zone "localhost" in {
       type master;
       file "localhost.zone";
};

zone "0.0.127.in-addr.arpa" in {
        type master;
        file "127.0.0.zone";
};

zone "." in {
        type hint;
        file "root.hint";
};</screen>
  </example>

  <sect2 xml:id="sec-dns-named-options">
   <title>重要な設定オプション</title>
   <variablelist>
    <varlistentry>
     <term>directory &quot;<replaceable>FILENAME</replaceable>&quot;;</term>
     <listitem>
      <para>
       BINDが検索する、ゾーンファイルが格納されているディレクトリを指定します。通常は<filename>/var/lib/named</filename>です。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>forwarders { <replaceable>IP-ADDRESS</replaceable>; };</term>
     <listitem>
      <para>
       DNS要求が直接解決できない場合、それらが転送されるネームサーバ(ほとんどの場合、プロバイダのネームサーバ)を指定します。<replaceable>IP-ADDRESS</replaceable>には、IPアドレスを<literal>192.168.1.116</literal>のように指定します。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>forward first;</term>
     <listitem>
      <para>
       ルートネームサーバでDNS要求の解決を試みる前に、それらを転送するようにします。<systemitem>forward
       first</systemitem>の代わりに<systemitem>forward only</systemitem>を指定すると、すべての要求が転送されたままになり、ルートネームサーバには送り返されません。このオプションは、ファイアウォール構成で使用します。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>listen-on port 53 { 127.0.0.1; <replaceable>IP-ADDRESS</replaceable>; };</term>
     <listitem>
      <para>
       クライアントクエリを受け入れるネットワークインタフェースとポートをBINDに指示します。<literal>53</literal>はデフォルトポートであるため、<literal>port 53</literal>を明示的に指定する必要はありません。ローカルホストからの要求を許可するには、<literal>127.0.0.1</literal>と記述します。このエントリ全体を省略した場合は、すべてのインタフェースがデフォルトで使用されます。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>listen-on-v6 port 53 {any; };</term>
     <listitem>
      <para>
       BINDがIPv6クライアント要求をリッスンするポートを指定します。<literal>any</literal>以外で指定できるのは<literal>none</literal>だけです。IPv6に関して、サーバはワイルドカードアドレスのみ受け付けます。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>query-source address * port 53;</term>
     <listitem>
      <para>
       ファイアウォールが発信DNS要求をブロックする場合、このエントリが必要です。BINDに対し、外部への要求をポート53から発信し、1024を超える上位ポートからは発信しないように指示します。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>query-source address * port 53;</term>
     <listitem>
      <para>
       BINDがIPv6のクエリに使用するポートを指定します。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>allow-query { 127.0.0.1; <replaceable>NET</replaceable>; };</term>
     <listitem>
      <para>
       クライアントがDNS要求を発信できるネットワークを定義します。<replaceable>NET</replaceable>には、アドレス情報を<literal>192.168.2.0/24</literal>のように指定します。末尾の<systemitem>/24</systemitem>は、ネットマスクの短縮表記で、この場合<systemitem class="netmask">255.255.255.0</systemitem>を表します。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>allow-transfer ! *;;</term>
     <listitem>
      <para>
       ゾーン転送を要求できるホストを制御します。この例では、<systemitem>! *</systemitem>が使用されているので、ゾーン転送要求は完全に拒否されます。このエントリがなければ、ゾーン転送をどこからでも制約なしに要求できます。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>statistics-interval 0;</term>
     <listitem>
      <para>
       このエントリがなければ、BINDは1時間ごとに数行の統計情報を生成してシステムのジャーナルに保存します。0を指定すると、統計情報をまったく生成しないか、時間間隔を分単位で指定します。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>cleaning-interval 720;</term>
     <listitem>
      <para>
       このオプションは、BINDがキャッシュをクリアする時間間隔を定義します。キャッシュがクリアされるたびに、システムのジャーナルにエントリが追加されます。時間の指定は分単位です。デフォルトは60分です。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>statistics-interval 0;</term>
     <listitem>
      <para>
       BINDは定期的にインタフェースを検索して、新しいインタフェースや存在しなくなったインタフェースがないか確認します。この値を<systemitem>0</systemitem>に設定すると、この検索が行われなくなり、BINDは起動時に検出されたインタフェースのみをリッスンします。0以外の値を指定する場合は分単位で指定します。デフォルトは60分です。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>notify no;</term>
     <listitem>
      <para>
       <option>no</option>に設定すると、ゾーンデータを変更したとき、またはネームサーバが再起動されたときに、他のネームサーバに通知されなくなります。
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
   <para>
    すべての利用可能なオプションのリストについては、マニュアルページ<command>man 5 named.conf</command>を参照してください。
   </para>
  </sect2>

  <sect2 xml:id="sec-dns-named-log">
   <title>ログ記録</title>
   <para>
    BINDでは、何を、どのように、どこにログ出力するかを詳細に設定できます。通常、デフォルト設定で十分です。<xref linkend="ex-no-log"/>は、そのようなエントリの最も単純な形式を示し、ロギングを完全に抑制します。
   </para>
   <example xml:id="ex-no-log">
    <title>ログを無効にするエントリ</title>
<screen>logging {
        category default { null; };
};</screen>
   </example>
  </sect2>

  <sect2 xml:id="sec-dns-named-zones">
   <title>ゾーンエントリ</title>
   <example xml:id="ex-meine-domain">
    <title>example.comのゾーンエントリ</title>
<screen>zone "example.com" in {
      type master;
      file "example.com.zone";
      notify no;
};</screen>
   </example>
   <para>
    <systemitem>zone</systemitem>の後、管理対象のドメイン名(<systemitem class="domainname">example.com</systemitem>)を指定し、その後に<systemitem>in</systemitem>と関連のオプションを中カッコで囲んで指定します(<xref linkend="ex-meine-domain"/>参照)。「セカンダリゾーン<emphasis></emphasis>」を定義するには、<systemitem>type</systemitem>を<literal>secondary</literal>に変更し、このゾーンを管理するネームサーバを<literal>primary</literal>として指定します。これが他のプライマリサーバのセカンダリサーバとなることもあります(<xref linkend="ex-andere-domain"/>を参照)。
   </para>
   <example xml:id="ex-andere-domain">
    <title>example.netのゾーンエントリ</title>
<screen>zone "example.net" in {
      type secondary;
      file "secondary/example.net.zone";
      
      masters { 10.0.0.1; }; 
};</screen>
   </example>
   <para>
    ゾーンオプション
   </para>
   <variablelist>
    <varlistentry>
     <term>type primary;</term>
     <listitem>
      <para>
       <literal>primary</literal>を指定して、BINDに対し、ゾーンがローカルネームサーバによって処理されるように指示します。これは、ゾーンファイルが正しい形式で作成されていることが前提となります。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>type secondary;</term>
     <listitem>
      <para>
       このゾーンは別のネームサーバから転送されたものです。必ず <systemitem>primary_servers</systemitem> とともに使用します。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>type hint;</term>
     <listitem>
      <para>
       ルートネームサーバの設定には、<literal>hint</literal>タイプのゾーン<literal>&#x002E;</literal>を使用します。このゾーン定義はそのまま使用できます。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><filename>example.com.zone</filename>ファイルまたは<quote>secondary/example.net.zone</quote>ファイル</term>
     <listitem>
      <para>
       このエントリは、ドメインのゾーンデータが格納されているファイルを指定します。セカンダリサーバの場合は、このデータを他のネームサーバから取得するので、このファイルは不要です。プライマリサーバとセカンダリサーバのファイルを区別するには、セカンダリファイルに<filename>secondary</filename>ディレクトリを使用します。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>primary_servers { <replaceable>SERVER_IP_ADDRESS</replaceable>; }</term>
     <listitem>
      <para>
       このエントリは、セカンダリゾーンにのみ必要です。ゾーンファイルの転送元となるネームサーバを指定します。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>allow-update {! *; };</term>
     <listitem>
      <para>
       このオプションは、外部の書き込みアクセスを制御し、クライアントにDNSエントリへの書き込み権を付与することができます。ただし、これは通常、セキュリティ上の理由で好ましくありません。このエントリがなければ、ゾーンの更新は拒否されます。先に示したエントリも同じです。<literal>! *</literal>はそのような活動を効果的に禁止するためです。
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
  </sect2>
 </sect1>
 <sect1 xml:id="sec-dns-zonefile">
  <title>ゾーンファイル</title>

  <para>
   ゾーンファイルは2種類必要です。一方はIPアドレスをホスト名に割り当て、もう一方は逆にIPアドレスのホスト名を提供します。
  </para>

  <tip>
   <title>ゾーンファイルでドット(ピリオド、フルストップ)を使用する</title>
   <para>
    <literal>&quot;&#x002E;&quot;</literal>は、ゾーンファイル内で重要な意味を持ちます。ホスト名の末尾にドット(<literal>&#x002E;</literal>)がない場合は、ゾーンが追加されます。完全なホスト名を完全なドメイン名とともに指定する場合は、末尾にドット(<literal>&#x002E;</literal>)を付けて、ドメインが追加されないようにします。&quot;.&quot;の欠落または誤った配置は、ネームサーバ設定エラーのの最も多い原因と考えられます。
   </para>
  </tip>



  <para>
   最初に、ドメイン<filename>example.com</filename>に責任を負うゾーンファイル<filename>example.com.zone</filename>について示します(<xref linkend="ex-welt-zone"/>を参照してください)。
  </para>

  <example xml:id="ex-welt-zone">
   <title>/var/lib/named/example.com.zoneファイル</title>
   <screen>$TTL 2D <co xml:id="welt-zone-ttl"/>
example.com. IN SOA      dns  root.example.com. ( <co xml:id="welt-zone-soa-start"/>
             2003072441  ; serial <co xml:id="welt-zone-serial-no"/>
             1D          ; refresh <co xml:id="welt-zone-refresh"/>
             2H          ; retry <co xml:id="welt-zone-retry"/>
             1W          ; expiry <co xml:id="welt-zone-expire"/>
             2D )        ; minimum <co xml:id="welt-zone-caching-time"/>

             IN NS       dns <co xml:id="welt-zone-inns"/>
             IN MX       10 mail dns <co xml:id="welt-zone-mx"/>
gate         IN A        192.168.5.1 <co xml:id="welt-zone-ips"/>
             IN A        10.0.0.1
dns          IN A        192.168.1.116
mail         IN A        192.168.3.108
jupiter      IN A        192.168.2.100
venus        IN A        192.168.2.101
saturn       IN A        192.168.2.102
mercury      IN A        192.168.2.103
ntp          IN CNAME    dns <co xml:id="welt-zone-ntp"/>
dns6         IN A6  0    2002:c0a8:174::</screen>

  </example>

  <calloutlist>
   <callout arearefs="welt-zone-ttl">
    <para>
      <systemitem>$TTL</systemitem>は、このファイルのすべてのエントリに適用されるデフォルトの寿命(time to live)です。この例では、エントリは2日間(<literal>2 D</literal>)有効です。
    </para>
   </callout>
   <callout arearefs="welt-zone-soa-start">
    <para>
     ここから、SOA (start of authority)制御レコードが始まります。
    </para>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <para>
       管理対象のドメイン名は、先頭の<literal>example.com</literal>です。この末尾には、<literal>&quot;&#x002E;&quot;</literal>(ピリオド)が付いています。ピリオドを付けないと、ゾーンが再度、末尾に追加されてしまいます。あるいはピリオドを<literal>@</literal>で置き換えることもできます。その場合は、ゾーンが<filename>/etc/named.conf</filename>の対応するエントリから抽出されます。
      </para>
     </listitem>
     <listitem>
      <para>
       <systemitem>IN SOA</systemitem>の後には、このゾーンのプライマリサーバであるネームサーバの名前を指定します。この名前は、末尾に<literal>&quot;&#x002E;&quot;</literal>が付いていないので、<literal>dns</literal>から<literal>dns.example.com</literal>に拡張されます。
      </para>
     </listitem>
     <listitem>
      <para>
       この後には、このネームサーバの責任者の電子メールアドレスが続きます。<literal>@</literal>記号はすでに特別な意味を持つので、ここでは代わりに<literal>&quot;&#x002E;&quot;</literal>を使用します。<systemitem>root@example.com</systemitem>の場合、エントリは<systemitem>root.example.com.</systemitem>.となります。ここでもゾーンが追加されないよう、<literal>&quot;&#x002E;&quot;</literal>を末尾につける必要があります。
      </para>
     </listitem>
     <listitem>
      <para>
       <literal>(</literal>は、<literal>)</literal>までの行をすべてSOAレコードに含める場合に使用します。
      </para>
     </listitem>
    </itemizedlist>
   </callout>
   <callout arearefs="welt-zone-serial-no">
    <para>
     <systemitem>serial number</systemitem>は、10桁の数字です。このファイルが変更されるたびに変更される必要があります。変更があった場合、セカンダリネームサーバ(セカンダリサーバ)に通知する必要があります。この場合、日付と実行数からなる10桁の数字は慣例的形式(YYYY = 年、MM = 月、DD = 日)のYYYYMMDDNNで記載されます。NNは指定された日に複数回アップデートする場合のシーケンス番号です。
    </para>
   </callout>
   <callout arearefs="welt-zone-refresh">
    <para>
     <systemitem>refresh rate</systemitem>は、セカンダリネームサーバがゾーン<systemitem>serial
     number</systemitem>を確認する時間間隔を指定します。この例では1日です。
    </para>
   </callout>
   <callout arearefs="welt-zone-retry">
    <para>
     <systemitem>retry rate</systemitem>は、エラーが生じた場合に、セカンダリネームサーバがプライマリサーバに再度通知を試みる時間間隔を指定します。この例では2時間です。
    </para>
   </callout>
   <callout arearefs="welt-zone-expire">
    <para>
     <systemitem>expiration time</systemitem>は、セカンダリネームサーバがプライマリサーバに再通知できなかった場合に、キャッシュしたデータを廃棄するまでの時間枠を指定します。ここでは、1週間です。
    </para>
   </callout>
   <callout arearefs="welt-zone-caching-time">
    <para>
     SOAレコードの最後のエントリは、<systemitem>negative
     caching TTL</systemitem>を指定します。これは、DNSクエリが解決できないという他のサーバからの結果をキャッシュしておく時間です。
    </para>
   </callout>
   <callout arearefs="welt-zone-inns">
    <para>
     <systemitem>IN NS</systemitem>では、このドメインを担当するネームサーバを指定します。末尾に<literal>&quot;.&quot;</literal>が付いていないので、<systemitem>dns</systemitem>は、<systemitem>dns.example.com</systemitem>に拡張されます。このように、プライマリネームサーバと各セカンダリネームサーバに1つずつ指定する行がいくつかあります。<filename>/etc/named.conf</filename>で<systemitem>notify</systemitem>を<option>no</option>に設定しない限り、ゾーンデータが変更されると、ここにリストされているすべてのネームサーバにそれが通知されます。
    </para>
   </callout>
   <callout arearefs="welt-zone-mx">
    <para>
     MXレコードは、ドメイン<systemitem class="domainname">example.com</systemitem>宛ての電子メールを受領、処理、および転送するメールサーバを指定します。この例では、ホスト<systemitem class="domainname">mail.example.com</systemitem>が指定されています。ホスト名の前の数字は、初期設定値です。複数のMXエントリがある場合は、最小の値を持つメールサーバが最初に取得されます。このサーバへのメール配信に失敗すると、次に低い値を持つエントリが使用されます。
    </para>
   </callout>
   <callout arearefs="welt-zone-ips">
    <para>
     この行と次の行は、ホスト名に1つ以上のIPアドレスが割り当てられている実際のアドレスレコードです。ここでは、名前が<literal>&quot;&#x002E;&quot;</literal>なしで一覧にされています。これは、これらの名前にはドメインが含まれていないためです。したがって、これらの名前にはすべて、<systemitem class="domainname">example.com</systemitem>が追加されます。ホスト<systemitem>gate</systemitem>には、ネットワークカードが2枚搭載されているので、2つのIPアドレスが割り当てられます。ホストアドレスが従来型のアドレス(IPv4)の場合、レコードに<literal>A</literal>が付きます。アドレスがIPv6アドレスの場合、エントリに<literal>AAAA </literal>が付きます。

     </para>


     <note>
      <title>IPv6の構文</title>
      <para>
       IPv6レコードの構文は、IPv4と少し異なっています。断片化の可能性があるため、アドレスの前に消失したビットに関する情報を入力する必要があります。IPv6アドレスを必要な数の<quote>0</quote>で埋めるには、アドレス内の正しい位置に2つコロンを追加します。

      </para>
<screen>pluto     AAAA 2345:00C1:CA11::1234:5678:9ABC:DEF0
pluto     AAAA 2345:00D2:DA11::1234:5678:9ABC:DEF0</screen>

     </note>
   </callout>
   <callout arearefs="welt-zone-ntp">
    <para>
     エイリアス<literal>ntp</literal>を<literal>dns</literal>の別名として使用できます(<systemitem>CNAME</systemitem>は<emphasis>一般名</emphasis>という意味)。
    </para>
   </callout>
  </calloutlist>



  <para>
   擬似ドメイン<literal>in-addr.arpa</literal>は、IPアドレスからホスト名への逆引き参照に使用されます。このドメインの前に、IPアドレスのネットワーク部分が逆順に指定されます。たとえば、<systemitem class="ipaddress">192.168</systemitem>は、<systemitem>168.192.in-addr.arpa</systemitem>に解決されます。<xref linkend="dat-arpa"/>を参照してください。
  </para>



  <example xml:id="dat-arpa">
   <title>逆引き</title>
   <screen>$TTL 2D <co xml:id="data-arpa-ttl"/>
168.192.in-addr.arpa.   IN SOA dns.example.com. root.example.com. ( <co xml:id="data-arpa-soa"/>
                        2003072441      ; serial
                        1D              ; refresh
                        2H              ; retry
                        1W              ; expiry
                        2D )            ; minimum

                        IN NS           dns.example.com. <co xml:id="data-arpa-inns"/>

1.5                     IN PTR          gate.example.com. <co xml:id="data-arpa-ips"/>
100.3                   IN PTR          www.example.com.
253.2                   IN PTR          cups.example.com.</screen>
  </example>

  <calloutlist>
   <callout arearefs="data-arpa-ttl">
    <para>
     $TTLは、このファイルのすべてのエントリに適用される標準のTTLです。
    </para>
   </callout>
   <callout arearefs="data-arpa-soa">
    <para>
     この設定ファイルは、ネットワーク<systemitem class="ipaddress">192.168</systemitem>の逆引きを有効にします。ゾーン名は<systemitem>168.192.in-addr.arpa</systemitem>であり、これはホスト名に追加しません。したがって、すべてのホスト名は完全な形で、つまりドメインと末尾の<literal>&quot;&#x002E;&quot;</literal>が付いて指定されます。残りのエントリは、前出の<systemitem>example.com</systemitem>の例の記述と同じです。
    </para>
    <para>
     このレコード内のエントリの詳細については、<xref linkend="ex-welt-zone"/>を参照してください。
    </para>
   </callout>
   <callout arearefs="data-arpa-inns">
    <para>
     この行は、このゾーンを担当するネームサーバを指定します。ただし、ホスト名は完全な形でドメイン名と末尾の<literal>&quot;&#x002E;&quot;</literal>が付いて指定されます。
    </para>
   </callout>
   <callout arearefs="data-arpa-ips">
    <para>
     この行、および次の行は、各ホスト上のIPアドレスを示唆するポインタレコードです。IPアドレスの最後の部分のみが、行の最初に入力され、末尾に<literal>&quot;&#x002E;&quot;</literal>は付きません。(<systemitem>.in-addr.arpa</systemitem>を付けずに)ゾーンをこれに追加すると、完全なIPアドレスが逆順で生成されます。
    </para>
   </callout>
  </calloutlist>
  <para>
   通常、ゾーン転送は、異なるバージョンのBIND間でも問題なく行えるはずです。
  </para>
 </sect1>

 <sect1 xml:id="sec-dns-dynupdate">
  <title>ゾーンデータの動的アップデート</title>

  <para>
   <emphasis></emphasis>「動的アップデート」という用語は、プライマリサーバのゾーンファイル内のエントリが追加、変更、削除される操作を指します。このメカニズムは、RFC 2136で規定されています。動的アップデートは、オプションの<systemitem>allow-update</systemitem>または<systemitem>update-policy</systemitem>ルールを追加することで、各ゾーンエントリに個別に設定されます。動的に更新されるゾーンを手動で編集してはなりません。
  </para>

  <para>
   サーバに更新エントリを転送するには、<command>nsupdate</command>コマンドを使用します。このコマンドの詳細な構文については、nsupdateのマニュアルページ(<command>man</command><option>8 nsupdate</option>)を参照してください。セキュリティ上の理由から、こうした更新はTSIGキーを使用して実行するようにしてください(<xref linkend="sec-dns-tsig"/>参照)。
  </para>
 </sect1>
 <sect1 xml:id="sec-dns-tsig">
  <title>安全なトランザクション</title>

  <para>
   安全なトランザクションは、共有秘密キー(TSIGキーとも呼ばれる)に基づくトランザクション署名(TSIG)を使用して実現できます。ここでは、このキーの生成方法と使用方法について説明します。
  </para>

  <para>
   安全なトランザクションは、異なるサーバ間の通信、およびゾーンデータの動的アップデートに必要です。アクセス制御をキーに依存する方が、単にIPアドレスに依存するよりもはるかに安全です。
  </para>

  <para>
   TSIGキーの生成には、次のコマンドを使用します(詳細については、<command>man</command> <option>tsig-keygen</option>を参照)。
  </para>

<screen><prompt>&gt; </prompt><command>sudo</command> tsig-keygen -a hmac-md5 host1-host2 &gt; host1-host2.key</screen>

  <para>
   これにより、次のようなコンテンツを持つ<filename>host1-host2.key</filename>という名前のファイルが作成されます。
  </para>

<screen>key "host1-host2" {                       |
    algorithm hmac-md5;
    secret "oHpBLgtcZso6wxnRTWdJMA==";
};</screen>

  <para>
   ファイルは、できれば安全な方法で(たとえば、scpを使用して)リモートホストに転送する必要があります。<literal>host1</literal>と<literal>host2</literal>間の安全な通信を有効にするには、ローカルサーバとリモートサーバの両方の<filename>/etc/named.conf</filename>ファイルにキーを含める必要があります。
  </para>

<screen>key host1-host2 {
 algorithm hmac-md5;
 secret "ejIkuCyyGJwwuN3xAteKgg==";
};</screen>

  <warning>
   <title><filename>/etc/named.conf</filename>のファイルパーミッション</title>
   <para>
    <filename>/etc/named.conf</filename>のファイルパーミッションが適切に制限されていることを確認してください。このファイルのデフォルトのパーミッションは<literal>0640</literal>で、オーナーが<systemitem class="username">root</systemitem>、グループが<systemitem class="username">named</systemitem>です。この代わりに、パーミッションが制限された別ファイルにキーを移動して、そのファイルを<filename>/etc/named.conf</filename>内にインクルードすることもできます。外部ファイルをインクルードするには、次のようにします。
   </para>
<screen>include  "filename"</screen>
   <para>
    ここで、<option>filename</option>には、キーを持つファイルへの絶対パスを指定します。
   </para>
  </warning>

  <para>





   サーバ<literal>host1</literal>が<literal>host2</literal>(この例では、アドレス<literal>10.1.2.3</literal>)のキーを使用できるようにするには、host1の<filename>/etc/named.conf</filename>に次の規則が含まれている必要があります。
  </para>

<screen>server 10.1.2.3 {
  keys { host1-host2. ;};
};</screen>

  <para>
   同様のエントリが<literal>host2</literal>の設定ファイルにも含まれている必要があります。
  </para>

  <para>
   IPアドレスとアドレス範囲に対して定義されているすべてのACL (アクセス制御リスト―ACLファイルシステムと混同しないこと)にTSIGキーを追加してトランザクションセキュリティを有効にします。対応するエントリは、次のようになります。
  </para>

<screen>allow-update { key host1-host2. ;};</screen>

  <para>
   このトピックについての詳細は、<literal>update-policy</literal>の下の『<emphasis>BIND Administrator Reference Manual</emphasis>』を参照してください。
  </para>
 </sect1>
 <sect1 xml:id="sec-dns-dnssec">
  <title>DNSセキュリティ</title>

  <para>
   DNSSEC、またはDNSセキュリティは、RFC 2535で規定されています。DNSSECで使用可能なツールは、BINDマニュアルで説明されています。
  </para>

  <para>
   ゾーンが安全だといえるためには、1つ以上のゾーンキーが関連付けられている必要があります。キーはホストキーと同様、<command>dnssec-keygen</command>によって生成されます。現在、これらのキーの生成には、DSA暗号化アルゴリズムが使用されています。生成されたパブリックキーは、<systemitem>$INCLUDE</systemitem>ルールによって、対応するゾーンファイルにインクルードします。
  </para>

  <para>
   <command>dnssec-signzone</command>コマンドを使用すると、生成されたキーのセット(<literal>keyset-</literal>ファイル)を作成し、それらを安全な方法で親ゾーンに転送し、署名することができます。これによって、<filename>/etc/named.conf</filename>内のゾーンごとにインクルードするファイルが生成されます。
  </para>


 </sect1>
 <sect1 xml:id="sec-dns-info">
  <title>詳細情報</title>

  <para>
   ここで扱ったトピックの詳細については、<filename>/usr/share/doc/packages/bind/arm</filename>ディレクトリにインストールされる<systemitem class="resource">bind-doc</systemitem>パッケージ内の『<emphasis>BIND Administrator Reference Manual</emphasis>』を参照してください。BINDに付属のマニュアルやマニュアルページで紹介されているRFCも、必要に応じて参照してください。<filename>/usr/share/doc/packages/bind/README.SUSE</filename>には、<phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase>のBINDに関する最新情報が含まれています。
  </para>
 </sect1>
</chapter>
