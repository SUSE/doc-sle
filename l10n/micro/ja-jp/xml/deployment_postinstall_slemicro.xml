<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="deployment_postinstall_slemicro.xml" version="5.0" xml:id="cha-postintall-registration">
 <title>展開後の手順</title>
 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:bugtracker/>
   <dm:translation>yes</dm:translation>
  </dm:docmanager>
  <abstract>
   <para>
    この章では、SLE Microの登録について説明し、SLE Microで使用可能な拡張機能について説明します。
   </para>
  </abstract>
 </info>

 <sect1 xml:id="sec-images-registration">
  <title>登録</title>

  <para>
   システムの登録は、<command>transactional-update register</command>コマンドを使用してコマンドラインから実行できます。このセクションの説明対象以外の情報については、<command>SUSEConnect --help</command>でのインラインドキュメントを参照してください。
  </para>

  <procedure>
   <title>SUSEConnectでの製品の登録</title>
   <step>
    <para>
     SUSE Customer Centerで、<phrase role="productname"><phrase os="slemicro">SUSE Linux Enterprise Micro</phrase></phrase>を登録するには、次のように<command>transactional-update
     register</command>を実行します。
    </para>
<screen><prompt role="root"># </prompt>transactional-update register -r <replaceable>REGISTRATION_CODE</replaceable> -e <replaceable>EMAIL_ADDRESS</replaceable></screen>
    <para>
     ローカル登録サーバで登録するには、さらに次のようにサーバへのURLも入力します。
    </para>
<screen><prompt role="root"># </prompt>transactional-update register -r <replaceable>REGISTRATION_CODE</replaceable> -e <replaceable>EMAIL_ADDRESS</replaceable> \
--url "https://suse_register.example.com/"</screen>
    <para>
     <replaceable>REGISTRATION_CODE</replaceable>は、<phrase role="productname"><phrase os="slemicro">SUSE Linux Enterprise Micro</phrase></phrase>のコピーで受け取った登録コードで置き換えます。<replaceable>EMAIL_ADDRESS</replaceable>は、各自または各自の組織が登録の管理に使用しているSUSEアカウントに関連付けられたEメールアドレスで置き換えます。
    </para>
   </step>
   <step>
    <para>
     システムを再起動して、最新のスナップショットに切り替えます。
    </para>
   </step>
   <step>
    <para>
     これで、<phrase role="productname"><phrase os="slemicro">SUSE Linux Enterprise Micro</phrase></phrase>が登録されました。
    </para>
   </step>
  </procedure>
 </sect1>
 <sect1 xml:id="sec-adding-extension">
  <title>拡張機能の管理</title>

  <para>
   SLE Microは、次の拡張機能をサポートしています。
  </para>
<variablelist>
    <varlistentry>
        <term><literal>SUSE Linux Enterprise Live Patching</literal></term>
        <listitem>
            <para>
               拡張機能は、x86 (リアルタイムカーネルを除く)およびIBM Zアーキテクチャでのみ利用できます。拡張機能には、追加のサブスクリプションが必要になる場合があることに注意してください。
            </para>
        </listitem>
    </varlistentry>
    <varlistentry>
        <term><literal>Package Hub</literal></term>
        <listitem>
            <para>
                コミュニティが管理するパッケージへのアクセスを提供する無料のモジュール。Package Hub内のパッケージは、SUSE Linux Enterprise Serverでの使用がSUSEによって承認されているため、パッケージをSLE Microにインストールできない場合があります。
            </para>
        </listitem>
    </varlistentry>
</variablelist>
   <para>
   拡張機能のアクティブ化または非アクティブ化は、<command>transactional-update</command>コマンドとして実行され、新しいスナップショットが作成されるため、システムを再起動して新しいスナップショットを起動し、変更を適用する必要があります。
  </para>

  <sect2 xml:id="sec-slemicro-live-patching">
   <title>拡張機能のアクティブ化</title>
   <para>
    拡張機能をアクティブ化するには、次の手順を実行します。
   </para>
   <procedure>
    <step>
     <para>
      次のコマンドを実行して、使用可能な拡張機能を一覧表示します。
     </para>
<screen><prompt role="root"># </prompt>transactional-update --quiet register -list-extensions</screen>
    </step>
    <step>
     <para>
      出力には、<literal>SUSE Linux Enterprise Live Patching</literal>のような拡張機能をアクティブ化するコマンドが表示されます。
     </para>
<screen>
<prompt role="root"># </prompt>transactional-update register -p sle-module-live-patching/15.4/x86_64 \
  -r <replaceable>registration code</replaceable>
</screen>
    </step>
</procedure>
<para>
    <literal>SUSE Linux Enterprise Live Patching</literal>拡張機能をアクティブ化した場合は、次の説明に従って追加の手順を実行する必要があります。
    </para>

    <procedure xml:id="pro-completing-KLP-activation">
        <title><literal>SUSE Linux Enterprise Live Patching</literal>のアクティベーションの完了</title>
    <step>
     <para>
      <filename>/etc/zypp/zypp.conf</filename>ファイルで<literal>libzypp</literal>を次のように設定します。
     </para>
     <variablelist>
      <varlistentry>
       <term><literal>multiversion = provides:multiversion(kernel)</literal></term>
       <listitem>
        <para>
         これは、システムにパッチを適用している間、現在のカーネルを実行し続けるためです。これを設定しないと、カーネル更新の適用中に依存関係の競合が発生する可能性があります。
        </para>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term><literal>multiversion.kernels = latest</literal></term>
       <listitem>
        <para>
         ライブパッチの適用後、新しいスナップショットでカーネルのクリーンアップが実行されます。設定されていない場合、スナップショットは以前のカーネルを保持し、以前のカーネルでもカーネルの更新を実行します。
        </para>
       </listitem>
      </varlistentry>
     </variablelist>
    </step>
    <step>
     <para>
      さらに、<filename>/etc/sysconfig/livepatching</filename>ファイルで<literal>LIVEPATCH_KERNEL='always'</literal>を設定します。
     </para>
     <note>
      <title><literal>kernel-default-livepatch</literal>とカーネルの一致するバージョン</title>
      <para>
       カーネルアップグレード後もライブパッチが確実にインストールされるようにするには、一致するバージョンの<literal>kernel-default-livepatch</literal>パッケージをインストールします。
      </para>
     </note>
    </step>
    <step>
     <para>
      次に、次のコマンドを実行して拡張機能をインストールします。
     </para>
<screen><prompt role="root"># </prompt>transactional-update pkg install kernel-default-livepatch</screen>
    </step>
    <step>
     <para>
      システムを再起動して、新しいスナップショットに切り替えます。
     </para>
    </step>
   </procedure>
  </sect2>

  <sect2 xml:id="sec-disable-live-patching">
   <title>拡張機能の非アクティブ化</title>
   <para>
    拡張機能を非アクティブ化するには、次のコマンドを実行します。
   </para>
   <screen>
<prompt role="root"># </prompt>transactional-update register -d \
  -p <replaceable>EXTENSION_NAME</replaceable>
</screen>

   <para>
    たとえば、<literal>SUSE Linux Enterprise Live Patching</literal>拡張機能の場合、コマンドは次のようになります。
   </para>
<screen>
<prompt role="root"># </prompt>transactional-update register -d \
  -p sle-module-live-patching/15.4/x86_64
</screen>
  </sect2>
 </sect1>
</chapter>
