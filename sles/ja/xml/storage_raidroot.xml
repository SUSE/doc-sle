<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="storage_raidroot.xml" version="5.0" xml:id="cha.raidroot" xml:lang="ja">
 <title>ルートパーティション用のソフトウェアRAIDの設定</title>
 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:bugtracker/>
   <dm:translation>yes</dm:translation>
  </dm:docmanager>
 </info>
 <para>
  <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase>では、Device Mapper RAIDツールがYaSTパーティショナに統合されています。インストール時にパーティショナを使用して、ルート(<filename>/</filename>)パーティションを含むシステムデバイス用にソフトウェアRAIDを作成することができます。<filename>/boot</filename>パーティションは、RAID 1以外のRAIDパーティションには保存できません。
 </para>
 <sect1 xml:id="sec.raidroot.require">
  <title>
   ルートパーティション用のソフトウェアRAIDデバイスを使用するための前提条件
  </title>

  <para>
   設定が次の要件を満たしていることを確認してください。
  </para>

  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>
     RAID 1のミラーリングデバイスを作成するため、2つのハードドライブが必要です。ハードドライブは類似のサイズで構成する必要があります。RAIDは小さい方のドライブのサイズを採用します。ブロックストレージデバイスには、ローカル(マシンに内蔵、または直結されたもの)、ファイバチャネルストレージサブシステム、またはiSCSIストレージサブシステムを自由に組み合わせることができます。
    </para>
   </listitem>
   <listitem>
    <para>
     ブートローダをMBRにインストールする場合、<filename>/boot</filename>用の別のパーティションは必要ありません。ブートローダをMBRにインストールすることが不可能な場合は、<filename>/boot</filename>が別個のパーティションに存在する必要があります。
    </para>
   </listitem>
   <listitem>
    <para>
     UEFIマシンの場合、専用の<filename>/boot/efi</filename>パーティションを設定する必要があります。これはVFATフォーマットである必要があります。RAID 1デバイスに配置されていれば、<filename>/boot/efi</filename>が存在する物理ディスクに障害が発生した場合にブートの問題を回避できます。
    </para>
   </listitem>
   <listitem>
    <para>
     ハードウェアRAIDデバイスを使用している場合は、その上でソフトウェアRAIDを実行しようとしないでください。
    </para>
   </listitem>
   <listitem>
    <para>
     iSCSIターゲットデバイスをご使用の場合は、RAIDデバイスを作成する前にiSCSIイニシエータサポートを有効にする必要があります。
    </para>
   </listitem>
   <listitem>
    <para>
     ご使用のストレージサブシステムが、ソフトウェアRAIDを使用する予定の直接接続されたローカルデバイス、ファイバチャネルデバイス、またはiSCSIデバイスとサーバの間で複数のI/Oパスを提供している場合は、RAIDデバイスを作成する前に、マルチパスサポートを有効にしなければなりません。
    </para>
   </listitem>
  </itemizedlist>
 </sect1>
 <sect1 xml:id="sec.raidroot.setup">
  <title>
   ルート(<filename>/</filename>)パーティションにソフトウェアRAIDデバイスを使用するシステムの設定
  </title>

  <procedure>
   <step>
    <para>
     YaSTを使用してインストールを開始し、<guimenu>推奨されたパーティション分割</guimenu>の手順に到達するまで、<xref linkend="cha.inst"/>の説明に従って進めます。
    </para>
   </step>
   <step>
    <para>
     <guimenu>エキスパートパーティショナ</guimenu>をクリックして、カスタムパーティショニングツールを開きます。
    </para>
   </step>
   <step>
    <para>
     (オプション)使用したいiSCSIターゲットデバイスがある場合、画面右下のセクションで<menuchoice>
     <guimenu>設定</guimenu> <guimenu>Configure iSCSI (iSCSIの設定)</guimenu>
     </menuchoice>の順に選択して、iSCSIイニシエータソフトウェアを有効にする必要があります。詳細については、<xref linkend="cha.iscsi"/>を参照してください。
    </para>
   </step>
   <step>
    <para>
     (オプション)使用したいデバイスへのI/Oパスが複数存在する場合、画面右下のセクションで<menuchoice>
     <guimenu>設定</guimenu> <guimenu>マルチパスの設定</guimenu>
     <guimenu>はい</guimenu> </menuchoice>の順に選択して、マルチパスサポートを有効にする必要があります。
    </para>
   </step>
   <step>
    <para>
     (オプション)iSCSIもマルチパスも設定していない場合は、デフォルトの推奨設定が表示されます。<guimenu>デバイスの再検出</guimenu>をクリックすると、それらは削除されます。
    </para>
   </step>

   <step>
    <para>
     ソフトウェアRAIDに使用する各デバイスの<guimenu>0xFD Linux RAID</guimenu>フォーマットを設定します。<filename>/</filename>、<filename>/boot/efi</filename>、またはスワップパーティションにはRAIDを使用する必要があります。
    </para>
    <substeps performance="required">
     <step>
      <para>
       左パネルで<guimenu>ハードディスク</guimenu>を選択し、使用するデバイスを選択してから<guimenu>パーティションの追加</guimenu>をクリックします。
      </para>
     </step>
     <step>
      <para>
       <guimenu>新しいパーティションの種類</guimenu>で、<guimenu>プライマリパーティション</guimenu>を選択し、次に<guimenu>次へ</guimenu>をクリックします。
      </para>
     </step>
     <step>
      <para>
       <guimenu>新しいパーティションのサイズ</guimenu>で、使用するサイズを指定し、次に<guimenu>次へ</guimenu>をクリックします。
      </para>
     </step>
     <step>
      <para>
       <guimenu>役割</guimenu>で<guimenu>Raw Volume (Unformatted) (RAWボリューム(未フォーマット))</guimenu>を選択します。
      </para>
     </step>
     <step>
      <para>
       <guimenu>フォーマットしない</guimenu>を選択し、<guimenu>ファイルシステムID</guimenu>を<guimenu>0xFD Linux RAID</guimenu>に設定します。
      </para>
     </step>
     <step>
      <para>
       <guimenu>終了</guimenu>をクリックし、2番目のパーティションに対して同じ手順を繰り返します。
      </para>
      <informalfigure>
       <mediaobject>
        <imageobject role="fo">
         <imagedata fileref="raid_yast_install2_a.png" width="80%" format="PNG"/>
        </imageobject>
        <imageobject role="html">
         <imagedata fileref="raid_yast_install2_a.png" width="100%" format="PNG"/>
        </imageobject>
       </mediaobject>
      </informalfigure>
     </step>
    </substeps>
   </step>
   <step>
    <para>
     <filename>/</filename>パーティション用のRAIDデバイスを作成します。
    </para>
    <substeps performance="required">
     <step>
      <para>
       左パネルで<guimenu>RAID</guimenu>を選択し、<guimenu>RAIDの追加</guimenu>を選択します。
      </para>
     </step>
     <step>
      <para>
       <filename>/</filename>パーティションに対して目的の<guimenu>RAID種類</guimenu>を設定し、<guimenu>RAID名</guimenu>を<literal>system</literal>に設定します。
      </para>
     </step>
     <step>
      <para>
       前の手順で準備した2つのRAIDデバイスを<guimenu>使用可能なデバイス</guimenu>から選択し、<guimenu>追加</guimenu>をクリックして追加します。
      </para>
      <informalfigure>
       <mediaobject>
        <imageobject role="fo">
         <imagedata fileref="raid_yast_install3_a.png" width="80%" format="PNG"/>
        </imageobject>
        <imageobject role="html">
         <imagedata fileref="raid_yast_install3_a.png" width="100%" format="PNG"/>
        </imageobject>
       </mediaobject>
      </informalfigure>
      <para>
       <guimenu>次へ</guimenu>で続行します。
      </para>
     </step>
     <step>
      <para>
       <guimenu>RAIDオプション</guimenu>で、ドロップダウンボックスからチャンクサイズを選択します。デフォルト値をそのまま使用するのが安全です。
      </para>
     </step>
     <step>
      <para>
       <guimenu>役割</guimenu>で、<guimenu>オペレーティングシステム</guimenu>を選択し、<guimenu>完了</guimenu>で続行します。
      </para>
     </step>
     <step>
      <para>
       <guimenu>ファイルシステム</guimenu>を選択し、マウントポイントを<filename>/</filename>に設定します。<filename>完了</filename>をクリックして、このダイアログを終了します。
      </para>
     </step>

    </substeps>
   </step>
   <step>
    <para>
     ソフトウェアRAIDデバイスはデバイスマッパーによって管理され、デバイスを<filename>/dev/md/system</filename>パスの下に作成します。
    </para>
   </step>
   <step>
    <para>
     UEFIマシンに対し、同様の手順を使用して、<filename>/boot/efi</filename>にマウントされるパーティションを作成することもできます。<filename>/boot/efi</filename>でサポートされるのはRAID 1のみであること、およびパーティションがFATファイルシステムでフォーマットされている必要があることを忘れないでください。
    </para>
    <figure>
     <title>RAID上の<guimenu>/</guimenu>、<guimenu>/boot/efi</guimenu>、およびスワップ</title>
     <mediaobject>
      <imageobject role="fo">
       <imagedata fileref="raid_yast_install3_b.png" width="70%" format="PNG"/>
      </imageobject>
      <imageobject role="html">
       <imagedata fileref="raid_yast_install3_b.png" width="70%" format="PNG"/>
      </imageobject>
     </mediaobject>
    </figure>
   </step>
   <step>
    <para>
     <guimenu>承認</guimenu>をクリックして、パーティショナを終了します。
    </para>
    <para>
     <guimenu>推奨されたパーティション分割</guimenu>ページに新しい案が表示されます。
    </para>
   </step>
   <step>
    <para>
     インストールを続行します。独立した<filename>/boot/efi</filename>パーティションを持つUEFIマシンでは、<guimenu>インストールの設定</guimenu>画面で<guimenu>ブート</guimenu>をクリックし、<guimenu>GRUB2 for EFI (EFI用のGRUB2)</guimenu>を<guimenu>ブートローダ</guimenu>として設定します。<guimenu>Secure Bootサポートを有効にする</guimenu>オプションがアクティブになっていることを確認します。
    </para>
    <para>
     サーバを再起動するたびに、デバイスマッパーが起動時に開始し、ソフトウェアRAIDが自動的に認識され、ルート(/)パーティション上のオペレーティングシステムを開始することができます。
    </para>
   </step>
  </procedure>
 </sect1>
</chapter>
